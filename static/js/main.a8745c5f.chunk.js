(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[0],{30:function(e,t,a){e.exports=a(50)},35:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(3),s=a.n(r),o=(a(35),a(5)),l=a(13),c=a.n(l),u=a(11),d=a(10),m=a(26),p=a(27),h=a(6),w=a(29),f=a(28);a(22);function g(e){return Math.floor(Math.random()*Math.floor(e))}var v=function(e){Object(w.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).WPATilesUrl="https://tiles.arcgis.com/tiles/jWQlP64OuwDh6GGX/arcgis/rest/services/_wpa_all_6Aug2020/MapServer",n.WPAMapsLandParcelsUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels/FeatureServer/0",n.sectionsLayerUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/ArcGIS/rest/services/Oklahoma_Public_Land_Survey_Sections/FeatureServer/0",n.mapRef=i.a.createRef(),n.workflow=e.workflow,n.editThis=n.editThis.bind(Object(h.a)(n)),n.sayThanks=n.sayThanks.bind(Object(h.a)(n)),n.reviewWorkflow=n.reviewWorkflow.bind(Object(h.a)(n)),n.getRandomParcel=n.getRandomParcel.bind(Object(h.a)(n)),n.getRandomSection=n.getRandomSection.bind(Object(h.a)(n)),n.rotationChange=n.rotationChange.bind(Object(h.a)(n)),n.updateTimesChecked=n.updateTimesChecked.bind(Object(h.a)(n)),n.state={updateFeature:null,mapRotation:0},n}return Object(p.a)(a,[{key:"getRandomParcel",value:function(){var e=this,t=this,a=g(this.objectIds.length-1),n=this.WPAMapsLandParcels.createQuery();n.where="OBJECTID = "+this.objectIds[a],this.WPAMapsLandParcels.queryFeatures(n).then((function(a){t.view.goTo(a.features[0].geometry.extent),t.view.popup.features=a.features,t.view.popup.visible=!0,t.setState({updateFeature:a.features[0]}),e.view.whenLayerView(e.WPAMapsLandParcels).then((function(e){t.highlightedFeature=e.highlight(a.features[0])}))}))}},{key:"getRandomSection",value:function(){var e=this,t=g(70915);this.sectionsLayer.definitionExpression="OBJECTID = "+t,this.sectionsLayer.when((function(){return e.sectionsLayer.queryExtent()})).then((function(t){e.view.goTo(t.extent)}))}},{key:"reviewWorkflow",value:function(){var e=this;this.WPAMapsLandParcels.queryObjectIds().then((function(t){e.objectIds=t,e.getRandomParcel()}))}},{key:"rotationChange",value:function(e,t,a){0===t&&0!==e&&this.view.ui.add(this.compass,"top-left"),0!==t&&0===e&&this.view.ui.remove(this.compass)}},{key:"componentDidMount",value:function(){var e=this;Object(d.loadModules)(["esri/Map","esri/Basemap","esri/views/MapView","esri/layers/FeatureLayer","esri/views/layers/FeatureLayerView","esri/layers/TileLayer","esri/widgets/Compass","esri/widgets/Editor","esri/core/watchUtils","esri/widgets/AreaMeasurement2D"],{css:!0}).then((function(t){var a=Object(o.a)(t,10),n=a[0],i=a[1],r=a[2],s=a[3],l=(a[4],a[5]),c=a[6],u=a[7],d=a[8],m=(a[9],new l({url:e.WPATilesUrl}));e.map=new n({basemap:new i({baseLayers:[m]})}),e.view=new r({container:e.mapRef.current,map:e.map,highlightOptions:{color:"#fe5c00",fillOpacity:.1},popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1}}}),e.compass=new c({view:e.view}),e.view.watch("rotation",e.rotationChange);var p=document.createElement("div");p.className="esri-icon-refresh esri-widget--button esri-widget esri-interactive ",p.title="create"===e.workflow?"Go to another random section.":"Get another entry to review.",p.addEventListener("click",(function(){switch(e.workflow){case"create":e.getRandomSection();break;case"update":e.getRandomParcel();break;default:alert("moo")}})),e.view.ui.add(p,"bottom-left");var h={title:"Please doublecheck the info below.",content:[{type:"fields",fieldInfos:[{fieldName:"OwnerLastName",label:"Owner's Last Name (if an individual)"},{fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"},{fieldName:"LandValue",label:"Land Value"},{fieldName:"ImprovementsValue2",label:"Improvements Value"},{fieldName:"TaxExempt",label:"Marked with an X?"}]}],actions:[{title:"Looks good!",id:"this-looks-ok",className:"esri-icon-check-mark"},{title:"Edit feature",id:"edit-this",className:"esri-icon-edit"}]};e.WPAMapsLandParcels=new s({url:e.WPAMapsLandParcelsUrl,popupTemplate:h,formTemplate:{title:"Land Info",elements:[{type:"group",label:"Owner Information",elements:[{type:"field",fieldName:"OwnerLastName",label:"Owner's Last Name (if an individual)"},{type:"field",fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{type:"field",fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"}]},{type:"group",label:"Land and Improvement Valuation",elements:[{type:"field",fieldName:"LandValue",label:"Land Value"},{type:"field",fieldName:"ImprovementsValue2",label:"Improvements Value"}]},{type:"field",fieldName:"TaxExempt",label:"Marked with an X?"}]},groupDisplay:"sequential"}),e.WPAMapsLandParcels.on("edits",(function(t){t.updatedFeatures.length>0&&(e.sayThanks(),e.view.ui.remove(e.editor))})),e.editor=new u({view:e.view,allowedWorkflows:[e.workflow],supportingWidgetDefaults:{featureForm:{groupDisplay:"sequential",fieldConfig:[{name:"OwnerLastName",label:"Owner's Last Name (if an individual)",required:!1},{name:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)",required:!1},{name:"OwnerOrgName",label:"Owner (if an entity or organization)",required:!1},{name:"LandValue",label:"Land Value",required:!1},{name:"ImprovementsValue2",label:"Improvements Value",required:!1},{name:"TaxExempt",label:"Marked with an X?",required:!1}]}},layerInfos:[{view:e.view,layer:e.WPAMapsLandParcels,allowAttachments:!1,deleteEnabled:!1}]}),e.editor.postInitialize=function(){d.init(this,"messages",(function(e){e.widgetLabel="WPA Maps",e.addFeature="Draw a new shape",e.editFeature="Review an existing record"}))},e.editor.viewModel.watch("syncing",(function(e,t,a,n){var i=document.getElementsByClassName("esri-editor__control-button");0!==i.length&&(!0===e&&(i[0].disabled="disabled",i[0].classList.add("esri-button--disabled")),!1===e&&(i[0].removeAttribute("disabled"),i[0].classList.remove("esri-button--disabled")))}));var w=e;e.view.popup.on("trigger-action",(function(e){"edit-this"===e.action.id&&w.editThis(),"this-looks-ok"===e.action.id&&w.updateTimesChecked()})),"create"===e.workflow&&(e.sectionsLayer=new s({url:e.sectionsLayerUrl}),e.getRandomSection(),e.map.add(e.sectionsLayer),e.WPAMapsLandParcels.popupEnabled=!1,e.view.ui.add(e.editor,"bottom-right")),"update"===e.workflow&&e.reviewWorkflow(),e.map.add(e.WPAMapsLandParcels)}))}},{key:"updateTimesChecked",value:function(){var e=this.state.updateFeature,t=e.getAttribute("timesChecked");e.setAttribute("timesChecked",t+1);var a={updateFeatures:[e]};this.WPAMapsLandParcels.applyEdits(a),this.highlightedFeature.remove()}},{key:"sayThanks",value:function(){var e=this;this.props.setModalContent(i.a.createElement("div",null,i.a.createElement("h1",null,"Thank you!"),i.a.createElement("p",null,"Here's another entry to check."))),this.props.openModal(),setTimeout((function(){e.props.closeModal()}),2e3),this.highlightedFeature.remove(),this.getRandomParcel(),this.view.popup.close()}},{key:"editThis",value:function(){var e=this.view,t=this.editor;e.when((function(){t.viewModel.activeWorkFlow||(e.popup.visible=!1,t.startUpdateWorkflowAtFeatureEdit(e.popup.selectedFeature),e.ui.add(t,"bottom-right"),e.popup.spinnerEnabled=!1),setTimeout((function(){var a=t.domNode.getElementsByClassName("esri-editor__back-button esri-interactive");1===a.length&&(a[0].setAttribute("title","Cancel edits, return to popup"),a[0].addEventListener("click",(function(a){a.preventDefault(),e.ui.remove(t)})))}),150)}))}},{key:"componentWillUnmount",value:function(){this.view&&(this.view.container=null)}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"webmap",ref:this.mapRef}))}}]),a}(i.a.Component),b=(a(49),{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}});var E=function(){var e=Object(n.useState)(!0),t=Object(o.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!1),l=Object(o.a)(s,2),m=l[0],p=l[1],h=Object(n.useState)(0),w=Object(o.a)(h,2),f=w[0],g=w[1],E=Object(n.useState)(""),y=Object(o.a)(E,2),k=y[0],O=y[1],L=Object(n.useState)(!1),N=Object(o.a)(L,2),P=N[0],M=N[1],A=Object(n.useState)("___"),j=Object(o.a)(A,2),S=j[0],C=j[1],I=["Good job!","Way to go!","Wow!","That's super!","Awesome!"],T=Object(n.useState)(I[Math.floor(Math.random()*Math.floor(I.length))]),F=Object(o.a)(T,2),R=F[0],W=(F[1],Object(n.useState)([{content:i.a.createElement("div",null,i.a.createElement("h1",null,"Draw and transcribe map data"),i.a.createElement("div",{className:"imgContainer"},i.a.createElement("img",{alt:"Draw a shape representing a  parcel of land and transcribe the ",src:"/ok-wpa-maps/img/wpa3.gif"}))),placement:"auto",target:".drawShapes",disableBeacon:!0},{content:i.a.createElement("div",null,i.a.createElement("h1",null,"Review existing entries"),i.a.createElement("h3",null,"If you don't see any errors, click ",i.a.createElement("strong",null,i.a.createElement("calcite-icon",{scale:"s",icon:"check"}),"Looks Good!")),i.a.createElement("div",{className:"imgContainer"},i.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa7.gif"}))),placement:"auto",target:".reviewShapes"},{content:i.a.createElement("div",null,i.a.createElement("h1",null,"Review existing entries"),i.a.createElement("h3",null,"If you see something incorrect or missing, click ",i.a.createElement("strong",null,i.a.createElement("calcite-icon",{scale:"s",icon:"pencil"}),"Edit feature")),i.a.createElement("div",{className:"imgContainer"},i.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa8.gif"}))),placement:"auto",target:".reviewShapes"},{content:i.a.createElement(i.a.Fragment,null,i.a.createElement("h3",null,"Right click and drag to change the rotation of the map."),i.a.createElement("div",{className:"imgContainer"},i.a.createElement("img",{alt:"Demonstration of rotating the map",src:"/ok-wpa-maps/img/wpa4.gif"})),i.a.createElement("p",null," Press the compass button to reset")),placement:"center",target:"body"}])),_=Object(o.a)(W,2),D=_[0];function x(){p(!1)}return _[1],c.a.setAppElement("#root"),Object(n.useEffect)((function(){Object(d.loadModules)(["esri/identity/OAuthInfo","esri/identity/IdentityManager","esri/layers/FeatureLayer"],{css:!0}).then((function(e){var t=Object(o.a)(e,3),a=t[0],n=t[1],i=t[2],r=new a({appId:"l3OWRmRCGfkAN4Dh",portalUrl:"https://osu-geog.maps.arcgis.com/",popup:!1});n.registerOAuthInfos([r]),n.checkSignInStatus(r.portalUrl+"/sharing").then((function(e){var t=new i({url:"https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels/FeatureServer/0"}),a=t.createQuery();a.where="CREATOR = '"+e.userId+"'",a.outStatistics=[{onStatisticField:"CREATOR",outStatisticFieldName:"CREATOR_COUNT",statisticType:"count"}],t.queryFeatures(a).then((function(e){e.features.length>0&&C(e.features[0].getAttribute("CREATOR_COUNT"))}))})).catch(n.getCredential(r.portalUrl+"/sharing"))}))}),[]),i.a.createElement("div",{className:"App"},i.a.createElement(u.b,{callback:function(e){var t=e.status;e.type,[u.a.FINISHED,u.a.SKIPPED].includes(t)&&M(!1)},continuous:!0,run:P,scrollToFirstStep:!0,showProgress:!0,showSkipButton:!0,steps:D,styles:{options:{zIndex:1e4,width:800}}}),i.a.createElement(c.a,{isOpen:m,onAfterOpen:function(){},onRequestClose:x,style:b,contentLabel:"Example Modal"},k),!0===a&&i.a.createElement(i.a.Fragment,null,i.a.createElement("h1",null,"Choose your path:"),i.a.createElement("button",{className:"drawShapes",onClick:function(){r(!1),g("create")}},i.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"addInNew"}),i.a.createElement("br",null),"Draw some shapes"),i.a.createElement("h2",null,"or"),i.a.createElement("button",{className:"reviewShapes",onClick:function(){r(!1),g("update")}},i.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"editAttributes"}),i.a.createElement("br",null),"Review existing shapes"),i.a.createElement("h2",null,"or"),i.a.createElement("button",{onClick:function(){M(!P)}},i.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"question"}),i.a.createElement("br",null),"View the intro"),i.a.createElement("h3",null,"So far you've added ",i.a.createElement("span",{style:{fontSize:"2em"}},S)," ",1===S?"shape":"shapes",". ",R)),!1===a&&i.a.createElement(v,{workflow:f,openModal:function(){p(!0)},closeModal:x,setModalContent:O}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.a8745c5f.chunk.js.map