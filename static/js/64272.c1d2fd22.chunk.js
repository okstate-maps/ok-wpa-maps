"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[11742,64272],{64272(e,t,i){i.r(t),i.d(t,{default:()=>I});var s=i(6326),o=(i(11265),i(88685)),n=i(46053),a=(i(81806),i(76460),i(47249),i(87990)),r=i(11742),c=(i(15187),i(54761)),l=i(10336),u=i(26547);function d(e){var t;const{feature:i,heading:s}=e,o=s||(0,u.R)(i),n=null!==(t=function(e){const{feature:t,association:i,associationType:s,messages:o}=e,{attachment:n,connectivity:a,container:r,content:c,structure:u}=o,d=t.sourceLayer;if(!i&&!s)return;if(!i)switch(s){case"attachment":return n;case"container":return r;case"connectivity":return a;case"content":return c;case"structure":return u}if(!d)return;const p=t.attributes[d.globalIdField]===i.fromNetworkElement.globalId?"from":"to";return(0,l.o)(i,p,o)}(e))&&void 0!==t?t:"";return(0,c.K)("calcite-block",{description:n,heading:o})}var p=i(91967);let h=class extends p.A{constructor(e){super(e),this.associationDetails=!0}};(0,s.Cg)([(0,n.MZ)({type:Boolean,nonNullable:!0})],h.prototype,"associationDetails",void 0),h=(0,s.Cg)([(0,a.$)("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.VisibleElements")],h);var v=i(94126),g=i(98108),y=i(87540),m=i(63582),f=i(91039),_=i(33248),F=i(99366),C=i(9660),M=i(45020),b=i(39348);const w="esri-feature-form-utility-network-association-list",L={base:w,header:"".concat(w,"__header"),headingContent:"".concat(w,"__heading-content"),listContainer:"".concat(w,"__list-container")};let A=class extends _.A{constructor(e,t){super(e,t),this._isLoadingSelectFeature=!1,this.associationInput=null,this.headingLevel=5,this.messagesFeatureForm=null,this.onSelectLayer=()=>{},this.onSelectFeature=async()=>{},this.onAddAssociation=()=>{},this.viewModel=new f.A,this.visibleElements=new h}initialize(){this.setUpObserver()}loadDependencies(){return(0,v.W)({chip:()=>Promise.all([i.e(55304),i.e(9474),i.e(10239)]).then(i.bind(i,10239)),fab:()=>Promise.all([i.e(55304),i.e(9474),i.e(43285),i.e(95019)]).then(i.bind(i,58862)),icon:()=>Promise.all([i.e(55304),i.e(16702)]).then(i.bind(i,16702)),list:()=>Promise.all([i.e(55304),i.e(9474),i.e(36175),i.e(38841),i.e(75802)]).then(i.bind(i,75802)),"list-item":()=>Promise.all([i.e(55304),i.e(9474),i.e(91654),i.e(85375),i.e(14841),i.e(25412)]).then(i.bind(i,70205)),tooltip:()=>Promise.all([i.e(55304),i.e(91654),i.e(31748)]).then(i.bind(i,31748))})}get _filteredFeatureInfos(){var e,t;const{associationInput:i,filterText:s}=this;return null!==i&&void 0!==i&&i.associatedLayer&&null!==(e=null===i||void 0===i||null===(t=i.associatedFeatureInfos.get(i.associatedLayer))||void 0===t?void 0:t.filter(e=>{var t,i;return null!==(t=null===(i=e.title)||void 0===i?void 0:i.toLowerCase().includes(s))&&void 0!==t&&t}).toArray())&&void 0!==e?e:[]}get associatedFeatureCount(){const{associationInput:e}=this;if(!e)return 0;const{associatedFeatureInfos:t,associatedLayer:i}=e,s=i?t.get(i):null;return s?s.length:0}render(){const{associationInput:e}=this;if(!e)return(0,c.K)("div",{class:this.classes(L.base,g.D.widget)});const{associatedLayer:t}=e,{state:i}=this.viewModel;return(0,c.K)("div",{class:this.classes(L.base,g.D.widget)},"loading"===i||"querying"===i?this.renderLoading():t?this._renderFeatureList(e,t):this._renderLayerList(e))}_renderLayerList(e){var t;const{associatedFeatureInfos:i,editable:s}=e;return(0,c.K)("div",{class:L.listContainer},(0,c.K)("calcite-list",{label:null===(t=this.messagesFeatureForm)||void 0===t?void 0:t.associations.associatedLayers},Array.from(i.keys(),t=>this._renderLayerItem(e,t))),s?(0,c.K)("calcite-fab",{appearance:"outline-fill",icon:"plus",key:"".concat(e.uid,"-add-button"),kind:"neutral",onclick:()=>this.onAddAssociation({feature:e.feature,associationType:e.activeAssociationType,utilityNetwork:e.utilityNetwork}),text:this.messagesCommon.add,textEnabled:!0}):null)}_renderFeatureList(e,t){var i;return(0,c.K)(c.w,null,this._renderHeader(e,t),(0,c.K)("div",{class:L.listContainer},this.renderFeatureCountWarning(),(0,c.K)("calcite-list",{label:null===(i=this.messagesFeatureForm)||void 0===i?void 0:i.associations.associatedFeatures},this._renderAssociatedFeatureListPage(),this.renderFeatureObserver())))}_renderLayerTitle(e){return e.title?(0,c.K)(y.D,{key:"title",level:this.headingLevel},(0,c.K)("div",{class:L.headingContent},(0,c.K)("calcite-icon",{icon:"layer"}),e.title)):null}_renderTotal(e){var t;const i=(0,b.V)(null===(t=this.messagesFeature)||void 0===t?void 0:t.numberRecords,{number:this._filteredFeatureInfos.length});return(0,c.K)("div",{key:e.id},i)}_renderHeader(e,t){const{messagesFeatureForm:i}=this,{activeAssociationType:s,featureItem:o,feature:n}=e;return(0,c.K)("div",{class:L.header,key:"filter"},this.visibleElements.associationDetails?(0,c.K)(d,{associationType:null===s||void 0===s?void 0:s.type,feature:n,heading:null===o||void 0===o?void 0:o.label,messages:i.associations}):void 0,this._renderLayerTitle(t),this.renderFilter(),this._renderTotal(t))}_renderAssociatedFeatureListPage(){const e=this._filteredFeatureInfos.slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this,i=e.feature.uid.toString();return(0,C.s)(e.association)?(0,c.K)("calcite-tooltip",{key:"tooltip-".concat(i),overlayPositioning:"fixed",referenceElement:t.get(i)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){var t;const i=this.messagesCommon.untitled,s=e.title||i,n=e.feature.uid.toString();return(0,c.K)("calcite-list-item",{description:(0,o._e)(null!==(t=e.terminalName)&&void 0!==t?t:""),key:"associated-feature-type-".concat(n),label:(0,o._e)(s),onCalciteListItemSelect:()=>this._selectAssociation(e)},(0,C.s)(e.association)?this.renderConnectivityIcon(e.association.associationType,n):null,(0,M.S)(e.association)?(0,c.K)("calcite-chip",{label:(0,F.w)(e.association),scale:"s",slot:"content-end"},(0,F.w)(e.association)):null,(0,c.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderTooltips(e){return e.map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(e){return e.map(e=>this._renderAssociatedFeature(e))}_renderLayerItem(e,t){var i,s,o;const{associatedFeatureInfos:n}=e,a=null!==(i=null===(s=n.get(t))||void 0===s?void 0:s.length)&&void 0!==i?i:0;return(0,c.K)("calcite-list-item",{expanded:!0,key:"".concat(t.id,"-show-all"),label:null!==(o=t.title)&&void 0!==o?o:this.messagesCommon.untitled,value:t.id,onCalciteListItemSelect:()=>{this.filterText="",this._showAllAssociations(t)}},(0,c.K)("calcite-chip",{label:a.toString(),scale:"s",slot:"content-end"},a),(0,c.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}async _selectAssociation(e){this._isLoadingSelectFeature||(this._isLoadingSelectFeature=!0,await this.onSelectFeature({feature:e.feature,association:e.association}),this._isLoadingSelectFeature=!1)}_showAllAssociations(e){this.onSelectLayer({layer:e,associationInput:this.associationInput})}};(0,s.Cg)([(0,n.MZ)()],A.prototype,"_filteredFeatureInfos",null),(0,s.Cg)([(0,n.MZ)()],A.prototype,"associatedFeatureCount",null),(0,s.Cg)([(0,n.MZ)({type:r.default})],A.prototype,"associationInput",void 0),(0,s.Cg)([(0,n.MZ)()],A.prototype,"headingLevel",void 0),(0,s.Cg)([(0,n.MZ)(),(0,m.G)("esri/widgets/FeatureForm/t9n/FeatureForm")],A.prototype,"messagesFeatureForm",void 0),(0,s.Cg)([(0,n.MZ)({constructOnly:!0})],A.prototype,"onSelectLayer",void 0),(0,s.Cg)([(0,n.MZ)({constructOnly:!0})],A.prototype,"onSelectFeature",void 0),(0,s.Cg)([(0,n.MZ)({constructOnly:!0})],A.prototype,"onAddAssociation",void 0),(0,s.Cg)([(0,n.MZ)({type:f.A})],A.prototype,"viewModel",void 0),(0,s.Cg)([(0,n.MZ)({type:h,nonNullable:!0})],A.prototype,"visibleElements",void 0),A=(0,s.Cg)([(0,a.$)("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.FeatureFormUtilityNetworkAssociationList")],A);const I=A},11742(e,t,i){i.r(t),i.d(t,{default:()=>v});var s=i(6326),o=i(5632),n=i(50346),a=i(68134),r=i(46053),c=(i(81806),i(76460),i(47249),i(87990)),l=i(19451),u=i(9912),d=i(48397),p=i(91039);let h=class extends((0,o.sA)(d.A)){constructor(e){super(e),this.group=null,this.type="utilityNetworkAssociations",this.featureItem=null,this._updatingHandlesSetUp=new l.U,this.addHandles([(0,a.wB)(()=>({feature:this.feature,element:this.element,layer:this.layer}),e=>this._createAssociationVM(e),a.Vh),(0,a.wB)(()=>this.feature,()=>this._setFeatureItem()),(0,a.wB)(()=>this.associatedLayer,(e,t)=>this._updateLayerEditHandle(e,t),a.Vh)])}destroy(){var e;null!==(e=this._associationsVM)&&void 0!==e&&e.destroy(),this._updatingHandlesSetUp.destroy()}get activeAssociationType(){var e;return null===(e=this._associationsVM)||void 0===e?void 0:e.activeAssociationType}get associatedFeatures(){const{associatedLayer:e}=this;if(e)return this.associatedFeatureInfos.get(e)}get associatedFeatureInfos(){var e;const{_associationsVM:t}=this;if(null===t||void 0===t||null===(e=t.associationFeatures)||void 0===e||!e.size||null===t||void 0===t||!t.utilityNetwork)return new Map;const{associationFeatures:i}=t,s=new Map;return i.forEach((e,t)=>{s.set(t,e)}),s}get associatedLayer(){return this._get("associatedLayer")}set associatedLayer(e){this._associationsVM.showAllEnabled=null!=e,this._set("associatedLayer",e)}get associationsViewModel(){return this._associationsVM}get canAddAssociation(){const{editable:e,utilityNetwork:t}=this;return!(!t||!this.loaded)&&e}get editable(){var e;return null===(e=this.evaluatedEditableExpression)||void 0===e||e}get featureCount(){var e,t;return null!==(e=null===(t=this._associationsVM)||void 0===t?void 0:t.featureCount)&&void 0!==e?e:0}get viewModel(){return this._associationsVM}get loaded(){var e;return"loading"!==(null===(e=this._associationsVM)||void 0===e?void 0:e.state)&&!this._updatingHandlesSetUp.updating}get map(){return this._get("map")}set map(e){var t;e&&null!==(t=this._associationsVM)&&void 0!==t&&t.set("map",e),this._set("map",e)}get utilityNetwork(){var e;return null===(e=this._associationsVM)||void 0===e?void 0:e.utilityNetwork}get associationTypes(){var e,t;return null!==(e=null===(t=this._associationsVM)||void 0===t?void 0:t.associationTypes)&&void 0!==e?e:this.element.associationTypes}get visible(){const{utilityNetwork:e}=this;return!!e&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element)}get updating(){var e,t;return"loading"===(null===(e=this._associationsVM)||void 0===e?void 0:e.state)||"querying"===(null===(t=this._associationsVM)||void 0===t?void 0:t.state)}async refresh(){await(0,n.QZ)(this._associationsVM.refresh())}_updateLayerEditHandle(e,t){t&&"layerId"in t&&this.removeHandles(null===t||void 0===t?void 0:t.layerId),(0,u.isAssociatedFeatureSupportedLayer)(e)&&this.addHandles((0,a.on)(()=>e,"edits",()=>this.refresh()),e.layerId)}_createAssociationVM(e){var t;const{feature:i,element:s,layer:o}=e;if(null!==(t=this._associationsVM)&&void 0!==t&&t.destroy(),!i||!s||!o)return;const{map:n,associationTypes:a}=this;(0,u.isAssociatedFeatureSupportedLayer)(o)&&(this._associationsVM=new p.A({graphic:i,layer:o,map:n,associationTypes:a,source:"featureForm",title:this.label,description:this.description}))}_setFeatureItem(){this._updatingHandlesSetUp.addPromise((async()=>{const{feature:e,layer:t}=this;e&&t&&"getFeatureTitle"in t&&(this.featureItem={feature:e,label:await t.getFeatureTitle(e)})})())}};(0,s.Cg)([(0,r.MZ)()],h.prototype,"_associationsVM",void 0),(0,s.Cg)([(0,r.MZ)()],h.prototype,"activeAssociationType",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"associatedFeatures",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"associatedFeatureInfos",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"associatedLayer",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"associationsViewModel",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"canAddAssociation",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"editable",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"featureCount",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"viewModel",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"group",void 0),(0,s.Cg)([(0,r.MZ)()],h.prototype,"loaded",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"map",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"utilityNetwork",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"associationTypes",null),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,s.Cg)([(0,r.MZ)()],h.prototype,"visible",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"updating",null),(0,s.Cg)([(0,r.MZ)()],h.prototype,"featureItem",void 0),h=(0,s.Cg)([(0,c.$)("esri.widgets.FeatureForm.UtilityNetworkAssociationInput")],h);const v=h},33248(e,t,i){i.d(t,{A:()=>y});var s=i(6326),o=(i(11265),i(67993)),n=i(68134),a=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),c=i(25329),l=i(94126),u=(i(15187),i(63582)),d=i(54761),p=i(91039),h=i(39348);const v="esri-utility-network-association-list",g={featureObserver:"".concat(v,"__feature-observer"),filterContainer:"".concat(v,"__filter-container"),limitNoticeContainer:"".concat(v,"__limit-notice-container"),loadingContainer:"".concat(v,"__loading-container")};let y=class extends c.A{constructor(e,t){super(e,t),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver(e=>{let[t]=e;(null===t||void 0===t?void 0:t.isIntersecting)&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.filterText="",this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new o.A,this.viewModel=new p.A}initialize(){this.setUpObserver()}loadDependencies(){return(0,l.W)({icon:()=>Promise.all([i.e(55304),i.e(16702)]).then(i.bind(i,16702)),input:()=>Promise.all([i.e(55304),i.e(9474),i.e(36175),i.e(38841)]).then(i.bind(i,38841)),loader:()=>i.e(35688).then(i.bind(i,35688)),notice:()=>Promise.all([i.e(55304),i.e(9474),i.e(71475)]).then(i.bind(i,71475))})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){const e=this.viewModel.associationViewModels,t=this.selectedLayer?e.get(this.selectedLayer):null;return t?t.length:0}set currentFeaturePage(e){const{featuresPerPage:t,associatedFeatureCount:i}=this,s=Math.ceil(i/t)||1,o=Math.max(Math.min(e,s),1);this._set("currentFeaturePage",o)}get currentFeaturePage(){var e;return null!==(e=this._get("currentFeaturePage"))&&void 0!==e?e:1}get endIndex(){const{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:i}=this;return Math.min(e*t,i)}renderConnectivityIcon(e,t){const{tooltipReferenceMap:i}=this;let s;switch(e){case"junction-edge-from-connectivity":s="connection-end-left";break;case"junction-edge-to-connectivity":s="connection-end-right";break;case"junction-edge-midspan-connectivity":s="connection-middle";break;default:s="connection-to-connection"}return(0,d.K)("calcite-icon",{afterCreate:e=>i.set(t,e),afterRemoved:()=>i.delete(t),icon:s,scale:"s",slot:"content-start"})}renderFeatureCountWarning(){const{associatedFeatureCount:e,maxFeatureCount:t,messagesFeature:i}=this;return e>t?(0,d.K)("calcite-notice",{class:this._isFeatureCountNoticeOpen?g.limitNoticeContainer:void 0,closable:!0,icon:"information",kind:"info",open:!0,scale:"s",width:"full",onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},(0,d.K)("div",{slot:"title"},i.associationsLimitNoticeTitle),(0,d.K)("div",{slot:"message"},(0,h.V)(i.associationsLimitNoticeMessage,{number:t}))):null}renderFeatureObserver(){return(0,d.K)("div",{afterCreate:this._onObserverCreate,bind:this,class:g.featureObserver,key:"feature-observer"})}renderFilter(){return(0,d.K)("div",{class:g.filterContainer,key:"filter"},(0,d.K)("calcite-input",{icon:"search",placeholder:this.messagesFeature.associationFilterPlaceholder,type:"search",onCalciteInputInput:e=>{this.filterText=e.currentTarget.value.trim().toLowerCase(),this.currentFeaturePage=1}}))}renderLoading(){return(0,d.K)("div",{class:g.loadingContainer,key:"loading-container"},this.renderLoadingIcon())}renderLoadingIcon(){return(0,d.K)("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(e){const{messagesFeature:t}=this;switch(e){case"connectivity":case"junction-junction-connectivity":return t.associationsJunctionJunction;case"junction-edge-from-connectivity":return t.associationsJunctionEdgeFrom;case"junction-edge-midspan-connectivity":return t.associationsJunctionEdgeMidspan;case"junction-edge-to-connectivity":return t.associationsJunctionEdgeTo;default:return""}}setUpObserver(){this.addHandles((0,n.wB)(()=>this._observerNode,()=>this._onObserverChange()))}_increaseFeaturePage(){this.currentFeaturePage++}_onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);const{state:e,showAllEnabled:t}=this.viewModel;this._observerNode&&"ready"===e&&t&&this._observer.observe(this._observerNode)}_onObserverCreate(e){this._observerNode=e}};(0,s.Cg)([(0,a.MZ)()],y.prototype,"_observer",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"_observerNode",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"associatedFeatureCount",null),(0,s.Cg)([(0,a.MZ)()],y.prototype,"currentFeaturePage",null),(0,s.Cg)([(0,a.MZ)()],y.prototype,"endIndex",null),(0,s.Cg)([(0,a.MZ)()],y.prototype,"featuresPerPage",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"filterText",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"headingLevel",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"maxFeatureCount",void 0),(0,s.Cg)([(0,a.MZ)(),(0,u.G)("esri/widgets/Feature/t9n/Feature")],y.prototype,"messagesFeature",void 0),(0,s.Cg)([(0,a.MZ)(),(0,u.G)("esri/t9n/common")],y.prototype,"messagesCommon",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"selectedLayer",void 0),(0,s.Cg)([(0,a.MZ)()],y.prototype,"tooltipReferenceMap",void 0),(0,s.Cg)([(0,a.MZ)({type:p.A})],y.prototype,"viewModel",void 0),y=(0,s.Cg)([(0,r.$)("esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList")],y)},99366(e,t,i){i.d(t,{w:()=>o});i(11265);var s=i(50265);function o(e){const{percentAlong:t}=e;return null==t?"":(0,s.ZV)(t,{style:"percent",maximumFractionDigits:2})}},10336(e,t,i){function s(e,t,i){const{associationType:s}=e;switch(s){case"attachment":return"to"===t?i.attachment:i.structure;case"containment":return"to"===t?i.content:i.container;case"junction-edge-from-connectivity":case"junction-edge-to-connectivity":case"junction-edge-midspan-connectivity":case"junction-junction-connectivity":case"connectivity":return i.connectivity}}i.d(t,{o:()=>s})},9660(e,t,i){function s(e){const{associationType:t}=e;return"connectivity"===t||"junction-junction-connectivity"===t||"junction-edge-from-connectivity"===t||"junction-edge-midspan-connectivity"===t||"junction-edge-to-connectivity"===t}i.d(t,{s:()=>s})},45020(e,t,i){function s(e){return"junction-edge-midspan-connectivity"===e.associationType}i.d(t,{S:()=>s})}}]);
//# sourceMappingURL=64272.c1d2fd22.chunk.js.map