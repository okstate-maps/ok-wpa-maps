"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[40920],{40920:(e,o,t)=>{t.d(o,{UtilityNetworkLookupHelper:()=>y});var s=t(89379),r=t(6326),u=t(50076),n=t(49304),l=t(87663),i=t(91291),a=t(50346),d=t(67993),p=t(46053),c=(t(81806),t(76460),t(47249),t(87990)),v=t(31933);let y=class extends((0,n.WV)(i.Z)){constructor(e){super(e),this.layerIdToSourceIdLookup=new d.A,this.sourceIdToLayerIdLookup=new d.A,this.sourceIdToNetworkInfo=new d.A,this._rulesBySourceId=new Map,this._terminalConfigurationsBySourceId=new Map}async load(e){return this.addResolvingPromise(this._load(e)),this}agatFromRule(e,o){var t,s,r,u,n,l,i,a,d;let p;switch(o){case"to":p={networkSource:null!==(t=e.toNetworkSource)&&void 0!==t?t:null,assetGroup:null!==(s=e.toAssetGroup)&&void 0!==s?s:null,assetType:null!==(r=e.toAssetType)&&void 0!==r?r:null};break;case"from":p={networkSource:null!==(u=e.fromNetworkSource)&&void 0!==u?u:null,assetGroup:null!==(n=e.fromAssetGroup)&&void 0!==n?n:null,assetType:null!==(l=e.fromAssetType)&&void 0!==l?l:null};break;case"via":p={networkSource:null!==(i=e.viaNetworkSource)&&void 0!==i?i:null,assetGroup:null!==(a=e.viaAssetGroup)&&void 0!==a?a:null,assetType:null!==(d=e.viaAssetType)&&void 0!==d?d:null}}return null===p.networkSource?null:p}agatToFullDefinition(e){var o;let{assetGroup:t,assetType:s,networkSourceId:r}=e;if(null===r||null===t||null===s)return null;const u={networkSource:null,assetGroup:null,assetType:null},n=this.sourceIdToNetworkInfo.get(r);if(!n)return null;u.networkSource=n;const l=n.assetGroupLookup.get(t);return l?(u.assetGroup=l,u.assetType=null!==(o=l.assetTypeLookup.get(s))&&void 0!==o?o:null,null===u.assetType?null:u):null}findAgat(e,o){var t,s,r,n;const l=(0,v.Sv)(o)?o.parent:o;if(!l)throw new u.A("utility-network:missing-layer","Unable to find asset group/asset type for layer. The given layer is a `SubtypeSublayer` with no parent.");if(this.utilityNetwork.featureServiceUrl!==l.url)return null;const i=this.getNetworkSourceIdForLayer(l);if(null===i)return null;const a=null!==(t=null===(s=l.fieldsIndex.get("assettype"))||void 0===s?void 0:s.name)&&void 0!==t?t:"";if(""===a)return null;const d=null!==(r=null===(n=l.fieldsIndex.get("assetgroup"))||void 0===n?void 0:n.name)&&void 0!==r?r:"";if(""===d)return null;const p=e.attributes[a],c=e.attributes[d];return null==p||null==c?null:{assetGroup:c,assetType:p,networkSourceId:i}}findAgatFullDefinition(e,o){const t=this.findAgat(e,o);return t?this.agatToFullDefinition(t):null}findRules(e){var o;let{networkSourceId:t,assetGroup:s,assetType:r}=e;const u=[];if(null===t||null===s)return u;const n=null===(o=this._rulesBySourceId.get(t))||void 0===o?void 0:o.get(s);if(!n)return u;for(const l of n.generalRules)u.push(l);if(null!=r){const e=n.typeSpecificRules.get(r);if(e)for(const o of e)u.push(o)}return u}getNetworkSourceIdForLayer(e){var o;const t=(0,v.Sv)(e)?e.parent:e;return t&&this.utilityNetwork.featureServiceUrl===t.url&&null!==(o=this.layerIdToSourceIdLookup.get(t.layerId))&&void 0!==o?o:null}ruleMatchesAgat(e,o,t){var s,r,u;switch(t){case"to":return!((null===(s=e.toNetworkSource)||void 0===s?void 0:s.sourceId)!==o.networkSourceId||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==o.assetGroup||e.toAssetType&&e.toAssetType.assetTypeCode!==o.assetType);case"from":return!((null===(r=e.fromNetworkSource)||void 0===r?void 0:r.sourceId)!==o.networkSourceId||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==o.assetGroup||e.fromAssetType&&e.fromAssetType.assetTypeCode!==o.assetType);case"via":return!((null===(u=e.viaNetworkSource)||void 0===u?void 0:u.sourceId)!==o.networkSourceId||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==o.assetGroup||e.viaAssetType&&e.viaAssetType.assetTypeCode!==o.assetType)}}ruleMatchesFullDefinitionAgat(e,o,t){var s,r,u,n,l,i,a,d,p,c,v,y;switch(t){case"to":return!((null===(s=e.toNetworkSource)||void 0===s?void 0:s.sourceId)!==(null===(r=o.networkSource)||void 0===r?void 0:r.sourceId)||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==(null===(u=o.assetGroup)||void 0===u?void 0:u.assetGroupCode)||e.toAssetType&&e.toAssetType.assetTypeCode!==(null===(n=o.assetType)||void 0===n?void 0:n.assetTypeCode));case"from":return!((null===(l=e.fromNetworkSource)||void 0===l?void 0:l.sourceId)!==(null===(i=o.networkSource)||void 0===i?void 0:i.sourceId)||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==(null===(a=o.assetGroup)||void 0===a?void 0:a.assetGroupCode)||e.fromAssetType&&e.fromAssetType.assetTypeCode!==(null===(d=o.assetType)||void 0===d?void 0:d.assetTypeCode));case"via":return!((null===(p=e.viaNetworkSource)||void 0===p?void 0:p.sourceId)!==(null===(c=o.networkSource)||void 0===c?void 0:c.sourceId)||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==(null===(v=o.assetGroup)||void 0===v?void 0:v.assetGroupCode)||e.viaAssetType&&e.viaAssetType.assetTypeCode!==(null===(y=o.assetType)||void 0===y?void 0:y.assetTypeCode))}}terminalConfiguration(e,o,t){const s=this._terminalConfigurationsBySourceId.get(e);if(!s)return null;const r=s.get(o);if(!r)return null;return r.get(t)||null}async _load(e){await this.utilityNetwork.load(),(0,a.Te)(e);const{dataElement:o}=this.utilityNetwork;if(!o)throw new u.A("utility-network:no-data-element","No data element found on utility network");for(const u of o.domainNetworks)for(const e of[...null!==(t=u.edgeSources)&&void 0!==t?t:[],...null!==(r=u.junctionSources)&&void 0!==r?r:[]]){var t,r,n;this.layerIdToSourceIdLookup.set(e.layerId,e.sourceId),this.sourceIdToLayerIdLookup.set(e.sourceId,e.layerId);const o=(null!==(n=e.assetGroups)&&void 0!==n?n:[]).map(e=>{const o=new d.A;for(const s of null!==(t=e.assetTypes)&&void 0!==t?t:[]){var t;o.set(s.assetTypeCode,s)}return(0,s.A)((0,s.A)({},e),{},{assetTypeLookup:o})}),u=new d.A;for(const e of o)u.set(e.assetGroupCode,e);const l=(0,s.A)((0,s.A)({},e),{},{assetGroupLookup:u,assetGroups:o});this.sourceIdToNetworkInfo.set(l.sourceId,l)}const l=await this.utilityNetwork.getRulesTable();(0,a.Te)(e);for(const s of null!==(i=null===l||void 0===l?void 0:l.rules)&&void 0!==i?i:[]){var i;switch(s.ruleType){case 3:case 2:case 4:case 1:this._registerRule(s.fromNetworkSource.sourceId,s.fromAssetGroup.assetGroupCode,s.fromAssetType.assetTypeCode,s),this._registerRule(s.toNetworkSource.sourceId,s.toAssetGroup.assetGroupCode,s.toAssetType.assetTypeCode,s);break;case 5:this._registerRule(s.fromNetworkSource.sourceId,s.fromAssetGroup.assetGroupCode,s.fromAssetType.assetTypeCode,s),this._registerRule(s.toNetworkSource.sourceId,s.toAssetGroup.assetGroupCode,s.toAssetType.assetTypeCode,s),this._registerRule(s.viaNetworkSource.sourceId,s.viaAssetGroup.assetGroupCode,s.viaAssetType.assetTypeCode,s)}}this._makeTerminalConfigurationLookups(o)}_makeTerminalConfigurationLookups(e){const o={};for(const n of null!==(t=e.terminalConfigurations)&&void 0!==t?t:[]){var t;o[n.terminalConfigurationId]=n}for(const n of null!==(s=e.domainNetworks)&&void 0!==s?s:[]){var s;for(const e of n.junctionSources)if("esriUNFCUTJunctionObject"===e.utilityNetworkFeatureClassUsageType||"esriUNFCUTDevice"===e.utilityNetworkFeatureClassUsageType)for(const t of null!==(r=e.assetGroups)&&void 0!==r?r:[]){var r;for(const s of null!==(u=t.assetTypes)&&void 0!==u?u:[]){var u;if(null!=s.terminalConfigurationId&&s.terminalConfigurationId>=0){const r=o[s.terminalConfigurationId];if(r){const o=(0,l.tE)(this._terminalConfigurationsBySourceId,e.sourceId,()=>new Map);(0,l.tE)(o,t.assetGroupCode,()=>new Map).set(s.assetTypeCode,r)}}}}}}_registerRule(e,o,t,s){const r=(0,l.tE)(this._rulesBySourceId,e,()=>new Map),u=(0,l.tE)(r,o,()=>({generalRules:[],typeSpecificRules:new Map}));-1===t?u.generalRules.push(s):(0,l.tE)(u.typeSpecificRules,t,()=>[]).push(s)}};(0,r.Cg)([(0,p.MZ)()],y.prototype,"layerIdToSourceIdLookup",void 0),(0,r.Cg)([(0,p.MZ)()],y.prototype,"sourceIdToLayerIdLookup",void 0),(0,r.Cg)([(0,p.MZ)()],y.prototype,"sourceIdToNetworkInfo",void 0),(0,r.Cg)([(0,p.MZ)()],y.prototype,"utilityNetwork",void 0),y=(0,r.Cg)([(0,c.$)("esri.networks.support.UtilityNetworkLookupHelper")],y)}}]);
//# sourceMappingURL=40920.b3e905ba.chunk.js.map