(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[49],{487:function(e,t,a){},499:function(e,t){function a(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=499},504:function(e,t,a){},505:function(e,t,a){"use strict";a.r(t);var r=a(22),n=a.n(r),i=a(145),o=a.n(i),s=a(174),l=a.n(s),c=(a(487),a(23)),u=a(400),d=a.n(u),m=a(296),h=a(253),p=a(198),f=a(93),g=a(380);function w(e){var t=Object(r.useState)([{content:n.a.createElement("div",null,n.a.createElement("h1",null,"Draw and transcribe map data"),n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{alt:"Draw a shape representing a \r parcel of land and transcribe the ",src:"/ok-wpa-maps/img/wpa3.gif"}))),placement:"auto",target:".drawShapes",disableBeacon:!0},{content:n.a.createElement("div",null,n.a.createElement("h1",null,"Review existing entries"),n.a.createElement("h3",null,"If you don't see any errors, click",n.a.createElement("strong",null,n.a.createElement("calcite-icon",{scale:"s",icon:"check"}),"Looks Good!")),n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa7.gif"}))),placement:"auto",target:".reviewShapes",disableBeacon:!0},{content:n.a.createElement("div",null,n.a.createElement("h1",null,"Review existing entries"),n.a.createElement("h3",null,"If you see something incorrect or missing, click",n.a.createElement("strong",null,n.a.createElement("calcite-icon",{scale:"s",icon:"pencil"}),"Edit feature")),n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa8.gif"}))),placement:"auto",target:".reviewShapes",disableBeacon:!0},{content:n.a.createElement(n.a.Fragment,null,n.a.createElement("h3",null,"Right click and drag to change the rotation of the map."),n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{alt:"Demonstration of rotating the map",src:"/ok-wpa-maps/img/wpa4.gif"})),n.a.createElement("p",null," Press the compass button to reset")),placement:"center",target:"body",disableBeacon:!0},{content:n.a.createElement(n.a.Fragment,null,n.a.createElement("h3",null,"Keep track of your progress."),n.a.createElement("div",{className:"imgContainer"}),n.a.createElement("p",null,"Sign in with your ArcGIS Online account. Or, ",n.a.createElement("a",{href:"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id=l3OWRmRCGfkAN4Dh&redirect_uri=http://localhost:3000/ok-wpa-maps&response_type=code"},"create one")," for free.")),placement:"center",target:".trackProgress",disableBeacon:!0},{content:n.a.createElement("div",null,n.a.createElement("a",{href:"https://info.library.okstate.edu/map-room/wpa-maps"},n.a.createElement("h1",null,"Click to learn more about the collection"))),placement:"center",target:"body",disableBeacon:!0}]),a=Object(c.a)(t,2),i=a[0];a[1];return n.a.createElement(g.b,{callback:function(t){var a=t.status;t.type,[g.a.FINISHED,g.a.SKIPPED].includes(a)&&e.toggleIntro(!1)},continuous:!0,floaterProps:{disableAnimation:!0},run:e.runIntro,scrollToFirstStep:!0,showProgress:!0,showSkipButton:!0,steps:i,styles:{options:{zIndex:1e4,width:800}}})}var b,v=a(2),E=a(3),k=a(14),y=a(5),O=a(6),I=a(375),F=a(232),N=a(474),R=a(444),C=a(378),T=a(475),j=a(80),L=a(25),S={title:"Land Info",elements:[{type:"group",label:"Owner Information",elements:[{type:"field",fieldName:"OwnerLastName",id:"HITHEREIMTHEID",label:"Owner's Last Name (if an individual)"},{type:"field",fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{type:"field",fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"}]},{type:"group",label:"Land and Improvement Valuation",elements:[{type:"field",fieldName:"LandValue",label:"Land Value"},{type:"field",fieldName:"ImprovementsValue2",label:"Improvements Value"}]},{type:"field",fieldName:"TaxExempt",label:"Marked with an X?"}]},_={title:"Please doublecheck the info below.",content:[{type:"fields",fieldInfos:[{fieldName:"OwnerLastName",label:"Owner's Last Name (if an individual)"},{fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"},{fieldName:"LandValue",label:"Land Value"},{fieldName:"ImprovementsValue2",label:"Improvements Value"},{fieldName:"TaxExempt",label:"Marked with an X?"}]}],actions:[{title:"Looks good!",id:"this-looks-ok",className:"esri-icon-check-mark"},{title:"Edit feature",id:"edit-this",className:"esri-icon-edit"}]},A=["title","titleId"];function P(){return P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},P.apply(this,arguments)}function x(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function M(e,t){var a=e.title,n=e.titleId,i=x(e,A);return r.createElement("svg",P({className:"svg-loader",x:"0px",y:"0px",viewBox:"0 0 80 80",ref:t,"aria-labelledby":n},i),a?r.createElement("title",{id:n},a):null,b||(b=r.createElement("path",{id:"spinner",fill:"#Fe5c00",d:"M40,72C22.4,72,8,57.6,8,40C8,22.4,   22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2   s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,   28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z"})))}var W=r.forwardRef(M);a.p;function V(e){return Math.floor(Math.random()*Math.floor(e))}var D=function(e){Object(y.a)(a,e);var t=Object(O.a)(a);function a(e){var r;return Object(v.a)(this,a),(r=t.call(this,e)).featureTileUrl="https://tiles.arcgis.com/tiles/jWQlP64OuwDh6GGX/arcgis/rest/services/_wpa_all_6Aug2020/MapServer",r.featureVectorUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0",r.backgroundFeatureUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/ArcGIS/rest/services/Oklahoma_Public_Land_Survey_Sections/FeatureServer/0",r.reviewerTableUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Reviewers/FeatureServer/0",r.mapRef=n.a.createRef(),r.workflow=e.workflow,r.editThis=r.editThis.bind(Object(k.a)(r)),r.incrementReviewerCount=r.incrementReviewerCount.bind(Object(k.a)(r)),r.sayThanks=r.sayThanks.bind(Object(k.a)(r)),r.reviewWorkflow=r.reviewWorkflow.bind(Object(k.a)(r)),r.getRandomFeatureForReview=r.getRandomFeatureForReview.bind(Object(k.a)(r)),r.getRandomBackgroundFeature=r.getRandomBackgroundFeature.bind(Object(k.a)(r)),r.toggleLoadIndicator=r.toggleLoadIndicator.bind(Object(k.a)(r)),r.rotationChange=r.rotationChange.bind(Object(k.a)(r)),r.updateTimesChecked=r.updateTimesChecked.bind(Object(k.a)(r)),r.state={updateFeature:null,mapRotation:0,backgroundFeatureObjectIds:null,loadIndicator:!0},r}return Object(E.a)(a,[{key:"getRandomFeatureForReview",value:function(){var e=this,t=this,a=V(this.objectIds.length-1),r=this.featureVectorLayer.createQuery();r.where="OBJECTID = "+this.objectIds[a],this.featureVectorLayer.queryFeatures(r).then((function(a){t.view.goTo(a.features[0].geometry.extent),t.view.popup.features=a.features,t.view.popup.visible=!0,t.setState({updateFeature:a.features[0]}),e.view.whenLayerView(e.featureVectorLayer).then((function(e){t.highlightedFeature=e.highlight(a.features[0])}))}))}},{key:"getRandomBackgroundFeature",value:function(){var e,t=this,a=this.state.backgroundFeatureObjectIds,r=a[V(a.length)];this.backgroundFeatureLayer.definitionExpression="OBJECTID = "+r,this.backgroundFeatureLayer.when((function(){return t.backgroundFeatureLayer.queryExtent()})).then((function(a){e=a.extent;var r=t.featureVectorLayer.createQuery();return r.spatialRelationship="contains",r.distance=250,r.units="feet",r.returnCentroid=!0,r.returnGeometry=!1,r.geometry=a.extent,t.featureVectorLayer.queryFeatures(r)})).then((function(a){0===a.features.length?t.view.goTo(e):t.getRandomBackgroundFeature()}))}},{key:"reviewWorkflow",value:function(){var e=this;this.featureVectorLayer.queryObjectIds().then((function(t){e.objectIds=t,e.getRandomFeatureForReview()}))}},{key:"toggleLoadIndicator",value:function(e,t){this.setState({loadIndicator:e}),this.loadIndicatorWatch.remove()}},{key:"rotationChange",value:function(e,t,a){0===t&&0!==e&&this.view.ui.add(this.compass,"top-left"),0!==t&&0===e&&this.view.ui.remove(this.compass)}},{key:"componentDidUpdate",value:function(e,t,a){null===t.backgroundFeatureObjectIds&&null!==this.state.backgroundFeatureObjectIds&&this.getRandomBackgroundFeature()}},{key:"componentDidMount",value:function(){var e=this;this.graphic=j.a;var t=new R.default({url:this.featureTileUrl});this.map=new I.a({basemap:new F.default({baseLayers:[t]})}),this.backgroundFeatureLayer=new p.default({url:this.backgroundFeatureUrl}),this.view=new N.a({container:this.mapRef.current,map:this.map,highlightOptions:{color:"#fe5c00",fillOpacity:.1},popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1}}}),this.compass=new C.a({view:this.view}),this.loadIndicatorWatch=this.view.watch("updating",this.toggleLoadIndicator),this.view.watch("rotation",this.rotationChange);var a=document.createElement("div");a.className="esri-icon-refresh esri-widget--button esri-widget esri-interactive ",a.title="create"===this.workflow?"Go to another random location.":"Get another entry to review.",a.addEventListener("click",(function(){switch(e.workflow){case"create":e.getRandomBackgroundFeature();break;case"update":e.getRandomFeatureForReview();break;default:alert("moo")}})),this.view.ui.add(a,"bottom-left"),this.featureVectorLayer=new p.default({url:this.featureVectorUrl,popupTemplate:_,formTemplate:S,groupDisplay:"sequential"}),this.featureVectorLayer.on("edits",(function(t){if(t.updatedFeatures.length>0&&e.highlightedFeature&&(e.incrementReviewerCount(),e.sayThanks(),e.view.ui.remove(e.editor)),t.addedFeatures.length>0){var a=t.addedFeatures[0].objectId;e.featureVectorLayer.queryFeatures({objectIds:[a],outFields:["OBJECTID","CREATOR_PUBLIC"]}).then((function(t){t.features[0].setAttribute("CREATOR_PUBLIC",e.props.creds.userId);var a={updateFeatures:[t.features[0]]};e.featureVectorLayer.applyEdits(a)})),l.a.event("wpa_transcript_create",{category:"TRANSCRIPTION",action:"SUBMIT_NEW_RECORD"})}}));var r=this;this.editor=new T.a({view:this.view,allowedWorkflows:[this.workflow],snappingOptions:{enabled:!0,featureSources:[{layer:this.featureVectorLayer},{layer:this.backgroundFeatureLayer}]},layerInfos:[{view:this.view,layer:this.featureVectorLayer,allowAttachments:!1,deleteEnabled:!1}],supportingWidgetDefaults:{featureForm:{id:"featureFormKD"}}}),this.editor.postInitialize=function(){L.a(this,"messages",(function(e){e.widgetLabel="WPA Maps",e.addFeature="Draw a new shape",e.editFeature="Review an existing record"}))},this.editor.viewModel.sketchViewModel.on("create",(function(e){"complete"===e.state&&(e.graphic.attributes={TaxExempt:"No"})})),this.editor.viewModel.watch("syncing",(function(e,t,a,n){var i=document.getElementsByClassName("esri-editor__control-button");0!==i.length&&(r.toggleLoadIndicator(e,t),!0===e&&(i[0].disabled="disabled",i[0].classList.add("esri-button--disabled")),!1===e&&(i[0].removeAttribute("disabled"),i[0].classList.remove("esri-button--disabled")))})),this.view.popup.on("trigger-action",(function(e){"edit-this"===e.action.id&&r.editThis(),"this-looks-ok"===e.action.id&&r.updateTimesChecked()})),"create"===this.workflow&&(this.backgroundFeatureLayer.queryObjectIds().then((function(t){r.setState({backgroundFeatureObjectIds:t}),r.map.add(e.backgroundFeatureLayer)})),this.featureVectorLayer.popupEnabled=!1,this.view.ui.add(this.editor,"bottom-right")),"update"===this.workflow&&(this.reviewerTable=new p.default({url:this.reviewerTableUrl}),this.reviewWorkflow()),this.map.add(this.featureVectorLayer)}},{key:"updateTimesChecked",value:function(){var e=this.state.updateFeature,t=e.getAttribute("timesChecked");e.setAttribute("timesChecked",t+1);var a={updateFeatures:[e]};this.featureVectorLayer.applyEdits(a),this.highlightedFeature.remove()}},{key:"incrementReviewerCount",value:function(){var e=this;this.props.creds&&this.reviewerTable.queryFeatures({where:"userId = '"+this.props.creds.userId+"'",outFields:["OBJECTID","reviewCount"]}).then((function(t){t.features.length>0?(t.features[0].setAttribute("reviewCount",t.features[0].attributes.reviewCount+1),e.reviewerTable.applyEdits({updateFeatures:[t.features[0]]})):e.reviewerTable.applyEdits({addFeatures:[new e.graphic({attributes:{userId:e.props.creds.userId,reviewCount:1}})]})}))}},{key:"sayThanks",value:function(){var e=this;this.props.setModalContent(n.a.createElement("div",null,n.a.createElement("h1",null,"Thank you!"),n.a.createElement("p",null,"Here's another entry to check."))),this.props.openModal(),setTimeout((function(){e.props.closeModal()}),2e3),this.toggleLoadIndicator(!1),this.highlightedFeature.remove(),this.getRandomFeatureForReview(),this.view.popup.close()}},{key:"editThis",value:function(){var e=this.view,t=this.editor;e.when((function(){t.viewModel.activeWorkFlow||(e.popup.visible=!1,t.startUpdateWorkflowAtFeatureEdit(e.popup.selectedFeature),e.ui.add(t,"bottom-right"),e.popup.spinnerEnabled=!1),setTimeout((function(){var a=t.domNode.getElementsByClassName("esri-editor__back-button esri-interactive");1===a.length&&(a[0].setAttribute("title","Cancel edits, return to popup"),a[0].addEventListener("click",(function(a){a.preventDefault(),e.ui.remove(t)})))}),150)}))}},{key:"componentWillUnmount",value:function(){this.view&&(this.view.container=null)}},{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,this.state.loadIndicator&&n.a.createElement("div",{className:"loadIndicator"},n.a.createElement(W,null)),n.a.createElement("div",{className:"webmap",ref:this.mapRef}))}}]),a}(n.a.Component),B=(a(503),a(504),"l3OWRmRCGfkAN4Dh"),G=window.location.protocol+"//"+window.location.host+window.location.pathname;var U={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}};var q=function(){var e=Object(r.useState)(!0),t=Object(c.a)(e,2),a=t[0],i=t[1],o=Object(r.useState)(!1),s=Object(c.a)(o,2),u=s[0],g=s[1],b=Object(r.useState)(0),v=Object(c.a)(b,2),E=v[0],k=v[1],y=Object(r.useState)(""),O=Object(c.a)(y,2),I=O[0],F=O[1],N=Object(r.useState)(!1),R=Object(c.a)(N,2),C=R[0],T=R[1],j=Object(r.useState)(!1),L=Object(c.a)(j,2),S=L[0],_=L[1],A=Object(r.useState)(!1),P=Object(c.a)(A,2),x=P[0],M=P[1],W=Object(r.useState)(!1),V=Object(c.a)(W,2),q=V[0],Q=V[1],z=Object(r.useState)(!1),J=Object(c.a)(z,2),K=J[0],X=J[1],H=["Good job!","Way to go!","Wow!","That's super!","Awesome!","Alright!"],$=Object(r.useState)(H[Math.floor(Math.random()*Math.floor(H.length))]),Y=Object(c.a)($,2),Z=Y[0],ee=(Y[1],"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id="+B+"&redirect_uri="+G+"&response_type=token");function te(){g(!1)}return d.a.setAppElement("#root"),Object(r.useEffect)((function(){var e=new m.a({appId:"l3OWRmRCGfkAN4Dh",popup:!1});X(e),h.default.registerOAuthInfos([e]);var t=function(e){for(var t={},a=(e=e||window.location.href).slice(e.indexOf("#")+1).split("&"),r=0;r<a.length;r++){var n=a[r].split("=");n.length>1?t[n[0]]=n[1]:t[n[0]]=null}return t}();if("access_token"in t){var a=t.access_token,r=t.username,n=t.expires_in;h.default.registerToken({token:a,userId:r,expires:n,server:"https://www.arcgis.com/sharing/rest"}),h.default.getCredential(e.portalUrl+"/sharing")}h.default.checkSignInStatus(e.portalUrl+"/sharing").then((function(t){M(t);new f.a(e.portalUrl).load().then((function(e){Q(e.user.fullName)}));var a=new p.default({url:"https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0"}),r=a.createQuery();r.where="CREATOR_PUBLIC = '"+t.userId+"'",r.outStatistics=[{onStatisticField:"CREATOR_PUBLIC",outStatisticFieldName:"CREATOR_COUNT",statisticType:"count"}],a.queryFeatures(r).then((function(e){e.features.length>0&&_(e.features[0].getAttribute("CREATOR_COUNT"))}))})).catch((function(){}))}),[]),n.a.createElement("div",{className:"App"},n.a.createElement(w,{runIntro:C,toggleIntro:T,oauthInfo:K}),n.a.createElement(d.a,{isOpen:u,onAfterOpen:function(){},onRequestClose:te,style:U,contentLabel:"Modal"},I),!0===a&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h1",null,"Oklahoma 1936 Land Ownership Map Transcription"),n.a.createElement("div",{className:"flex-row"},n.a.createElement("button",{tabIndex:"0",className:"drawShapes",onClick:function(){l.a.event("wpa_transcript_create",{category:"TRANSCRIPTION",action:"INITIATE_CREATE_WORKFLOW"}),i(!1),k("create")}},n.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"addInNew"}),n.a.createElement("br",null),"Draw some shapes"),n.a.createElement("button",{tabIndex:"0",className:"reviewShapes",onClick:function(){l.a.event("wpa_transcript_create",{category:"TRANSCRIPTION",action:"INITIATE_REVIEW_WORKFLOW"}),i(!1),k("update")}},n.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"editAttributes"}),n.a.createElement("br",null),"Review existing shapes"),n.a.createElement("button",{tabIndex:"0",onClick:function(){l.a.event("tutorial_begin",{category:"INTRO",action:"INTRO_TOGGLE"}),T(!C)}},n.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"question"}),n.a.createElement("br",null),"View the intro")),!1===q&&n.a.createElement("div",{className:"trackProgress"},n.a.createElement("h2",null,"Track your progress:"),n.a.createElement("div",{className:"flex-row"},n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("button",{tabIndex:"0",className:"signInOut",onClick:function(){l.a.event("login",{category:"TRANSCRIPTION",action:"login"}),h.default.getCredential(K.portalUrl+"/sharing").then((function(e){M(e)}))}},n.a.createElement("calcite-icon",{scale:"l",className:"big-icon",icon:"sign-in"}),n.a.createElement("br",null)," Sign in"),n.a.createElement("a",{tabIndex:"0",href:ee},n.a.createElement("button",{onClick:function(){l.a.event("sign_up",{category:"SIGN_UP",action:"SIGN_UP"})},className:"createAccount"},n.a.createElement("calcite-icon",{scale:"l",className:"big-icon",icon:"user-plus"}),n.a.createElement("br",null)," Create an account")))),!1!==q&&!1!==S&&n.a.createElement("div",{className:"flex-row"},n.a.createElement("h3",null,"Hi ",q,"! So far you've added",n.a.createElement("span",{style:{fontSize:"2em"}},"\xa0",S,"\xa0"),1===S?"shape":"shapes",". ",S>0?Z:""),n.a.createElement("br",null),n.a.createElement("button",{className:"signInOut",onClick:function(){x.destroy(),window.location=window.location.pathname}},n.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"sign-out"})," ",n.a.createElement("br",null)," Click to sign out"))),!1===a&&n.a.createElement(D,{workflow:E,creds:x,openModal:function(){g(!0)},closeModal:te,setModalContent:F}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.initialize("G-EQMR17KKJG"),l.a.send("pageview"),o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[505,50,51]]]);
//# sourceMappingURL=main.528f7f43.chunk.js.map