(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[52,60,113,183],{1120:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Al}));var i=r(4),n=r.n(i),a=r(9),o=r(2),s=r(3),c=r(41),l=r(38),u=r(5),d=r(6),h=r(0),f=r(7),p=r(25),v=r(1),b=r(12),m=(r(15),r(11)),g=r(8),y=r(399),O=r(29),j=r(68),x=r(161),_=r(13),S=r(215),w=r(65),C=r(100),k=r(547),P=r(58),E=r(79),T=r(384),A=r(304),R=r(139),D=r(663),M=r(597),I=r(579),L=r(60);function z(e,t,r,i){return U(e,t,r,V(i,t,r,!0))}var F={dir:Object(E.e)(),len:0,clip:Object(L.a)()};function V(e,t,r,i){var n=F;return e?(r&&i&&(n.len=Object(P.m)(t,r)),Object(P.k)(n.dir,e)):i?(n.len=Object(P.m)(t,r),Object(P.j)(n.dir,r,t),Object(P.e)(n.dir,n.dir,1/n.len)):(Object(P.j)(n.dir,r,t),Object(P.r)(n.dir,n.dir)),n}function G(e,t,r){var i=Object(P.h)(Object(M.q)(e),r.dir),n=-Object(M.t)(e,t);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;var a=n/i;return i>0?a<r.clip[1]&&(r.clip[1]=a):a>r.clip[0]&&(r.clip[0]=a),r.clip[0]<=r.clip[1]}function U(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(var n=0;n<e.length;n++)if(!G(e[n],t,i))return!1;return!0}var B=.5*Math.PI,N=B/Math.PI*180,H=function(){function e(t){Object(o.a)(this,e),this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Object(E.e)(),direction:Object(E.e)()};for(var r=0;r<4;r++)this.extent[r]={origin:Object(E.e)(),direction:Object(E.e)(),cap:{next:null,direction:Object(E.e)()}},this.planes[r]=Object(M.d)();this.planes[4]=Object(M.d)(),this.planes[5]=Object(M.d)(),this.planesWithoutFar=this.planes.slice(0,5)}return Object(s.a)(e,[{key:"update",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this.extent;this.toRenderBoundingExtent(e,t,r),Object(P.f)(this.center.origin,n[0].origin,n[2].origin),Object(P.e)(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),i||Object(P.e)(this.center.direction,this.center.direction,-1);for(var a=0;a<4;a++){var o=n[a];this.renderCoordsHelper.worldUpAtPosition(o.origin,o.direction);var s=n[3===a?0:a+1];o.cap.next=s.origin,Object(P.v)(o.cap.direction,o.origin,s.origin),Object(M.i)(o.direction,o.cap.direction,o.origin,this.planes[a]),i||Object(P.e)(o.direction,o.direction,-1)}Object(M.i)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[4]),i?Object(M.p)(this.planes[4],this.planes[5]):(Object(M.c)(this.planes[4],this.planes[5]),Object(M.p)(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*Object(x.e)(this.maxSpanSpatialReference).radius}},{key:"isVisibleInFrustum",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return!1;if(1===this.renderCoordsHelper.viewingMode){var i=this.maxSpanSpatialReference.isGeographic?N:B*t;if(this.maxSpan>i)return!0;if(e.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){var n=this.extent[0];return!(r||!e.intersectsRay(Object(I.g)(n.origin,n.direction)))}for(var a=0;a<this.extent.length;a++){var o=this.extent[a];if(!r&&e.intersectsRay(Object(I.g)(o.origin,o.direction)))return!0;if(e.intersectsLineSegment(Object(D.f)(o.origin,o.cap.next,J),o.cap.direction))return!0}for(var s=r?this.planes:this.planesWithoutFar,c=0;c<e.lines.length;c++){var l=e.lines[c];if(z(s,l.origin,l.endpoint,l.direction))return!0}return!1}},{key:"toRenderBoundingExtentGlobal",value:function(e,t,r){Object(R.d)(e,W),W[2]=r,Object(T.c)(t,W,Y,this.renderCoordsHelper.spatialReference),Object(C.c)(Z,Y),Object(A.h)(X);var i,n=Object(_.a)(q);try{for(n.s();!(i=n.n()).done;)for(var a=i.value,o=a.x0,s=a.x1,c=a.y0,l=a.y1,u=0;u<5;u++){var d=u/4;W[0]=Object(w.j)(e[o],e[s],d),W[1]=Object(w.j)(e[c],e[l],d),W[2]=r,Object(T.r)(W,t,W,this.renderCoordsHelper.spatialReference),Object(P.q)(W,W,Z),Object(A.n)(X,W)}}catch(f){n.e(f)}finally{n.f()}Object(P.w)(this.extent[0].origin,X[0],X[1],X[2]),Object(P.w)(this.extent[1].origin,X[3],X[1],X[2]),Object(P.w)(this.extent[2].origin,X[3],X[4],X[2]),Object(P.w)(this.extent[3].origin,X[0],X[4],X[2]);for(var h=0;h<4;++h)Object(P.q)(this.extent[h].origin,this.extent[h].origin,Y)}},{key:"toRenderBoundingExtentLocal",value:function(e,t,r){Object(T.k)(e,t,Q,this.renderCoordsHelper.spatialReference),Object(P.w)(this.extent[0].origin,Q[0],Q[1],r),Object(P.w)(this.extent[1].origin,Q[2],Q[1],r),Object(P.w)(this.extent[2].origin,Q[2],Q[3],r),Object(P.w)(this.extent[3].origin,Q[0],Q[3],r)}},{key:"toRenderBoundingExtent",value:function(e,t,r){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(e,t,r);break;case 2:this.toRenderBoundingExtentLocal(e,t,r);break;default:Object(S.a)(this.renderCoordsHelper.viewingMode)}}},{key:"isVisibleInFrustumGlobal",value:function(e){if(Object(P.h)(this.center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this.extent[t];if(Object(P.h)(r.direction,e.direction)<0)return!0}return!1}}]),e}(),q=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],W=Object(E.e)(),Y=Object(k.d)(),Z=Object(k.d)(),X=Object(A.f)(),Q=Object(R.l)(),J=Object(D.d)(),K=r(680),$=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).suspended=!1,e.extent=null,e.extentIntersectionDirty=!0,e._isVisibleBelowSurface=!1,e.handles=new j.a,e.layerView=null,e.updating=!0,e}return Object(s.a)(r,[{key:"setup",value:function(e){var t=this;this.layerView=e,this.extentIntersection=new H({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",(function(){return t.viewChange()})),r.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(K.b.FRUSTUM_VISIBILITY,this),i.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(p.a)(i,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),Object(p.a)(r,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])}},{key:"destroy",value:function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}},{key:"viewChange",value:function(){this._setDirty()}},{key:"elevationBoundsChange",value:function(){this._setDirty(),this.extentIntersectionDirty=!0}},{key:"isVisibleBelowSurface",set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}},{key:"updateIsVisibleBelowSurface",value:function(){var e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.opaque||i}},{key:"updateExtentIntersection",value:function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=-.3*Object(x.e)(t.spatialReference).radius;else{var r=t.basemapTerrain.elevationBounds,i=r.min,n=r.max;e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum,t=Object(x.e)(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}else this._set("suspended",!1)}}]),r}(O.a);Object(h.a)([Object(v.b)({readOnly:!0})],$.prototype,"suspended",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],$.prototype,"updating",void 0);var ee=$=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],$),te=r(10),re=r(80),ie=r(31),ne=r(21),ae=r(313),oe=r(176),se=r(726),ce=r(87),le=r(824),ue=r(26),de=r(23),he=r(14),fe=(r(76),r(282),r(308),r(314),r(315),r(114),r(259),r(257)),pe=(r(283),r(56),r(18)),ve=r(182),be=r(212),me=r(88),ge=r(612),ye=r(333);function Oe(e){return Object(f.j)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type}function je(e){if(Object(f.j)(e))return null;if(!Oe(e))return new pe.a("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return xe(t=e,Object(ye.a)(t.symbol).error);case"unique-value":return function(e){var t=e.uniqueValueInfos.map((function(e){return Object(ye.a)(e.symbol).error})).filter((function(e){return!!e})),r=Object(ye.a)(e.defaultSymbol);return r.error&&t.unshift(r.error),xe(e,t)}(e);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return Object(ye.a)(e.symbol).error})).filter((function(e){return!!e})),r=Object(ye.a)(e.defaultSymbol);return r.error&&t.unshift(r.error),xe(e,t)}(e);case"dictionary":return null}var t;return null}function xe(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var i=r.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));i.sort();var n=[];return i.forEach((function(e,t){0!==t&&e===i[t-1]||n.push(e)})),new pe.a("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(n.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:r})}return null}var _e=r(111),Se=r(184),we=r(202),Ce=r(242),ke=r(153),Pe=r(169),Ee=r(408),Te=r(217),Ae=ke.a.fromSimpleMarkerSymbol(Ee.a),Re=we.a.fromSimpleLineSymbol(Ee.c),De=Pe.a.fromSimpleFillSymbol(Ee.b),Me=new Ce.a({symbolLayers:[new Se.a({material:{color:Te.a},edges:{type:"solid",size:"1px",color:Te.b}})]});function Ie(e){if(Object(f.j)(e))return null;switch(e.type){case"mesh":return Me;case"point":case"multipoint":return Ae;case"polyline":return Re;case"polygon":case"extent":return De}return null}var Le=r(102),ze=(r(196),function(){function e(t,r){Object(o.a)(this,e),this.spatialReference=t,this.view=r}return Object(s.a)(e,[{key:"getElevation",value:function(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}},{key:"queryElevation",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i,a,o){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.view.elevationProvider.queryElevation(t,r,0,this.spatialReference,o,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()}]),e}()),Fe=r(746),Ve=r(67),Ge=r(179),Ue=r(131),Be=r(685),Ne=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).events=new Ve.a,i.hasZ=null,i.hasM=null,i.objectIdField=null,i.spatialReference=null,i.featureAdapter={getAttribute:function(e,t){return"graphic"in e?e.graphic.attributes[t]:Be.a.getAttribute(e,t)},getAttributes:function(e){return"graphic"in e?e.graphic.attributes:Be.a.getAttributes(e)},getObjectId:function(e){return"graphic"in e?Object(ge.e)(e.graphic,i.objectIdField):Be.a.getObjectId(e)},getGeometry:function(e){return"graphic"in e?e.getAsOptimizedGeometry(i.hasZ,i.hasM):Be.a.getGeometry(e)},getCentroid:function(e,t){if("graphic"in e){var r=null;Object(f.k)(e.centroid)?r=e.centroid:"point"===e.graphic.geometry.type&&Object(T.n)(e.graphic.geometry,He,i.spatialReference)&&(r=He);var n=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return Object(f.j)(r)?(n[0]=0,n[1]=0,n[2]=0,n[3]=0):(n[0]=r.x,n[1]=r.y,t.hasZ&&(n[2]=r.hasZ?r.z:0),t.hasM&&(n[t.hasZ?3:2]=r.hasM?r.m:0)),new Ue.a([],n)}return Be.a.getCentroid(e,t)},cloneWithGeometry:function(e,t){return"graphic"in e?new Ge.b(t,i.featureAdapter.getAttributes(e),null,i.featureAdapter.getObjectId(e)):Be.a.cloneWithGeometry(e,t)}},i}return Object(s.a)(r,[{key:"forEach",value:function(e){this.forAllGraphics((function(t){e(t)}))}},{key:"forEachInBounds",value:function(e,t){this.getSpatialIndex().forEachInBounds(e,t)}},{key:"forEachBounds",value:function(e,t,r){var i,n=this.getSpatialIndex(),a=Object(_.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=this.featureAdapter.getObjectId(o);Object(f.k)(n.getBounds(s,r))&&t(r)}}catch(c){a.e(c)}finally{a.f()}}}]),r}(O.a);Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"getSpatialIndex",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"forAllGraphics",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"hasZ",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"hasM",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"objectIdField",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Ne.prototype,"spatialReference",void 0),Ne=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],Ne);var He={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null},qe=Ne,We=function e(t,r,i){Object(o.a)(this,e),this.graphic=t,this.renderingInfo=r,this.layer=i},Ye=function e(t){Object(o.a)(this,e),this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.isAsync=!1},Ze=r(163),Xe=r(227),Qe=r(40),Je=r(35),Ke=r(626),$e=r(627),et=r(687),tt=r(765);function rt(e,t,r,i){for(var n=e.stageObject,a=r.spatialReference,o=n.geometryRecords,s=o.length,c="absolute-height"!==t.mode,l=0,u=0;u<s;u++){var d=o[u].geometry,h=o[u].getShaderTransformation();ct[0]=h[12],ct[1]=h[13],ct[2]=h[14],d.invalidateBoundingInfo();for(var f=d.getMutableAttribute("position"),p=f.data,v=d.vertexAttributes.get("mapPos").data,b=f.size,m=p.length/b,g=new tt.a(v,a),y=0,O=!1,j=0,x=0;x<m;x++){lt[0]=p[y],lt[1]=p[y+1],lt[2]=p[y+2];var _=Object(Ke.e)(g,r,t,i,c?ht:null);if(c&&(j+=ht.sampledElevation),et.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(p[y]=g.array[g.offset],p[y+1]=g.array[g.offset+1],p[y+2]=_,Object(T.l)(p,a,y,p,i.spatialReference,y,1),p[y]-=ct[0],p[y+1]-=ct[1],p[y+2]-=ct[2]):(st[0]=p[y]+ct[0],st[1]=p[y+1]+ct[1],st[2]=p[y+2]+ct[2],i.setAltitude(st,_),p[y]=st[0]-ct[0],p[y+1]=st[1]-ct[1],p[y+2]=st[2]-ct[2]),et.a.TESTS_DISABLE_UPDATE_THRESHOLDS)O=!0;else{var S=ot/i.unitInMeters;(Math.abs(lt[0]-p[y])>=S||Math.abs(lt[1]-p[y+1])>=S||Math.abs(lt[2]-p[y+2])>=S)&&(O=!0)}y+=b,g.offset+=3}l+=j/m,O&&n.geometryVertexAttrsUpdated(u)}return l/s}function it(e,t,r,i){var n=e.stageObject,a=t.centerPointInElevationSR,o=0,s=0;if(n.metadata.usesVerticalDistanceToGround)o=Object(Ke.e)(a,r,t,i,ht),Object($e.i)(n,ht.verticalDistanceToGround),s=ht.sampledElevation;else{var c="absolute-height"!==t.mode;o=Object(Ke.e)(a,r,t,i,c?ht:null),c&&(s=ht.sampledElevation)}var l=Object(C.f)(nt,n.transformation),u=Object(P.w)(dt,l[12],l[13],l[14]);et.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(st[0]=a.x,st[1]=a.y,st[2]=o,Object(T.c)(a.spatialReference,st,l,i.spatialReference)&&(n.transformation=l)):i.setAltitudeOfTransformation(o,l);var d=ot/i.unitInMeters;return(Math.abs(l[12]-u[0])>=d||Math.abs(l[13]-u[1])>=d||Math.abs(l[14]-u[2])>=d)&&(n.transformation=l),s}var nt=Object(k.d)();function at(e,t,r,i){var n=e.graphics3DSymbolLayer.lodRenderer;if(Object(f.j)(n))return 0;var a,o=t.centerPointInElevationSR,s=0,c="absolute-height"!==t.mode;a=Object(Ke.e)(o,r,t,i,c?ht:null),c&&(s=ht.sampledElevation);var l=n.instanceData,u=e.instanceIndex,d=ut;l.getGlobalTransform(u,d);var h=Object(P.w)(dt,d[12],d[13],d[14]);et.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(st[0]=o.x,st[1]=o.y,st[2]=a,Object(T.c)(o.spatialReference,st,d,i.spatialReference)&&l.setGlobalTransform(u,d)):i.setAltitudeOfTransformation(a,d);var p=ot/i.unitInMeters;return(et.a.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(d[12]-h[0])>=p||Math.abs(d[13]-h[1])>=p||Math.abs(d[14]-h[2])>=p)&&l.setGlobalTransform(u,d),s}var ot=.01,st=Object(E.e)(),ct=Object(E.e)(),lt=Object(E.e)(),ut=Object(k.d)(),dt=Object(E.e)(),ht={verticalDistanceToGround:0,sampledElevation:0},ft=r(656),pt=r(678),vt=function(){function e(t,r,i,n,a,s,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Object(o.a)(this,e),this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._uniqueTextures=a,this.elevationAligner=s,this.elevationContext=c,this._edgeState=l,this.type="object3d",this.stageLayer=null,this.stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=r}return Object(s.a)(e,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"initialize",value:function(e,t){this.stageLayer=t,this.stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.addMany(this._uniqueTextures),e.add(this.stageObject)}},{key:"destroy",value:function(){var e=this.stage;this.stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.removeMany(this._uniqueTextures)),e.remove(this.stageObject),this._addedToStage&&(this.stageLayer.remove(this.stageObject),this._addedToStage=!1);var t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this.stageLayer=null,this.stage=null}},{key:"layerOpacityChanged",value:function(e,t){if(!Object(f.j)(this._edgeState)){var r,i=bt(this._edgeState.baseMaterial),n=!1,a=Object(_.a)(this._edgeState.edgeMaterials);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.objectTransparency!==i&&(o.objectTransparency=i,n=!0)}}catch(s){a.e(s)}finally{a.f()}n&&this.resetEdgeObject(t),this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}}},{key:"slicePlaneEnabledChanged",value:function(e,t){Object(f.j)(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:e},!t),this._edgeState.properties.slicePlaneEnabled=e)}},{key:"setVisibility",value:function(e){if(null!=this.stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),Object(f.k)(this._edgeState))){var t=this.stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this.addOrUpdateEdgeObject(t,!1)}}},{key:"visible",get:function(){return this._visible}},{key:"alignWithElevation",value:function(e,t,r,i){if(null!=this.elevationAligner){Object(f.k)(r)&&Object(Fe.f)(this.elevationContext.featureExpressionInfoContext,r);var n=this.elevationAligner(this,this.elevationContext,e,t);null!=n&&(this.alignedSampledElevation=n),this.resetEdgeObject(i)}}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(E.e)();return Object(P.k)(e,Object(pt.c)(this.stageObject.boundingVolumeObjectSpace.bounds))}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(A.f)(),t=this.stageObject.boundingVolumeObjectSpace;return Object(A.y)(e,t.min),Object(A.x)(e,t.max),e}},{key:"computeAttachmentOrigin",value:function(e){if(this.useObjectOriginAsAttachmentOrigin){var t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else{var r,i=Object(_.a)(this.stageObject.geometryRecords);try{for(i.s();!(r=i.n()).done;){r.value.computeAttachmentOrigin(yt)&&(Object(P.q)(yt,yt,this.stageObject.transformation),Object(P.f)(e.render.origin,e.render.origin,yt),e.render.num++)}}catch(n){i.e(n)}finally{i.f()}}}},{key:"getProjectedBoundingBox",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i,a,o){var s,c,l,u,d,h,p,v,b,m,g;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),c=Ot,l=Object(A.s)(s)?1:c.length,u=0;u<l;u++)d=c[u],gt[0]=s[d[0]],gt[1]=s[d[1]],gt[2]=s[d[2]],Object(P.q)(gt,gt,this.stageObject.transformation),mt[3*u+0]=gt[0],mt[3*u+1]=gt[1],mt[3*u+2]=gt[2];if(t(mt,0,l)){e.next=4;break}return e.abrupt("return",null);case 4:for(Object(A.h)(s),h=null,this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds()),p=0;p<3*l;p+=3){for(v=0;v<3;v++)s[v]=Math.min(s[v],mt[p+v]),s[v+3]=Math.max(s[v+3],mt[p+v]);h&&i.push({location:mt.slice(p,p+3),screenSpaceBoundingRect:h})}if(!r||!r.service||"absolute-height"===this.elevationContext.mode){e.next=28;break}if(Object(A.d)(s,yt),b="relative-to-scene"===this.elevationContext.mode?"scene":"ground",m=0,!r.useViewElevation){e.next=16;break}m=Object(f.t)(r.service.getElevation(yt[0],yt[1],b),0),e.next=27;break;case 16:return e.prev=16,g=Object($e.d)(s,r),e.t0=f.t,e.next=21,r.service.queryElevation(yt[0],yt[1],a,g,b);case 21:e.t1=e.sent,m=(0,e.t0)(e.t1,0),e.next=27;break;case 25:e.prev=25,e.t2=e.catch(16);case 27:Object(A.u)(s,0,0,-this.alignedSampledElevation+m);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}},{key:"removeObjectState",value:function(e){e.removeObject(this.stageObject)}},{key:"resetEdgeObject",value:function(e){if(!Object(f.j)(this._edgeState)){var t=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}}},{key:"addOrUpdateEdgeObject",value:function(e,t){var r=this,i=this._edgeState;if(!Object(f.j)(i)){var n,a=bt(i.baseMaterial),o=Object(_.a)(i.edgeMaterials);try{for(o.s();!(n=o.n()).done;){n.value.objectTransparency=a}}catch(s){o.e(s)}finally{o.f()}e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!t).then((function(){var e;return null==(e=r.stageLayer)?void 0:e.sync()}))}}}]),e}();function bt(e){return e.isVisible?e.params.transparent?1:2:0}var mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],gt=Object(E.e)(),yt=Object(E.e)(),Ot=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],jt=r(558),xt=function(){function e(t){Object(o.a)(this,e),this.schedule=t,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}return Object(s.a)(e,[{key:"loadStatus",get:function(){return this._loadStatus}},{key:"load",value:function(e,t){var r=this;return 1===this._loadStatus?(e&&e(),this._loader):2===this._loadStatus?(t&&t(this._loadError),this._loader):(this._loader||(this._abortController=Object(ne.d)(),this._loader=this.doLoad(this._abortController.signal).then((function(){r._abortController=null,r._loadStatus=1}),(function(e){throw r._loadError=e,r._abortController=null,r._loadStatus=2,!Object(ne.m)(e)&&r.logger&&e.message&&r.logger.warn(e.message),e}))),this._loader.then(e,t).catch((function(){})),this._loader)}},{key:"abortLoad",value:function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2),this._loader=null}}]),e}(),_t=r(430),St=r(646);function wt(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Ct(e,t){var r=function(e,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{levels:e.map((function(e){var n=r(e.tesselation);return i&&St.a.cgToGIS(n),{components:[{geometry:n,material:t}],faceCount:n.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}}))}};switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(function(e){return St.a.createPolySphereGeometry(.5,e,!0)}));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return St.a.createBoxGeometry(1)}));case"cone":return r(kt,(function(e){return St.a.createConeGeometry(1,.5,e,!1)}),!0);case"inverted-cone":return r(kt,(function(e){return St.a.createConeGeometry(1,.5,e,!0)}),!0);case"cylinder":return r(kt,(function(e){return St.a.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])}));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return St.a.createTetrahedronGeometry(1)}),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return St.a.createDiamondGeometry(1)}),!0);default:return}}var kt=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Pt(e,t){return function(e,t){if(Object(f.j)(e))return null;var r=Object(f.k)(e.color)?Object(jt.d)(Qe.a.toUnitRGBA(e.color)):Object(jt.g)(0,0,0,0),i=Object(Je.g)(e.size),n=Object(Je.g)(e.extensionLength);switch(e.type){case"solid":return function(e){return Object(te.a)(Object(te.a)(Object(te.a)({},Et),e),{},{type:"solid"})}(Object(te.a)({color:r,size:i,extensionLength:n},t));case"sketch":return function(e){return Object(te.a)(Object(te.a)(Object(te.a)({},Tt),e),{},{type:"sketch"})}(Object(te.a)({color:r,size:i,extensionLength:n},t));default:return}}(function(e){return e&&e.enabled&&e.edges||null}(e),t)}var Et={color:Object(jt.g)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},Tt={color:Object(jt.g)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2};function At(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){t.push(e.material)}))})),Object(Le.l)(t)}function Rt(e){var t=[];return e.components.forEach((function(e){t.push(e.geometry)})),Object(Le.l)(t)}function Dt(e){return Rt(e).reduce((function(e,t){return e+t.indexCount/3}),0)}var Mt={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function It(e){var t,r=0,i=0,n=0,a=!1,o=0,s={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},c=Object(_.a)(e);try{for(c.s();!(t=c.n()).done;){var l=t.value;Object(f.j)(l)||(r+=l.primitivesPerFeature,i+=l.primitivesPerCoordinate,n+=l.drawCallsPerFeature,s.bytesPerFeature+=l.memory.bytesPerFeature,s.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,s.bytesPerCoordinate+=l.memory.bytesPerCoordinate,s.draped.bytesPerFeature+=l.memory.bytesPerFeature,s.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,s.draped.bytesPerCoordinate+=l.memory.bytesPerCoordinate,a=a||l.estimated,++o)}}catch(u){c.e(u)}finally{c.f()}return{primitivesPerFeature:r,primitivesPerCoordinate:i,drawCallsPerFeature:n,estimated:a,memory:s,numComplexities:o}}var Lt={};function zt(e,t){var r=Ft(e,t),i=function(e){return e&&e.enabled&&("extrude"===e.type||(t=e,"fill"===t.type))&&Object(f.k)(e.edges);var t}(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:Object(f.k)(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:Object(te.a)(Object(te.a)({},function(e){var t=Lt[e];if(t)return t;var r=Ct(e,null);return t={primitivesPerFeature:Rt(r.levels[0]).reduce((function(e,t){return e+t.indices.get("position").length/3}),0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Lt[e]=t,t}(t.resource&&t.resource.primitive||_t.b)),{},{memory:r});case"path":var n=0,a=0;switch(t.profile){case"circle":n=10;break;case"quad":n=4;break;default:return void Object(S.a)(t.profile)}switch(t.join){case"round":a=3;break;case"miter":case"bevel":a=1;break;default:return}var o=2*n,s=n*a*2,c=-2*s-o;switch(t.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(2*n*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:s+o,drawCallsPerFeature:0,estimated:!1,memory:r};case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function Ft(e,t){var r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Vt.EXTRUDE_EDGES:Vt.EXTRUDE;case"fill":return Object(f.k)(t.outline)&&t.outline.size>0?Vt.FILL_OUTLINE:Vt.FILL;case"water":return Vt.FILL;case"line":return"round"===t.join?Vt.LINE_ROUND:Vt.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Vt.PATH_ROUND_CIRCLE;case"quad":return Vt.PATH_ROUND_QUAD;default:return void Object(S.a)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return Vt.PATH_MITER_CIRCLE;case"quad":return Vt.PATH_MITER_QUAD;default:return void Object(S.a)(t.profile)}default:return}case"object":return r?Vt.OBJECT_POINT:Vt.OBJECT_POLYGON;case"icon":case"text":return r?Vt.ICON_POINT:Vt.ICON_POLYGON;default:return}}var Vt={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},Gt=m.a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),Ut=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,n.schedule))._context=n,s._elevationInfoOverride=null,s.complexity=null,s.logger=Gt,s._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},s.symbol=e,s.symbolLayer=i,s._renderPriority=a.renderPriority,s._renderPriorityStep=a.renderPriorityStep,s._elevationContext=new ft.a,s.complexity=s.computeComplexity(),s._updateDrivenProperties(a.ignoreDrivers),s._updateElevationContext(),s}return Object(s.a)(r,[{key:"getCachedSize",value:function(){return null}},{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"_logGeometryCreationWarnings",value:function(e,t,r,i){var n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o="".concat(i," geometry failed to be created"),s=null;n?!t.length||1===t.length&&!t[0].length?s="".concat(o," (no ").concat(r," were defined)"):Array.isArray(t)&&Array.isArray(t[0])?a&&0===a.length&&"rings"===r&&t.length>0&&t[0].length>2&&(s="".concat(o," (filled rings should use clockwise winding - try reversing the order of vertices)")):s="".concat(o," (").concat(r," should be defined as a 2D array)"):s="".concat(o," (failed to project geometry to view spatial reference)"),s&&Gt.warnOncePerTick(s)}},{key:"_validateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(Object(f.k)(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+" symbol: ".concat(e.type)),!1;if("point"===e.type){var i=e;if(!Object(w.h)(i.x)||!Object(w.h)(i.y))return Gt.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}},{key:"_defaultElevationInfoNoZ",value:function(){return Nt}},{key:"_defaultElevationInfoZ",value:function(){return Ht}},{key:"_updateElevationContext",value:function(){Object(f.k)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}},{key:"getDefaultElevationInfo",value:function(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}},{key:"getGeometryElevationMode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}},{key:"setElevationInfoOverride",value:function(e){this._elevationInfoOverride=e,this._updateElevationContext()}},{key:"setGraphicElevationContext",value:function(e,t){var r=Object(f.s)(e.geometry),i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=Object(f.t)(this._elevationContext.meterUnitOffset,Object(f.t)(i.offset,0));var n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);var a=n?Fe.g:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}},{key:"prepareSymbolLayerPatch",value:function(e){}},{key:"updateGeometry",value:function(e,t){return!1}},{key:"onRemoveGraphic",value:function(e){}},{key:"_updateDrivenProperties",value:function(e){var t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)this._drivenProperties=t;else{var r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach((function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),this._drivenProperties=t}}},{key:"_getLayerOpacity",value:function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var e=this._context.layer.opacity;return null==e?1:e}},{key:"_getCombinedOpacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qt,r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(Object(f.k)(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r}},{key:"_getCombinedOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qt,r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return Object($e.g)(null,r);var i=Object(f.k)(e)?Qe.a.toUnitRGB(e):E.a;return Object($e.g)(i,r)}},{key:"_getVertexOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=Object($e.g)(r,i);return Object(f.k)(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}},{key:"isFastUpdatesEnabled",value:function(){return this._fastUpdates&&this._fastUpdates.enabled}},{key:"computeComplexity",value:function(){return zt(this.symbol,this.symbolLayer)}},{key:"destroy",value:function(){this.abortLoad()}},{key:"globalPropertyChanged",value:function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r);case"elevationInfo":var i=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,i)!==Ke.a.RECREATE;case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}},{key:"updateGraphics3DGraphicElevationInfo",value:function(e,t,r){var i=this,n=Ke.a.UPDATE;return e.forEach((function(e){var a=t(e);if(Object(f.k)(a)){var o=e.graphic;i.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else n=Ke.a.RECREATE})),n}},{key:"applyRendererDiff",value:function(e,t){return!1}},{key:"getFastUpdateAttrValues",value:function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables,r=t.size?Bt(t.size.field,e):0,i=t.color?Bt(t.color.field,e):0,n=t.opacity?Bt(t.opacity.field,e):0;return Object(jt.g)(r,i,n,0)}},{key:"draped",get:function(){return this._draped}},{key:"ensureDrapedStatus",value:function(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&Gt.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}}]),r}(xt);function Bt(e,t){var r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}var Nt={mode:"on-the-ground",offset:0,unit:"meters"},Ht={mode:"absolute-height",offset:0,unit:"meters"},qt={hasIntrinsicColor:!1},Wt=r(797),Yt=r(662),Zt=r(625),Xt=r(383),Qt=r(647),Jt=r(681),Kt=r(696),$t=r(557),er=r(702),tr=r(728),rr=r(748),ir=r(642),nr=r(609),ar=r(618),or=r(624),sr=r(619),cr=r(610),lr=r(620),ur=r(875),dr=r(544),hr=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(s.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({occlusionTestEnabled:i.occlusionTestEnabled,verticalOffsetEnabled:i.verticalOffset,screenSizePerspectiveEnabled:i.screenSizePerspective,depthHudEnabled:i.depthHudEnabled,depthHudAlignStartEnabled:i.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:e.viewingMode,isDraped:!1,multipassGeometryEnabled:i.multipassGeometryEnabled});return new cr.a(e.rctx,n,sr.a)}},{key:"bindPass",value:function(e,t){Object(ir.c)(this.program,t.camera.projectionMatrix),ur.a.bindUniforms(this.program,e,t.camera.pixelRatio||1),Object(er.b)(this.program,e,t),Object(tr.b)(this.program,t),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(rr.a)(this.program,t),this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture"),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(ir.f)(this.program,t),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]);var r=t.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(e.size)*r),Object(lr.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")}},{key:"bindDraw",value:function(e){Object(ir.d)(this.program,e),Object(ir.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object($t.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e){var t=e?519:513;return this.configuration.depthHudEnabled?Object(dr.f)({depthTest:{func:t},depthWrite:dr.d}):Object(dr.f)({blending:Object(dr.g)(1,770,771,771),depthTest:{func:t},colorWrite:dr.c})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)}}]),r}(ar.a);hr.shader=new nr.a(ur.b,(function(){return r.e(207).then(r.bind(null,1115))}));var fr=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).occlusionTestEnabled=!0,e.verticalOffset=!1,e.screenSizePerspective=!1,e.depthHudEnabled=!1,e.depthHudAlignStartEnabled=!1,e.screenCenterOffsetUnitsEnabled=0,e.slicePlaneEnabled=!1,e.multipassGeometryEnabled=!1,e}return r}(or.a);Object(h.a)([Object(or.b)()],fr.prototype,"occlusionTestEnabled",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"verticalOffset",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"screenSizePerspective",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"depthHudEnabled",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"depthHudAlignStartEnabled",void 0),Object(h.a)([Object(or.b)({count:2})],fr.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"slicePlaneEnabled",void 0),Object(h.a)([Object(or.b)()],fr.prototype,"multipassGeometryEnabled",void 0);var pr=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e,br)).techniqueConfig=new fr,i._uniqueMaterialIdentifier=r.uniqueMaterialIdentifier(i.params),i}return Object(s.a)(r,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}},{key:"dispose",value:function(){}},{key:"getGLMaterial",value:function(e){return 0===e.output?new vr(e):void 0}},{key:"getPassParameters",value:function(){return this.params}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.depthHudEnabled=e,this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}},{key:"intersect",value:function(){}},{key:"createBufferWriter",value:function(){return new yr}},{key:"validateParameterValues",value:function(e){var t=r.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}}],[{key:"uniqueMaterialIdentifier",value:function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}]),r}(Zt.a),vr=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e))._isRenderSlot=!0,i.updateParameters(),i}return Object(s.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(hr,this._material.getTechniqueConfig(!1,e),this._technique),this._depthTechnique=this._techniqueRep.releaseAndAcquire(hr,this._material.getTechniqueConfig(!0,e),this._depthTechnique)}},{key:"beginSlot",value:function(e){switch(e){case 21:return this._isRenderSlot=!0,!0;case 22:return this._isRenderSlot=!1,!0}return!1}},{key:"technique",get:function(){return this._isRenderSlot?this._technique:this._depthTechnique}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this.technique.bindPass(this._material.getPassParameters(),e)}}]),r}(Jt.a),br=Object(te.a)({verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},Zt.b),mr=Object(Qt.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),gr=[Object(Xt.b)(0,0),Object(Xt.b)(1,0),Object(Xt.b)(0,1),Object(Xt.b)(1,0),Object(Xt.b)(1,1),Object(Xt.b)(0,1)],yr=function(){function e(){Object(o.a)(this,e),this.vertexBufferLayout=mr}return Object(s.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){Object(Kt.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(Kt.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6),Object(Kt.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6);for(var n=0;n<gr.length;++n)r.uv0.setVec(i+n,gr[n])}}]),e}(),Or=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i){var n;return Object(o.a)(this,r),(n=t.call(this,e,null,i,Sr))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},n.ensureDrapedStatus(!1),n}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._material=new pr(this.materialParameters),this._context.stage.add(this._material);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"perInstanceMaterialParameters",value:function(e){var t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t}},{key:"materialParameters",get:function(){var e=this.symbol,t=e.callout,r=Object(f.k)(t.color)?Qe.a.toUnitRGBA(t.color):[0,0,0,0];r[3]*=this._getLayerOpacity();var i=Object(Je.g)(t.size||0),n=null;if(e.verticalOffset){var a=e.verticalOffset,o=a.screenLength,s=a.minWorldLength,c=a.maxWorldLength;n={screenLength:Object(Je.g)(o),minWorldLength:s||0,maxWorldLength:null!=c?c:1/0}}var l=Object(f.k)(t.border)&&Object(f.k)(t.border.color)?Qe.a.toUnitRGBA(t.border.color):null,u="object"===e.symbolLayers.getItemAt(0).type,d=!u,h=u?0:void 0,p="label-3d"===e.type;return{color:r,size:i,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:l,occlusionTest:d,shaderPolygonOffset:h,depthHUDAlignStart:p,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:Zt.b.renderOccluded}}},{key:"_defaultElevationInfoNoZ",value:function(){return _r}},{key:"createGraphics3DGraphic",value:function(e){var t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new ft.a,t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((function(e){return"object"===e.type||"text"===e.type})));if("label-3d"!==n.type&&a)return null;var o=Object($e.a)(r.geometry);return Object(f.j)(o)?null:this._createAs3DShape(o,i,t,r.uid)}},{key:"layerOpacityChanged",value:function(){return Object(f.j)(this._material)||this._material.setParameterValues(this.materialParameters),!0}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this,a=this._elevationContext.mode,o=Object(Ke.d)(r.elevationModeChangeTypes,i,a);return o!==Ke.a.UPDATE||e.forEach((function(e){var r=t(e);Object(f.k)(r)&&n.updateGraphicElevationContext(e.graphic,r)})),o}},{key:"slicePlaneEnabledChanged",value:function(){return Object(f.j)(this._material)||this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"setGraphicElevationContext",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Object(c.a)(Object(l.a)(r.prototype),"setGraphicElevationContext",this).call(this,e,t);return n.addOffsetRenderUnits(i),n}},{key:"updateGraphicElevationContext",value:function(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(Ke.f)(t.elevationContext.mode)}},{key:"updateGeometry",value:function(e,t){return!1}},{key:"computeComplexity",value:function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Mt.memory}}},{key:"createVertexData",value:function(e){var t=e.translation,r=e.centerOffset;return[["position",t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}},{key:"_getOrCreateMaterial",value:function(e){var t=this.perInstanceMaterialParameters(e),r=pr.uniqueMaterialIdentifier(t);if(Object(f.k)(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){var i=e.materialCollection.get(r);return Object(f.j)(i)&&(i=new pr(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new pr(t),isUnique:!0}}},{key:"_createAs3DShape",value:function(e,t,r,i){var n=[new Yt.a(this.createVertexData(r),xr,1)],a=this._getOrCreateMaterial(r),o=Object(Wt.a)(this._context,e,n,[a.material],null,null,t,this._context.layer.uid,i);if(null===o)return null;var s=it,c=new vt(this,o.object,n,a.isUnique?[a.material]:null,null,s,t);return c.metadata={elevationOffset:r.elevationOffset||0},c.alignedSampledElevation=o.sampledElevation,c.needsElevationUpdates=Object(Ke.f)(t.mode),Object(Wt.b)(c,e,this._context.elevationProvider),c}}]),r}(Ut);Or.elevationModeChangeTypes={definedChanged:Ke.a.UPDATE,staysOnTheGround:Ke.a.UPDATE,onTheGroundChanged:Ke.a.RECREATE};var jr=new Uint16Array([0]),xr=[["position",jr],["normal",jr],["auxpos1",jr]],_r={mode:"relative-to-ground",offset:0},Sr={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},wr=m.a.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");var Cr={line:Or},kr=r(712),Pr=r(115),Er=r(30),Tr=r(90),Ar=r(382),Rr=new Pr.a(Array,(function(e){return Object(A.w)(e,A.b)}),null,10,5),Dr=Object(R.l)(),Mr=function(){function e(t,r,i,n,a){Object(o.a)(this,e),this.graphic=t,this.graphics3DSymbol=r,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function(e,t){for(var r=new Array(e),i=0;i<r.length;i++)r[i]=new Array(t);return r}(2,4),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=a?Object(Fe.c)(a,t,n):null;var s,c=Object(_.a)(i);try{for(c.s();!(s=c.n()).done;){var l=s.value;Object(f.k)(l)&&(this.isElevationSource=this.isElevationSource||l.isElevationSource)}}catch(u){c.e(u)}finally{c.f()}}return Object(s.a)(e,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"initialize",value:function(e,t,r){var i=this;this._layer=t,this._stage=e,this.forEachSymbolLayerGraphic((function(n){n.initialize(e,t,r),n.setVisibility(i.isVisible())}))}},{key:"destroy",value:function(){this.forEachSymbolLayerGraphic((function(e){return e.destroy()})),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"clearLabelGraphics",value:function(){this.forEachLabelGraphic((function(e){return e.destroy()})),this._labelGraphics.length=0}},{key:"addLabelGraphic",value:function(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))}},{key:"addAuxiliaryGraphic",value:function(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}},{key:"isDraped",get:function(){var e=!1;return this.forEachSymbolLayerGraphic((function(t){"draped"===t.type&&(e=!0)})),e}},{key:"isVisible",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=0;r<=e;r++)for(var i=this._visibilityFlags[r],n=0;n<i.length;++n)if(!1===i[n]&&n!==t)return!1;return!0}},{key:"hasVisibilityFlag",value:function(e,t){return null!=this._visibilityFlags[t][e]}},{key:"setVisibilityFlag",value:function(e,t,r){var i=this.isVisible(r);this._visibilityFlags[r][e]=t;var n=this.isVisible(r);if(i===n)return!1;if(1===r)this.forEachLabelGraphic((function(e){return e.setVisibility(n)}));else{this.forEachSymbolLayerGraphic((function(e){return e.setVisibility(n)}));var a=this.isVisible(1);this.forEachLabelGraphic((function(e){return e.setVisibility(a)}))}return!0}},{key:"clearVisibilityFlag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.setVisibilityFlag(e,void 0,t)}},{key:"computeExtent",value:function(e){if(!this._extent){var t=this.graphic.geometry;if(Object(f.j)(t))return!1;this._extent=Object(R.l)(),Object(ge.d)(t,this._extent);var r=t.spatialReference;if(!r.equals(e)&&!Object(T.k)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}},{key:"getAsOptimizedGeometry",value:function(e,t){return Object(f.k)(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}},{key:"_convertGraphicToOptimizedGeometry",value:function(e,t,r){var i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=Tr.a.fromExtent("mesh"===i.type?i.extent:i)),Object(Ar.d)(i,t,r)}},{key:"usedMemory",get:function(){var e=this,t=Object(kr.a)(this.graphic.attributes);return this.forEachSymbolLayerGraphic((function(r){var i=r.graphics3DSymbolLayer.complexity;if(!Object(f.j)(i)){var n="draped"===r.type?i.memory.draped:i.memory;t+=n.bytesPerFeature,n.bytesPerCoordinate&&(t+=Object(ge.h)(e.graphic.geometry)*n.bytesPerCoordinate)}})),t}},{key:"computeAttachmentOrigin",value:function(){var e,t={render:{origin:Object(E.e)(),num:0},draped:{origin:Object(L.a)(),num:0}},r=Object(_.a)(this.graphics);try{for(r.s();!(e=r.n()).done;){var i=e.value;Object(f.j)(i)||i.computeAttachmentOrigin(t)}}catch(n){r.e(n)}finally{r.f()}return t.render.num&&Object(P.e)(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Object(Er.b)(t.draped.origin,t.draped.origin,1/t.draped.num),t}},{key:"getProjectedBoundingBox",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i,o,s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Object(A.h)(s.boundingBox):s.boundingBox=Object(A.h)(),s.requiresDrapedElevation=!1,e.next=5,Object(Ze.a)(this.graphics,function(){var e=Object(a.a)(n.a.mark((function e(a){var c,l,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(f.j)(a)){e.next=2;break}return e.abrupt("return");case 2:return c="draped"===a.type?r:t,l=Rr.acquire(),e.next=6,a.getProjectedBoundingBox(c,i,s.screenSpaceObjects,o,l);case 6:u=e.sent,isFinite(u[2])&&isFinite(u[5])||(s.requiresDrapedElevation=!0),u&&Object(A.j)(s.boundingBox,l),Rr.release(l);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return e.abrupt("return",Object(A.c)(s.boundingBox)||Object(R.b)(Object(A.A)(s.boundingBox,Dr))?s:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"needsElevationUpdates",value:function(){var e,t=Object(_.a)(this.graphics);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(Object(f.k)(r)&&("object3d"===r.type||"lod-instance"===r.type)&&r.needsElevationUpdates)return!0}}catch(o){t.e(o)}finally{t.f()}var i,n=Object(_.a)(this._labelGraphics);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a&&a.needsElevationUpdates)return!0}}catch(o){n.e(o)}finally{n.f()}return!1}},{key:"alignWithElevation",value:function(e,t,r){var i=this;this.forEachRenderedGraphic((function(n){"object3d"!==n.type&&"lod-instance"!==n.type||n.alignWithElevation(e,t,i._featureExpressionFeature,r)}))}},{key:"addObjectStateSet",value:function(e,t){this.forEachSymbolLayerGraphic((function(r){return r.addObjectState(e,t)}))}},{key:"removeObjectState",value:function(e){this.forEachSymbolLayerGraphic((function(t){return t.removeObjectState(e)}))}},{key:"forEachGraphicList",value:function(e,t){e.forEach((function(e){return e&&t(e)}))}},{key:"forEachSymbolLayerGraphic",value:function(e){this.forEachGraphicList(this.graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)}},{key:"forEachLabelGraphic",value:function(e){this.forEachGraphicList(this._labelGraphics,e)}},{key:"forEachRenderedGraphic",value:function(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)}}]),e}();var Ir=r(617),Lr=r(235),zr=r(563),Fr=r(598),Vr=r(669);r(237);var Gr=r(786),Ur=r(838),Br=r(48);function Nr(e){var t=[["position",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}]];return Object(f.k)(e.attributeData.color)&&(r.push(["color",{size:4,data:e.attributeData.color,exclusive:!0}]),t.push(["color",new Uint32Array(e.indices.length)])),Object(f.k)(e.attributeData.uvMapSpace)&&(r.push(["uvMapSpace",{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push(["uvMapSpace",e.indices])),Object(f.k)(e.attributeData.boundingRect)&&(r.push(["boundingRect",{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push(["boundingRect",e.indices])),Object(f.k)(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new Yt.a(r,t)}function Hr(e){var t=[["position",e.indices],["uv0",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}],["uv0",{size:2,data:e.attributeData.uv0,exclusive:!0}]];return Object(f.k)(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new Yt.a(r,t)}function qr(e){switch(e.type){case"extent":if(e instanceof Br.a)return Tr.a.fromExtent(e);break;case"polygon":return e}return null}function Wr(e,t,r,i){var n=Object(Gr.a)(e.rings,e.hasZ,1),a=new Float64Array(n.position.length),o=Object(Ke.c)(n.position,e.spatialReference,0,a,0,n.position,0,n.position.length/3,t,r,i),s=null!=o;return{position:n.position,mapPosition:a,polygons:Xr(n.polygons,n.position,a),outlines:Zr(n.outlines,n.position,a),projectionSuccess:s,sampledElevation:o}}function Yr(e,t){for(var r=Object(Gr.a)(e.rings,!1,1),i=Object(T.l)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3),n=2;n<r.position.length;n+=3)r.position[n]=Ur.a;return{position:r.position,polygons:Xr(r.polygons,r.position),outlines:Zr(r.outlines,r.position),projectionSuccess:i}}function Zr(e,t,r){var i,n=new Array,a=Object(_.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.index,c=o.count;if(!(c<=1)){var l=3*s,u=l+3*c;n.push({index:s,count:c,position:t.subarray(l,u),mapPosition:r?r.subarray(l,u):void 0})}}}catch(d){a.e(d)}finally{a.f()}return n}function Xr(e,t,r){var i,n=new Array,a=Object(_.a)(e);try{var o=function(){var e=i.value,a=e.index,o=e.count,s=e.holeIndices,c=e.pathLengths;if(o<=1)return"continue";var l=3*a,u=l+3*o,d=s.map((function(e){return e-a}));n.push({index:a,count:o,holeIndices:d,pathLengths:c,position:t.subarray(l,u),mapPosition:r?r.subarray(l,u):void 0})};for(a.s();!(i=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}return n}var Qr=r(665),Jr=r(717),Kr=["polygon","extent"],$r=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a)).ensureDrapedStatus(!1),s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r,i,a,o,s,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(t=Object($e.j)(this._getSymbolSize()))){e.next=4;break}throw new pe.a("graphics3dextrudesymbollayer:invalid-size",t);case 4:r=Object(f.i)(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(r),a=Object(E.f)(i),o=i[3],s=o<1||this.needsDrivenTransparentPass,c={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:a,ambient:a,opacity:o,transparent:s,cullFace:s?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0},this._material=new Jr.a(c),this._bottomMaterial=new Jr.a(Object(te.a)(Object(te.a)({},c),{},{cullFace:2})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Kr,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new ft.a);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}},{key:"layerOpacityChanged",value:function(e,t){var r=this,i=Object(f.i)(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(i),a=n<1||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:n,transparent:a}),this._bottomMaterial.setParameterValues({opacity:n,transparent:a});var o=this._getLayerOpacity();return e.forEach((function(e){var i=t(e);Object(f.k)(i)&&i.layerOpacityChanged(o,r._context.isAsync)})),!0}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ke.g)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),e.forEach((function(e){var i=t(e);Object(f.k)(i)&&i.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"_getExtrusionSize",value:function(e){var t,r;return t=e.size&&this._drivenProperties.size?null!=(r=function(e){var t=e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];return"number"==typeof t&&isFinite(t)?t:null}(e.size,2))?r:0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters}},{key:"_getSymbolSize",value:function(){var e;return null!=(e=this.symbolLayer.size)?e:1}},{key:"_createAs3DShape",value:function(e,t,r,i,n){var a=qr(e.geometry);if(Object(f.j)(a))return null;var o=Wr(a,this._context.elevationProvider,this._context.renderCoordsHelper,i);if(this._logGeometryCreationWarnings(o,a.rings,"rings","ExtrudeSymbol3DLayer"),0===a.rings.length||!a.rings.some((function(e){return e.length>0})))return null;var s=Object($e.a)(a);if(Object(f.j)(s))return null;var c=new Array,l=new Array,u=new Array,d=Object(A.f)(),h=Object(k.d)(),p=Object(E.e)(),v=1===this._context.renderCoordsHelper.viewingMode;v||this._context.renderCoordsHelper.worldUpAtPosition(null,p),Object(T.c)(a.spatialReference,[s.x,s.y,0],h,this._context.renderCoordsHelper.spatialReference);var b=Object(k.d)();Object(C.c)(b,h);var m=Object(zr.b)();Object(Lr.a)(m,b);for(var g=o.polygons,y=o.mapPosition,O=o.position,j=O.length/3,x=new Float64Array(3*j*6),_=new Float64Array(3*j*6),S=new Float64Array(3*j*6),w=new Float64Array(1*j*6),P=0,R=0;R<g.length;++R){var D=g[R],M=D.count;if(!this._context.clippingExtent||(Object(A.h)(d),Object(A.k)(d,D.mapPosition),Object(A.r)(d,this._context.clippingExtent))){var I=Object(Ir.a)(D.mapPosition,D.holeIndices,3);if(0!==I.length){var L=3*M*2+I.length,z=new Uint32Array(L),F=new Uint32Array(I.length),V=6*M,G=3*x.BYTES_PER_ELEMENT,U=new Fr.v(x.buffer,P*G,G,(P+V)*G),B=3*_.BYTES_PER_ELEMENT,N=new Fr.v(_.buffer,P*B,B,(P+V)*B),H=new Float64Array(S.buffer,3*P*S.BYTES_PER_ELEMENT,3*V),q=new Float64Array(w.buffer,1*P*w.BYTES_PER_ELEMENT,1*V),W=this._getExtrusionSize(t);ei(O,y,I,D,U.typedBuffer,H,N.typedBuffer,q,0,z,F,W,p,v),Object(Vr.e)(U,U,b),Object(Vr.a)(N,N,m),P+=6*M;var Y=this._createExtrudeGeometry(z,z.length-F.length,{positions:U.typedBuffer,elevation:H,normals:N.typedBuffer,heights:q},r);c.push(Y),l.push(this._material),u.push(k.a);var Z=this._createExtrudeGeometry(F,0,{positions:U.typedBuffer,elevation:H,normals:N.typedBuffer,heights:q},r);c.push(Z),l.push(this._bottomMaterial),u.push(k.a)}}}if(0===c.length)return null;var X=new Qr.a({geometries:c,materials:l,transformations:u,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});X.transformation=h;var Q=di,J=Pt(this.symbolLayer,{opacity:this._getLayerOpacity()}),K=Object(f.k)(J)?{baseMaterial:this._material,edgeMaterials:[J],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,$=new vt(this,X,c,null,null,Q,i,K);return $.alignedSampledElevation=o.sampledElevation,$.needsElevationUpdates=Object(Ke.g)(i.mode),$}},{key:"_createExtrudeGeometry",value:function(e,t,r,i){var n=new Uint32Array(e.length),a=[["position",{size:3,data:r.positions,exclusive:!0}],["normal",{size:3,data:r.normals,exclusive:!0}],["color",{size:4,data:i,exclusive:!0}],["size",{size:1,data:r.heights,exclusive:!0}]],o=[["position",e],["normal",e],["color",n]];return r.elevation&&(a.push(["mapPos",{size:3,data:r.elevation}]),o.push(["mapPos",e])),new Yt.a(a,o,0,t)}}]),r}(Ut);function ei(e,t,r,i,n,a,o,s,c,l,u,d,h,f){var p=r.length/3,v=0,b=2*i.count;(function(e,t,r,i,n,a,o,s,c,l,u,d,h,f,p,v,b,m){Object(P.k)(pi,b);for(var g=v>0?1:-1,y=3*r,O=d,j=3*O,x=d+i,_=3*x,S=0;S<i;++S)m&&(pi[0]=e[y+0],pi[1]=e[y+1],pi[2]=e[y+2],Object(P.r)(pi,pi)),s[j+0]=e[y+0],s[j+1]=e[y+1],s[j+2]=e[y+2],c[j+0]=t[y+0],c[j+1]=t[y+1],c[j+2]=t[y+2],l[j+0]=-g*pi[0],l[j+1]=-g*pi[1],l[j+2]=-g*pi[2],u[O]=0,s[_+0]=e[y+0]+v*pi[0],s[_+1]=e[y+1]+v*pi[1],s[_+2]=e[y+2]+v*pi[2],c[_+0]=t[y+0],c[_+1]=t[y+1],c[_+2]=t[y+2],l[_+0]=g*pi[0],l[_+1]=g*pi[1],l[_+2]=g*pi[2],u[x]=v,j+=3,_+=3,y+=3,O+=1,x+=1;y=3*a,j=0,_=3*p;for(var w=v<0?bi:vi,C=v<0?vi:bi,k=0;k<o;++k)f[j+0]=n[y+w[0]],f[j+1]=n[y+w[1]],f[j+2]=n[y+w[2]],h[_+0]=n[y+C[0]]+i,h[_+1]=n[y+C[1]]+i,h[_+2]=n[y+C[2]]+i,j+=3,_+=3,y+=3})(e,t,i.index,i.count,r,0,p,n,a,o,s,c,l,u,b,d,h,f),c+=2*i.count,b=0,ii(n,a,s,o,v,i.pathLengths[0],i.count,c,l,b,d),c+=4*i.pathLengths[0],b+=2*i.pathLengths[0],v+=i.pathLengths[0];for(var m=1;m<i.pathLengths.length;++m)ii(n,a,s,o,v,i.pathLengths[m],i.count,c,l,b,d),c+=4*i.pathLengths[m],b+=2*i.pathLengths[m],v+=i.pathLengths[m]}function ti(e,t,r,i,n,a,o){i[a]=i[o],o*=3,e[0+(a*=3)]=e[o+0],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a+0]=t[o+0],t[a+1]=t[o+1],t[a+2]=t[o+2],r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2]}var ri=Object(E.e)();function ii(e,t,r,i,n,a,o,s,c,l,u){var d=n,h=n+1,f=n+o,p=n+o+1,v=s,b=s+1,m=s+2*a,g=s+2*a+1;u<0&&(d=n+o+1,p=n),l*=3;for(var y=0;y<a;++y)y===a-1&&(u>0?(h=n,p=n+o):(h=n,d=n+o)),li(e,d,h,f,ri),ti(e,t,i,r,ri,v,d),ti(e,t,i,r,ri,b,h),ti(e,t,i,r,ri,m,f),ti(e,t,i,r,ri,g,p),c[l++]=v,c[l++]=m,c[l++]=g,c[l++]=v,c[l++]=g,c[l++]=b,d++,h++,f++,p++,v+=2,b+=2,m+=2,g+=2}var ni=Object(E.e)(),ai=Object(E.e)(),oi=Object(E.e)(),si=Object(E.e)(),ci=Object(E.e)();function li(e,t,r,i,n){t*=3,r*=3,i*=3,Object(P.w)(ni,e[t++],e[t++],e[t++]),Object(P.w)(ai,e[r++],e[r++],e[r++]),Object(P.w)(oi,e[i++],e[i++],e[i++]),Object(P.j)(si,ai,ni),Object(P.j)(ci,oi,ni),Object(P.g)(n,ci,si),Object(P.r)(n,n)}var ui=Object(E.e)();function di(e,t,r,i){for(var n=e.stageObject,a=n.geometryRecords,o=a.length,s="absolute-height"!==t.mode,c=0,l=n.transformation,u=Object(C.c)(Object(k.d)(),l),d=0;d<o;d+=2){for(var h=a[d].geometry,f=h.getMutableAttribute("position").data,p=h.vertexAttributes.get("size").data,v=h.vertexAttributes.get("mapPos").data,b=new tt.a(v),m=f.length/3,g=0,y=!1,O=0,j=r.spatialReference,x=0;x<m;x++){ui[0]=f[g],ui[1]=f[g+1],ui[2]=f[g+2];var _=Object(Ke.e)(b,r,t,i,s?gi:null);s&&(O+=gi.sampledElevation),et.a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(Object(P.w)(fi,b.array[b.offset+0],b.array[b.offset+1],_+p[g/3]),i.toRenderCoords(fi,j,fi),Object(P.q)(fi,fi,u)):(Object(P.w)(fi,f[g+0],f[g+1],f[g+2]),Object(P.q)(fi,fi,l),i.setAltitude(fi,_+p[g/3]),Object(P.q)(fi,fi,u)),f[g]=fi[0],f[g+1]=fi[1],f[g+2]=fi[2];var S=mi/i.unitInMeters;(Math.abs(ui[0]-f[g])>=S||Math.abs(ui[1]-f[g+1])>=S||Math.abs(ui[2]-f[g+2])>=S)&&(y=!0),b.offset+=3,g+=3}y&&(h.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(d),a[d+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(d+1)),c+=O/m}return c/o}var hi,fi=Object(E.e)(),pi=Object(E.e)(),vi=[0,2,1],bi=[0,1,2],mi=.01,gi={verticalDistanceToGround:0,sampledElevation:0},yi=r(24),Oi=r(407),ji=r(440),xi=r(204),_i=r(584),Si=function(){function e(t,r,i){Object(o.a)(this,e),this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}return Object(s.a)(e,[{key:"initialize",value:function(e,t,r){this.stage=e,this._layerView=r,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer}},{key:"setVisibility",value:function(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);if(e||this._addedToStage){var t,r=Object(_.a)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.instanceParameters.visible=this._visible}}catch(i){r.e(i)}finally{r.f()}this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}}}},{key:"destroy",value:function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4),this._addedToStage=!1,this._visible=!1,this.stage=null}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(E.e)();return Object(P.w)(e,0,0,0)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(A.f)();return Object(A.h)(e)}},{key:"addObjectState",value:function(e,t){var r=this;0===e&&(this.renderGeometries.forEach((function(e){var i=e.addHighlight();t.addRenderGeometry(e,i,r)})),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))}},{key:"removeObjectState",value:function(e){this.renderGeometries.forEach((function(t){e.removeRenderGeometry(t)}))}},{key:"removeRenderGeometryObjectState",value:function(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)}},{key:"computeAttachmentOrigin",value:function(e){var t,r=Object(_.a)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.computeAttachmentOrigin(ki)&&(e.draped.origin[0]+=ki[0],e.draped.origin[1]+=ki[1],e.draped.num++)}}catch(i){r.e(i)}finally{r.f()}}},{key:"getProjectedBoundingBox",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i,a,o){var s,c,l,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(Object(A.h)(o),s=0;s<this.renderGeometries.length;s++)c=this.renderGeometries[s],this._getRenderGeometryProjectedBoundingRect(c,t,wi,i),Object(A.m)(o,wi);if(!r){e.next=14;break}return Object(A.d)(o,ki),u=Object($e.d)(o,r),e.prev=5,e.next=8,r.service.queryElevation(ki[0],ki[1],a,u,"ground");case 8:l=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:Object(f.k)(l)&&(o[2]=Math.min(o[2],l),o[5]=Math.max(o[5],l));case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"_getRenderGeometryProjectedBoundingRect",value:function(e,t,r,i){if(this.boundingBox)Object(A.w)(Ci,this.boundingBox);else{var n=e.boundingSphere,a=n[3];Ci[0]=n[0]-a,Ci[1]=n[1]-a,Ci[2]=n[2]-a,Ci[3]=n[0]+a,Ci[4]=n[1]+a,Ci[5]=n[2]+a}return t(Ci,0,2),this.calculateRelativeScreenBounds&&i.push({location:Object(A.d)(Ci),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Object(A.A)(Ci,r)}}]),e}(),wi=Object(R.l)(),Ci=Object(A.f)(),ki=Object(E.e)(),Pi=r(924),Ei=r(216);function Ti(e){return null!=e}function Ai(e){return"number"==typeof e}function Ri(e){return"string"==typeof e}function Di(e,t){e&&e.push(t)}function Mi(e,t,r,i,n){var a=e.minSize,o=e.maxSize;if(e.expression)return Di(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var s=i.symbolSize[r];return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(Ti(e.field))return Ti(e.stops)?2===e.stops.length&&Ai(e.stops[0].size)&&Ai(e.stops[1].size)?(Ii(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(Di(n,"Could not convert size info: stops only supported with 2 elements"),!1):Ai(a)&&Ai(o)&&Ti(e.minDataValue)&&Ti(e.maxDataValue)?(Ii(a,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=Ei.a[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/Ei.a[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(Di(n,"Could not convert size info: proportional size not supported"),!1):(Di(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!Ti(e.field)){if(e.stops&&e.stops[0]&&Ai(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(Ai(a))return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=a,t.factor[r]=0,t.type[r]=1,!0}return Di(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Ii(e,t,r,i,n,a){var o=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[a]=o>0?e:t,n.maxSize[a]=o>0?t:e,n.offset[a]=e-r*o,n.factor[a]=o}function Li(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return Di(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||Ri(e)}(e.field))return Di(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Di(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var n;switch(e.axis){case"width":return(n=Mi(e,t.size,0,r,i))?t:null;case"height":return(n=Mi(e,t.size,2,r,i))?t:null;case"depth":return(n=Mi(e,t.size,1,r,i))?t:null;case"width-and-depth":return(n=Mi(e,t.size,0,r,i))&&Mi(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return(n=(n=(n=Mi(e,t.size,0,r,i))&&Mi(e,t.size,1,r,i))&&Mi(e,t.size,2,r,i))?t:null;default:return Di(i,'Could not convert size info: unknown axis "'.concat(e.axis,'""')),null}}function zi(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function Fi(e,t,r){var i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function Vi(e,t,r){if(!e)return null;var i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,s=e.reduce((function(e,s){if(!e)return e;if(s.valueExpression)return Di(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return i?Li(s,e,t,r):e;case"color":return n?function(e,t,r){if(e.normalizationField)return Di(r,"Could not convert color info: unsupported property"),null;if(Ri(e.field)){if(!e.stops)return Di(r,"Could not convert color info: missing stops or colors"),null;if(e.stops.length>8)return Di(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.color.values[n]=a.value,zi(t.color.colors,n,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return Di(r,"Could not convert color info: no field and no colors/stops"),null;var o=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var s=0;s<8;s++)t.color.values[s]=1/0,zi(t.color.colors,s,o)}return t}(s,e,r):e;case"opacity":return o?function(e,t,r){if(e.normalizationField)return Di(r,"Could not convert opacity info: unsupported property"),null;if(Ri(e.field)){if(!e.stops)return Di(r,"Could not convert opacity info: missing stops or opacities"),null;if(e.stops.length>8)return Di(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.opacity.values[n]=a.value,t.opacity.opacityValues[n]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return Di(r,"Could not convert opacity info: no field and no opacities/stops"),null;var o=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=o}return t}(s,e,r):null;case"rotation":return a?function(e,t,r){if(!Ri(e.field))return Di(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Di(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return Fi(e,t.rotation,0),t;case"roll":return Fi(e,t.rotation,1),t;case null:case void 0:case"heading":return Fi(e,t.rotation,2),t;default:return Di(r,'Could not convert rotation info: unknown axis "'.concat(e.axis,'""')),null}}(s,e,r):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&s)||s.size||s.color||s.opacity||s.rotation?s&&s.size&&!function(e,t,r){for(var i=0;i<3;++i){var n=t.unitInMeters;1===e.type[i]&&(n*=t.modelSize[i],e.type[i]=2),e.minSize[i]=e.minSize[i]/n,e.maxSize[i]=e.maxSize[i]/n,e.offset[i]=e.offset[i]/n,e.factor[i]=e.factor[i]/n}var a;if(0!==e.type[0])a=0;else if(0!==e.type[1])a=1;else{if(0===e.type[2])return Di(r,"No size axis contains a valid size or scale"),!1;a=2}for(var o=0;o<3;++o)0===e.type[o]&&(e.minSize[o]=e.minSize[a],e.maxSize[o]=e.maxSize[a],e.offset[o]=e.offset[a],e.factor[o]=e.factor[a],e.type[o]=e.type[a]);return!0}(s.size,t,r)?null:s:null}function Gi(e){return e&&null!=e.size}function Ui(e,t){if(!e)return{enabled:!1};if(et.a.DISABLE_FAST_UPDATES)return{enabled:!1};var r=Vi(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:Hi(r,t),requiresShaderTransformation:Gi(r)}:{enabled:!1}}function Bi(e,t,r){if(!t||!e.enabled)return!1;var i=e.visualVariables,n=Vi(t.visualVariables,r);return!!n&&!!(Ni(i.size,n.size,"size")&&Ni(i.color,n.color,"color")&&Ni(i.rotation,n.rotation,"rotation")&&Ni(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=Hi(n,r),e.requiresShaderTransformation=Gi(n),!0)}function Ni(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r)for(var i=e,n=t,a=0;a<3;a++)if(i.type[a]!==n.type[a]||i.offset[a]!==n.offset[a]||i.factor[a]!==n.factor[a])return!1;return!0}function Hi(e,t){var r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Gi(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=Object(zr.b)(),Object(C.j)(qi),function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Object(k.d)(),n=e||0,a=t||0,o=r||0;0!==n&&Object(C.r)(i,i,-n/180*Math.PI),0!==a&&Object(C.d)(i,i,a/180*Math.PI),0!==o&&Object(C.k)(i,i,o/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],qi),Object(Lr.f)(r.vvSymbolRotationMatrix,qi)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}!function(e){var t=Object(k.d)(),r=Object(E.e)();e.evaluateModelTransform=function(e,i,n){if(!e.vvSizeEnabled)return n;Object(C.f)(t,n);var a=e.vvSymbolRotationMatrix;Object(C.s)(qi,a[0],a[1],a[2],0,a[3],a[4],a[5],0,a[6],a[7],a[8],0,0,0,0,1),Object(C.n)(t,t,qi);for(var o=0;o<3;++o){var s=e.vvSizeOffset[o]+i[0]*e.vvSizeFactor[o];r[o]=Object(w.d)(s,e.vvSizeMinSize[o],e.vvSizeMaxSize[o])}return Object(C.g)(t,t,r),Object(C.t)(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,r){if(!t.vvSizeEnabled)return Object(P.w)(e,1,1,1);for(var i=0;i<3;++i){var n=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=Object(w.d)(n,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}}(hi||(hi={}));var qi=Object(k.d)(),Wi=hi.evaluateModelTransform,Yi=hi.evaluateModelTransformScale,Zi=r(796),Xi=r(753),Qi=r(889),Ji=r(221),Ki=Object(k.d)(),$i=Object(E.g)(0,0,1),en=128,tn=.5,rn=[.25,.25,.75,.75],nn=[64,64],an=function(e){Object(u.a)(i,e);var t=Object(d.a)(i);function i(e,r,n,a){var s;return Object(o.a)(this,i),(s=t.call(this,e,r,n,a))._cimLayers=null,s._cimSymbolMaterials=new Map,s._cimSymbolTextures=new Map,s._cimMaterialParametersInfo=null,s._cimRequiredFields=null,s._cimScaleFactorOrFunction=null,s._size=null,s._symbolTextureRatio=1,s._outlineSize=0,s._texture=null,s._releaseTexture=null,s._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},s}return Object(s.a)(i,[{key:"getCachedSize",value:function(){return{size:this._getIconSize()}}},{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i,a,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validateOrThrow(),r=this._prepareMaterialParameters(),i=this._getPrimitive(),!Object(f.k)(i)){e.next=6;break}this._prepareResourcesPrimitive(r,i),e.next=14;break;case 6:if(a=Object(xi.f)(this.symbol,this.symbolLayer),!(o=Object(yi.i)(a))||"application/json"!==o.mediaType){e.next=12;break}return e.next=10,this._prepareResourcesCIM(r,JSON.parse(o.data),t);case 10:e.next=14;break;case 12:return e.next=14,this._prepareResourcesHref(r,a,t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateOrThrow",value:function(){if(!this._drivenProperties.size){var e=Object($e.j)(this._getIconSize());if(e)throw new pe.a("graphics3diconsymbollayer:invalid-size",e)}}},{key:"_getIconSize",value:function(){var e=this.symbolLayer,t=Math.round(null!=e.size?Object(Je.g)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}},{key:"_generateTextureCIM",value:function(e){var t=this._getGraphicHash(e),r=""===t?null:this._cimSymbolTextures.get(t);if(!r){var i={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",i,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",n.anchorPosition);var a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:2};r=new Xi.a(n.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}},{key:"_computeSize",value:function(e,t){var r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}},{key:"_prepareMaterialParameters",value:function(){var e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){var r=t.verticalOffset,i=r.screenLength,n=r.minWorldLength,a=r.maxWorldLength;e.verticalOffset={screenLength:Object(Je.g)(i),minWorldLength:n||0,maxWorldLength:null!=a?a:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e}},{key:"_prepareResourcesPrimitive",value:function(e,t){var r=this,i=this._getOutlineSize();if(on(t)&&0===i)throw new Error("Nothing to render");this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;var n=this._context.sharedResources.textures.fromData(t,(function(){return function(e){var t,r=en,i=r*tn;switch(e){case"circle":t=Object(Pi.a)(r,i);break;case"square":t=Object(Pi.d)(r,i);break;case"kite":t=Object(Pi.c)(r,i);break;case"cross":t=Object(Pi.b)(r,i);break;case"x":t=Object(Pi.g)(r,i);break;case"triangle":t=Object(Pi.e)(r,i)}return new Xi.a(t,{mipmap:!1,wrap:{s:33071,t:33071},width:en,height:en,components:4,noUnpackFlip:!0})}(t)}));this._texture=n.texture,this._releaseTexture=function(){return r._context.sharedResources.textures.release(n.uid)},e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=rn,e.textureId=this._texture.id;var a=this._getIconSize();this._size=[a,a],this._symbolTextureRatio=2,this._createMaterialAndAddToStage(e,this._context.stage)}},{key:"_prepareResourcesHref",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i){var a,o,s,c,l,u,d,h=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(b.a)("esri-canvas-svg-support")||!Object(yi.x)(r)){e.next=2;break}throw new pe.a("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");case 2:return this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1,a=this._getIconSize(),o=a*this._context.layerView.view.pixelRatio,e.next=7,Object(Ze.c)(this._context.sharedResources.textures.fromUrl(r,o,{signal:i}));case 7:if(!1!==(s=e.sent).ok){e.next=11;break}throw Object(ne.u)(s.error),new pe.a("graphics3diconsymbollayer:request-failed","Failed to load (Request for icon resource failed: ".concat(r,")"));case 11:c=s.value,l=c.uid,u=c.texture,this._releaseTexture=function(){return h._context.sharedResources.textures.release(l)},d=u.params,this._size=this._computeSize(d,a),t.textureId=u.id,this._createMaterialAndAddToStage(t,this._context.stage);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_prepareResourcesCIM",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i,a){var o,s,c,l,u,d,h,f,p,v;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new Ji.a({data:i}),this._context.sharedResources.cimSymbolRasterizer){e.next=6;break}return e.next=4,Promise.all([r.e(9),r.e(24),r.e(45)]).then(r.bind(null,1026));case 4:s=e.sent.CIMSymbolRasterizer,Object(ne.v)(a),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new s(this._context.renderCoordsHelper.spatialReference,!0));case 6:return c=this._context.layer.fields?this._context.layer.fields.map((function(e){return e.toJSON()})):null,e.next=9,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(o,c,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:a});case 9:if(this._cimLayers=e.sent,!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression){e.next=21;break}if(d=this._context.renderer,!isNaN(d.scaleExpression)){e.next=20;break}return h=d.scaleExpression,e.next=16,Object(_e.d)(h,this._context.layer.spatialReference,c);case 16:f=e.sent,u=function(e,t,r){var i=Object(_i.a)(f,e,{$view:r},"esriGeometryPoint",t);return null!==i?i:1},e.next=21;break;case 20:l=Number(d.scaleExpression);case 21:if(this._cimScaleFactorOrFunction=l||u||1,!this._context.renderer){e.next=28;break}return e.next=25,this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex);case 25:e.t0=e.sent,e.next=29;break;case 28:e.t0=[];case 29:p=e.t0,Object(ne.v)(a),v=this._context.layer.fieldsIndex,this._cimRequiredFields=p.map((function(e){return v.get(e).name})),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1;case 33:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_getPrimitive",value:function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||ji.b}},{key:"_getOutlineSize",value:function(){var e,t=this.symbolLayer;return Object(f.k)(t.outline)&&null!=t.outline.size?Math.max(Object(Je.g)(t.outline.size),0):(e=on(this._getPrimitive())?1.5:0,Math.max(e,0))}},{key:"_getOutlineColor",value:function(){var e=this._getLayerOpacity(),t=this.symbolLayer,r=Object(f.i)(t,"outline","color");if(Object(f.k)(r)){var i=Qe.a.toUnitRGB(r),n=r.a*e;return[i[0],i[1],i[2],n]}return[0,0,0,0]}},{key:"_getFillColor",value:function(){if(on(this._getPrimitive()))return le.b;var e=Object(f.j)(this._getPrimitive()),t=Object(f.i)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}},{key:"_getAnchorPos",value:function(e,t){return"relative"===e?Object(L.e)((t.x||0)+.5,.5-(t.y||0)):e in $e.h?$e.h[e]:$e.h.center}},{key:"_createMaterialAndAddToStage",value:function(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=Ui(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){var r=this._cimSymbolMaterials.get(e.textureId);return r||(r=new Qi.a(e),this._cimSymbolMaterials.set(e.textureId,r),t.add(r)),r}return this._material=new Qi.a(e),t.add(this._material),this._material}},{key:"_setDrapingDependentMaterialParameters",value:function(){var e=this;this.draped&&(this._forEachMaterial((function(t){t.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:e.draped})})),this.layerOpacityChanged())}},{key:"destroy",value:function(){var e=this;Object(c.a)(Object(l.a)(i.prototype),"destroy",this).call(this),this._forEachMaterial((function(t){return e._context.stage.remove(t)})),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((function(t){return e._context.stage.remove(t)})),this._cimSymbolTextures.clear(),this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)}},{key:"_getScaleFactor",value:function(e,t){if(this._drivenProperties.size&&e.size){for(var r=0;r<3;r++){var i=e.size[r];i&&"symbol-value"!==i&&"proportional"!==i&&(e.size[r]=Object(Je.g)(i))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}},{key:"createGraphics3DGraphic",value:function(e){var t,r,i=e.graphic;if(!this._validateGeometry(i.geometry))return null;if(this._cimLayers){if(!this._cimLayers.length)return null;var n=this._generateTextureCIM(i),a=Object(te.a)({textureId:n.id},this._cimMaterialParametersInfo);r=this._createMaterialAndAddToStage(a,this._context.stage),t=[n.params.width,n.params.height]}else t=this._size,r=Object(f.s)(this._material);var o=Object(Wt.d)(i.geometry);if(Object(f.j)(o))return this.logger.warn("unsupported geometry type for icon symbol: ".concat(i.geometry.type)),null;var s=e.renderingInfo,c=this._getVertexOpacityAndColor(s),l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){var u=t[0]>t[1]?t[0]:t[1];l=this._getScaleFactor(s,u)}l*=this._symbolTextureRatio;var d=[t[0]*l,t[1]*l],h=this.setGraphicElevationContext(i,new ft.a);return this.ensureDrapedStatus("on-the-ground"===h.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,o,r,c,d,e.layer.uid):this._createAs3DShape(i,o,r,c,d,h,i.uid)}},{key:"layerOpacityChanged",value:function(){var e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((function(r){r.setParameterValues({color:e}),r.setParameterValues({outlineColor:t})})),!0}},{key:"layerElevationInfoChanged",value:function(e,t,r){var n=this._elevationContext.mode,a=Object(Ke.d)(i.elevationModeChangeTypes,r,n);if(a!==Ke.a.UPDATE)return a;var o=Object(Ke.f)(n)||"absolute-height"===n;return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e=this;return this.draped||this._forEachMaterial((function(t){t.setParameterValues({slicePlaneEnabled:e._context.slicePlaneEnabled})})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!!this._getPrimitive()}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){if("visualVariables"!==r)return!1;if(!Bi(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;Object(f.k)(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters)}return!0}},{key:"_defaultElevationInfoNoZ",value:function(){return sn}},{key:"_createAs3DShape",value:function(e,t,r,i,n,a,o){var s=this,c=this.getFastUpdateAttrValues(e),l=c?function(e){return Wi(s._fastUpdates.materialParameters,c,e)}:null,u=[St.a.createPointGeometry($i,null,i,n,cn,null,c)],d=Object(Wt.a)(this._context,t,u,[r],null,null,a,this._context.layer.uid,o,l);if(null===d)return null;var h=it,f=new vt(this,d.object,u,null,null,h,a);return f.alignedSampledElevation=d.sampledElevation,f.needsElevationUpdates=Object(Ke.f)(a.mode)||"absolute-height"===a.mode,f.getScreenSize=this._createScreenSizeGetter(n,l),f.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(f.getScreenSize(),1,e)},Object(Wt.b)(f,t,this._context.elevationProvider),f}},{key:"_createAsOverlay",value:function(e,t,r,i,n,a){var o=this;r.renderPriority=this._renderPriority;var s=Object(jt.e)();Object(T.o)(t,s,this._context.overlaySR),s[2]=Ur.a;var c=this._context.clippingExtent;if(Object(f.k)(c)&&!Object(A.e)(c,s))return null;var l=this.getFastUpdateAttrValues(e),u=l?function(e){return Wi(o._fastUpdates.materialParameters,l,e)}:null,d=St.a.createPointGeometry($i,s,i,n,null,null,l),h=new Zi.a(d,r,a,e.uid);s[3]=0,Object(Oi.c)(h.boundingSphere,s),h.calculateShaderTransformation=u;var p=new Si(this,[h],null);return p.getScreenSize=this._createScreenSizeGetter(n,u),p.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(p.getScreenSize(),1,e)},p}},{key:"_createScreenSizeGetter",value:function(e,t){var r=this._outlineSize+2;if(this._fastUpdates.enabled){var i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(L.a)(),a=t(Ki);return e[0]=a[0]*i+r,e[1]=a[5]*n+r,e}}var a=e[0]/this._symbolTextureRatio+r,o=e[1]/this._symbolTextureRatio+r;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(L.a)();return e[0]=a,e[1]=o,e}}},{key:"_fastVisualVariableConvertOptions",value:function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=Object(E.g)(e,e,e),r=Object(Je.h)(1),i=e*r;return{modelSize:t,symbolSize:Object(E.g)(i,i,i),unitInMeters:r,transformation:{anchor:E.b,scale:E.a,rotation:E.b}}}},{key:"_getGraphicHash",value:function(e){var t,r="",i=Object(_.a)(this._cimRequiredFields);try{for(i.s();!(t=i.n()).done;){var n=t.value;r+=n+e.attributes[n]}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"_forEachMaterial",value:function(e){Object(f.k)(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}}]),i}(Ut);function on(e){return!!Object(f.k)(e)&&("cross"===e||"x"===e)}an.PRIMITIVE_SIZE=nn,an.elevationModeChangeTypes={definedChanged:Ke.a.UPDATE,staysOnTheGround:Ke.a.NONE,onTheGroundChanged:Ke.a.RECREATE};var sn={mode:"relative-to-ground",offset:0},cn=Object(jt.g)(0,0,0,1),ln=r(823),un=r(870),dn=r(708),hn=["polyline","polygon","extent"],fn=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._uniformSize=1,s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Ui(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},this._drivenProperties.size){e.next=5;break}if(!((t=null!=this.symbolLayer.size?this.symbolLayer.size:Object(Je.h)(1))<0)){e.next=4;break}throw new pe.a("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");case 4:this._uniformSize=t;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMaterialParameters",value:function(e){var t=this,r=Object(f.i)(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(r);this._patternHidesLine&&(i[3]=0);var n=i[3],a={width:1,color:i,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:n<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:Object(f.c)(Object(f.t)(this.symbolLayer.stipplePattern,(function(){return Object(un.c)(Object(un.b)(t.symbolLayer.pattern),t.symbolLayer.size)})),(function(e){return Object(un.a)(e.map(Je.g))})),stippleOffColor:this.symbolLayer.stippleOffColor?Qe.a.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(a.width=Object(Je.g)(1));else{var o=null!=this.symbolLayer.size?this.symbolLayer.size:Object(Je.h)(1);a.width=Object(Je.g)(o)}return this._fastUpdates&&this._fastUpdates.visualVariables?Object(te.a)(Object(te.a)({},a),this._fastUpdates.materialParameters):a}},{key:"lineMaterial",get:function(){return Object(f.j)(this._lineMaterial)&&(this._lineMaterial=new dn.a(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}},{key:"ringMaterial",get:function(){return Object(f.j)(this._ringMaterial)&&(this._ringMaterial=new dn.a(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._lineMaterial),this._lineMaterial=null,this._context.stage.remove(this._ringMaterial),this._ringMaterial=null}},{key:"getDrivenSize",value:function(e){return this._drivenProperties.size&&e.size?Object(Je.g)(function(e){for(var t=0;t<3;t++){var r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}(e.size)):1}},{key:"getSizeFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Bt(this._fastUpdates.visualVariables.size.field,e):null}},{key:"getDrivenColor",value:function(e){var t=Object(jt.g)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}},{key:"getColorFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Bt(this._fastUpdates.visualVariables.color.field,e):null}},{key:"getOpacityFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Bt(this._fastUpdates.visualVariables.opacity.field,e):null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,hn,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new ft.a);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){if("visualVariables"!==r)return!1;if(!Bi(this._fastUpdates,t,this._vvConvertOptions))return!1;Object(f.k)(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),Object(f.k)(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters)}return!0}},{key:"layerOpacityChanged",value:function(){return Object(f.k)(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),Object(f.k)(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0}},{key:"updateMaterialLayerOpacity",value:function(e){var t=e.params.color,r=Object(f.i)(this.symbolLayer,"material","color"),i=this._patternHidesLine?0:this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass,a=[t[0],t[1],t[2],i];e.setParameterValues({color:a,transparent:n})}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=Object(Ke.d)(r.elevationModeChangeTypes,i,n);if(a!==Ke.a.UPDATE)return a;var o=Object(Ke.f)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){return Object(f.k)(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(f.k)(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"_getGeometryAsPolygonOrPolyline",value:function(e){switch(e.type){case"extent":if(e instanceof Br.a)return Tr.a.fromExtent(e);break;case"polygon":case"polyline":return e}return null}},{key:"_createAs3DShape",value:function(e,t,r){var i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),a="polygon"===n.type?n.rings:n.paths,o=new Array,s=new Array,c=new Array,l=Object(A.f)(),u=Object(ln.b)(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),d="polygon"===n.type?"rings":"paths";this._logGeometryCreationWarnings(u,a,d,"LineSymbol3DLayer");for(var h=0;h<u.lines.length;h++){var p=u.lines[h],v=p.position,b=p.mapPosition;if(!Object(f.k)(this._context.clippingExtent)||(Object(A.h)(l),Object(A.k)(l,b),Object(A.r)(l,this._context.clippingExtent))){var m=this._createGeometry(e,v,b,n.type);o.push(m),s.push("polygon"===n.type?this.ringMaterial:this.lineMaterial),c.push(k.a)}}if(0===o.length)return null;var g=new Qr.a({geometries:o,materials:s,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new vt(this,g,o,null,null,rt,t);return y.alignedSampledElevation=u.sampledElevation,y.needsElevationUpdates=Object(Ke.f)(t.mode),y}},{key:"_createGeometry",value:function(e,t,r,i){var n="polygon"===i?1:0,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return Object(ln.a)({removeDuplicateStartEnd:n,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:r,size:o?null:this.getDrivenSize(e.renderingInfo),color:a?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})}},{key:"_createAsOverlay",value:function(e,t){var r=e.graphic,i=this._getGeometryAsPolygonOrPolyline(r.geometry),n="polygon"===i.type?i.rings:i.paths,a="polygon"===i.type?this.ringMaterial:this.lineMaterial;a.renderPriority=this._renderPriority;var o=new Array,s=Object(A.f)(),c=Object(A.h)(),l=Object(ln.c)(i,this._context.overlaySR),u="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(l,n,u,"LineSymbol3DLayer");var d,h=Object(_.a)(l.lines);try{for(h.s();!(d=h.n()).done;){var f=d.value;if(Object(A.h)(s),Object(A.k)(s,f.position),Object(A.r)(s,this._context.clippingExtent)){Object(A.j)(c,s);var p=this._createGeometry(e,f.position,null,i.type),v=new Zi.a(p,a,t,r.uid);Object(Oi.l)(v.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),o.push(v)}}}catch(b){h.e(b)}finally{h.f()}return new Si(this,o,c)}},{key:"_patternHidesLine",get:function(){return"none"===this.symbolLayer.pattern}}]),r}(Ut);fn.elevationModeChangeTypes={definedChanged:Ke.a.RECREATE,staysOnTheGround:Ke.a.NONE,onTheGroundChanged:Ke.a.RECREATE};var pn=r(813),vn=r(784),bn=r(740);var mn=255,gn=85,yn=gn,On=2*gn,jn=r(661),xn=r(893),_n=["mesh"],Sn=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._materials=new Map,s._textures=new Map,s.ensureDrapedStatus(!1),s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:et.a.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new xn.a({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new xn.a({color:[0,1,1,1]}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.removeMany(Array.from(this._materials.values(),(function(e){return e.material}))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,_n,"fill on mesh-3d"))return null;var r=this.setGraphicElevationContext(t,new ft.a),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}},{key:"layerOpacityChanged",value:function(e,t){var r=this,i=this._getLayerOpacity();return this._materials.forEach((function(e){e.material.setParameterValues({layerOpacity:i});var t=e.material.params;r._setMaterialTransparentParameter(t,e),e.material.setParameterValues({transparent:t.transparent})})),e.forEach((function(e){var n=t(e);Object(f.k)(n)&&n.layerOpacityChanged(i,r._context.isAsync)})),!0}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ke.g)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return this._materials.forEach((function(e){e.material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})})),e.forEach((function(e){var i=t(e);Object(f.k)(i)&&i.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){var e=this._usePBR();return this._materials.forEach((function(t){return t.material.setParameterValues({usePBR:e})})),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"_requiresSymbolVertexColors",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_colorOrTextureUid",value:function(e){return Object(f.j)(e)?"-":e instanceof Qe.a?e.toHex():e.contentHash}},{key:"_materialPropertiesDefault",value:function(e,t){var r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:"vc:".concat(i,",vt:").concat(n,",vct").concat(t,",svc:").concat(r)}}},{key:"_materialProperties",value:function(e,t,r){var i=this._materialPropertiesDefault(e,r);if(!t.material)return i;var n=t.material,a=n.color,o=n.colorTexture,s=n.normalTexture,c=n.doubleSided,l=n.alphaCutoff,u=n.alphaMode,d=this._colorOrTextureUid(a),h=this._colorOrTextureUid(o),f=this._colorOrTextureUid(s);if(i.color=a,i.colorTexture=o,i.normalTexture=s,i.uid="".concat(i.uid,",cmuid:").concat(d,",ctmuid:").concat(h,",ntmuid:").concat(f,",ds:").concat(c,",ac:").concat(l,",am:").concat(u),t.material instanceof vn.a){var p=t.material,v=p.metallic,b=p.roughness,m=p.metallicRoughnessTexture,g=p.emissiveColor,y=p.emissiveTexture,O=p.occlusionTexture,j=this._colorOrTextureUid(m),x=this._colorOrTextureUid(g),_=this._colorOrTextureUid(y),S=this._colorOrTextureUid(O);i.metallic=v,i.roughness=b,i.metallicRoughnessTexture=m,i.emissiveColor=g,i.emissiveTexture=y,i.occlusionTexture=O,i.uid="".concat(i.uid,",mrm:").concat(v,",mrr:").concat(b,",mrt:").concat(j,",emuid:").concat(x,",etmuid:").concat(_,",otmuid:").concat(S)}return i}},{key:"_setInternalColorValueParameters",value:function(e,t){t.diffuse=Qe.a.toUnitRGB(e),t.opacity=e.a}},{key:"_getLoadableTextureResource",value:function(e){return e.data?e.data:e.url}},{key:"_getInternalTextureId",value:function(e){var t=this._getInternalTexture(e,1);return Object(f.k)(t)?t.id:void 0}},{key:"_getInternalTexture",value:function(e,t){var r=this._getLoadableTextureResource(e);if(r){var i="".concat(e.contentHash,"/").concat(t),n=this._textures.get(i);return n||(n=new Xi.a(r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:1!==t}),this._textures.set(i,n),this._context.stage.add(n)),n}}},{key:"_castTextureWrap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"repeat";if("string"==typeof e){var t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}},{key:"_castTextureWrapIndividual",value:function(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;default:return 10497}}},{key:"_setInternalMaterialParameters",value:function(e,t){if(Object(f.k)(e.color)&&this._setInternalColorValueParameters(e.color,t),Object(f.k)(e.colorTexture)){var r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);Object(f.k)(r)?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):t.textureId=void 0}Object(f.k)(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),Object(f.k)(e.emissiveColor)&&(t.emissiveFactor=Qe.a.toUnitRGB(e.emissiveColor)),Object(f.k)(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),Object(f.k)(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),Object(f.k)(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}},{key:"_setExternalMaterialParameters",value:function(e){var t=this._drivenProperties.color,r=Object(f.k)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=jt.a;else{var i=Object(f.k)(this.symbolLayer.material)?this.symbolLayer.material.color:null;Object(f.k)(i)?e.externalColor=Qe.a.toUnitRGBA(i):(r=null,e.externalColor=jt.a)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}},{key:"_hasTransparentVertexColors",value:function(e){var t=e.vertexAttributes.color;if(Object(f.j)(t))return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}},{key:"_getOrCreateMaterial",value:function(e,t){var r,i,n,a=null==(r=t.material)?void 0:r.color,o=null==(i=t.material)?void 0:i.colorTexture,s=null==(n=t.material)?void 0:n.alphaMode,c="blend"===s,l=!("opaque"===s)&&(this._hasTransparentVertexColors(e)||Object(f.k)(a)&&a.a<1||Object(f.k)(o)&&o.transparent||c),u=this._materialProperties(e,t,l),d=this._materials.get(u.uid);if(d)return d.material;var h={material:null,isComponentTransparent:l,alphaMode:t.material?t.material.alphaMode:"opaque"},p=null==u.metallicRoughnessTexture&&null==u.metallic&&null==u.roughness,v={usePBR:this._usePBR(),isSchematic:p,vertexColors:u.hasVertexColors,symbolColors:u.hasSymbolVertexColors,vertexTangents:u.hasVertexTangents,ambient:E.b,diffuse:E.a,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(v.mrrFactors=[null!=u.metallic?u.metallic:1,null!=u.roughness?u.roughness:1,.5]),t.material&&(v.doubleSided=t.material.doubleSided,v.cullFace=t.material.doubleSided?0:2,v.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(v),this._setMaterialTransparentParameter(v,h),this._setInternalMaterialParameters(u,v);var b=new Jr.a(v);return h.material=b,this._materials.set(u.uid,h),this._context.stage.add(b),b}},{key:"_usePBR",value:function(){return this._context.physicalBasedRenderingEnabled}},{key:"_setMaterialTransparentParameter",value:function(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode="opaque"===t.alphaMode?1:"mask"===t.alphaMode?2:0}},{key:"_addDebugNormals",value:function(e,t,r,i){for(var n=t.length,a=e.spatialReference.isGeographic?20015077/180:1,o=.1*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),s=[],c=[],l=[],u=[],d=0;d<n;d++)for(var h=t[d],f=h.vertexAttributes.get("position"),p=h.vertexAttributes.get("normal"),v=h.indices.get("position"),b=h.indices.get("normal"),m=f.data,g=p.data,y=0;y<v.length;y++){for(var O=3*v[y],j=3*b[y],x=0;x<3;x++)s.push(m[O+x]);for(var _=0;_<3;_++)s.push(m[O+_]+g[j+_]*o);if(c.push(c.length),c.push(c.length),y%3==0){this._calculateFaceNormal(m,v,y,En),this._getFaceVertices(m,v,y,Cn,kn,Pn),Object(P.f)(Cn,Cn,kn),Object(P.f)(Cn,Cn,Pn),Object(P.e)(Cn,Cn,1/3);for(var S=0;S<3;S++)l.push(Cn[S]);for(var w=0;w<3;w++)l.push(Cn[w]+En[w]*o);u.push(u.length),u.push(u.length)}}var C=new Yt.a([["position",{data:s,size:3,exclusive:!0}]],[["position",new Uint32Array(c)]],2);t.push(C),r.push(this._debugVertexNormalMaterial),i.push(Object(k.c)(i[0]));var E=new Yt.a([["position",{data:l,size:3,exclusive:!0}]],[["position",new Uint32Array(u)]],2);t.push(E),r.push(this._debugFaceNormalMaterial),i.push(Object(k.c)(i[0]))}},{key:"_createAs3DShape",value:function(e,t,r,i){var n=e.geometry;if("mesh"!==n.type)return null;var a=this._createGeometryInfo(n,t);if(!a)return null;var o=a.geometries,s=a.materials,c=a.transformations,l=a.objectTransformation;et.a.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,o,s,c);var u=new Qr.a({geometries:o,materials:s,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:i}});u.transformation=l;var d=it,h=this._createEdgeMaterial(),p=Object(f.k)(h)?{baseMaterial:s[0],edgeMaterials:[h],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,v=new vt(this,u,o,null,null,d,r,p);return v.needsElevationUpdates=Object(Ke.g)(r.mode),v.useObjectOriginAsAttachmentOrigin=!0,v.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(u),v.alignedSampledElevation=d(v,v.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),v}},{key:"getCenterPointInElevationSR",value:function(e){var t=Object(ge.g)(0,0,0,this._context.elevationProvider.spatialReference);return Object(T.q)([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}},{key:"_createComponentNormals",value:function(e,t,r,i){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,r,i);case"flat":return this._createComponentNormalsFlat(e,i);case"smooth":return this._createComponentNormalsSmooth(e,i);default:return}}},{key:"_createComponentNormalsSource",value:function(e,t,r,i){if(Object(f.j)(t))return this._createComponentNormalsFlat(e,i);var n=!1;if(!r.trustSourceNormals)for(var a=0;a<i.length;a+=3){this._calculateFaceNormal(e,i,a,En);for(var o=0;o<3;o++){var s=3*i[a+o];Cn[0]=t[s+0],Cn[1]=t[s+1],Cn[2]=t[s+2],Object(P.h)(En,Cn)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],n=!0)}}return{normals:t,indices:i,didFlipNormals:n}}},{key:"_createComponentNormalsFlat",value:function(e,t){for(var r=new Float32Array(t.length),i=new Uint32Array(3*t.length),n=0;n<t.length;n+=3)for(var a=this._calculateFaceNormal(e,t,n,En),o=0;o<3;o++)r[n+o]=a[o],i[n+o]=n/3;return{normals:r,indices:i,didFlipNormals:!1}}},{key:"_createComponentNormalsSmooth",value:function(e,t){for(var r={},i=0;i<t.length;i+=3)for(var n=this._calculateFaceNormal(e,t,i,En),a=0;a<3;a++){var o=t[i+a],s=r[o];s||(s={normal:Object(E.e)(),count:0},r[o]=s),Object(P.f)(s.normal,s.normal,n),s.count++}for(var c=new Float32Array(3*t.length),l=new Uint32Array(3*t.length),u=0;u<t.length;u++){var d=r[t[u]];1!==d.count&&(Object(P.r)(d.normal,d.normal),d.count=1);for(var h=0;h<3;h++)c[3*u+h]=d.normal[h];l[u]=u}return{normals:c,indices:l,didFlipNormals:!1}}},{key:"_getFaceVertices",value:function(e,t,r,i,n,a){var o=3*t[r+0],s=3*t[r+1],c=3*t[r+2];i[0]=e[o+0],i[1]=e[o+1],i[2]=e[o+2],n[0]=e[s+0],n[1]=e[s+1],n[2]=e[s+2],a[0]=e[c+0],a[1]=e[c+1],a[2]=e[c+2]}},{key:"_calculateFaceNormal",value:function(e,t,r,i){return this._getFaceVertices(e,t,r,Cn,kn,Pn),Object(P.j)(kn,kn,Cn),Object(P.j)(Pn,Pn,Cn),Object(P.g)(Cn,kn,Pn),Object(P.r)(i,Cn),i}},{key:"_getOrCreateComponents",value:function(e){return e.components?e.components:Dn}},{key:"_createPositionBuffer",value:function(e,t){var r=e.vertexAttributes.position,i=1===t.reprojection?t.transformBeforeProject:null;if(Object(f.k)(i)&&(r=Object(bn.h)(r,new Float64Array(r.length),i)),0===t.reprojection)return t.needsBufferCopy?new Float64Array(r):r;var n=Object(f.k)(i)?r:new Float64Array(r.length);return Object(T.l)(r,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}},{key:"_createNormalBuffer",value:function(e,t,r){var i=e.vertexAttributes.normal;if(Object(f.j)(i))return null;var n=1===r.reprojection?r.transformBeforeProject:null;if(Object(f.k)(n)&&(i=Object(bn.g)(i,new Float32Array(i.length),n)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;var a=e.vertexAttributes.position,o=Object(f.k)(n)?i:new Float32Array(i.length);return Object(bn.c)(i,a,t,e.spatialReference,o)}},{key:"_createTangentBuffer",value:function(e,t,r){var i=e.vertexAttributes.tangent;if(Object(f.j)(i))return null;var n=1===r.reprojection?r.transformBeforeProject:null;if(Object(f.k)(n)&&(i=Object(bn.i)(i,new Float32Array(i.length),n)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;var a=e.vertexAttributes.position,o=Object(f.k)(n)?i:new Float32Array(i.length);return Object(bn.e)(i,a,t,e.spatialReference,o)}},{key:"_createColorBuffer",value:function(e){return e.vertexAttributes.color}},{key:"_createSymbolColorBuffer",value:function(e){if(this._requiresSymbolVertexColors()){var t=this._getVertexOpacityAndColor(e),r=function(e){switch(e){default:return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4}}(Object(f.i)(this.symbolLayer,"material","colorMixMode")),i=new Uint8Array(4);return function(e,t,r){if(Object(f.j)(e)||2===t)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);var i=Object(w.d)(Math.round(e[3]*gn),0,gn),n=0===i||4===t?0:3===t?yn:On;r[0]=Object(w.d)(Math.round(e[0]*mn),0,mn),r[1]=Object(w.d)(Math.round(e[1]*mn),0,mn),r[2]=Object(w.d)(Math.round(e[2]*mn),0,mn),r[3]=i+n}(t,r,i),i}return null}},{key:"_createBuffers",value:function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var i=e.vertexAttributes.normal,n=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(Object(f.k)(i)&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(f.k)(a)&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(f.k)(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var o=this._computeReprojectionInfo(e),s=this._createPositionBuffer(e,o),c=this._createColorBuffer(e),l=this._createSymbolColorBuffer(t),u=this._createNormalBuffer(e,s,o),d=this._createTangentBuffer(e,s,o);return{positionBuffer:s,normalBuffer:u,tangentBuffer:d,uvBuffer:n,colorBuffer:c,symbolColorBuffer:l,objectTransformation:0===o.reprojection&&Object(f.k)(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,s,u,d),geometryTransformation:0===o.reprojection&&Object(f.k)(o.geometryTransformation)?o.geometryTransformation:Object(k.d)()}}},{key:"_computeReprojectionInfo",value:function(e){var t=Object(f.k)(e.transform)&&e.transform.geographic||2===this._context.renderCoordsHelper.viewingMode?0:1,r=null;if(Object(f.k)(e.transform)){if(0===t){var i=Object(k.d)();return Object(T.c)(e.spatialReference,e.transform.origin,i,this._context.renderCoordsHelper.spatialReference),{reprojection:t,objectTransformation:i,geometryTransformation:Object(k.c)(e.transform.localMatrix),needsBufferCopy:!1}}return r=Object(C.u)(Object(k.d)(),e.transform.origin),Object(C.n)(r,r,e.transform.localMatrix),{reprojection:t,transformBeforeProject:r,needsBufferCopy:!0}}return{reprojection:t,needsBufferCopy:!0}}},{key:"_transformOriginLocal",value:function(e,t,r,i){var n=this._context.renderCoordsHelper.spatialReference,a=e.anchor;wn[0]=a.x,wn[1]=a.y,wn[2]=a.z;var o=Object(k.d)();Object(T.c)(e.spatialReference,wn,o,n);var s=Fr.v.fromTypedArray(t);if(Object(C.c)(Tn,o),Object(Vr.e)(s,s,Tn),Object(f.k)(r)||Object(f.k)(i)){if(Object(Lr.f)(An,o),Object(Lr.m)(An,An),Object(f.k)(r)){var c=Fr.u.fromTypedArray(r);Object(Vr.a)(c,c,An)}if(Object(f.k)(i)){var l=Fr.u.fromTypedArray(i,4*i.BYTES_PER_ELEMENT);Object(Vr.a)(l,l,An)}}return o}},{key:"_validateFaces",value:function(e,t){var r=e.vertexAttributes.position.length/3,i=t.faces;if(i){for(var n=-1,a=0;a<i.length;a++){var o=i[a];o>n&&(n=o)}if(r<=n)return this.logger.warn("Vertex index ".concat(n," is out of bounds of the mesh position buffer")),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}},{key:"_getOrCreateFaces",value:function(e,t){return t.faces?t.faces:Object(jn.d)(e.vertexAttributes.position.length/3)}},{key:"_isOutsideClippingArea",value:function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var r,i=this._context.elevationProvider.spatialReference,n=t.length/3;return e.spatialReference.equals(i)?r=t:(r=new Float64Array(t.length),Object(T.l)(e.vertexAttributes.position,e.spatialReference,0,r,i,0,n)),Object(A.h)(Rn),Object(A.k)(Rn,r,0,n),!Object(A.r)(Rn,this._context.clippingExtent)}},{key:"_createGeometryInfo",value:function(e,t){if(!Object(T.a)(e.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var r=this._createBuffers(e,t);if(Object(f.j)(r))return null;var i,n=r.positionBuffer,a=r.uvBuffer,o=r.colorBuffer,s=r.symbolColorBuffer,c=r.normalBuffer,l=r.tangentBuffer,u=r.objectTransformation,d=r.geometryTransformation,h=this._getOrCreateComponents(e),p=[],v=[],b=[],m=!1,g=Object(_.a)(h);try{for(g.s();!(i=g.n()).done;){var y=i.value;if(!this._validateFaces(e,y))return null;var O=this._getOrCreateFaces(e,y);if(0!==O.length){var j=this._createComponentNormals(n,c,y,O);j.didFlipNormals&&(m=!0);var x=[["position",{size:3,data:n,exclusive:!0}],["normal",{size:3,data:j.normals,exclusive:!0}]],S=[["position",O],["normal",j.indices]];Object(f.k)(o)&&(x.push(["color",{size:4,data:o,exclusive:!0}]),S.push(["color",O])),Object(f.k)(s)&&(x.push(["symbolColor",{size:4,data:s,exclusive:!0}]),S.push(["symbolColor",new Uint16Array(O.length)])),Object(f.k)(a)&&(x.push(["uv0",{size:2,data:a,exclusive:!0}]),S.push(["uv0",O])),Object(f.k)(l)&&(x.push(["tangent",{size:4,data:l,exclusive:!0}]),S.push(["tangent",O]));var w=new Yt.a(x,S);p.push(w),v.push(d),b.push(this._getOrCreateMaterial(e,y))}}}catch(C){g.e(C)}finally{g.f()}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,transformations:v,materials:b,objectTransformation:u}}},{key:"_createEdgeMaterial",value:function(){var e={opacity:this._getLayerOpacity()};return Pt(this.symbolLayer,e)}}]),r}(Ut),wn=Object(E.e)(),Cn=Object(E.e)(),kn=Object(E.e)(),Pn=Object(E.e)(),En=Object(E.e)(),Tn=Object(k.d)(),An=Object(zr.b)(),Rn=Object(A.f)(),Dn=[new pn.a],Mn=r(332),In=r(790),Ln=function(){function e(t,r,i,n){Object(o.a)(this,e),this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}return Object(s.a)(e,[{key:"initialize",value:function(){}},{key:"setVisibility",value:function(e){var t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}},{key:"destroy",value:function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}},{key:"alignWithElevation",value:function(e,t,r){if(this.elevationAligner){Object(Fe.f)(this.elevationContext.featureExpressionInfoContext,r);var i=this.elevationAligner(this,this.elevationContext,e,t);null!=i&&(this.alignedSampledElevation=i)}}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(E.e)();return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Un),Object(P.q)(e,this.lodRenderer.baseBoundingSphere.center,Un)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(A.f)();this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Un);var t=this.lodRenderer.baseBoundingBox;Object(A.h)(e);for(var r=0;r<8;++r)Object(P.w)(Fn,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),Object(P.q)(Fn,Fn,Un),Object(A.n)(e,Fn);return e}},{key:"computeAttachmentOrigin",value:function(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Un),e.render.origin[0]+=Un[12],e.render.origin[1]+=Un[13],e.render.origin[2]+=Un[14],e.render.num++}},{key:"getProjectedBoundingBox",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r,i,a,o){var s,c,l,u,d,h,p,v,b,m;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),c=Gn,l=Object(A.s)(s)?1:c.length,this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Un),u=0;u<l;u++)d=c[u],Fn[0]=s[d[0]],Fn[1]=s[d[1]],Fn[2]=s[d[2]],Object(P.q)(Fn,Fn,Un),zn[3*u+0]=Fn[0],zn[3*u+1]=Fn[1],zn[3*u+2]=Fn[2];if(t(zn,0,l)){e.next=5;break}return e.abrupt("return",null);case 5:for(Object(A.h)(s),h=null,this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds()),p=0;p<3*l;p+=3){for(v=0;v<3;v++)s[v]=Math.min(s[v],zn[p+v]),s[v+3]=Math.max(s[v+3],zn[p+v]);h&&i.push({location:zn.slice(p,p+3),screenSpaceBoundingRect:h})}if(!r||(Object(A.d)(s,Vn),"absolute-height"===this.elevationContext.mode)){e.next=20;break}return m=Object($e.d)(s,r),e.prev=11,e.next=14,r.service.queryElevation(Vn[0],Vn[1],a,m,"ground");case 14:b=e.sent,e.next=19;break;case 17:e.prev=17,e.t0=e.catch(11);case 19:Object(f.k)(b)&&Object(A.u)(s,0,0,-this.alignedSampledElevation+b);case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,this,[[11,17]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){var r=this;if(0===e){var i=new In.a(e);this.addHighlightId(i),t.addExternal((function(e){r.removeHighlightId(e)}),i)}}},{key:"removeObjectState",value:function(e){this.highlights&&this.highlights.forEach((function(t){return e.remove(t)}))}},{key:"addHighlightId",value:function(e){this.highlights=this.highlights||new Set,this.highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}},{key:"removeHighlightId",value:function(e){this.highlights&&(this.highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this.highlights.size>0),0===this.highlights.size&&(this.highlights=null))}},{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]),e}(),zn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Fn=Object(E.e)(),Vn=Object(E.e)(),Gn=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Un=Object(k.d)();function Bn(e){return{levels:e.map((function(e){return function(e){var t=[];return e.stageResources.geometries.forEach((function(r,i){var n=e.stageResources.materials[i],a=e.stageResources.textures;t.push({material:n,geometry:r,textures:a})})),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}(e)}))}}function Nn(e){e.levels.forEach((function(e){e.minScreenSpaceRadius||(e.minScreenSpaceRadius=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wn,r=Dt(e);return Math.sqrt(r/(t*Math.PI))}(e))}))}var Hn,qn,Wn=.05,Yn=r(963),Zn=r(719),Xn=r(575),Qn=r(749),Jn=r(567),Kn=r(417);(qn=Hn||(Hn={}))[qn.ALLOCATED=1]="ALLOCATED",qn[qn.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",qn[qn.VISIBLE=4]="VISIBLE",qn[qn.HIGHLIGHT=8]="HIGHLIGHT",qn[qn.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",qn[qn.REMOVE=32]="REMOVE",qn[qn.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",qn[qn.ACTIVE=18]="ACTIVE";var $n=function e(t){Object(o.a)(this,e),this.localTransform=t.getField("localTransform",Fr.i),this.globalTransform=t.getField("globalTransform",Fr.i),this.modelOrigin=t.getField("modelOrigin",Fr.v),this.model=t.getField("model",Fr.f),this.modelNormal=t.getField("modelNormal",Fr.f),this.modelScaleFactors=t.getField("modelScaleFactors",Fr.m),this.boundingSphere=t.getField("boundingSphere",Fr.D),this.color=t.getField("color",Fr.C),this.featureAttribute=t.getField("featureAttribute",Fr.C),this.state=t.getField("state",Fr.l),this.lodLevel=t.getField("lodLevel",Fr.l)},ea=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i){var n;return Object(o.a)(this,r),(n=t.call(this))._capacity=0,n._size=0,n._next=0,n._layout=function(e){var t=Object(Qt.a)().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t.u8("state").u8("lodLevel").alignTo(8)}(e),n._shaderTransformation=i,n}return Object(s.a)(r,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"addInstance",value:function(){this._size+1>this._capacity&&this.grow();var e=this.findSlot();return this._view.state.set(e,Hn.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}},{key:"removeInstance",value:function(e){var t=this._view.state;Object(Jn.a)(e>=0&&e<this._capacity&&t.get(e)&Hn.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,Hn.ACTIVE)?this.setStateFlags(e,Hn.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}},{key:"freeInstance",value:function(e){var t=this._view.state;Object(Jn.a)(e>=0&&e<this._capacity&&t.get(e)&Hn.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}},{key:"setLocalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getLocalTransform",value:function(e,t){this._view.localTransform.getMat(e,t)}},{key:"setGlobalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getGlobalTransform",value:function(e,t){this._view.globalTransform.getMat(e,t)}},{key:"updateModelTransform",value:function(e){var t=this._view,r=ia,i=na;t.localTransform.getMat(e,aa),t.globalTransform.getMat(e,oa);var n=Object(C.n)(oa,oa,aa);Object(P.w)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),Object(Lr.f)(i,n),t.model.setMat(e,i);var a=Object(Kn.d)(ia,n);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),Object(Lr.e)(i,i),Object(Lr.m)(i,i),t.modelNormal.setMat(e,i),this.setStateFlags(e,Hn.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}},{key:"getModelTransform",value:function(e,t){var r=this._view;r.model.getMat(e,na),r.modelOrigin.getVec(e,ia),t[0]=na[0],t[1]=na[1],t[2]=na[2],t[3]=0,t[4]=na[3],t[5]=na[4],t[6]=na[5],t[7]=0,t[8]=na[6],t[9]=na[7],t[10]=na[8],t[11]=0,t[12]=ia[0],t[13]=ia[1],t[14]=ia[2],t[15]=1}},{key:"applyShaderTransformation",value:function(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}},{key:"getCombinedModelTransform",value:function(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}},{key:"getCombinedLocalTransform",value:function(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}},{key:"getCombinedMaxScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(ia,this,e);t*=Math.max(r[0],r[1],r[2])}return t}},{key:"getCombinedMedianScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(ia,this,e);r.sort(),t*=r[1]}return t}},{key:"getModel",value:function(e,t){this._view.model.getMat(e,t)}},{key:"setFeatureAttribute",value:function(e,t){this._view.featureAttribute.setVec(e,t)}},{key:"getFeatureAttribute",value:function(e,t){this._view.featureAttribute.getVec(e,t)}},{key:"setColor",value:function(e,t){this._view.color.setVec(e,t)}},{key:"getColor",value:function(e,t){this._view.color.getVec(e,t)}},{key:"setVisible",value:function(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,Hn.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}},{key:"getVisible",value:function(e){return this.getStateFlag(e,Hn.VISIBLE)}},{key:"setHighlight",value:function(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,Hn.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}},{key:"getHighlight",value:function(e){return this.getStateFlag(e,Hn.HIGHLIGHT)}},{key:"getState",value:function(e){return this._view.state.get(e)}},{key:"getLodLevel",value:function(e){return this._view.lodLevel.get(e)}},{key:"countFlags",value:function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}},{key:"setStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)}},{key:"clearStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)}},{key:"setStateFlag",value:function(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)}},{key:"getStateFlag",value:function(e,t){return!!(this._view.state.get(e)&t)}},{key:"grow",value:function(){var e=Math.max(ta,Math.floor(this._capacity*ra)),t=this._layout.createBuffer(e);if(this._buffer){var r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new $n(this._buffer)}},{key:"findSlot",value:function(){for(var e=this._view.state,t=this._next;e.get(t)&Hn.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}]),r}(Ve.a),ta=1024,ra=2,ia=Object(E.e)(),na=Object(zr.b)(),aa=Object(k.d)(),oa=Object(k.d)(),sa=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i){var n;return Object(o.a)(this,r),n=t.call(this,(function(e){return Object(pt.f)(n._instanceData.view.boundingSphere.getVec(e,n._tmpSphere))}),{maximumDepth:25}),n._tmpSphere=Object(pt.b)(),n._tmpMat4=Object(k.d)(),n._instanceData=e,n._boundingSphere=i,n}return Object(s.a)(r,[{key:"addInstance",value:function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Object(P.q)(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Object(Kn.c)(r),t.setVec(e,this._tmpSphere),this.add([e])}},{key:"removeInstance",value:function(e){this.remove([e])}}]),r}(r(865).a),ca=function(){function e(t,r){Object(o.a)(this,e),this.thresholdScale=1,this._camera=new Qn.a,this._worldSpaceRadius=t,this._thresholds=r.map((function(e){return e}))}return Object(s.a)(e,[{key:"updateCamera",value:function(e){this._camera.copyFrom(e)}},{key:"selectLevel",value:function(e,t){for(var r=this._camera.computeScreenPixelSizeAt(e),i=this._worldSpaceRadius*t/r,n=this._thresholds,a=-1,o=0;o<n.length;++o)i>=n[o]*this.thresholdScale&&(a=o);return a}}]),e}(),la=r(793),ua=r(654),da=r(550),ha=r(551),fa=function(){function e(t,r){Object(o.a)(this,e);var i=t.renderContext.rctx,n=r.geometry,a=r.material;this.materialRep=t.materialRep,a.setParameterValues({instancedDoublePrecision:!0});var s=a.createBufferWriter(),c=s.vertexBufferLayout,l=s.elementCount(n),u=s.allocate(l);s.write({},n,u,0),this.geometry=n,this.material=a,this.glMaterials=Object(ua.a)(a,this.materialRep),this.vertexBufferLayout=c,this.vbo=da.a.createVertex(i,35044,u.buffer),this.vao=new ha.a(i,sr.a,{geometry:Object(Zn.a)(c)},{geometry:this.vbo}),this.vertexCount=l}return Object(s.a)(e,[{key:"destroy",value:function(){Object(ua.f)(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}},{key:"intersect",value:function(e,t,r,i,n,a){var o=this.geometry.id,s=n.toString();this.material.intersect(this.geometry,null,e.transform.transform,e,r,i,(function(r,i,c,l){if(r>=0){if(null!=t&&!t(e.rayBeginPoint,e.rayEndPoint,r))return;var u={type:"external",metadata:{layerUid:a.layerUid,graphicUid:a.graphicUid(n)}};if((null==e.results.min.drapedLayerOrder||l>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&(e.results.min.set(u,s,r,i,e.transform.transform,l,null,o,c),e.results.min.intersector="LodRenderer"),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||l>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&(e.results.max.set(u,s,r,i,e.transform.transform,l,null,o,c),e.results.min.intersector="LodRenderer"),2===e.options.store){var d=new la.a(e.results.min.ray);d.set(u,s,r,i,e.transform.transform,l,null,o,c),d.intersector="LodRenderer",e.results.all.push(d)}}}))}}]),e}(),pa=function(){function e(t,r){Object(o.a)(this,e),this.minScreenSpaceRadius=t,this.components=r}return Object(s.a)(e,[{key:"destroy",value:function(){this.components.forEach((function(e){e.destroy()}))}},{key:"intersect",value:function(e,t,r,i,n,a){this.components.forEach((function(o){o.intersect(e,t,r,i,n,a)}))}},{key:"boundingBox",get:function(){if(!this._boundingBox){var e=Object(A.h)();this.components.forEach((function(t){Object(f.k)(t.boundingInfo)&&(Object(A.n)(e,t.boundingInfo.bbMin),Object(A.n)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}},{key:"boundingSphere",get:function(){if(!this._boundingSphere){var e=this.boundingBox,t=Object(E.e)();Object(A.d)(e,t),this._boundingSphere={center:t,radius:.5*Object(A.g)(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((function(e,t){return e+t.triangleCount}),0)}}],[{key:"create",value:function(){var t=Object(a.a)(n.a.mark((function t(r,i,a){var o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(i.components.map((function(e){return r.schedule((function(){return new fa(r,e)}),a)})));case 2:return o=t.sent,t.abrupt("return",new e(i.minScreenSpaceRadius,o));case 4:case"end":return t.stop()}}),t)})));return function(e,r,i){return t.apply(this,arguments)}}()}]),e}(),va=function(){function e(t,r,i){Object(o.a)(this,e),this._elementSize=r,this._buffer=da.a.createVertex(t,35044),this.resize(i)}return Object(s.a)(e,[{key:"destroy",value:function(){this._buffer.dispose()}},{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}},{key:"copyRange",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}},{key:"transferAll",value:function(){this._buffer.setData(this._array)}},{key:"transferRange",value:function(e,t){var r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(this._array,r,r,i)}},{key:"resize",value:function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e}}]),e}(),ba=function e(t){Object(o.a)(this,e),this.modelOriginHi=t.getField("modelOriginHi",Fr.u),this.modelOriginLo=t.getField("modelOriginLo",Fr.u),this.model=t.getField("model",Fr.f),this.modelNormal=t.getField("modelNormal",Fr.f),this.color=t.getField("instanceColor",Fr.C),this.featureAttribute=t.getField("instanceFeatureAttribute",Fr.C)},ma=function(){function e(t,r){Object(o.a)(this,e),this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}return Object(s.a)(e,[{key:"destroy",value:function(){this._buffer&&this._buffer.destroy()}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}},{key:"reset",value:function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}},{key:"startUpdateCylce",value:function(){this._captureFirstIndex=!0}},{key:"beginUpdate",value:function(){Object(Jn.a)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}},{key:"endUpdate",value:function(){Object(Jn.a)(this._updating,"not updating"),this.size<Oa*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}},{key:"allocateHead",value:function(){Object(Jn.a)(this._updating,"not updating"),this.isFull&&this.grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),Object(Jn.a)(this._headIndex!==this._tailIndex,"invalid pointers"),e}},{key:"freeTail",value:function(){Object(Jn.a)(this._updating,"not updating"),Object(Jn.a)(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)}},{key:"grow",value:function(){var e=Math.max(ga,Math.floor(this._capacity*ya));this.resize(e)}},{key:"shrink",value:function(){var e=Math.max(ga,Math.floor(this._capacity*ja));this.resize(e)}},{key:"resize",value:function(e){if(Object(Jn.a)(this._updating,"not updating"),e!==this._capacity){var t=new va(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,i=this.compactInstances(t);Object(Jn.a)(i===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new ba(this._instanceBufferLayout.createView(this._buffer.array))}}},{key:"compactInstances",value:function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}},{key:"incrementHead",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._headIndex=(this._headIndex+e)%this._capacity}},{key:"incrementTail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._tailIndex=(this._tailIndex+e)%this._capacity}},{key:"transferRange",value:function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}]),e}(),ga=1024,ya=2,Oa=.3,ja=.5,xa=r(720),_a=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map((function(e){return e.minScreenSpaceRadius}));return new ca(t,r)};var Sa=function(){function e(t,r,i,n){var a=this;Object(o.a)(this,e),this.type="Lod",this.isGround=!1,this._inverseViewport=Object(L.a)(),this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Qn.a,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.canRender=!0,this._symbol=t,this._optionalFields=r,this._metadata=i,this._instanceBufferLayout=Jr.a.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=Object(Zn.a)(this._instanceBufferLayout,1),this._instanceData=new ea(this._optionalFields,n),this._instanceData.on("instance-added",(function(){a.requestUpdateCycle()})),this._instanceData.on("instance-removed",(function(){a.requestUpdateCycle()})),this._instanceData.on("instance-transform-changed",(function(e){a.requestUpdateCycle(),a._metadata.notifyGraphicGeometryChanged(e.index)})),this._instanceData.on("instance-visibility-changed",(function(e){a.requestUpdateCycle(!0),a._metadata.notifyGraphicVisibilityChanged(e.index)})),this._instanceData.on("instance-highlight-changed",(function(){a.requestUpdateCycle(!0)})),this._enableLevelSelection=this._symbol.levels.length>1}return Object(s.a)(e,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlane",get:function(){return this._slicePlane},set:function(e){this._slicePlane=e}},{key:"intersectionHandlerId",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){var e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),this._highlightRenderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),e}},{key:"renderStats",get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach((function(t,i){var n=e._defaultRenderInstanceData[i],a=e._highlightRenderInstanceData[i],o=n.size+a.size,s=t.triangleCount;r.push({renderedInstances:o,renderedTriangles:o*s,trianglesPerInstance:s})})),{totalInstances:t,renderedInstances:r.reduce((function(e,t){return e+t.renderedInstances}),0),renderedTriangles:r.reduce((function(e,t){return e+t.renderedTriangles}),0),levels:r}}},{key:"initializeRenderContext",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){var i,a=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._context=t,i=t.renderContext.rctx,e.next=4,Object(ne.b)(this._symbol.levels.map((function(e){return a._defaultRenderInstanceData.push(new ma(i,a._instanceBufferLayout)),a._highlightRenderInstanceData.push(new ma(i,a._instanceBufferLayout)),pa.create(t,e,r)})));case 4:this._levels=e.sent,this._levelSelector=_a(this);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uninitializeRenderContext",value:function(){this.invalidateOctree(),this._levels.forEach((function(e){return e.destroy()})),this._defaultRenderInstanceData.forEach((function(e){return e.destroy()})),this._highlightRenderInstanceData.forEach((function(e){return e.destroy()}))}},{key:"slots",get:function(){return[4,6]}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.reduce((function(e,t){return e+t.size}),0)>0}},{key:"prepareRender",value:function(e,t){if(!et.a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var r=t.equals(this._lastCamera);this._lastCamera.copyFrom(t),r||this.requestUpdateCycle()}var i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(t,i),this.needsUpdates&&this._context.requestRender()}}},{key:"render",value:function(e){var t=e.rctx,r=4===e.slot?3:6===e.slot?5:null;if(r){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;var i=e.camera;this._inverseViewport[0]=1/i.fullViewport[2],this._inverseViewport[1]=1/i.fullViewport[3];var n={slot:r,origin:[0,0,0],camera:i,inverseViewport:this._inverseViewport,shadowMap:e.shadowMap,shadowMappingEnabled:e.shadowMap.enabled,ssaoHelper:e.ssaoHelper,ssaoEnabled:e.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:e.sliceHelper&&e.sliceHelper.plane,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:e.scenelightingData,transparencyPassType:e.transparencyPassType,terrainLinearDepthTexture:e.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:e.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:e.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:e.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:e.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};t.bindVAO();var a=5!==e.pass&&7!==e.pass,o=6!==e.pass;return a&&this._renderComponents(e,r,n,this._defaultRenderInstanceData),o&&this._renderComponents(e,r,n,this._highlightRenderInstanceData),!0}}},{key:"intersect",value:function(e,t,r,i){var n=this;if(this.baseMaterial.isVisible()){var a=Object(E.e)();Object(P.j)(a,i,r);var o=function(a){n._instanceData.getCombinedModelTransform(a,Pa),e.transform.set(Pa),Object(P.q)(Ea,r,e.transform.inverse),Object(P.q)(Ta,i,e.transform.inverse);var o=n._instanceData.getState(a),s=n._instanceData.getLodLevel(a);Object(Jn.a)(o&Hn.ACTIVE,"invalid instance state"),Object(Jn.a)(s>=0&&s<n._levels.length,"invaid lod level"),n._levels[s].intersect(e,t,Ea,Ta,a,n._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,a,o)}}},{key:"queryDepthRange",value:function(e){return this.queryDepthRangeOctree(e)}},{key:"notifyShaderTransformationChanged",value:function(){this.invalidateOctree()}},{key:"requestUpdateCycle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}},{key:"needsUpdates",get:function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}},{key:"octree",get:function(){return this._octree||(this._octree=this.buildOctree()),this._octree}},{key:"invalidateOctree",value:function(){this._octree&&(this._octree.destroy(),this._octree=null)}},{key:"buildOctree",value:function(){for(var e=new sa(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null,i=0;i<this._instanceData.capacity;++i)r.get(i)&Hn.ACTIVE&&e.addInstance(i);return e}},{key:"queryDepthRangeOctree",value:function(e){var t=e.eye,r=e.viewForward,i=this.octree.findClosest(r,1,e.frustum),n=this.octree.findClosest(r,-1,e.frustum);if(null!=i&&null!=n){this._instanceData.view.boundingSphere.getVec(i,ka),Object(P.j)(ka,ka,t);var a=Object(P.h)(ka,r)-ka[3];this._instanceData.view.boundingSphere.getVec(n,ka),Object(P.j)(ka,ka,t);var o=Object(P.h)(ka,r)+ka[3];return{near:Math.max(e.near,a),far:Math.min(e.far,o)}}return{near:1/0,far:-1/0}}},{key:"startUpdateCycle",value:function(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((function(e){e.startUpdateCylce()})),this._highlightRenderInstanceData.forEach((function(e){e.startUpdateCylce()})),this.needsUpdates&&this._context.requestRender()}},{key:"updateInstances",value:function(e,t){var r=this._enableLevelSelection,i=this._levelSelector;i.updateCamera(e),this._defaultRenderInstanceData.forEach((function(e){e.beginUpdate()})),this._highlightRenderInstanceData.forEach((function(e){e.beginUpdate()}));var n=this._instanceData,a=this._instanceData.view,o=n.size,s=n.capacity,c=this._instanceIndex;t=Math.min(o,t);for(var l=0;l<t;++l){0===c&&this.startUpdateCycle();var u=a.state.get(c),d=0;if(u&Hn.ALLOCATED){var h=a.lodLevel.get(c);if(u&Hn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[h].freeTail(),u&Hn.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[h].freeTail(),u&Hn.REMOVE)n.freeInstance(c);else if(u&Hn.VISIBLE){var f=0;r&&(a.modelOrigin.getVec(c,Ca),f=i.selectLevel(Ca,n.getCombinedMedianScaleFactor(c))),d=u&~(Hn.ACTIVE|Hn.TRANSFORM_CHANGED),f>=0&&(u&Hn.HIGHLIGHT?(wa(this._highlightRenderInstanceData[f],a,c),d|=Hn.HIGHLIGHT_ACTIVE):(wa(this._defaultRenderInstanceData[f],a,c),d|=Hn.DEFAULT_ACTIVE)),a.state.set(c,d),a.lodLevel.set(c,f)}else d=u&~(Hn.ACTIVE|Hn.TRANSFORM_CHANGED),a.state.set(c,d);if(this._octree){var p=!!(u&Hn.ACTIVE),v=!!(d&Hn.ACTIVE);!p&&v?this._octree.addInstance(c):p&&!v?this._octree.removeInstance(c):p&&v&&u&Hn.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%s}else c=(c+1)%s,t++}this._instanceIndex=c,this._defaultRenderInstanceData.forEach((function(e){e.endUpdate()})),this._highlightRenderInstanceData.forEach((function(e){e.endUpdate()}))}},{key:"_renderComponents",value:function(e,t,r,i){var n=this;this.levels.forEach((function(a,o){a.components.forEach((function(a){n._renderComponent(e,t,r,i[o],a,o)}))}))}},{key:"_renderComponent",value:function(e,t,r,i,n,a){var o=n.glMaterials.get(e.pass);if(o&&o.beginSlot(t)&&0!==i.size){var s=e.rctx,c=s.capabilities.instancing;o.ensureParameters(r);var l=o.technique,u=l.program,d=o.getPipelineState(t);s.setPipelineState(d),s.useProgram(u),o.bind(r),s.bindVAO(n.vao),l.ensureAttributeLocations(n.vao),e.isHighlightPass&&Object(Xn.b)(u,r),l.bindDraw(r,{},{}),et.a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(u.setUniform4fv("externalColor",Aa[Math.min(a,Aa.length-1)]),u.setUniform1i("colorMixMode",lr.b.replace));var h=i.capacity,f=i.headIndex,p=i.tailIndex,v=i.firstIndex,b=this._glInstanceBufferLayout,m=function(e,t){Object(xa.a)(s,sr.a,i.buffer,b,e),c.drawArraysInstanced(l.primitiveType,0,n.vertexCount,t-e),Object(xa.e)(s,sr.a,i.buffer,b)};n.material.params.transparent&&null!=v?f>p?(Object(Jn.a)(v>=p&&v<=f,"invalid firstIndex"),m(v,f),m(p,v)):f<p&&(v<=f?(Object(Jn.a)(v>=0&&v<=f,"invalid firstIndex"),m(v,f),m(p,h),m(0,v)):(Object(Jn.a)(v>=p&&v<=h,"invalid firstIndex"),m(v,h),m(0,f),m(p,v))):f>p?m(p,f):f<p&&(m(0,f),m(p,h)),s.bindVAO(null)}}}]),e}();function wa(e,t,r){var i=e.allocateHead();!function(e,t,r,i){Object(ua.d)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}(t,r,e.view,i)}var Ca=Object(E.e)(),ka=Object(jt.e)(),Pa=Object(k.d)(),Ea=Object(E.e)(),Ta=Object(E.e)(),Aa=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Ra=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._resources=null,s._optionalFields=new Array,s._instanceIndexToGraphicUid=new Map,s.hasLoadedPBRTextures=!1,s.ensureDrapedStatus(!1),s.hasLoadedPBRTextures=n.physicalBasedRenderingEnabled,s}return Object(s.a)(r,[{key:"getCachedSize",value:function(){var e=Object(f.k)(this._resources)?this._resources.symbolSize:[1,1,1],t=Object(de.a)(e,3);return{width:t[0],depth:t[1],height:t[2]}}},{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=3;break}if(!Object($e.j)(this.symbolLayer)){e.next=3;break}throw new Error;case 3:if(r=this.symbolLayer,!this.isPrimitive){e.next=11;break}return i=r.resource?r.resource.primitive:_t.b,e.next=8,this._createResourcesForPrimitive(i,t);case 8:this._resources=e.sent,e.next=14;break;case 11:return e.next=13,this._createResourcesForUrl(r.resource.href,t);case 13:this._resources=e.sent;case 14:this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity();case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extentPadding",get:function(){return Object(f.k)(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return Object(f.i)(this._resources,"lodRenderer")}},{key:"setMaterialTransparencyParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(f.i)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?0:2,e}},{key:"_createResourcesForPrimitive",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){var i,a,o,s,c,l,u,d,h,p,v,b,m,g,y,O,j,x,_,S;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wt(t)){e.next=2;break}throw new Error("Unknown object symbol primitive: ".concat(t));case 2:if(i=this.symbolLayer,a=Object(A.f)(Object(Mn.b)(t)),o=Object(E.f)(Object(A.z)(a)),s=Object(E.f)(Object(Mn.c)(o,i)),c=Object(P.p)(s),l=!1,u=!1,d={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:E.a,diffuse:E.a,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=d.usePBR,this.setMaterialTransparencyParams(d),"point-3d"===(p=this.symbol).type&&p.verticalOffset&&(v=p.verticalOffset,b=v.screenLength,m=v.minWorldLength,g=v.maxWorldLength,d.verticalOffset={screenLength:Object(Je.g)(b),minWorldLength:m||0,maxWorldLength:null!=g?g:1/0},d.castShadows=!1),this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color?d.externalColor=jt.a:(y=Object(f.k)(i.material)&&i.material.color,O=Object(f.k)(y)?Qe.a.toUnitRGBA(y):jt.a,d.externalColor=O),this._fastUpdates=Ui(this._context.renderer,this._fastVisualVariableConvertOptions(a,s,o,f.o)),this._fastUpdates.enabled?(Object.assign(d,this._fastUpdates.materialParameters),d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color")),j=new Jr.a(d),x=Ct(t,j)){e.next=11;break}throw new Error("Unknown object symbol primitive: ".concat(t));case 11:return _=At(x).map((function(e){return{opacity:1,transparent:e.params.transparent}})),S=this._createStageResources(x,h),e.t0=x,e.next=15,this._createLodRenderer(x,r);case 15:return e.t1=e.sent,e.t2=S,e.t3=s,e.t4=c,e.t5=l,e.t6=u,e.t7=_,e.t8=h,e.t9=a,e.t10=o,e.t11=f.o,e.t12=f.o,e.abrupt("return",{lodResources:e.t0,lodRenderer:e.t1,stageResources:e.t2,symbolSize:e.t3,extentPadding:e.t4,isEsriSymbolResource:e.t5,isWosr:e.t6,originalMaterialParameters:e.t7,physicalBasedRenderingEnabled:e.t8,resourceBoundingBox:e.t9,resourceSize:e.t10,dispose:e.t11,pivotOffset:e.t12});case 28:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createResourcesForUrl",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){var i,a,o,s,c,l,u,d,h,p,v,b,m,g,y,O,j,x,_,S,w,C,k,T,R,D,M,I=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={materialParamsMixin:{instanced:i=["transformation"],slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=Ui(this._context.renderer,this._fastVisualVariableConvertOptions(f.o,f.o,f.o,f.o)),this._fastUpdates.enabled?(Object.assign(a.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),"point-3d"===(o=this.symbol).type&&o.verticalOffset&&(s=o.verticalOffset,c=s.screenLength,l=s.minWorldLength,u=s.maxWorldLength,a.materialParamsMixin.verticalOffset={screenLength:Object(Je.g)(c),minWorldLength:l||0,maxWorldLength:null!=u?u:1/0},a.materialParamsMixin.castShadows=!1),a.signal=r,a.usePBR=this._context.physicalBasedRenderingEnabled,d=a.usePBR,e.next=8,Object(Yn.fetch)(t,a);case 8:return h=e.sent,p=h.isEsriSymbolResource,v=h.isWosr,b=h.remove,Nn(m=Bn(h.lods)),m.levels.sort((function(e,t){return e.minScreenSpaceRadius-t.minScreenSpaceRadius})),m.levels[0].minScreenSpaceRadius=Math.min(2,m.levels[0].minScreenSpaceRadius),g=this._context,y=this.symbolLayer.material,O=this._getExternalColorParameters(y),j=Object(f.i)(this.symbolLayer,"material","color"),x=this._getCombinedOpacity(j,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,S=At(m),w=At(m).map((function(e){return{opacity:e.params.opacity||1,transparent:e.params.transparent}})),S.forEach((function(e){var t=e.params;e.setParameterValues(O);var r=t.opacity*x,i=r<1||_||t.transparent;e.setParameterValues({opacity:r,transparent:i}),g.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:g.sharedResources.screenSizePerspectiveSettings})})),C=h.referenceBoundingBox,k=Object(E.f)(Object(A.z)(C)),T=Object(E.f)(m.levels[0].pivotOffset),R=Object(E.f)(Object(Mn.c)(k,this.symbolLayer)),D=Object(P.p)(R),Bi(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(C,R,k,T))&&S.forEach((function(e){return e.setParameterValues(I._fastUpdates.materialParameters)})),M=this._createStageResources(m,d),e.t0=m,e.next=22,this._createLodRenderer(m,r);case 22:return e.t1=e.sent,e.t2=M,e.t3=R,e.t4=D,e.t5=p,e.t6=v,e.t7=w,e.t8=d,e.t9=C,e.t10=k,e.t11=b,e.t12=T,e.abrupt("return",{lodResources:e.t0,lodRenderer:e.t1,stageResources:e.t2,symbolSize:e.t3,extentPadding:e.t4,isEsriSymbolResource:e.t5,isWosr:e.t6,originalMaterialParameters:e.t7,physicalBasedRenderingEnabled:e.t8,resourceBoundingBox:e.t9,resourceSize:e.t10,dispose:e.t11,pivotOffset:e.t12});case 35:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createStageResources",value:function(e,t){var r=this._context.stage,i=At(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(i);var n=function(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){e.textures&&t.push.apply(t,Object(ue.a)(e.textures))}))})),Object(Le.l)(t)}(e);r.addMany(n);var a=function(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){t.push(e.geometry)}))})),Object(Le.l)(t)}(e);return r.addMany(a),{materials:i,textures:n,geometries:a}}},{key:"_createLodRenderer",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){var i,a,o,s,c=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._context.stage,a={layerUid:this._context.layer.uid,graphicUid:function(e){return c._instanceIndexToGraphicUid.get(e)},notifyGraphicGeometryChanged:function(e){return c._context.notifyGraphicGeometryChanged(c._instanceIndexToGraphicUid.get(e))},notifyGraphicVisibilityChanged:function(e){return c._context.notifyGraphicVisibilityChanged(c._instanceIndexToGraphicUid.get(e))}},o=this._fastUpdates.enabled?{applyTransform:function(e,t,r){e.getFeatureAttribute(t,La),Object(C.f)(r,Wi(c._fastUpdates.materialParameters,La,r))},scaleFactor:function(e,t,r){return t.getFeatureAttribute(r,La),Yi(e,c._fastUpdates.materialParameters,La)}}:null,(s=new Sa(t,this._optionalFields,a,o)).slicePlane=this._context.slicePlaneEnabled,e.next=4,i.addRenderPlugin(s.slots,s,r);case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getExternalColorParameters",value:function(e){var t={};return this._drivenProperties.color?t.externalColor=jt.a:Object(f.k)(e)&&Object(f.k)(e.color)?t.externalColor=Qe.a.toUnitRGBA(e.color):(t.externalColor=jt.a,t.colorMixMode="ignore"),t}},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this);var e=this._context.stage;if(Object(f.k)(this._resources)){e.removeRenderPlugin(this._resources.lodRenderer);var t=this._resources.stageResources;e.removeMany(t.materials),e.removeMany(t.textures),e.removeMany(t.geometries),Object(f.k)(this._resources.dispose)&&this._resources.dispose()}this._resources=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=Object(Wt.d)(t.geometry);if(Object(f.j)(r))return this.logger.warn("unsupported geometry type for icon symbol: ".concat(t.geometry.type)),null;var i=this.setGraphicElevationContext(t,new ft.a),n=e.renderingInfo;return this._createAs3DShape(t,r,n,i,t.uid)}},{key:"notifyDestroyGraphicLayer",value:function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}},{key:"graphicLayerToGraphicId",value:function(){return 0}},{key:"layerOpacityChanged",value:function(){if(Object(f.j)(this._resources))return!0;for(var e=this._drivenProperties.opacity,t=!this.isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters,n=0;n<r.length;n++){var a=r[n],o=Object(f.i)(this.symbolLayer,"material","color"),s=i[n],c=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*s.opacity,l=c<1||e||s.transparent;a.setParameterValues({opacity:c,transparent:l}),this.isPrimitive&&a.setParameterValues({cullFace:l?0:2})}return!0}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ke.g)}},{key:"slicePlaneEnabledChanged",value:function(){if(Object(f.j)(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;var e,t=Object(_.a)(this._resources.stageResources.materials);try{for(t.s();!(e=t.n()).done;){e.value.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})}}catch(r){t.e(r)}finally{t.f()}return!0}},{key:"physicalBasedRenderingChanged",value:function(){if(Object(f.j)(this._resources))return!0;var e,t=this._resources,r=t.stageResources,i=t.isWosr,n=Object(_.a)(r.materials);try{for(n.s();!(e=n.n()).done;){var a=e.value;this.isPrimitive?a.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||a.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1})}}catch(o){n.e(o)}finally{n.f()}return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"applyRendererDiff",value:function(e,t){if(Object(f.j)(this._resources))return!0;var r=this._resources,i=r.stageResources.materials,n=r.lodRenderer,a=r.resourceBoundingBox,o=r.symbolSize,s=r.resourceSize,c=r.pivotOffset;for(var l in e.diff){if("visualVariables"!==l)return!1;if(!Bi(this._fastUpdates,t,this._fastVisualVariableConvertOptions(a,o,s,c)))return!1;var u,d=Object(_.a)(i);try{for(d.s();!(u=d.n()).done;){u.value.setParameterValues(this._fastUpdates.materialParameters)}}catch(h){d.e(h)}finally{d.f()}n.notifyShaderTransformationChanged()}return!0}},{key:"computeComplexity",value:function(){return Object(f.j)(this._resources)?Object(c.a)(Object(l.a)(r.prototype),"computeComplexity",this).call(this):{primitivesPerFeature:Rt(this._resources.lodResources.levels[0]).reduce((function(e,t){return e+t.indices.get("position").length}),0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Ft(this.symbol,this.symbolLayer)}}},{key:"hasLodRenderer",value:function(){return Object(f.k)(this._resources)}},{key:"_createAs3DShape",value:function(e,t,r,i,n){if(!this.hasLodRenderer()||Object(f.j)(this._resources))return null;var a=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Object($e.g)(r.color,r.opacity):null,s=this._context.clippingExtent;if(Object(T.o)(t,Da,this._context.elevationProvider.spatialReference),Object(f.k)(s)&&!Object(A.e)(s,Da))return null;var c=this._requiresTerrainElevation(i),l=this._computeGlobalTransform(t,i,Ia,c?za:null),u=this._computeLocalTransform(this._resources,this.symbolLayer,r,Ma),d=this._resources.lodRenderer.instanceData,h=d.addInstance();this._instanceIndexToGraphicUid.set(h,n),d.setLocalTransform(h,u,!1),d.setGlobalTransform(h,l),a&&d.setFeatureAttribute(h,a),o&&d.setColor(h,o);var p=new Ln(this,h,at,i);return c&&(p.alignedSampledElevation=za.sampledElevation),p.needsElevationUpdates=Object(Ke.g)(i.mode),Object(Wt.b)(p,t,this._context.elevationProvider),p}},{key:"_computeGlobalTransform",value:function(e,t,r,i){var n=Object(Ke.e)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i);return Da[0]=e.x,Da[1]=e.y,Da[2]=n,Object(T.c)(e.spatialReference,Da,r,this._context.renderCoordsHelper.spatialReference),r}},{key:"_computeLocalTransform",value:function(e,t,r,i){return Object(C.j)(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}},{key:"_applyObjectScale",value:function(e,t,r){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=Object($e.c)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||Object(C.g)(r,r,n)}}},{key:"prepareSymbolLayerPatch",value:function(e){if("partial"===e.diff.type){var t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}}},{key:"updateGeometry",value:function(e,t){if(Object(f.j)(this._resources))return!0;var r=t&&Object(Wt.d)(t);if(Object(f.j)(r))return!1;var i=this.getGeometryElevationMode(t);if(e.elevationContext.mode!==i)return!1;var n=this._requiresTerrainElevation(e.elevationContext);return this._computeGlobalTransform(r,e.elevationContext,Ia,n?za:null),n&&(e.alignedSampledElevation=za.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Ia,!0),Object(Wt.b)(e,r,this._context.elevationProvider),!0}},{key:"_preparePatchTransform",value:function(e,t){var r=this;if((t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition)&&!Object(f.j)(this._resources)){var i=function(e,t,r){return Object(f.t)(null!=e&&"complete"===e.type?e.newValue:t,r)},n=i(t.heading,this.symbolLayer.heading,0),a=i(t.tilt,this.symbolLayer.tilt,0),o=i(t.roll,this.symbolLayer.roll,0),s=i(t.width,this.symbolLayer.width,void 0),c=i(t.height,this.symbolLayer.height,void 0),l=i(t.depth,this.symbolLayer.depth,void 0),u=i(t.anchor,this.symbolLayer.anchor,void 0),d=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;var h={heading:n,tilt:a,roll:o,anchor:u,anchorPosition:d},p=this._resources;1===this.loadStatus&&e.symbolLayerStatePatches.push((function(){p.symbolSize=Object(E.f)(Object(Mn.c)(p.resourceSize,{width:s,height:c,depth:l,isPrimitive:r.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((function(e,t){var i=r._computeLocalTransform(p,h,t,Ma),n=e.instanceIndex;p.lodRenderer.instanceData.setLocalTransform(n,i,!0)}))}}},{key:"_preparePatchColor",value:function(e,t){var r=this;if(t.material&&"partial"===t.material.type){var i=t.material.diff;if(i.color&&"complete"===i.color.type&&null!=i.color.newValue&&null!=i.color.oldValue){var n=i.color.newValue,a=Object(f.k)(n)?Qe.a.toUnitRGBA(n):jt.a;delete i.color;var o=this._resources;Object(f.j)(o)||e.graphics3DGraphicPatches.push((function(e){var t;r._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(e.instanceIndex,a),t=r.setMaterialTransparencyParams({},n)):t=r.setMaterialTransparencyParams({externalColor:a},n);var i,s=Object(_.a)(o.stageResources.materials);try{for(s.s();!(i=s.n()).done;){i.value.setParameterValues(t)}}catch(c){s.e(c)}finally{s.f()}}))}}}},{key:"_requiresTerrainElevation",value:function(e){return"absolute-height"!==e.mode}},{key:"_applyObjectRotation",value:function(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Object($e.b)(e.heading,e.tilt,e.roll,r)}},{key:"_computeAnchor",value:function(e,t,r){var i=Object(E.e)();switch(r.anchor){case"center":Object(P.k)(i,Object(A.d)(e)),Object(P.s)(i,i);break;case"top":var n=Object(A.d)(e);Object(P.w)(i,-n[0],-n[1],-e[5]);break;case"bottom":var a=Object(A.d)(e);Object(P.w)(i,-a[0],-a[1],-e[2]);break;case"relative":var o=Object(A.d)(e),s=Object(A.z)(e),c=r.anchorPosition,l=c?Object(E.g)(c.x,c.y,c.z):E.b;Object(P.a)(i,s,l),Object(P.f)(i,i,o),Object(P.s)(i,i);break;default:Object(f.k)(t)?Object(P.s)(i,t):Object(P.k)(i,E.b)}return i}},{key:"_applyAnchor",value:function(e,t,r){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var i=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);i&&Object(C.t)(r,r,i)}}},{key:"_hasPerInstanceColor",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_fastVisualVariableConvertOptions",value:function(e,t,r,i){var n=Object(f.k)(e)?Object(E.f)(Object(A.z)(e)):E.a,a=Object(f.k)(e)?this._computeAnchor(e,i,this.symbolLayer):E.b,o=this._context.renderCoordsHelper.unitInMeters,s=Object($e.c)(Object(f.k)(t)?t:void 0,t,r,o),c=Object(E.g)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:Object(f.k)(t)?t:E.a,unitInMeters:o,transformation:{anchor:a,scale:s,rotation:c}}}}]),r}(Ut),Da=Object(E.e)(),Ma=Object(k.d)(),Ia=Object(k.d)(),La=Object(jt.e)(),za={verticalDistanceToGround:0,sampledElevation:0},Fa=r(46);function Va(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Ga(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],c=r[1],l=r[2],u=r[3];return e[0]=i*s+a*c,e[1]=n*s+o*c,e[2]=i*l+a*u,e[3]=n*l+o*u,e}function Ua(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var Ba=Ga,Na=Ua,Ha=(Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},set:Va,transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:Ga,rotate:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*s,e[1]=n*c+o*s,e[2]=i*-s+a*c,e[3]=n*-s+o*c,e},scale:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],c=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*c,e[3]=o*c,e},fromRotation:function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},LDU:function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:Ua,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(r-o)<=Fa.a*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Fa.a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-c)<=Fa.a*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=Fa.a*Math.max(1,Math.abs(a),Math.abs(l))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},mul:Ba,sub:Na}),r(713)),qa=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a,s,c){var l;return Object(o.a)(this,r),(l=t.call(this,e,i)).path=n,l.geometrySR=a,l.upVectorAlignment=s,l.stencilWidth=c,l}return r}(Yt.a);function Wa(e){return"upVectorAlignment"in e}function Ya(){return[1,0,0,1]}Object.freeze({__proto__:null,create:Ya,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,r,i){return[e,t,r,i]},createView:function(e,t){return new Float64Array(e,t,4)}});function Za(){return{up:Object(E.e)(),right:Object(E.e)()}}function Xa(e,t,r){Object(P.q)(e.up,t.up,r),Object(P.q)(e.right,t.right,r)}function Qa(e,t,r){Object(Er.s)(e,Object(P.h)(r,t.right),Object(P.h)(r,t.up))}var Ja=function(){function e(){Object(o.a)(this,e),this.pos=Object(E.e)(),this.posES=Object(E.e)(),this.posGS=Object(E.e)(),this.vRight=Object(E.e)(),this.vLeft=Object(E.e)(),this.frame=Za(),this.rotationFrame=Za(),this.rotationRight=Object(L.a)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1]}return Object(s.a)(e,[{key:"setFrameFromUpVector",value:function(e){Object(P.k)(this.frame.up,e),Object(P.f)(mo,this.vLeft,this.vRight),Object(P.r)(mo,mo),Object(P.e)(bo,this.frame.up,Object(P.h)(mo,this.frame.up)),Object(P.j)(Oo,mo,bo),Object(P.r)(Oo,Oo),Object(P.g)(this.frame.right,Oo,this.frame.up)}},{key:"computeRotationAxisAndAngleFromUpVector",value:function(){Object(P.k)(this.rotationFrame.up,this.frame.up),Object(P.k)(this.rotationFrame.right,this.frame.right),Object(Er.s)(this.rotationRight,1,0),Object(P.e)(bo,this.frame.up,Object(P.h)(this.frame.up,this.vLeft)),Object(P.j)(bo,this.vLeft,bo),Object(P.s)(bo,bo),Object(P.r)(bo,bo),Object(P.e)(mo,this.frame.up,Object(P.h)(this.frame.up,this.vRight)),Object(P.j)(mo,this.vRight,mo),Object(P.r)(mo,mo),Object(P.g)(go,this.rotationFrame.up,this.vLeft);var e=Object(w.p)(Object(P.h)(go,this.vRight));if(this.rotationAngle=e*(Math.PI-Object(w.a)(Object(P.h)(bo,mo))),Math.abs(this.rotationAngle)>0){var t=Object(w.o)(Math.cos(.5*this.rotationAngle));Va(this.miterStretch,t-1+1,0,0,1)}var r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r))}}]),e}(),Ka=function(){function e(){Object(o.a)(this,e),this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}return Object(s.a)(e,[{key:"addVertex",value:function(e,t){return this.vertices.push(Object(L.b)(e)),this.vertexNormals.push(Object(L.b)(t)),this.vertices.length-1}},{key:"addUV",value:function(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}},{key:"addPole",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.poles.push({position:Object(L.b)(e),normal:t?Object(L.b)(t):null}),this.poles.length-1}},{key:"addSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}},{key:"numSegments",get:function(){return this.vertexIndices.length/2}},{key:"hasUV",value:function(){return null!=this.uvs}},{key:"translate",value:function(e,t){var r,i=Object(_.a)(this.vertices);try{for(i.s();!(r=i.n()).done;){var n=r.value;n[0]+=e,n[1]+=t}}catch(c){i.e(c)}finally{i.f()}var a,o=Object(_.a)(this.poles);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.position[0]+=e,s.position[1]+=t}}catch(c){o.e(c)}finally{o.f()}}}],[{key:"circle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=.5,i=new e,n={v0:0,v1:0};i.addPole(Object(L.e)(0,0));for(var a=0;a<t;++a){var o=2*a*Math.PI/t,s=Math.cos(o),c=Math.sin(o),l=Object(L.e)(s*r,c*r),u=Object(L.e)(s,c);i.addVertex(l,u),i.addUV(a/t)}i.addUV(1);for(var d=0;d<t-1;++d){var h={v0:d,v1:d+1},f=h;i.addSegment(h,f,n)}var p={v0:t-1,v1:0},v={v0:t-1,v1:t};return i.addSegment(p,v,n),i}},{key:"rect",value:function(){var t=new e,r=Object(L.e)(-.5,-.5),i=Object(L.e)(.5,-.5),n=Object(L.e)(.5,.5),a=Object(L.e)(-.5,.5),o=Object(L.e)(0,-1),s=Object(L.e)(1,0),c=Object(L.e)(0,1),l=Object(L.e)(-1,0);t.addUV(0),t.addUV(1),t.addPole(Object(L.e)(0,.5),c),t.addPole(Object(L.e)(0,.5)),t.addPole(Object(L.e)(0,-.5)),t.addPole(Object(L.e)(0,-.5),o);var u={v0:0,v1:1};return t.addVertex(r,o),t.addVertex(i,o),t.addSegment({v0:0,v1:1},u,{v0:3,v1:3}),t.addVertex(i,s),t.addVertex(n,s),t.addSegment({v0:2,v1:3},u,{v0:2,v1:1}),t.addVertex(n,c),t.addVertex(a,c),t.addSegment({v0:4,v1:5},u,{v0:0,v1:0}),t.addVertex(a,l),t.addVertex(r,l),t.addSegment({v0:6,v1:7},u,{v0:1,v1:2}),t}}]),e}(),$a=function(){function e(t){Object(o.a)(this,e),this.vertices=[],this.offset=Object(E.e)(),this.xform=Object(k.d)(),this.vertices=t;var r=Math.floor((t.length-1)/2);Object(P.k)(this.offset,this.vertices[r].pos);var i,n=Object(_.a)(this.vertices);try{for(n.s();!(i=n.n()).done;){var a=i.value;Object(P.j)(a.pos,a.pos,this.offset)}}catch(s){n.e(s)}finally{n.f()}Object(C.t)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}return Object(s.a)(e,[{key:"updatePathVertexInformation",value:function(){var e=this.vertices.length,t=this.vertices[0];t.index=0,Object(P.w)(t.vLeft,0,0,0),t.vLeftLength=0,Object(P.j)(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=Object(P.p)(t.vRight),Object(P.r)(t.vRight,t.vRight);for(var r=t,i=1;i<e;++i)(t=this.vertices[i]).index=i,Object(P.k)(t.vLeft,r.vRight),t.vLeftLength=r.vRightLength,i<e-1?(Object(P.j)(t.vRight,this.vertices[i+1].pos,t.pos),t.vRightLength=Object(P.p)(t.vRight),Object(P.r)(t.vRight,t.vRight)):(Object(P.k)(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),r=t}}]),e}();var eo=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"numProfilesPerJoin",value:function(){return 1}},{key:"extrude",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],!1)}}]),e}(),to=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8*Math.PI,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(o.a)(this,e),this.cutoffAngle=t,this.numBendSubdivisions=r}return Object(s.a)(e,[{key:"numProfilesPerJoin",value:function(){return this.numBendSubdivisions+1}},{key:"extrude",value:function(e,t,r){var i=jo;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(var n=0;n<this.numBendSubdivisions+1;++n){Object(C.j)(xo),Object(C.e)(xo,xo,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),Xa(i,e.frame,xo);for(var a=0;a<t.vertices.length;++a)Object(Er.h)(t.vertices[a],e.rotationRight)*e.rotationAngle>=0?r(e.index,i,t.vertices[a],t.vertexNormals[a],!1):(Object(Er.o)(fo,t.vertices[a],e.miterStretch),r(e.index,e.frame,fo,t.vertexNormals[a],!0))}else for(var o=0;o<this.numBendSubdivisions+1;++o)for(var s=0;s<t.vertices.length;++s){var c=Object(Er.h)(t.vertices[s],e.rotationRight)*e.rotationAngle>=0;Object(Er.o)(fo,t.vertices[s],e.miterStretch),r(e.index,e.frame,fo,t.vertexNormals[s],!c)}}}]),e}(),ro={generateUV:!1},io=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],0,0)}}]),e}(),no=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.call(this)}return Object(s.a)(r,[{key:"getNumVertices",value:function(){return 0}},{key:"getNumIndices",value:function(){return 0}},{key:"rebuildCapGeometry",value:function(){}},{key:"buildTopology",value:function(){}}]),r}(io),ao=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(o.a)(this,r),(i=t.call(this)).profile=e,i.profilePlaneOffset=n,i.flip=a,i}return Object(s.a)(r,[{key:"getNumVertices",value:function(){return this.profile.vertices.length}},{key:"getNumIndices",value:function(){return 3*this.profile.numSegments}},{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],this.profilePlaneOffset,0)}},{key:"rebuildCapGeometry",value:function(e,t){var r=po;Object(Er.s)(r,0,0);for(var i=this.flip?1:-1,n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,i)}},{key:"buildTopology",value:function(e,t){for(var r=this.vertexBufferStart+this.profile.vertexIndices[0],i=1;i<this.profile.numSegments;++i){var n=this.profile.vertexIndices[2*i+0],a=this.profile.vertexIndices[2*i+1],o=this.vertexBufferStart+n,s=this.vertexBufferStart+a;this.flip?t(s,o,r):t(r,o,s)}}}]),r}(io),oo=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this)).flip=!1,i.sign=0,i.breakNormals=!1,i.numSegments=3,i.profile=e.profile,i.flip=e.flip,i.sign=i.flip?1:-1,i.breakNormals=e.breakNormals,i.numSegments=e.subdivisions,i}return Object(s.a)(r,[{key:"getNumVertices",value:function(){var e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length}},{key:"getNumIndices",value:function(){var e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(var t=0;t<this.profile.numSegments;++t){var r=this.profile.vertexIndices[2*t+0],i=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[i]?e+=1:e+=2}return 3*e}},{key:"rebuildCapGeometry",value:function(e,t){var r=e.frame,i=.5*this.sign,n=fo,a=po;Object(Er.s)(a,0,0);for(var o=0;o<this.profile.poles.length;++o){var s=this.profile.poles[o];s.normal?t(e.index,r,s.position,s.normal,i,0):t(e.index,r,s.position,a,i,this.sign)}if(this.breakNormals)for(var c=0;c<this.profile.vertices.length;++c)t(e.index,r,this.profile.vertices[c],this.profile.vertexNormals[c],0,0);for(var l=0;l<this.numSegments-1;++l)for(var u=(1-(l+1)/this.numSegments)*Math.PI*.5,d=Math.sin(u),h=Math.cos(u),f=0;f<this.profile.vertices.length;++f){var p=this.profile.poles[this.profile.poleIndices[f]];Object(Er.a)(n,this.profile.vertices[f],p.position),Object(Er.b)(n,n,d),p.normal?(Object(Er.i)(n,n,p.position),t(e.index,r,n,p.normal,i*h,0)):(Object(Er.f)(a,n),Object(Er.b)(a,a,d),Object(Er.i)(n,n,p.position),t(e.index,r,n,a,i*h,this.sign*h))}}},{key:"buildTopology",value:function(e,t){for(var r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,n=0;n<this.profile.numSegments;++n){for(var a=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],s=this.vertexBufferStart+this.profile.poleIndices[a],c=this.vertexBufferStart+this.profile.poleIndices[o],l=r+a,u=r+o,d=0;d<this.numSegments-1;++d){var h=i+d*this.profile.vertices.length+a,f=i+d*this.profile.vertices.length+o;this.flip?(t(h,u,l),t(u,h,f)):(t(l,u,h),t(f,h,u)),l=h,u=f}this.flip?(t(s,u,l),s!==c&&t(s,c,u)):(t(l,u,s),s!==c&&t(u,c,s))}}}]),r}(io),so=function(){function e(t,r,i,n,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ro;Object(o.a)(this,e),this.options=s,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=n,this.endCap=a;var c=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*c+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;var l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;var u=this.endCap.getNumVertices();this.numVerticesTotal+=u,this.numNormalsTotal+=u,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this.rebuildGeometry(),this.buildTopology()}return Object(s.a)(e,[{key:"emitVertex",value:function(e,t,r,i,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){var a=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}},{key:"emitCapVertex",value:function(e,t,r,i,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}},{key:"emitTriangle",value:function(e,t,r){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}},{key:"rebuildGeometry",value:function(){var e=this,t=function(t,r,i,n,a){return e.emitVertex(t,r,i,n,a)},r=function(t,r,i,n,a,o){return e.emitCapVertex(t,r,i,n,a,o)};this._extrusionVertexCount=0;var i,n=Object(_.a)(this.path.vertices);try{for(n.s();!(i=n.n()).done;){var a=i.value;this.originData[3*a.index+0]=a.pos[0],this.originData[3*a.index+1]=a.pos[1],this.originData[3*a.index+2]=a.pos[2]}}catch(c){n.e(c)}finally{n.f()}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(var o=1;o<this.path.vertices.length-1;++o)this.extruder.extrude(this.path.vertices[o],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r),this.profile.hasUV()&&this.options.generateUV)for(var s=0;s<this.profile.uvs.length;++s)this.uvData[2*s+0]=this.profile.uvs[s],this.uvData[2*s+1]=0}},{key:"buildTopology",value:function(){var e=this,t=function(t,r,i){return e.emitTriangle(t,r,i)};this._triangleCount=0;var r=this.profile.vertices.length,i=this.profile.numSegments,n=this.numExtrusionProfiles-1,a=i*n*2*3;this.startCap.indexBufferStart=a,this.startCap.firstProfileVertexIndex=0,a+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=a,this.endCap.firstProfileVertexIndex=r*(this.numExtrusionProfiles-1),a+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(a),this.normalIndices=new Uint32Array(a),this.pathVertexIndices=new Uint32Array(a),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(a));for(var o=0;o<i;++o)for(var s=this.profile.vertexIndices[2*o],c=this.profile.vertexIndices[2*o+1],l=0;l<n;++l){var u=l*r+s,d=(l+1)*r+c,h=l*r+c;t(u,(l+1)*r+s,d),t(u,d,h)}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}},{key:"onPathChanged",value:function(){this.rebuildGeometry()}}]),e}(),co=function(){function e(t){Object(o.a)(this,e),this.builder=t}return Object(s.a)(e,[{key:"xform",get:function(){return this.builder.path.xform}},{key:"onPathChanged",value:function(){this.builder.onPathChanged()}}]),e}(),lo=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).vertexAttributePosition=null,i.vertexAttributeNormal=null,i.vertexAttributeColor=null,i.vertexAttributePosition=new Float32Array(3*i.builder.numVerticesTotal),i.vertexAttributeNormal=new Float32Array(3*i.builder.numNormalsTotal),i.vertexAttributeColor=new Uint8Array(4),i.vertexAttributeColor[0]=255,i.vertexAttributeColor[1]=255,i.vertexAttributeColor[2]=255,i.vertexAttributeColor[3]=255,i}return Object(s.a)(r,[{key:"bakeVertexColors",value:function(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}},{key:"bake",value:function(e){this.size=e;for(var t=0;t<this.builder.numVerticesTotal;++t){var r=this.builder.pathVertexData[t],i=0===r||r===this.builder.path.vertices.length-1;r*=3;var n=ho;Object(P.w)(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);var a=4*t,o=bo,s=fo,c=mo,l=go,u=yo,d=0,h=0;if(Object(P.w)(l,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),Object(P.w)(u,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),Object(Er.s)(s,this.builder.profileVertexAndNormalData[a]*e[0],this.builder.profileVertexAndNormalData[a+1]*e[1]),i)Object(P.g)(c,u,l),d=this.builder.profileRightAxisData[a+3]*e[0],h=this.builder.profileUpAxisData[a+3];else{var f=po,p=vo;Object(Er.s)(f,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);var v=Object(Er.l)(f);Object(Er.f)(f,f);var b=Object(Er.h)(s,f);if(Math.abs(b)>v){Object(Er.s)(p,-f[1],f[0]);var m=Object(Er.h)(s,p);Object(Er.b)(f,f,v*Object(w.p)(b)),Object(Er.b)(p,p,m),Object(Er.i)(s,f,p)}Object(P.w)(c,0,0,0)}Object(P.w)(o,l[0]*s[0]+u[0]*s[1],l[1]*s[0]+u[1]*s[1],l[2]*s[0]+u[2]*s[1]),this.vertexAttributePosition[3*t+0]=n[0]+o[0]+c[0]*d,this.vertexAttributePosition[3*t+1]=n[1]+o[1]+c[1]*d,this.vertexAttributePosition[3*t+2]=n[2]+o[2]+c[2]*d;var g=fo;Object(Er.s)(g,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*t+0]=l[0]*g[0]+u[0]*g[1]+c[0]*h,this.vertexAttributeNormal[3*t+1]=l[1]*g[0]+u[1]*g[1]+c[1]*h,this.vertexAttributeNormal[3*t+2]=l[2]*g[0]+u[2]*g[1]+c[2]*h}}},{key:"createGeometryData",value:function(){var e=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],t=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){var r=this.builder.vertexIndices.length;e.push(["color",new Uint32Array(r)]),t.push(["color",{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}},{key:"onPathChanged",value:function(){Object(c.a)(Object(l.a)(r.prototype),"onPathChanged",this).call(this),this.bake(this.size)}},{key:"intersect",value:function(e,t,r){var i=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},a=i.length/3;Object(lr.g)(e,t,0,a,i,n,void 0,void 0,r)}}]),r}(co),uo=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;Object(o.a)(this,r),(s=t.call(this,e)).sizeAttributeValue=i,s.colorAttributeValue=n,s.opacityAttributeValue=a,s.vvData=null,s.baked=new lo(e),s.vvData=new Float32Array(4*s.builder.path.vertices.length);for(var c=0;c<s.builder.path.vertices.length;++c){s.vvData[4*c+0]=i,s.vvData[4*c+1]=n,s.vvData[4*c+2]=a;var l=0===c||c===s.builder.path.vertices.length-1;s.vvData[4*c+3]=l?1:0}return s}return Object(s.a)(r,[{key:"createGeometryData",value:function(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}}}]),r}(co),ho=Object(E.e)(),fo=Object(L.a)(),po=Object(L.a)(),vo=Object(L.a)(),bo=Object(E.e)(),mo=Object(E.e)(),go=Object(E.e)(),yo=Object(E.e)(),Oo=Object(E.e)(),jo=Za(),xo=Object(k.d)(),_o=r(935),So=r(774),wo=r(568),Co=r(643),ko=r(613),Po=r(701),Eo=r(936),To=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]),Ao=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(s.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:i.receiveSSAO,doubleSidedMode:i.doubleSidedMode,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new cr.a(e.rctx,n,To)}},{key:"bindPass",value:function(e,t){var r,i;Object(ir.c)(this.program,t.camera.projectionMatrix),this.program.setUniform3fv("size",e.size),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(wo.a)(this.program,t)),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",e.opacity),0===this.configuration.output?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform3fv("specular",e.specular),this.program.setUniform1f("opacity",e.opacity)):1!==this.configuration.output&&3!==this.configuration.output||Object(ir.b)(this.program,t.camera.nearFar),Object(_o.b)(this.program,e),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program,t.camera)}},{key:"bindDraw",value:function(e){Object(ir.d)(this.program,e),Object($t.c)(this.program,this.configuration,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(ir.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(Co.c)(this.program,e),2===this.configuration.output&&So.a.bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}},{key:"setPipelineState",value:function(e){var t=this.configuration,r=3===e,i=2===e;return Object(dr.f)({blending:0!==t.output&&7!==t.output||!t.transparent?null:r?ko.g:Object(ko.a)(e),culling:function(e){return!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode)}(t)&&dr.e,depthTest:{func:Object(ko.b)(e)},depthWrite:r||i?dr.d:null,colorWrite:dr.c,stencilWrite:t.sceneHasOcludees?Po.h:null,stencilTest:t.sceneHasOcludees?Po.c:null,polygonOffset:r||i?null:ko.d})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),r}(ar.a);Ao.shader=new nr.a(Eo.a,(function(){return r.e(209).then(r.bind(null,1118))}));var Ro=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).output=0,e.doubleSidedMode=0,e.receiveShadows=!1,e.receiveSSAO=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(or.a);Object(h.a)([Object(or.b)({count:8})],Ro.prototype,"output",void 0),Object(h.a)([Object(or.b)({count:3})],Ro.prototype,"doubleSidedMode",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"receiveShadows",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"receiveSSAO",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"vvSize",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"vvColor",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"vvOpacity",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"slicePlaneEnabled",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"transparent",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"sceneHasOcludees",void 0),Object(h.a)([Object(or.b)({count:4})],Ro.prototype,"transparencyPassType",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"multipassTerrainEnabled",void 0),Object(h.a)([Object(or.b)()],Ro.prototype,"cullAboveGround",void 0);var Do=r(867),Mo=Jn.a,Io=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e,zo)).supportsEdges=!0,i._vertexAttributeLocations=To,i.techniqueConfig=new Ro,i.vertexBufferLayout=r.getVertexBufferLayout(i.params),i}return Object(s.a)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,0!==e&&7!==e||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO),this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;return!!Object(c.a)(Object(l.a)(r.prototype),"isVisible",this).call(this)&&e.opacity>0}},{key:"intersect",value:function(e,t,r,i,n,a,o){var s=e;if(Wa(s)){var c=s.path,l=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var u=this.params.vvSizeOffset,d=this.params.vvSizeFactor,h=this.params.vvSizeMinSize,p=this.params.vvSizeMaxSize,v=c.sizeAttributeValue;l[0]*=Object(w.d)(u[0]+v*d[0],h[0],p[0]),l[1]*=Object(w.d)(u[2]+v*d[2],h[2],p[2])}var b=Math.max(l[0],l[1]),m=e.boundingInfo;if(Object(f.j)(m))this._intersectTriangles(c,l,n,a,o);else{var g=Object(A.p)(m.bbMin[0]-b,m.bbMin[1]-b,m.bbMin[2]-b,m.bbMax[0]+b,m.bbMax[1]+b,m.bbMax[2]+b),y=[a[0]-n[0],a[1]-n[1],a[2]-n[2]],O=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),j=[O/y[0],O/y[1],O/y[2]];Object(lr.d)(g,n,j,i.tolerance)&&this._intersectTriangles(c,l,n,a,o)}}}},{key:"_intersectTriangles",value:function(e,t,r,i,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n)}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return null;var i=r.get("position");return Object(jn.a)(i,null,!1,t)}},{key:"createBufferWriter",value:function(){return new Fo(this.vertexBufferLayout)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.params.castShadows)return new Lo(e)}}],[{key:"getVertexBufferLayout",value:function(e){var t=Object(Qt.a)().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f("featureValue")),t}}]),r}(Zt.a),Lo=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).updateParameters(),i}return Object(s.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Ao,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return e===(this._technique.configuration.transparent?5:3)||23===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._technique.configuration.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),r}(Jt.a),zo=Object(te.a)(Object(te.a)({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},Do.a.Default),Zt.b),Fo=function(){function e(t){Object(o.a)(this,e),this.vertexBufferLayout=t}return Object(s.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){var n=function(e){if(t.vertexAttributes.has(e)){var n=t.vertexAttributes.get(e),a=t.indices.get(e);Mo(4===n.size);var o=r.getField(e,Fr.C);if(!o)throw new Error("unable to acquire view for "+e);Object(Kt.a)(a,n.data,o,i)}};n("profileRight"),n("profileUp"),n("profileVertexAndNormal"),this.vertexBufferLayout.hasField("featureValue")&&n("featureValue"),Object(Kt.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}]),e}(),Vo=["polyline"],Go=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._intrinsicSize=Object(L.e)(1,1),s.upVectorAlignment="path",s.stencilWidth=.1,s.ensureDrapedStatus(!1),s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,h,p,v;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(f.k)(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=Object(f.k)(this.symbolLayer.height)?this.symbolLayer.height:t,this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Ui(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},i=this.symbolLayer.anchor||"center",this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world"),a=this.symbolLayer.profile||"circle",this._profile="quad"===a?Ka.rect():Ka.circle(Ko),o=[0,0],"center"!==i&&(o={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(o[0],o[1])),e.t0=this.symbolLayer.join||"simple",e.next="round"===e.t0?11:"bevel"===e.t0?13:"miter"===e.t0?15:17;break;case 11:return this._extruder=new to(0,Qo),e.abrupt("break",18);case 13:return this._extruder=new to(0,1),e.abrupt("break",18);case 15:return this._extruder=new to(.8*Math.PI,1),e.abrupt("break",18);case 17:this._extruder=new eo;case 18:s=this.symbolLayer.cap||"butt",e.t1=s,e.next="none"===e.t1?22:"square"===e.t1?26:"round"===e.t1?28:24;break;case 22:return this._startCap=new no,this._endCap=new no,e.abrupt("break",31);case 24:return this._startCap=new ao(this._profile,0),this._endCap=new ao(this._profile,0,!0),e.abrupt("break",31);case 26:return this._startCap=new ao(this._profile,-.5),this._endCap=new ao(this._profile,.5,!0),e.abrupt("break",31);case 28:return c="quad"===a,this._startCap=new oo({profile:this._profile,flip:!1,breakNormals:c,subdivisions:Jo}),this._endCap=new oo({profile:this._profile,flip:!0,breakNormals:c,subdivisions:Jo}),e.abrupt("break",31);case 31:if(l=Object(f.i)(this.symbolLayer,"material","color"),u=this._getCombinedOpacityAndColor(l),d=Object(E.f)(u),h=u[3],p=h<1||this.needsDrivenTransparentPass,v={diffuse:d,ambient:d,opacity:h,transparent:p,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||"none"===s?0:2,offsetTransparentBackfaces:!0},this._drivenProperties.size||(Object(Er.s)(this._intrinsicSize,t,r),Object($e.f)(this._intrinsicSize[0])&&Object($e.f)(this._intrinsicSize[1]))){e.next=34;break}throw new pe.a("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");case 34:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Object(Er.b)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(v,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new Io(v)):(v.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Jr.a(v)),this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material);case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Vo,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new ft.a),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}},{key:"layerOpacityChanged",value:function(){var e=Object(f.i)(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({opacity:t,transparent:r}),!0}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Ke.g)}},{key:"slicePlaneEnabledChanged",value:function(){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){if("visualVariables"!==r)return!1;if(!Bi(this._fastUpdates,t,this._vvConvertOptions))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters)}return!0}},{key:"getVertexData",value:function(e){var t,r=0,i=e.paths,n=[],a=e.spatialReference,o=this._context.elevationProvider.spatialReference,s=this._context.renderCoordsHelper.spatialReference,c=Object(_.a)(i);try{for(c.s();!(t=c.n()).done;){r+=t.value.length}}catch(O){c.e(O)}finally{c.f()}var l,u=new Float64Array(3*r),d=new Float64Array(3*r),h=new Float64Array(3*r),f=0,p=Object(_.a)(i);try{for(p.s();!(l=p.n()).done;){var v=l.value;n.push({index:f,numVertices:v.length});var b,m=Object(_.a)(v);try{for(m.s();!(b=m.n()).done;){var g=b.value;u[f++]=g[0],u[f++]=g[1],u[f++]=e.hasZ?g[2]:0}}catch(O){m.e(O)}finally{m.f()}}}catch(O){p.e(O)}finally{p.f()}var y=!0;return a.equals(o)?this._copyVertices(u,0,d,0,r):y=Object(T.l)(u,a,0,d,o,0,r),o.equals(s)?this._copyVertices(d,0,h,0,r):Object(T.l)(d,o,0,h,s,0,r),{pathVertexDataInfos:n,vertexDataGS:u,vertexDataES:d,vertexDataRS:h,projectionSuccess:y,terrainElevation:0}}},{key:"_copyVertices",value:function(e,t,r,i,n){t*=3,i*=3;for(var a=0;a<n;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}},{key:"_createAs3DShape",value:function(e,t,r,i){var n=e.geometry,a=new Array,o=new Array,s=new Array,c=n.spatialReference,l=Object(A.f)(),u=this._context.renderCoordsHelper;Wo.spatialReference=c;var d=this.getVertexData(n);if(!d.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(d.pathVertexDataInfos.length>0){for(var h=0;h<d.pathVertexDataInfos.length;++h){var p=d.pathVertexDataInfos[h],v=p.index,b=p.numVertices;if(!(b<2)&&(!Object(f.k)(this._context.clippingExtent)||(Object(A.h)(l),Object(A.k)(l,d.vertexDataES,3*v,b),Object(A.r)(l,this._context.clippingExtent)))){for(var m=[],g=v;g<v+3*b;){var y=g++,O=g++,j=g++,x=new Ja;Object(P.w)(x.posGS,d.vertexDataGS[y],d.vertexDataGS[O],d.vertexDataGS[j]),Object(P.w)(x.posES,d.vertexDataES[y],d.vertexDataES[O],d.vertexDataES[j]);var _=Object(Ke.e)(x.posES,this._context.elevationProvider,r,u,null);Object(P.w)(Yo,d.vertexDataRS[y],d.vertexDataRS[O],d.vertexDataRS[j]),u.setAltitude(Yo,_),Object(P.w)(x.pos,Yo[0],Yo[1],Yo[2]),m.push(x)}var S=new $a(m);Uo(S,this.upVectorAlignment,this._context.renderCoordsHelper);var w=new so(S,this._profile,this._extruder,this._startCap,this._endCap),C=null;if(this._fastUpdates.enabled){var k=this._fastUpdates.visualVariables,E=k.size?Bt(k.size.field,e):0,T=k.color?Bt(k.color.field,e):0,R=k.opacity?Bt(k.opacity.field,e):0;C=new uo(w,E,T,R)}else{var D=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(D[0]*=Bo(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),D[1]*=Bo(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));var M=null;this._drivenProperties.color&&(M=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(M=M?[M[0],M[1],M[2],t.opacity]:[1,1,1,t.opacity]);var I=new lo(w);I.bake(D),M&&I.bakeVertexColors(M),C=I}var L=C.createGeometryData(),z=L.vertexAttributes,F=L.indices,V=new qa(z,F,C,c,this.upVectorAlignment,this.stencilWidth);a.push(V),o.push(this._material),s.push(C.xform)}}if(a.length>0){var G={layerUid:this._context.layer.uid,graphicUid:i},U=new Qr.a({geometries:a,materials:o,transformations:s,metadata:G}),B=new vt(this,U,a,null,null,Ho,r);return B.alignedSampledElevation=d.terrainElevation,B.needsElevationUpdates=Object(Ke.g)(r.mode),B}}else 0!==n.paths.length&&n.paths.some((function(e){return e.length>0}))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}]),r}(Ut);function Uo(e,t,r){switch(t){case"world":var i,n=Object(_.a)(e.vertices);try{for(n.s();!(i=n.n()).done;){var a=i.value;Object(P.f)(Zo,a.pos,e.offset),r.worldUpAtPosition(Zo,Yo),a.setFrameFromUpVector(Yo),a.computeRotationAxisAndAngleFromUpVector()}}catch(p){n.e(p)}finally{n.f()}break;case"path":Object(P.f)(Zo,e.vertices[0].pos,e.offset),r.worldUpAtPosition(Zo,Yo),function(e,t){var r=null,i=e.vertices.length,n=.99619469809,a=Object(E.e)(),o=Object(E.e)(),s=Object(E.e)(),c=Object(E.e)(),l=Object(E.e)(),u=Object(E.e)(),d=Object(M.d)(),h=e.vertices[0];Object(P.k)(o,t),Object(P.w)(a,0,1,0),St.a.makeOrthoBasisDirUpFallback(h.vRight,o,a,a,s,o,n),Object(P.k)(h.frame.up,o),Object(P.k)(h.frame.right,s),r=h;for(var f=1;f<i;++f){h=e.vertices[f],Object(P.f)(l,h.vLeft,h.vRight);var p=Object(P.p)(l);p>0?(p=1/Math.sqrt(p),l[0]=l[0]*p,l[1]=l[1]*p,l[2]=l[2]*p):(l[0]=h.vRight[0],l[1]=h.vRight[1],l[2]=h.vRight[2]),Object(P.f)(u,r.pos,r.frame.up),Object(M.g)(h.pos,l,d),Object(M.m)(d,Object(I.g)(u,h.vLeft),c)?(Object(P.j)(c,c,h.pos),Object(P.r)(o,c),Object(P.g)(s,l,o),Object(P.r)(s,s)):St.a.makeOrthoBasisDirUpFallback(l,r.frame.up,r.frame.right,a,s,o,n),Object(P.k)(h.frame.up,o),Object(P.k)(h.frame.right,s),r=h}}(e,Yo);var o,s=Object(_.a)(e.vertices);try{for(s.s();!(o=s.n()).done;){var c=o.value,l=Object(w.p)(Object(P.h)(c.frame.right,c.vRight));Object(P.g)(c.rotationFrame.up,c.vRight,c.vLeft),Object(P.e)(c.rotationFrame.up,c.rotationFrame.up,l),Object(P.r)(c.rotationFrame.up,c.rotationFrame.up);var u=Object(P.h)(c.rotationFrame.up,c.frame.up),d=Object(P.h)(c.rotationFrame.up,c.frame.right);if(Object(P.e)(Zo,c.frame.up,-d),Object(P.e)(Xo,c.frame.right,u),Object(P.f)(Zo,Zo,Xo),Object(P.r)(c.rotationFrame.right,Zo),Qa(c.rotationRight,c.frame,c.rotationFrame.right),Object(P.s)(Zo,c.vLeft),c.rotationAngle=-l*(Math.PI-Object(w.a)(Object(P.h)(Zo,c.vRight))),Math.abs(c.rotationAngle)>0){var h=Object(w.o)(Math.cos(.5*c.rotationAngle));Va(c.miterStretch,1+(h-1)*c.rotationRight[0]*c.rotationRight[0],(h-1)*c.rotationRight[0]*c.rotationRight[1],(h-1)*c.rotationRight[0]*c.rotationRight[1],1+(h-1)*c.rotationRight[1]*c.rotationRight[1])}var f=Math.PI-c.rotationAngle;c.maxStretchDistance=Math.abs(Math.min(c.vLeftLength,c.vRightLength)*Object(w.o)(Math.cos(.5*f)))}}catch(p){s.e(p)}finally{s.f()}}}function Bo(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function No(e,t,r,i){var n,a=0,o=Object(_.a)(e.vertices);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=Object(Ke.e)(s.posES,r,t,i,$o);a+=$o.sampledElevation,Object(P.f)(Yo,s.pos,e.offset),i.setAltitude(Yo,c),Object(P.j)(s.pos,Yo,e.offset)}}catch(l){o.e(l)}finally{o.f()}return e.updatePathVertexInformation(),a/e.vertices.length}function Ho(e,t,r,i){var n=e.stageObject,a=n.geometryRecords,o=a.length,s=0;qo.spatialReference=i.spatialReference;for(var c=0;c<o;c++){var l=a[c].geometry;if(Wa(l)){var u=l.path,d=u.builder.path,h=l.geometrySR;Wo.spatialReference=h,s+=No(d,t,r,i),"world"!==l.upVectorAlignment&&Uo(d,l.upVectorAlignment,i),u.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(c)}}return s/o}var qo=Object(ge.g)(0,0,0,null),Wo=Object(ge.g)(0,0,0,null),Yo=Object(E.e)(),Zo=Object(Ha.b)(),Xo=Object(Ha.b)(),Qo=3,Jo=3,Ko=10,$o={verticalDistanceToGround:0,sampledElevation:0};function es(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;Object(P.w)(ns,1,0,0),Object(P.w)(as,0,1,0),Object(P.w)(os,0,0,1),ys(ts,t),fs(t,is)&&ps(is,ns,as,os,r,ts),Object(Er.s)(ss,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Object(Er.s)(cs,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var a=0;a<t.count;a++){t.getVec(a,rs);var o=Object(P.h)(ns,rs),s=Object(P.h)(as,rs);ss[0]=Math.min(ss[0],o),ss[1]=Math.min(ss[1],s),cs[0]=Math.max(cs[0],o),cs[1]=Math.max(cs[1],s)}var c=Object(P.h)(os,ts);js(us,ss[0],ss[1],c,ns,as,os),js(ds,cs[0],ss[1],c,ns,as,os),js(hs,ss[0],cs[1],c,ns,as,os),Object(P.j)(ds,ds,us),Object(P.e)(ds,ds,.5),Object(P.j)(hs,hs,us),Object(P.e)(hs,hs,.5),Object(P.f)(us,us,ds),Object(P.f)(us,us,hs);var l=ss[0]%n,u=ss[1]%n;ls[0]=ss[0]-l,ls[1]=ss[1]-u;for(var d=0;d<t.count;d++){t.getVec(d,rs),e.setValues(d,(Object(P.h)(ns,rs)-ls[0])/n,(Object(P.h)(as,rs)-ls[1])/n,ls[0]/n,ls[1]/n);for(var h=0;h<3;h++)i.set(d,h,us[h]),i.set(d,h+3,ds[h]),i.set(d,h+6,hs[h])}}var ts=Object(E.e)(),rs=Object(E.e)(),is=Object(M.d)(),ns=Object(E.e)(),as=Object(E.e)(),os=Object(E.e)(),ss=Object(L.a)(),cs=Object(L.a)(),ls=Object(L.a)(),us=Object(E.e)(),ds=Object(E.e)(),hs=Object(E.e)();function fs(e,t){var r=e.count-1;return Object(M.e)(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function ps(e,t,r,i,n,a){Object(f.k)(n)?(n.basisMatrixAtPosition(a,vs),Object(P.w)(bs,vs[0],vs[1],vs[2]),Object(P.w)(ms,vs[4],vs[5],vs[6]),Object(P.w)(gs,vs[8],vs[9],vs[10])):(Object(P.w)(bs,1,0,0),Object(P.w)(ms,0,1,0),Object(P.w)(gs,0,0,1));var o=Object(M.q)(e);Object(P.h)(o,gs)<0&&Object(P.e)(o,o,-1),Object(P.k)(i,o);var s=Object(P.h)(o,ms),c=Object(P.h)(o,bs);Math.abs(s)<Math.abs(c)?(Object(P.c)(t,bs,o,-c),Object(P.r)(t,t),Object(P.g)(r,t,o),Object(P.r)(r,r),Object(P.e)(r,r,-1)):(Object(P.c)(r,ms,o,-s),Object(P.r)(r,r),Object(P.g)(t,r,o),Object(P.r)(t,t))}var vs=Object(k.d)(),bs=Object(E.e)(),ms=Object(E.e)(),gs=Object(E.e)();function ys(e,t){Object(P.w)(Os,0,0,0);for(var r=0;r<t.count-1;r++)t.getVec(r,rs),Object(P.f)(Os,Os,rs);Object(P.e)(e,Os,1/(t.count-1))}var Os=Object(E.e)();function js(e,t,r,i,n,a,o){Object(P.w)(e,t*n[0]+r*a[0]+i*o[0],t*n[1]+r*a[1]+i*o[1],t*n[2]+r*a[2]+i*o[2])}var xs=r(755),_s=r(729),Ss=r(937),ws=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(s.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:i.style,patternSpacing:i.patternSpacing,lineWidth:i.lineWidth,draped:i.draped,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new cr.a(e.rctx,n,Ps)}},{key:"bindPass",value:function(e,t){Object(ir.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("matColor",e.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio),this.program.setUniform1f("texelSize",1/t.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),4===this.configuration.output&&Object(Xn.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(wo.a)(this.program,t))}},{key:"bindDraw",value:function(e){Object(ir.d)(this.program,e),Object(ir.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object($t.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var r=this.configuration,i=3===e,n=2===e;return Object(dr.f)({blending:0===r.output||7===r.output?r.transparent&&i?ko.g:Object(ko.a)(e):null,culling:Object(dr.b)(r.cullFace),depthTest:{func:Object(ko.b)(e)},depthWrite:i?r.writeDepth&&dr.d:Object(ko.c)(e),colorWrite:dr.c,stencilWrite:r.sceneHasOcludees?Po.h:null,stencilTest:r.sceneHasOcludees?t?Po.d:Po.c:null,polygonOffset:i||n?r.polygonOffset&&Cs:Object(ko.h)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),r}(ar.a);ws.shader=new nr.a(Ss.a,(function(){return r.e(210).then(r.bind(null,1119))}));var Cs={factor:1,units:1},ks=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!0,e.polygonOffset=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.enableOffset=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(or.a);Object(h.a)([Object(or.b)({count:8})],ks.prototype,"output",void 0),Object(h.a)([Object(or.b)({count:3})],ks.prototype,"cullFace",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"slicePlaneEnabled",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"vertexColors",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"transparent",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"polygonOffset",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"writeDepth",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"sceneHasOcludees",void 0),Object(h.a)([Object(or.b)({count:6})],ks.prototype,"style",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"patternSpacing",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"lineWidth",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"enableOffset",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"draped",void 0),Object(h.a)([Object(or.b)({count:4})],ks.prototype,"transparencyPassType",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"multipassTerrainEnabled",void 0),Object(h.a)([Object(or.b)()],ks.prototype,"cullAboveGround",void 0);var Ps=new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]),Es=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e,Rs)).supportsEdges=!0,i._vertexAttributeLocations=Ps,i.techniqueConfig=new ks,i}return Object(s.a)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.style=this.params.style,this.techniqueConfig.patternSpacing=this.params.patternSpacing,this.techniqueConfig.lineWidth=this.params.lineWidth,this.techniqueConfig.draped=this.params.draped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<ko.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,r,i,n,a,o){Object(lr.f)(e,t,i,n,a,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new Ts(e):void 0}},{key:"createBufferWriter",value:function(){var e=Object(Qt.a)().vec3f("position").vec4u8("color").vec4f("uvMapSpace");return this.params.draped||e.mat3f("boundingRect"),new As(e)}}]),r}(Zt.a),Ts=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).updateParameters(),i}return Object(s.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(ws,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),r}(Jt.a),As=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(s.a)(r,[{key:"write",value:function(e,t,r,i){var n,a=Object(_.a)(this.vertexBufferLayout.fieldNames);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=t.vertexAttributes.get(o),c=t.indices.get(o);if(s&&c)switch(o){case"position":Object(Jn.a)(3===s.size);var l=r.getField(o,Fr.u);l&&Object(Kt.e)(c,s.data,e.transformation,l,i);break;case"color":Object(Jn.a)(3===s.size||4===s.size);var u=r.getField(o,Fr.J);u&&Object(Kt.b)(c,s.data,s.size,u,i);break;case"uvMapSpace":Object(Jn.a)(4===s.size);var d=r.getField(o,Fr.C);d&&Object(Kt.a)(c,s.data,d,i);break;case"boundingRect":Object(Jn.a)(9===s.size);var h=r.getField(o,Fr.f);h&&this.writeBoundingRect(c,s.data,e.transformation,h,i)}}}catch(f){a.e(f)}finally{a.f()}}},{key:"writeBoundingRect",value:function(e,t,r,i,n){var a=r,o=i.typedBuffer,s=i.typedBufferStride,c=e.length;n*=s;for(var l=0;l<c;++l){var u=9*e[l],d=t[u],h=t[u+1],f=t[u+2];o[n]=a[0]*d+a[4]*h+a[8]*f+a[12],o[n+1]=a[1]*d+a[5]*h+a[9]*f+a[13],o[n+2]=a[2]*d+a[6]*h+a[10]*f+a[14];for(var p=3;p<9;++p)o[n+p]=t[u+p];n+=s}}}]),r}(_s.a),Rs=Object(te.a)({color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0},Zt.b);function Ds(e,t,r){return function(e,t,r){return Object(f.k)(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=Object(jt.g)(0,0,0,0),t.transparent=!0),new xs.a(t)):(t.style=function(e){switch(e){case"horizontal":return 0;case"vertical":return 1;case"cross":return 2;case"forward-diagonal":return 3;case"backward-diagonal":return 4;case"diagonal-cross":return 5;default:return}}(e.style),t.draped=r.isDraped,new Es(t)):new xs.a(t)}(function(e){return e&&e.pattern||null}(e),t,r)}function Ms(e,t){if(function(e){return e.material instanceof Es&&!e.material.params.draped}(e)){var r=e.geometry.vertexAttributes,i=r.get("position").data,n=r.get("uvMapSpace").data,a=r.get("boundingRect").data;es(Fr.C.fromTypedArray(n),Fr.v.fromTypedArray(i),t,Fr.g.fromTypedArray(a))}}function Is(e,t,r,i){for(var n=rt(e,t,r,i),a=e.stageObject.geometryRecords,o=0;o<a.length;o++)Ms(a[o],i);return n}var Ls=["polyline","polygon","extent"],zs=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._needsUV=!1,s._hasOutline=!1,s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureMaterials",value:function(){this.ensureFillMaterial(),this.ensureOutlineMaterial()}},{key:"ensureFillMaterial",value:function(){if(!Object(f.k)(this._material)){var e=Object(f.i)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=Ds(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Es,this._context.stage.add(this._material)}}},{key:"ensureOutlineMaterial",value:function(){var e=this,t=this.symbolLayer.outline;if(!Object(f.k)(this._outlineMaterial)&&this._isValidOutline(t)){this._hasOutline=!0;this._outlineMaterial=function(r){var i=Object(f.n)(t.stipplePattern,Object(un.c)(Object(un.b)(t.pattern),Object(Je.g)(t.size)),(function(e){return Object(un.a)(e.map(Je.g))})),n=t.stippleOffColor?Qe.a.toUnitRGBA(t.stippleOffColor):null;return r>1.5?new dn.a({width:r,color:e._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:e._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleIntegerRepeats:!0,stippleOffColor:n,cap:t.patternCap||"butt"}):new xn.a({color:e._getOutlineColor(),slicePlaneEnabled:e._context.slicePlaneEnabled,width:r,stipplePattern:i,stippleIntegerRepeats:!0,stippleOffColor:n})}(Object(Je.g)(t.size)),this._context.stage.add(this._outlineMaterial)}}},{key:"_isValidOutline",value:function(e){return Object(f.k)(e)&&e.size&&e.size>0&&Object(f.k)(e.color)&&"none"!==e.pattern}},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Ls,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new ft.a);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}},{key:"layerOpacityChanged",value:function(){if(Object(f.k)(this._material)){var e=this._material.params.color,t=Object(f.i)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameterValues({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(Object(f.k)(this._outlineMaterial)){var i=this._outlineMaterial.params.color;this._outlineMaterial.setParameterValues({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}return!0}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=Object(Ke.d)(r.elevationModeChangeTypes,i,n);if(a!==Ke.a.UPDATE)return a;var o=Object(Ke.f)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){if(Object(f.k)(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(f.k)(this._outlineMaterial)){var e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(e)}return!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var i=qr(e.geometry);if(Object(f.j)(i))return null;Vs.renderData=Wr(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),Vs.color=t;var n=Vs.renderData.position.length/3;if(this._needsUV&&(Vs.uvMapSpace=new Float32Array(4*n),Vs.boundingRect=new Float64Array(9*n)),Vs.outNum=0,Vs.outGeometries=[],Vs.outTransforms=[],Vs.outMaterials=[],this._createAs3DShapeFill(Vs),this._hasOutline&&this._createAs3DShapeOutline(Vs),this._logGeometryCreationWarnings(Vs.renderData,i.rings,"rings","FillSymbol3DLayer"),0===Vs.outNum)return null;this._needsUV&&es(Fr.C.fromTypedArray(Vs.uvMapSpace),Fr.v.fromTypedArray(Vs.renderData.position),this._context.renderCoordsHelper,Fr.g.fromTypedArray(Vs.boundingRect));var a=new Qr.a({geometries:Vs.outGeometries,materials:Vs.outMaterials,transformations:Vs.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),o=Is,s=new vt(this,a,Vs.outGeometries,null,null,o,r);return s.alignedSampledElevation=Vs.renderData.sampledElevation,s.needsElevationUpdates=Object(Ke.f)(r.mode),s}},{key:"_createAs3DShapeFill",value:function(e){var t,r=e.renderData.polygons,i=Object(_.a)(r);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=n.position,o=n.mapPosition,s=n.holeIndices,c=n.index,l=n.count;if(!Object(f.k)(this._context.clippingExtent)||(Object(A.h)(Fs),Object(A.k)(Fs,o),Object(A.r)(Fs,this._context.clippingExtent))){var u=Object(Ir.a)(o,s,3);if(0!==u.length){var d=Nr({indices:new Uint32Array(u),attributeData:{position:a,color:e.color,mapPosition:o,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*c*e.uvMapSpace.BYTES_PER_ELEMENT,4*l):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*c*e.boundingRect.BYTES_PER_ELEMENT,9*l):null}});e.outGeometries.push(d),e.outMaterials.push(Object(f.s)(this._material)),e.outTransforms.push(k.a),e.outNum++}}}}catch(h){i.e(h)}finally{i.f()}}},{key:"_createAs3DShapeOutline",value:function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=this._outlineMaterial instanceof xn.a,i=0;i<t.length;++i){var n=t[i],a=n.mapPosition,o=n.position;if(!Object(f.k)(this._context.clippingExtent)||(Object(A.h)(Fs),Object(A.k)(Fs,a),Object(A.r)(Fs,this._context.clippingExtent))){var s=Object(ln.a)({removeDuplicateStartEnd:r?0:1,attributeData:{position:o,mapPosition:a}}),c=s.vertexAttributes.get("position");c.data===o&&(c.data=new Float64Array(o)),e.outGeometries.push(s),e.outMaterials.push(Object(f.s)(this._outlineMaterial)),e.outTransforms.push(k.a),e.outNum++}}}},{key:"_createAsOverlay",value:function(e,t){var r=qr(e.geometry);if(Object(f.j)(r))return null;Object(f.s)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,Object(f.k)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Gs.renderData=Yr(r,this._context.overlaySR),Gs.color=t;var i=Gs.renderData.position.length/3;return this._needsUV&&(Gs.uvMapSpace=new Float32Array(4*i)),Gs.outNum=0,Gs.outGeometries=[],Gs.outBoundingBox=Object(A.h)(),Gs.layerUid=this._context.layer.uid,Gs.graphicsUid=e.uid,this._createAsOverlayFill(Gs),this._hasOutline&&this._createAsOverlayOutline(Gs),this._logGeometryCreationWarnings(Gs.renderData,r.rings,"rings","FillSymbol3DLayer"),0===Gs.outNum?null:(this._needsUV&&function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(r.isGeographic){for(var n=new Float64Array(t.typedBuffer.length),a=3*t.count,o=0;o<a;o+=3)Object(T.i)(t.typedBuffer,o,n,o,Object(x.e)(r));t=Fr.v.fromTypedArray(n)}Object(Er.s)(ss,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(var s=0;s<t.count;s++)t.getVec(s,rs),ss[0]=Math.min(ss[0],rs[0]),ss[1]=Math.min(ss[1],rs[1]);var c=ss[0]%i,l=ss[1]%i;ls[0]=ss[0]-c,ls[1]=ss[1]-l;for(var u=0;u<t.count;u++)t.getVec(u,rs),e.setValues(u,(rs[0]-ls[0])/i,(rs[1]-ls[1])/i,ls[0]/i,ls[1]/i)}(Fr.C.fromTypedArray(Gs.uvMapSpace),Fr.v.fromTypedArray(Gs.renderData.position),this._context.overlaySR),Gs.outNum>0?new Si(this,Gs.outGeometries,Gs.outBoundingBox):null)}},{key:"_createAsOverlayFill",value:function(e){var t,r=e.renderData.polygons,i=Object(_.a)(r);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=n.position,o=n.holeIndices,s=n.index,c=n.count;if(Object(A.h)(Fs),Object(A.k)(Fs,a),Object(A.r)(Fs,this._context.clippingExtent)){var l=Object(Ir.a)(a,o,3);if(0!==l.length){Object(A.j)(e.outBoundingBox,Fs);var u=Nr({indices:new Uint32Array(l),attributeData:{position:a,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*s*e.uvMapSpace.BYTES_PER_ELEMENT,4*c):null}}),d=new Zi.a(u,Object(f.s)(this._material),e.layerUid,e.graphicsUid),h=Fs;Object(Oi.l)(d.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]))),e.outGeometries.push(d),e.outNum++}}}}catch(p){i.e(p)}finally{i.f()}}},{key:"_createAsOverlayOutline",value:function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=0;r<t.length;++r){var i=t[r].position;if(Object(A.h)(Fs),Object(A.k)(Fs,i),Object(A.r)(Fs,this._context.clippingExtent)){Object(A.j)(e.outBoundingBox,Fs);var n=this._outlineMaterial instanceof xn.a,a=Object(ln.a)({removeDuplicateStartEnd:n?0:1,attributeData:{position:i}}),o=new Zi.a(a,Object(f.s)(this._outlineMaterial),e.layerUid,e.graphicsUid),s=Fs;Object(Oi.l)(o.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),e.outGeometries.push(o),e.outNum++}}}},{key:"_getOutlineOpacity",value:function(){var e=Object(f.i)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(Object(f.k)(e)?e.a:0)}},{key:"_getOutlineColor",value:function(){var e=Object(f.i)(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return Object($e.g)(Object(f.k)(e)?Qe.a.toUnitRGB(e):null,t)}},{key:"test",get:function(){var e=this;return{createAsOverlay:function(t,r){return e._createAsOverlay(t,r)},createAs3DShape:function(t,r,i){return e._createAs3DShape(t,r,i)}}}}]),r}(Ut);zs.elevationModeChangeTypes={definedChanged:Ke.a.RECREATE,staysOnTheGround:Ke.a.NONE,onTheGroundChanged:Ke.a.RECREATE};var Fs=Object(A.f)(),Vs={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Gs={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Us=function(){function e(t){Object(o.a)(this,e),this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.fillStyle=this.colorToRGBA(t.color),this.haloStyle=this.colorToRGB(t.halo.color)}return Object(s.a)(e,[{key:"colorToRGB",value:function(e){return"rgb(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),")")}},{key:"colorToRGBA",value:function(e){return"rgba(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),",").concat(e[3],")")}}],[{key:"fromSymbol",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Object(f.i)(t,"material","color"),n=Object(f.k)(i)?Qe.a.toUnitRGBA(i):jt.b,a=t.halo,o=null!=t.size?Object(Je.g)(t.size):12,s={family:t.font&&t.font.family?t.font.family:"sans-serif",weight:t.font&&t.font.weight?t.font.weight:"normal",style:t.font&&t.font.style?t.font.style:"normal"},c=Object(f.k)(a)&&Object(f.k)(a.color)&&a.size>0?{size:Object(Je.g)(a.size),color:Qe.a.toUnitRGBA(a.color)}:{size:0,color:jt.b};return new e({size:o,color:n,font:s,halo:c,pixelRatio:r})}}]),e}(),Bs=r(745),Ns=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048;Object(o.a)(this,e),this.text=t,this._parameters=r,this.maxSize=i,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key="".concat(this._parameters.key,"--").concat(t),this._lines=t.split(/\r?\n/),this._lineHeight=this.computeLineHeight()}return Object(s.a)(e,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(Object(f.j)(this._renderPixelRatio)){var e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}},{key:"getLineXOffset",value:function(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)}},{key:"render",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.renderedLineHeight,n=this.renderedHaloSize,a=Hs(e.textAlign,this.renderedWidth)+n,o=n+qs;e.save(),n>0&&this.renderHalo(e,a,o,t,r),this.setFontProperties(e,this.renderedFontSize),r+=o,t+=a;for(var s=0;s<this._lines.length;++s){e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)";var c=this._lines[s],l=this.getLineXOffset(s);e.fillText(c,t+l,r),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.fillStyle,e.fillText(c,t+this.getLineXOffset(s),r),r+=i}e.restore()}},{key:"renderHalo",value:function(e,t,r,i,n){var a=this.renderedWidth,o=this.renderedHeight,s=Zs(Xs,Math.max(a,Qs),Math.max(o,Qs)),c=s.getContext("2d");c.clearRect(0,0,a,o),this.setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;var l=this.renderedHaloSize<3;c.lineJoin=l?"miter":"round",l?this.renderHaloEmulated(c,t,r):this.renderHaloNative(c,t,r),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(s,0,0,a,o,i,n,a,o),e.globalAlpha=1}},{key:"renderHaloEmulated",value:function(e,t,r){for(var i=this.renderedLineHeight,n=this.renderedHaloSize,a=0;a<this._lines.length;++a){var o,s=this._lines[a],c=this.getLineXOffset(a),l=Object(_.a)(Ws);try{for(l.s();!(o=l.n()).done;){var u=Object(de.a)(o.value,2),d=u[0],h=u[1];e.fillText(s,t+c+n*d,r+n*h)}}catch(f){l.e(f)}finally{l.f()}r+=i}}},{key:"renderHaloNative",value:function(e,t,r){for(var i=this.renderedLineHeight,n=this.renderedHaloSize,a=0;a<this._lines.length;++a){for(var o=2*n,s=this._lines[a],c=this.getLineXOffset(a),l=0;l<5;l++){var u=.6+.1*l;e.lineWidth=u*o,e.strokeText(s,t+c,r)}r+=i}}},{key:"setFontProperties",value:function(e,t){var r=this._parameters.definition.font,i="".concat(r.style," ").concat(r.weight," ").concat(t,"px ").concat(r.family,", sans-serif");e.font=i,e.textAlign="left",e.textBaseline="top"}},{key:"_ensureTextWidth",value:function(){if(Object(f.k)(this._displayWidth))return this._displayWidth;var e=Zs(Xs,Qs,Qs).getContext("2d");this.setFontProperties(e,this._parameters.definition.size);var t=0,r=2*this._parameters.haloSize;this._lineWidths.length=0;var i=this._parameters.definition.font;("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(r+=.3*e.measureText("A").width);var n,a=Object(_.a)(this._lines);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=Math.round(e.measureText(o).width+r);this._lineWidths.push(s),t=Math.max(t,s)}}catch(c){a.e(c)}finally{a.f()}return this._displayWidth=t,this._displayWidth}},{key:"computeLineHeight",value:function(){var e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+qs}}]),e}();function Hs(e,t){return"center"===e?.5*t:"right"===e?t:0}for(var qs=1,Ws=[],Ys=0;Ys<360;Ys+=22.5)Ws.push([Math.cos(Math.PI*Ys/180),Math.sin(Math.PI*Ys/180)]);function Zs(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}var Xs={canvas:null},Qs=512,Js=r(546),Ks=r(622),$s=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n){var a;return Object(o.a)(this,r),(a=t.call(this)).type=4,a._glTexture=null,a.events=new Ve.a,a._requiresPowerOfTwo=!Object(Ks.a)(e.gl),a._renderer=new Ns(i,n),a}return Object(s.a)(r,[{key:"width",get:function(){return this._renderer.renderedWidth}},{key:"height",get:function(){return this._renderer.renderedHeight}},{key:"textureWidth",get:function(){var e=this.width;return this._requiresPowerOfTwo?Object(w.l)(e):e}},{key:"textureHeight",get:function(){var e=this.height;return this._requiresPowerOfTwo?Object(w.l)(e):e}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"texcoordScale",get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"createDescriptor",value:function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}},{key:"load",value:function(e){if(Object(f.k)(this._glTexture))return this._glTexture;var t=Zs(ec,this.textureWidth,this.textureHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new Js.a(e,this.createDescriptor(e),t),r.restore(),this._glTexture}},{key:"unload",value:function(){Object(f.k)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")}}]),r}(Bs.a),ec={canvas:null},tc=[0,0,1],rc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){var s;return Object(o.a)(this,r),(s=t.call(this,e,i,n,a))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},s.ensureDrapedStatus(!1),s}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(t=Object($e.j)(this.symbolLayer.size))){e.next=4;break}throw new pe.a("graphics3dtextsymbollayer:invalid-size",t);case 4:this._createTextRenderParameters();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createTextRenderParameters",value:function(){var e=this._context.layerView.view.pixelRatio;this._textRenderParameters=Us.fromSymbol(this.symbolLayer,e)}},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this)}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic,r=Object(Wt.d)(t.geometry);if(Object(f.j)(r))return this.logger.warn("unsupported geometry type for text symbol: ".concat(t.geometry.type)),null;var i=this.symbolLayer.text;if(!i)return null;var n=Object(Xe.d)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,r,i,n)}},{key:"createLabel",value:function(e,t,r,i){var n=e.graphic,a=Object(Wt.d)(n.geometry);if(Object(f.j)(a))return this.logger.warn("unsupported geometry type for label: ".concat(n.geometry.type)),null;var o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(n,a,o,t,t,r,i)}},{key:"setGraphicElevationContext",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Object(c.a)(Object(l.a)(r.prototype),"setGraphicElevationContext",this).call(this,e,t);return n.addOffsetRenderUnits(i),n}},{key:"layerOpacityChanged",value:function(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}},{key:"layerElevationInfoChanged",value:function(e,t){var r=this;return ic(e,t,(function(e,t){r.updateGraphicElevationContext(t,e)})),Ke.a.UPDATE}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return ic(e,t,(function(e){var t,i=Object(_.a)(e.stageObject.geometryRecords);try{for(i.s();!(t=i.n()).done;){t.value.material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})}}catch(n){i.e(n)}finally{i.f()}})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!1}},{key:"updateGraphicElevationContext",value:function(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(Ke.f)(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}},{key:"_defaultElevationInfoNoZ",value:function(){return nc}},{key:"_createAs3DShape",value:function(e,t,r,i){var n,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ac,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=this.setGraphicElevationContext(e,new ft.a,a.elevationOffset),l="polyline"===Object(f.i)(e.geometry,"type"),u=e.uid,d=this._context.stage.renderView.renderingContext,h=a.anchor in $e.h?a.anchor:"center",p=$e.h[h],v=Object(f.j)(s)?new $s(d,r,this._textRenderParameters):null,b={occlusionTest:!0,screenOffset:a.screenOffset,anchorPos:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:!0};if(Object(f.k)(v)&&(b.textureId=v.id,b.texCoordScale=v.texcoordScale),Object(f.k)(s)&&(b.textureId=s.id),Object(f.k)(i)&&Object(f.k)(i.verticalOffset)){var m=i.verticalOffset,g=m.screenLength,y=m.minWorldLength,O=m.maxWorldLength;b.verticalOffset={screenLength:Object(Je.g)(g),minWorldLength:y||0,maxWorldLength:null!=O?O:1/0}}if(this._context.screenSizePerspectiveEnabled){var j=this._context.sharedResources,x=j.screenSizePerspectiveSettings,_=j.screenSizePerspectiveSettingsLabels;b.screenSizePerspective=_.overridePadding(this._textRenderParameters.haloSize),b.screenSizePerspectiveAlignment=x}if(l&&(b.shaderPolygonOffset=1e-4),b.slicePlaneEnabled=this._context.slicePlaneEnabled,Object(f.k)(o)){var S=JSON.stringify(b);n=o.get(S),Object(f.j)(n)&&(n=new Qi.a(b),o.add(S,n))}else n=new Qi.a(b);var w=[n],C=a.translation,k=Object(f.k)(v)?[v.displayWidth,v.displayHeight]:[0,0],P=a.centerOffset,E=tc,T=[0,0],A=[St.a.createPointGeometry(E,C,null,k,P,T,null)],R=this._context.layer.uid,D=Object(Wt.a)(this._context,t,A,w,null,null,c,R,u);if(null===D)return null;var M=it,I=new vt(this,D.object,A,Object(f.j)(o)?w:null,Object(f.k)(v)?[v]:null,M,c);I.alignedSampledElevation=D.sampledElevation,I.needsElevationUpdates=Object(Ke.f)(c.mode)||"absolute-height"===c.mode;var z=Object(f.k)(v)?v:a,F=z.displayWidth,V=z.displayHeight;I.getScreenSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(L.a)();return e[0]=F,e[1]=V,e};var G={labelText:r,elevationOffset:a.elevationOffset};return I.metadata=G,Object(Wt.b)(I,t,this._context.elevationProvider),I}}]),r}(Ut);function ic(e,t,r){e&&e.forEach((function(e){var i=t(e);Object(f.k)(i)&&r(i,e.graphic)}))}var nc={mode:"relative-to-ground",offset:0},ac={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0},oc=r(51),sc=r(142),cc=function(){function e(){Object(o.a)(this,e),this.enabled=!0,this._time=0}return Object(s.a)(e,[{key:"time",get:function(){return Object(sc.a)(this._time)}},{key:"advance",value:function(e){return Object(f.k)(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!!this.enabled&&(this._time+=e.dt,0!==e.dt)}}]),e}(),lc=r(872),uc=r(873),dc=Object(te.a)({waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(L.e)(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1},Zt.b),hc={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},fc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e,dc)).animation=new cc,i.techniqueConfig=new uc.b,i}return Object(s.a)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.useSSR=this.params.ssrEnabled,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<ko.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*t<pc;var r=this.animation.advance(e);return this.animation.enabled&&r}},{key:"intersect",value:function(e,t,r,i,n,a,o){Object(lr.f)(e,t,i,n,a,void 0,o)}},{key:"getGLMaterial",value:function(e){if(0===e.output&&this.params.isDraped){var t=e;return t.output=5,new lc.a(t)}switch(e.output){case 0:case 2:case 4:case 7:return new lc.a(e)}}},{key:"createBufferWriter",value:function(){return new _s.a(_s.d)}}]),r}(Zt.a),pc=35e3,vc=["polyline","polygon","extent"],bc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n,a){return Object(o.a)(this,r),t.call(this,e,i,n,a)}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,vc,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new ft.a);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}},{key:"ensureMaterial",value:function(){if(!Object(f.k)(this._material)){var e=Object(te.a)({},dc),t=this.symbolLayer.color;Object(f.k)(t)&&(e.color=Qe.a.toUnitRGBA(t));var i=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=Object(f.k)(this.symbolLayer.waveDirection)?r.headingVectorFromAngle(this.symbolLayer.waveDirection):Object(L.e)(0,0);var n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,a=hc[n];e.waveStrength=a.waveStrength,e.waveTextureRepeat=a.textureRepeat,e.waveVelocity=a.waveVelocity,e.flowStrength=a.perturbationStrength,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new fc(e),this._context.stage.add(this._material)}}},{key:"layerOpacityChanged",value:function(){if(Object(f.j)(this._material))return!0;var e=this._material.params.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({color:[e[0],e[1],e[2],t],transparent:r}),!0}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=Object(Ke.d)(r.elevationModeChangeTypes,i,n);if(a!==Ke.a.UPDATE)return a;var o=Object(Ke.f)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){return Object(f.k)(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var i=qr(e.geometry);if(Object(f.j)(i))return null;jc.renderData=Wr(i,this._context.elevationProvider,this._context.renderCoordsHelper,t);var n=jc.renderData.position.length/3;if(jc.uvCoords=new Float64Array(2*n),jc.outNum=0,jc.outGeometries=[],jc.outTransforms=[],jc.outMaterials=[],this._create3DShapeGeometries(jc),this._logGeometryCreationWarnings(jc.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===jc.outNum)return null;this._createUVCoordsFromVertices(jc.uvCoords,jc.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);var a=new Qr.a({geometries:jc.outGeometries,materials:jc.outMaterials,transformations:jc.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),o=rt,s=new vt(this,a,jc.outGeometries,null,null,o,t);return s.alignedSampledElevation=jc.renderData.sampledElevation,s.needsElevationUpdates=Object(Ke.f)(t.mode),s}},{key:"_createUVCoordsFromVertices",value:function(e,t,i,n){var a=Object(oc.d)(n);Object(R.m)(gc);for(var o=0;o<i;o++)Object(Er.s)(yc,t[3*o+0],t[3*o+1]),Object(R.o)(gc,yc);Object(Oi.b)(gc,gc,a);var s=gc[0]%r.unitSizeOfTexture,c=gc[1]%r.unitSizeOfTexture;mc[0]=gc[0]-s,mc[1]=gc[1]-c;for(var l=0;l<i;l++)e[2*l+0]=(t[3*l+0]*a-mc[0])/r.unitSizeOfTexture,e[2*l+1]=(t[3*l+1]*a-mc[1])/r.unitSizeOfTexture}},{key:"_create3DShapeGeometries",value:function(e){var t,r=e.renderData.polygons,i=e.uvCoords,n=Object(_.a)(r);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.count,s=a.index,c=a.position,l=a.mapPosition,u=a.holeIndices;if(!Object(f.k)(this._context.clippingExtent)||(Object(A.h)(Oc),Object(A.k)(Oc,l),Object(A.r)(Oc,this._context.clippingExtent))){var d=Object(Ir.a)(l,u,3);if(0!==d.length){var h=Hr({indices:new Uint32Array(d),attributeData:{position:c,uv0:new Float64Array(i.buffer,2*s*i.BYTES_PER_ELEMENT,2*o),mapPosition:l}});e.outGeometries.push(h),e.outMaterials.push(Object(f.s)(this._material)),e.outTransforms.push(k.a),e.outNum++}}}}catch(p){n.e(p)}finally{n.f()}}},{key:"_createAsOverlay",value:function(e){var t=qr(e.geometry);if(Object(f.j)(t))return null;Object(f.s)(this._material).renderPriority=this._renderPriority,xc.renderData=Yr(t,this._context.overlaySR);var r=xc.renderData.position.length/3;return xc.uvCoords=new Float64Array(2*r),xc.outNum=0,xc.outGeometries=[],xc.outBoundingBox=Object(A.h)(),xc.layerUid=this._context.layer.uid,xc.graphicsUid=e.uid,this._createAsOverlayWater(xc),this._logGeometryCreationWarnings(xc.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===xc.outNum?null:(this._createUVCoordsFromVertices(xc.uvCoords,xc.renderData.position,r,this._context.overlaySR),xc.outNum>0?new Si(this,xc.outGeometries,xc.outBoundingBox):null)}},{key:"_createAsOverlayWater",value:function(e){var t,r=e.uvCoords,i=e.renderData.polygons,n=Object(_.a)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.position,s=a.holeIndices,c=a.index,l=a.count;if(Object(A.h)(Oc),Object(A.k)(Oc,o),Object(A.r)(Oc,this._context.clippingExtent)){Object(A.j)(e.outBoundingBox,Oc);var u=Object(Ir.a)(o,s,3);if(0!==u.length){var d=Hr({indices:new Uint32Array(u),attributeData:{position:o,uv0:new Float64Array(r.buffer,2*c*r.BYTES_PER_ELEMENT,2*l)}}),h=new Zi.a(d,Object(f.s)(this._material),e.layerUid,e.graphicsUid),p=Oc;Object(Oi.l)(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),e.outGeometries.push(h),e.outNum++}}}}catch(v){n.e(v)}finally{n.f()}}},{key:"test",get:function(){var e=this;return{create3DShape:function(t){return e._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid)},ensureMaterial:function(){return e.ensureMaterial()}}}}],[{key:"headingVectorFromAngle",value:function(e){var t=Object(L.a)(),r=Object(Fa.d)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}}]),r}(Ut);bc.unitSizeOfTexture=100,bc.elevationModeChangeTypes={definedChanged:Ke.a.RECREATE,staysOnTheGround:Ke.a.NONE,onTheGroundChanged:Ke.a.RECREATE};var mc=Object(L.a)(),gc=Object(R.l)(),yc=Object(L.a)(),Oc=Object(A.f)(),jc={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},xc={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},_c=m.a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Sc(e,t,r,i){var n=Cc[e.type]&&Cc[e.type][t.type]||wc[t.type];return n?new n(e,t,r,i):(_c.error("GraphicsLayerFactory#make","unknown symbol type ".concat(t.type)),null)}var wc={icon:an,object:Ra,line:fn,path:Go,fill:zs,extrude:$r,text:rc,water:bc};var Cc={"mesh-3d":{fill:Sn}},kc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n){var a;return Object(o.a)(this,r),(a=t.call(this,i.schedule))._symbol=e,a._context=i,a._backgroundLayers=n,a._destroyed=!1,a.symbolLayers=[],a.referenced=0,a._extentPadding=0,a}return Object(s.a)(r,[{key:"symbol",get:function(){return this._symbol},set:function(e){if(this._symbol=e,this.symbolLayers)for(var t=0;t<e.symbolLayers.length;t++){var r=this.symbolLayers[t];Object(f.j)(r)||(r.symbol=e,r.symbolLayer=e.symbolLayers.items[t])}}},{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i,o,s,c,l,u,d,h=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this._symbol.symbolLayers,this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r)),i=r.length;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length,o=[],s=function(e){var n=r.getItemAt(e);if(!1===n.enabled)return"continue";Pc.renderPriority=1-(1+e)/i,Pc.renderPriorityStep=1/i,Pc.ignoreDrivers=n._ignoreDrivers;var a=Sc(h.symbol,n,h._context,Pc);o.push(Object(ne.r)(t,(function(){h.symbolLayers[e]=null,a.destroy()}))),h.symbolLayers[e]=a},c=0;case 8:if(!(c<i)){e.next=15;break}if("continue"!==s(c)){e.next=12;break}return e.abrupt("continue",12);case 12:c++,e.next=8;break;case 15:return e.next=17,Object(Ze.a)(this.symbolLayers,function(){var e=Object(a.a)(n.a.mark((function e(t,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(f.k)(t)){e.next=10;break}return e.prev=1,e.next=4,t.load();case 4:h._extentPadding+=Math.max(h._extentPadding,t.extentPadding),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),h.symbolLayers[r]=null;case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}());case 17:for(l=0,u=o;l<u.length;l++)null==(d=u[l])||d.remove();if(o.length=0,Object(ne.v)(t),!this.symbolLayers.length||this.symbolLayers.some((function(e){return!!e}))){e.next=20;break}throw new Error;case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSymbolLayerSize",value:function(e){var t=this.symbolLayers[e];return Object(f.k)(t)?t.getCachedSize():null}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"createGraphics3DGraphic",value:function(e,t){for(var r=e.graphic,i=new Array(this.symbolLayers.length),n=0;n<this.symbolLayers.length;n++){var a=this.symbolLayers[n];i[n]=Object(f.k)(a)?a.createGraphics3DGraphic(e):null}var o=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Mr(r,t||this,i,e.layer,o)}},{key:"complexity",get:function(){return It(this.symbolLayers.map((function(e){return Object(f.i)(e,"complexity")})))}},{key:"globalPropertyChanged",value:function(e,t){for(var r=this,i=this.symbolLayers.length,n=function(i){var n=r.symbolLayers[i];if(Object(f.k)(n)&&!n.globalPropertyChanged(e,t,(function(e){var t=e.graphics[i];return t instanceof vt?t:null})))return{v:!1}},a=0;a<i;a++){var o=n(a);if("object"===typeof o)return o.v}return!0}},{key:"applyRendererDiff",value:function(e,t){return 1===this.loadStatus&&this.symbolLayers.reduce((function(r,i){return r&&(Object(f.j)(i)||i.applyRendererDiff(e,t))}),!0)}},{key:"prepareSymbolPatch",value:function(e){if(2!==this.loadStatus&&"partial"===e.diff.type){var t=e.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var r=t.symbolLayers.diff;this.symbolLayers.forEach((function(t,i){if(!Object(f.j)(t)){var n=r[i];if(n){var a,o={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(o),(a=e.symbolStatePatches).push.apply(a,Object(ue.a)(o.symbolLayerStatePatches)),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((function(e,t){var r=e.graphics[i];Object(f.k)(r)&&o.graphics3DGraphicPatches.forEach((function(e){return e(r,t)}))}))}}}))}}}},{key:"updateGeometry",value:function(e,t){for(var r=0;r<this.symbolLayers.length;r++){var i=this.symbolLayers[r];if(!Object(f.j)(i)){var n=e.graphics[r];if(Object(f.j)(n)||!i.updateGeometry(n,t))return!1}}return!0}},{key:"onRemoveGraphic",value:function(e){for(var t=0;t<this.symbolLayers.length;t++){var r=this.symbolLayers[t];if(!Object(f.j)(r)){var i=e.graphics[t];Object(f.k)(i)&&r.onRemoveGraphic(i)}}}},{key:"getFastUpdateStatus",value:function(){var e=0,t=0,r=0;return this.symbolLayers.forEach((function(i){Object(f.j)(i)||(0===i.loadStatus?e++:i.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}},{key:"destroy",value:function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();var e,t=Object(_.a)(this.symbolLayers);try{for(t.s();!(e=t.n()).done;){var r=e.value;Object(f.k)(r)&&r.destroy()}}catch(i){t.e(i)}finally{t.f()}this.symbolLayers.length=0,this._destroyed=!0}}},{key:"destroyed",get:function(){return this._destroyed}}]),r}(xt),Pc={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1},Ec=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n){var a;return Object(o.a)(this,r),(a=t.call(this,e,i,n)).calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=function(e,t){if(!Object(Xe.d)(e))return wr.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '".concat(e.type,"' does not support callouts")),null;if(!e.callout)return null;var r=Cr[e.callout.type];return r?new r(e,t):(wr.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type ".concat(e.callout.type)),null)}(a.symbol,i)),a}return Object(s.a)(r,[{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var i,a,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.calloutSymbolLayer?Object(Ze.c)(this.calloutSymbolLayer.load()):null,e.prev=1,e.next=4,Object(c.a)(Object(l.a)(r.prototype),"doLoad",this).call(this,t);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),null==(a=this.calloutSymbolLayer)||a.abortLoad(),e.t0;case 9:if(!Object(ne.n)(t)){e.next=11;break}throw null==(o=this.calloutSymbolLayer)||o.abortLoad(),Object(ne.e)();case 11:if(e.t1=i,!e.t1){e.next=15;break}return e.next=15,i;case 15:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(c.a)(Object(l.a)(r.prototype),"destroy",this).call(this),this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()}},{key:"createGraphics3DGraphic",value:function(e,t){var i=Object(c.a)(Object(l.a)(r.prototype),"createGraphics3DGraphic",this).call(this,e,t);if(this.calloutSymbolLayer){var n=this.createCalloutGraphic(e);n&&i.addAuxiliaryGraphic(n)}return i}},{key:"globalPropertyChanged",value:function(e,t){var i=this;return!!Object(c.a)(Object(l.a)(r.prototype),"globalPropertyChanged",this).call(this,e,t)&&(!this.calloutSymbolLayer||this.calloutSymbolLayer.globalPropertyChanged(e,t,(function(e){return i._getCalloutGraphicLayer(e)})))}},{key:"updateGeometry",value:function(e,t){var i=Object(c.a)(Object(l.a)(r.prototype),"updateGeometry",this).call(this,e,t);if(i&&this.calloutSymbolLayer){var n=this._getCalloutGraphicLayer(e);if(n)return this.calloutSymbolLayer.updateGeometry(n,t)}return i}},{key:"createCalloutGraphic",value:function(e){var t=e.renderingInfo,r={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=r,this.calloutSymbolLayer.createGraphics3DGraphic(e)}},{key:"_getCalloutGraphicLayer",value:function(e){var t,r=Object(_.a)(e._auxiliaryGraphics);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.graphics3DSymbolLayer===this.calloutSymbolLayer)return i}}catch(n){r.e(n)}finally{r.f()}}}]),r}(kc);var Tc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e,i,n){var a;return Object(o.a)(this,r),(a=t.call(this,i)).symbol=e,a.convert=n,a.graphics3DSymbol=null,a.referenced=0,a}return Object(s.a)(r,[{key:"getSymbolLayerSize",value:function(e){return Object(f.k)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}},{key:"extentPadding",get:function(){return Object(f.k)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"doLoad",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.symbol.fetchSymbol({signal:t});case 2:return(r=e.sent).id=this.symbol.id,this.graphics3DSymbol=this.convert(r),e.next=7,this.graphics3DSymbol.load();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGraphics3DGraphic",value:function(e){return Object(f.k)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}},{key:"complexity",get:function(){return Object(f.k)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Mt}},{key:"globalPropertyChanged",value:function(e,t){return!!Object(f.k)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}},{key:"applyRendererDiff",value:function(e,t){return!!Object(f.k)(this.graphics3DSymbol)&&this.graphics3DSymbol.applyRendererDiff(e,t)}},{key:"prepareSymbolPatch",value:function(e){Object(f.k)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}},{key:"updateGeometry",value:function(e,t){return!!Object(f.k)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}},{key:"onRemoveGraphic",value:function(){}},{key:"getFastUpdateStatus",value:function(){return Object(f.k)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}},{key:"destroy",value:function(){Object(f.k)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,this.abortLoad()}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]),r}(xt),Ac=function(){function e(t){var r=this;Object(o.a)(this,e),this.graphicsCore=t,this.idToState=new Map,this.states=new Set;var i=t.owner.layer&&t.owner.layer.objectIdField;i?(this.getGraphicId=function(e){return Object(ge.e)(e,i)},this.getGraphics3DGraphicById=function(e){return r.graphicsCore.getGraphics3DGraphicByObjectId(e)}):(this.getGraphicId=function(e){return e.uid},this.getGraphics3DGraphicById=function(e){return r.graphicsCore.getGraphics3DGraphicById(e)})}return Object(s.a)(e,[{key:"destroy",value:function(){var e=this;this.idToState.clear(),this.states.forEach((function(t,r){return e.remove(r)}))}},{key:"add",value:function(e){var t=this,r={remove:function(){return t.remove(e)}};if(this.states.has(e))return r;var i=this.getGraphicId(e.graphic),n=this.getGraphics3DGraphicById(i);return this.states.has(e)||this.states.add(e),this.ensureStateList(i).push(e),e.displaying=!!Object(f.k)(n)&&n.isVisible(),e.isDraped=!!Object(f.k)(n)&&n.isDraped,e.tracking=!0,Object(f.k)(n)&&e.emit("changed",{}),r}},{key:"remove",value:function(e){if(this.states.has(e)){if(this.idToState.size){var t=this.getGraphicId(e.graphic),r=this.idToState.get(t);r&&(Object(Le.i)(r,e),0===r.length&&this.idToState.delete(t))}this.states.delete(e),e.tracking=!1,e.displaying=!1}}},{key:"addGraphic",value:function(e){this.forEachState(e,(function(t){t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed",{})}))}},{key:"removeGraphic",value:function(e){this.forEachState(e,(function(e){e.displaying=!1,e.isDraped=!1}))}},{key:"updateGraphicGeometry",value:function(e){this.forEachState(e,(function(e){e.emit("changed",{})}))}},{key:"updateGraphicVisibility",value:function(e){this.forEachState(e,(function(t){t.displaying=e.isVisible()}))}},{key:"allGraphicsDeleted",value:function(){this.states.forEach((function(e){e.displaying=!1}))}},{key:"ensureStateList",value:function(e){var t=this.idToState.get(e);if(t)return t;var r=new Array;return this.idToState.set(e,r),r}},{key:"forEachState",value:function(e,t){if(0!==this.states.size&&0!==this.idToState.size){var r=this.getGraphicId(e.graphic),i=this.idToState.get(r);null!=i&&i.forEach(t)}}}]),e}(),Rc=r(667),Dc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e))._index=new Rc.a(9,Object(b.a)("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),i._missing=new Set,i._boundsByFeature=new Map,i.spatialReference=null,i.hasZ=null,i.hasM=null,i.objectIdField=null,i.updating=!1,i}return Object(s.a)(r,[{key:"setup",value:function(e){this._addMany(e)}},{key:"destroy",value:function(){this._missing.clear(),this._index.destroy(),this._index=null,this._boundsByFeature.clear(),this._boundsByFeature=null}},{key:"update",value:function(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}},{key:"updatingRemaining",get:function(){return this._missing.size}},{key:"queryGraphicUIDsInExtent",value:function(e,t,r){t.equals(this.spatialReference)&&(Mc.minX=e[0],Mc.minY=e[1],Mc.maxX=e[2],Mc.maxY=e[3],this.update(),this._index.search(Mc,(function(e){return r(e.graphic.uid)})))}},{key:"add",value:function(e){this._missing.add(e),this.updating=!0}},{key:"remove",value:function(e){if(this._missing.delete(e))this.updating=this._missing.size>0;else{this._index.remove(e);var t=Object(ge.e)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}}},{key:"_addMany",value:function(e){if(0!==e.length){var t,r=this._get("objectIdField"),i=Object(_.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;n.computeExtent(this.spatialReference);var a=Object(ge.e)(n.graphic,r);null!=a&&this._boundsByFeature.set(a,n.extent)}}catch(o){i.e(o)}finally{i.f()}this._index.load(e)}}},{key:"clear",value:function(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}},{key:"forEachInBounds",value:function(e,t){Mc.minX=e[0],Mc.minY=e[1],Mc.maxX=e[2],Mc.maxY=e[3],this.update(),this._index.search(Mc,(function(e){t(e)}))}},{key:"getBounds",value:function(e,t){this.update();var r=this._boundsByFeature.get(e);return r?Object(A.o)(t,r):null}}]),r}(O.a);Object(h.a)([Object(v.b)({constructOnly:!0})],Dc.prototype,"spatialReference",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Dc.prototype,"hasZ",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Dc.prototype,"hasM",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Dc.prototype,"objectIdField",void 0),Object(h.a)([Object(v.b)()],Dc.prototype,"updating",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Dc.prototype,"updatingRemaining",null),Dc=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.SpatialIndex2D")],Dc);var Mc={minX:0,minY:0,maxX:0,maxY:0},Ic=r(329),Lc=r(964),zc=m.a.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider"),Fc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).elevationOffset=0,i._layerHandes=new j.a,i}return Object(s.a)(r,[{key:"initialize",value:function(){var e=this;this.renderCoordsHelper=this.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.intersector=new Lc.a(this.view.state.viewingMode),this.intersector.options.store=0;var t=this.computeLayerExtent(this.stageLayer);this.zmin=t[2],this.zmax=t[5];var r=this.stageLayer.events;this._layerHandes.add([r.on("layerObjectAdded",(function(t){return e.objectChanged(t.object)})),r.on("layerObjectRemoved",(function(t){return e.objectChanged(t.object)})),r.on("objectGeometryAdded",(function(t){return e.objectChanged(t.object)})),r.on("objectGeometryRemoved",(function(t){return e.objectChanged(t.object)})),r.on("vertexAttrsUpdated",(function(t){return e.objectChanged(t.object)})),r.on("objectTransformation",(function(t){return e.objectChanged(t)}))])}},{key:"dispose",value:function(){this._layerHandes.destroy()}},{key:"elevationInfoChanged",value:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){var t=Object(oc.e)(this.layer.spatialReference),r=Object(Ic.a)(e.unit);this.elevationOffset=Object(f.t)(e.offset,0)*r/t}else this.elevationOffset=0}},{key:"getElevation",value:function(e,t,r,i){if(Bc[0]=e,Bc[1]=t,Bc[2]=r,!this.renderCoordsHelper.toRenderCoords(Bc,i,Bc))return zc.error("could not project point for elevation alignment"),null;var n=this.elevationOffset,a=this.zmin+n,o=this.zmax+n;this.renderCoordsHelper.setAltitude(Nc,o,Bc),this.renderCoordsHelper.setAltitude(Hc,a,Bc);return this.intersector.reset(Nc,Hc),this.intersector.intersect(this.intersectLayers,null,null,1,null,(function(e){return e.metadata&&e.metadata.isElevationSource})),this.intersector.results.min.getIntersectionPoint(Bc)?this.renderCoordsHelper.getAltitude(Bc):null}},{key:"objectChanged",value:function(e){var t;if(null!=(t=e.metadata)&&t.isElevationSource&&this.spatialReference){Object(A.h)(Vc),e.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(e.metadata.lastValidElevationBB.min,e.metadata.lastValidElevationBB.max,Vc);var r=e.boundingVolumeWorldSpace.min,i=e.boundingVolumeWorldSpace.max;this.expandExtent(r,i,Vc),Object(A.A)(Vc,Gc),this.zmin=Math.min(this.zmin,Vc[2]),this.zmax=Math.max(this.zmax,Vc[5]),Uc.extent=Gc,Uc.spatialReference=this.spatialReference,this.emit("elevation-change",Uc),Object(P.k)(e.metadata.lastValidElevationBB.min,r),Object(P.k)(e.metadata.lastValidElevationBB.max,i)}}},{key:"computeLayerExtent",value:function(e){var t=this;return Object(A.h)(Vc),e.objects.forAll((function(e){return t.expandExtent(e.boundingVolumeWorldSpace.min,e.boundingVolumeWorldSpace.max,Vc)})),Vc}},{key:"expandExtent",value:function(e,t,r){for(var i=0;i<8;++i)Bc[0]=1&i?e[0]:t[0],Bc[1]=2&i?e[1]:t[1],Bc[2]=4&i?e[2]:t[2],this.renderCoordsHelper.fromRenderCoords(Bc,Bc,this.spatialReference),Object(A.n)(r,Bc);return r}}]),r}(Ve.a.EventedMixin(O.a));Object(h.a)([Object(v.b)({constructOnly:!0})],Fc.prototype,"layer",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Fc.prototype,"stageLayer",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Fc.prototype,"view",void 0),Object(h.a)([Object(v.b)({readOnly:!0,aliasOf:"view.spatialReference"})],Fc.prototype,"spatialReference",void 0),Fc=Object(h.a)([Object(g.a)("esri.views.3d.layers.support.StageLayerElevationProvider")],Fc);var Vc=Object(A.h)(),Gc=Object(R.m)(),Uc={spatialReference:null,extent:Gc,context:"scene"},Bc=Object(E.e)(),Nc=Object(E.e)(),Hc=Object(E.e)();var qc,Wc=Object(E.e)(),Yc=r(290),Zc=r(271),Xc=function(){function e(t,r){var i=this;for(var n in Object(o.a)(this,e),this.owner=r,this.properties={},this.afterDispatchHandle=null,t){var a=t[n],s=new Yc.a(a,null,null,2,2);this.properties[n]={pool:s,acquired:[]}}this.afterDispatchHandle=Object(Zc.a)((function(){return i.release()}))}return Object(s.a)(e,[{key:"destroy",value:function(){for(var e in this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.properties){var t,r=this.properties[e],i=Object(_.a)(r.acquired);try{for(i.s();!(t=i.n()).done;){var n=t.value;Object(Zc.b)(n)||r.pool.release(n)}}catch(a){i.e(a)}finally{i.f()}r.pool.destroy(),r.pool=null,r.acquired=null}this.properties=null,this.owner=null}},{key:"get",value:function(e){var t=this.owner._get(e),r=this.properties[e],i=r.pool.acquire();for(r.acquired.push(i);i===t;)r.acquired.push(i),i=r.pool.acquire();return i}},{key:"release",value:function(){for(var e in this.properties){var t,r=this.properties[e],i=0,n=Object(_.a)(r.acquired);try{for(n.s();!(t=n.n()).done;){var a=t.value;Object(Zc.b)(a)?r.acquired[i++]=a:r.pool.release(a)}}catch(o){n.e(o)}finally{n.f()}r.acquired.length=i}}}]),e}(),Qc=r(871),Jc=r(772),Kc=r(47),$c=r(201),el=r(166),tl=r(132),rl=Object(E.e)(),il=Object(A.f)(),nl=m.a.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),al=qc=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).propertiesPool=new Xc({computedExtent:Br.a},Object(he.a)(i)),i.computedExtent=null,i.currentRenderer=null,i.rendererHasGeometryOperations=!1,i.graphicStateTracking=null,i.symbolCreationContext=new Ye((function(e,t){return i._frameTask.schedule(e,t)})),i.graphics3DGraphics=new Map,i.stageLayer=null,i.stage=null,i.graphicsDrapedUids=new Set,i.graphicsBySymbol=new Map,i.symbolConversionCache=new Map,i.symbols=new Map,i.graphicsWithoutSymbol=new Map,i.graphicsWaitingForSymbol=new Set,i._handles=new j.a,i._frameTask=K.a,i.suspendSymbolCleanup=!1,i._spatialReference=null,i.arcadeOnDemand=null,i.rendererChangeAbortController=null,i.elevationInfoChangeAbortController=null,i.setupAbortController=null,i.elevationAlignment=null,i.scaleVisibility=null,i.filterVisibility=null,i._spatialIndex=null,i.extentPadding=0,i._updatingPendingLoadedGraphicsChange=null,i.featureStore=null,i.deconflictor=null,i.labeler=null,i.objectStates=null,i.viewElevationProvider=null,i.stageLayerElevationProvider=null,i.sharedSymbolResourcesOwnerHandle=null,i.whenGraphics3DGraphicRequests={},i.pendingUpdates=new Map,i.numberOfGraphics=0,i.numberOfGraphicsProvidingElevation=0,i.pendingAdds=0,i.pendingRemoves=0,i.pendingUpdatesPool=new be.a({allocator:function(e){return e||new ol},deallocator:function(e){return e.clear(),e}}),i.symbolWarningLogged=!1,i.geometryWarningLogged=!1,i.objectIdInvisibleSet=new Set,i._whenSymbolRemoved=new be.a,i.preferredUpdatePolicy=1,i.forcedUpdatePolicy=null,i.elevationFeatureExpressionEnabled=!0,i.owner=null,i.layer=null,i.graphicSymbolSupported=!0,i.getRenderingInfoWithoutRenderer=!1,i.hasZ=null,i.hasM=null,i._usedMemory=0,i._visible=void 0,i._startCreateGraphics=!1,i}return Object(s.a)(r,[{key:"spatialIndex",get:function(){return this._spatialIndex||(this._spatialIndex=new Dc({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return Object(f.k)(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?0:Object(f.t)(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var e,t;return!!(this.graphicsWaitingForSymbol.size>0||this.running||null!=(e=this.elevationAlignment)&&e.updating||Object(f.k)(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(t=this.filterVisibility)&&t.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},{key:"running",get:function(){var e;return this.pendingUpdates.size>0||!(null==(e=this._spatialIndex)||!e.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var e;return this.owner.suspended||(null==(e=this.owner.suspendInfo)?void 0:e.outsideOfView)}},{key:"updatingRemaining",get:function(){var e,t;return this.updating?this.pendingUpdates.size+.1*((null==(e=this._spatialIndex)?void 0:e.updatingRemaining)||0)+.1*((null==(t=this.elevationAlignment)?void 0:t.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.averageSymbolComplexity,a=Math.max(1,Object(f.k)(n)?n.primitivesPerFeature:1),o=Object(f.k)(n)&&n.drawCallsPerFeature>0?r/n.drawCallsPerFeature*.3:r,s=Math.ceil(i/a),c=Math.max(t,Math.min(r,s,o)),l=this._get("displayFeatureLimit");return l&&l.minimumTotalNumberOfFeatures===t&&l.maximumTotalNumberOfFeatures===r&&l.maximumTotalNumberOfPrimitives===i&&l.averageSymbolComplexity===n&&l.maximumNumberOfFeatures===c?l:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:i,averageSymbolComplexity:n,maximumNumberOfFeatures:c}}},{key:"averageSymbolComplexity",get:function(){var e=function(e){var t=It(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}(this.symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||Object(f.k)(t)&&(e.estimated&&(t.primitivesPerFeature>=e.primitivesPerFeature||t.primitivesPerCoordinate>=e.primitivesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.primitivesPerFeature===e.primitivesPerFeature&&t.primitivesPerCoordinate===e.primitivesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}},{key:"spatialReference",get:function(){return this._spatialReference}},{key:"usedMemory",get:function(){var e=Object(f.k)(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+e}},{key:"usedMemoryPerGraphic",get:function(){if(this._usedMemory&&this.numberOfGraphics)return Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics>30?0:this._usedMemory/this.numberOfGraphics;if(Object(f.k)(this.averageSymbolComplexity)){var e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"getConvertedSymbol",value:function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var r=Object(ye.a)(e,!0,!1,this.hasLabelingContext(e)),i=r.symbol||null;return i||r.error&&nl.error(r.error.message),this.symbolConversionCache.set(e.id,i),i}},{key:"getSymbolComplexitiesUsedOrRenderer",value:function(e){if(Object(f.j)(e))return[];var t=e.getSymbols(),r="backgroundFillSymbol"in e&&e.backgroundFillSymbol;if(!(r||t&&t.length))return[];var i=[],n=this.getSymbolComplexityUsedOrRenderer(r);Object(f.k)(n)&&i.push(n);var a,o=Object(_.a)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=this.getSymbolComplexityUsedOrRenderer(s);Object(f.k)(c)&&i.push(c)}}catch(l){o.e(l)}finally{o.f()}return i}},{key:"getSymbolComplexityUsedOrRenderer",value:function(e){if(Object(f.j)(e))return null;var t=this.symbols.get(e.id);if(Object(f.k)(t))return t.complexity;var r=this.getConvertedSymbol(e);return r?function(e){return"web-style"===e.type?Mt:It(e.symbolLayers.toArray().map((function(t){return zt(e,t)})))}(r):null}},{key:"getSymbolComplexitiesUsed",value:function(){var e=[];return this.symbols.forEach((function(t){Object(f.k)(t)&&e.push(t.complexity)})),e}},{key:"initialize",value:function(){var e=this;this._spatialReference=this.owner.view.spatialReference,this._set("featureStore",new qe({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return e.spatialIndex},forAllGraphics:function(t){return e.graphics3DGraphics.forEach(t)}}))}},{key:"setup",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i,a,o,s=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupAbortController=Object(ne.d)(),r=this.setupAbortController.signal,this._set("elevationAlignment",t.elevationAlignment),this._set("scaleVisibility",t.scaleVisibility),this._set("filterVisibility",t.filterVisibility),this._set("deconflictor",t.deconflictor),this._set("labeler",t.labeler),this._set("objectStates",t.objectStates),i=this.owner.view,this.viewElevationProvider=new ze(this._spatialReference,i),this.initializeStage(i,this.layer.uid),this.symbolCreationContext.sharedResources=i.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=i.sharedSymbolResources.addGraphicsOwner(this.owner),Object(f.k)(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=i.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=i.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.localOriginFactory=new Qc.a(i.renderSpatialReference),this.symbolCreationContext.elevationProvider=i.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=function(e){return s.notifyGraphicGeometryChanged(e)},this.symbolCreationContext.notifyGraphicVisibilityChanged=function(e){return s.notifyGraphicVisibilityChanged(e)},a=Object(Fe.e)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=8,Object(Fe.b)(a,this._spatialReference,nl);case 8:return this.symbolCreationContext.featureExpressionInfoContext=e.sent,Object(ne.v)(r),this.symbolCreationContext.screenSizePerspectiveEnabled=i.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,o="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this._handles.add([this.watch("suspendedOrOutsideOfView",(function(){return s._frameTask.reschedule((function(){return s.updateLayerVisibility()}))})),this.owner.watch(o,(function(){var e,t=i.screenSizePerspectiveEnabled&&s.layer.screenSizePerspectiveEnabled;t!==s.symbolCreationContext.screenSizePerspectiveEnabled&&(s.symbolCreationContext.screenSizePerspectiveEnabled=t,null==(e=s.labeler)||e.reset(),s.recreateAllGraphics())})),this.owner.watch("slicePlaneEnabled",(function(e){return s.slicePlaneEnabledChange(!!e)})),this.owner.view.watch("pixelRatio",(function(){return s.pixelRatioChange()})),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",(function(e){return s.physicalBasedRenderingChange(e)})),Object(p.e)(i.basemapTerrain,"tilingScheme",(function(e){e.spatialReference.equals(s.symbolCreationContext.overlaySR)||(s.symbolCreationContext.overlaySR=i.basemapTerrain.spatialReference),s._handles.has("loaded-graphics")?s.recreateAllGraphics():s._handles.add([Object(p.b)(s.owner,"loadedGraphics","change",(function(e){return s.graphicsCollectionChanged(e)}),(function(){return s.recreateAllGraphics()})),Object(p.b)(s.owner,"loadedGraphics","after-changes",(function(){return s._signalUpdatingDuringAsyncLoadedGraphicsChange()}),(function(){return s._signalUpdatingDuringAsyncLoadedGraphicsChange()}))],"loaded-graphics")})),Object(p.f)(this,"asyncUpdates",(function(){return s.runTask(K.c)}),!0),Object(p.a)(this,"effectiveUpdatePolicy",(function(e){Object(f.k)(s.stageLayer)&&(s.stageLayer.updatePolicy=e),s.symbolCreationContext.isAsync=0===s.effectiveUpdatePolicy,1===e&&s.runTask(K.c)}),!0)]),this._frameTask=i.resourceController.scheduler.registerTask(K.b.GRAPHICS_CORE,this),this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",(function(){return s.deconflictor.featureReductionChange()}))),this.notifyChange("averageSymbolComplexity"),e.prev=15,e.next=18,this.rendererChange(this.layer.renderer);case 18:e.next=22;break;case 20:e.prev=20,e.t0=e.catch(15);case 22:Object(ne.v)(r),this.setupAbortController=null;case 23:case"end":return e.stop()}}),e,this,[[15,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"abortSetup",value:function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)}},{key:"destroy",value:function(){for(var e in this.abortSetup(),this.abortRendererChange(),this.abortElevationInfoChange(),this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null),this.clear(),Object(f.k)(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null),this.stage&&(this.stage.remove(this.stageLayer),this.stageLayer=null,this.stage=null),this._handles=Object(f.e)(this._handles),this._frameTask.remove(),this._frameTask=K.a,this._spatialReference=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new pe.a("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle=Object(f.r)(this.sharedSymbolResourcesOwnerHandle),this.propertiesPool=Object(f.e)(this.propertiesPool),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear(),this._spatialIndex=Object(f.e)(this._spatialIndex),this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))}},{key:"clear",value:function(){var e;this.objectStates&&this.objectStates.allGraphicsDeleted(),Object(f.k)(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach((function(e){return e.destroy()})),null==(e=this._spatialIndex)||e.clear(),this.graphics3DGraphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach((function(e){Object(f.k)(e)&&e.destroy()})),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol.clear(),this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.pendingAdds=0,this.pendingRemoves=0,this.notifyChange("updating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.featureStore.events.emit("changed")}},{key:"initializeStage",value:function(e,t){var r=this;this.stage=e._stage,this.stageLayer=new Jc.a({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t),this.stage.add(this.stageLayer);var i=this.stageLayer.events;i.on("objectTransformation",(function(e){return r.notifyGraphicGeometryChanged(e.metadata.graphicUid)})),i.on("visibilityChanged",(function(e){return r.notifyGraphicVisibilityChanged(e.metadata.graphicUid)})),i.on("objectGeometryAdded",(function(e){return r.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)})),i.on("objectGeometryRemoved",(function(e){return r.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)})),i.on("vertexAttrsUpdated",(function(e){return r.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)}))}},{key:"notifyGraphicGeometryChanged",value:function(e){if(!Object(f.j)(this.graphicStateTracking)){var t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicGeometry(t)}}},{key:"notifyGraphicVisibilityChanged",value:function(e){if(!Object(f.j)(this.graphicStateTracking)){var t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicVisibility(t)}}},{key:"updateLayerVisibility",value:function(){var e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this.numberOfGraphics>e*sl,r=!this.suspendedOrOutsideOfView&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())}},{key:"updateStageLayerVisibility",value:function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)}},{key:"getGraphics3DGraphicById",value:function(e){return this.graphics3DGraphics.get(e)}},{key:"getGraphics3DGraphicByObjectId",value:function(e){var t;return null!=(t=this.owner.layer)&&t.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}},{key:"_getGraphicObjectID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.owner.layer&&this.owner.layer.objectIdField;return Object(ge.e)(e,t)}},{key:"graphics3DGraphicsByObjectID",get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var r=new Map;return this.graphics3DGraphics.forEach((function(i){if(i){var n=i.graphic,a=e._getGraphicObjectID(n,t);Object(f.k)(a)&&r.set(a,i)}})),r}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"updateLabelingInfo",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.deconflictor&&this.deconflictor.labelingInfoChange(t),i=this.labeler&&this.labeler.labelingInfoChange(t),e.next=3,Object(ne.j)([r,i]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateVisibilityInfo",value:function(){this.deconflictor&&this.deconflictor.labelingInfoChange(),this.labeler&&this.labeler.visibilityInfoChange()}},{key:"symbolUpdateType",get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,r=0;return Object(ve.c)(this.symbols,(function(i,n){if(Object(f.k)(i)){var a=i.getFastUpdateStatus();if(a.loading>0)return!0;e.graphicsBySymbol.has(n)&&(r+=a.fast,t+=a.slow)}return!1}))?"unknown":r>=0&&0===t?"fast":t>=0&&0===r?"slow":"mixed"}},{key:"runTask",value:function(e){this._frameTask.processQueue(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("updating"),this.notifyChange("updatingRemaining")}},{key:"setObjectIdVisibility",value:function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var r=this._findGraphics3DGraphicByObjectId(e);Object(f.k)(r)&&this._updateUserVisibility(r)}},{key:"_findGraphics3DGraphicByObjectId",value:function(e){var t=this;return Object(ve.a)(this.graphics3DGraphics,(function(r){return t._getGraphicObjectID(r.graphic)===e}))}},{key:"_updateUserVisibility",value:function(e){if(Object(f.j)(e))return!1;var t=e.graphic,r=this._getGraphicObjectID(t),i=t.visible&&!this.owner.suspended&&(Object(f.j)(r)||!this.objectIdInvisibleSet.has(r));return e.setVisibilityFlag(0,i,0)}},{key:"whenGraphics3DGraphic",value:function(e){var t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);var r=this.whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;var i=Object(ne.f)();return this.whenGraphics3DGraphicRequests[e.uid]=i,i.promise}},{key:"boundsForGraphics3DGraphic",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){var i,a,o,s,c,l,u,d,h,p;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._spatialReference,a=this.owner.view.renderSpatialReference,o=this.owner.view.basemapTerrain.spatialReference,s=function(e,t,r){return Object(T.l)(e,a,t,e,i,t,r)},c=function(e,t,r){return Object(T.l)(e,o,t,e,i,t,r)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:Object(f.k)(r)&&r.useViewElevation,minDemResolution:Object(f.k)(r)&&r.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,e.next=8,t.getProjectedBoundingBox(s,c,l,Object(f.i)(r,"signal"));case 8:if(u=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:return d=u.boundingBox,u.requiresDrapedElevation&&(h=this.symbolCreationContext.elevationProvider)&&(Object(A.d)(d,rl),p=Object(f.t)(h.getElevation(rl[0],rl[1],0,i,"ground"),0),d[2]=Math.min(d[2],p),d[5]=Math.max(d[5],p)),e.abrupt("return",{boundingBox:d,screenSpaceObjects:u.screenSpaceObjects});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"whenGraphicBounds",value:function(e,t){var r=this;return Object(p.j)(this.owner,"loadedGraphics").then((function(){var t=r.owner.layer&&r.owner.layer.objectIdField,i=r.owner.loadedGraphics.find((function(r){return r===e||t&&r.attributes&&e.attributes&&r.attributes[t]===e.attributes[t]}));if(i)return r.whenGraphics3DGraphic(i);throw new pe.a("internal:graphic-not-part-of-view","Graphic is not part of this view")})).then((function(e){return r.boundsForGraphics3DGraphic(e,t)}))}},{key:"computeAttachmentOrigin",value:function(e,t){var r=this.graphics3DGraphics.get(e.uid);if(!r)return null;var i=r.computeAttachmentOrigin();if(0===i.render.num&&0===i.draped.num)return null;Object(P.w)(cl,0,0,0);var n=0;if(i.render.num>0){if(!Object(T.r)(i.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,ll,t))return null;Object(P.f)(cl,cl,ll),n++}if(i.draped.num>0){var a=Object(de.a)(i.draped.origin,2),o=a[0],s=a[1],c=Object(f.t)(this.viewElevationProvider.getElevation(o,s,"ground"),0);if(Object(P.w)(ll,o,s,c),!Object(T.r)(ll,this.viewElevationProvider.spatialReference,ll,t))return null;Object(P.f)(cl,cl,ll),n++}return n>1&&Object(P.e)(cl,cl,1/n),new Kc.a({x:cl[0],y:cl[1],z:cl[2],spatialReference:t})}},{key:"getSymbolLayerSize",value:function(e,t){var r=this.symbols.get(e.id);if(Object(f.j)(r))throw new pe.a("internal:symbol-not-part-of-view","Symbol is not part of this view");var i=e.symbolLayers.indexOf(t);if(-1===i)throw new pe.a("internal:missing-symbol-layer","Symbol layer is not in symbol");var n=r.getSymbolLayerSize(i);if(null==n)throw new pe.a("internal:missing-size","Symbol layer has no valid size");return n}},{key:"graphicsCollectionChanged",value:function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic.uid,r=this.graphics3DGraphics.get(t),i=this.graphicsWithoutSymbol.get(t);if(r||i)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(r);break;case"geometry":this.graphicUpdateGeometryHandler(r,e);break;case"symbol":this.graphicUpdateSymbolHandler(r,e)}}},{key:"graphicUpdateGeometryHandler",value:function(e,t){var r=t.graphic.geometry;if(Object(f.j)(r))this.recreateGraphic(t.graphic);else if(Object(f.j)(e)){var i=t.graphic.symbol&&t.graphic.symbol.id;if(i){var n=this.symbols.get(i);if(Object(f.k)(n)&&0===n.loadStatus)return}this.recreateGraphic(t.graphic)}else{var a=e.graphics3DSymbol;!Object(f.j)(t.newValue)&&a.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(r)}}},{key:"graphicUpdateSymbolHandler",value:function(e,t){var r=t.graphic,i=Object(f.k)(e)?e.graphics3DSymbol:Object(f.k)(t.oldValue)?this.symbols.get(t.oldValue.id):null;if(Object(f.j)(i)||Object(f.j)(t.newValue))this.recreateGraphic(r);else{var n=i.symbol,a=this.getConvertedSymbol(t.newValue);if(a.type===n.type&&"web-style"!==a.type&&"web-style"!==n.type){var o=this.graphicsBySymbol.get(n.id);if(o&&1!==o.size)this.recreateGraphic(r);else{var s=Object(ae.a)(n,a);if(Object(f.j)(s))this.updateSymbolMapping(n.id,a);else{var c={diff:s,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(i.prepareSymbolPatch(c),Object(ae.d)(c.diff)){var l=this._getRenderingInfo(r);if(Object(f.j)(l))this.recreateGraphic(r);else{var u,d=i.extentPadding,h=Object(_.a)(c.symbolStatePatches);try{for(h.s();!(u=h.n()).done;){(0,u.value)()}}catch(b){h.e(b)}finally{h.f()}if(d!==i.extentPadding&&this.recomputeExtentPadding(),Object(f.k)(e)){var p,v=Object(_.a)(c.graphics3DGraphicPatches);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e,l)}}catch(b){v.e(b)}finally{v.f()}}this.updateSymbolMapping(n.id,a)}}else this.recreateGraphic(r)}}}else this.recreateGraphic(r)}}},{key:"graphicUpdateVisibleHandler",value:function(e){this._updateUserVisibility(e)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}},{key:"recreateGraphics",value:function(e){this.suspendSymbolCleanup=!0,this.remove(e),this.add(e),this.suspendSymbolCleanup=!1,1===this.effectiveUpdatePolicy&&this._cleanupSymbols()}},{key:"recreateGraphic",value:function(e){this.recreateGraphics([e])}},{key:"_beginGraphicUpdate",value:function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")}},{key:"_endGraphicUpdate",value:function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))}},{key:"recomputeExtentPadding",value:function(){var e=0;this.symbols.forEach((function(t){Object(f.k)(t)&&(e=Math.max(e,t.extentPadding))})),this._set("extentPadding",e)}},{key:"expandComputedExtent",value:function(e){var t=il,r=e.spatialReference;Object(ge.c)(e,t);var i=this._spatialReference,n=qc.tmpVec;if(r.equals(i)||Object(T.s)(t[0],t[1],0,r,n,i)&&(t[0]=n[0],t[1]=n[1],Object(T.s)(t[3],t[4],0,r,n,i),t[3]=n[0],t[4]=n[1]),Object(w.h)(t[0])&&Object(w.h)(t[3])&&Object(w.h)(t[1])&&Object(w.h)(t[4])){var a=this.computedExtent,o=null,s=Object(w.h)(t[2])&&Object(w.h)(t[5]),c=s&&(!a||null==a.zmin||t[2]<a.zmin),l=s&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||c||l)&&((o=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),o.ymin=Math.min(t[1],a.ymin),o.xmax=Math.max(t[3],a.xmax),o.ymax=Math.max(t[4],a.ymax),o.spatialReference=i):((o=this.propertiesPool.get("computedExtent")).xmin=t[0],o.ymin=t[1],o.xmax=t[3],o.ymax=t[4],o.spatialReference=i),o&&(c&&(o.zmin=t[2]),l&&(o.zmax=t[5]),this._set("computedExtent",o))}}},{key:"abortElevationInfoChange",value:function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)}},{key:"elevationInfoChange",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r,i=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.abortElevationInfoChange(),t=Object(ne.d)(),this.elevationInfoChangeAbortController=t,r=Object(Fe.e)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=6,Object(Fe.b)(r,this._spatialReference,nl);case 6:this.symbolCreationContext.featureExpressionInfoContext=e.sent,Object(ne.v)(t),this.elevationInfoChangeAbortController=null,this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol((function(e,t,r){e.globalPropertyChanged("elevationInfo",t)?t.forEach((function(e){var t,r=e.graphic,i=e.labelGraphics,n=Object(_.a)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.graphics3DSymbolLayer.updateGraphicElevationContext(r,a)}}catch(o){n.e(o)}finally{n.f()}})):i._recreateSymbol(r)})),this.updateStageLayerElevationProvider(),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateStageLayerElevationProvider",value:function(){this.stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this.numberOfGraphicsProvidingElevation>0&&(this.stageLayerElevationProvider=new Fc({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))}},{key:"clearSymbolsAndGraphics",value:function(){var e,t,r,i,n;this.clear(),null==(e=this.filterVisibility)||e.clear(),null==(t=this.labeler)||t.reset(),null==(r=this.deconflictor)||r.clear(),null==(i=this.elevationAlignment)||i.clear(),null==(n=this.stageLayer)||n.invalidateSpatialQueryAccelerator(),this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)}},{key:"startCreateGraphics",value:function(){this._startCreateGraphics=!0,this.recreateAllGraphics()}},{key:"recreateAllGraphics",value:function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))}},{key:"_recreateSymbol",value:function(e){var t=this,r=this.graphicsBySymbol.get(e),i=[];r&&(r.forEach((function(e,r){var n,a=e.usedMemory;t._conditionalRemove(e,r),null==(n=t._spatialIndex)||n.remove(e),i.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(r,a),t.updateLayerVisibility(),t.featureStore.events.emit("changed")})),this.graphicsBySymbol.set(e,new Map));var n=this.symbols.get(e);Object(f.k)(n)&&n.destroy(),this.symbols.delete(e),this.add(i)}},{key:"_conditionalRemove",value:function(e,t){e.isDraped&&this.graphicsDrapedUids.delete(t),this.objectStates&&this.objectStates.removeGraphic(e),this.labeler&&this.labeler.removeGraphic(e),this.deconflictor&&this.deconflictor.removeGraphic(e),Object(f.k)(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(e)}},{key:"add",value:function(e){e&&0!==e.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(0===this._updatePolicyForGraphics(e)?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")):nl.error("#add()","Cannot add graphics before terrain surface has been initialized"))}},{key:"_updatePolicyForGraphics",value:function(e){if(1===this.effectiveUpdatePolicy&&("mesh"===this.layer.geometryType||null==this.layer.geometryType)){var t,r=Object(_.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(Object(f.k)(i.geometry)&&"mesh"===i.geometry.type&&!i.geometry.loaded)return 0}}catch(n){r.e(n)}finally{r.f()}}return this.effectiveUpdatePolicy}},{key:"_addImmediate",value:function(e){this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var t,r=Object(_.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._addGraphic(i,this._getRenderingInfo(i,nl),1)}}catch(n){r.e(n)}finally{r.f()}this._cleanupSymbols(),this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols()),this.owner.view.deconflictor.setDirty()}},{key:"_addDelayed",value:function(e){var t,r=Object(_.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,n=i.uid,a=this.pendingUpdates.get(n);a?a.add?0!==a.state&&a.abortController.abort():this.pendingAdds++:(a=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(n,a)),a.add=i}}catch(o){r.e(o)}finally{r.f()}this.notifyChange("running"),this.notifyChange("updatingRemaining")}},{key:"remove",value:function(e){0===this.effectiveUpdatePolicy?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")}},{key:"_removeImmediate",value:function(e){var t,r=Object(_.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._removeGraphic(i)}}catch(n){r.e(n)}finally{r.f()}this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}},{key:"_removeDelayed",value:function(e){var t,r=Object(_.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,n=i.uid,a=this.pendingUpdates.get(n);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(n),1===a.state&&a.abortController.abort(),this.pendingAdds--);else{var o=this.pendingUpdatesPool.pushNew();o.remove=i,this.pendingUpdates.set(n,o),this.pendingRemoves++}}}catch(s){r.e(s)}finally{r.f()}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining")}},{key:"_finishPendingUpdates",value:function(){this.pendingUpdatesPool.clear(),this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&nl.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0}},{key:"_applyPendingUpdates",value:function(e){var t;if(this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,0===this.pendingUpdates.size&&null!=(t=this._spatialIndex)&&t.updating)this._spatialIndex.update();else{var r,i=Object(_.a)(this.pendingUpdates);try{for(i.s();!(r=i.n()).done;){var n=Object(de.a)(r.value,2),a=n[0],o=n[1];if(e.done)break;o.add&&0===o.state&&this._processPendingUpdateNew(o);var s=this.effectiveUpdatePolicy;if(!o.remove||o.add&&2!==o.state||(this.pendingRemoves--,e.madeProgress(),this._removeGraphic(o.remove),o.remove=null,s=1),o.add)switch(o.state){case 2:this._addGraphic(o.add,o.renderingInfo,s),o.add=null,this.pendingAdds--,e.madeProgress();break;case 3:o.add=null,this.pendingAdds--}null==o.remove&&null==o.add&&this.pendingUpdates.delete(a)}}catch(c){i.e(c)}finally{i.f()}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}}},{key:"_processPendingUpdateNew",value:function(e){if(e.add){var t=e.add.geometry;Object(f.k)(t)&&"mesh"===t.type&&!t.loaded?this._processPendingUpdateNewMesh(e,t):this._processPendingUpdateNewRenderingInfo(e)}else e.state=2}},{key:"_processPendingUpdateNewMesh",value:function(e,t){var r=this;e.state=1,e.abortController=Object(ne.d)();var i=e.abortController.signal;t.load({signal:i}).then((function(){e.abortController=null,r._processPendingUpdateNewRenderingInfo(e)}),(function(t){return r._processPendingUpdateNewError(e,t)}))}},{key:"_processPendingUpdateNewError",value:function(e,t){e.abortController=null,Object(ne.m)(t)?e.state=0:e.state=3}},{key:"_processPendingUpdateNewRenderingInfo",value:function(e){var t=this;if(Object(f.j)(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add,nl),void(e.state=2);e.state=1,e.abortController=Object(ne.d)(),this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal}).then((function(r){Object(f.j)(r)||Object(f.j)(r.symbol)?(nl&&!t.symbolWarningLogged&&(t.symbolWarningLogged=!0,nl.warn("Graphic in layer ".concat(t.layer.id," has no symbol and will not render"))),e.renderingInfo=null):e.renderingInfo=r,e.state=2}),(function(t){e.abortController=null,Object(ne.m)(t)?e.state=0:e.state=3}))}},{key:"_addGraphic",value:function(e,t,r){var i=this;if(this.graphicsWithoutSymbol.set(e.uid,e),!Object(f.j)(t)&&!Object(f.j)(t.symbol)&&Object(ge.f)(e)){var n=t.symbol,a=this.getOrCreateGraphics3DSymbol(n,t.renderer);if(!Object(f.j)(a)){this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var o=new We(e,t,this.layer),s=!1,c=function(e){e===a.symbol.id&&(s=!0)};this._whenSymbolRemoved.push(c);var l=function(){if(!i.destroyed){if(i._whenSymbolRemoved.removeUnordered(c),!(s||a.destroyed||i.graphicSymbolSupported&&e.symbol&&e.symbol.id!==a.symbol.id)){if(i.graphicsWaitingForSymbol.has(e.uid)){var t=i._createGraphics3DGraphic(a,o);i._spatialIndex&&Object(f.k)(t)&&i._spatialIndex.add(t)}i._endGraphicUpdate(e)}--a.referenced,i.featureStore.events.emit("changed"),i.labeler&&i.owner.view.labeler.setDirty()}},u=function(t){i.destroyed||(i._whenSymbolRemoved.removeUnordered(c),s||(Object(ne.m)(t)?i.add([e]):a.destroyed||i._endGraphicUpdate(e)))};0===r?a.load((function(){return i._frameTask.schedule(l)}),(function(e){return i._frameTask.schedule((function(){return u(e)}))})):a.load(l,u)}}}},{key:"_removeGraphic",value:function(e){var t=e.uid,r=this.graphics3DGraphics.get(t);if(r){var i;r.graphics3DSymbol.onRemoveGraphic(r);var n=r.usedMemory,a=r.isElevationSource;this._conditionalRemove(r,t),null==(i=this._spatialIndex)||i.remove(r);var o=r.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(o).delete(t),this.graphicsWithoutSymbol.delete(t),this.removeGraphics3DGraphic(t,n,a),r.destroy(),this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(t),this.graphicsWaitingForSymbol.delete(t),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))}},{key:"hasLabelingContext",value:function(e){if(e instanceof $c.a||e instanceof el.a){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some((function(t){return t.symbol===e}))}return!1}},{key:"hasValidSymbolCreationContext",value:function(e){return!(e instanceof $c.a&&!this.hasLabelingContext(e))||(nl.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}},{key:"_getRenderingInfo",value:function(e,t){var r=e.geometry;if(Object(f.j)(r))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!Object(T.a)(r.spatialReference,this._spatialReference))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has incompatible spatial reference and will not render"))),null;if(!this.graphicSymbolSupported&&Object(f.k)(e.symbol))return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var i,n=this.rendererHasGeometryOperations?Object(se.c)(e,this.layer):e;return i=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||Object(f.k)(this.currentRenderer))?this.owner.getRenderingInfo(n,this.currentRenderer,Object(f.s)(this.arcadeOnDemand)):{symbol:n.symbol||Ie(n.geometry)},Object(f.j)(i)||Object(f.j)(i.symbol)?(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),null):i}},{key:"_getRenderingInfoAsync",value:function(e,t){var r=e.geometry;if(Object(f.j)(r))return nl&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,nl.warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!this.graphicSymbolSupported&&Object(f.k)(e.symbol))return nl&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,nl.warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var i=this.rendererHasGeometryOperations?Object(se.c)(e,this.layer):e;return this.owner.getRenderingInfoAsync(i,Object(f.s)(this.currentRenderer),Object(f.s)(this.arcadeOnDemand),t)}},{key:"createGraphics3DSymbol",value:function(e,t){var r=this;if(!this.hasValidSymbolCreationContext(e))return null;var i,n=this.getConvertedSymbol(e);if(!n)return null;if(Object(f.k)(t)&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=Object(ye.a)(t.backgroundFillSymbol,!1,!0);a.symbol&&"web-style"!==a.symbol.type&&(i=a.symbol.symbolLayers)}var o=function(e,t,r){return new("point-3d"===e.type?Ec:kc)(e,t,r)}(n,this.symbolCreationContext,i);return o.load((function(){var e=o.extentPadding;e>r.extentPadding&&r._set("extentPadding",e),r.notifyChange("averageSymbolComplexity")}),(function(){})),o}},{key:"getOrCreateGraphics3DSymbol",value:function(e,t){var r=this,i=this.symbols.get(e.id);return void 0===i&&(i=e instanceof tl.a?new Tc(e,(function(e){return r._frameTask.schedule(e)}),(function(e){return r.createGraphics3DSymbol(e,t)})):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,i)),Object(f.k)(i)&&++i.referenced,i}},{key:"trackGraphicState",value:function(e){return Object(f.j)(this.graphicStateTracking)&&(this.graphicStateTracking=new Ac(this)),this.graphicStateTracking.add(e)}},{key:"addGraphics3DGraphic",value:function(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this.numberOfGraphics++,e.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this.updateLayerVisibility()}},{key:"removeGraphics3DGraphic",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._usedMemory-=t,this.graphics3DGraphics.delete(e),this.numberOfGraphics--,r&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this.updateLayerVisibility()}},{key:"_createGraphics3DGraphic",value:function(e,t){var r,i,n,a,o=t.graphic;if(this.graphicsWithoutSymbol.delete(o.uid),!this.symbols.has(e.symbol.id))return this.add([o]),null;if(this.graphics3DGraphics.has(o.uid))return null;var s=e.createGraphics3DGraphic(t);if(Object(f.j)(s))return null;this.addGraphics3DGraphic(s);var c=e.symbol.id;this.graphicsBySymbol.has(c)||this.graphicsBySymbol.set(c,new Map),this.graphicsBySymbol.get(c).set(o.uid,s),s.isDraped&&this.graphicsDrapedUids.add(o.uid),s.centroid=null,Object(f.k)(o.geometry)&&"point"!==o.geometry.type&&(s.centroid=Object($e.a)(o.geometry,this._spatialReference)),this._updateUserVisibility(s),Object(f.k)(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(s),null==(r=this.filterVisibility)||r.updateVisibility(s),null==(i=this.deconflictor)||i.addGraphic(s),null==(n=this.labeler)||n.addGraphic(s),null==(a=this.objectStates)||a.addGraphic(s),this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,s),s.initialize(this.stage,this.stageLayer,this.owner),Object(f.k)(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(s);var l=this.whenGraphics3DGraphicRequests[o.uid];return l&&(delete this.whenGraphics3DGraphicRequests[o.uid],l.resolve(s)),s}},{key:"abortRendererChange",value:function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)}},{key:"rendererChange",value:function(){var e=Object(a.a)(n.a.mark((function e(t){var r,i,a,o,s=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.abortRendererChange(),t===this.currentRenderer){e.next=36;break}if(this.validateRenderer(t),Object(f.j)(t)&&this.currentRendererChange(null,!1),!Oe(t)){e.next=35;break}if(!Object(f.k)(t)||!t.arcadeRequired){e.next=24;break}return r=Object(ne.d)(),this.rendererChangeAbortController=r,e.next=7,this.ensureArcade();case 7:if(i=e.sent,a=i.arcadeUtils,Object(ne.v)(r),e.t0=a.hasGeometryOperations(t),!e.t0){e.next=15;break}return e.next=14,a.enableGeometryOperations();case 14:Object(ne.v)(r);case 15:if(0!==this.effectiveUpdatePolicy){e.next=20;break}return e.next=18,this._frameTask.schedule((function(){return s.currentRendererChange(t,!0)}),r.signal);case 18:e.next=21;break;case 20:this.currentRendererChange(t,!0);case 21:this.rendererChangeAbortController=null,e.next=33;break;case 24:if(0!==this.effectiveUpdatePolicy){e.next=32;break}return o=Object(ne.d)(),this.rendererChangeAbortController=o,e.next=29,this._frameTask.schedule((function(){return s.currentRendererChange(t,!1)}),o.signal);case 29:this.rendererChangeAbortController=null,e.next=33;break;case 32:this.currentRendererChange(t,!1);case 33:e.next=36;break;case 35:this.currentRendererChange(t,!1);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureArcade",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(f.j)(this.arcadeOnDemand)){e.next=7;break}return e.next=3,Object(_e.e)();case 3:this.arcadeOnDemand=e.sent,e.t0=this.arcadeOnDemand,e.next=8;break;case 7:e.t0=this.arcadeOnDemand;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"currentRendererChange",value:function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=Object(f.s)(this.arcadeOnDemand);var r=this.symbolCreationContext.renderer;if(e!==r){if(this.symbolConversionCache.clear(),Object(f.j)(e))return this.symbolCreationContext.renderer=null,void this.recreateAllGraphics();var i=Object(ae.a)(r,e);this.updateUnchangedSymbolMappings(i,e,r),this.symbolCreationContext.renderer=e,Object(f.j)(i)||("complete"===i.type?this.recreateAllGraphics():"partial"===i.type&&(this.applyRendererDiff(i,e,r)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("averageSymbolComplexity"))}}},{key:"diffHasSymbolChange",value:function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}},{key:"applySymbolSetDiff",value:function(e,t,r){var i=this;e=e||[],t=t||[];var n,a=[],o=Object(_.a)(t);try{var s=function(){var t=n.value,o=i.graphicsBySymbol.get(t.id);o&&o.forEach((function(n,s){var c=n.graphic,l=i.layer instanceof oe.a?i.layer:null,u=Object(f.s)(i.arcadeOnDemand);if(t!==r.defaultSymbol||r.getSymbol(Object(se.c)(c,l),{arcade:u})!==r.defaultSymbol){var d=n.usedMemory;e.length||r.defaultSymbol?a.push(c):i.graphicsWithoutSymbol.set(s,c);var h=i.graphics3DGraphics.get(s);i._conditionalRemove(h,s),n.destroy(),o.delete(s),i.removeGraphics3DGraphic(s,d),i.updateLayerVisibility()}})),i._whenSymbolRemoved.forAll((function(e){return e(t.id)}))};for(o.s();!(n=o.n()).done;)s()}catch(c){o.e(c)}finally{o.f()}(e.length||a.length)&&(this.graphicsWithoutSymbol.forEach((function(e){return a.push(e)})),this.graphicsWithoutSymbol.clear(),this.add(a)),this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}},{key:"applyUniqueValueRendererDiff",value:function(e,t,r){var i=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(i||n){var a=n?n.added.map((function(e){return e.symbol})):[],o=n?n.removed.map((function(e){return e.symbol})):[];if(n)for(var s=0;s<n.changed.length;s++)a.push(n.changed[s].newValue.symbol),o.push(n.changed[s].oldValue.symbol);return i?(r.defaultSymbol&&o.push(r.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):r.defaultSymbol&&a.length&&o.push(t.defaultSymbol),this.applySymbolSetDiff(a,o,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}},{key:"calculateUnchangedSymbolMapping",value:function(e,t,r){var i=function(e){return Object(f.k)(e)?e.id:null};if(t instanceof fe.a&&r instanceof fe.a&&(Object(f.j)(e)||"partial"===e.type)){var n,a=e&&e.diff,o=a&&a.defaultSymbol,s=a&&a.uniqueValueInfos;return n=s?s.unchanged.map((function(e){return{oldId:i(e.oldValue.symbol),newId:i(e.newValue.symbol)}})):r.uniqueValueInfos.map((function(e,r){return{oldId:i(e.symbol),newId:i(t.uniqueValueInfos[r].symbol)}})),!o&&r.defaultSymbol&&n.push({oldId:i(r.defaultSymbol),newId:i(t.defaultSymbol)}),n}return[]}},{key:"updateSymbolMapping",value:function(e,t){var r=t?"string"==typeof t?t:t.id:null,i="string"==typeof t?null:t;if(e&&e!==r){var n=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==n&&this.graphicsBySymbol.set(r,n);var a=this.symbols.get(e);void 0!==a&&(this.symbols.delete(e),this.symbols.set(r,a),Object(f.k)(a)&&(Object(f.k)(i)?a.symbol=i:a.symbol.id=r))}}},{key:"updateUnchangedSymbolMappings",value:function(e,t,r){var i,n=this.calculateUnchangedSymbolMapping(e,t,r),a=Object(_.a)(n);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.oldId,c=o.newId;this.updateSymbolMapping(s,c)}}catch(l){a.e(l)}finally{a.f()}}},{key:"applyRendererDiff",value:function(e,t,r){if(this.diffHasSymbolChange(e))return!1;if(t instanceof fe.a&&r instanceof fe.a&&this.applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)return!0;var i,n=Object(_.a)(this.graphicsBySymbol);try{for(n.s();!(i=n.n()).done;){var a=Object(de.a)(i.value,1)[0],o=this.symbols.get(a);if(Object(f.k)(o)&&!o.applyRendererDiff(e,t))return!1}}catch(s){n.e(s)}finally{n.f()}return!0}},{key:"opacityChange",value:function(){this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("opacity",t)})),this.updateStageLayerVisibility()}},{key:"slicePlaneEnabledChange",value:function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)})),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())}},{key:"physicalBasedRenderingChange",value:function(e){var t=this;e!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((function(e,r,i){e.globalPropertyChanged("physicalBasedRenderingEnabled",r)||t._recreateSymbol(i)})))}},{key:"pixelRatioChange",value:function(){var e=this;this.forEachGraphics3DSymbol((function(t,r,i){t.globalPropertyChanged("pixelRatio",r)||e._recreateSymbol(i)}))}},{key:"_signalUpdatingDuringAsyncLoadedGraphicsChange",value:function(){var e=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=Object(me.b)((function(){e._updatingPendingLoadedGraphicsChange=null}))}},{key:"setClippingExtent",value:function(e,t){var r=this.symbolCreationContext.clippingExtent,i=Object(R.l)();return function(e,t,r){if(Object(f.j)(e))return!1;var i=!0;return Wc[0]=null!=e.xmin?e.xmin:0,Wc[1]=null!=e.ymin?e.ymin:0,Wc[2]=null!=e.zmin?e.zmin:0,i=i&&Object(T.l)(Wc,e.spatialReference,0,Wc,r,0,1),t[0]=Wc[0],t[1]=Wc[1],Wc[0]=null!=e.xmax?e.xmax:0,Wc[1]=null!=e.ymax?e.ymax:0,Wc[2]=null!=e.zmax?e.zmax:0,i=i&&Object(T.l)(Wc,e.spatialReference,0,Wc,r,0,1),t[2]=Wc[0],t[3]=Wc[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),i}(e,i,t)?this.symbolCreationContext.clippingExtent=Object(A.o)(Object(A.f)(),i):this.symbolCreationContext.clippingExtent=null,!Object(A.i)(this.symbolCreationContext.clippingExtent,r)}},{key:"modifyGraphics3DGraphicVisibilities",value:function(e){var t=!1;this.graphics3DGraphics.forEach((function(r){e(r)&&(t=!0)})),t&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}},{key:"forEachGraphics3DSymbol",value:function(e){var t,r=Object(_.a)(this.symbols);try{for(r.s();!(t=r.n()).done;){var i=Object(de.a)(t.value,2),n=i[0],a=i[1];if(Object(f.j)(a))return;e(a,this.graphicsBySymbol.get(n)||ul,n)}}catch(o){r.e(o)}finally{r.f()}}},{key:"updateAllGraphicsVisibility",value:function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.modifyGraphics3DGraphicVisibilities((function(t){var r=e._updateUserVisibility(t),i=Object(f.k)(e.scaleVisibility)&&e.scaleVisibility.updateVisibility(t);return r||i}))}},{key:"hideAllGraphics",value:function(){this.modifyGraphics3DGraphicVisibilities((function(e){return e.setVisibilityFlag(0,!1,0)}))}},{key:"validateRenderer",value:function(e){var t=je(e);if(t){var r="Renderer for layer '".concat(this.layer.title?"".concat(this.layer.title,", "):"",", id:").concat(this.layer.id,"' is not supported in a SceneView");nl.warn(r,t.message)}}},{key:"volatileGraphicsUpdated",value:function(){this.labeler&&this.labeler.reset(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")}},{key:"_cleanupSymbols",value:function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0||this.suspendSymbolCleanup)){var t=!1;this.symbols.forEach((function(r,i){if(!(Object(f.j)(r)||r.referenced>0)){var n=e.graphicsBySymbol.get(i);n&&0!==n.size||(e.graphicsBySymbol.delete(i),e.symbols.delete(i),r&&r.destroy(),t=!0)}})),t&&(this.recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}}},{key:"snapshotInternals",value:function(){var e=this;return{graphics:Object(ue.a)(this.graphics3DGraphics.keys()).sort(),symbols:Object(ue.a)(this.symbols.keys()).sort(),graphicsBySymbol:Object(ue.a)(this.graphicsBySymbol.keys()).sort().map((function(t){return{symbolId:t,graphics:Object(ue.a)(e.graphicsBySymbol.get(t).keys()).sort()}})),graphicsWithoutSymbol:Object(ue.a)(this.graphicsWithoutSymbol.keys()).sort(),graphicsDrapedUids:Object(ue.a)(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}}},{key:"test",get:function(){var e=this;return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:function(t){e.forcedUpdatePolicy=t}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]),r}(O.a);al.tmpVec=Object(E.e)(),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"computedExtent",void 0),Object(h.a)([Object(v.b)()],al.prototype,"currentRenderer",void 0),Object(h.a)([Object(v.b)()],al.prototype,"rendererHasGeometryOperations",void 0),Object(h.a)([Object(v.b)()],al.prototype,"_frameTask",void 0),Object(h.a)([Object(v.b)()],al.prototype,"rendererChangeAbortController",void 0),Object(h.a)([Object(v.b)()],al.prototype,"elevationInfoChangeAbortController",void 0),Object(h.a)([Object(v.b)()],al.prototype,"setupAbortController",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"elevationAlignment",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"scaleVisibility",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"filterVisibility",void 0),Object(h.a)([Object(v.b)()],al.prototype,"_spatialIndex",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"extentPadding",void 0),Object(h.a)([Object(v.b)()],al.prototype,"_updatingPendingLoadedGraphicsChange",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"featureStore",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"deconflictor",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"labeler",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"objectStates",void 0),Object(h.a)([Object(v.b)()],al.prototype,"preferredUpdatePolicy",void 0),Object(h.a)([Object(v.b)()],al.prototype,"forcedUpdatePolicy",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"effectiveUpdatePolicy",null),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"elevationFeatureExpressionEnabled",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"owner",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"layer",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"graphicSymbolSupported",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"getRenderingInfoWithoutRenderer",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"updating",null),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"running",null),Object(h.a)([Object(v.b)({readOnly:!0})],al.prototype,"suspendedOrOutsideOfView",null),Object(h.a)([Object(v.b)({readOnly:!0,dependsOn:[]})],al.prototype,"updatingRemaining",null),Object(h.a)([Object(v.b)({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],al.prototype,"displayFeatureLimit",null),Object(h.a)([Object(v.b)({readOnly:!0,dependsOn:[]})],al.prototype,"averageSymbolComplexity",null),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"hasZ",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],al.prototype,"hasM",void 0),al=qc=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DCore")],al);var ol=function(){function e(){Object(o.a)(this,e),this.add=null,this.renderingInfo=null,this.state=0,this.remove=null}return Object(s.a)(e,[{key:"clear",value:function(){this.add=null,this.renderingInfo=null,this.state=0,this.abortController=null,this.remove=null}}]),e}(),sl=10,cl=Object(E.e)(),ll=Object(E.e)(),ul=new Map,dl=function(){function e(){Object(o.a)(this,e),this._extents=new be.a({allocator:function(e){return e||Object(R.l)()}}),this._tmpExtent=Object(R.l)(),this._dirty=!1}return Object(s.a)(e,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"clear",value:function(){this._extents.clear()}},{key:"add",value:function(e){this.contains(e)||(this.removeContained(e),Object(R.k)(this._extents.pushNew(),e),this._dirty=!0)}},{key:"pop",value:function(){return this._dirty&&this.mergeTight(),this._extents.pop()}},{key:"merge",value:function(e){return this.mergeTight(e),e.hasProgressed}},{key:"mergeTight",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.c,r=this._extents,i=new Set,n=0;n!==r.length;){r.sort((function(e,t){return e[0]-t[0]})),n=r.length,i.clear();for(var a=function(n){if(t.done)return{v:void 0};for(var a=r.getItemAt(n),o=n+1;o<r.length;++o){var s=r.getItemAt(o);if(s[0]>=a[2])break;i.add(s)}i.forEach((function(n){if(a!==n)if(n[2]<=a[0])i.delete(n);else{var o=Object(R.c)(a),s=Object(R.c)(n),c=e._tmpExtent;Object(R.n)(a,n,c);var l=o+s;(Object(R.c)(c)-l)/l<.05&&(Object(R.k)(a,c),i.delete(n),r.remove(n),t.madeProgress())}})),i.add(a)},o=0;o<r.length;++o){var s=a(o);if("object"===typeof s)return s.v}}this._dirty=!1}},{key:"contains",value:function(e){return this._extents.some((function(t){return Object(R.f)(t,e)}))}},{key:"removeContained",value:function(e){this._extents.filterInPlace((function(t){return!Object(R.f)(e,t)}))}},{key:"test",get:function(){var e=this;return{containsPoint:function(t){return e._extents.some((function(e){return Object(R.g)(e,t)}))}}}}]),e}(),hl=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).dirtyExtents=new dl,e.globalDirty=!1,e.averageExtentUpdateSize=0,e.dirtyGraphicsSet=new Set,e.handles=new j.a,e.updateElevation=!1,e.layerView=null,e.graphicsCore=null,e.events=new Ve.a,e}return Object(s.a)(r,[{key:"setup",value:function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var a=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",(function(e){return n._elevationChanged(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),a.registerTask(K.b.ELEVATION_ALIGNMENT,this)])}},{key:"destroy",value:function(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}},{key:"clear",value:function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}},{key:"suspendedChange",value:function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}},{key:"elevationInfoChange",value:function(){this.globalDirty=!0,this.notifyChange("updating")}},{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}},{key:"runTask",value:function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}},{key:"_updateDirtyGraphics",value:function(e){var t,r=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy,n=Object(_.a)(this.dirtyGraphicsSet.keys());try{for(n.s();!(t=n.n()).done;){var a=t.value,o=this.graphicsCore.getGraphics3DGraphicById(a);if(this.dirtyGraphicsSet.delete(a),Object(f.k)(o)&&(o.alignWithElevation(this.elevationProvider,r,i),e.madeProgress()),e.done)return}}catch(s){n.e(s)}finally{n.f()}}},{key:"_updateDirtyExtents",value:function(e){for(var t=this;!this.dirtyExtents.empty&&!e.done;){var r=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:r,spatialReference:i});var n=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(r,i,(function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);Object(f.k)(r)&&r.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-n)+.9*this.averageExtentUpdateSize,e.madeProgress()}}},{key:"markAllGraphicsElevationDirty",value:function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,r){return e.dirtyGraphicsSet.add(r)}))}},{key:"_elevationChanged",value:function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent,r=e.spatialReference;if(this.layerView.suspended){if(!this.updateElevation){var i=this.graphicsCore.computedExtent;i&&t[2]>i.xmin&&t[0]<i.xmax&&t[3]>i.ymin&&t[1]<i.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:r})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}}}]),r}(O.a);Object(h.a)([Object(v.b)({readOnly:!0})],hl.prototype,"updating",null),Object(h.a)([Object(v.b)({readOnly:!0})],hl.prototype,"updatingRemaining",null);var fl=hl=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],hl),pl=r(124),vl=function(){function e(){Object(o.a)(this,e),this.items=[]}return Object(s.a)(e,[{key:"addObject",value:function(e,t){this.items.push({type:0,objectStateId:t,object:e})}},{key:"addRenderGeometry",value:function(e,t,r){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:r})}},{key:"addExternal",value:function(e,t){this.items.push({type:2,objectStateId:t,remove:e})}},{key:"remove",value:function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.objectStateId===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}},{key:"removeObject",value:function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];0===r.type&&r.object===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}},{key:"removeRenderGeometry",value:function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];1===r.type&&r.renderGeometry===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}},{key:"removeAll",value:function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]}},{key:"_removeObjectStateItem",value:function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}]),e}(),bl=function(){function e(t,r){Object(o.a)(this,e),this.stateType=t,this.objectIdField=r,this.objectStateSet=new vl,this.ids=new Set,this.paused=!1}return Object(s.a)(e,[{key:"hasGraphic",value:function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}]),e}(),ml=function(){function e(t){Object(o.a)(this,e),this._graphicsCore=t,this._stateSets=new Array}return Object(s.a)(e,[{key:"destroy",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null}},{key:"acquireSet",value:function(e,t){var r=this,i=new bl(e,t);this._stateSets.push(i);var n=Object(pl.c)((function(){return r.releaseSet(i)}));return{set:i,handle:n}}},{key:"releaseSet",value:function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}},{key:"_addObjectStateSet",value:function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}},{key:"_removeObjectStateSet",value:function(e,t){e.removeObjectState(t.objectStateSet)}},{key:"setUid",value:function(e,t){e.ids.add(t);var r=this._graphicsCore.graphics3DGraphics.get(t);r&&this._addObjectStateSet(r,e)}},{key:"setUids",value:function(e,t){var r=this;t.forEach((function(t){return r.setUid(e,t)}))}},{key:"setObjectIds",value:function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)}},{key:"addGraphic",value:function(e){var t=this;this._stateSets.forEach((function(r){!r.paused&&r.hasGraphic(e)&&t._addObjectStateSet(e,r)}))}},{key:"removeGraphic",value:function(e){var t=this;this._stateSets.forEach((function(r){r.hasGraphic(e)&&t._removeObjectStateSet(e,r)}))}},{key:"allGraphicsDeleted",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))}},{key:"initializeSet",value:function(e){var t=this,r=this._graphicsCore.graphics3DGraphics;e.objectIdField?r.forEach((function(r){r&&e.hasGraphic(r)&&t._addObjectStateSet(r,e)})):e.ids.forEach((function(i){var n=r.get(i);n&&t._addObjectStateSet(n,e)}))}},{key:"test",get:function(){return{states:this._stateSets}}}]),e}(),gl=r(335),yl=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments))._scaleRangeActive=!1,e.layerScaleRangeVisibilityQuery=!1,e.handles=new j.a,e.layerView=null,e.layer=null,e.queryGraphicUIDsInExtent=null,e.extent=null,e.graphicsCore=null,e.basemapTerrain=null,e.layerScaleEnabled=!0,e.suspended=!1,e.updating=!0,e}return Object(s.a)(r,[{key:"setup",value:function(e,t,r,i,n){this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=r,this.graphicsCore=i,this.basemapTerrain=n,this.updateScaleRangeActive();var a=this.layerView.view.resourceController.scheduler;this.handles.add(a.registerTask(K.b.SCALE_VISIBILITY,this))}},{key:"destroy",value:function(){this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this.extent=e,this._setDirty()}},{key:"scaleRangeActive",value:function(){return this._scaleRangeActive}},{key:"updateScaleRangeActive",value:function(){var e=this,t=this.layer,r=this.layerScaleEnabled&&Ol(t.minScale,t.maxScale);t.labelingInfo&&!r&&(r=t.labelingInfo.some((function(e){return e&&Ol(e.minScale,e.maxScale)})));var i=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.handles.has(jl)&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",(function(t){return e.scaleUpdateHandler(t)})),jl),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",(function(){return e._setDirty()})),jl)):!r&&this.handles.has(jl)&&this.handles.remove(jl),i}},{key:"running",get:function(){return!(!this.layerView.view.basemapTerrain||!this.updating)}},{key:"runTask",value:function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&t.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,(function(t){return e.finishUpdate(t)}))):this.finishUpdate(!0)}},{key:"finishUpdate",value:function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._set("updating",!1)}},{key:"visibleAtLayerScale",value:function(e){return!this.layerScaleEnabled||Object(gl.b)(e,this.layer.minScale||0,this.layer.maxScale||0)}},{key:"visibleAtLabelScale",value:function(e,t){return Object(gl.b)(e,t.minScale||0,t.maxScale||0)}},{key:"graphicScale",value:function(e){var t;return Object(f.k)(e.centroid)?t=e.centroid:Object(f.k)(e.graphic.geometry)&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null}},{key:"graphicVisible",value:function(e){if(!this.layerScaleEnabled)return!0;var t=this.graphicScale(e);return this.visibleAtLayerScale(t)}},{key:"updateVisibility",value:function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1}},{key:"updateGraphicLabelScaleVisibility",value:function(e){if(!this._scaleRangeActive)return!1;if(!e.labelGraphics||0===e.labelGraphics.length)return!1;var t=this.graphicScale(e),r=this.updateLabelScaleVisibility(e,t);return r&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),r}},{key:"updateLabelScaleVisibility",value:function(e,t){if(!e.labelGraphics||0===e.labelGraphics.length)return!1;var r=e.labelGraphics[0]._labelClass;if(r&&null!=r.minScale&&null!=r.maxScale){var i=this.visibleAtLabelScale(t,r);if(e.setVisibilityFlag(1,i,1))return!0}return!1}},{key:"scaleUpdateHandler",value:function(e){var t=this;if(this._setDirty(),!this.layerView.suspended){var r=e.extent,i=e.scale,n=this.visibleAtLayerScale(i),a=!1;this.queryGraphicUIDsInExtent(r,e.spatialReference,(function(e){var o=t.graphicsCore.getGraphics3DGraphicById(e);if(!Object(f.j)(o)){var s=o.centroid;Object(f.k)(s)&&(r[0]>s.x||r[1]>s.y||r[2]<s.x||r[3]<s.y)||(o.setVisibilityFlag(1,n,0)&&(a=!0),t.updateLabelScaleVisibility(o,i)&&(a=!0))}})),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}}},{key:"layerMinMaxScaleChangeHandler",value:function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(1)})):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}}]),r}(O.a);function Ol(e,t){return e>0||t>0}Object(h.a)([Object(v.b)({constructOnly:!0})],yl.prototype,"layerScaleEnabled",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],yl.prototype,"suspended",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],yl.prototype,"updating",void 0),yl=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],yl);var jl="terrain-events",xl=yl,_l=r(264),Sl=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this,e)).graphicsCore=null,i.elevationAlignment=new fl,i.watchUpdatingTracking=new _l.a,i.handles=new j.a,i.suspendResumeExtent=null,i}return Object(s.a)(r,[{key:"normalizeCtorArgs",value:function(e){var t=null;e.scaleVisibilityEnabled&&(delete(e=Object(te.a)({},e)).scaleVisibilityEnabled,t=new xl);var r=new al({owner:e.owner,layer:e.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0});return Object(te.a)(Object(te.a)({},e),{},{graphicsCore:r,scaleVisibility:t})}},{key:"initialize",value:function(){var e=this,t=this.scaleVisibility;Object(f.k)(t)&&"minScale"in this.layer&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return t.layerMinMaxScaleChangeHandler()})),"elevationInfo"in this.layer&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,r){Object(ae.a)(t,r)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())}))}},{key:"setup",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r,i=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e,t,r){return i.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.elevationAlignment.setup(this.owner,t,this.graphicsCore,this.view.elevationProvider),Object(f.k)(this.scaleVisibility)&&"minScale"in this.layer&&(r=this.owner.view.basemapTerrain,this.scaleVisibility.setup(this.owner,this.layer,t,this.graphicsCore,r)),this._set("objectStates",new ml(this.graphicsCore)),e.prev=3,e.next=6,this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates});case 6:e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(3),!Object(ne.m)(e.t0)){e.next=12;break}return e.abrupt("return");case 12:throw e.t0;case 13:this.destroyed||(this.handles.add(this.view.watch("clippingArea",(function(){return i.updateClippingExtent()}),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics());case 14:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this.handles=Object(f.e)(this.handles),this.watchUpdatingTracking.destroy(),this._set("elevationAlignment",Object(f.e)(this.elevationAlignment)),this._set("scaleVisibility",Object(f.e)(this.scaleVisibility)),this._set("objectStates",Object(f.e)(this.objectStates)),this._set("graphicsCore",Object(f.e)(this.graphicsCore))}},{key:"suspended",get:function(){return!(!Object(f.k)(this.scaleVisibility)||!this.scaleVisibility.suspended)}},{key:"updating",get:function(){var e,t;return!!(null!=(e=this.graphicsCore)&&e.updating||Object(f.k)(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(t=this.watchUpdatingTracking)&&t.updating)}},{key:"getGraphicFromGraphicUid",value:function(e){if(this.owner.loadedGraphics){var t=this.owner.loadedGraphics.find((function(t){return t.uid===e}));if(t){var r=this.layer instanceof oe.a?this.layer:null;return Object(se.c)(t,r)}}}},{key:"whenGraphicBounds",value:function(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}},{key:"computeAttachmentOrigin",value:function(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}},{key:"getSymbolLayerSize",value:function(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}},{key:"maskOccludee",value:function(e){var t=this.objectStates.acquireSet(1,null),r=t.set,i=t.handle;return this.objectStates.setUid(r,e.uid),i}},{key:"highlight",value:function(e){if(e instanceof ce.a)return wl;if("number"==typeof e)return this.highlight([e]);if(e instanceof re.a)return this.highlight([e]);if(e instanceof ie.a&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof re.a){var t=e.map((function(e){return e.uid})),r=this.objectStates.acquireSet(0,null),i=r.set,n=r.handle;return this.objectStates.setUids(i,t),n}if("number"==typeof e[0]){var a=e,o=this.objectStates.acquireSet(0,null),s=o.set,c=o.handle;return this.objectStates.setObjectIds(s,a),c}}return wl}},{key:"updateClippingExtent",value:function(){var e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}},{key:"updateSuspendResumeExtent",value:function(){Object(f.j)(this.scaleVisibility)||(this.suspendResumeExtent=Object($e.e)(this.graphicsCore.computedExtent,this.suspendResumeExtent,le.a,this.graphicsCore.extentPadding),this.scaleVisibility.setExtent(this.suspendResumeExtent))}},{key:"setupSuspendResumeExtent",value:function(){var e=this;Object(f.j)(this.scaleVisibility)||(Object(p.a)(this.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent()}),!0),this.graphicsCore.watch("extentPadding",(function(t){return e.updateSuspendResumeExtent()})))}}]),r}(O.a);Object(h.a)([Object(v.b)({constructOnly:!0})],Sl.prototype,"owner",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Sl.prototype,"layer",void 0),Object(h.a)([Object(v.b)({readOnly:!0,aliasOf:"owner.view"})],Sl.prototype,"view",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Sl.prototype,"graphicsCore",void 0),Object(h.a)([Object(v.b)({constructOnly:!0})],Sl.prototype,"scaleVisibility",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Sl.prototype,"elevationAlignment",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Sl.prototype,"objectStates",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Sl.prototype,"watchUpdatingTracking",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Sl.prototype,"suspended",null),Object(h.a)([Object(v.b)({readOnly:!0})],Sl.prototype,"updating",null),Sl=Object(h.a)([Object(g.a)("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],Sl);var wl={remove:function(){},pause:function(){},resume:function(){}},Cl=Sl,kl=r(55),Pl=r(979);var El=r(577),Tl=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).type="graphics-3d",e.frustumVisibility=new ee,e.slicePlaneEnabled=!1,e.drapeSourceType=1,e.suspendResumeExtent=null,e.fullExtentInLocalViewSpatialReference=null,e}return Object(s.a)(r,[{key:"initialize",value:function(){var e=this;this._set("graphics3d",new Cl({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(function(){return e.graphics3d.graphicsCore.opacityChange()})),this.handles.add(this.layer.on("graphic-update",(function(t){return e.graphics3d.graphicsCore.graphicUpdateHandler(t)}))),this.addResolvingPromise(function(e){var t=e.view.spatialReference,r=e.layer.fullExtent,i=r&&r.spatialReference;if(!i)return Promise.resolve(null);if(i.equals(t))return Promise.resolve(r.clone());var n=Object(kl.d)(r,t);return Object(f.k)(n)?Promise.resolve(n):e.view.state.isLocal?Object(Pl.projectGeometry)(r,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):Promise.resolve(null)}(this).then((function(t){return e.fullExtentInLocalViewSpatialReference=t}))),this.layer.internal?this.notifyChange("updating"):this.handles.add(Object(p.l)(this.view,"basemapTerrain.ready",(function(){return e.notifyChange("updating")})))}},{key:"destroy",value:function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))}},{key:"legendEnabled",get:function(){return this.canResume()&&!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var e,t={};return Object(f.k)(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(t.outsideScaleRange=!0),t.outsideOfView=!(null==(e=this.frustumVisibility)||!e.suspended),t}},{key:"fetchPopupFeatures",value:function(){var e=Object(a.a)(n.a.mark((function e(t,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(f.k)(r)?r.clientGraphics:null);case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"notifyGraphicGeometryChanged",value:function(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}},{key:"notifyGraphicVisibilityChanged",value:function(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"getGraphicFromGraphicUid",value:function(e){return this.graphics3d.getGraphicFromGraphicUid(e)}},{key:"whenGraphicBounds",value:function(e,t){return this.graphics3d.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null}},{key:"getSymbolLayerSize",value:function(e,t){return this.graphics3d.getSymbolLayerSize(e,t)}},{key:"queryGraphics",value:function(){return Promise.resolve(this.loadedGraphics)}},{key:"maskOccludee",value:function(e){return this.graphics3d.maskOccludee(e)}},{key:"highlight",value:function(e){return this.graphics3d.highlight(e)}},{key:"updatePolicy",get:function(){var e;return(null==(e=this.graphics3d)?void 0:e.graphicsCore.effectiveUpdatePolicy)||1}},{key:"canResume",value:function(){var e;return Object(c.a)(Object(l.a)(r.prototype),"canResume",this).call(this)&&!(null!=(e=this.graphics3d)&&e.suspended)}},{key:"isUpdating",value:function(){var e,t;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(e=this.view)&&null!=(t=e.basemapTerrain)&&t.ready))}},{key:"setupSuspendResumeExtent",value:function(){var e=this,t=function(){e.suspendResumeExtent=Object($e.e)(e.graphics3d.graphicsCore.computedExtent,e.suspendResumeExtent,1.2,e.graphics3d.graphicsCore.extentPadding),e.frustumVisibility.setExtent(e.suspendResumeExtent)};Object(p.a)(this.graphics3d.graphicsCore,"computedExtent",(function(){return t()}),!0),Object(p.d)(this.graphics3d.graphicsCore,"extentPadding",(function(){return t()}),!0)}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}}]),r}(function(e){var t=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).slicePlaneEnabled=!1,e.supportsHeightUnitConversion=!1,e}return Object(s.a)(r,[{key:"postscript",value:function(e){Object(c.a)(Object(l.a)(r.prototype),"postscript",this).call(this,e),Object(y.b)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}},{key:"_validateHeightModelInfo",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(p.g)(this.view.defaultsFromMap,"isHeightModelInfoSearching"),this.handles.add(t),e.next=4,t;case 4:if(!(r=Object(y.c)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))){e.next=7;break}throw r;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(e);return Object(h.a)([Object(v.b)()],t.prototype,"view",void 0),Object(h.a)([Object(v.b)()],t.prototype,"slicePlaneEnabled",void 0),t=Object(h.a)([Object(g.a)("esri.views.3d.layers.LayerView3D")],t)}(El.a));Object(h.a)([Object(v.b)({aliasOf:"layer.graphics"})],Tl.prototype,"loadedGraphics",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"suspended",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"legendEnabled",null),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"updating",void 0),Object(h.a)([Object(v.b)()],Tl.prototype,"layer",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"frustumVisibility",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"graphics3d",void 0),Object(h.a)([Object(v.b)({type:Boolean})],Tl.prototype,"slicePlaneEnabled",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],Tl.prototype,"suspendInfo",null);var Al=Tl=Object(h.a)([Object(g.a)("esri.views.3d.layers.GraphicsLayerView3D")],Tl)},566:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return _})),r.d(t,"f",(function(){return S})),r.d(t,"g",(function(){return w}));var i=r(23),n=r(7),a=r(73);var o=function(e,t,r){return[t,r]},s=function(e,t,r){return[t,r,e[2]]},c=function(e,t,r){return[t,r,e[2],e[3]]};function l(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function u(e,t){var r=e.scale,i=e.translate;return Math.round((t-i[0])/r[0])}function d(e,t){var r=e.scale,i=e.translate;return Math.round((i[1]-t)/r[1])}function h(e,t,r){for(var i,n,a,o,s=[],c=0;c<r.length;c++){var l=r[c];c>0?(a=u(e,l[0]),o=d(e,l[1]),a===i&&o===n||(s.push(t(l,a-i,o-n)),i=a,n=o)):(i=u(e,l[0]),n=d(e,l[1]),s.push(t(l,i,n)))}return s.length>0?s:null}function f(e,t){var r=e.scale,i=e.translate;return t*r[0]+i[0]}function p(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function v(e,t,r){var n=new Array(r.length);if(!r.length)return n;var a=Object(i.a)(e.scale,2),o=a[0],s=a[1],c=f(e,r[0][0]),l=p(e,r[0][1]);n[0]=t(r[0],c,l);for(var u=1;u<r.length;u++){var d=r[u];c+=d[0]*o,l-=d[1]*s,n[u]=t(d,c,l)}return n}function b(e,t,r){for(var i=new Array(r.length),n=0;n<r.length;n++)i[n]=v(e,t,r[n]);return i}function m(e,t,r,i,n){return t.points=function(e,t,r,i){return h(e,r?i?c:s:i?s:o,t)}(e,r.points,i,n),t}function g(e,t,r,i,n){return t.x=u(e,r.x),t.y=d(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function y(e,t,r,i,n){var a=function(e,t,r,i){for(var n=[],a=r?i?c:s:i?s:o,l=0;l<t.length;l++){var u=h(e,a,t[l]);u&&u.length>=3&&n.push(u)}return n.length?n:null}(e,r.rings,i,n);return a?(t.rings=a,t):null}function O(e,t,r,i,n){var a=function(e,t,r,i){for(var n=[],a=r?i?c:s:i?s:o,l=0;l<t.length;l++){var u=h(e,a,t[l]);u&&u.length>=2&&n.push(u)}return n.length?n:null}(e,r.paths,i,n);return a?(t.paths=a,t):null}function j(e,t){return e&&t?Object(a.f)(t)?g(e,{},t,!1,!1):Object(a.h)(t)?O(e,{},t,!1,!1):Object(a.g)(t)?y(e,{},t,!1,!1):Object(a.e)(t)?m(e,{},t,!1,!1):Object(a.d)(t)?function(e,t,r,i,n){return t.xmin=u(e,r.xmin),t.ymin=d(e,r.ymin),t.xmax=u(e,r.xmax),t.ymax=d(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}(e,{},t,!1,!1):null:null}function x(e,t,r,i,a){return Object(n.k)(r)&&(t.points=function(e,t,r,i){return v(e,r?i?c:s:i?s:o,t)}(e,r.points,i,a)),t}function _(e,t,r,i,a){return Object(n.j)(r)||(t.x=f(e,r.x),t.y=p(e,r.y),t!==r&&(i&&(t.z=r.z),a&&(t.m=r.m))),t}function S(e,t,r,i,a){return Object(n.k)(r)&&(t.rings=function(e,t,r,i){return b(e,r?i?c:s:i?s:o,t)}(e,r.rings,i,a)),t}function w(e,t,r,i,a){return Object(n.k)(r)&&(t.paths=function(e,t,r,i){return b(e,r?i?c:s:i?s:o,t)}(e,r.paths,i,a)),t}},577:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var i=r(2),n=r(3),a=r(5),o=r(6),s=r(0),c=r(29),l=r(67),u=r(63),d=r(211),h=r(11),f=r(7),p=r(178),v=r(1),b=(r(12),r(15),r(8)),m=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).layer=null,n.parent=null,n}return Object(n.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";throw h.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){return Object(f.t)(this.get("layer.opacity"),1)*Object(f.t)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(u.b)(Object(d.a)(Object(p.b)(l.a.EventedMixin(c.a)))));Object(s.a)([Object(v.b)()],m.prototype,"fullOpacity",null),Object(s.a)([Object(v.b)()],m.prototype,"layer",void 0),Object(s.a)([Object(v.b)()],m.prototype,"parent",void 0),Object(s.a)([Object(v.b)({readOnly:!0})],m.prototype,"suspended",null),Object(s.a)([Object(v.b)({readOnly:!0})],m.prototype,"suspendInfo",null),Object(s.a)([Object(v.b)({readOnly:!0})],m.prototype,"legendEnabled",null),Object(s.a)([Object(v.b)({type:Boolean,readOnly:!0})],m.prototype,"updating",null),Object(s.a)([Object(v.b)({readOnly:!0})],m.prototype,"updatingProgress",null),Object(s.a)([Object(v.b)()],m.prototype,"visible",null);var g=m=Object(s.a)([Object(b.a)("esri.views.layers.LayerView")],m)},582:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(13),n=r(7);function a(e,t){return e?t?4:3:t?3:2}function o(e,t,r,o,l){if(Object(n.j)(t)||!t.lengths.length)return null;var u="upperLeft"===(null==l?void 0:l.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var d,h=e.coords,f=[],p=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],v=t.lengths,b=t.coords,m=a(r,o),g=0,y=Object(i.a)(v);try{for(y.s();!(d=y.n()).done;){var O=d.value,j=s(p,b,g,O,r,o,u);j&&f.push(j),g+=O*m}}catch(S){y.e(S)}finally{y.f()}if(f.sort((function(e,t){var i=u*e[2]-u*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),f.length){var x=6*f[0][2];h[0]=f[0][0]/x,h[1]=f[0][1]/x,r&&(x=6*f[0][4],h[2]=0!==x?f[0][3]/x:0),(h[0]<p[0]||h[0]>p[1]||h[1]<p[2]||h[1]>p[3]||r&&(h[2]<p[4]||h[2]>p[5]))&&(h.length=0)}if(!h.length){var _=t.lengths[0]?c(b,0,v[0],r,o):null;if(!_)return null;h[0]=_[0],h[1]=_[1],r&&_.length>2&&(h[2]=_[2])}return e}function s(e,t,r,i,n,o){for(var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=a(n,o),l=r,u=r+c,d=0,h=0,f=0,p=0,v=0,b=0,m=i-1;b<m;b++,l+=c,u+=c){var g=t[l],y=t[l+1],O=t[l+2],j=t[u],x=t[u+1],_=t[u+2],S=g*x-j*y;p+=S,d+=(g+j)*S,h+=(y+x)*S,n&&(f+=(O+_)*(S=g*_-j*O),v+=S),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),y<e[2]&&(e[2]=y),y>e[3]&&(e[3]=y),n&&(O<e[4]&&(e[4]=O),O>e[5]&&(e[5]=O))}if(p*s>0&&(p*=-1),v*s>0&&(v*=-1),!p)return null;var w=[d,h,.5*p];return n&&(w[3]=f,w[4]=.5*v),w}function c(e,t,r,i,n){for(var o=a(i,n),s=t,c=t+o,f=0,p=0,v=0,b=0,m=0,g=r-1;m<g;m++,s+=o,c+=o){var y=e[s],O=e[s+1],j=e[s+2],x=e[c],_=e[c+1],S=e[c+2],w=i?u(y,O,j,x,_,S):l(y,O,x,_);if(w)if(f+=w,i){var C=h(y,O,j,x,_,S);p+=w*C[0],v+=w*C[1],b+=w*C[2]}else{var k=d(y,O,x,_);p+=w*k[0],v+=w*k[1]}}return f>0?i?[p/f,v/f,b/f]:[p/f,v/f]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function l(e,t,r,i){var n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function u(e,t,r,i,n,a){var o=i-e,s=n-t,c=a-r;return Math.sqrt(o*o+s*s+c*c)}function d(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function h(e,t,r,i,n,a){return[e+.5*(i-e),t+.5*(n-t),r+.5*(a-r)]}},584:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(10),n=r(18),a=r(11),o=r(566);function s(e,t,r,n,o){var s=e.referencesGeometry()&&o?l(t,n,o):t,c=e.repurposeFeature(s);try{return e.evaluate(Object(i.a)(Object(i.a)({},r),{},{$feature:c}))}catch(u){return a.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",u),null}}var c=new Map;function l(e,t,r){var s=r.transform,l=r.hasZ,u=r.hasM;c.has(t)||c.set(t,function(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,i,n){return Object(o.e)(r,t,e,i,n)};case"esriGeometryPolygon":return function(e,r,i,n){return Object(o.f)(r,t,e,i,n)};case"esriGeometryPolyline":return function(e,r,i,n){return Object(o.g)(r,t,e,i,n)};case"esriGeometryMultipoint":return function(e,r,i,n){return Object(o.d)(r,t,e,i,n)};default:return a.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n.a("mapview-arcade","Unable to handle geometryType: ".concat(e))),function(e){return e}}}(t));var d=c.get(t)(e.geometry,s,l,u);return Object(i.a)(Object(i.a)({},e),{},{geometry:d})}},597:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return A})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return C})),r.d(t,"l",(function(){return k})),r.d(t,"m",(function(){return w})),r.d(t,"n",(function(){return E})),r.d(t,"o",(function(){return P})),r.d(t,"p",(function(){return x})),r.d(t,"q",(function(){return I})),r.d(t,"r",(function(){return R})),r.d(t,"s",(function(){return j})),r.d(t,"t",(function(){return D})),r.d(t,"u",(function(){return l}));var i=r(65),n=r(7),a=r(58),o=r(79),s=(r(678),r(570));function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L;return[e[0],e[1],e[2],e[3]]}function l(e,t,r,i){return d(e,t,r,i,s.e.get())}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();return d(e[0],e[1],e[2],e[3],t)}function d(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c();return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function h(e,t,r){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function f(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c(),n=r[0]-t[0],a=r[1]-t[1],o=r[2]-t[2],s=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],d=a*u-o*l,h=o*s-n*u,f=n*l-a*s,p=d*d+h*h+f*f,v=Math.abs(p-1)>1e-5&&p>1e-12?1/Math.sqrt(p):1;i[0]=d*v,i[1]=h*v,i[2]=f*v,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2])}function p(e,t,r,i,n){if(e.count<3)return!1;e.getVec(r,b);for(var o=i,s=!1;o<e.count-1&&!s;)e.getVec(o,m),o++,s=!Object(a.o)(b,m);if(!s)return!1;for(o=Math.max(o,n),s=!1;o<e.count&&!s;)e.getVec(o,g),o++,Object(a.j)(y,b,m),Object(a.r)(y,y),Object(a.j)(O,m,g),Object(a.r)(O,O),s=!Object(a.o)(b,g)&&!Object(a.o)(m,g)&&Math.abs(Object(a.h)(y,O))<v;return s?(f(b,m,g,t),!0):(0!==r||1!==i||2!==n)&&p(e,t,0,1,2)}var v=.99619469809,b=Object(o.e)(),m=Object(o.e)(),g=Object(o.e)(),y=Object(o.e)(),O=Object(o.e)();function j(e,t,r){return e!==r&&u(e,r),r[3]=-Object(a.h)(r,t),r}function x(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function _(e,t,r,i){return Object(a.g)(g,t,e),h(r,g,i)}function S(e,t,r,i){return M(e,t,Object(a.j)(s.d.get(),r,t),z,i)}function w(e,t,r){return!!Object(n.k)(t)&&M(e,t.origin,t.direction,F,r)}function C(e,t,r){return M(e,t.origin,t.vector,0,r)}function k(e,t,r){return M(e,t.origin,t.vector,1,r)}function P(e,t){return D(e,t)>=0}function E(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5];return e[0]*(e[0]>0?r:a)+e[1]*(e[1]>0?i:o)+e[2]*(e[2]>0?n:s)+e[3]>=0}function T(e,t){var r=Object(a.h)(e,t.ray.direction),i=-D(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;var n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function A(e,t){var r=Object(a.h)(e,t.ray.direction),i=-D(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;var n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function R(e,t,r){var i=Object(a.e)(s.d.get(),e,-e[3]),n=function(e,t,r){var i=Object(a.e)(s.d.get(),e,Object(a.h)(e,t));return Object(a.j)(r,t,i),r}(e,Object(a.j)(s.d.get(),t,i),s.d.get());return Object(a.f)(r,n,i),r}function D(e,t){return Object(a.h)(e,t)+e[3]}function M(e,t,r,n,o){var s=Object(a.h)(e,r);if(0===s)return!1;var c=-(Object(a.h)(e,t)+e[3])/s;return 1&n&&(c=Object(i.d)(c,0,1)),!(!(4&n)&&c<0||!(8&n)&&c>1)&&(Object(a.f)(o,t,Object(a.e)(o,r,c)),!0)}function I(e){return e}var L=[0,0,1,0],z=12,F=8},612:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return h}));var i=r(13),n=r(2),a=(r(712),r(12),r(7)),o=(r(162),r(236),r(39),r(304)),s=r(139),c=(r(566),r(197),r(214),r(670),function e(t,r,i){Object(n.a)(this,e),this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null});function l(e){return Object(a.k)(e.geometry)}var u=function e(){Object(n.a)(this,e),this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null};function d(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function h(e){if(Object(a.j)(e))return 0;switch(e.type){case"point":return 1;case"polyline":var t,r=0,n=Object(i.a)(e.paths);try{for(n.s();!(t=n.n()).done;){r+=t.value.length}}catch(u){n.e(u)}finally{n.f()}return r;case"polygon":var o,s=0,c=Object(i.a)(e.rings);try{for(c.s();!(o=c.n()).done;){s+=o.value.length}}catch(u){c.e(u)}finally{c.f()}return s;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var l=e.vertexAttributes&&e.vertexAttributes.position;return l?l.length/3:0;default:return}}function f(e,t){switch(Object(o.h)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)Object(o.l)(t,e.paths[r],e.hasZ);break;case"polygon":for(var i=0;i<e.rings.length;i++)Object(o.l)(t,e.rings[i],e.hasZ);break;case"multipoint":Object(o.l)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function p(e,t){switch(Object(s.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)Object(s.p)(t,e.paths[r]);break;case"polygon":for(var i=0;i<e.rings.length;i++)Object(s.p)(t,e.rings[i]);break;case"multipoint":Object(s.p)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function v(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(o.f)(),Object(s.l)()},617:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n,a,o={exports:{}};i=o,n=function(){function e(e,r,n){n=n||2;var a,o,s,l,u,d,h,f=r&&r.length,p=f?r[0]*n:e.length,v=t(e,0,p,n,!0),b=[];if(!v||v.next===v.prev)return b;if(f&&(v=c(e,r,v,n)),e.length>80*n){a=s=e[0],o=l=e[1];for(var m=n;m<p;m+=n)(u=e[m])<a&&(a=u),(d=e[m+1])<o&&(o=d),u>s&&(s=u),d>l&&(l=d);h=0!==(h=Math.max(s-a,l-o))?1/h:0}return i(v,b,n,a,o,h),b}function t(e,t,r,i,n){var a,o;if(n===P(e,t,r,i)>0)for(a=t;a<r;a+=i)o=w(a,e[a],e[a+1],o);else for(a=r-i;a>=t;a-=i)o=w(a,e[a],e[a+1],o);if(o&&y(o,o.next)){var s=o.next;C(o),o=s}return o}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!y(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(C(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,c,l,u,d,h){if(e){!h&&d&&f(e,l,u,d);for(var p,v,b=e;e.prev!==e.next;)if(p=e.prev,v=e.next,d?a(e,l,u,d):n(e))t.push(p.i/c),t.push(e.i/c),t.push(v.i/c),C(e),e=v.next,b=v.next;else if((e=v)===b){h?1===h?i(e=o(r(e),t,c),t,c,l,u,d,2):2===h&&s(e,t,c,l,u,d):i(r(e),t,c,l,u,d,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(g(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(b(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&g(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,r,i){var n=e.prev,a=e,o=e.next;if(g(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,c=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,l=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,u=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,d=p(s,c,t,r,i),h=p(l,u,t,r,i),f=e.prevZ,v=e.nextZ;f&&f.z>=d&&v&&v.z<=h;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&b(n.x,n.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&b(n.x,n.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,i){var n=e;do{var a=n.prev,o=n.next.next;!y(a,o)&&O(a,n,n.next,o)&&_(a,o)&&_(o,a)&&(t.push(a.i/i),t.push(n.i/i),t.push(o.i/i),C(n),C(n.next),n=e=o),n=n.next}while(n!==e);return r(n)}function s(e,t,n,a,o,s){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&m(c,l)){var u=S(c,l);return c=r(c,c.next),u=r(u,u.next),i(c,t,n,a,o,s),void i(u,t,n,a,o,s)}l=l.next}c=c.next}while(c!==e)}function c(e,i,n,a){var o,s,c,u=[];for(o=0,s=i.length;o<s;o++)(c=t(e,i[o]*a,o<s-1?i[o+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(v(c));for(u.sort(l),o=0;o<u.length;o++)n=r(n=d(u[o],n),n.next);return n}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function d(e,t){var i=function(e,t){var r,i=t,n=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;var c,l=r,u=r.x,d=r.y,f=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&b(a<d?n:o,a,u,d,a<d?o:n,a,i.x,i.y)&&(c=Math.abs(a-i.y)/(n-i.x),_(i,e)&&(c<f||c===f&&(i.x>r.x||i.x===r.x&&h(r,i)))&&(r=i,f=c)),i=i.next}while(i!==l);return r}(e,t);if(!i)return t;var n=S(i,e),a=r(i,i.next),o=u(n);return r(o,o.next),a=u(a),u(t===i?a:t)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function f(e,t,r,i){var n=e;do{if(null===n.z&&(n.z=p(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,f(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,a,o,s,c,l=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,i=r,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0!==s&&(0===c||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,l*=2}while(o>1)}(n)}function p(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function b(e,t,r,i,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&O(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(_(e,t)&&_(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function O(e,t,r,i){var n=x(g(e,t,r)),a=x(g(e,t,i)),o=x(g(r,i,e)),s=x(g(r,i,t));return n!==a&&o!==s||!(0!==n||!j(e,r,t))||!(0!==a||!j(e,i,t))||!(0!==o||!j(r,e,i))||!(0!==s||!j(r,t,i))}function j(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function x(e){return e>0?1:e<0?-1:0}function _(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function S(e,t){var r=new k(e.i,e.x,e.y),i=new k(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function w(e,t,r,i){var n=new k(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,r,i){for(var n=0,a=t,o=r-i;a<r;a+=i)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,o=Math.abs(P(e,0,a,r));if(n)for(var s=0,c=t.length;s<c;s++){var l=t[s]*r,u=s<c-1?t[s+1]*r:e.length;o-=Math.abs(P(e,l,u,r))}var d=0;for(s=0;s<i.length;s+=3){var h=i[s]*r,f=i[s+1]*r,p=i[s+2]*r;d+=Math.abs((e[h]-e[p])*(e[f+1]-e[h+1])-(e[h]-e[f])*(e[p+1]-e[h+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[n][a][o]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e},void 0!==(a=n())&&(i.exports=a);var s=o.exports},626:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return g}));var i,n,a=r(215),o=r(7),s=r(100),c=r(547),l=r(79),u=r(384),d=r(820),h=r(627),f=r(765);function p(e,t,r,i,n,a,o,s,c,l,d){var h,f,p=O[d.mode],v=0;if(Object(u.l)(e,t,r,i,c.spatialReference,n,s))return p.requiresAlignment(d)?(v=p.applyElevationAlignmentBuffer(i,n,a,o,s,c,l,d),h=a,f=o):(h=i,f=n),Object(u.l)(h,c.spatialReference,f,a,l.spatialReference,o,s)?v:void 0}function v(e,t,r,i,n){var s=(Object(d.a)(e)?e.z:Object(f.c)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":var c=Object(o.t)(Object(f.b)(t,e,"ground"),0);return n&&(n.verticalDistanceToGround=0,n.sampledElevation=c),c;case"relative-to-ground":var l=Object(o.t)(Object(f.b)(t,e,"ground"),0),u=r.geometryZWithOffset(s,i);return n&&(n.verticalDistanceToGround=u,n.sampledElevation=l),u+l;case"relative-to-scene":var h=Object(o.t)(Object(f.b)(t,e,"scene"),0),p=r.geometryZWithOffset(s,i);return n&&(n.verticalDistanceToGround=p,n.sampledElevation=h),p+h;case"absolute-height":var v=r.geometryZWithOffset(s,i);if(n){var b=Object(o.t)(Object(f.b)(t,e,"ground"),0);n.verticalDistanceToGround=v-b,n.sampledElevation=b}return v;default:return Object(a.a)(r.mode),0}}function b(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function g(e){return"absolute-height"!==e}function y(e,t,r,i,n){var a=v(t,r,n,i,x);Object(h.i)(e,x.verticalDistanceToGround);var o=x.sampledElevation,c=Object(s.f)(j,e.transformation);return _[0]=t.x,_[1]=t.y,_[2]=a,Object(u.c)(t.spatialReference,_,c,i.spatialReference)?e.transformation=c:console.warn("Could not locate symbol object properly, it might be misplaced"),o}(n=i||(i={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";var O={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,a,o,s){var c=s.calculateOffsetRenderUnits(o),l=s.featureExpressionInfoContext;t*=3,i*=3;for(var u=0;u<n;++u){var d=e[t+0],h=e[t+1],f=e[t+2];r[i+0]=d,r[i+1]=h,r[i+2]=null==l?f+c:c,t+=3,i+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,a){var s=0,c=a.spatialReference;t*=3,i*=3;for(var l=0;l<n;++l){var u=e[t+0],d=e[t+1],h=e[t+2],f=Object(o.t)(a.getElevation(u,d,h,c,"ground"),0);s+=f,r[i+0]=u,r[i+1]=d,r[i+2]=f,t+=3,i+=3}return s/n},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,a,s,c){var l=0,u=c.calculateOffsetRenderUnits(s),d=c.featureExpressionInfoContext,h=a.spatialReference;t*=3,i*=3;for(var f=0;f<n;++f){var p=e[t+0],v=e[t+1],b=e[t+2],m=Object(o.t)(a.getElevation(p,v,b,h,"ground"),0);l+=m,r[i+0]=p,r[i+1]=v,r[i+2]=null==d?b+m+u:m+u,t+=3,i+=3}return l/n},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,a,s,c){var l=0,u=c.calculateOffsetRenderUnits(s),d=c.featureExpressionInfoContext,h=a.spatialReference;t*=3,i*=3;for(var f=0;f<n;++f){var p=e[t+0],v=e[t+1],b=e[t+2],m=Object(o.t)(a.getElevation(p,v,b,h,"scene"),0);l+=m,r[i+0]=p,r[i+1]=v,r[i+2]=null==d?b+m+u:m+u,t+=3,i+=3}return l/n},requiresAlignment:function(){return!0}}},j=Object(c.d)(),x={verticalDistanceToGround:0,sampledElevation:0},_=Object(l.e)()},627:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return P})),r.d(t,"c",(function(){return w})),r.d(t,"d",(function(){return E})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return k})),r.d(t,"g",(function(){return S})),r.d(t,"h",(function(){return T})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return C}));var i=r(13),n=r(65),a=r(7),o=r(100),s=r(547),c=r(60),l=r(79),u=r(407),d=r(558),h=r(384),f=r(304),p=r(139),v=r(411),b=r(177),m=r(612),g=r(726);function y(e,t){if("point"===e.type)return j(e,t,!1);if(Object(g.d)(e))switch(e.type){case"extent":return j(e.center,t,!1);case"polygon":return j(e.centroid,t,!1);case"polyline":return j(O(e),t,!0);case"mesh":return j(e.origin,t,!1)}else switch(e.type){case"extent":return j(function(e){var t=Object(n.h)(e.zmin);return Object(m.g)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return j(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=Object(v.b)(e.rings,e.hasZ);return Object(m.g)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return j(O(e),t,!0)}}function O(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=Object(b.f)(t,Object(b.e)(t)/2);return Object(m.g)(r[0],r[1],r[2],e.spatialReference)}function j(e,t,r){var i=r?e:Object(g.a)(e);return t&&e?Object(h.n)(e,i,t)?i:null:i}function x(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=Object(p.l)());var n=e,a=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?a+=o/20:n.height<1e-7*n.width&&(o+=a/20),Object(u.l)(t,n.xmin-a-i,n.ymin-o-i,n.xmax+a+i,n.ymax+o+i),t}return null}function _(e,t){for(var r=0;r<e.geometries.length;++r){var i=e.geometries[r].getMutableAttribute("auxpos1");i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(r))}}function S(e,t){var r=Object(d.f)(d.a);return Object(a.k)(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),Object(a.k)(t)?r[3]=t:Object(a.k)(e)&&e.length>3&&(r[3]=e[3]),r}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=new Array(3);if(Object(a.j)(t)||Object(a.j)(r))n[0]=1,n[1]=1,n[2]=1;else{for(var o,s=0,c=2;c>=0;c--){var u=e[c],d=void 0,h=null!=u,f=0===c&&!o&&!h,p=r[c];"symbol-value"===u||f?d=0!==p?t[c]/p:1:h&&"proportional"!==u&&isFinite(u)&&(d=0!==p?u/p:1),null!=d&&(n[c]=d,o=d,s=Math.max(s,Math.abs(d)))}for(var v=2;v>=0;v--)null==n[v]?n[v]=o:0===n[v]&&(n[v]=.001*s)}for(var b=2;b>=0;b--)n[b]/=i;return Object(l.f)(n)}function C(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),k(e)?null:"Symbol sizes may not be negative values"}function k(e){if(Array.isArray(e)){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){if(!k(t.value))return!1}}catch(n){r.e(n)}finally{r.f()}return!0}return null==e||e>=0}function P(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Object(s.d)(),n=e||0,a=t||0,c=r||0;return 0!==n&&Object(o.r)(i,i,-n/180*Math.PI),0!==a&&Object(o.d)(i,i,a/180*Math.PI),0!==c&&Object(o.k)(i,i,c/180*Math.PI),i}function E(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(f.s)(e)?t.minDemResolutionForPoints:.01*Object(f.t)(e)}var T={"bottom-left":Object(c.e)(0,0),bottom:Object(c.e)(.5,0),"bottom-right":Object(c.e)(1,0),left:Object(c.e)(0,.5),center:Object(c.e)(.5,.5),right:Object(c.e)(1,.5),"top-left":Object(c.e)(0,1),top:Object(c.e)(.5,1),"top-right":Object(c.e)(1,1)}},646:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i,n,a=r(58),o=r(713),s=r(79),c=r(597),l=r(579);(n=i||(i={})).length=function(e,t){var r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},n.normalize=function(e,t){var r=e[t],i=e[t+1],n=e[t+2],a=1/Math.sqrt(r*r+i*i+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a},n.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},n.add=function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[a]=e[t]+r[i],n[a+1]=e[t+1]+r[i+1],n[a+2]=e[t+2]+r[i+2]},n.subtract=function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[a]=e[t]-r[i],n[a+1]=e[t+1]-r[i+1],n[a+2]=e[t+2]-r[i+2]};var u,d,h,f,p=r(662),v=r(661),b=r(567),m=i;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36),s=0;s<6;s++)for(var c=0;c<6;c++)o[6*s+c]=s;for(var l=new Uint16Array(36),u=0;u<6;u++)l[6*u+0]=0,l[6*u+1]=1,l[6*u+2]=2,l[6*u+3]=2,l[6*u+4]=3,l[6*u+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(24),s=0;s<8;s++)t[3*s]=r[s][0]*e[0],t[3*s+1]=r[s][1]*e[1],t[3*s+2]=r[s][2]*e[2];return new p.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}],["uv0",{size:2,data:n}]],[["position",a],["normal",o],["uv0",l]])}}(u||(u={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(18),o=0;o<6;o++)t[3*o]=r[o][0]*e[0],t[3*o+1]=r[o][1]*e[1],t[3*o+2]=r[o][2]*e[2];return new p.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}]],[["position",n],["normal",a]])}}(d||(d={})),function(e){var t=.5,r=Object(o.c)(-t,0,-t),i=Object(o.c)(t,0,-t),n=Object(o.c)(0,0,t),s=Object(o.c)(0,.5,0),c=Object(o.b)(),l=Object(o.b)(),u=Object(o.b)(),d=Object(o.b)(),h=Object(o.b)();Object(a.j)(c,r,s),Object(a.j)(l,r,i),Object(a.g)(u,c,l),Object(a.r)(u,u),Object(a.j)(c,i,s),Object(a.j)(l,i,n),Object(a.g)(d,c,l),Object(a.r)(d,d),Object(a.j)(c,n,s),Object(a.j)(l,n,r),Object(a.g)(h,c,l),Object(a.r)(h,h);var f=[r,i,n,s],v=[0,-1,0,u[0],u[1],u[2],d[0],d[1],d[2],h[0],h[1],h[2]],b=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(12),r=0;r<4;r++)t[3*r]=f[r][0]*e[0],t[3*r+1]=f[r][1]*e[1],t[3*r+2]=f[r][2]*e[2];return new p.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:v}]],[["position",new Uint16Array(b)],["normal",new Uint16Array(m)]])}}(h||(h={})),function(e){e.createBoxGeometry=u.createGeometry,e.createDiamondGeometry=d.createGeometry,e.createTetrahedronGeometry=h.createGeometry,e.createSphereGeometry=function(e,t,r){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{uv:!0},n=-Math.PI,a=2*Math.PI,o=-Math.PI/2,s=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(r)),u=(c+1)*(l+1),d=new Float32Array(3*u),h=new Float32Array(3*u),f=new Float32Array(2*u),v=[],b=0,m=0;m<=l;m++){for(var g=[],y=m/l,O=o+y*s,j=Math.cos(O),x=0;x<=c;x++){var _=x/c,S=n+_*a,w=Math.cos(S)*j,C=Math.sin(O),k=-Math.sin(S)*j;d[3*b]=w*e,d[3*b+1]=C*e,d[3*b+2]=k*e,h[3*b]=w,h[3*b+1]=C,h[3*b+2]=k,f[2*b]=_,f[2*b+1]=y,g.push(b),++b}v.push(g)}var P=new Uint32Array(2*c*(l-1)*3);b=0;for(var E=0;E<l;E++)for(var T=0;T<c;T++){var A=v[E][T],R=v[E][T+1],D=v[E+1][T+1],M=v[E+1][T];0===E?(P[b++]=A,P[b++]=D,P[b++]=M):E===l-1?(P[b++]=A,P[b++]=R,P[b++]=D):(P[b++]=A,P[b++]=R,P[b++]=D,P[b++]=D,P[b++]=M,P[b++]=A)}var I=[["position",P],["normal",P]],L=[["position",{size:3,data:d,exclusive:!0}],["normal",{size:3,data:h,exclusive:!0}]];return i.uv&&(L.push(["uv0",{size:2,data:f,exclusive:!0}]),I.push(["uv0",P])),i.offset&&(I[0][0]="offset",L[0][0]="offset",I.push(["position",new Uint32Array(P.length)]),L.push(["position",{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new p.a(L,I)},e.createPolySphereGeometry=function(e,t,r){var i,n,a=e;if(r)i=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;i=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],n=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var s=0;s<i.length;s+=3)m.scale(i,s,e/m.length(i,s));var c={};function l(t,r){var n;t>r&&(t=(n=[r,t])[0],r=n[1]);var a=t.toString()+"."+r.toString();if(c[a])return c[a];var o=i.length;return i.length+=3,m.add(i,3*t,i,3*r,i,o),m.scale(i,o,e/m.length(i,o)),o/=3,c[a]=o,o}for(var u=0;u<t;u++){for(var d=n.length,h=new Uint32Array(4*d),f=0;f<d;f+=3){var v=n[f],b=n[f+1],g=n[f+2],y=l(v,b),O=l(b,g),j=l(g,v),x=4*f;h[x]=v,h[x+1]=y,h[x+2]=j,h[x+3]=b,h[x+4]=O,h[x+5]=y,h[x+6]=g,h[x+7]=j,h[x+8]=O,h[x+9]=y,h[x+10]=O,h[x+11]=j}n=h,c={}}for(var _=new Float32Array(i),S=0;S<_.length;S+=3)m.normalize(_,S);var w=[["position",n],["normal",n]],C=[["position",{size:3,data:new Float32Array(i),exclusive:!0}],["normal",{size:3,data:_,exclusive:!0}]];return new p.a(C,w)},e.createPointGeometry=function(e,t,r,i,n,a,o){var s=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];var l=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],u=null!=i&&2===i.length?i:[1,1],d=[["position",{size:3,data:s,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:l,exclusive:!0}],["size",{size:2,data:u}]];if(null!=n){var h=new Float32Array([n[0],n[1],n[2],n[3]]);d.push(["auxpos1",{size:4,data:h}])}if(null!=o){var f=new Float32Array([o[0],o[1],o[2],o[3]]);d.push(["auxpos2",{size:4,data:f}])}return new p.a(d,null,1)},e.updatePointGeometry=function(e,t,r,i,n,a,o,s){if(null!=e){var c=s.getMutableAttribute("normal").data;c[0]=e[0],c[1]=e[1],c[2]=e[2]}if(null!=t){var l=s.getMutableAttribute("position").data;l[0]=t[0],l[1]=t[1],l[2]=t[2]}if(null!=r){var u=s.getMutableAttribute("color").data;u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3]}if(null!=i){var d=s.getMutableAttribute("size").data;d[0]=i[0],d[1]=i[1]}if(null!=n){var h=s.getMutableAttribute("auxpos1").data;h[0]=n[0],h[1]=n[1],h[2]=n[2],h[3]=n[3]}if(null!=a){var f=s.getMutableAttribute("uv0").data;f[0]=a[0],f[1]=a[1]}if(null!=o){var p=s.getMutableAttribute("auxpos2").data;p[0]=o[0],p[1]=o[1],p[2]=o[2],p[3]=o[3]}},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)r[3*o]=e[o][0],r[3*o+1]=e[o][1],r[3*o+2]=e[o][2],t&&(i[3*o]=t[o][0],i[3*o+1]=t[o][1],i[3*o+2]=t[o][2]),n[o]=o,a[o]=0;return t||(i[0]=0,i[1]=1,i[2]=0),new p.a([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:a],["uv0",a]],1)},e.createTriangleGeometry=function(){var e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),r=new Uint16Array([0,0,0]);return new p.a([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",r]])};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function r(e,t,r,i,n){return!(Math.abs(Object(a.h)(t,e))>n)&&(Object(a.g)(r,e,t),Object(a.r)(r,r),Object(a.g)(i,r,e),Object(a.r)(i,i),!0)}function i(e,t,i,n,a,o,s){return r(e,t,a,o,s)||r(e,i,a,o,s)||r(e,n,a,o,s)}e.createSquareGeometry=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=new Array(12),i=0;i<4;i++)for(var n=0;n<3;n++)r[3*i+n]=e[i][n];var a=new Uint32Array([0,1,2,2,3,0]),o=[0,0,1],s=new Uint32Array([0,0,0,0,0,0]);return new p.a([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:o,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",a],["normal",s],["uv0",a],["color",s]])},e.createConeGeometry=function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=0,c=t,l=e,u=Object(o.c)(0,s,0),d=Object(o.c)(0,s+l,0),h=Object(o.c)(0,-1,0),f=Object(o.c)(0,1,0);i&&(s=l,d=Object(o.c)(0,0,0),u=Object(o.c)(0,s,0),h=Object(o.c)(0,1,0),f=Object(o.c)(0,-1,0));var v=[d,u],b=[h,f],m=r+2,g=Math.sqrt(l*l+c*c);if(i)for(var y=r-1;y>=0;y--){var O=y*(2*Math.PI/r),j=Object(o.c)(Math.cos(O)*c,s,Math.sin(O)*c);v.push(j);var x=Object(o.c)(l*Math.cos(O)/g,-c/g,l*Math.sin(O)/g);b.push(x)}else for(var _=0;_<r;_++){var S=_*(2*Math.PI/r),w=Object(o.c)(Math.cos(S)*c,s,Math.sin(S)*c);v.push(w);var C=Object(o.c)(l*Math.cos(S)/g,c/g,l*Math.sin(S)/g);b.push(C)}var k=new Uint32Array(2*(r+2)*3),P=new Uint32Array(2*(r+2)*3),E=0,T=0;if(n){for(var A=3;A<v.length;A++)k[E++]=1,k[E++]=A-1,k[E++]=A,P[T++]=0,P[T++]=0,P[T++]=0;k[E++]=v.length-1,k[E++]=2,k[E++]=1,P[T++]=0,P[T++]=0,P[T++]=0}if(a){for(var R=3;R<v.length;R++)k[E++]=R,k[E++]=R-1,k[E++]=0,P[T++]=R,P[T++]=R-1,P[T++]=1;k[E++]=0,k[E++]=2,k[E++]=v.length-1,P[T++]=1,P[T++]=2,P[T++]=b.length-1}for(var D=new Float32Array(3*m),M=0;M<m;M++)D[3*M]=v[M][0],D[3*M+1]=v[M][1],D[3*M+2]=v[M][2];for(var I=new Float32Array(3*m),L=0;L<m;L++)I[3*L]=b[L][0],I[3*L+1]=b[L][1],I[3*L+2]=b[L][2];return new p.a([["position",{size:3,data:D,exclusive:!0}],["normal",{size:3,data:I,exclusive:!0}]],[["position",k],["normal",P]])},e.createCylinderGeometry=function(e,t,r,i,n,s){var c=i?Object(o.a)(i):Object(o.c)(1,0,0),l=n?Object(o.a)(n):Object(o.c)(0,0,0);s=null==s||s;var u=Object(o.b)();Object(a.r)(u,c);var d=Object(o.b)();Object(a.e)(d,u,Math.abs(e));var h=Object(o.b)();Object(a.e)(h,d,-.5),Object(a.f)(h,h,l);var f=Object(o.c)(0,1,0);Math.abs(1-Object(a.h)(u,f))<.2&&Object(a.w)(f,0,0,1);var v=Object(o.b)();Object(a.g)(v,u,f),Object(a.r)(v,v),Object(a.g)(f,v,u);var b=2*r+(s?2:0),m=r+(s?2:0),g=new Float32Array(3*b),y=new Float32Array(3*m),O=new Float32Array(2*b),j=new Uint32Array(3*r*(s?4:2)),x=new Uint32Array(3*r*(s?4:2));s&&(g[3*(b-2)+0]=h[0],g[3*(b-2)+1]=h[1],g[3*(b-2)+2]=h[2],O[2*(b-2)]=0,O[2*(b-2)+1]=0,g[3*(b-1)+0]=g[3*(b-2)+0]+d[0],g[3*(b-1)+1]=g[3*(b-2)+1]+d[1],g[3*(b-1)+2]=g[3*(b-2)+2]+d[2],O[2*(b-1)]=1,O[2*(b-1)+1]=1,y[3*(m-2)+0]=-u[0],y[3*(m-2)+1]=-u[1],y[3*(m-2)+2]=-u[2],y[3*(m-1)+0]=u[0],y[3*(m-1)+1]=u[1],y[3*(m-1)+2]=u[2]);for(var _=function(e,t,r){j[e]=t,x[e]=r},S=0,w=Object(o.b)(),C=Object(o.b)(),k=0;k<r;k++){var P=k*(2*Math.PI/r);Object(a.e)(w,f,Math.sin(P)),Object(a.e)(C,v,Math.cos(P)),Object(a.f)(w,w,C),y[3*k+0]=w[0],y[3*k+1]=w[1],y[3*k+2]=w[2],Object(a.e)(w,w,t),Object(a.f)(w,w,h),g[3*k+0]=w[0],g[3*k+1]=w[1],g[3*k+2]=w[2],O[2*k+0]=k/r,O[2*k+1]=0,g[3*(k+r)+0]=g[3*k+0]+d[0],g[3*(k+r)+1]=g[3*k+1]+d[1],g[3*(k+r)+2]=g[3*k+2]+d[2],O[2*(k+r)+0]=k/r,O[2*k+1]=1;var E=(k+1)%r;_(S++,k,k),_(S++,k+r,k),_(S++,E,E),_(S++,E,E),_(S++,k+r,k),_(S++,E+r,E)}if(s){for(var T=0;T<r;T++){var A=(T+1)%r;_(S++,b-2,m-2),_(S++,T,m-2),_(S++,A,m-2)}for(var R=0;R<r;R++){var D=(R+1)%r;_(S++,R+r,m-1),_(S++,b-1,m-1),_(S++,D+r,m-1)}}return new p.a([["position",{size:3,data:g,exclusive:!0}],["normal",{size:3,data:y,exclusive:!0}],["uv0",{size:2,data:O,exclusive:!0}]],[["position",j],["normal",x],["uv0",j]])},e.createTubeGeometry=function(t,r,i,n,a){i=i||10,n=null==n||n,Object(b.a)(t.length>1);for(var o=[],s=[],c=0;c<i;c++){o.push([0,-c-1,-(c+1)%i-1]);var l=c/i*2*Math.PI;s.push([Math.cos(l)*r,Math.sin(l)*r])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,n,a)},e.createPathExtrusionGeometry=function(e,t,r,n,u){var d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Object(o.c)(0,0,0),h=e.length,f=new Float32Array(t.length*h*3+(6*r.length||0)),v=new Float32Array(t.length*h*3+(r?6:0)),b=(t.length-1)*h*6+3*n.length*2,m=new Uint32Array(b),y=new Uint32Array(b),O=0,j=0,x=0,_=0,S=Object(o.b)(),w=Object(o.b)(),C=Object(o.b)(),k=Object(o.b)(),P=Object(o.b)(),E=Object(o.b)(),T=Object(o.b)(),A=Object(s.e)(),R=Object(o.b)(),D=Object(o.b)(),M=Object(o.b)(),I=Object(o.b)(),L=Object(o.b)(),z=Object(c.d)();Object(a.w)(R,0,1,0),Object(a.j)(w,t[1],t[0]),Object(a.r)(w,w),u?(Object(a.f)(A,t[0],d),Object(a.r)(C,A)):Object(a.w)(C,0,0,1),i(w,C,R,R,P,C,g),Object(a.k)(k,C),Object(a.k)(I,P);for(var F=0;F<r.length;F++)Object(a.e)(E,P,r[F][0]),Object(a.e)(A,C,r[F][2]),Object(a.f)(E,E,A),Object(a.f)(E,E,t[0]),f[O++]=E[0],f[O++]=E[1],f[O++]=E[2];v[j++]=-w[0],v[j++]=-w[1],v[j++]=-w[2];for(var V=0;V<n.length;V++)m[x++]=n[V][0]>0?n[V][0]:-n[V][0]-1+r.length,m[x++]=n[V][1]>0?n[V][1]:-n[V][1]-1+r.length,m[x++]=n[V][2]>0?n[V][2]:-n[V][2]-1+r.length,y[_++]=0,y[_++]=0,y[_++]=0;for(var G=r.length,U=r.length-1,B=0;B<t.length;B++){var N=!1;B>0&&(Object(a.k)(S,w),B<t.length-1?(Object(a.j)(w,t[B+1],t[B]),Object(a.r)(w,w)):N=!0,Object(a.f)(D,S,w),Object(a.r)(D,D),Object(a.f)(M,t[B-1],k),Object(c.g)(t[B],D,z),Object(c.m)(z,Object(l.g)(M,S),A)?(Object(a.j)(A,A,t[B]),Object(a.r)(C,A),Object(a.g)(P,D,C),Object(a.r)(P,P)):i(D,k,I,R,P,C,g),Object(a.k)(k,C),Object(a.k)(I,P)),u&&(Object(a.f)(A,t[B],d),Object(a.r)(L,A));for(var H=0;H<h;H++)if(Object(a.e)(E,P,e[H][0]),Object(a.e)(A,C,e[H][1]),Object(a.f)(E,E,A),Object(a.r)(T,E),v[j++]=T[0],v[j++]=T[1],v[j++]=T[2],Object(a.f)(E,E,t[B]),f[O++]=E[0],f[O++]=E[1],f[O++]=E[2],!N){var q=(H+1)%h;m[x++]=G+H,m[x++]=G+h+H,m[x++]=G+q,m[x++]=G+q,m[x++]=G+h+H,m[x++]=G+h+q;for(var W=0;W<6;W++)y[_++]=m[x-6+W]-U}G+=h}for(var Y=t[t.length-1],Z=0;Z<r.length;Z++)Object(a.e)(E,P,r[Z][0]),Object(a.e)(A,C,r[Z][1]),Object(a.f)(E,E,A),Object(a.f)(E,E,Y),f[O++]=E[0],f[O++]=E[1],f[O++]=E[2];var X=j/3;v[j++]=w[0],v[j++]=w[1],v[j++]=w[2];for(var Q=G-h,J=0;J<n.length;J++)m[x++]=n[J][0]>=0?G+n[J][0]:-n[J][0]-1+Q,m[x++]=n[J][2]>=0?G+n[J][2]:-n[J][2]-1+Q,m[x++]=n[J][1]>=0?G+n[J][1]:-n[J][1]-1+Q,y[_++]=X,y[_++]=X,y[_++]=X;return new p.a([["position",{size:3,data:f,exclusive:!0}],["normal",{size:3,data:v,exclusive:!0}]],[["position",m],["normal",y]])},e.createPolylineGeometry=function(e,t,r){Object(b.a)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(b.a)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(b.a)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(b.a)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var i=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1)),a=0,o=0,s=0;s<e.length;s++){for(var c=0;c<3;c++)i[a++]=e[s][c];s>0&&(n[o++]=s-1,n[o++]=s)}var l=[],u=[];if(l.push(["position",n]),u.push(["position",{size:3,data:i,exclusive:!0}]),t){for(var d=new Float32Array(3*t.length),h=0,f=0;f<e.length;f++)for(var m=0;m<3;m++)d[h++]=t[f][m];l.push(["normal",n]),u.push(["normal",{size:3,data:d,exclusive:!0}])}return r&&(u.push(["color",{size:4,data:r}]),l.push(["color",Object(v.d)(r.length/4)])),new p.a(u,l,2)},e.createExtrudedTriangle=function(e,t,r,i){for(var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new Array(18),o=[[-t,n,i/2],[r,n,i/2],[0,e+n,i/2],[-t,n,-i/2],[r,n,-i/2],[0,e+n,-i/2]],s=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),c=0;c<6;c++)a[3*c]=o[c][0],a[3*c+1]=o[c][1],a[3*c+2]=o[c][2];return new p.a([["position",{size:3,data:a,exclusive:!0}]],[["position",s]])},e.transformInPlace=function(e,t){for(var r=e.getMutableAttribute("position").data,i=0;i<r.length;i+=3){var n=r[i],o=r[i+1],s=r[i+2];Object(a.w)(y,n,o,s),Object(a.q)(y,y,t),r[i]=y[0],r[i+1]=y[1],r[i+2]=y[2]}},e.cgToGIS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=e.vertexAttributes,i=r.get("position").data,n=r.get("normal").data;if(n)for(var a=t.getMutableAttribute("normal").data,o=0;o<n.length;o+=3){var s=n[o+1];a[o+1]=-n[o+2],a[o+2]=s}if(i)for(var c=t.getMutableAttribute("position").data,l=0;l<i.length;l+=3){var u=i[l+1];c[l+1]=-i[l+2],c[l+2]=u}return t},e.makeOrthoBasisDirUp=r,e.makeOrthoBasisDirUpFallback=i}(f||(f={}));var g=.99619469809,y=Object(o.b)(),O=f},656:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(2),n=r(3),a=r(7),o=r(329),s=r(746),c=function(){function e(){Object(i.a)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object(n.a)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=Object(o.a)(e)}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=Object(s.d)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=Object(o.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(a.t)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,r){if(Object(a.j)(e))this._featureExpressionInfoContext=null;else{var i=e&&e.arcade;i&&Object(a.k)(t)&&Object(a.k)(r)?(this._featureExpressionInfoContext=Object(s.a)(e),Object(s.f)(this._featureExpressionInfoContext,Object(s.c)(i.modules,t,r))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var r=new e;return Object(a.k)(t)&&r.setFromElevationInfo(t),r}}]),e}()},665:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r(13),n=r(2),a=r(3),o=r(5),s=r(6),c=r(7),l=r(100),u=r(547),d=r(58),h=r(79),f=r(678),p=r(417),v=r(745),b=r(115),m=r(236),g=function(){function e(){Object(n.a)(this,e),this._disposed=!1}return Object(a.a)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}},{key:"acquire",value:function(e,t,r,i,n,a){this.id=Object(m.a)(),this.geometry=e,this.material=t,this.transformation=r,this.instanceParameters=i,this.origin=n,this._shaderTransformation=a,this._disposed=!1}},{key:"release",value:function(){this._disposed=!1}},{key:"dispose",value:function(){this._disposed=!0}},{key:"getStaticTransformation",value:function(){return this.transformation}},{key:"getShaderTransformation",value:function(){return Object(c.k)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}},{key:"computeAttachmentOrigin",value:function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(d.q)(e,e,this.getStaticTransformation()),!0)}}]),e}();g.pool=new b.a(g);var y=r(790),O=r(567),j=r(654),x=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,r),(e=t.call(this)).type=1,e._geometryRecords=new Array,e._geometries=new Array,e._objectTransformation=Object(u.d)(),e._bvObjectSpace=new S,e._bvWorldSpace=new S,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==i.castShadow||i.castShadow,e.metadata=i.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new _),e.transformation=Object(u.d)();var a=i.geometries,o=i.materials,s=i.transformations,c=i.origins;if(Array.isArray(a)){Object(O.a)(o.length===a.length,"Object3D: materials don't match geometries"),Object(O.a)(s.length===a.length,"Object3D: transformations don't match geometries"),e._geometryRecords.length=a.length,e._geometries.length=a.length;for(var l=0;l<a.length;l++)e._geometries[l]=a[l],e._geometryRecords[l]=g.pool.acquire(a[l],o[l],Object(u.c)(s[l]),{highlights:null,occludees:null,visible:!0},c&&c[l])}return e}return Object(a.a)(r,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(e){Object(l.f)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometryRecords.length=0,this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){Object(O.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"getNumGeometryRecords",value:function(){return this._geometryRecords.length}},{key:"getGeometryRecord",value:function(e){return Object(O.a)(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]}},{key:"addGeometry",value:function(e,t,r,i,n,a){r=r||u.a,this._geometries.push(e);var o=g.pool.acquire(e,t,r,i||{highlights:null,occludees:null,visible:!0},n,a);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(c.k)(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}},{key:"removeGeometry",value:function(e){var t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(c.k)(t.shaderTransformation)?this._geometryRecords.some((function(e){return Object(c.k)(e.shaderTransformation)})):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}},{key:"removeAllGeometries",value:function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[e]}),this._invalidateBoundingVolume()}},{key:"isVisible",get:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e;var t,r=Object(i.a)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){t.value.instanceParameters.visible=this._visible}}catch(n){r.e(n)}finally{r.f()}this._emit("visibilityChanged",this)}},{key:"maskOccludee",value:function(){var e,t=new y.a(1),r=Object(i.a)(this._geometryRecords);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.instanceParameters.occludees=Object(j.b)(n.instanceParameters.occludees,t)}}catch(a){r.e(a)}finally{r.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,r=Object(i.a)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.instanceParameters.occludees=Object(j.g)(n.instanceParameters.occludees,e)}}catch(a){r.e(a)}finally{r.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new y.a(0),r=Object(i.a)(this._geometryRecords);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.instanceParameters.highlights=Object(j.b)(n.instanceParameters.highlights,t)}}catch(a){r.e(a)}finally{r.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,r=Object(i.a)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.instanceParameters.highlights=Object(j.g)(n.instanceParameters.highlights,e)}}catch(a){r.e(a)}finally{r.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return Object(l.n)(Object(c.t)(t,Object(u.d)()),this.transformation,e.getStaticTransformation())}},{key:"getCombinedShaderTransformation",value:function(e,t){return t=t||Object(u.d)(),Object(l.n)(t,this.transformation,e.getShaderTransformation()),t}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],r=this._geometryRecords[e],i=t.boundingInfo;Object(c.k)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(r)))}Object(d.i)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(d.i)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);for(var n=Object(h.e)(),a=Object(h.e)(),o=Object(p.c)(this.transformation),s=0;s<this._geometryRecords.length;++s){var l=this._geometries[s].boundingInfo;if(!Object(c.j)(l)){var u=this._geometryRecords[s].getShaderTransformation(),f=Object(p.c)(u);Object(d.q)(n,l.getCenter(),u);var v=Object(d.m)(n,this._bvObjectSpace.bounds),b=l.getBSRadius()*f;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],v+b),Object(d.q)(a,n,this.transformation);var m=Object(d.m)(a,this._bvWorldSpace.bounds),g=b*o;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],m+g)}}this._bvDirty=!1}}},{key:"_calculateTransformedBoundingVolume",value:function(e,t,r){var i=e.getBBMin(),n=e.getBBMax(),a=Object(h.c)(i),o=Object(h.c)(n);Object(d.q)(a,a,r),Object(d.q)(o,o,r);for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],o[s]),t.max[s]=Math.max(t.max[s],a[s],o[s]);for(var c=0;c<3;++c){Object(d.k)(a,i),Object(d.k)(o,n),a[c]=n[c],o[c]=i[c],Object(d.q)(a,a,r),Object(d.q)(o,o,r);for(var l=0;l<3;++l)t.min[l]=Math.min(t.min[l],a[l],o[l]),t.max[l]=Math.max(t.max[l],a[l],o[l])}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,Object(c.k)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){Object(c.k)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),r}(v.a),_=function(){function e(){Object(n.a)(this,e),this.min=Object(h.g)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(h.g)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return Object(a.a)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),S=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).bounds=Object(f.b)(),e}return Object(a.a)(r,[{key:"init",value:function(){Object(d.w)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(d.w)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(f.a)(this.bounds)}}]),r}(_)},667:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(5),n=r(6),a=r(13),o=r(2),s=r(3),c=r(102),l=r(7),u=r(212),d=r(418),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,r=arguments.length>1?arguments[1]:void 0;Object(o.a)(this,e),this.compareMinX=b,this.compareMinY=m,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),r&&("function"==typeof r?this.toBBox=r:this._initFormat(r)),this.clear()}return Object(s.a)(e,[{key:"destroy",value:function(){this.clear(),w.prune(),C.prune(),k.prune(),P.prune()}},{key:"all",value:function(e){this._all(this.data,e)}},{key:"search",value:function(e,t){var r=this.data,i=this.toBBox;if(_(e,r))for(w.clear();r;){for(var n=0,a=r.children.length;n<a;n++){var o=r.children[n],s=r.leaf?i(o):o;_(e,s)&&(r.leaf?t(o):x(e,s)?this._all(o,t):w.push(o))}r=w.pop()}}},{key:"collides",value:function(e){var t=this.data,r=this.toBBox;if(!_(e,t))return!1;for(w.clear();t;){for(var i=0,n=t.children.length;i<n;i++){var a=t.children[i],o=t.leaf?r(a):a;if(_(e,o)){if(t.leaf||x(e,o))return!0;w.push(a)}}t=w.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=new T([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,r=this.data,i=null,n=0,a=!1,o=this.toBBox(e);for(k.clear(),P.clear();r||k.length>0;){var s;if(r||(r=Object(l.d)(k.pop()),i=k.data[k.length-1],n=null!=(s=P.pop())?s:0,a=!0),r.leaf&&-1!==(t=Object(c.e)(r.children,e,r.children.length,r.indexHint)))return r.children.splice(t,1),k.push(r),this._condense(k),this;a||r.leaf||!x(r,o)?i?(n++,r=i.children[n],a=!1):r=null:(k.push(r),P.push(n),n=0,i=r,r=r.children[0])}return this}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){var r=e;for(C.clear();r;){var i;if(!0===r.leaf){var n,o=Object(a.a)(r.children);try{for(o.s();!(n=o.n()).done;){t(n.value)}}catch(s){o.e(s)}finally{o.f()}}else C.pushArray(r.children);r=null!=(i=C.pop())?i:null}}},{key:"_build",value:function(e,t,r,i){var n=r-t+1,a=this._maxEntries;if(n<=a){var o=new T(e.slice(t,r+1));return f(o,this.toBBox),o}i||(i=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,i-1)));var s=new A([]);s.height=i;var c=Math.ceil(n/a),l=c*Math.ceil(Math.sqrt(a));S(e,t,r,l,this.compareMinX);for(var u=t;u<=r;u+=l){var d=Math.min(u+l-1,r);S(e,u,d,c,this.compareMinY);for(var h=u;h<=d;h+=c){var p=Math.min(h+c-1,d);s.children.push(this._build(e,h,p,i-1))}}return f(s,this.toBBox),s}},{key:"_chooseSubtree",value:function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){for(var n=void 0,a=1/0,o=1/0,s=0,c=t.children.length;s<c;s++){var l=t.children[s],u=g(l),d=O(e,l)-u;d<o?(o=d,a=u<a?u:a,n=l):d===o&&u<a&&(a=u,n=l)}t=n||t.children[0]}return t}},{key:"_insert",value:function(e,t,r){var i=this.toBBox,n=r?e:i(e);k.clear();var a=this._chooseSubtree(n,this.data,t,k);for(a.children.push(e),v(a,n);t>=0&&k.data[t].children.length>this._maxEntries;)this._split(k,t),t--;this._adjustParentBBoxes(n,k,t)}},{key:"_split",value:function(e,t){var r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i);if(a){var o=r.children.splice(a,r.children.length-a),s=r.leaf?new T(o):new A(o);s.height=r.height,f(r,this.toBBox),f(s,this.toBBox),t?e.data[t-1].children.push(s):this._splitRoot(r,s)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}},{key:"_splitRoot",value:function(e,t){this.data=new A([e,t]),this.data.height=e.height+1,f(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,r){var i,n,a;i=n=1/0;for(var o=t;o<=r-t;o++){var s=p(e,0,o,this.toBBox),c=p(e,o,r,this.toBBox),l=j(s,c),u=g(s)+g(c);l<i?(i=l,a=o,n=u<n?u:n):l===i&&u<n&&(n=u,a=o)}return a}},{key:"_chooseSplitAxis",value:function(e,t,r){var i=e.leaf?this.compareMinX:b,n=e.leaf?this.compareMinY:m;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}},{key:"_allDistMargin",value:function(e,t,r,i){e.children.sort(i);for(var n=this.toBBox,a=p(e,0,t,n),o=p(e,r-t,r,n),s=y(a)+y(o),c=t;c<r-t;c++){var l=e.children[c];v(a,e.leaf?n(l):l),s+=y(a)}for(var u=r-t-1;u>=t;u--){var d=e.children[u];v(o,e.leaf?n(d):d),s+=y(o)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,r){for(var i=r;i>=0;i--)v(t.data[i],e)}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var r=e.data[t];if(0===r.children.length)if(t>0){var i=e.data[t-1],n=i.children;n.splice(Object(c.e)(n,r,n.length,i.indexHint),1)}else this.clear();else f(r,this.toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function f(e,t){p(e,0,e.children.length,t,e)}function p(e,t,r,i,n){n||(n=new T([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,o=t;o<r;o++)a=e.children[o],v(n,e.leaf?i(a):a);return n}function v(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function b(e,t){return e.minX-t.minX}function m(e,t){return e.minY-t.minY}function g(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function O(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function j(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,a-i)}function x(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function S(e,t,r,i,n){for(var a=[t,r];a.length;){var o=Object(l.d)(a.pop()),s=Object(l.d)(a.pop());if(!(o-s<=i)){var c=s+Math.ceil((o-s)/i/2)*i;Object(d.a)(e,c,s,o,n),a.push(s,c,c,o)}}}var w=new u.a,C=new u.a,k=new u.a,P=new u.a({deallocator:void 0}),E=function(e){Object(i.a)(r,e);var t=Object(n.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).height=1,e.indexHint=new c.a,e}return r}((function e(){Object(o.a)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0})),T=function(e){Object(i.a)(r,e);var t=Object(n.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this)).children=e,i.leaf=!0,i}return r}(E),A=function(e){Object(i.a)(r,e);var t=Object(n.a)(r);function r(e){var i;return Object(o.a)(this,r),(i=t.call(this)).children=e,i.leaf=!1,i}return r}(E)},669:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return n}));var i=r(739);function n(e,t,r){if(e.count===t.count)for(var n=e.count,a=r[0],o=r[1],s=r[2],c=r[4],l=r[5],u=r[6],d=r[8],h=r[9],f=r[10],p=r[12],v=r[13],b=r[14],m=e.typedBuffer,g=e.typedBufferStride,y=t.typedBuffer,O=t.typedBufferStride,j=0;j<n;j++){var x=j*g,_=j*O,S=y[_],w=y[_+1],C=y[_+2];m[x]=a*S+c*w+d*C+p,m[x+1]=o*S+l*w+h*C+v,m[x+2]=s*S+u*w+f*C+b}else i.a.error("source and destination buffers need to have the same number of elements")}function a(e,t,r){if(e.count===t.count)for(var n=e.count,a=r[0],o=r[1],s=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],f=r[8],p=e.typedBuffer,v=e.typedBufferStride,b=t.typedBuffer,m=t.typedBufferStride,g=0;g<n;g++){var y=g*v,O=g*m,j=b[O],x=b[O+1],_=b[O+2];p[y]=a*j+c*x+d*_,p[y+1]=o*j+l*x+h*_,p[y+2]=s*j+u*x+f*_}else i.a.error("source and destination buffers need to have the same number of elements")}function o(e,t,r){for(var i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,s=t.typedBufferStride,c=0;c<i;c++){var l=c*a,u=c*s;n[l]=r*o[u],n[l+1]=r*o[u+1],n[l+2]=r*o[u+2]}}function s(e,t){for(var r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=0;s<r;s++){var c=s*n,l=s*o,u=a[l],d=a[l+1],h=a[l+2],f=Math.sqrt(u*u+d*d+h*h);if(f>0){var p=1/f;i[c]=p*u,i[c+1]=p*d,i[c+2]=p*h}}}function c(e,t,r){for(var i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,s=t.typedBufferStride,c=0;c<i;c++){var l=c*a,u=c*s;n[l]=o[u]>>r,n[l+1]=o[u+1]>>r,n[l+2]=o[u+2]>>r}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:a,scale:o,normalize:s,shiftRight:c})},670:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(12),r(7);function i(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function n(e,t){return e===t||e&&t&&e.equals(t)}},680:function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return D}));var i,n,a=r(2),o=r(3),s=r(14),c=r(5),l=r(6),u=r(0),d=r(29),h=r(11),f=r(7),p=r(387),v=r(212),b=r(21),m=r(142),g=r(25),y=r(1),O=(r(12),r(15),r(8)),j=r(756),x=r(762),_=h.a.getLogger("esri.views.support.Scheduler");(n=i||(i={})).RESOURCE_CONTROLLER="schedule",n.SLIDE="slide",n.STREAM_DATA_LOADER="stream loader",n.ELEVATION_QUERY="elevation query",n.TERRAIN_SURFACE="terrain",n.SURFACE_GEOMETRY_UPDATES="surface geometry updates",n.GRAPHICS_CORE="Graphics3D",n.I3S_CONTROLLER="I3S",n.POINT_CLOUD_LAYER="point cloud",n.FEATURE_TILE_FETCHER="feature fetcher",n.OVERLAY="overlay",n.STAGE="stage",n.GRAPHICS_DECONFLICTOR="graphics deconflictor",n.FILTER_VISIBILITY="Graphics3D filter visibility",n.SCALE_VISIBILITY="Graphics3D scale visibility",n.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",n.POINT_OF_INTEREST_FREQUENT="POI frequent",n.POINT_OF_INTEREST_INFREQUENT="POI infrequent",n.LABELER="labeler",n.FEATURE_QUERY_ENGINE="feature query",n.FEATURE_TILE_TREE="feature tile tree",n.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",n.ELEVATION_ALIGNMENT="elevation alignment",n.TEXT_TEXTURE_ATLAS="text texture atlas",n.TEXTURE_UNLOAD="texture unload",n.LINE_OF_SIGHT_TOOL="line of sight tool",n.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",n.ELEVATION_PROFILE="elevation profile",n.SNAPPING="snapping",n.SHADOW_ACCUMULATOR="shadow accumulator",n[n.TEST_PRIO=1]="TEST_PRIO";var S=new Map([[i.RESOURCE_CONTROLLER,0],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function w(e){return S.has(e)?S.get(e):"number"==typeof e?e:1}var C,k,P=Object(m.a)(6.5),E=Object(m.a)(1),T=Object(m.a)(30),A=Object(m.a)(1e3/30),R=Object(m.a)(100);!function(e){var t=function(e){Object(c.a)(u,e);var t=Object(l.a)(u);function u(e){var r,o;Object(a.a)(this,u),(r=t.call(this,e)).updating=!0,r.performanceInfo={total:new p.a("total"),tasks:new Map},r._frameTaskTimes=new Map,r._budget=null,r._state=1,r._tasks=new v.a,r._runQueue=new v.a,r._load=0,r._idleStateCallbacks=new v.a,r._idleUpdatesStartFired=!1,r._maxReschedule=L,r._forceTask=!1,r._debug=!1,r._debugHandle=Object(g.a)(x.a,"SCHEDULER_LOG_SLOW_TASKS",(function(e){return r._debug=e})),r._budget=new n(e.nowFunc);for(var c=0,l=Object.keys(i);c<l.length;c++){var d=l[c];r.performanceInfo.tasks.set(i[d],new p.a(i[d]))}var h=Object(s.a)(r);return r._test={get state(){return Object(f.j)(o)?h._state:o},set state(e){o=e},FRAME_SAFETY_BUDGET:P,INTERACTING_BUDGET:A,IDLE_BUDGET:R,get budget(){return h._budget.budget},usedBudget:0,updateTask:function(e){return r._updateTask(e)},getState:function(e){return r._getState(e)},getRuntime:function(e){return r._getRuntime(e)},resetRuntimes:function(){return r._resetRuntimes()},getRunning:function(){return r._getRunning()}},r}return Object(o.a)(u,[{key:"destroy",value:function(){this._debugHandle&&this._debugHandle.remove()}},{key:"registerTask",value:function(e,t){var i=w(e),n=new r(this,e,t,i);return this._tasks.push(n),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new p.a(e)),n}},{key:"registerIdleStateCallbacks",value:function(e,t){var r=this,i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),2===this.state&&this._idleUpdatesStartFired&&i.idleBegin();var n=this;return{remove:function(){return r._removeIdleStateCallbacks(i)},set idleBegin(e){n._idleUpdatesStartFired&&(i.idleEnd(),2===n._state&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}},{key:"now",get:function(){return this.nowFunc()}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return Object(f.j)(this._test.state)?this._state:this._test.state},set:function(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((function(e){return e.idleEnd()}))))}},{key:"updateBudget",value:function(e){this._test.usedBudget=0;var t=P,r=e.frameDuration,i=E;switch(this.state){case 2:t=Object(m.a)(0),r=Object(m.a)(Math.max(R,e.frameDuration)),i=T;break;case 1:r=Object(m.a)(Math.max(A,e.frameDuration))}return r=Object(m.a)(r-e.elapsedFrameTime-t),2!==this.state&&r<E&&!this._forceTask?(this._forceTask=!0,!1):(r=Object(m.a)(Math.max(r,i)),this._budget.reset(r,this.state),this._maxReschedule=L,this._updateLoad(),this._schedule())}},{key:"frame",value:function(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((function(e){return e.idleBegin()}))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}},{key:"stopFrame",value:function(){this._budget.reset(Object(m.a)(0),this._state),this._budget.madeProgress()}},{key:"_removeIdleStateCallbacks",value:function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}},{key:"removeTask",value:function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}},{key:"_updateTask",value:function(e){this._tasks.forAll((function(t){t.name===e&&t.setPriority(e)}))}},{key:"_getState",value:function(e){if(this._runQueue.some((function(t){return t.name===e})))return k.SCHEDULED;var t=k.IDLE;return this._tasks.forAll((function(r){r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=k.READY:t!==k.READY&&(t=k.WAITING))})),t}},{key:"_getRuntime",value:function(e){var t=0;return this._tasks.forAll((function(r){r.name===e&&(t+=r.runtime)})),t}},{key:"_resetRuntimes",value:function(){this._tasks.forAll((function(e){return e.runtime=0}))}},{key:"_getRunning",value:function(){var e=new Map;if(this._tasks.forAll((function(t){t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;var t="";return e.forEach((function(e,r){t+=e>1?" ".concat(e,"x ").concat(r):" ".concat(r)})),t}},{key:"_runIdle",value:function(){this._run()}},{key:"_runInteracting",value:function(){this._run()}},{key:"_runAnimating",value:function(){this._run()}},{key:"_updateLoad",value:function(){var e=this._tasks.reduce((function(e,t){return t.needsUpdate?++e:e}),0);this._load=.9*this._load+e*(1-.9)}},{key:"_schedule",value:function(){var e=this;if(this._maxReschedule<=0)return!1;var t=function(){var t=!1,r=0;if(e._tasks.forAll((function(i){i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&(t=!0,r=Math.max(r,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,e._runQueue.push(i)):--i.schedulePriority)})),!t)return{v:(e.updating=!1,!1)};e._maxReschedule===L&&(e._maxReschedule=r),--e._maxReschedule};for(this._runQueue.filterInPlace((function(e){return!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)})),this._tasks.forAll((function(t){0===t.basePriority&&t.needsUpdate&&!e._runQueue.some((function(e){return e===t}))&&e._runQueue.unshift(t)}));0===this._runQueue.length;){var r=t();if("object"===typeof r)return r.v}return this.updating=!0,!0}},{key:"_run",value:function(){var e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){var t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(n){_.error('Exception in task "'.concat(r.name,'"'),n)}r.schedulePriority=r.basePriority;var i=this._budget.now()-t;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",r.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}},{key:"_startFrameTaskTimes",value:function(){for(var e=0,t=Object.keys(i);e<t.length;e++){var r=t[e];this._frameTaskTimes.set(i[r],0)}}},{key:"_recordFrameTaskTimes",value:function(e){var t=this;this._frameTaskTimes.forEach((function(e,r){return t.performanceInfo.tasks.get(r).record(e)})),this.performanceInfo.total.record(e)}},{key:"test",get:function(){return this._test}}]),u}(d.a);Object(u.a)([Object(y.b)()],t.prototype,"updating",void 0),Object(u.a)([Object(y.b)()],t.prototype,"nowFunc",void 0),t=Object(u.a)([Object(O.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;var r=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(e,i,n,o){var s;return Object(a.a)(this,r),(s=t.call(this,{}))._scheduler=e,s.name=i,s._basePriority=o,s.runtime=0,s._queue=new j.a,s.updating=!1,s.schedulePriority=s._basePriority,s.task=Object(f.k)(n)?n:{running:!1,runTask:function(e){return s.processQueue(e)}},s}return Object(o.a)(r,[{key:"normalizeCtorArgs",value:function(){return{}}},{key:"remove",value:function(){this.processQueue(D),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule}},{key:"basePriority",get:function(){return this._basePriority}},{key:"setPriority",value:function(e){this.name=e;var t=w(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}},{key:"priority",get:function(){return this.name},set:function(e){this.setPriority(e)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}},{key:"schedule",value:function(e,t,r){return this.updating=!0,this._queue.push(e,t,r)}},{key:"reschedule",value:function(e,t,r){return this.updating=!0,this._queue.unshift(e,t,r)}},{key:"processQueue",value:function(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}}]),r}(d.a);Object(u.a)([Object(y.b)()],r.prototype,"updating",void 0),r=Object(u.a)([Object(O.a)("esri.views.support.SchedulerTask")],r);var n=function(){function e(t){Object(a.a)(this,e),this.now=t,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}return Object(o.a)(e,[{key:"run",value:function(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}},{key:"done",get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}},{key:"budget",get:function(){return this._budget}},{key:"madeProgress",value:function(){this._didWork=!0}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"reset",value:function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"elapsed",get:function(){return this.now()-this._begin}},{key:"resetProgress",value:function(){this._didWork=!1}},{key:"hasProgressed",get:function(){return this._didWork}}]),e}();e.Budget=n}(C||(C={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(k||(k={}));var D=function(){var e=new C.Budget((function(){return performance.now()}));return e.enabled=!1,e}(),M=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"remove",value:function(){}},{key:"processQueue",value:function(){}},{key:"schedule",value:function(e,t,r){try{if(Object(b.n)(t)){var i=Object(b.e)();return r?Promise.resolve(r(i)):Promise.reject(i)}return Object(b.x)(e())}catch(n){return Promise.reject(n)}}},{key:"reschedule",value:function(e,t,r){return this.schedule(e,t,r)}}]),e}(),I=new M,L=Number.MAX_SAFE_INTEGER},685:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(582),n=r(179),a=r(131),o={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new n.b(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=Object(i.a)(new a.a,e.geometry,t.hasZ,t.hasM)),e.centroid}}},687:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(2),n=r(5),a=r(6),o=r(0),s=r(29),c=r(1),l=(r(12),r(15),r(11),r(8)),u=function(e){Object(n.a)(r,e);var t=Object(a.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.ENABLE_PROFILE_DEPTH_RANGE=!1,e.DISABLE_FAST_UPDATES=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e.ENABLE_CONTINUOUS_LINE_PATTERNS=!1,e}return r}(s.a);Object(o.a)([Object(c.b)()],u.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(o.a)([Object(c.b)()],u.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(o.a)([Object(c.b)()],u.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(o.a)([Object(c.b)()],u.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LABELS_SHOW_BORDER",void 0),Object(o.a)([Object(c.b)()],u.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(o.a)([Object(c.b)()],u.prototype,"SHOW_POI",void 0),Object(o.a)([Object(c.b)()],u.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_FAST_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(o.a)([Object(c.b)()],u.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"ENABLE_CONTINUOUS_LINE_PATTERNS",void 0);var d=new(u=Object(o.a)([Object(l.a)("esri.views.3d.support.DebugFlags")],u))},704:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i,n,a,o=r(542),s=r(538);function c(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(Object(s.a)(i||(i=Object(o.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\n}"]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(Object(s.a)(n||(n=Object(o.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(Object(s.a)(a||(a=Object(o.a)(["void forwardTextureCoordinates() {}"]))))}},705:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n,a=r(542),o=r(538);function s(e,t){var r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add("ssaoTex","sampler2D"),r.uniforms.add("viewportPixelSz","vec4"),r.code.add(Object(o.a)(i||(i=Object(a.a)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nfloat ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\nreturn viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n}"]))))):r.code.add(Object(o.a)(n||(n=Object(a.a)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}},708:function(e,t,r){"use strict";r.d(t,"a",(function(){return q}));var i=r(10),n=r(2),a=r(3),o=r(5),s=r(6),c=r(11),l=r(65),u=r(7),d=r(35),h=r(30),f=r(58),p=r(79),v=r(663),b=r(597),m=r(647),g=r(661),y=r(681),O=r(625),j=r(567),x=r(867),_=r(654),S=r(41),w=r(38),C=r(0),k=r(557),P=r(575),E=r(568),T=r(655),A=r(642),R=r(609),D=r(618),M=r(624),I=r(613),L=r(610),z=r(701),F=r(819),V=r(544),G=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]),U=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e,i,a){var o;return Object(n.a)(this,r),(o=t.call(this,e,i,a)).stippleTextureRepository=e.stippleTextureRepository,o}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new L.a(e.rctx,n,G)}},{key:"dispose",value:function(){Object(S.a)(Object(w.a)(r.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if(Object(A.c)(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(P.b)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(E.a)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(T.d)(this.program,e),this.stipplePattern!==e.stipplePattern){var r=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){var i=Object(u.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1},n=i.pixelSize,a=i.sdfNormalizer;if(this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.configuration.draped?(this.program.setUniform1f("stipplePatternPixelSizeInv",1/n),this.program.setUniform1f("worldToScreenRatio",1/t.screenToWorldRatio)):this.program.setUniform1f("stipplePatternPixelSizeInv",1/(n*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var o=Object(u.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",o[0],o[1],o[2],o.length>3?o[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(u.t)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}},{key:"bindDraw",value:function(e){Object(A.d)(this.program,e),Object(k.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var r=this.configuration,i=3===e,n=2===e;return Object(V.f)({blending:0===r.output||7===r.output?i?I.g:Object(I.a)(e):null,depthTest:{func:Object(I.b)(e)},depthWrite:i?!r.transparent&&r.writeDepth&&V.d:Object(I.c)(e),colorWrite:V.c,stencilWrite:r.sceneHasOcludees?z.h:null,stencilTest:r.sceneHasOcludees?t?z.d:z.c:null,polygonOffset:i||n?r.polygonOffset&&B:I.d})}},{key:"initializePipeline",value:function(){var e=this.configuration,t=e.polygonOffset&&B;return e.occluder&&(this._occluderPipelineTransparent=Object(V.f)({blending:I.g,polygonOffset:t,depthTest:z.a,depthWrite:null,colorWrite:V.c,stencilWrite:null,stencilTest:z.f}),this._occluderPipelineOpaque=Object(V.f)({blending:I.g,polygonOffset:t,depthTest:z.a,depthWrite:null,colorWrite:V.c,stencilWrite:z.g,stencilTest:z.e}),this._occluderPipelineMaskWrite=Object(V.f)({blending:null,polygonOffset:t,depthTest:z.b,depthWrite:null,colorWrite:null,stencilWrite:z.h,stencilTest:z.d})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return 5}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}]),r}(D.a);U.shader=new R.a(F.a,(function(){return r.e(211).then(r.bind(null,1106))}));var B={factor:0,units:-4},N=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).output=0,e.occluder=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.polygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.roundCaps=!1,e.roundJoins=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(M.a);Object(C.a)([Object(M.b)({count:8})],N.prototype,"output",void 0),Object(C.a)([Object(M.b)()],N.prototype,"occluder",void 0),Object(C.a)([Object(M.b)()],N.prototype,"slicePlaneEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"transparent",void 0),Object(C.a)([Object(M.b)()],N.prototype,"polygonOffset",void 0),Object(C.a)([Object(M.b)()],N.prototype,"writeDepth",void 0),Object(C.a)([Object(M.b)()],N.prototype,"draped",void 0),Object(C.a)([Object(M.b)()],N.prototype,"stippleEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"stippleOffColorEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"roundCaps",void 0),Object(C.a)([Object(M.b)()],N.prototype,"roundJoins",void 0),Object(C.a)([Object(M.b)()],N.prototype,"vvSize",void 0),Object(C.a)([Object(M.b)()],N.prototype,"vvColor",void 0),Object(C.a)([Object(M.b)()],N.prototype,"vvOpacity",void 0),Object(C.a)([Object(M.b)()],N.prototype,"falloffEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"innerColorEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"sceneHasOcludees",void 0),Object(C.a)([Object(M.b)({count:4})],N.prototype,"transparencyPassType",void 0),Object(C.a)([Object(M.b)()],N.prototype,"multipassTerrainEnabled",void 0),Object(C.a)([Object(M.b)()],N.prototype,"cullAboveGround",void 0);var H=c.a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),q=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e,Y))._vertexAttributeLocations=G,i.techniqueConfig=new N,i.layout=i.createLayout(),i}return Object(a.a)(r,[{key:"isClosed",value:function(e,t){return J(this.params,e,t)}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.params}},{key:"getTechniqueConfig",value:function(e,t){this.techniqueConfig.output=e;var r=Object(u.k)(t)&&23===t.slot;this.techniqueConfig.draped=r;var i=Object(u.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleIntegerRepeatsEnabled=i&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=i&&Object(u.k)(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&Object(u.k)(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,r,i,n,a,o,s,c){c?this.intersectDrapedLineGeometry(e,i,a,o):this.intersectLineGeometry(e,t,r,i,this.params.width,o)}},{key:"intersectDrapedLineGeometry",value:function(e,t,r,i){if(t.options.selectionMode){var n=e.vertexAttributes.get("position").data,a=e.vertexAttributes.get("size"),o=this.params.width;if(this.params.vvSizeEnabled){var s=e.vertexAttributes.get("sizeFeatureAttribute").data[0];o*=Object(l.d)(this.params.vvSizeOffset[0]+s*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else a&&(o*=a.data[0]);for(var c=r[0],u=r[1],d=(o/2+4)*e.screenToWorldRatio,h=Number.MAX_VALUE,f=0;f<n.length-5;f+=3){var p=n[f],v=n[f+1],b=c-p,m=u-v,g=n[f+3]-p,y=n[f+4]-v,O=Object(l.d)((g*b+y*m)/(g*g+y*y),0,1),j=g*O-b,x=y*O-m,_=j*j+x*x;_<h&&(h=_)}h<d*d&&i()}}},{key:"intersectLineGeometry",value:function(e,t,r,i,n,a){if(i.options.selectionMode&&!Object(_.e)(t))if(Object(j.g)(r)){var o=e.vertexAttributes,s=o.get("position").data,c=n;if(this.params.vvSizeEnabled){var u=o.get("sizeFeatureAttribute").data[0];c*=Object(l.d)(this.params.vvSizeOffset[0]+u*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o.has("size")&&(c*=o.get("size").data[0]);var d=i.camera,p=ne;Object(h.c)(p,i.point);var m=c*d.pixelRatio/2+4*d.pixelRatio;Object(f.w)(pe[0],p[0]-m,p[1]+m,0),Object(f.w)(pe[1],p[0]+m,p[1]+m,0),Object(f.w)(pe[2],p[0]+m,p[1]-m,0),Object(f.w)(pe[3],p[0]-m,p[1]-m,0);for(var g=0;g<4;g++)if(!d.unprojectFromRenderScreen(pe[g],ve[g]))return;Object(b.f)(d.eye,ve[0],ve[1],be),Object(b.f)(d.eye,ve[1],ve[2],me),Object(b.f)(d.eye,ve[2],ve[3],ge),Object(b.f)(d.eye,ve[3],ve[0],ye);for(var y=Number.MAX_VALUE,O=Q(this.params,o,e.indices)?s.length-2:s.length-5,x=0;x<O;x+=3){ee[0]=s[x]+r[12],ee[1]=s[x+1]+r[13],ee[2]=s[x+2]+r[14];var S=(x+3)%s.length;if(te[0]=s[S]+r[12],te[1]=s[S+1]+r[13],te[2]=s[S+2]+r[14],!(Object(b.t)(be,ee)<0&&Object(b.t)(be,te)<0||Object(b.t)(me,ee)<0&&Object(b.t)(me,te)<0||Object(b.t)(ge,ee)<0&&Object(b.t)(ge,te)<0||Object(b.t)(ye,ee)<0&&Object(b.t)(ye,te)<0)){if(d.projectToRenderScreen(ee,ae),d.projectToRenderScreen(te,oe),ae[2]<0&&oe[2]>0){Object(f.j)(re,ee,te);var w=d.frustum,C=-Object(b.t)(w[4],ee)/Object(f.h)(re,Object(b.q)(w[4]));Object(f.e)(re,re,C),Object(f.f)(ee,ee,re),d.projectToRenderScreen(ee,ae)}else if(ae[2]>0&&oe[2]<0){Object(f.j)(re,te,ee);var k=d.frustum,P=-Object(b.t)(k[4],te)/Object(f.h)(re,Object(b.q)(k[4]));Object(f.e)(re,re,P),Object(f.f)(te,te,re),d.projectToRenderScreen(te,oe)}else if(ae[2]<0&&oe[2]<0)continue;ae[2]=0,oe[2]=0;var E=Object(v.e)(Object(v.f)(ae,oe,le),p);E<y&&(y=E,Object(f.k)(se,ee),Object(f.k)(ce,te))}}var T=i.rayBeginPoint,A=i.rayEndPoint;if(y<m*m){var R=Number.MAX_VALUE;if(Object(v.a)(Object(v.f)(se,ce,le),Object(v.f)(T,A,ue),ie)){Object(f.j)(ie,ie,T);var D=Object(f.p)(ie);Object(f.e)(ie,ie,1/D),R=D/Object(f.m)(T,A)}a(R,ie)}}else H.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return null;var i=e.indices,n=r.get("position");return Object(g.a)(n,i?i.get("position"):null,i&&Q(this.params,r,i),t)}},{key:"createLayout",value:function(){var e=Object(m.a)().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}},{key:"createBufferWriter",value:function(){return new Z(this.layout,this.params)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new W(e):void 0}},{key:"validateParameterValues",value:function(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}},{key:"requiresTransparent",value:function(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}},{key:"colorRequiresTransparent",value:function(e){return Object(u.k)(e)&&e[3]<1&&e[3]>0}}]),r}(O.a),W=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(U,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(e,t)}}]),r}(y.a),Y=Object(i.a)(Object(i.a)({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},O.b),x.a.Default),Z=function(){function e(t,r){switch(Object(n.a)(this,e),this.params=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=r.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=$}}return Object(a.a)(e,[{key:"isClosed",value:function(e){return Q(this.params,e.vertexAttributes,e.indices)}},{key:"numCapSubdivisions",value:function(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return K}}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=2*this.numCapSubdivisions(e)+2,r=e.indices.get("position").length/2+1,i=this.isClosed(e),n=i?2:2*t,a=i?0:1,o=i?r:r-1;if(e.vertexAttributes.has("subdivisions"))for(var s=e.vertexAttributes.get("subdivisions").data,c=a;c<o;++c)n+=4+2*s[c];else n+=(o-a)*(2*this.numJoinSubdivisions+4);return n+=2}},{key:"write",value:function(e,t,r,i){var n=this,a=de,o=he,s=fe,c=t.vertexAttributes.get("position").data,l=t.indices&&t.indices.get("position"),u=this.numCapSubdivisions(t);l&&l.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var d=null;t.vertexAttributes.has("subdivisions")&&(d=t.vertexAttributes.get("subdivisions").data);var h=1,p=0;this.params.vvSizeEnabled?p=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(h=t.vertexAttributes.get("size").data[0]);var v=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(v=t.vertexAttributes.get("color").data);var m=0;this.params.vvOpacityEnabled&&(m=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);var g=c.length/3,y=e.transformation,O=new Float32Array(r.buffer),j=this.vertexBufferLayout.stride/4,x=i*j,_=x,S=0,w=function(e,t,r,i,a,o,s,c){if(O[x++]=t[0],O[x++]=t[1],O[x++]=t[2],O[x++]=i,O[x++]=c,O[x++]=o+a/10,O[x++]=e[0],O[x++]=e[1],O[x++]=e[2],O[x++]=r[0],O[x++]=r[1],O[x++]=r[2],n.params.vvSizeEnabled?O[x++]=p:O[x++]=h,n.params.vvColorEnabled)O[x++]=b;else{var l=Math.min(4*s,v.length-4);O[x++]=v[l+0],O[x++]=v[l+1],O[x++]=v[l+2],O[x++]=v[l+3]}n.params.vvOpacityEnabled&&(O[x++]=m)};x+=j,Object(f.w)(o,c[0],c[1],c[2]),y&&Object(f.q)(o,o,y);var C=this.isClosed(t);if(C){var k=c.length-3;Object(f.w)(a,c[k],c[k+1],c[k+2]),y&&Object(f.q)(a,a,y)}else{Object(f.k)(a,o),Object(f.w)(s,c[3],c[4],c[5]),y&&Object(f.q)(s,s,y);for(var P=0;P<u;++P){var E=1-P/u;w(a,o,s,E,1,-4,0,S),w(a,o,s,E,1,4,0,S)}w(a,o,s,0,0,-4,0,S),w(a,o,s,0,0,4,0,S),Object(f.k)(a,o),Object(f.k)(o,s)}for(var T=C?0:1,A=C?g:g-1,R=T;R<A;R++){var D=(R+1)%g*3;Object(f.w)(s,c[D+0],c[D+1],c[D+2]),y&&Object(f.q)(s,s,y),w(a,o,s,0,1,-1,R,S+=Object(f.m)(a,o)),w(a,o,s,0,1,1,R,S);for(var M=d?d[R]:this.numJoinSubdivisions,I=0;I<M;++I){var L=(I+1)/(M+1);w(a,o,s,L,1,-2,R,S),w(a,o,s,L,1,2,R,S)}w(a,o,s,1,0,-2,R,S),w(a,o,s,1,0,2,R,S),Object(f.k)(a,o),Object(f.k)(o,s)}if(C)Object(f.w)(s,c[3],c[4],c[5]),y&&Object(f.q)(s,s,y),w(a,o,s,0,1,-1,T,S+=Object(f.m)(a,o)),w(a,o,s,0,1,1,T,S);else{w(a,o,s,0,1,-5,A,S+=Object(f.m)(a,o)),w(a,o,s,0,1,5,A,S);for(var z=0;z<u;++z){var F=(z+1)/u;w(a,o,s,F,1,-5,A,S),w(a,o,s,F,1,5,A,S)}}X(O,_+j,O,_,j),x=X(O,x-j,O,x,j)}}]),e}();function X(e,t,r,i,n){for(var a=0;a<n;a++)r[i++]=e[t++];return i}function Q(e,t,r){return J(e,t.get("position").data,r?r.get("position"):null)}function J(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}var K=3,$=1,ee=Object(p.e)(),te=Object(p.e)(),re=Object(p.e)(),ie=Object(p.e)(),ne=Object(p.e)(),ae=Object(d.d)(),oe=Object(d.d)(),se=Object(p.e)(),ce=Object(p.e)(),le=Object(v.d)(),ue=Object(v.d)(),de=Object(p.e)(),he=Object(p.e)(),fe=Object(p.e)(),pe=[Object(d.d)(),Object(d.d)(),Object(d.d)(),Object(d.d)()],ve=[Object(p.e)(),Object(p.e)(),Object(p.e)(),Object(p.e)()],be=Object(b.d)(),me=Object(b.d)(),ge=Object(b.d)(),ye=Object(b.d)()},709:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i,n,a,o,s=r(542),c=r(538);function l(e){var t=Object(c.a)(i||(i=Object(s.a)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}function u(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(Object(c.a)(n||(n=Object(s.a)(["vec3 normalModel() {\nreturn normal;\n}"]))))),1===t.normalType&&(e.include(l),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(Object(c.a)(a||(a=Object(s.a)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(c.a)(o||(o=Object(s.a)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}},711:function(e,t,r){"use strict";function i(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u)i[c]=a[l],i[c+1]=a[l+1],i[c+2]=a[l+2],c+=n,l+=o}function n(e,t,r,i,n){for(var a,o,s=e.typedBuffer,c=e.typedBufferStride,l=null!=(a=null==n?void 0:n.count)?a:e.count,u=(null!=(o=null==n?void 0:n.dstIndex)?o:0)*c,d=0;d<l;++d)s[u]=t,s[u+1]=r,s[u+2]=i,u+=c}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:i,fill:n})},712:function(e,t,r){"use strict";function i(e){return 32+e.length}function n(e){if(!e)return 0;var t=32;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(typeof n){case"string":t+=i(n);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function a(e,t){return 32+e.length*t}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}))},716:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n=r(542),a=r(538);function o(e){e.attributes.add("position","vec3"),e.vertex.code.add(Object(a.a)(i||(i=Object(n.a)(["vec3 positionModel() { return position; }"]))))}},717:function(e,t,r){"use strict";r.d(t,"a",(function(){return q}));var i=r(10),n=r(2),a=r(3),o=r(41),s=r(38),c=r(5),l=r(6),u=r(563),d=r(58),h=r(79),f=r(647),p=r(578),v=r(821),b=r(625),m=r(613),g=r(829),y=r(696),O=r(620),j=r(0),x=r(557),_=r(730),S=r(702),w=r(575),C=r(568),k=r(731),P=r(643),E=r(655),T=r(735),A=r(642),R=r(609),D=r(618),M=r(624),I=r(619),L=r(610),z=r(701),F=r(831),V=r(544),G=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,receiveShadows:i.receiveShadows,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:i.symbolColors,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,instanced:i.instanced,instancedColor:i.instancedColor,instancedDoublePrecision:i.instancedDoublePrecision,pbrMode:i.usePBR?i.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:i.hasMetalnessAndRoughnessTexture,hasEmissionTexture:i.hasEmissionTexture,hasOcclusionTexture:i.hasOcclusionTexture,hasNormalTexture:i.hasNormalTexture,hasColorTexture:i.hasColorTexture,receiveAmbientOcclusion:i.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:i.normalsTypeDerivate?3:0,doubleSidedMode:i.doubleSidedMode,vertexTangents:i.vertexTangents,attributeTextureCoordinates:i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture||i.hasColorTexture?1:0,textureAlphaPremultiplied:i.textureAlphaPremultiplied,attributeColor:i.vertexColors,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,offsetBackfaces:i.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(T.b)(e.rctx),alphaDiscardMode:i.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new L.a(e.rctx,n,I.a)}},{key:"bindPass",value:function(e,t){var r,i;Object(A.c)(this.program,t.camera.projectionMatrix);var n=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===n)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(C.a)(this.program,t)),7===n&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",O.b[e.colorMixMode])),0===n?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",O.b[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(k.b)(this.program,e,this.configuration.isSchematic)):4===n&&Object(w.b)(this.program,t),Object(E.c)(this.program,e),Object(S.b)(this.program,e,t),Object(O.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program,t.camera)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(h.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(A.e)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(A.a)(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&_.a.bindCustomOrigin(this.program,t),Object(x.b)(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(P.d)(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var r=this.configuration,i=3===e,n=2===e;return Object(V.f)({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?m.g:Object(m.a)(e),culling:U(r)&&Object(V.b)(r.cullFace),depthTest:{func:Object(m.b)(e)},depthWrite:i||n?r.writeDepth&&V.d:null,colorWrite:V.c,stencilWrite:r.sceneHasOcludees?z.h:null,stencilTest:r.sceneHasOcludees?t?z.d:z.c:null,polygonOffset:i||n?null:Object(m.h)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),r}(D.a);function U(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}G.shader=new R.a(F.a,(function(){return r.e(202).then(r.bind(null,1116))}));var B=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(M.a);Object(j.a)([Object(M.b)({count:8})],B.prototype,"output",void 0),Object(j.a)([Object(M.b)({count:4})],B.prototype,"alphaDiscardMode",void 0),Object(j.a)([Object(M.b)({count:3})],B.prototype,"doubleSidedMode",void 0),Object(j.a)([Object(M.b)()],B.prototype,"isSchematic",void 0),Object(j.a)([Object(M.b)()],B.prototype,"vertexColors",void 0),Object(j.a)([Object(M.b)()],B.prototype,"offsetBackfaces",void 0),Object(j.a)([Object(M.b)()],B.prototype,"symbolColors",void 0),Object(j.a)([Object(M.b)()],B.prototype,"vvSize",void 0),Object(j.a)([Object(M.b)()],B.prototype,"vvColor",void 0),Object(j.a)([Object(M.b)()],B.prototype,"verticalOffset",void 0),Object(j.a)([Object(M.b)()],B.prototype,"receiveShadows",void 0),Object(j.a)([Object(M.b)()],B.prototype,"slicePlaneEnabled",void 0),Object(j.a)([Object(M.b)()],B.prototype,"sliceHighlightDisabled",void 0),Object(j.a)([Object(M.b)()],B.prototype,"receiveAmbientOcclusion",void 0),Object(j.a)([Object(M.b)()],B.prototype,"screenSizePerspective",void 0),Object(j.a)([Object(M.b)()],B.prototype,"textureAlphaPremultiplied",void 0),Object(j.a)([Object(M.b)()],B.prototype,"hasColorTexture",void 0),Object(j.a)([Object(M.b)()],B.prototype,"usePBR",void 0),Object(j.a)([Object(M.b)()],B.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(j.a)([Object(M.b)()],B.prototype,"hasEmissionTexture",void 0),Object(j.a)([Object(M.b)()],B.prototype,"hasOcclusionTexture",void 0),Object(j.a)([Object(M.b)()],B.prototype,"hasNormalTexture",void 0),Object(j.a)([Object(M.b)()],B.prototype,"instanced",void 0),Object(j.a)([Object(M.b)()],B.prototype,"instancedColor",void 0),Object(j.a)([Object(M.b)()],B.prototype,"instancedDoublePrecision",void 0),Object(j.a)([Object(M.b)()],B.prototype,"vertexTangents",void 0),Object(j.a)([Object(M.b)()],B.prototype,"normalsTypeDerivate",void 0),Object(j.a)([Object(M.b)()],B.prototype,"writeDepth",void 0),Object(j.a)([Object(M.b)()],B.prototype,"sceneHasOcludees",void 0),Object(j.a)([Object(M.b)()],B.prototype,"transparent",void 0),Object(j.a)([Object(M.b)()],B.prototype,"enableOffset",void 0),Object(j.a)([Object(M.b)({count:3})],B.prototype,"cullFace",void 0),Object(j.a)([Object(M.b)({count:4})],B.prototype,"transparencyPassType",void 0),Object(j.a)([Object(M.b)()],B.prototype,"multipassTerrainEnabled",void 0),Object(j.a)([Object(M.b)()],B.prototype,"cullAboveGround",void 0);var N=r(832),H=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,receiveShadows:i.receiveShadows,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:i.symbolColors,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,instanced:i.instanced,instancedColor:i.instancedColor,instancedDoublePrecision:i.instancedDoublePrecision,pbrMode:i.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:i.hasColorTexture,receiveAmbientOcclusion:i.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:i.hasColorTexture?1:0,textureAlphaPremultiplied:i.textureAlphaPremultiplied,attributeColor:i.vertexColors,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,offsetBackfaces:i.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(T.b)(e.rctx),alphaDiscardMode:i.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new L.a(e.rctx,n,I.a)}}]),r}(G);H.shader=new R.a(N.a,(function(){return r.e(199).then(r.bind(null,1117))}));var q=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e,Y)).supportsEdges=!0,i.techniqueConfig=new B,i.vertexBufferLayout=r.getVertexBufferLayout(i.params),i.instanceBufferLayout=e.instanced?r.getInstanceBufferLayout(i.params):null,i}return Object(a.a)(r,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Object(o.a)(Object(s.a)(r.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,i=e.vertexColors,n=e.symbolColors,a=!!t&&t.indexOf("color")>-1,c=e.vvColorEnabled,l="replace"===e.colorMixMode,u=e.opacity>0,d=e.externalColor&&e.externalColor[3]>0;return i&&(a||c||n)?!!l||u:i?l?d:u:a||c||n?!!l||u:l?d:u}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<m.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,r,i,n,a,o){if(null!==this.params.verticalOffset){var s=i.camera;Object(d.w)(ee,r[12],r[13],r[14]);var c=null;switch(i.viewingMode){case 1:c=Object(d.r)(K,ee);break;case 2:c=Object(d.k)(K,J)}var l=0;if(null!==this.params.verticalOffset){var u=Object(d.j)(te,ee,s.eye),h=Object(d.p)(u),f=Object(d.e)(u,u,1/h),p=null;this.params.screenSizePerspective&&(p=Object(d.h)(c,f)),l+=Object(O.i)(s,h,this.params.verticalOffset,p,this.params.screenSizePerspective)}Object(d.e)(c,c,l),Object(d.x)($,c,i.transform.inverseRotation),n=Object(d.j)(X,n,$),a=Object(d.j)(Q,a,$)}Object(O.f)(e,t,i,n,a,Object(g.c)(i.verticalOffset),o)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new W(e)}},{key:"createBufferWriter",value:function(){return new Z(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=Object(f.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&r.vec4f("tangent"),t&&r.vec2f("uv0"),e.vertexColors&&r.vec4u8("color"),e.symbolColors&&r.vec4u8("symbolColor"),r}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(f.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),r}(b.a),W=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(e){var a;Object(n.a)(this,r);var o=e.material;return(a=t.call(this,Object(i.a)(Object(i.a)({},e),o.params))).updateParameters(),a}return Object(a.a)(r,[{key:"updateParameters",value:function(e){var t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(t.treeRendering?H:G,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),this.bindTextures(this._technique.program)}},{key:"beginSlot",value:function(e){return e===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)||23===e}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),r}(v.a),Y=Object(i.a)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(u.b)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:p.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},b.b),Z=function(){function e(t,r){Object(n.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=r}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){Object(y.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}]),e}(),X=Object(h.e)(),Q=Object(h.e)(),J=Object(h.g)(0,0,1),K=Object(h.e)(),$=Object(h.e)(),ee=Object(h.e)(),te=Object(h.e)()},719:function(e,t,r){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.stride;return e.fieldNames.filter((function(t){var r=e.fields.get(t).optional;return!(r&&r.glPadding)})).map((function(i){var a=e.fields.get(i),o=a.constructor.ElementCount,s=n(a.constructor.ElementType),c=a.offset,l=!(!a.optional||!a.optional.glNormalized);return{name:i,stride:r,count:o,type:s,offset:c,normalized:l,divisor:t}}))}function n(e){var t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}r.d(t,"a",(function(){return i}));var a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},726:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return u}));var i=r(13),n=r(80),a=(r(12),r(19)),o=r(7),s=r(162),c=r(73),l=r(612);function u(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if("declaredClass"in e)return e;var r=new n.a({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=Object(a.a)(e.symbol),r.attributes=Object(a.a)(e.attributes),r.geometry=f(e.geometry),r}function f(e){return Object(o.j)(e)?null:u(e)?e:Object(c.a)(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,i=e.hasZ,n=e.hasM;return{rings:p(r),hasZ:i,hasM:n,spatialReference:t};case"polyline":var a=e.paths,o=e.hasZ,s=e.hasM;return{paths:p(a),hasZ:o,hasM:s,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:t};case"multipoint":var c=e.points,l=e.hasZ,u=e.hasM;return{points:b(c)?v(c):c,hasZ:l,hasM:u,spatialReference:t};default:return}}(e))}function p(e){return function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(0!==n.length)return b(n)}}catch(a){r.e(a)}finally{r.f()}return!1}(e)?e.map((function(e){return v(e)})):e}function v(e){return e.map((function(e){return Object(s.n)(e)}))}function b(e){return e.length&&(Object(s.d)(e[0])||Object(s.e)(e[0]))}function m(e,t){if(!e)return null;var r;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?((r=t).x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=Object(l.g)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}},727:function(e,t,r){"use strict";r.d(t,"a",(function(){return N})),r.d(t,"b",(function(){return F})),r.d(t,"c",(function(){return V})),r.d(t,"d",(function(){return G}));var i,n,a,o,s,c,l,u,d,h,f,p,v,b,m,g,y,O,j,x=r(542),_=r(30),S=r(60),w=r(558),C=r(557),k=r(792),P=r(728),E=r(869),T=r(575),A=r(655),R=r(578),D=r(621),M=r(715),I=r(747),L=r(538),z=r(561);function F(e){var t=new z.a,r=e.signedDistanceFieldEnabled;if(t.include(k.a),t.include(P.a,e),t.include(C.a,e),6===e.output)return t.include(E.a,e),t;t.include(I.a),t.fragment.include(M.a),t.fragment.include(D.a),t.include(A.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(Object(L.a)(i||(i=Object(x.a)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?Object(L.a)(n||(n=Object(x.a)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):Object(L.a)(a||(a=Object(x.a)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var _=Object(L.a)(o||(o=Object(x.a)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),S=e.pixelSnappingEnabled?r?Object(L.a)(s||(s=Object(x.a)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):Object(L.a)(c||(c=Object(x.a)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):Object(L.a)(l||(l=Object(x.a)(["posProj += quadOffset;"])));t.vertex.code.add(Object(L.a)(u||(u=Object(x.a)(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",_,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",L.a.float(R.c),r?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(L.a.float(R.c),";"):"",S,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?Object(L.a)(d||(d=Object(x.a)(["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var w=e.debugDrawBorder?Object(L.a)(h||(h=Object(x.a)(["(isBorder > 0.0 ? 0.0 : ",")"])),L.a.float(R.b)):L.a.float(R.b),F=Object(L.a)(f||(f=Object(x.a)(["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?Object(L.a)(p||(p=Object(x.a)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",r?Object(L.a)(v||(v=Object(x.a)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),w,L.a.float(R.c),w):Object(L.a)(b||(b=Object(x.a)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),w),e.debugDrawBorder?Object(L.a)(m||(m=Object(x.a)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 7===e.output&&t.fragment.code.add(Object(L.a)(g||(g=Object(x.a)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),F)),0===e.output&&t.fragment.code.add(Object(L.a)(y||(y=Object(x.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),F,e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":"")),4===e.output&&(t.include(T.a),t.fragment.code.add(Object(L.a)(O||(O=Object(x.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),F,e.binaryHighlightOcclusionEnabled?Object(L.a)(j||(j=Object(x.a)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function V(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",w.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",G(t))}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;return e.textureIsSignedDistanceField?U(e.anchorPos,e.distanceFieldBoundingBox,t):Object(_.c)(t,e.anchorPos),t}function U(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}var B=Object(S.a)(),N=Object.freeze({__proto__:null,build:F,bindHUDMaterialUniforms:V,calculateAnchorPosForRendering:G})},728:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p}));var i,n,a,o,s,c,l,u=r(542),d=r(747),h=r(538);function f(e,t){var r=e;r.include(d.a),r.attributes.add("position","vec3"),r.attributes.add("normal","vec3"),r.attributes.add("auxpos1","vec4"),r.vertex.uniforms.add("proj","mat4"),r.vertex.uniforms.add("view","mat4"),r.vertex.uniforms.add("viewNormal","mat4"),r.vertex.uniforms.add("viewport","vec4"),r.vertex.uniforms.add("camPos","vec3"),r.vertex.uniforms.add("polygonOffset","float"),r.vertex.uniforms.add("cameraGroundRelative","float"),r.vertex.uniforms.add("pixelRatio","float"),r.vertex.uniforms.add("perDistancePixelRatio","float"),r.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),r.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),r.vertex.constants.add("smallOffsetAngle","float",.984807753012208),r.vertex.code.add(Object(h.a)(i||(i=Object(u.a)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),r.vertex.code.add(Object(h.a)(n||(n=Object(u.a)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped||r.vertex.code.add(Object(h.a)(a||(a=Object(u.a)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"])))),r.vertex.code.add(Object(h.a)(o||(o=Object(u.a)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?Object(h.a)(s||(s=Object(u.a)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?Object(h.a)(c||(c=Object(u.a)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),r.vertex.code.add(Object(h.a)(l||(l=Object(u.a)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (uRenderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}function p(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},729:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return c}));var i=r(2),n=r(3),a=r(647),o=r(696),s=Object(a.a)().vec3f("position"),c=Object(a.a)().vec3f("position").vec2f("uv0"),l=Object(a.a)().vec3f("position").vec4u8("color"),u=function(){function e(t){Object(i.a)(this,e),this.vertexBufferLayout=t}return Object(n.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){Object(o.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}]),e}()},730:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var i,n,a,o,s,c,l,u,d=r(2),h=r(542),f=r(79),p=r(735),v=r(538),b=r(817);function m(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(p.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var r=[Object(v.a)(i||(i=Object(h.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),Object(v.a)(n||(n=Object(h.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?Object(v.a)(a||(a=Object(h.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),Object(v.a)(o||(o=Object(h.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),Object(v.a)(s||(s=Object(h.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangents?Object(v.a)(c||(c=Object(h.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):Object(v.a)(l||(l=Object(h.a)([""])))];e.vertex.code.add(r[0]),e.vertex.code.add(r[1]),e.vertex.code.add(r[2]),2===t.output&&e.vertex.code.add(r[3]),e.vertex.code.add(r[4])}(u=m||(m={})).Uniforms=function e(){Object(d.a)(this,e)},u.bindCustomOrigin=function(e,t){Object(b.b)(t,g,y,3),e.setUniform3fv("viewOriginHi",g),e.setUniform3fv("viewOriginLo",y)};var g=Object(f.e)(),y=Object(f.e)()},731:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return b}));var i,n,a,o,s,c,l,u,d=r(542),h=r(713),f=r(841),p=r(538);Object(h.c)(0,.6,.2);function v(e,t){var r=e.fragment,h=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&h&&e.include(f.a,t),2!==t.pbrMode?(0===t.pbrMode&&r.code.add(Object(p.a)(i||(i=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),1===t.pbrMode&&(r.uniforms.add("emissionFactor","vec3"),r.uniforms.add("mrrFactors","vec3"),r.code.add(Object(p.a)(n||(n=Object(d.a)(["vec3 mrr;\nvec3 emission;\nfloat occlusion;"])))),t.hasMetalnessAndRoughnessTexture&&(r.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texMetallicRoughnessSize","vec2"),r.code.add(Object(p.a)(a||(a=Object(d.a)(["void applyMetallnessAndRoughness(TextureLookupParameter params) {\nvec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\nmrr[0] *= metallicRoughness.b;\nmrr[1] *= metallicRoughness.g;\n}"]))))),t.hasEmissionTexture&&(r.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texEmissionSize","vec2"),r.code.add(Object(p.a)(o||(o=Object(d.a)(["void applyEmission(TextureLookupParameter params) {\nemission *= textureLookup(texEmission, params).rgb;\n}"]))))),t.hasOcclusionTexture?(r.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texOcclusionSize","vec2"),r.code.add(Object(p.a)(s||(s=Object(d.a)(["void applyOcclusion(TextureLookupParameter params) {\nocclusion *= textureLookup(texOcclusion, params).r;\n}\nfloat getBakedOcclusion() {\nreturn occlusion;\n}"]))))):r.code.add(Object(p.a)(c||(c=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),r.code.add(Object(p.a)(l||(l=Object(d.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),h?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):r.code.add(Object(p.a)(u||(u=Object(d.a)(["const vec3 mrr = vec3(0.0, 0.6, 0.2);\nconst vec3 emission = vec3(0.0);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))))}function b(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},735:function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return E}));var i,n,a,o=r(542),s=r(12),c=r(538),l=r(2),u=r(3),d=r(7),h=r(79),f=r(550),p=r(552),v=r(683),b=(r(548),r(549),r(544)),m=(r(546),r(551)),g=r(817),y=r(567),O=r(613),j={exports:{}};i=j,n=function(){var e=function(e){var t;window.console&&window.console.error?window.console.error(e):(t=e,window.console&&window.console.log&&window.console.log(t))},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,i=null;function n(e){if(null==r)for(var t in r={},i={},e)"number"==typeof e[t]&&(r[e[t]]=t,i[t]=e[t])}function a(){if(null==r)throw"WebGLDebugUtils.init(ctx) not called"}function o(e){return a(),void 0!==r[e]}function s(e){a();var t=r[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function c(e,r,n,a){var o;if(void 0!==(o=t[e])&&void 0!==(o=o[r])&&o[n]){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var c=o[n].enumBitwiseOr,l=0,u=[],d=0;d<c.length;++d){var h=i[c[d]];0!=(a&h)&&(l|=h,u.push(s(h)))}return l===a?u.join(" | "):s(a)}return s(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function l(e,t,r){e.__defineGetter__(r,(function(){return t[r]})),e.__defineSetter__(r,(function(e){t[r]=e}))}function u(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:n,mightBeEnum:o,glEnumToString:s,glFunctionArgToString:c,glFunctionArgsToString:function(e,t){for(var r="",i=t.length,n=0;n<i;++n)r+=(0==n?"":", ")+c(e,i,n,t[n]);return r},makeDebugContext:function t(r,i,a,o){o=o||r,n(r),i=i||function(t,r,i){for(var n="",a=i.length,o=0;o<a;++o)n+=(0==o?"":", ")+c(r,a,o,i[o]);e("WebGL error "+s(t)+" in "+r+"("+n+")")};var u={};function d(e,t){return function(){a&&a(t,arguments);var r=e[t].apply(e,arguments),n=o.getError();return 0!=n&&(u[n]=!0,i(n,t,arguments)),r}}var h={};for(var f in r)if("function"==typeof r[f])if("getExtension"!=f)h[f]=d(r,f);else{var p=d(r,f);h[f]=function(){return t(p.apply(r,arguments),i,a,o)}}else l(h,r,f);return h.getError=function(){for(var e in u)if(u.hasOwnProperty(e)&&u[e])return u[e]=!1,e;return r.NO_ERROR},h},makeLostContextSimulatingCanvas:function(e){var t,r,i=[],n=[],a={},o=1,s=!1,c=[],d=0,h=0,f=!1,p=0,v={};function b(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(r=e.getContext,function(){var i=r.apply(e,arguments);if(i instanceof WebGLRenderingContext){if(i!=t){if(t)throw"got different context";a=x(t=i)}return a}return i});var m=function(e){i.push(b(e))},g=function(e){n.push(b(e))};function y(){++h,s||d==h&&e.loseContext()}function O(e,t){var r=e[t];return function(){if(y(),!s)return r.apply(e,arguments)}}function j(e){return{statusMessage:e,preventDefault:function(){f=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":m(i);break;case"webglcontextrestored":g(i);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!s){for(s=!0,d=0,++o;t.getError(););(function(){for(var e=Object.keys(v),t=0;t<e.length;++t)delete v[e]})(),v[t.CONTEXT_LOST_WEBGL]=!0;var r=j("context lost"),n=i.slice();setTimeout((function(){for(var t=0;t<n.length;++t)n[t](r);p>=0&&setTimeout((function(){e.restoreContext()}),p)}),0)}},e.restoreContext=function(){s&&n.length&&setTimeout((function(){if(!f)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<c.length;++e){var r=c[e];r instanceof WebGLBuffer?t.deleteBuffer(r):r instanceof WebGLFramebuffer?t.deleteFramebuffer(r):r instanceof WebGLProgram?t.deleteProgram(r):r instanceof WebGLRenderbuffer?t.deleteRenderbuffer(r):r instanceof WebGLShader?t.deleteShader(r):r instanceof WebGLTexture&&t.deleteTexture(r)}})(),u(t),s=!1,h=0,f=!1;for(var e=n.slice(),r=j("context restored"),i=0;i<e.length;++i)e[i](r)}),0)},e.loseContextInNCalls=function(e){if(s)throw"You can not ask a lost contet to be lost";d=h+e},e.getNumCalls=function(){return h},e.setRestoreTimeout=function(e){p=e},e;function x(e){for(var r in e)"function"==typeof e[r]?a[r]=O(e,r):l(a,e,r);a.getError=function(){if(y(),!s)for(;e=t.getError();)v[e]=!0;for(var e in v)if(v[e])return delete v[e],e;return a.NO_ERROR};for(var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],n=0;n<i.length;++n){var u=i[n];a[u]=function(t){return function(){if(y(),s)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=o,c.push(r),r}}(e[u])}var d=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(n=0;n<d.length;++n)a[u=d[n]]=function(t){return function(){return y(),s?null:t.apply(e,arguments)}}(a[u]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(n=0;n<h.length;++n)a[u=h[n]]=function(t){return function(){return y(),!s&&t.apply(e,arguments)}}(a[u]);return a.checkFramebufferStatus=function(t){return function(){return y(),s?a.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(t){return function(){return y(),s?-1:t.apply(e,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(t){return function(){return y(),s?0:t.apply(e,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return s},a}},resetToInitialState:u}},void 0!==(a=n())&&(i.exports=a);var x,_,S=r(811),w=function(){function e(t){var r=this;Object(l.a)(this,e),this.context=t,this.svgAlwaysPremultipliesAlpha=!1,this.floatBufferBlendWorking=!1,this._doublePrecisionRequiresObfuscation=null,this.floatBufferBlendWorking=function(e){var t,r,i,n,a;if(!e.gl)return!1;if("webgl"===e.webglVersion)return(null==(n=e.capabilities.textureFloat)?void 0:n.textureFloat)&&(null==(a=e.capabilities.colorBufferFloat)?void 0:a.textureFloat);if(!((null==(t=e.capabilities.textureFloat)?void 0:t.textureFloat)&&(null==(r=e.capabilities.colorBufferFloat)?void 0:r.textureFloat)&&(null==(i=e.capabilities.colorBufferFloat)?void 0:i.floatBlend)))return!1;var o=new p.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5126,internalFormat:34836,samplingMode:9728,width:1,height:1}),s=f.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),c=new m.a(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:s}),l=new v.a(e,"\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(l);var u=e.getBoundFramebufferObject(),d=e.getViewport(),h=d.x,g=d.y,y=d.width,x=d.height;e.bindFramebuffer(o),e.setViewport(0,0,1,1),e.bindVAO(c),e.drawArrays(5,0,4);var _=Object(b.f)({blending:O.f});e.setPipelineState(_),e.drawArrays(5,0,4),j.exports.init(e);var S=e.gl.getError();return e.setViewport(h,g,y,x),e.bindFramebuffer(u),l.dispose(),c.dispose(!1),s.dispose(),o.dispose(),1282!==S||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(t),Object(S.a)(t).then((function(e){return r.svgAlwaysPremultipliesAlpha=!e}))}return Object(u.a)(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(d.j)(this._doublePrecisionRequiresObfuscation)){var e=k(this.context,!1),t=k(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}(),C=null;function k(e,t){var r=new p.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});var i=f.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new m.a(e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:i}),a=Object(h.g)(5633261.287538229,2626832.878767164,1434988.0495278358),o=Object(h.g)(5633271.46742708,2626873.6381334523,1434963.231608387),s=function(r,i){var n=new v.a(e,"\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),a=new Float32Array(6);Object(g.a)(r,a,3);var o=new Float32Array(6);return Object(g.a)(i,o,3),e.useProgram(n),n.setUniform3f("u_highA",a[0],a[2],a[4]),n.setUniform3f("u_lowA",a[1],a[3],a[5]),n.setUniform3f("u_highB",o[0],o[2],o[4]),n.setUniform3f("u_lowB",o[1],o[3],o[5]),n}(a,o),c=e.getBoundFramebufferObject(),l=e.getViewport(),u=l.x,d=l.y,b=l.width,O=l.height;e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(5,0,4);var j=new Uint8Array(4);r.readPixels(0,0,1,1,6408,5121,j),s.dispose(),n.dispose(!1),i.dispose(),r.dispose(),e.setViewport(u,d,b,O),e.bindFramebuffer(c);var x=(a[2]-o[2])/25,_=Object(y.k)(j);return Math.abs(x-_)}function P(e,t){var r=e.code;t.doublePrecisionRequiresObfuscation?r.add(Object(c.a)(x||(x=Object(o.a)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):r.add(Object(c.a)(_||(_=Object(o.a)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function E(e){return!!Object(s.a)("force-double-precision-obfuscation")||(t=e,(Object(d.j)(C)||C.context!==t)&&(C=new w(t)),C).doublePrecisionRequiresObfuscation;var t}},736:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var i,n,a,o,s=r(542),c=r(538);function l(e,t){var r=e.fragment,l=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===l?(r.uniforms.add("lightingAmbientSH0","vec3"),r.code.add(Object(c.a)(i||(i=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):1===l?(r.uniforms.add("lightingAmbientSH_R","vec4"),r.uniforms.add("lightingAmbientSH_G","vec4"),r.uniforms.add("lightingAmbientSH_B","vec4"),r.code.add(Object(c.a)(n||(n=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):2===l&&(r.uniforms.add("lightingAmbientSH0","vec3"),r.uniforms.add("lightingAmbientSH_R1","vec4"),r.uniforms.add("lightingAmbientSH_G1","vec4"),r.uniforms.add("lightingAmbientSH_B1","vec4"),r.uniforms.add("lightingAmbientSH_R2","vec4"),r.uniforms.add("lightingAmbientSH_G2","vec4"),r.uniforms.add("lightingAmbientSH_B2","vec4"),r.code.add(Object(c.a)(a||(a=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"])))),1!==t.pbrMode&&2!==t.pbrMode||r.code.add(Object(c.a)(o||(o=Object(s.a)(["const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}"])))))}var u,d=r(705);function h(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(Object(c.a)(u||(u=Object(s.a)(["vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\nfloat dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);\ndotVal = mix(dotVal, 1.0, lightingFixedFactor);\nreturn lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n}"]))))}var f,p,v,b,m,g,y,O,j,x,_,S,w,C=r(718),k=r(791),P=r(643);function E(e,t){var r=e.fragment;e.include(h),e.include(d.a,t),0!==t.pbrMode&&e.include(C.a,t),e.include(l,t),t.receiveShadows&&e.include(P.a,t),r.uniforms.add("lightingGlobalFactor","float"),r.uniforms.add("ambientBoostFactor","float"),e.include(k.a),r.code.add(Object(c.a)(f||(f=Object(s.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),r.code.add(Object(c.a)(p||(p=Object(s.a)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),1===t.viewingMode?Object(c.a)(v||(v=Object(s.a)(["normalize(vPosWorld)"]))):Object(c.a)(b||(b=Object(s.a)(["vec3(0.0, 0.0, 1.0)"]))))),r.code.add(Object(c.a)(m||(m=Object(s.a)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),0===t.pbrMode||4===t.pbrMode?r.code.add(Object(c.a)(g||(g=Object(s.a)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"])))):1!==t.pbrMode&&2!==t.pbrMode||(r.code.add(Object(c.a)(y||(y=Object(s.a)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),r.code.add(Object(c.a)(O||(O=Object(s.a)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),r.code.add(Object(c.a)(j||(j=Object(s.a)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = abs(dot(normal, ambientDir));\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),r.code.add(Object(c.a)(x||(x=Object(s.a)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),r.code.add(Object(c.a)(_||(_=Object(s.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?Object(c.a)(S||(S=Object(s.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):Object(c.a)(w||(w=Object(s.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},739:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i=r(11).a.getLogger("esri.views.3d.support.buffer.math")},740:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return _}));var i=r(11),n=r(7),a=r(235),o=r(563),s=r(547),c=r(58),l=r(79),u=r(384),d=r(161),h=r(42),f=r(55),p=r(598),v=r(669),b=i.a.getLogger("esri.geometry.support.meshUtils.normalProjection");function m(e,t,r,i,n){return k(i)?(C(0,p.u.fromTypedArray(e),p.v.fromTypedArray(t),p.v.fromTypedArray(r),i,p.u.fromTypedArray(n)),n):(b.error("Cannot convert spatial reference to PCPF"),n)}function g(e,t,r,i,n){return k(i)?(C(1,p.u.fromTypedArray(e),p.v.fromTypedArray(t),p.v.fromTypedArray(r),i,p.u.fromTypedArray(n)),n):(b.error("Cannot convert to spatial reference from PCPF"),n)}function y(e,t,r){return Object(u.l)(e,t,0,r,Object(d.g)(t),0,e.length/3),r}function O(e,t,r){return Object(u.l)(e,Object(d.g)(r),0,t,r,0,e.length/3),t}function j(e,t,r){if(Object(n.j)(e))return t;var i=p.v.fromTypedArray(e),a=p.v.fromTypedArray(t);return Object(v.e)(a,i,r),t}function x(e,t,r){if(Object(n.j)(e))return t;Object(a.a)(R,r);var i=p.u.fromTypedArray(e),o=p.u.fromTypedArray(t);return Object(v.a)(o,i,R),Object(a.g)(R)||Object(v.c)(o,o),t}function _(e,t,r){if(Object(n.j)(e))return t;Object(a.a)(R,r);var i=p.u.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),o=p.u.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Object(v.a)(o,i,R),Object(a.g)(R)||Object(v.c)(o,o),e!==t)for(var s=3;s<e.length;s+=4)t[s]=e[s];return t}function S(e,t,r,i,n){if(!k(i))return b.error("Cannot convert spatial reference to PCPF"),n;C(0,p.u.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),p.v.fromTypedArray(t),p.v.fromTypedArray(r),i,p.u.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(var a=3;a<e.length;a+=4)n[a]=e[a];return n}function w(e,t,r,i,n){if(!k(i))return b.error("Cannot convert to spatial reference from PCPF"),n;C(1,p.u.fromTypedArray(e,16),p.v.fromTypedArray(t),p.v.fromTypedArray(r),i,p.u.fromTypedArray(n,16));for(var a=3;a<e.length;a+=4)n[a]=e[a];return n}function C(e,t,r,i,n,o){if(t){var s=r.count,l=Object(d.g)(n);if(P(n))for(var h=0;h<s;h++)i.getVec(h,E),t.getVec(h,T),Object(u.c)(l,E,A,l),Object(a.f)(R,A),1===e&&Object(a.m)(R,R),Object(c.x)(T,T,R),o.setVec(h,T);else for(var p=0;p<s;p++){i.getVec(p,E),t.getVec(p,T),Object(u.c)(l,E,A,l),Object(a.f)(R,A);var v=Object(f.g)(r.get(p,1)),b=Math.cos(v);0===e&&(b=1/b),R[0]*=b,R[1]*=b,R[2]*=b,R[3]*=b,R[4]*=b,R[5]*=b,1===e&&Object(a.m)(R,R),Object(c.x)(T,T,R),Object(c.r)(T,T),o.setVec(p,T)}return o}}function k(e){return P(e)||function(e){return e.isWebMercator}(e)}function P(e){return e.isWGS84||Object(h.f)(e)||Object(h.i)(e)||Object(h.j)(e)}var E=Object(l.e)(),T=Object(l.e)(),A=Object(s.d)(),R=Object(o.b)()},746:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return v})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return m}));var i=r(4),n=r.n(i),a=r(9),o=r(11),s=r(726),c=r(111),l=o.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function u(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function d(e,t,r){return h.apply(this,arguments)}function h(){return h=Object(a.a)(n.a.mark((function e(t,r,i){var a,o,s,l,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(a=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(o=y(a))){e.next=6;break}return e.abrupt("return",{cachedResult:o});case 6:return e.next=8,Object(c.e)();case 8:return s=e.sent,l=s.arcadeUtils,u=l.createSyntaxTree(a),e.abrupt("return",l.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:l.createFunction(u),context:l.createExecContext(null,{sr:r}),modules:s}});case 12:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function p(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var r=t;r._geometry&&(r._geometry=Object(s.b)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function v(e){if(null!=e){if(g(e))return e.cachedResult;var t=e.arcade,r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function b(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e&&e.featureExpressionInfo,i=r&&r.expression;return t||"0"===i||(r=null),r}var m={cachedResult:0};function g(e){return null!=e.cachedResult}function y(e){return"0"===e?0:null}},748:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s}));var i,n=r(542),a=r(580),o=r(538);function s(e){e.include(a.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(Object(o.a)(i||(i=Object(n.a)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}function c(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},749:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r(2),n=r(3),a=r(11),o=r(65),s=r(7),c=r(35),l=r(100),u=r(547),d=r(30),h=r(60),f=r(58),p=r(79),v=r(407),b=r(558),m=r(763),g=r(579),y=r(679),O=r(567),j=a.a.getLogger("esri.views.3d.webgl-engine.lib.Camera"),x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(i.a)(this,e),this._viewUp=Object(p.e)(),this._viewForward=Object(p.e)(),this._viewRight=Object(p.e)(),this._ray=Object(g.c)(),this._viewport=Object(b.g)(0,0,1,1),this._padding=Object(b.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(h.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(u.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(u.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(u.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(u.d)(),this._frustumDirty=!0,this._frustum=Object(m.b)(),this._fullViewport=Object(b.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(s.k)(t)&&Object(f.k)(this._ray.origin,t),this._center=Object(s.k)(r)?Object(p.c)(r):Object(p.e)(),this._up=Object(s.k)(n)?Object(p.c)(n):Object(p.g)(0,0,1)}return Object(n.a)(e,[{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return Object(f.j)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){Object(l.f)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(v.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&(Object(l.n)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;Object(l.l)(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){Object(l.f)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return Object(O.b)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(O.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return Object(O.c)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(O.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return Object(f.m)(this._center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(l.c)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(l.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){Object(f.k)(this._ray.origin,e.eye),Object(f.k)(this._center,e.center),Object(f.k)(this._up,e.up),Object(v.c)(this._viewport,e.viewport),Object(v.c)(this._padding,e.padding),Object(d.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(l.f)(this._viewMatrix,e.viewMatrix),Object(f.k)(this._viewRight,e.viewRight),Object(f.k)(this._viewUp,e.viewUp),Object(f.k)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(l.f)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(m.a)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(l.f)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return Object(f.o)(this.eye,e.eye)&&Object(f.o)(this._center,e.center)&&Object(f.o)(this._up,e.up)&&Object(v.g)(this._viewport,e.viewport)&&Object(v.g)(this._padding,e.padding)&&Object(d.k)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;Object(f.A)(w,e.eye,e.center),Object(f.A)(C,this.eye,this._center);var r=Object(f.h)(w,C),i=Object(f.B)(w),n=Object(f.B)(C);return r*r>=(1-1e-10)*i*n&&Object(f.C)(e.eye,this.eye)<Math.max(i,n)*t*t&&Object(v.i)(e.padding,this._padding)<.5&&Object(v.i)(e.viewport,this._viewport)<.5}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"viewDirectionDistance",value:function(e){return Math.abs(Object(y.d)(this.viewForward,Object(f.j)(w,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.f)();return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}},{key:"applyProjection",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==_&&Object(f.k)(_,e),_[3]=1,r&&(t[2]=-_[2]),Object(v.m)(_,_,this.projectionMatrix),Object(f.e)(_,_,1/Math.abs(_[3]));var i=this.fullViewport;return t[0]=Object(o.j)(0,i[0]+i[2],.5+.5*_[0]),t[1]=Object(o.j)(0,i[1]+i[3],.5+.5*_[1]),r||(t[2]=.5*(_[2]+1)),t}},{key:"projectToScreen",value:function(e,t){this.projectToRenderScreen(e,k),this.renderToScreen(k,t)}},{key:"projectToRenderScreen",value:function(e,t){if(_[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=1,Object(v.m)(_,_,this.viewProjectionMatrix),0===_[3])return null;Object(f.e)(_,_,1/Math.abs(_[3]));var r=this.fullViewport;return"x"in t?(t.x=Object(o.j)(0,r[0]+r[2],.5+.5*_[0]),t.y=Object(o.j)(0,r[1]+r[3],.5+.5*_[1])):(t[0]=Object(o.j)(0,r[0]+r[2],.5+.5*_[0]),t[1]=Object(o.j)(0,r[1]+r[3],.5+.5*_[1]),t.length>2&&(t[2]=.5*(_[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,k),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if(Object(l.n)(S,this.projectionMatrix,this.viewMatrix),!Object(l.c)(S,S))return null;var r=this.fullViewport;return _[0]=2*(e[0]-r[0])/r[2]-1,_[1]=2*(e[1]-r[1])/r[3]-1,_[2]=2*e[2]-1,_[3]=1,Object(v.m)(_,_,S),0===_[3]?null:(t[0]=_[0]/_[3],t[1]=_[1]/_[3],t[2]=_[2]/_[3],t)}},{key:"constrainWindowSize",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,n=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(n-r/2,0),s=Math.max(this.fullHeight-a-i/2,0),c=-Math.min(n-r/2,0),l=-Math.min(this.fullHeight-a-i/2,0);return[o,s,r-c- -Math.min(this.fullWidth-n-r/2,0),i-l- -Math.min(a-i/2,0)]}},{key:"computeUp",value:function(e){1===e?this.computeUpGlobal():this.computeUpLocal()}},{key:"screenToRender",value:function(e,t){var r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}},{key:"renderToScreen",value:function(e,t){var r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}},{key:"computeUpGlobal",value:function(){Object(f.j)(w,this.center,this.eye);var e=Object(f.p)(this.center);e<1?(Object(f.w)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(f.h)(w,this.center))>.9999*Object(f.p)(w)*e||(Object(f.g)(this._up,w,this.center),Object(f.g)(this._up,this._up,w),Object(f.r)(this._up,this._up),this._markViewDirty())}},{key:"computeUpLocal",value:function(){Object(f.v)(w,this.eye,this.center),Math.abs(w[2])<=.9999&&(Object(f.e)(w,w,w[2]),Object(f.w)(this._up,-w[0],-w[1],1-w[2]),Object(f.r)(this._up,this._up),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(f.o)(e,t)||(Object(f.k)(t,e),this._markViewDirty()):j.warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&(Object(m.c)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&(Object(l.m)(this._viewMatrix,this.eye,this._center,this._up),Object(f.w)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(f.w)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(f.w)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),_=Object(b.e)(),S=Object(u.d)(),w=Object(p.e)(),C=Object(p.e)(),k=Object(c.d)()},750:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return A})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return T})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return S})),r.d(t,"h",(function(){return M})),r.d(t,"i",(function(){return D})),r.d(t,"j",(function(){return j}));var i=r(13),n=r(2),a=(r(12),r(11)),o=r(65),s=r(641),c=r(100),l=r(547),u=r(58),d=r(79),h=r(663),f=r(597),p=r(579),v=r(679),b=r(570),m=a.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G;return{plane:Object(f.d)(e.plane),origin:Object(d.c)(e.origin),basis1:Object(d.c)(e.basis1),basis2:Object(d.c)(e.basis2)}}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g();return O(e.origin,e.basis1,e.basis2,t)}function O(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g();return Object(u.k)(i.origin,e),Object(u.k)(i.basis1,t),Object(u.k)(i.basis2,r),j(i),F(i,"fromValues()"),i}function j(e){Object(f.i)(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,r){e!==r&&y(e,r);var i=Object(u.e)(b.d.get(),M(e),t);return Object(u.f)(r.origin,r.origin,i),r.plane[3]-=t,r}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g(),r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return Object(u.w)(t.origin,e[0]+r,e[1]+i,0),Object(u.w)(t.basis1,r,0,0),Object(u.w)(t.basis2,0,i,0),Object(f.h)(0,0,1,0,t.plane),t}function S(e,t,r){return!!Object(f.m)(e.plane,t,r)&&I(e,r)}function w(e,t,r){var n=U.get();V(e,t,n,U.get());var a,s=Number.POSITIVE_INFINITY,c=Object(i.a)(q);try{for(c.s();!(a=c.n()).done;){var l=z(e,a.value,B.get()),d=b.d.get();if(Object(f.k)(n,l,d)){var h=Object(u.v)(b.d.get(),t.origin,d),p=Math.abs(Object(o.a)(Object(u.h)(t.direction,h)));p<s&&(s=p,Object(u.k)(r,d))}}}catch(v){c.e(v)}finally{c.f()}return s===Number.POSITIVE_INFINITY?C(e,t,r):r}function C(e,t,r){if(S(e,t,r))return r;var n=U.get(),a=U.get();V(e,t,n,a);var o,s=Number.POSITIVE_INFINITY,c=Object(i.a)(q);try{for(c.s();!(o=c.n()).done;){var l=z(e,o.value,B.get()),d=b.d.get();if(Object(f.l)(n,l,d)){var h=Object(p.d)(t,d);if(!Object(f.o)(a,d))continue;h<s&&(s=h,Object(u.k)(r,d))}}}catch(v){c.e(v)}finally{c.f()}return E(e,t.origin)<s&&k(e,t.origin,r),r}function k(e,t,r){var i=Object(f.r)(e.plane,t,b.d.get()),n=Object(h.i)(L(e,e.basis1),i,-1,1,b.d.get()),a=Object(h.i)(L(e,e.basis2),i,-1,1,b.d.get());return Object(u.j)(r,Object(u.f)(b.d.get(),n,a),e.origin),r}function P(e,t,r){var i=e.origin,n=e.basis1,a=e.basis2,o=Object(u.j)(b.d.get(),t,i),s=Object(v.d)(n,o),c=Object(v.d)(a,o),l=Object(v.d)(M(e),o);return Object(u.w)(r,s,c,l)}function E(e,t){var r=P(e,t,b.d.get()),i=e.basis1,n=e.basis2,a=Object(u.p)(i),o=Object(u.p)(n),s=Math.max(Math.abs(r[0])-a,0),c=Math.max(Math.abs(r[1])-o,0),l=r[2];return s*s+c*c+l*l}function T(e,t){return Math.sqrt(E(e,t))}function A(e,t){return Object(f.o)(e.plane,t)&&I(e,t)}function R(e,t){var r=-e.plane[3];return Object(v.d)(M(e),t)-r}function D(e,t,r,i){return e!==i&&y(e,i),Object(c.e)(Y,Object(c.j)(Y),t,r),Object(u.q)(i.basis1,e.basis1,Y),Object(u.q)(i.basis2,e.basis2,Y),j(i),i}function M(e){return Object(f.q)(e.plane)}function I(e,t){var r=Object(u.j)(b.d.get(),t,e.origin),i=Object(u.t)(e.basis1),n=Object(u.t)(e.basis2),a=Object(u.h)(e.basis1,r),o=Object(u.h)(e.basis2,r);return-a-i<0&&a-i<0&&-o-n<0&&o-n<0}function L(e,t){var r=B.get();return Object(u.k)(r.origin,e.origin),Object(u.k)(r.vector,t),r}function z(e,t,r){var i=e.basis1,n=e.basis2,a=e.origin,o=Object(u.e)(b.d.get(),i,t.origin[0]),s=Object(u.e)(b.d.get(),n,t.origin[1]);Object(u.f)(r.origin,o,s),Object(u.f)(r.origin,r.origin,a);var c=Object(u.e)(b.d.get(),i,t.direction[0]),l=Object(u.e)(b.d.get(),n,t.direction[1]);return Object(u.e)(r.vector,Object(u.f)(c,c,l),2),r}function F(e,t){Math.abs(Object(u.h)(e.basis1,e.basis2)/(Object(u.p)(e.basis1)*Object(u.p)(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(u.h)(e.basis1,M(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(u.h)(M(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}function V(e,t,r,i){var n=M(e);Object(f.i)(n,t.direction,t.origin,r),Object(f.i)(Object(f.q)(r),n,t.origin,i)}var G={plane:Object(f.d)(),origin:Object(d.g)(0,0,0),basis1:Object(d.g)(1,0,0),basis2:Object(d.g)(0,1,0)},U=new s.a(f.d),B=new s.a(h.d),N=Object(d.e)(),H=new s.a((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),q=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],W=Object(l.d)(),Y=Object(l.d)();Object.freeze({__proto__:null,BoundedPlaneClass:function e(){Object(n.a)(this,e),this.plane=Object(f.d)(),this.origin=Object(d.e)(),this.basis1=Object(d.e)(),this.basis2=Object(d.e)()},create:g,wrap:function(e,t,r){var i=H.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Object(f.u)(0,0,0,0),j(i),i},copy:y,copyWithoutVerify:function(e,t){Object(u.k)(t.origin,e.origin),Object(u.k)(t.basis1,e.basis1),Object(u.k)(t.basis2,e.basis2),Object(f.c)(e.plane,t.plane)},fromValues:O,updateUnboundedPlane:j,elevate:x,setExtent:function(e,t,r){return _(t,r),x(r,R(e,e.origin),r),r},fromAABoundingRect:_,intersectRay:S,intersectRayClosestSilhouette:function(e,t,r){if(S(e,t,r))return r;var i=w(e,t,b.d.get());return Object(u.f)(r,t.origin,Object(u.e)(b.d.get(),t.direction,Object(u.m)(t.origin,i)/Object(u.p)(t.direction))),r},closestPointOnSilhouette:w,closestPoint:C,projectPoint:k,projectPointLocal:P,distance2:E,distance:T,distanceToSilhouette:function(e,t){var r,n=Number.NEGATIVE_INFINITY,a=Object(i.a)(q);try{for(a.s();!(r=a.n()).done;){var o=z(e,r.value,B.get()),s=Object(h.e)(o,t);s>n&&(n=s)}}catch(c){a.e(c)}finally{a.f()}return Math.sqrt(n)},extrusionContainsPoint:A,axisAt:function(e,t,r,i){return function(e,t,r){switch(t){case 0:Object(u.k)(r,e.basis1),Object(u.r)(r,r);break;case 1:Object(u.k)(r,e.basis2),Object(u.r)(r,r);break;case 2:Object(u.k)(r,M(e))}return r}(e,r,i)},altitudeAt:R,setAltitudeAt:function(e,t,r,i){var n=R(e,t),a=Object(u.e)(N,M(e),r-n);return Object(u.f)(i,t,a),i},equals:function(e,t){return Object(u.o)(e.basis1,t.basis1)&&Object(u.o)(e.basis2,t.basis2)&&Object(u.o)(e.origin,t.origin)},transform:function(e,t,r){return e!==r&&y(e,r),Object(c.c)(W,t),Object(c.b)(W,W),Object(u.q)(r.basis1,e.basis1,W),Object(u.q)(r.basis2,e.basis2,W),Object(u.q)(Object(f.q)(r.plane),Object(f.q)(e.plane),W),Object(u.q)(r.origin,e.origin,t),Object(f.s)(r.plane,r.origin,r.plane),r},rotate:D,normal:M,UP:G})},755:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var i=r(10),n=r(2),a=r(3),o=r(5),s=r(6),c=r(681),l=r(625),u=r(613),d=r(729),h=r(620),f=r(0),p=r(557),v=r(575),b=r(568),m=r(642),g=r(609),y=r(618),O=r(624),j=r(619),x=r(610),_=r(701),S=r(822),w=r(544),C=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new x.a(e.rctx,n,j.a)}},{key:"bindPass",value:function(e,t){Object(m.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(v.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(b.a)(this.program,t))}},{key:"bindDraw",value:function(e){Object(m.d)(this.program,e),this.program.rebindTextures(),Object(p.c)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e,t){var r=this.configuration,i=3===e,n=2===e;return Object(w.f)({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?u.g:Object(u.a)(e),culling:Object(w.b)(r.cullFace),depthTest:{func:Object(u.b)(e)},depthWrite:i||n?r.writeDepth&&w.d:null,colorWrite:w.c,stencilWrite:r.sceneHasOcludees?_.h:null,stencilTest:r.sceneHasOcludees?t?_.d:_.c:null,polygonOffset:i||n?r.polygonOffset&&k:Object(u.h)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),r}(y.a);C.shader=new g.a(S.a,(function(){return r.e(201).then(r.bind(null,1109))}));var k={factor:1,units:1},P=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(O.a);Object(f.a)([Object(O.b)({count:8})],P.prototype,"output",void 0),Object(f.a)([Object(O.b)({count:3})],P.prototype,"cullFace",void 0),Object(f.a)([Object(O.b)()],P.prototype,"slicePlaneEnabled",void 0),Object(f.a)([Object(O.b)()],P.prototype,"vertexColors",void 0),Object(f.a)([Object(O.b)()],P.prototype,"transparent",void 0),Object(f.a)([Object(O.b)()],P.prototype,"polygonOffset",void 0),Object(f.a)([Object(O.b)()],P.prototype,"enableOffset",void 0),Object(f.a)([Object(O.b)()],P.prototype,"writeDepth",void 0),Object(f.a)([Object(O.b)()],P.prototype,"sceneHasOcludees",void 0),Object(f.a)([Object(O.b)({count:4})],P.prototype,"transparencyPassType",void 0),Object(f.a)([Object(O.b)()],P.prototype,"multipassTerrainEnabled",void 0),Object(f.a)([Object(O.b)()],P.prototype,"cullAboveGround",void 0);var E=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e,A)).supportsEdges=!0,i.techniqueConfig=new P,i}return Object(a.a)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<u.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,r,i,n,a,o){Object(h.f)(e,t,i,n,a,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new T(e):void 0}},{key:"createBufferWriter",value:function(){return new d.a(d.b)}}]),r}(l.a),T=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(C,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),r}(c.a),A=Object(i.a)({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1},l.b)},756:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(13),n=r(2),a=r(3),o=r(21),s=function(){function e(){Object(n.a)(this,e),this._tasks=new Array}return Object(a.a)(e,[{key:"length",get:function(){return this._tasks.length}},{key:"push",value:function(e,t,r){var i=this;return new Promise((function(n,a){return i._tasks.push(new c(n,a,e,t,r))}))}},{key:"unshift",value:function(e,t,r){var i=this;return new Promise((function(n,a){return i._tasks.unshift(new c(n,a,e,t,r))}))}},{key:"process",value:function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=Object(o.n)(e.signal);if(t&&!e.abortCallback)e.reject(Object(o.e)());else{var r=t?e.abortCallback(Object(o.e)()):e.callback();Object(o.o)(r)?r.then(e.resolve,e.reject):e.resolve(r)}}catch(c){e.reject(c)}return!0}},{key:"cancelAll",value:function(){var e,t=Object(o.e)(),r=Object(i.a)(this._tasks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.abortCallback){var a=n.abortCallback(t);n.resolve(a)}else n.reject(t)}}catch(s){r.e(s)}finally{r.f()}this._tasks.length=0}}]),e}(),c=function e(t,r,i,a,o){Object(n.a)(this,e),this.resolve=t,this.reject=r,this.callback=i,this.signal=a,this.abortCallback=o}},757:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(65);function n(e,t,r){var n,l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t),d=new Uint32Array(l),h=null!=(n=null==r?void 0:r.minReduction)?n:0,f=(null==r?void 0:r.originalIndices)||null,p=f?f.length:0,v=(null==r?void 0:r.componentOffsets)||null,b=0;if(v)for(var m=0;m<v.length-1;m++){var g=v[m+1]-v[m];g>b&&(b=g)}else b=l;var y=Math.floor(1.1*b)+1;(null==c||c.length<2*y)&&(c=new Uint32Array(Object(i.l)(2*y)));for(var O=0;O<2*y;O++)c[O]=0;for(var j=0,x=!!v&&!!f,_=x?p:l,S=x?new Uint32Array(p):null,w=1.96,C=0!==h?Math.ceil(4*w*w/(h*h)*h*(1-h)):_,k=1,P=v?v[1]:_,E=0;E<_;E++){if(E===C){var T=1-j/E;if(T+w*Math.sqrt(T*(1-T)/E)<h)return null;C*=2}if(E===P){for(var A=0;A<2*y;A++)c[A]=0;if(f)for(var R=v[k-1];R<v[k];R++)S[R]=d[f[R]];P=v[++k]}for(var D=x?f[E]:E,M=D*t,I=s(u,M,t),L=I%y,z=j;0!==c[2*L+1];){if(c[2*L]===I){var F=c[2*L+1]-1;if(a(u,M,F*t,t)){z=d[F];break}}++L>=y&&(L-=y)}z===j&&(c[2*L]=I,c[2*L+1]=D+1,j++),d[D]=z}if(0!==h&&1-j/l<h)return null;if(x){for(var V=v[k-1];V<S.length;V++)S[V]=d[f[V]];d=S}var G=new Uint32Array(t*j);j=0;for(var U=0;U<_;U++)d[U]===j&&(o(u,(x?f[U]:U)*t,G,j*t,t),j++);if(f&&!x){for(var B=new Uint32Array(p),N=0;N<B.length;N++)B[N]=d[f[N]];d=B}return{buffer:G.buffer,indices:d,uniqueCount:j}}function a(e,t,r,i){for(var n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function o(e,t,r,i,n){for(var a=0;a<n;a++)r[i+a]=e[t+a]}function s(e,t,r){for(var i=0,n=0;n<r;n++)i=(i=e[t+n]+i|0)+(i<<11)+(i>>>2)|0;return i>>>0}var c=null},762:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(2),n=r(5),a=r(6),o=r(0),s=r(29),c=r(1),l=(r(12),r(15),r(11),r(8)),u=function(e){Object(n.a)(r,e);var t=Object(a.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).SCHEDULER_LOG_SLOW_TASKS=!1,e.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1,e}return r}(s.a);Object(o.a)([Object(c.b)()],u.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);var d=new(u=Object(o.a)([Object(l.a)("esri.views.support.DebugFlags")],u))},763:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return b}));var i=r(641),n=r(100),a=r(58),o=r(79),s=r(407),c=r(558),l=r(816),u=r(597),d=r(570);function h(e){return e?[Object(u.d)(e[0]),Object(u.d)(e[1]),Object(u.d)(e[2]),Object(u.d)(e[3]),Object(u.d)(e[4]),Object(u.d)(e[5])]:[Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)()]}function f(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h(),r=0;r<6;r++)Object(u.c)(e[r],t[r])}function p(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y,o=Object(n.n)(d.a.get(),t,e);Object(n.c)(o,o);for(var c=0;c<8;++c){var l=Object(s.m)(d.e.get(),g[c],o);Object(a.w)(i[c],l[0]/l[3],l[1]/l[3],l[2]/l[3])}v(r,i)}function v(e,t){Object(u.f)(t[4],t[0],t[3],e[0]),Object(u.f)(t[1],t[5],t[6],e[1]),Object(u.f)(t[4],t[5],t[1],e[2]),Object(u.f)(t[3],t[2],t[6],e[3]),Object(u.f)(t[0],t[1],t[2],e[4]),Object(u.f)(t[5],t[4],t[7],e[5])}function b(e,t){for(var r=0;r<6;r++){var i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function m(e,t){for(var r=0;r<6;r++){var i=e[r];if(!Object(u.b)(i,t))return!1}return!0}var g=[Object(c.g)(-1,-1,-1,1),Object(c.g)(1,-1,-1,1),Object(c.g)(1,1,-1,1),Object(c.g)(-1,1,-1,1),Object(c.g)(-1,-1,1,1),Object(c.g)(1,-1,1,1),Object(c.g)(1,1,1,1),Object(c.g)(-1,1,1,1)],y=(new i.a(l.a),[Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)()])},764:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i,n,a,o,s,c,l=r(542),u=r(687),d=r(715),h=r(538);function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){e.fragment.include(d.a);var r=t.draped&&u.a.ENABLE_CONTINUOUS_LINE_PATTERNS;r?e.vertex.uniforms.add("worldToScreenRatio","float"):e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),r&&e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),r?e.fragment.code.add(Object(h.a)(i||(i=Object(l.a)(["float getStippleValue() {\nreturn rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUv * stipplePatternPixelSizeInv, 1.0), 0.5)));\n}"])))):e.fragment.code.add(Object(h.a)(n||(n=Object(l.a)(["\n      float getStippleValue() {\n        float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n        ","\n        return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)));\n      }\n    "])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),e.fragment.code.add(Object(h.a)(a||(a=Object(l.a)(["float getStippleSDF() {\nreturn (getStippleValue() * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n}\nfloat getStippleAlpha() {\nreturn clamp(getStippleSDF() + 0.5, 0.0, 1.0);\n}"])))),t.stippleOffColorEnabled?e.fragment.code.add(Object(h.a)(o||(o=Object(l.a)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"])))):e.fragment.code.add(Object(h.a)(s||(s=Object(l.a)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add(Object(h.a)(c||(c=Object(l.a)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}},765:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return s}));var i=r(2),n=r(7),a=r(820),o=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),this.array=t,this.spatialReference=r,this.offset=n};function s(e){return"array"in e}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if(Object(a.a)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(s(t)){var i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,Object(n.t)(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},766:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n=r(542),a=r(538);function o(e){e.vertex.code.add(Object(a.a)(i||(i=Object(n.a)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},767:function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var i,n,a,o,s,c,l,u,d,h,f,p,v=r(542),b=r(557),m=r(607),g=r(709),y=r(704),O=r(774),j=r(695),x=r(575),_=r(655),S=r(578),w=r(538);function C(e,t){var r=e.vertex.code,C=e.fragment.code;1!==t.output&&3!==t.output||(e.include(m.a,{linearDepth:!0}),e.include(y.a,t),e.include(_.a,t),e.include(j.a,t),e.include(b.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(Object(w.a)(i||(i=Object(v.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\nforwardTextureCoordinates();\n}"])))),e.include(S.a,t),C.add(Object(w.a)(n||(n=Object(v.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?Object(w.a)(a||(a=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(m.a,{linearDepth:!1}),e.include(g.a,t),e.include(O.a,t),e.include(y.a,t),e.include(_.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),r.add(Object(w.a)(o||(o=Object(v.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?Object(w.a)(s||(s=Object(v.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(b.a,t),e.include(S.a,t),C.add(Object(w.a)(c||(c=Object(v.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?Object(w.a)(l||(l=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?Object(w.a)(u||(u=Object(v.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):Object(w.a)(d||(d=Object(v.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(m.a,{linearDepth:!1}),e.include(y.a,t),e.include(_.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(Object(w.a)(h||(h=Object(v.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPosition(proj, view, vpos);\nforwardTextureCoordinates();\n}"])))),e.include(b.a,t),e.include(S.a,t),e.include(x.a),C.add(Object(w.a)(f||(f=Object(v.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?Object(w.a)(p||(p=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},768:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n=r(542),a=r(621),o=r(538);function s(e){e.include(a.a),e.code.add(Object(o.a)(i||(i=Object(n.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),o.a.int(1),o.a.int(2),o.a.int(3),o.a.int(2),o.a.int(3)))}},772:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(13),n=r(2),a=r(3),o=r(5),s=r(6),c=r(67),l=r(68),u=r(7),d=r(212),h=r(745),f=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"],p=r(865),v=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i,a,o,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(n.a)(this,r),(i=t.call(this)).apiLayerUid=u,i.type=0,i.events=new c.a,i.isSliceable=!1,i._objects=new d.a,i._stageHandles=new l.a,i.apiLayerUid=u,i.isVisible=null==(a=null==e?void 0:e.isVisible)||a,i.isPickable=null==(o=null==e?void 0:e.isPickable)||o,i.updatePolicy=null!=(s=null==e?void 0:e.updatePolicy)?s:0,i}return Object(a.a)(r,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var r,n=Object(i.a)(f);try{var a=function(){var i=r.value;t._stageHandles.add(t.events.on(i,(function(t){return e.handleEvent(i,t)})))};for(n.s();!(r=n.n()).done;)a()}catch(o){n.e(o)}finally{n.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(u.k)(this._octree)&&this._octree.add([e])}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(u.k)(this._octree)&&this._octree.remove([e]))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){t.value.parentLayer=this}}catch(n){r.e(n)}finally{r.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(u.k)(this._octree)&&this._octree.add(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var r,n=Object(i.a)(t);try{for(n.s();!(r=n.n()).done;){r.value.parentLayer=null}}catch(a){n.e(a)}finally{n.f()}this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(u.k)(this._octree)&&this._octree.remove(t)}}},{key:"sync",value:function(){Object(u.k)(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){Object(u.k)(this._octree)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return Object(u.j)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=Object(u.e)(this._octree)}},{key:"_createOctree",value:function(){this._octree=new p.a((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)}}]),r}(h.a)},773:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i,n,a,o=r(542),s=r(538);function c(e){e.vertex.code.add(Object(s.a)(i||(i=Object(o.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),s.a.int(1),s.a.int(3),s.a.int(4),s.a.int(1)))}function l(e,t){t.symbolColor?(e.include(c),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(Object(s.a)(n||(n=Object(o.a)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"])))):e.vertex.code.add(Object(s.a)(a||(a=Object(o.a)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"]))))}},774:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i,n,a,o,s,c,l,u=r(542),d=r(709),h=r(2),f=r(563),p=r(547),v=r(79),b=r(716),m=r(735),g=r(538);function y(e,t){e.include(b.a),e.vertex.include(m.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(Object(g.a)(i||(i=Object(u.a)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\nuTransform_WorldFromModel_TL,\nuTransform_WorldFromModel_TH,\n-uTransform_WorldFromView_TL,\n-uTransform_WorldFromView_TH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}\nvec3 position_view() {\nreturn uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n}\nvoid forwardPosition() {\nvPositionWorldCameraRelative = positionWorldCameraRelative();\nvPosition_view = position_view();\ngl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n}\nvec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(Object(g.a)(n||(n=Object(u.a)(["vec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"]))))}function O(e,t){0===t.normalType||1===t.normalType?(e.include(d.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(Object(g.a)(a||(a=Object(u.a)(["void forwardNormal() {\nvNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\nvNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n}"]))))):2===t.normalType?(e.include(y,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(g.a)(o||(o=Object(u.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?Object(g.a)(s||(s=Object(u.a)(["normalize(vPositionWorldCameraRelative);"]))):Object(g.a)(c||(c=Object(u.a)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(Object(g.a)(l||(l=Object(u.a)(["void forwardNormal() {}"]))))}!function(e){e.ModelTransform=function e(){Object(h.a)(this,e),this.worldFromModel_RS=Object(f.b)(),this.worldFromModel_TH=Object(v.e)(),this.worldFromModel_TL=Object(v.e)()};e.ViewProjectionTransform=function e(){Object(h.a)(this,e),this.worldFromView_TH=Object(v.e)(),this.worldFromView_TL=Object(v.e)(),this.viewFromCameraRelative_RS=Object(f.b)(),this.projFromView=Object(p.d)()},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(y||(y={})),(O||(O={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},783:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i,n=r(2),a=r(3),o=r(5),s=r(6),c=r(0),l=(r(12),r(20)),u=r(1),d=r(15),h=(r(11),r(28)),f=r(8),p=r(27),v=r(86),b=r(433),m=new WeakMap,g=0,y=i=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).wrap="repeat",i}return Object(a.a)(r,[{key:"url",get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)}},{key:"writeData",value:function(e,t,r,i){if(e instanceof HTMLImageElement){var n={type:"image-element",src:Object(v.e)(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){var a=e.getContext("2d").getImageData(0,0,e.width,e.height),o={type:"canvas-element",imageData:this.encodeImageData(a)};t[r]=o}else if(e instanceof HTMLVideoElement){var s={type:"video-element",src:Object(v.e)(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else{var c={type:"image-data",imageData:this.encodeImageData(e)};t[r]=c}}},{key:"readData",value:function(e){switch(e.type){case"image-element":var t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t;case"canvas-element":var r=this.decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=r.width,i.height=r.height,i.getContext("2d").putImageData(r,0,0),i;case"image-data":return this.decodeImageData(e.imageData);case"video-element":var n=document.createElement("video");return n.src=e.src,n.crossOrigin=e.crossOrigin,n.autoplay=e.autoplay,n.loop=e.loop,n.muted=e.muted,n.preload=e.preload,n;default:return}}},{key:"transparent",get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===i)return!0}return!1},set:function(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}},{key:"contentHash",get:function(){var e=this,t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?"".concat(this.wrap.horizontal,"/").concat(this.wrap.vertical):"",r=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"d:".concat(r,",t:").concat(e.transparent,",w:").concat(t)};return null!=this.url?r(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(m.has(this.data)||m.set(this.data,++g),r(m.get(this.data))):r()}},{key:"clone",value:function(){var e={url:this.url,data:this.data,wrap:this.cloneWrap()};return new i(e)}},{key:"cloneWithDeduplication",value:function(e){var t=e.get(this);if(t)return t;var r=this.clone();return e.set(this,r),r}},{key:"cloneWrap",value:function(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}},{key:"encodeImageData",value:function(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}},{key:"decodeImageData",value:function(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return Object(b.f)(r,e.width,e.height)}},{key:"imageDataContainsTransparent",value:function(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}}],[{key:"from",value:function(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):Object(d.d)(i,e)}}]),r}(l.a);Object(c.a)([Object(u.b)({type:String,json:{write:v.f}})],y.prototype,"url",null),Object(c.a)([Object(u.b)({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),Object(u.b)()],y.prototype,"data",null),Object(c.a)([Object(p.a)("data")],y.prototype,"writeData",null),Object(c.a)([Object(h.a)("data")],y.prototype,"readData",null),Object(c.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],y.prototype,"transparent",null),Object(c.a)([Object(u.b)({json:{write:!0}})],y.prototype,"wrap",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],y.prototype,"contentHash",null);var O=y=i=Object(c.a)([Object(f.a)("esri.geometry.support.MeshTexture")],y)},784:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var i,n=r(10),a=r(2),o=r(3),s=r(41),c=r(38),l=r(5),u=r(6),d=r(0),h=r(40),f=r(7),p=r(1),v=(r(12),r(15),r(11),r(8)),b=r(814),m=r(783),g=i=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(e){var i;return Object(a.a)(this,r),(i=t.call(this,e)).emissiveColor=null,i.emissiveTexture=null,i.occlusionTexture=null,i.metallic=1,i.roughness=1,i.metallicRoughnessTexture=null,i}return Object(o.a)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=Object(f.k)(e)?e.get(this):null;if(r)return r;var n=new i(this.clonePropertiesWithDeduplication(t));return Object(f.k)(e)&&e.set(this,n),n}},{key:"clonePropertiesWithDeduplication",value:function(e){return Object(n.a)(Object(n.a)({},Object(s.a)(Object(c.a)(r.prototype),"clonePropertiesWithDeduplication",this).call(this,e)),{},{emissiveColor:Object(f.k)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:Object(f.k)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:Object(f.k)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:Object(f.k)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}}]),r}(b.a);Object(d.a)([Object(p.b)({type:h.a,json:{write:!0}})],g.prototype,"emissiveColor",void 0),Object(d.a)([Object(p.b)({type:m.a,json:{write:!0}})],g.prototype,"emissiveTexture",void 0),Object(d.a)([Object(p.b)({type:m.a,json:{write:!0}})],g.prototype,"occlusionTexture",void 0),Object(d.a)([Object(p.b)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"metallic",void 0),Object(d.a)([Object(p.b)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"roughness",void 0),Object(d.a)([Object(p.b)({type:m.a,json:{write:!0}})],g.prototype,"metallicRoughnessTexture",void 0);var y=g=i=Object(d.a)([Object(v.a)("esri.geometry.support.MeshMaterialMetallicRoughness")],g)},785:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return j}));var i,n=r(13),a=r(2),o=r(3),s=r(5),c=r(6),l=r(0),u=r(20),d=r(19),h=r(11),f=r(1),p=r(43),v=(r(12),r(8)),b=h.a.getLogger("esri.geometry.support.MeshVertexAttributes"),m=i=function(e){Object(s.a)(r,e);var t=Object(c.a)(r);function r(e){var i;return Object(a.a)(this,r),(i=t.call(this,e)).color=null,i.position=new Float64Array(0),i.uv=null,i.normal=null,i.tangent=null,i}return Object(o.a)(r,[{key:"castColor",value:function(e){return y(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},b)}},{key:"castPosition",value:function(e){return e&&e instanceof Float32Array&&b.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),y(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},b)}},{key:"castUv",value:function(e){return y(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},b)}},{key:"castNormal",value:function(e){return y(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},b)}},{key:"castTangent",value:function(e){return y(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},b)}},{key:"clone",value:function(){var e={position:Object(d.a)(this.position),uv:Object(d.a)(this.uv),normal:Object(d.a)(this.normal),tangent:Object(d.a)(this.tangent),color:Object(d.a)(this.color)};return new i(e)}},{key:"clonePositional",value:function(){var e={position:Object(d.a)(this.position),normal:Object(d.a)(this.normal),tangent:Object(d.a)(this.tangent),uv:this.uv,color:this.color};return new i(e)}}]),r}(u.a);function g(e,t,r,i){var n=t.loggerTag,a=t.stride;return e.length%a!=0?(i.error(n,"Invalid array length, expected a multiple of ".concat(a)),new r([])):e}function y(e,t,r,i,a){if(!e)return e;if(e instanceof t)return g(e,i,t,a);var o,s=Object(n.a)(r);try{for(s.s();!(o=s.n()).done;){if(e instanceof o.value)return g(new t(e),i,t,a)}}catch(l){s.e(l)}finally{s.f()}if(Array.isArray(e))return g(new t(e),i,t,a);var c=r.map((function(e){return"'".concat(e.name,"'")}));return a.error("Failed to set property, expected one of ".concat(c,", but got ").concat(e.constructor.name)),new t([])}function O(e,t,r){t[r]=function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}(e)}Object(l.a)([Object(f.b)({json:{write:O}})],m.prototype,"color",void 0),Object(l.a)([Object(p.a)("color")],m.prototype,"castColor",null),Object(l.a)([Object(f.b)({nonNullable:!0,json:{write:O}})],m.prototype,"position",void 0),Object(l.a)([Object(p.a)("position")],m.prototype,"castPosition",null),Object(l.a)([Object(f.b)({json:{write:O}})],m.prototype,"uv",void 0),Object(l.a)([Object(p.a)("uv")],m.prototype,"castUv",null),Object(l.a)([Object(f.b)({json:{write:O}})],m.prototype,"normal",void 0),Object(l.a)([Object(p.a)("normal")],m.prototype,"castNormal",null),Object(l.a)([Object(f.b)({json:{write:O}})],m.prototype,"tangent",void 0),Object(l.a)([Object(p.a)("tangent")],m.prototype,"castTangent",null);var j=m=i=Object(l.a)([Object(v.a)("esri.geometry.support.MeshVertexAttributes")],m)},786:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s}));var i=r(13),n=r(617),a=r(177),o=r(757);function s(e){var t,r=c(e.rings,e.hasZ,1),a=[],s=0,l=0,u=Object(i.a)(r.polygons);try{var d=function(){var e=t.value,i=e.count,o=e.index,c=new Float64Array(r.position.buffer,3*o*r.position.BYTES_PER_ELEMENT,3*i),u=e.holeIndices.map((function(e){return e-o})),d=new Uint32Array(Object(n.a)(c,u,3));a.push({position:c,faces:d}),s+=c.length,l+=d.length};for(u.s();!(t=u.n()).done;)d()}catch(p){u.e(p)}finally{u.f()}var h=function(e,t,r){if(1===e.length)return e[0];var n,a=new Float64Array(t),o=new Uint32Array(r),s=0,c=0,l=0,u=Object(i.a)(e);try{for(u.s();!(n=u.n()).done;){for(var d=n.value,h=0;h<d.position.length;h++)a[s++]=d.position[h];for(var f=0;f<d.faces.length;f++)o[c++]=d.faces[f]+l;l=s/3}}catch(p){u.e(p)}finally{u.f()}return{position:a,faces:o}}(a,s,l),f=Object(o.a)(h.position.buffer,6,{originalIndices:h.faces});return h.position=new Float64Array(f.buffer),h.faces=f.indices,h}function c(e,t,r){for(var i=e.length,n=new Array(i),a=new Array(i),o=new Array(i),s=0,c=0,d=0,h=0,f=0;f<i;++f)h+=e[f].length;for(var p=new Float64Array(3*h),v=0,b=i-1;b>=0;b--){var m=e[b],g=1===r&&u(m);if(g&&1!==i)n[s++]=m;else{for(var y=m.length,O=0;O<s;++O)y+=n[O].length;var j={index:v,pathLengths:new Array(s+1),count:y,holeIndices:new Array(s)};j.pathLengths[0]=m.length,m.length>0&&(o[d++]={index:v,count:m.length}),v=g?l(m,m.length-1,-1,p,v,m.length,t):l(m,0,1,p,v,m.length,t);for(var x=0;x<s;++x){var _=n[x];j.holeIndices[x]=v,j.pathLengths[x+1]=_.length,_.length>0&&(o[d++]={index:v,count:_.length}),v=l(_,0,1,p,v,_.length,t)}s=0,j.count>0&&(a[c++]=j)}}for(var S=0;S<s;++S){var w=n[S];w.length>0&&(o[d++]={index:v,count:w.length}),v=l(w,0,1,p,v,w.length,t)}return c<i&&(a.length=c),d<i&&(o.length=d),{position:p,polygons:a,outlines:o}}function l(e,t,r,i,n,a,o){n*=3;for(var s=0;s<a;++s){var c=e[t];i[n++]=c[0],i[n++]=c[1],i[n++]=o?c[2]:0,t+=r}return n/3}function u(e){return!Object(a.g)(e,!1,!1)}},789:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n=r(542),a=r(538);function o(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(Object(a.a)(i||(i=Object(n.a)(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    }\n  "]))))}},790:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(2),n=r(236),a=function e(t){Object(i.a)(this,e),this.channel=t,this.id=Object(n.a)()}},792:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n,a=r(542),o=r(538);function s(e){var t=Object(o.a)(i||(i=Object(a.a)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),r=Object(o.a)(n||(n=Object(a.a)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},793:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));var i=r(2),n=r(3),a=r(100),o=r(547),s=r(58),c=r(79),l=r(407),u=r(558),d=(r(750),r(579)),h=r(665);var f=function(){function e(){Object(i.a)(this,e),this.min=new p,this.max=new p,this.hud=new p,this.ground=new p}return Object(n.a)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),p=function(){function e(t){Object(i.a)(this,e),this.normal=Object(c.e)(),this.transformation=Object(o.d)(),this._ray=Object(d.c)(),this.init(t)}return Object(n.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(s.e)(v,this.ray.direction,this.dist),Object(s.p)(v)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(s.e)(v,this.ray.direction,this.dist),Object(s.f)(e,this.ray.origin,v),!0)}},{key:"getTransformedNormal",value:function(e){return Object(s.k)(b,this.normal),b[3]=0,Object(l.m)(b,b,this.transformation),Object(s.k)(e,b),Object(s.r)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(d.b)(e,this._ray):this._ray=Object(d.c)()}},{key:"set",value:function(e,t,r,i,n,o,l,u,d,f){e instanceof h.a&&(e={type:"stage",obj:e}),this.dist=r,Object(s.k)(this.normal,i),Object(a.f)(this.transformation,n),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=l?Object(c.c)(l):null,this.geometryId=u,this.triangleNr=d,this.drapedLayerGraphicOrder=f}},{key:"copyFrom",value:function(e){Object(d.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(c.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.k)(this.normal,e.normal),Object(a.f)(this.transformation,e.transformation)}}]),e}(),v=(Object(c.e)(),Object(c.e)()),b=Object(u.e)()},794:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c}));var i,n=r(542),a=r(826),o=r(538);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a.b),e.fragment.code.add(Object(o.a)(i||(i=Object(n.a)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}function c(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},795:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i,n,a,o,s=r(542),c=r(538);function l(e,t){1===t.viewingMode?e.vertex.code.add(Object(c.a)(i||(i=Object(s.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add(Object(c.a)(n||(n=Object(s.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),1===t.viewingMode?e.vertex.code.add(Object(c.a)(a||(a=Object(s.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add(Object(c.a)(o||(o=Object(s.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},796:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));r(5),r(6);var i=r(2),n=r(3),a=r(7),o=r(236),s=r(100),c=r(547),l=r(58),u=r(558),d=r(417),h=r(661),f=r(790),p=r(654),v=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Object(o.a)(),l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(i.a)(this,e),this.data=t,this.material=r,this.layerUid=n,this.graphicUid=a,this.id=s,this.boundingInfo=l,this.calculateShaderTransformation=d,this.castShadow=h,this.boundingSphere=Object(u.e)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(c.d)(),this._shaderTransformationDirty=!0}return Object(n.a)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(d.c)(e);Object(a.j)(this.boundingInfo)||(Object(l.q)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*r)}},{key:"hasShaderTransformation",get:function(){return Object(a.k)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return Object(a.j)(this.calculateShaderTransformation)?Object(a.t)(this.transformation,c.a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(c.d)()),Object(s.f)(this._shaderTransformation,this.calculateShaderTransformation(Object(a.t)(this.transformation,c.a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(a.k)(this._transformation)&&Object(l.q)(e,e,this._transformation),!0);var t=this.indices.get("position"),r=this.vertexAttributes.get("position");return!!Object(h.c)(r,t,e)&&(Object(a.k)(this._transformation)&&Object(l.q)(e,e,this._transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new f.a(0),t=this.instanceParameters;return t.highlights=Object(p.b)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=Object(p.g)(t.highlights,e)}}]),e}()},797:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return b}));var i=r(7),n=r(547),a=r(79),o=r(384),s=r(304),c=r(177),l=r(612),u=r(626),d=r(627),h=r(665),f=Object(a.e)();function p(e,t,r,a,c,l,d,p,v,b){var m=r?r.length:0,g=e.clippingExtent;if(Object(o.o)(t,f,e.elevationProvider.spatialReference),Object(i.k)(g)&&!Object(s.e)(g,f))return null;var y=e.renderCoordsHelper.spatialReference;Object(o.o)(t,f,y);for(var O=e.localOriginFactory.getOrigin(f),j=new h.a({castShadow:!1,metadata:{layerUid:p,graphicUid:v,usesVerticalDistanceToGround:!0}}),x=0;x<m;x++){var _=c?c[x]:n.a;j.addGeometry(r[x],a[x],_,l,O,b)}return{object:j,sampledElevation:Object(u.b)(j,t,e.elevationProvider,e.renderCoordsHelper,d)}}function v(e,t,r){var i=e.elevationContext,n=r.spatialReference;Object(o.o)(t,f,n),i.centerPointInElevationSR=Object(l.g)(f[0],f[1],t.hasZ?f[2]:0,n)}function b(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(d.a)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=Object(c.f)(t,Object(c.e)(t)/2);return Object(l.g)(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.origin}return null}function m(e,t,r,i,n){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=Object(u.c)(a,t,0,o,0,a,0,a.length/3,r,i,n),c=null!=s;return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:c,sampledElevation:s}}},798:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i,n,a,o,s=r(542),c=r(538);function l(e,t){var r=e.fragment;r.code.add(Object(c.a)(i||(i=Object(s.a)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),1===t.doubleSidedMode?r.code.add(Object(c.a)(n||(n=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"])))):2===t.doubleSidedMode?r.code.add(Object(c.a)(a||(a=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"])))):r.code.add(Object(c.a)(o||(o=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))))}},805:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(2),n=r(3),a=r(5),o=r(6),s=r(0),c=r(20),l=r(1),u=(r(12),r(15),r(11),r(8)),d=r(73),h=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).geometries=null,n.outSpatialReference=null,n.transformation=null,n.transformForward=null,n}return Object(n.a)(r,[{key:"toJSON",value:function(){var e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:Object(d.c)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}}]),r}(c.a);Object(s.a)([Object(l.b)()],h.prototype,"geometries",void 0),Object(s.a)([Object(l.b)({json:{read:{source:"outSR"}}})],h.prototype,"outSpatialReference",void 0),Object(s.a)([Object(l.b)()],h.prototype,"transformation",void 0),Object(s.a)([Object(l.b)()],h.prototype,"transformForward",void 0);var f=h=Object(s.a)([Object(u.a)("esri.rest.support.ProjectParameters")],h)},811:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(4),n=r.n(i),a=r(9),o=r(550),s=r(552),c=r(683),l=r(546),u=r(551);function d(e){return h.apply(this,arguments)}function h(){return h=Object(a.a)(n.a.mark((function e(t){var r,i,a,d,h,f,p,v,b,m,g,y,O;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",r.width=5,r.height=5,e.next=6,r.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return i=new s.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),a=o.a.createVertex(t,35044,new Uint16Array([0,0,1,0,0,1,1,1])),d=new u.a(t,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:a}),h=new c.a(t,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]])),t.useProgram(h),f=new l.a(t,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},r),t.bindTexture(f,0),h.setUniform1i("u_texture",0),p=t.getBoundFramebufferObject(),v=t.getViewport(),b=v.x,m=v.y,g=v.width,y=v.height,t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.bindVAO(d),t.drawArrays(5,0,4),O=new Uint8Array(4),e.abrupt("return",(i.readPixels(0,0,1,1,6408,5121,O),h.dispose(),d.dispose(!1),a.dispose(),i.dispose(),f.dispose(),t.setViewport(b,m,g,y),t.bindFramebuffer(p),r.src="",255===O[0]));case 16:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}},813:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var i,n=r(2),a=r(3),o=r(5),s=r(6),c=r(0),l=r(20),u=r(19),d=r(11),h=r(1),f=r(43),p=(r(12),r(8)),v=r(15),b=r(814),m=r(784),g=r(785),y=d.a.getLogger("esri.geometry.support.MeshComponent"),O=i=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).faces=null,i.material=null,i.shading="source",i.trustSourceNormals=!1,i}return Object(a.a)(r,[{key:"castFaces",value:function(e){return Object(g.b)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},y)}},{key:"castMaterial",value:function(e){return Object(v.d)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?m.a:b.a,e)}},{key:"clone",value:function(){return new i({faces:Object(u.a)(this.faces),shading:this.shading,material:Object(u.a)(this.material),trustSourceNormals:this.trustSourceNormals})}},{key:"cloneWithDeduplication",value:function(e,t){var r={faces:Object(u.a)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new i(r)}}],[{key:"from",value:function(e){return Object(v.d)(i,e)}}]),r}(l.a);Object(c.a)([Object(h.b)({json:{write:!0}})],O.prototype,"faces",void 0),Object(c.a)([Object(f.a)("faces")],O.prototype,"castFaces",null),Object(c.a)([Object(h.b)({type:b.a,json:{write:!0}})],O.prototype,"material",void 0),Object(c.a)([Object(f.a)("material")],O.prototype,"castMaterial",null),Object(c.a)([Object(h.b)({type:String,json:{write:!0}})],O.prototype,"shading",void 0),Object(c.a)([Object(h.b)({type:Boolean})],O.prototype,"trustSourceNormals",void 0);var j=O=i=Object(c.a)([Object(p.a)("esri.geometry.support.MeshComponent")],O)},814:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i,n=r(2),a=r(3),o=r(5),s=r(6),c=r(0),l=r(40),u=r(20),d=r(7),h=r(1),f=(r(12),r(15),r(11),r(8)),p=r(783),v=i=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).color=null,i.colorTexture=null,i.normalTexture=null,i.alphaMode="auto",i.alphaCutoff=.5,i.doubleSided=!0,i}return Object(a.a)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=Object(d.k)(e)?e.get(this):null;if(r)return r;var n=new i(this.clonePropertiesWithDeduplication(t));return Object(d.k)(e)&&e.set(this,n),n}},{key:"clonePropertiesWithDeduplication",value:function(e){return{color:Object(d.k)(this.color)?this.color.clone():null,colorTexture:Object(d.k)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:Object(d.k)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}}]),r}(u.a);Object(c.a)([Object(h.b)({type:l.a,json:{write:!0}})],v.prototype,"color",void 0),Object(c.a)([Object(h.b)({type:p.a,json:{write:!0}})],v.prototype,"colorTexture",void 0),Object(c.a)([Object(h.b)({type:p.a,json:{write:!0}})],v.prototype,"normalTexture",void 0),Object(c.a)([Object(h.b)({nonNullable:!0,json:{write:!0}})],v.prototype,"alphaMode",void 0),Object(c.a)([Object(h.b)({nonNullable:!0,json:{write:!0}})],v.prototype,"alphaCutoff",void 0),Object(c.a)([Object(h.b)({nonNullable:!0,json:{write:!0}})],v.prototype,"doubleSided",void 0);var b=v=i=Object(c.a)([Object(f.a)("esri.geometry.support.MeshMaterial")],v)},816:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return l}));var i=r(641),n=r(58),a=r(579);r(570);function o(e){return e?{ray:Object(a.c)(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a.c)(),c0:0,c1:Number.MAX_VALUE}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return Object(a.b)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o(),i=Object(n.p)(e.vector);return Object(a.f)(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function l(e,t){return d(e,e.c0,t)}function u(e,t){return d(e,e.c1,t)}function d(e,t,r){return Object(n.f)(r,e.ray.origin,Object(n.e)(r,e.ray.direction,t))}new i.a((function(){return{c0:0,c1:0,ray:null}}))},819:function(e,t,r){"use strict";r.d(t,"a",(function(){return Q})),r.d(t,"b",(function(){return X}));var i,n,a,o,s,c,l,u,d,h,f,p,v,b,m,g,y,O,j,x,_,S,w,C,k,P,E,T,A,R,D,M,I,L=r(542),z=r(687),F=r(557),V=r(868),G=r(695),U=r(580),B=r(764),N=r(568),H=r(791),q=r(578),W=r(621),Y=r(538),Z=r(561);function X(e){var t=new Z.a;t.extensions.add("GL_OES_standard_derivatives"),t.include(H.a),t.include(V.a,e),t.include(B.a,e),1===e.output&&t.include(G.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");var r=e.draped&&z.a.ENABLE_CONTINUOUS_LINE_PATTERNS,X=e.falloffEnabled,Q=r&&e.stippleEnabled&&e.roundCaps,J=e.innerColorEnabled||Q;return Q&&t.varyings.add("stippleCapRadius","float"),J&&t.varyings.add("vLineDistance","float"),X&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(Object(Y.a)(i||(i=Object(L.a)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),t.vertex.code.add(Object(Y.a)(n||(n=Object(L.a)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= screenSize / posNdc.w;\nreturn posNdc;\n}"])))),t.vertex.code.add(Object(Y.a)(a||(a=Object(L.a)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = cameraNearFar[0] * 0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -cameraNearFar[0]) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -cameraNearFar[0]) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -cameraNearFar[0]) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -cameraNearFar[0]) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -cameraNearFar[0]) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])),e.multipassTerrainEnabled?"depth = pos.z;":"")),t.vertex.code.add(Object(Y.a)(o||(o=Object(L.a)(["void main(void) {\nfloat uvY = floor(uv0.y);\nfloat uvZ = fract(uv0.y) * 10.0;\nfloat coverage = 1.0;\nvpos = position;\nif (uvY == 0.0) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\nbool isStartVertex = abs(abs(uvY)-3.0) == 1.0;\nbool isJoin = abs(uvY)-3.0 < 0.0;\nfloat lineWidth = getSize() * pixelRatio;\nif (lineWidth < 1.0) {\ncoverage = lineWidth;\nlineWidth = 1.0;\n}else{\nlineWidth = floor(lineWidth + 0.5);\n}\nvec4 pos  = view * vec4(position.xyz, 1.0);\nvec4 prev = view * vec4(auxpos1.xyz, 1.0);\nvec4 next = view * vec4(auxpos2.xyz, 1.0);\nclipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),e.stippleEnabled&&t.vertex.code.add(Object(Y.a)(s||(s=Object(L.a)(["vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uvZ);\nvec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\nvec2 stippleSegment = stippleSegmentInfo.zw;"])))),t.vertex.code.add(Object(Y.a)(c||(c=Object(L.a)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uvY > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?t.vertex.code.add(Object(Y.a)(l||(l=Object(L.a)(["vec2 startDir;\nvec2 endDir;\nif (leftLen < 0.001) {\nstartDir = right;\n}\nelse{\nstartDir = left;\n}\nstartDir = normalize(startDir);\nstartDir = PERPENDICULAR(startDir);\nif (rightLen < 0.001) {\nendDir = left;\n}\nelse{\nendDir = right;\n}\nendDir = normalize(endDir);\nendDir = PERPENDICULAR(endDir);\nfloat rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\njoinDisplacementDir = rotate(startDir, -sign(uvY) * subdivisionFactor * rotationAngle);"])))):t.vertex.code.add(Object(Y.a)(u||(u=Object(L.a)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = isStartVertex ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"])))),t.vertex.code.add(Object(Y.a)(d||(d=Object(L.a)(["displacementLen = lineWidth;\n}\n} else {\nif (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = isStartVertex ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\ndisplacementLen = lineWidth;\ncapDisplacementDir = isStartVertex ? -right : left;"])))),e.roundCaps?t.vertex.code.add(Object(Y.a)(h||(h=Object(L.a)(["float angle = subdivisionFactor*PI*0.5;\njoinDisplacementDir *= cos(angle);\ncapDisplacementDir *= sin(angle);"])))):t.vertex.code.add(Object(Y.a)(f||(f=Object(L.a)(["capDisplacementDir *= subdivisionFactor;"])))),t.vertex.code.add(Object(Y.a)(p||(p=Object(L.a)(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uvY) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),Q?Object(Y.a)(v||(v=Object(L.a)(["stippleCapRadius = lineWidth;"]))):"",X||J?Object(Y.a)(b||(b=Object(L.a)(["float lineDist = lineWidth * sign(uvY) * pos.w;"]))):"",J?Object(Y.a)(m||(m=Object(L.a)(["vLineDistance = lineDist;"]))):"",X?Object(Y.a)(g||(g=Object(L.a)(["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(r?t.vertex.code.add(Object(Y.a)(y||(y=Object(L.a)(["{\nstipplePatternUv = uv0.x;\nfloat stippleSegmentScreenLength = length(stippleSegment);\nfloat stippleSegmentRenderLength = length(mix(auxpos2 - position, position - auxpos1, uvZ));\nif (stippleSegmentScreenLength >= 0.001) {\nvec2 stippleDisplacement = pos.xy - stippleSegmentOrigin;\nfloat stippleDisplacementFactor = dot(stippleSegment, stippleDisplacement) / (stippleSegmentScreenLength * stippleSegmentScreenLength);\nstipplePatternUv += (stippleDisplacementFactor - uvZ) * stippleSegmentRenderLength;\n}\nstipplePatternUv *= worldToScreenRatio;\n}"])))):(t.vertex.code.add(Object(Y.a)(O||(O=Object(L.a)(["{\nvec2 posVec = pos.xy - stippleSegmentOrigin;\nfloat stippleSegmentDirectionLength = length(stippleSegment);"])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(Object(Y.a)(j||(j=Object(L.a)(["float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\nfloat roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);\nstipplePatternUvMax = roundedNumberOfPatternRepeats;"])))),t.vertex.code.add(Object(Y.a)(x||(x=Object(L.a)(["\n        if (stippleSegmentDirectionLength >= 0.001) {\n          // Project the vertex position onto the line segment.\n          float projectedLength = dot(stippleSegment, posVec) / stippleSegmentDirectionLength * 0.5;\n          ","\n          stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;")))),t.vertex.code.add(Object(Y.a)(_||(_=Object(L.a)(["pos.xy = pos.xy / screenSize * pos.w;\nvColor = getColor();\nvColor.a *= coverage;\ngl_Position = pos;\n}\n}"])))),e.multipassTerrainEnabled&&(t.fragment.include(U.a),t.include(N.b,e)),t.include(F.a,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(W.a),t.fragment.code.add(Object(Y.a)(S||(S=Object(L.a)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),Q?t.fragment.code.add(Object(Y.a)(w||(w=Object(L.a)(["vec2 stipplePosition = vec2(\nclamp(stippleCapRadius - getStippleSDF(), 0.0, stippleCapRadius),\nvLineDistance\n) / stippleCapRadius;\nfloat stippleRadius = dot(stipplePosition, stipplePosition);\nfloat stippleAlpha = step(stippleRadius, 1.0);"])))):t.fragment.code.add(Object(Y.a)(C||(C=Object(L.a)(["float stippleAlpha = getStippleAlpha();"])))),t.fragment.code.add(Object(Y.a)(k||(k=Object(L.a)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\nvec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(Object(Y.a)(P||(P=Object(L.a)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),t.fragment.code.add(Object(Y.a)(E||(E=Object(L.a)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&t.fragment.code.add(Object(Y.a)(T||(T=Object(L.a)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))),t.fragment.code.add(Object(Y.a)(A||(A=Object(L.a)(["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),Y.a.float(q.c),7===e.output?Object(Y.a)(R||(R=Object(L.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(Y.a)(D||(D=Object(L.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",4===e.output?Object(Y.a)(M||(M=Object(L.a)(["gl_FragColor = vec4(1.0);"]))):"",1===e.output?Object(Y.a)(I||(I=Object(L.a)(["outputDepth(linearDepth);"]))):"")),t}var Q=Object.freeze({__proto__:null,build:X})},820:function(e,t,r){"use strict";function i(e){return"point"===e.type}r.d(t,"a",(function(){return i}))},822:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return _}));var i,n,a,o,s,c,l,u,d=r(542),h=r(557),f=r(607),p=r(682),v=r(695),b=r(575),m=r(580),g=r(568),y=r(578),O=r(621),j=r(538),x=r(561);function _(e){var t=new x.a,r=1===e.output;return t.include(f.a,{linearDepth:r}),t.include(p.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r&&(t.include(v.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(Object(j.a)(i||(i=Object(d.a)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      ","\n      gl_Position = ","\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",r?Object(j.a)(n||(n=Object(d.a)(["transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);"]))):Object(j.a)(a||(a=Object(d.a)(["transformPosition(proj, view, vpos);"]))))),t.include(h.a,e),t.fragment.include(O.a),e.multipassTerrainEnabled&&(t.fragment.include(m.a),t.include(g.b,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(b.a),t.fragment.code.add(Object(j.a)(o||(o=Object(d.a)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 color = ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n  }\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.attributeColor?"vColor * eColor;":"eColor;",j.a.float(y.c),7===e.output?Object(j.a)(s||(s=Object(d.a)(["gl_FragColor = vec4(color.a);"]))):"",0===e.output?Object(j.a)(c||(c=Object(d.a)(["gl_FragColor = highlightSlice(color, vpos); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",4===e.output?Object(j.a)(l||(l=Object(d.a)(["outputHighlight();"]))):"",1===e.output?Object(j.a)(u||(u=Object(d.a)(["outputDepth(linearDepth);"]))):"")),t}var S=Object.freeze({__proto__:null,build:_})},823:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g}));var i=r(13),n=r(65),a=r(7),o=r(162),s=r(58),c=r(79),l=r(384),u=r(786),d=r(824),h=r(626),f=r(838),p=r(662);function v(e){var t=[],r=[];!function(e,t,r){for(var i=e.attributeData.position,n=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&1===n,s=i.length/3-(a?1:0),c=new Uint32Array(2*(s-1)),l=a?Object(o.m)(i,0,i.length-3):i,u=0,d=0;d<s-1;d++)c[u++]=d,c[u++]=d+1;t.push(["position",{size:3,data:l,exclusive:a}]),r.push(["position",c])}(e,r,t);var i=r[0][1].data,c=t[0][1].length,l=new Uint16Array(c);return function(e,t,r){var i=e.attributeData.mapPosition;Object(a.j)(i)||(r.push(["mapPos",r[0][1]]),t.push(["mapPos",{size:3,data:i}]))}(e,r,t),function(e,t,r,i){if(Object(a.k)(e.attributeData.colorFeature))return;var n=e.attributeData.color;t.push(["color",{size:4,data:Object(a.t)(n,d.c)}]),r.push(["color",i])}(e,r,t,l),function(e,t,r,i){if(Object(a.k)(e.attributeData.sizeFeature))return;var n=e.attributeData.size;t.push(["size",{size:1,data:[Object(a.t)(n,1)]}]),r.push(["size",i])}(e,r,t,l),function(e,t,r,i){var n=e.attributeData.colorFeature;Object(a.j)(n)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([n])}]),r.push(["color",i]))}(e,r,t,l),function(e,t,r,i){var n=e.attributeData.sizeFeature;Object(a.j)(n)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([n])}]),r.push(["sizeFeatureAttribute",i]))}(e,r,t,l),function(e,t,r,i){var n=e.attributeData.opacityFeature;Object(a.j)(n)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([n])}]),r.push(["opacityFeatureAttribute",i]))}(e,r,t,l),function(e,t,r,i){if("round"!==e.join)return;var o=i.length/3,c=new Float32Array(o),l=O,u=j;Object(s.w)(l,0,0,0);for(var d=Object(a.t)(e.uniformSize,1),h=-1;h<o;++h){var f=h<0?o+h:h,p=(h+1)%o;if(Object(s.w)(u,i[3*p+0]-i[3*f+0],i[3*p+1]-i[3*f+1],i[3*p+2]-i[3*f+2]),Object(s.r)(u,u),h>=0){var v=(Math.PI-Object(n.a)(Object(s.h)(l,u)))*x*1*y(d);c[h]=Math.max(Math.floor(v),0)}Object(s.e)(l,u,-1)}t.push(["subdivisions",{size:1,data:c}]),r.push(["subdivisions",r[0][1]])}(e,r,t,i),new p.a(r,t,2)}function b(e,t,r,i){var n="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,o=Object(u.a)(a,e.hasZ,n),s=o.position,c=o.outlines,l=new Float64Array(s.length),d=Object(h.c)(s,e.spatialReference,0,l,0,s,0,s.length/3,t,r,i),f=null!=d;return{lines:f?m(c,s,l):[],projectionSuccess:f,sampledElevation:d}}function m(e,t,r){var n,a=new Array,o=Object(i.a)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.index,l=s.count;if(!(l<=1)){var u=3*c,d=u+3*l;a.push({position:t.subarray(u,d),mapPosition:r?r.subarray(u,d):void 0})}}}catch(h){o.e(h)}finally{o.f()}return a}function g(e,t){for(var r="polygon"===e.type?1:0,i="polygon"===e.type?e.rings:e.paths,n=Object(u.a)(i,!1,r),a=n.position,o=n.outlines,s=Object(l.l)(a,e.spatialReference,0,a,t,0,a.length/3),c=2;c<a.length;c+=3)a[c]=f.a;return{lines:s?m(o,a):[],projectionSuccess:s}}function y(e){return 1.863798+-2.0062872/Math.pow(1+e/18.2313,.8856294)}var O=Object(c.e)(),j=Object(c.e)(),x=4/Math.PI},824:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o}));var i=r(558),n=1.2,a=i.b,o=i.a},825:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(2),n=r(79),a=function e(t,r){Object(i.a)(this,e),this.vec3=t,this.id=r};function o(e,t,r,i){return new a(Object(n.g)(e,t,r),i)}},826:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s}));var i,n,a=r(542),o=r(538);function s(e){e.fragment.code.add(Object(o.a)(i||(i=Object(a.a)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function c(e){e.fragment.code.add(Object(o.a)(n||(n=Object(a.a)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},827:function(e,t,r){"use strict";r.d(t,"a",(function(){return E})),r.d(t,"b",(function(){return P}));var i,n,a,o,s,c,l,u,d,h,f=r(542),p=r(703),v=r(557),b=r(607),m=r(575),g=r(580),y=r(568),O=r(795),j=r(643),x=r(895),_=r(794),S=r(578),w=r(621),C=r(538),k=r(561);function P(e){var t=new k.a;return t.include(b.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(O.a,e),t.include(p.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(C.a)(i||(i=Object(f.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),C.a.float(S.c),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(g.a),t.include(y.b,e)),7===e.output&&(t.include(v.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(C.a)(n||(n=Object(f.a)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(_.a,e),t.include(v.a,e),e.receiveShadows&&t.include(j.a,e),t.include(x.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(w.a),t.fragment.code.add(Object(C.a)(a||(a=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?Object(C.a)(o||(o=Object(f.a)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),2===e.output&&(t.include(O.a,e),t.include(_.a,e),t.include(v.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(Object(C.a)(s||(s=Object(f.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),C.a.float(S.c))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(Object(C.a)(c||(c=Object(f.a)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(C.a)(l||(l=Object(f.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),C.a.float(S.c))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(C.a)(u||(u=Object(f.a)(["void main() {\ngl_FragColor = waterColor;\n}"]))))),4===e.output&&(t.include(m.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(C.a)(d||(d=Object(f.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),C.a.float(S.c))),t.include(v.a,e),t.fragment.code.add(Object(C.a)(h||(h=Object(f.a)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var E=Object.freeze({__proto__:null,build:P})},828:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var i,n=r(542),a=r(789),o=r(538),s=r(561);function c(){var e=new s.a;return e.include(a.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(Object(o.a)(i||(i=Object(n.a)(["void main() {\nvec4 texColor = texture2D(tex, uv);\ngl_FragColor = texColor * color;\n}"])))),e}var l=Object.freeze({__proto__:null,build:c})},830:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return g}));var i,n,a,o,s,c,l=r(542),u=r(557),d=r(607),h=r(682),f=r(575),p=r(764),v=r(578),b=r(538),m=r(561);function g(e){var t=new m.a;return t.include(d.a,{linearDepth:!1}),t.include(h.a,e),t.include(p.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(b.a)(i||(i=Object(l.a)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(Object(b.a)(n||(n=Object(l.a)(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(Object(b.a)(a||(a=Object(l.a)(["}"])))),4===e.output&&t.include(f.a),t.include(u.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(Object(b.a)(o||(o=Object(l.a)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",b.a.float(v.c),0===e.output?Object(b.a)(s||(s=Object(l.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?Object(b.a)(c||(c=Object(l.a)(["outputHighlight();"]))):"")),t}var y=Object.freeze({__proto__:null,build:g})},831:function(e,t,r){"use strict";r.d(t,"a",(function(){return K})),r.d(t,"b",(function(){return J}));var i,n,a,o,s,c,l,u,d,h,f,p,v,b,m,g,y,O,j,x=r(542),_=r(703),S=r(766),w=r(557),C=r(607),k=r(730),P=r(709),E=r(716),T=r(773),A=r(704),R=r(682),D=r(774),M=r(702),I=r(767),L=r(580),z=r(876),F=r(705),V=r(736),G=r(568),U=r(798),B=r(718),N=r(731),H=r(643),q=r(655),W=r(578),Y=r(877),Z=r(768),X=r(538),Q=r(561);function J(e){var t=new Q.a,r=t.vertex.code,J=t.fragment.code;return t.include(Y.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(E.a),t.varyings.add("vpos","vec3"),t.include(q.a,e),t.include(k.a,e),t.include(M.a,e),0!==e.output&&7!==e.output||(t.include(P.a,e),t.include(C.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(S.a),t.include(z.a,e),t.include(D.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(A.a,e),t.include(_.a,e),t.include(T.a,e),t.include(R.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r.add(Object(X.a)(i||(i=Object(x.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",X.a.float(W.c),0===e.normalType?Object(X.a)(n||(n=Object(x.a)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(w.a,e),t.include(W.a,e),e.multipassTerrainEnabled&&(t.fragment.include(L.a),t.include(G.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(Z.a),J.add(Object(X.a)(a||(a=Object(x.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(X.a)(o||(o=Object(x.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(X.a)(s||(s=Object(x.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(X.a)(c||(c=Object(x.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(X.a)(l||(l=Object(x.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.a,e),t.include(V.a,e),t.include(F.a,e),t.include(W.a,e),e.receiveShadows&&t.include(H.a,e),e.multipassTerrainEnabled&&(t.fragment.include(L.a),t.include(G.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(N.a,e),t.include(B.a,e),t.fragment.include(Z.a),t.include(U.a,e),J.add(Object(X.a)(u||(u=Object(x.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(X.a)(d||(d=Object(x.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(X.a)(h||(h=Object(x.a)(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?Object(X.a)(f||(f=Object(x.a)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):Object(X.a)(p||(p=Object(x.a)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(X.a)(v||(v=Object(x.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(X.a)(b||(b=Object(x.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?Object(X.a)(m||(m=Object(x.a)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(X.a)(g||(g=Object(x.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(X.a)(y||(y=Object(x.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(X.a)(O||(O=Object(x.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(X.a)(j||(j=Object(x.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(I.a,e),t}var K=Object.freeze({__proto__:null,build:J})},832:function(e,t,r){"use strict";r.d(t,"a",(function(){return Z})),r.d(t,"b",(function(){return Y}));var i,n,a,o,s,c,l,u,d,h,f,p,v,b,m,g,y,O,j,x=r(542),_=r(703),S=r(766),w=r(557),C=r(607),k=r(730),P=r(709),E=r(716),T=r(773),A=r(704),R=r(682),D=r(702),M=r(767),I=r(580),L=r(705),z=r(736),F=r(568),V=r(718),G=r(731),U=r(643),B=r(655),N=r(578),H=r(768),q=r(538),W=r(561);function Y(e){var t=new W.a,r=t.vertex.code,Y=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(E.a),t.varyings.add("vpos","vec3"),t.include(B.a,e),t.include(k.a,e),t.include(D.a,e),0!==e.output&&7!==e.output||(t.include(P.a,e),t.include(C.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(S.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(A.a,e),t.include(_.a,e),t.include(T.a,e),t.include(R.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),r.add(Object(q.a)(i||(i=Object(x.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",q.a.float(N.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?Object(q.a)(n||(n=Object(x.a)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(w.a,e),t.include(N.a,e),e.multipassTerrainEnabled&&(t.fragment.include(I.a),t.include(F.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(H.a),Y.add(Object(q.a)(a||(a=Object(x.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?Object(q.a)(o||(o=Object(x.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(q.a)(s||(s=Object(x.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(q.a)(c||(c=Object(x.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(q.a)(l||(l=Object(x.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(q.a)(u||(u=Object(x.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.a,e),t.include(z.a,e),t.include(L.a,e),t.include(N.a,e),e.receiveShadows&&t.include(U.a,e),e.multipassTerrainEnabled&&(t.fragment.include(I.a),t.include(F.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(G.a,e),t.include(V.a,e),t.fragment.include(H.a),Y.add(Object(q.a)(d||(d=Object(x.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?Object(q.a)(h||(h=Object(x.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(q.a)(f||(f=Object(x.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(q.a)(p||(p=Object(x.a)(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(q.a)(v||(v=Object(x.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(q.a)(b||(b=Object(x.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),Object(q.a)(m||(m=Object(x.a)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(q.a)(g||(g=Object(x.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(q.a)(y||(y=Object(x.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(q.a)(O||(O=Object(x.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(q.a)(j||(j=Object(x.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(M.a,e),t}var Z=Object.freeze({__proto__:null,build:Y})},838:function(e,t,r){"use strict";r.d(t,"a",(function(){return dt}));var i=r(4),n=r.n(i),a=r(9),o=r(23),s=r(13),c=r(2),l=r(3),u=r(5),d=r(6),h=r(0),f=r(29),p=r(67),v=r(68),b=r(11),m=r(182),g=r(7),y=r(212),O=r(438),j=r(25),x=r(1),_=(r(12),r(15),r(8)),S=r(100),w=r(60),C=r(79),k=r(687),P=r(65),E=r(139),T=r(825),A=function(){function e(t,r){Object(c.a)(this,e),this.index=t,this.renderTargets=r,this.extent=Object(E.l)(),this.resolution=0,this.renderLocalOrigin=Object(T.a)(0,0,0,"O"),this.pixelRatio=1,this.canvasGeometries={extents:[Object(E.l)(),Object(E.l)(),Object(E.l)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}return Object(l.a)(e,[{key:"getValidTarget",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}},{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}},{key:"getNormalTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var r,i=this.computeRenderTargetValidityBitfield(),n=this.needsColorWithoutRasterImage,a=Object(s.a)(this.renderTargets.renderTargets);try{for(a.s();!(r=a.n()).done;){var o=r.value;1===o.type&&!1===n?this.validTargets[o.type]=!1:this.validTargets[o.type]=e.drawTarget(this,o,t)}}catch(c){a.e(c)}finally{a.f()}return i^this.computeRenderTargetValidityBitfield()?0:1}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this.extent[0]-t<=e.min){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(E.u)(this.extent,e.range,0,r)}if(this.extent[2]+t>=e.max){var i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(E.u)(this.extent,-e.range,0,i)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,Object(E.k)(this.canvasGeometries.extents[0],this.extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}]),e}();var R=r(383),D=r(550),M=r(552),I=(r(549),r(548),r(553),r(544)),L=r(546),z=r(551),F=function(){function e(t,r){Object(c.a)(this,e),this.size=Object(R.a)(),this._fbo=null,this._fbo=new M.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}return Object(l.a)(e,[{key:"dispose",value:function(){this._fbo=Object(g.f)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null==(e=this._fbo)||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}]),e}(),V=function(){function e(t){Object(c.a)(this,e),this.renderTargets=null;var r=function(e,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:r,fbo:new F(t,i),renderPass:e,valid:!1,lastUsed:1/0}};this.renderTargets=[r(0,0),r(0,1),r(5,2,!1),r(3,3),r(0,4)]}return Object(l.a)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=Object(s.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(r){t.e(r)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=Object(s.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(r){t.e(r)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>G)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),G=1e3,U=function e(t){Object(c.a)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0},B=function(){function e(t){Object(c.a)(this,e),this._context=t,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=N}return Object(l.a)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var r=this,i=t.key,n=this._perConstructorInstances.get(e);n||(n=new Map,this._perConstructorInstances.set(e,n));var a=n.get(i);if(void 0===a){var o=new e(this._context,t,(function(){return r.release(o)}));a=new U(o),n.set(i,a)}return++a.refCount,a.technique}},{key:"releaseAndAcquire",value:function(e,t,r){if(Object(g.k)(r)){if(t.key===r.key)return r;r.release()}return this.acquire(e,t)}},{key:"release",value:function(e){if(!Object(g.j)(e)){var t=this._perConstructorInstances.get(e.constructor).get(e.key);--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==N&&this._perConstructorInstances.forEach((function(t,r){t.forEach((function(r,i){0===r.refCount&&r.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(r.technique.dispose(),t.delete(i))})),0===t.size&&e._perConstructorInstances.delete(r)}))}},{key:"hotReload",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,r=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,i){var o=function(){var e=Object(a.a)(n.a.mark((function e(t,i){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.shader,e.t0=a,!e.t0){e.next=6;break}return e.next=5,a.reload();case 5:t.forEach((function(e){e.technique.reload(r._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.push(o(e,i))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),N=-1,H=r(866),q=r(749),W=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function Y(e,t){return e+"_"+W.find((function(e){return e.output===t})).name}var Z=r(567),X=b.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),Q=function(){function e(t){Object(c.a)(this,e),this.refCnt=0,this.glMaterial=t}return Object(l.a)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,Object(Z.a)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"getGLMaterial",value:function(){return this.glMaterial}}]),e}(),J=function(){function e(t,r,i){Object(c.a)(this,e),this._textureRep=t,this._techniqueRep=r,this.onMaterialChanged=i,this._id2glMaterialRef=new Map}return Object(l.a)(e,[{key:"dispose",value:function(){this._textureRep.dispose()}},{key:"acquire",value:function(e,t){this.ownMaterial(e);var r=Y(e.id,t),i=this._id2glMaterialRef.get(r);if(null==i){var n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return(i=new Q(n)).incRefCnt(),this._id2glMaterialRef.set(r,i),n}return i.incRefCnt(),i.getGLMaterial()}},{key:"release",value:function(e,t){var r=Y(e.id,t),i=this._id2glMaterialRef.get(r);if(i.decRefCnt(),0===i.getRefCnt()){var n=i.getGLMaterial();n&&n.dispose(),this._id2glMaterialRef.delete(r)}}},{key:"materialChanged",value:function(e){var t,r=Object(s.a)(W);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(5!==i.output&&6!==i.output){var n=this._id2glMaterialRef.get(Y(e.id,i.output));if(n&&n.getGLMaterial()){var a=n.getGLMaterial();a.updateParameters&&a.updateParameters()}}}}catch(o){r.e(o)}finally{r.f()}this.onMaterialChanged&&this.onMaterialChanged(e)}},{key:"ownMaterial",value:function(e){Object(g.k)(e.materialRepository)&&e.materialRepository!==this&&X.error("Material is already owned by a different material repository"),e.materialRepository=this}}]),e}(),K=r(892),$=r(871),ee=r(793),te=function(){function e(t){Object(c.a)(this,e),this.rctx=t,this.camera=null,this.lastFrameCamera=new q.a,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=re,this.hasOccludees=!1}return Object(l.a)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=re}},{key:"isHighlightPass",get:function(){return 5===this.pass}}]),e}(),re=13,ie=function(){function e(){Object(c.a)(this,e),this.adds=new y.a,this.removes=new y.a,this.updates=new y.a({allocator:function(e){return e||new ne},deallocator:function(e){return e.renderGeometry=null,e}})}return Object(l.a)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),ne=function e(){Object(c.a)(this,e)},ae=function e(){Object(c.a)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array},oe=r(625);function se(e){return e.data.indexCount>=1}var ce=r(26),le=r(547),ue=r(719),de=function(){function e(t){Object(c.a)(this,e),null==t?t=16:t<65536&&(t=Object(P.l)(t)),this._array=new Float32Array(t),this._size=0}return Object(l.a)(e,[{key:"resize",value:function(e,t){if(this._size=e,this._size>this._array.length){for(var r=this._array.length||1;r<this._size;)r*=2;var i=new Float32Array(r);return t&&i.set(this._array),this._array=i,!0}var n=2*this._size;if(n<=this._array.length){for(var a=this._array.length;a>=n;)a=Math.floor(a/2);var o=new Float32Array(a);return t&&o.set(this._array.subarray(0,a)),this._array=o,!0}return!1}},{key:"append",value:function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}},{key:"erase",value:function(e,t){for(var r=e;r<t;++r)this._array[r]=0}},{key:"array",get:function(){return this._array}},{key:"size",get:function(){return this._size}}]),e}(),he=r(872),fe=function e(t,r,i,n,a,o){Object(c.a)(this,e),this.from=t,this.to=r,this.isVisible=i,this.hasHighlights=n,this.hasOccludees=a,this.transformation=o,null!=o&&(this.transformationNormal=Object(le.c)(o),Object(S.c)(this.transformationNormal,this.transformationNormal),Object(S.b)(this.transformationNormal,this.transformationNormal))};function pe(e,t){var r=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var i=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(i,t)){var n=t.from-i.first+t.to-t.from;i.count=n}else e.push(r(t))}else e.push(r(t))}var ve=r(654),be=r(387);r(64);function me(e,t,r){Object(g.k)(r)&&(r.drawCalls+=e,r.triangles+=t)}be.a;var ge=r(720),ye=function(){function e(t,r,i){Object(c.a)(this,e),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=t,this._material=i,this._materialRep=r,this._glMaterials=Object(ve.a)(this._material,this._materialRep),this._bufferWriter=i.createBufferWriter()}return Object(l.a)(e,[{key:"dispose",value:function(){Object(ve.f)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&Object(m.c)(this._glMaterials,(function(e){return e instanceof he.a}))}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"modify",value:function(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}},{key:"addAndRemoveGeometries",value:function(e,t){var r=this,i=this._bufferWriter,n=i.vertexBufferLayout,a=n.stride/4,o=this._dataByOrigin,c=function(e,t,r,i){var n,a=new Map,o=t.vertexBufferLayout.stride/4,c=function(r,i){var n=r.origin;if(!Object(g.j)(n)){var s=e.get(n.id),c=a.get(n.id);null==c&&(c={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:n.vec3},a.set(n.id,c));var l=t.elementCount(r.data)*o;i?(c.optimalCount+=l,c.sparseCount+=l,c.toAdd.push(r)):(c.optimalCount-=l,c.toRemove.push(r))}},l=Object(s.a)(r);try{for(l.s();!(n=l.n()).done;){c(n.value,!0)}}catch(h){l.e(h)}finally{l.f()}var u,d=Object(s.a)(i);try{for(d.s();!(u=d.n()).done;){c(u.value,!1)}}catch(h){d.e(h)}finally{d.f()}return a}(o,i,e,t);c.forEach((function(e,t){c.delete(t);var i=e.optimalCount,s=e.sparseCount,l=o.get(t);if(null==l)Object(Z.a)(i>0),l=r.createData(n,i,e.origin),o.set(t,l);else if(0===i)return l.vao.dispose(!0),l.vao=null,void o.delete(t);var u=i<e.sparseCount/2,d=u?i:s,h=je,f=l.buffer.size,p=l.buffer.array,v=l.buffer.resize(d,!1);u||v?r.removeAndRebuild(l,e.toRemove,a,p,h):e.toRemove.length>0?(r.removeByErasing(l,e.toRemove,a,h),e.toAdd.length>0&&(h.end=f)):(h.begin=f,h.end=f);var b=xe;Object(Z.j)(b,-e.origin[0],-e.origin[1],-e.origin[2]),r.append(l,e.toAdd,a,b,h);var m=l.vao.vertexBuffers.geometry;if(m.byteSize!==l.buffer.array.buffer.byteLength)m.setData(l.buffer.array);else{var g=h.begin,y=h.end;if(g<y){var O=l.buffer.array,j=4*g,x=4*y;m.setSubData(O,j,j,x)}}l.drawCommandsDirty=!0}))}},{key:"updateGeometries",value:function(e){var t,r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,n=Object(s.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.updateType,c=a.renderGeometry,l=this._dataByOrigin.get(c.origin.id),u=l&&l.instances.get(c.id);if(!u)return;if(1&o&&(u.isVisible=c.instanceParameters.visible),9&o){var d=c.instanceParameters.visible;u.hasHighlights=!!c.instanceParameters.highlights&&d}if(16&o&&(u.hasOccludees=!!c.instanceParameters.occludees),6&o){var h=l.buffer.array,f=l.vao;Object(ve.c)(c,_e,Se),r.write({transformation:_e,invTranspTransformation:Se},c.data,r.vertexBufferLayout.createView(h.buffer),u.from),Object(Z.a)(u.from+r.elementCount(c.data)===u.to,"material VBO layout has changed"),f.vertexBuffers.geometry.setSubData(h,u.from*i*4,u.from*i*4,u.to*i*4)}l.drawCommandsDirty=!0}}catch(p){n.e(p)}finally{n.f()}}},{key:"updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,Object(m.c)(t.instances,(function(r){return r.isVisible?(r.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),r.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0!==e.instances.size){if(!Oe(e)){var t=4*e.buffer.size/Object(ge.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}var r=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))}(Object(ce.a)(e.instances.values()));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];var i,n=Object(s.a)(r);try{for(n.s();!(i=n.n()).done;){var a=i.value;a.isVisible&&(a.hasOccludees?pe(e.drawCommandsOccludees,a):pe(e.drawCommandsDefault,a),a.hasHighlights?pe(e.drawCommandsHighlight,a):pe(e.drawCommandsShadowHighlightRest,a))}}catch(c){n.e(c)}finally{n.f()}var o=function(e){var t,r=0,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;)r+=t.value.count}catch(c){i.e(c)}finally{i.f()}return r/3};e.stats={default:o(e.drawCommandsDefault),highlight:o(e.drawCommandsHighlight),occludees:o(e.drawCommandsOccludees),shadowHighlightRest:o(e.drawCommandsShadowHighlightRest)}}}(e),e.drawCommandsDirty=!1)}))}},{key:"updateLogic",value:function(e){return this._material.update(e)}},{key:"render",value:function(e,t,r,i){var n=this,a=this._rctx,o=this._glMaterials.get(t),s=5===t||7===t,c=6===t,l=!(s||c);if(!o||2!==o.ensureResources(a)||null!=e&&!o.beginSlot(e)||s&&!this._hasHighlights)return!1;o.ensureParameters(r);var u=o.getPipelineState(e,!1);a.setPipelineState(u);var d=o.technique;a.useProgram(d.program),o.bind(r);var h=!1;return this._dataByOrigin.forEach((function(t){if(!(Object(g.j)(t.drawCommandsDefault)&&Object(g.j)(t.drawCommandsHighlight)&&Object(g.j)(t.drawCommandsOccludees)&&Object(g.j)(t.drawCommandsShadowHighlightRest))&&(!s||t.hasHighlights)){r.origin=t.origin,d.bindDraw(r,{},{}),d.ensureAttributeLocations(t.vao),a.bindVAO(t.vao);var f=d.primitiveType,p=s?t.drawCommandsHighlight:c&&Oe(t)?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault;if(Object(g.k)(p)){n.renderCommands(a,f,p);var v=s?t.stats.highlight:c&&Oe(t)?t.stats.shadowHighlightRest:t.stats.default;me(p.length,v,i),h=!0}if(l){var b=t.drawCommandsOccludees;if(Object(g.k)(b)){var m=o.getPipelineState(e,!0);a.setPipelineState(m),n.renderCommands(a,f,b),a.setPipelineState(u),me(b.length,t.stats.occludees,i),h=!0}}}})),h}},{key:"renderCommands",value:function(e,t,r){for(var i=0;i<r.length;i++)e.drawArrays(t,r[i].first,r[i].count)}},{key:"createData",value:function(e,t,r){return{instances:new Map,vao:new z.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(ue.a)(e)},{geometry:D.a.createVertex(this._rctx,35044)}),buffer:new de(t),optimalCount:0,origin:r,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}},{key:"removeAndRebuild",value:function(e,t,r,i,n){var a,o=Object(s.a)(t);try{for(o.s();!(a=o.n()).done;){var c=a.value.id,l=e.instances.get(c);e.optimalCount-=(l.to-l.from)*r,e.instances.delete(c)}}catch(v){o.e(v)}finally{o.f()}var u=0,d=e.buffer.array;n.begin=0,n.end=0;var h=-1,f=-1,p=0;e.instances.forEach((function(e){var t=e.from*r,n=e.to*r,a=n-t;h!==f&&f!==t?(d.set(i.subarray(h,f),p),p+=f-h,h=t):-1===h&&(h=t),f=n,e.from=u/r,u+=a,e.to=u/r})),h!==f&&d.set(i.subarray(h,f),p),n.end=u}},{key:"removeByErasing",value:function(e,t,r,i){i.begin=1/0,i.end=-1/0;var n,a=-1,o=-1,c=Object(s.a)(t);try{for(c.s();!(n=c.n()).done;){var l=n.value.id,u=e.instances.get(l),d=u.from*r,h=u.to*r;a!==o&&o!==d?(e.buffer.erase(a,o),a=d):-1===a&&(a=d),o=h,e.instances.delete(l),e.optimalCount-=h-d,d<i.begin&&(i.begin=d),h>i.end&&(i.end=h)}}catch(f){c.e(f)}finally{c.f()}a!==o&&e.buffer.erase(a,o)}},{key:"append",value:function(e,t,r,i,n){var a,o=this._bufferWriter,c=Object(s.a)(t);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=Object(g.k)(l.transformation)?Object(S.n)(_e,i,l.transformation):i;Object(S.c)(Se,u),Object(S.b)(Se,Se);var d=n.end;o.write({transformation:u,invTranspTransformation:Se},l.data,o.vertexBufferLayout.createView(e.buffer.array.buffer),n.end/r);var h=o.elementCount(l.data)*r,f=d+h;Object(Z.a)(null==e.instances.get(l.id));var p=l.instanceParameters.visible,v=!!l.instanceParameters.highlights&&p,b=!!l.instanceParameters.occludees,m=new fe(d/r,f/r,p,v,b);e.instances.set(l.id,m),e.optimalCount+=h,n.end+=h}}catch(y){c.e(y)}finally{c.f()}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]),e}();function Oe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}var je={begin:0,end:0},xe=Object(le.d)(),_e=Object(le.d)(),Se=Object(le.d)(),we=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(c.a)(this,r),(e=t.apply(this,arguments))._pending=new Ce,e._changes=new ie,e._materialRenderers=new Map,e._sortedMaterialRenderers=new y.a,e._hasHighlights=!1,e._hasWater=!1,e}return Object(l.a)(r,[{key:"dispose",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return Object(m.c)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,r=function(e){var r=t.get(e);return r||(r=new ae,t.set(e,r)),r};return e.adds.forAll((function(e){se(e)&&r(e.material).adds.push(e)})),e.removes.forAll((function(e){se(e)&&r(e.material).removes.push(e)})),e.updates.forAll((function(e){se(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}(this._changes),r=!1,i=!1,n=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new ye(e.rctx,e.materialRepository,a),e._materialRenderers.set(a,o),r=!0,i=!0,n=!0),o){var s=i||o.hasHighlights,c=n||o.hasWater;o.modify(t),i=i||s!==o.hasHighlights,n=n||c!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),r=!0)}})),this._changes.clear(),r&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(m.c)(this._materialRenderers,(function(e){return e.hasHighlights}))),n&&(this._hasWater=Object(m.c)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,r=this._pending.empty,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;this._pending.adds.add(n)}}catch(a){i.e(a)}finally{i.f()}r&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,r=this._pending.empty,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;this._pending.adds.has(n)?(this._pending.removed.add(n),this._pending.adds.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n)}}catch(a){i.e(a)}finally{i.f()}r&&!this._pending.empty&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var r,i=0===this._changes.updates.length,n=Object(s.a)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value,o=this._changes.updates.pushNew();o.renderGeometry=a,o.updateType=t}}catch(c){n.e(c)}finally{n.f()}i&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateLogic",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(r){var i=r.materialRenderer;return t=i.updateLogic(e)||t})),t}},{key:"render",value:function(e,t){for(var r=0;r<this._sortedMaterialRenderers.length;r++){var i=this._sortedMaterialRenderers.data[r];Object(oe.c)(i.material,e)&&i.materialRenderer.render(t.slot,e.pass,t,null)}}},{key:"updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(r,i){i.insertOrder=t++,e._sortedMaterialRenderers.push({material:i,materialRenderer:r})})),this._sortedMaterialRenderers.sort((function(e,t){var r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),r}(f.a);Object(h.a)([Object(x.b)()],we.prototype,"rctx",void 0),Object(h.a)([Object(x.b)()],we.prototype,"materialRepository",void 0),Object(h.a)([Object(x.b)()],we.prototype,"updating",null),we=Object(h.a)([Object(_.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],we);var Ce=function(){function e(){Object(c.a)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return Object(l.a)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}(),ke=r(828),Pe=r(609),Ee=r(618),Te=r(624),Ae=r(619),Re=r(610),De=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(l.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build();return new Re.a(e.rctx,t,Ae.a)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?Object(I.f)({blending:Object(I.g)(770,1,771,771),colorWrite:I.c}):Object(I.f)({colorWrite:I.c})}}]),r}(Ee.a);De.shader=new Pe.a(ke.a,(function(){return r.e(200).then(r.bind(null,1110))}));var Me=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(c.a)(this,r),(e=t.apply(this,arguments)).hasAlpha=!1,e}return r}(Te.a);Object(h.a)([Object(Te.b)()],Me.prototype,"hasAlpha",void 0);var Ie=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(C.e)();Object(c.a)(this,e),this.intensity=t},Le=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(C.e)(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(C.g)(.57735,.57735,.57735);Object(c.a)(this,e),this.intensity=t,this.direction=r},ze=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(C.e)(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(C.g)(.57735,.57735,.57735),i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(c.a)(this,e),this.intensity=t,this.direction=r,this.castShadows=i},Fe=function e(){Object(c.a)(this,e),this.r=[0],this.g=[0],this.b=[0]},Ve=r(58);function Ge(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function Ue(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t;return r}function Be(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function Ne(e){return(e+1)*(e+1)}function He(e,t,r){var i=e[0],n=e[1],a=e[2],o=r||[];return o.length=Ne(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*a,o[3]=.4886025119*n),t>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*i*a,o[8]=.54627421529*(i*i-n*n)),o}function qe(e,t){var r,i,n=(r=t.r.length,Object(P.d)(Math.floor(Math.sqrt(r)-1),0,2)),a=Object(s.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;Object(Ve.s)(Ke,o.direction),He(Ke,n,Qe),Ge(Qe,$e),Ue(Qe,o.intensity[0],Je),Be(t.r,Je),Ue(Qe,o.intensity[1],Je),Be(t.g,Je),Ue(Qe,o.intensity[2],Je),Be(t.b,Je)}}catch(c){a.e(c)}finally{a.f()}return t}function We(e,t,r,i){(function(e,t){var r=Ne(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(var n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0})(t,i),Object(Ve.w)(r.intensity,0,0,0);var n=!1,a=Ye,o=Ze,c=Xe;a.length=0,o.length=0,c.length=0;var l,u=Object(s.a)(e);try{for(u.s();!(l=u.n()).done;){var d=l.value;d instanceof ze&&!n?(Object(Ve.k)(r.direction,d.direction),r.intensity[0]=d.intensity[0],r.intensity[1]=d.intensity[1],r.intensity[2]=d.intensity[2],r.castShadows=d.castShadows,n=!0):d instanceof ze||d instanceof Le?a.push(d):d instanceof Ie?o.push(d):d instanceof Fe&&c.push(d)}}catch(v){u.e(v)}finally{u.f()}qe(a,i),function(e,t){He(Ke,0,Qe);var r,i=Object(s.a)(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;t.r[0]+=Qe[0]*$e[0]*n.intensity[0]*4*Math.PI,t.g[0]+=Qe[0]*$e[0]*n.intensity[1]*4*Math.PI,t.b[0]+=Qe[0]*$e[0]*n.intensity[2]*4*Math.PI}}catch(v){i.e(v)}finally{i.f()}}(o,i);var h,f=Object(s.a)(c);try{for(f.s();!(h=f.n()).done;){var p=h.value;Be(i.r,p.r),Be(i.g,p.g),Be(i.b,p.b)}}catch(v){f.e(v)}finally{f.f()}}var Ye=[],Ze=[],Xe=[],Qe=[0],Je=[0],Ke=Object(C.e)(),$e=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],et=function(){function e(){Object(c.a)(this,e),this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(C.e)(),ambient:{color:Object(C.e)(),intensity:1},diffuse:{color:Object(C.e)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Fe,this._mainLight={intensity:Object(C.e)(),direction:Object(C.g)(1,0,0),castShadows:!1}}return Object(l.a)(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}},{key:"setUniforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",r),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);var i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}},{key:"set",value:function(e){We(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(Ve.k)(this._oldSunlight.direction,this._mainLight.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(Ve.e)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(Ve.k)(tt,this._oldSunlight.diffuse.color),Object(Ve.e)(tt,tt,this._ambientBoost*this.globalFactor),Object(Ve.f)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,tt)}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),tt=Object(C.e)(),rt=function(){function e(t){Object(c.a)(this,e),this._rctx=t,this.cache=new Map}return Object(l.a)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){return e.texture=Object(g.f)(e.texture)})),this.cache.clear()}},{key:"acquire",value:function(e){var t=this;if(Object(g.j)(e))return null;var r=this.patternId(e),i=this.cache.get(r);if(i)return i.refCount++,i.bind;var n=this.patternToTextureData(e,2),a=n.encodedData,o=n.sdfNormalizer,s=a.length/4,c=s/2,l={refCount:1,texture:null,bind:function(e){return Object(g.j)(l.texture)&&(l.texture=new L.a(t._rctx,{width:s,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},a)),e.bindTexture(l.texture,"stipplePatternTexture"),{pixelSize:c,sdfNormalizer:o}}};return this.cache.set(r,l),l.bind}},{key:"release",value:function(e){if(!Object(g.j)(e)){var t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(Object(g.k)(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var r=this.acquire(t);return this.release(e),r}},{key:"patternId",value:function(e){return e.join(",")}},{key:"patternToTextureData",value:function(e,t){var r,i=Math.floor(e.reduce((function(e,t){return e+t}))*t),n=.5*(e.reduce((function(e,t){return Math.max(e,t)}))+1)*t,a=new Uint8Array(4*i),o=1,c=0,l=Object(s.a)(e);try{for(l.s();!(r=l.n()).done;){for(var u=r.value*t,d=0;d<u;d++){var h=o*(Math.min(d,u-d)+.5);Object(Z.h)(h/n*.5+.5,a,c),c+=4}o=-o}}catch(f){l.e(f)}finally{l.f()}return{encodedData:a,sdfNormalizer:n}}}]),e}(),it=r(680),nt=b.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),at=function(e){Object(u.a)(r,e);var t=Object(d.a)(r);function r(e){var i;return Object(c.a)(this,r),(i=t.call(this,e))._overlays=null,i._overlayRenderTarget=null,i._hasHighlights=!1,i._rendersOccluded=!1,i._hasWater=!1,i._lighting=new et,i._handles=new v.a,i._layerRenderers=new Map,i._sortedLayerRenderersDirty=!1,i._sortedLayerRenderers=new y.a,i._geometries=new Map,i.worldToPCSRatio=1,i.events=new p.a,i.longitudeCyclical=null,i}return Object(l.a)(r,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext,this._renderContext=new te(this._rctx);var r=t.waterTextureRepository;this._stippleTextureRepository=new rt(t.renderingContext),this._shaderTechniqueRepository=new B({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._handles.add([Object(j.a)(r,"loadingState",(function(){return e.events.emit("content-changed")})),Object(j.a)(this,"spatialReference",(function(t){return e._localOrigins=new $.a(t)}))]),this._materialRepository=new J(t.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(t){(t.renderOccluded&ht)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating")},this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Ie(Object(C.g)(1,1,1))]),this._bindParameters={slot:23,highlightDepthTexture:Object(K.a)(this._rctx),camera:ct,inverseViewport:Object(w.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._handles.add(this.view.resourceController.scheduler.registerTask(it.b.STAGE,this))}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._debugTextureTechnique=Object(g.q)(this._debugTextureTechnique),this._debugPatternTexture=Object(g.f)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(g.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(g.f)(this._shaderTechniqueRepository),this._temporaryFBO=Object(g.f)(this._temporaryFBO),this._quadVAO=Object(g.f)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||Object(m.c)(this._layerRenderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return Object(g.k)(this._overlays)&&Object(g.k)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return Object(g.k)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if(Object(g.k)(this._overlayRenderTarget)){var r,i=Object(s.a)(this._overlayRenderTarget.renderTargets);try{for(i.s();!(r=i.n()).done;){var n=r.value,a=this.overlays[0].validTargets[n.type]||!this.overlays[1].validTargets[n.type];t=this._overlayRenderTarget.validateUsageForTarget(a,n,e)||t}}catch(o){i.e(o)}finally{i.f()}}return t}},{key:"overlays",get:function(){return Object(g.t)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){Object(g.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasTargetWithoutRasterImage=Object(O.a)(e,(function(e){return 1===e.drapeTargetType}))}))}},{key:"ensureDrapeSources",value:function(e){Object(g.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=Object(m.c)(e,(function(e,t){return 1===t.drapeSourceType})),t.hasDrapedRasterSource=Object(m.c)(e,(function(e,t){return 0===t.drapeSourceType}))}))}},{key:"ensureOverlays",value:function(e,t){Object(g.j)(this._overlays)&&(this._overlayRenderTarget=new V(this._rctx),this._overlays=[new A(0,this._overlayRenderTarget),new A(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=Object(g.f)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=!1,n=Object(s.a)(this._layerRenderers);try{for(n.s();!(t=n.n()).done;){var a=Object(o.a)(t.value,2),c=a[0],l=a[1];if(e.done)break;r(c)&&(l.commitChanges()&&(i=!0,e.madeProgress()),l.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(c),this._handles.remove(c)))}}catch(u){n.e(u)}finally{n.f()}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),i=!0),i&&(Object(g.k)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}},{key:"processSyncLayers",value:function(){this.runTask(it.c,(function(e){return 1===e.updatePolicy}))}},{key:"addGeometries",value:function(e,t,r){var i,n=Object(s.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value;Object(g.j)(a.origin)&&(a.origin=this._localOrigins.getOrigin(a.boundingSphere)),this._geometries.set(a.id,a)}}catch(o){n.e(o)}finally{n.f()}this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,r){var i,n=Object(s.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value;this._geometries.delete(Object(g.s)(a.id))}}catch(c){n.e(c)}finally{n.f()}var o=this._layerRenderers.get(t);o&&(o.remove(e),2===r&&this.notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,r){var i=this._layerRenderers.get(t);if(i)switch(i.modify(e,r),r){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else nt.warn("Attempted to update geometry for nonexistent layer")}},{key:"notifyGraphicGeometryChanged",value:function(e,t){if(!Object(g.j)(t.notifyGraphicGeometryChanged)){var r,i,n=Object(s.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value.graphicUid;Object(g.k)(a)&&a!==r&&(t.notifyGraphicGeometryChanged(a),r=a)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"notifyGraphicVisibilityChanged",value:function(e,t){if(!Object(g.j)(t.notifyGraphicVisibilityChanged)){var r,i,n=Object(s.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value.graphicUid;Object(g.k)(a)&&a!==r&&(t.notifyGraphicVisibilityChanged(a),r=a)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"updateHighlights",value:function(e,t){var r=this._layerRenderers.get(t);r?r.modify(e,8):nt.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!k.a.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateLogic",value:function(e){var t=!1;return this._layerRenderers.forEach((function(r){return t=r.updateLogic(e)||t})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,r){var i=this,n=e.canvasGeometries;if(0===n.numViews)return!1;var a=e.pixelRatio*r;this._screenToWorldRatio=a*Math.abs(n.extents[0][2]-n.extents[0][0])/e.resolution;var o=t.renderPass;if(this.isEmpty()||5===o&&!this.hasHighlights||3===o&&!this.hasWater)return!1;if(!e.hasSomeSizedView())return!1;var s=t.fbo,c=2*e.resolution,l=e.resolution,u=1===t.type?2:4===t.type?1:0;if(!s.isValid())return!1;s.resize(c,l);var d=this._rctx;if(ct.pixelRatio=a||1,this._renderContext.pass=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===o?24:23,e.applyViewport(this._rctx),s.bind(d),0===e.index&&(d.setClearColor(0,0,0,0),d.clearSafe(16384)),1===u&&(this._renderContext.renderOccludedMask=ht),k.a.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==u)for(var h=0;h<n.numViews;h++)this.setViewParameters(n.extents[h],e,ct),this.drawDebugTexture(e.resolution,st[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(t){var r=t.layerView,a=t.renderer;if(2!==u||!Object(g.k)(r)||0!==r.drapeSourceType){var h=Object(g.k)(r)&&Object(g.k)(r.fullOpacity)&&r.fullOpacity<1&&0===o;h&&(i.bindTemporaryFramebuffer(i._rctx,c,l),d.clearSafe(16384));for(var f=0;f<n.numViews;f++)i.setViewParameters(n.extents[f],e,ct),a.render(i._renderContext,i._bindParameters);h&&Object(g.k)(i._temporaryFBO)&&(s.bind(d),i.view._stage.renderView.compositingHelper.composite(i._temporaryFBO.getTexture(),2,Object(g.s)(Object(g.s)(r).fullOpacity),3,e.index))}})),d.bindFramebuffer(null),s.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,r){Object(g.j)(this._temporaryFBO)&&(this._temporaryFBO=new F(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=Object(a.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.hotReload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,r){var i=this,n=0;this._geometries.forEach((function(a){if(!r||r(a)){i.intersectRenderGeometry(a,t,0,e,n);var o=i.longitudeCyclical;o&&(a.boundingSphere[0]-a.boundingSphere[3]<o.min&&i.intersectRenderGeometry(a,t,o.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>o.max&&i.intersectRenderGeometry(a,t,-o.range,e,n)),n++}}))}},{key:"intersectRenderGeometry",value:function(e,t,r,i,n){var a=this;if(e.instanceParameters.visible){var o=0;Object(g.k)(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),lt[0]=t[0]-r,lt[1]=t[1]-o,lt[2]=1,ut[0]=t[0]-r,ut[1]=t[1]-o,ut[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),i,lt,ut,(function(t,r,o){a.addIntersectionResult(o,e.material.renderPriority,n,i,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}}},{key:"addIntersectionResult",value:function(e,t,r,i,n,a){var o={type:"external",metadata:{layerUid:n,graphicUid:a}},s=function(n){n.set(o,null,i.results.ground.dist,i.results.ground.normal,i.results.ground.transformation,t,null,null,e,r),n.intersector="OverlayRenderer"};if((null==i.results.min.drapedLayerOrder||t>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&s(i.results.min),0!==i.options.store&&(null==i.results.max.drapedLayerOrder||t<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&s(i.results.max),2===i.options.store){var c=new ee.a(i.ray);s(c),i.results.all.push(c)}}},{key:"ensureLayerRenderer",value:function(e){var t=this,r=this._layerRenderers.get(e);return r||(r=new we({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,r),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return t.events.emit("content-changed")})),e),this._handles.add(Object(j.a)(r,"updating",(function(){return t.notifyChange("updating")})),e)),r}},{key:"updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((function(r){var i=r,n=e._layerRenderers.get(i);n&&(e._sortedLayerRenderers.push(new ot(i,n)),t.delete(n))})),t.forEach((function(t){return e._sortedLayerRenderers.push(new ot(null,t))}))}}},{key:"setViewParameters",value:function(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,Object(S.p)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Object(S.j)(r.viewMatrix),Object(S.t)(r.viewMatrix,r.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=r,this._bindParameters.camera=r,this._bindParameters.inverseViewport[0]=1/r.fullViewport[2],this._bindParameters.inverseViewport[1]=1/r.fullViewport[3]}},{key:"updateHasWater",value:function(){var e=Object(m.c)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"updateHasHighlights",value:function(){var e=Object(m.c)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"updateRendersOccluded",value:function(){var e=Object(m.c)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"drawDebugTexture",value:function(e,t){var r=this._rctx;this.ensureDebugPatternResources(e,e);var i=this._debugTextureTechnique.program;r.useProgram(i),r.setPipelineState(this._debugTextureTechnique.pipeline),i.setUniform4f("color",t[0],t[1],t[2],1),i.bindTexture(this._debugPatternTexture,"tex"),r.bindVAO(this._quadVAO),r.drawArrays(5,0,Object(ge.f)(this._quadVAO,"geometry"))}},{key:"ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var r=new Uint8Array(e*t*4),i=0,n=0;n<t;n++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(n/10);o<2||s<2||10*o>e-20||10*s>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&s?1&a^1&n?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new L.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);var c=new Me;c.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(De,c),this._quadVAO=Object(K.b)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),r}(Object(H.b)(f.a));Object(h.a)([Object(H.c)()],at.prototype,"_shaderTechniqueRepository",void 0),Object(h.a)([Object(H.c)()],at.prototype,"_stippleTextureRepository",void 0),Object(h.a)([Object(x.b)({constructOnly:!0})],at.prototype,"view",void 0),Object(h.a)([Object(x.b)()],at.prototype,"worldToPCSRatio",void 0),Object(h.a)([Object(x.b)()],at.prototype,"spatialReference",void 0),Object(h.a)([Object(x.b)({type:Boolean,readOnly:!0})],at.prototype,"updating",null),at=Object(h.a)([Object(_.a)("esri.views.3d.terrain.OverlayRenderer")],at);var ot=function e(t,r){Object(c.a)(this,e),this.layerView=t,this.renderer=r},st=[[1,.5,.5],[.5,.5,1]],ct=new q.a;ct.near=1,ct.far=1e4,ct.relativeElevation=null;var lt=Object(C.e)(),ut=Object(C.e)(),dt=-2,ht=4},841:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i,n,a,o,s=r(542),c=r(704),l=r(538);function u(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(l.a)(i||(i=Object(s.a)(["#ifndef GL_EXT_shader_texture_lod\nfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\nfloat deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\nreturn max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n#endif\nvec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n#else\nvec2 dUVdxAuto = dFdx(uvAtlas);\nvec2 dUVdyAuto = dFdy(uvAtlas);\nfloat mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\nfloat autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\nreturn texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}"]))))}function d(e,t){e.include(c.a,t),e.fragment.code.add(Object(l.a)(n||(n=Object(s.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(Object(l.a)(a||(a=Object(s.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn texture2D(tex, params.uv);\n}"])))),2===t.attributeTextureCoordinates&&(e.include(u),e.fragment.code.add(Object(l.a)(o||(o=Object(s.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n}"])))))}},842:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u}));var i,n,a=r(542),o=r(580),s=r(538);function c(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(Object(s.a)(i||(i=Object(a.a)(["vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n{\nvec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\nvec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\nreprojectedCoord.xy /= reprojectedCoord.w;\nreturn reprojectedCoord.xy * 0.5 + 0.5;\n}"]))))}function l(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(o.a),e.include(c),e.fragment.code.add(Object(s.a)(n||(n=Object(a.a)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}function u(e,t){var r,i;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),i=t,(r=e).bindTexture(i.lastFrameColorTexture,"lastFrameColorMap"),r.setUniformMatrix4fv("reprojectionMat",i.reprojectionMat),r.setUniformMatrix4fv("rpProjectionMat",i.camera.projectionMatrix))}},865:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(13),n=r(2),a=r(3),o=r(7),s=r(115),c=r(212),l=r(58),u=r(79),d=r(763),h=r(579),f=r(678),p=r(567),v=function(){function e(t,r){Object(n.a)(this,e),this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new b,this._objectCount=0,r&&(void 0!==r.maximumObjectsPerNode&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),void 0!==r.maximumDepth&&(this._maximumDepth=r.maximumDepth))}return Object(a.a)(e,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}},{key:"destroy",value:function(){this._degenerateObjects.clear(),b.clearPool(),P[0]=null,D.prune(),V.prune()}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);for(var r=b.acquire(),i=0;i<t;i++){var n=e[i];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}b.release(r)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;var r,n=b.acquire(),a=Object(i.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,c=Object(o.k)(t)?t:Object(f.d)(this._objectToBoundingSphere(s),M);S(c[3])?(n.init(this._root),this._remove(s,c,n)):this._degenerateObjects.delete(s)}}catch(l){a.e(l)}finally{a.f()}b.release(n),this._shrink()}},{key:"update",value:function(e,t){if(S(t[3])||!this._isDegenerate(e)){var r=function(e){return P[0]=e,P}(e);this.remove(r,t),this.add(r)}}},{key:"forEachAlongRay",value:function(e,t,r){var i=this,n=Object(h.g)(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNode(n,e))return!1;var t=e.node;return t.terminals.forAll((function(e){i._intersectsObject(n,e)&&r(e)})),null!==t.residents&&t.residents.forAll((function(e){i._intersectsObject(n,e)&&r(e)})),!0}))}},{key:"forEachAlongRayWithVerticalOffset",value:function(e,t,r,i){var n=this,a=Object(h.g)(e,t);this._forEachNode(this._root,(function(e){if(!n._intersectsNodeWithOffset(a,e,i))return!1;var t=e.node;return t.terminals.forAll((function(e){n._intersectsObjectWithOffset(a,e,i)&&r(e)})),null!==t.residents&&t.residents.forAll((function(e){n._intersectsObjectWithOffset(a,e,i)&&r(e)})),!0}))}},{key:"forEach",value:function(e){this._forEachNode(this._root,(function(t){var r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}},{key:"forEachDegenerateObject",value:function(e){this._degenerateObjects.forEach(e)}},{key:"findClosest",value:function(e,t,r){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,s=1/0,c=null,u=x(e,t),h=function(l){if(--a,n(l)){var u=i._objectToBoundingSphere(l);if(Object(d.e)(r,u)){var h=_(e,t,Object(f.c)(u)),p=h-u[3],v=h+u[3];p<o&&(o=p,s=v,c=l)}}};return this._forEachNodeDepthOrdered(this._root,(function(i){if(a<=0||!Object(d.e)(r,i.bounds))return!1;if(Object(l.e)(T,u,i.halfSize),Object(l.f)(T,T,i.bounds),_(e,t,T)>s)return!1;var n=i.node;return n.terminals.forAll((function(e){return h(e)})),null!==n.residents&&n.residents.forAll((function(e){return h(e)})),!0}),e,t),c}},{key:"forEachInDepthRange",value:function(e,t,r,i,n,a,o){var s=this,c=-1/0,u=1/0,h={setRange:function(e){1===r?(c=Math.max(c,e.near),u=Math.min(u,e.far)):(c=Math.max(c,-e.far),u=Math.min(u,-e.near))}};h.setRange(i);var p=_(t,r,e),v=x(t,r),b=x(t,-r),m=function(e){if(o(e)){var i=s._objectToBoundingSphere(e),l=Object(f.c)(i),v=_(t,r,l)-p,b=v-i[3],m=v+i[3];b>u||m<c||!Object(d.e)(a,i)||n(e,h)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(!Object(d.e)(a,e.bounds))return!1;if(Object(l.e)(T,v,e.halfSize),Object(l.f)(T,T,e.bounds),_(t,r,T)-p>u)return!1;if(Object(l.e)(T,b,e.halfSize),Object(l.f)(T,T,e.bounds),_(t,r,T)-p<c)return!1;var i=e.node;return i.terminals.forAll((function(e){return m(e)})),null!==i.residents&&i.residents.forAll((function(e){return m(e)})),!0}),t,r)}},{key:"forEachNode",value:function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.bounds,t.halfSize)}))}},{key:"_intersectsNode",value:function(e,t){return y(t.bounds,2*-t.halfSize,A),y(t.bounds,2*t.halfSize,R),Object(p.i)(e.origin,e.direction,A,R)}},{key:"_intersectsNodeWithOffset",value:function(e,t,r){return y(t.bounds,2*-t.halfSize,A),y(t.bounds,2*t.halfSize,R),r.applyToMinMax(A,R),Object(p.i)(e.origin,e.direction,A,R)}},{key:"_intersectsObject",value:function(e,t){var r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(f.e)(r,e)}},{key:"_intersectsObjectWithOffset",value:function(e,t,r){var i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(f.e)(r.applyToBoundingSphere(i),e)}},{key:"_forEachNode",value:function(e,t){for(var r=b.acquire().init(e),i=[r];0!==i.length;){if(t(r=i.pop())&&!r.isLeaf())for(var n=0;n<r.node.children.length;n++)r.node.children[n]&&i.push(b.acquire().init(r).advance(n));b.release(r)}}},{key:"_forEachNodeDepthOrdered",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=b.acquire().init(e),a=[n];for(j(r,i,G);0!==a.length;){if(t(n=a.pop())&&!n.isLeaf())for(var o=7;o>=0;--o){var s=G[o];n.node.children[s]&&a.push(b.acquire().init(n).advance(s))}b.release(n)}}},{key:"_remove",value:function(e,t,r){D.clear();var i=r.advanceTo(t,(function(e,t){D.push(e.node),D.push(t)}))?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(var n=D.length-2;n>=0;n-=2){var a=D.data[n],o=D.data[n+1];if(!this._purge(a,o))break}}},{key:"_nodeIsEmpty",value:function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}},{key:"_purge",value:function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new c.a({shrink:!0})),!0)}},{key:"_add",value:function(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}},{key:"_split",value:function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var i=b.acquire().init(e);this._add(t.getItemAt(r),i),b.release(i)}}},{key:"_grow",value:function(e,t){var r=this;if(0!==t&&(O(e,t,(function(e){return r._objectToBoundingSphere(e)}),I),S(I[3])&&!this._fitsInsideTree(I)))if(this._nodeIsEmpty(this._root.node))Object(f.d)(I,this._root.bounds),this._root.halfSize=1.25*I[3];else{var i=this._rootBoundsForRootAsSubNode(I);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(I,i):this._growRootAsSubNode(i),b.release(i)}}},{key:"_rebuildTree",value:function(e,t){var r=this;Object(l.k)(L,t.bounds),L[3]=t.halfSize,O([e,L],2,(function(e){return e}),z);var i=b.acquire().init(this._root);this._root.initFrom(null,z,1.25*z[3]),this._forEachNode(i,(function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0})),b.release(i)}},{key:"_placingRootViolatesMaxDepth",value:function(e){var t=this,r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E,i=0;return this._forEachNode(this._root,(function(e){return(i=Math.max(i,e.depth))+r<=t._maximumDepth})),i+r>this._maximumDepth}},{key:"_rootBoundsForRootAsSubNode",value:function(e){for(var t=e[3],r=e,i=-1/0,n=this._root.bounds,a=this._root.halfSize,o=0;o<3;o++){var s=n[o]-a-(r[o]-t),c=r[o]+t-(n[o]+a),l=Math.max(0,Math.ceil(s/(2*a))),u=Math.max(0,Math.ceil(c/(2*a)))+1,d=Math.pow(2,Math.ceil(Math.log(l+u)*Math.LOG2E));i=Math.max(i,d),F[o].min=l,F[o].max=u}for(var h=0;h<3;h++){var f=F[h].min,p=F[h].max,v=(i-(f+p))/2;f+=Math.ceil(v),p+=Math.floor(v);var m=n[h]-a-f*a*2;E[h]=m+(p+f)*a}return E[3]=i*a*k,b.acquire().initFrom(null,E,i*a,0)}},{key:"_growRootAsSubNode",value:function(e){var t=this._root.node;Object(l.k)(I,this._root.bounds),I[3]=this._root.halfSize,this._root.init(e),e.advanceTo(I,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}},{key:"_shrink",value:function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}},{key:"_findShrinkIndex",value:function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,i=0;i<t.length&&null==e;)e=t[r=i++];for(;i<t.length;)if(t[i++])return-1;return r}},{key:"_isDegenerate",value:function(e){return!S(this._objectToBoundingSphere(e)[3])}},{key:"_fitsInsideTree",value:function(e){var t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}}]),e}(),b=function(){function e(){Object(n.a)(this,e),this.bounds=Object(f.b)(),this.halfSize=0,this.initFrom(null,null,0,0)}return Object(a.a)(e,[{key:"init",value:function(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}},{key:"initFrom",value:function(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=Object(o.k)(t)?t:e.createEmptyNode(),Object(o.k)(r)&&Object(f.d)(r,this.bounds),this.halfSize=i,this.depth=n,this}},{key:"advance",value:function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var i=w[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*k,this}},{key:"advanceTo",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}var i=this._childIndex(e);t&&t(this,i),this.advance(i)}}},{key:"isLeaf",value:function(){return null!=this.node.residents}},{key:"isTerminalFor",value:function(e){return e[3]>this.halfSize/2}},{key:"_childIndex",value:function(e){var t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}}],[{key:"createEmptyNode",value:function(){return{children:[null,null,null,null,null,null,null,null],terminals:new c.a({shrink:!0}),residents:new c.a({shrink:!0})}}},{key:"acquire",value:function(){return e._pool.acquire()}},{key:"release",value:function(t){e._pool.release(t)}},{key:"clearPool",value:function(){e._pool.prune()}}]),e}();function m(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function g(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function y(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function O(e,t,r,i){if(1===t){var n=r(e[0]);Object(f.d)(n,i)}else{A[0]=1/0,A[1]=1/0,A[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(var a=0;a<t;a++){var o=r(e[a]);S(o[3])&&(m(A,o),g(R,o))}Object(l.i)(i,A,R,.5),i[3]=Math.max(R[0]-A[0],R[1]-A[1],R[2]-A[2])/2}}function j(e,t,r){if(!V.length)for(var i=0;i<8;++i)V.push({index:0,distance:0});for(var n=0;n<8;++n){var a=w[n];V.data[n].index=n,V.data[n].distance=_(e,t,a)}V.sort((function(e,t){return e.distance-t.distance}));for(var o=0;o<8;++o)r[o]=V.data[o].index}function x(e,t){for(var r=1/0,i=null,n=0;n<8;++n){var a=_(e,t,C[n]);a<r&&(r=a,i=C[n])}return i}function _(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function S(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}b._pool=new s.a(b);var w=[Object(u.g)(-1,-1,-1),Object(u.g)(1,-1,-1),Object(u.g)(-1,1,-1),Object(u.g)(1,1,-1),Object(u.g)(-1,-1,1),Object(u.g)(1,-1,1),Object(u.g)(-1,1,1),Object(u.g)(1,1,1)],C=[Object(u.g)(-1,-1,-1),Object(u.g)(-1,-1,1),Object(u.g)(-1,1,-1),Object(u.g)(-1,1,1),Object(u.g)(1,-1,-1),Object(u.g)(1,-1,1),Object(u.g)(1,1,-1),Object(u.g)(1,1,1)],k=Math.sqrt(3),P=[null];var E=Object(f.b)(),T=Object(u.e)(),A=Object(u.e)(),R=Object(u.e)(),D=new c.a,M=Object(f.b)(),I=Object(f.b)(),L=Object(f.b)(),z=Object(f.b)(),F=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],V=new c.a,G=[0,0,0,0,0,0,0,0]},867:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n=r(563),a=r(713);!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(a.c)(1,1,1),vvSizeMaxSize:Object(a.c)(100,100,100),vvSizeOffset:Object(a.c)(0,0,0),vvSizeFactor:Object(a.c)(1,1,1),vvSizeValue:Object(a.c)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n.b)()}}(i||(i={}));var o=i},868:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i,n,a,o,s,c,l=r(542),u=r(538);function d(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(Object(u.a)(i||(i=Object(l.a)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add("size","float"),e.vertex.code.add(Object(u.a)(n||(n=Object(l.a)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(Object(u.a)(a||(a=Object(l.a)(["uniform float vvOpacityValues[vvOpacityNumber];\nuniform float vvOpacityOpacities[vvOpacityNumber];\nfloat interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):e.vertex.code.add(Object(u.a)(o||(o=Object(l.a)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(Object(u.a)(s||(s=Object(l.a)(["uniform float vvColorValues[vvColorNumber];\nuniform vec4 vvColorColors[vvColorNumber];\nvec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(Object(u.a)(c||(c=Object(l.a)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},869:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i,n,a,o,s=r(542),c=r(580),l=r(748),u=r(715),d=r(538);function h(e,t){t.multipassGeometryEnabled&&e.vertex.include(l.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(Object(d.a)(i||(i=Object(s.a)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassGeometryEnabled?Object(d.a)(n||(n=Object(s.a)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassTerrainEnabled?"depth = projectAux.posView.z;":"")),t.multipassTerrainEnabled&&e.fragment.include(c.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(u.a),e.fragment.code.add(Object(d.a)(a||(a=Object(s.a)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.multipassTerrainEnabled?Object(d.a)(o||(o=Object(s.a)(["\n\n          vec2 uv = gl_FragCoord.xy * inverseViewport;\n\n          //Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);\n\n          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          //Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"]))):""))}},870:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c}));var i=r(26),n=r(7),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat(Object(i.a)(a.dash),Object(i.a)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat(Object(i.a)(a["long-dash"]),Object(i.a)(a.dot)),"long-dash-dot-dot":[].concat(Object(i.a)(a["long-dash"]),Object(i.a)(a.dot),Object(i.a)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat(Object(i.a)(a["short-dash"]),Object(i.a)(a["short-dot"])),"short-dash-dot-dot":[].concat(Object(i.a)(a["short-dash"]),Object(i.a)(a["short-dot"]),Object(i.a)(a["short-dot"])),"short-dot":a["short-dot"],solid:null};function s(e){return Object(n.j)(e)?e:e.slice()}function c(e,t){return Object(n.c)(e,(function(e){return e.map((function(e){return e*t}))}))}function l(e){return Object(n.c)(e,(function(e){return s(o[e])}))}},871:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var i=r(26),n=r(2),a=r(3),o=r(7),s=r(547),c=r(58),l=r(79),u=r(384),d=r(662),h=r(825),f=r(665),p=r(772),v=r(708),b=0,m=function(){function e(t){Object(n.a)(this,e),this._originSR=t,this.ROOT_ORIGIN_ID="rg_root_"+b++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}return Object(a.a)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(o.k)(g))return this._origins.set(this.ROOT_ORIGIN_ID,Object(h.a)(g[0],g[1],g[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e);var r=Object(h.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,r),r}var n=this._gridSize,a=Math.round(e[0]/n),s=Math.round(e[1]/n),l=Math.round(e[2]/n),u="".concat("rg_").concat(a,"/").concat(s,"/").concat(l),d=this._origins.get(u),f=.5*n;if(Object(c.j)(y,e,t.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),y[0]<f&&y[1]<f&&y[2]<f){if(d){var p=Math.max.apply(Math,Object(i.a)(y));if(Object(c.j)(y,e,d.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max.apply(Math,Object(i.a)(y))<p)return d}return t}return d||(d=Object(h.a)(a*n,s*n,l*n,u),this._origins.set(u,d)),d}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,0,1],r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new v.a({width:2,color:t}),i.add(this._material);var a=new p.a({isPickable:!1}),o=new f.a({castShadow:!1});i.add(o),a.add(o),i.add(a),this._objects.set(n,o)}for(var c=this._objects.get(n),l=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],h=l.length,b=new Array(3*h),m=new Uint16Array(2*(h-1)),g=.5*this._gridSize,y=0;y<h;y++)b[3*y+0]=e[0]+(1&l[y]?g:-g),b[3*y+1]=e[1]+(2&l[y]?g:-g),b[3*y+2]=e[2]+(4&l[y]?g:-g),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);Object(u.l)(b,this._originSR,0,b,r.renderSpatialReference,0,h);var O=new d.a([["position",{size:3,data:b,exclusive:!0}]],[["position",m]],2);i.add(O),c.addGeometry(O,this._material,s.a)}},{key:"test",get:function(){var e=this;return{get gridSize(){return e._gridSize},set gridSize(t){e._gridSize=t}}}}]),e}(),g=null;var y=Object(l.e)()},872:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(2),n=r(3),a=r(5),o=r(6),s=r(681),c=r(873),l=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).updateParameters(),n}return Object(n.a)(r,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(c.a,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(2===this._output)return 24===e;if(5===this._output)return 23===e;if(4===this._output)return 3===e||23===e;var t=3;return this._material.params.transparent&&(t=this._material.params.writeDepth?5:8),e===t}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.params.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){return this._technique.ensureResource(e)}},{key:"ensureParameters",value:function(e){0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)}}]),r}(s.a)},873:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return S}));var i=r(2),n=r(3),a=r(5),o=r(6),s=r(0),c=r(557),l=r(575),u=r(568),d=r(643),h=r(842),f=r(794),p=r(642),v=r(609),b=r(618),m=r(624),g=r(619),y=r(613),O=r(610),j=r(827),x=r(544),_=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(e,n,a){var o;return Object(i.a)(this,r),(o=t.call(this,e,n,a))._textureRepository=e.waterTextureRepository,o}return Object(n.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new O.a(e.rctx,n,g.a)}},{key:"ensureResource",value:function(e){return this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(e),this._textureRepository.ready?2:1}},{key:"bindPass",value:function(e,t){Object(p.c)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(u.a)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(h.b)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(f.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(l.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(p.d)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(p.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(d.b)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(c.c)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,r=3===e,i=2===e;return Object(x.f)({blending:2!==t.output&&4!==t.output&&t.transparent?r?y.g:Object(y.a)(e):null,depthTest:{func:Object(y.b)(e)},depthWrite:r?t.writeDepth&&x.d:Object(y.c)(e),colorWrite:x.c,polygonOffset:r||i?null:Object(y.h)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),r}(b.a);_.shader=new v.a(j.a,(function(){return r.e(214).then(r.bind(null,997))}));var S=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).output=0,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(m.a);Object(s.a)([Object(m.b)({count:8})],S.prototype,"output",void 0),Object(s.a)([Object(m.b)()],S.prototype,"receiveShadows",void 0),Object(s.a)([Object(m.b)()],S.prototype,"slicePlaneEnabled",void 0),Object(s.a)([Object(m.b)()],S.prototype,"transparent",void 0),Object(s.a)([Object(m.b)()],S.prototype,"enableOffset",void 0),Object(s.a)([Object(m.b)()],S.prototype,"writeDepth",void 0),Object(s.a)([Object(m.b)()],S.prototype,"useSSR",void 0),Object(s.a)([Object(m.b)()],S.prototype,"isDraped",void 0),Object(s.a)([Object(m.b)({count:4})],S.prototype,"transparencyPassType",void 0),Object(s.a)([Object(m.b)()],S.prototype,"multipassTerrainEnabled",void 0),Object(s.a)([Object(m.b)()],S.prototype,"cullAboveGround",void 0)},875:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return x}));var i,n,a,o,s,c,l,u,d,h,f,p,v=r(542),b=r(557),m=r(792),g=r(728),y=r(748),O=r(538),j=r(561);function x(e){var t=new j.a;return t.include(m.a),t.include(g.a,e),t.include(b.a,e),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassGeometryEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(O.a)(i||(i=Object(v.a)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint = projectPositionHUD(projectAux);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * vec4(position, 1.0)).xyz;\n      ","\n\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint = proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize = lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n    }\n  "])),e.occlusionTestEnabled?Object(O.a)(n||(n=Object(v.a)(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",e.screenSizePerspectiveEnabled?Object(O.a)(a||(a=Object(v.a)(["\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):Object(O.a)(o||(o=Object(v.a)(["\n      vec2 screenOffsetScaled = screenOffset;\n        "]))),e.multipassGeometryEnabled?"depth = posView.z;":"",e.depthHudEnabled?e.depthHudAlignStartEnabled?Object(O.a)(s||(s=Object(v.a)(["endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):Object(O.a)(c||(c=Object(v.a)(["startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",e.screenSizePerspectiveEnabled?Object(O.a)(l||(l=Object(v.a)(["\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):Object(O.a)(u||(u=Object(v.a)(["\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n        "]))))),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("borderColor","vec4"),e.multipassGeometryEnabled&&(t.fragment.include(y.b,e),t.fragment.uniforms.add("inverseViewport","vec2")),t.fragment.code.add(Object(O.a)(d||(d=Object(v.a)(["\n    void main() {\n      ","\n\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha = color.a * borderColor.a * coverage.y;\n      float colorAlpha = color.a * coverage.x;\n\n      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n    ","\n  }\n  "])),e.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":"",e.depthHudEnabled?Object(O.a)(h||(h=Object(v.a)(["\n      if (finalAlpha < 0.01) {\n        discard;\n      }\n      "]))):Object(O.a)(f||(f=Object(v.a)(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor = vec4(finalRgb, finalAlpha);\n      "]))))),t}function _(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}(p||(p={})).bindUniforms=function(e,t,r){_(e,"color",t.color),e.setUniform1f("pixelRatio",r),e.setUniform2f("screenOffset",t.screenOffset[0]*r,t.screenOffset[1]*r),null!==t.borderColor?(_(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",r)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))};var S=Object.freeze({__proto__:null,build:x,get LineCallout(){return p}})},876:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i,n,a,o,s=r(542),c=r(841),l=r(538);function u(e,t){var r=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?r.code.add(Object(l.a)(i||(i=Object(s.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):r.code.add(Object(l.a)(n||(n=Object(s.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(Object(l.a)(a||(a=Object(s.a)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),0!==t.attributeTextureCoordinates&&(e.include(c.a,t),r.uniforms.add("normalTexture","sampler2D"),r.uniforms.add("normalTextureSize","vec2"),r.code.add(Object(l.a)(o||(o=Object(s.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},877:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n=r(542),a=r(538),o=r(549);function s(e,t){var r=Object(a.a)(i||(i=Object(n.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"");Object(o.c)()&&(e.fragment.code.add(r),e.vertex.code.add(r))}},889:function(e,t,r){"use strict";r.d(t,"a",(function(){return K}));var i=r(10),n=r(2),a=r(3),o=r(5),s=r(6),c=r(65),l=r(7),u=r(35),d=r(235),h=r(563),f=r(100),p=r(547),v=r(30),b=r(60),m=r(58),g=r(79);function y(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var O=r(139),j=r(647),x=r(661),_=r(821),S=r(625),w=r(923),C=r(567),k=r(696),P=r(620),E=r(654),T=r(727),A=r(0),R=r(557),D=r(702),M=r(728),I=r(575),L=r(748),z=r(568),F=r(655),V=r(747),G=r(642),U=r(609),B=r(618),N=r(624),H=r(619),q=r(613),W=r(610),Y=r(544),Z=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new W.a(e.rctx,n,H.a)}},{key:"bindPass",value:function(e,t){Object(G.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(D.b)(this.program,e,t),Object(V.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(G.f)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(L.a)(this.program,t),Object(z.a)(this.program,t)):(Object(M.b)(this.program,t),Object(T.c)(this.program,e,t.camera.pixelRatio||1),Object(F.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(I.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(G.d)(this.program,e),Object(G.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(R.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e){var t=this.configuration,r=3===e,i=2===e,n=this.configuration.polygonOffsetEnabled&&X,a=(r||i)&&4!==t.output?(t.depthEnabled||6===t.output)&&Y.d:null;return Object(Y.f)({blending:0===t.output||7===t.output||4===t.output?r?Q:Object(q.a)(e):null,depthTest:{func:515},depthWrite:a,colorWrite:Y.c,polygonOffset:n})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]),r}(B.a);Z.shader=new U.a(T.a,(function(){return r.e(203).then(r.bind(null,1108))}));var X={factor:0,units:-4},Q=Object(Y.h)(1,771),J=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).output=0,e.occlusionTestEnabled=!0,e.sdf=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.screenSizePerspective=!1,e.screenCenterOffsetUnitsEnabled=0,e.debugDrawBorder=!0,e.binaryHighlightOcclusion=!0,e.slicePlaneEnabled=!1,e.polygonOffsetEnabled=!1,e.depthEnabled=!0,e.transparencyPassType=3,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.multipassGeometryEnabled=!1,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return r}(N.a);Object(A.a)([Object(N.b)({count:8})],J.prototype,"output",void 0),Object(A.a)([Object(N.b)()],J.prototype,"occlusionTestEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"sdf",void 0),Object(A.a)([Object(N.b)()],J.prototype,"vvSize",void 0),Object(A.a)([Object(N.b)()],J.prototype,"vvColor",void 0),Object(A.a)([Object(N.b)()],J.prototype,"verticalOffset",void 0),Object(A.a)([Object(N.b)()],J.prototype,"screenSizePerspective",void 0),Object(A.a)([Object(N.b)({count:2})],J.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"debugDrawBorder",void 0),Object(A.a)([Object(N.b)()],J.prototype,"binaryHighlightOcclusion",void 0),Object(A.a)([Object(N.b)()],J.prototype,"slicePlaneEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"polygonOffsetEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"depthEnabled",void 0),Object(A.a)([Object(N.b)({count:4})],J.prototype,"transparencyPassType",void 0),Object(A.a)([Object(N.b)()],J.prototype,"pixelSnappingEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"isDraped",void 0),Object(A.a)([Object(N.b)()],J.prototype,"multipassGeometryEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"multipassTerrainEnabled",void 0),Object(A.a)([Object(N.b)()],J.prototype,"cullAboveGround",void 0);var K=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e,je)).techniqueConfig=new J,i}return Object(a.a)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,r,i,n,a,o,s,c){c?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,r,i,o,s)}},{key:"intersectDrapedHudGeometry",value:function(e,t,r,i){var n=e.vertexAttributes.get("position"),a=e.vertexAttributes.get("size"),o=this.params,s=Object(T.d)(o),c=1,u=1;if(Object(l.k)(i)){var d=i(be);c=d[0],u=d[5]}c*=e.screenToWorldRatio,u*=e.screenToWorldRatio;for(var h=ge*e.screenToWorldRatio,f=0;f<n.data.length/n.size;f++){var p=f*n.size,v=n.data[p],b=n.data[p+1],m=f*a.size,g=void 0;ye[0]=a.data[m]*c,ye[1]=a.data[m+1]*u,o.textureIsSignedDistanceField&&(g=o.outlineSize*e.screenToWorldRatio/2),ie(t,v,b,ye,h,g,o,s)&&r()}}},{key:"intersectHudGeometry",value:function(e,t,r,i,n,a){if(i.options.selectionMode&&i.options.hud&&!Object(E.e)(t)){var o=this.params,s=1,c=1;if(Object(d.f)(de,r),Object(l.k)(a)){var u=a(be);s=u[0],c=u[5],function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(n*n+a*a+o*o),h=1/Math.sqrt(s*s+c*c+l*l);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=c*h,e[8]=l*h}(de)}var h=e.vertexAttributes.get("position"),p=e.vertexAttributes.get("size"),v=e.vertexAttributes.get("normal"),b=e.vertexAttributes.get("auxpos1");Object(C.a)(h.size>=3);var y=i.point,O=i.camera,j=Object(T.d)(o);s*=O.pixelRatio,c*=O.pixelRatio;for(var x="screen"===this.params.centerOffsetUnits,_=0;_<h.data.length/h.size;_++){var S=_*h.size;Object(m.w)(oe,h.data[S],h.data[S+1],h.data[S+2]),Object(m.q)(oe,oe,r);var k=_*p.size;ye[0]=p.data[k]*s,ye[1]=p.data[k+1]*c,Object(m.q)(oe,oe,O.viewMatrix);var P=_*b.size;if(Object(m.w)(pe,b.data[P+0],b.data[P+1],b.data[P+2]),!x&&(oe[0]+=pe[0],oe[1]+=pe[1],0!==pe[2])){var A=pe[2];Object(m.r)(pe,oe),Object(m.j)(oe,oe,Object(m.e)(pe,pe,A))}var R=_*v.size;if(Object(m.w)(se,v.data[R],v.data[R+1],v.data[R+2]),this.normalAndViewAngle(se,de,O,ve),this.applyVerticalOffsetTransformationView(oe,ve,O,ne),O.applyProjection(oe,ce),ce[0]>-1){var D=Math.floor(ce[0])+this.params.screenOffset[0],M=Math.floor(ce[1])+this.params.screenOffset[1];x&&(D+=pe[0],0!==pe[1]&&(M+=Object(w.b)(pe[1],ne.factorAlignment))),Object(w.a)(ye,ne.factor,ye);var I=me*O.pixelRatio,L=void 0;if(o.textureIsSignedDistanceField&&(L=o.outlineSize*O.pixelRatio/2),ie(y,D,M,ye,I,L,o,j)){var z=i.ray;if(Object(m.q)(ue,oe,Object(f.c)(fe,O.viewMatrix)),ce[0]=y[0],ce[1]=y[1],O.unprojectFromRenderScreen(ce,oe)){var F=Object(g.e)();Object(m.k)(F,z.direction);var V=1/Object(m.p)(F);Object(m.e)(F,F,V),n(Object(m.m)(z.origin,oe)*V,F,-1,1,!0,ue)}}}}}}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return!1;var i=r.get("position"),n=e.indices.get("position");return Object(x.b)(i,n,t)}},{key:"createBufferWriter",value:function(){return new _e(this)}},{key:"normalAndViewAngle",value:function(e,t,r,i){return y(t)&&(t=Object(d.f)(he,t)),Object(m.x)(i.normal,e,t),Object(m.q)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=Object(m.h)(le,Oe),i}},{key:"updateScaleInfo",value:function(e,t,r){var i=this.params;i.screenSizePerspective?Object(w.c)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?Object(w.c)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,r,i,n,a,o){var s=this.normalAndViewAngle(t,r,n,ve);return this.applyVerticalGroundOffsetView(e,s,n,o),this.applyVerticalOffsetTransformationView(o,s,n,a),this.applyPolygonOffsetView(o,s,i[3],n,o),this.applyCenterOffsetView(o,i,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,r,i,n){return this.applyCenterOffsetNDC(e,t,r,i),Object(l.k)(n)&&Object(m.k)(n,i),this.applyPolygonOffsetNDC(i,t,r,i),i}},{key:"applyPolygonOffsetView",value:function(e,t,r,i,n){var a=i.aboveGround?1:-1,o=Object(c.p)(r);0===o&&(o=a);var s=a*o;if(this.params.shaderPolygonOffset<=0)return Object(m.k)(n,e);var l=Object(c.d)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-l*l)/l/i.viewport[2];return Object(m.e)(n,e,s>0?u:1/u),n}},{key:"applyVerticalGroundOffsetView",value:function(e,t,r,i){var n=Object(m.p)(e),a=r.aboveGround?1:-1,o=.5*r.computeRenderPixelSizeAtDist(n),s=Object(m.e)(oe,t.normal,a*o);return Object(m.f)(i,e,s),i}},{key:"applyVerticalOffsetTransformationView",value:function(e,t,r,i){var n=this.params;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){var a=Object(m.p)(e);this.updateScaleInfo(i,a,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}var o=Object(m.p)(e),s=n.screenSizePerspectiveAlignment||n.screenSizePerspective,c=Object(P.i)(r,o,n.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(i,o,t.cosAngle),Object(m.e)(t.normal,t.normal,c),Object(m.f)(e,e,t.normal)}},{key:"applyCenterOffsetView",value:function(e,t,r){var i="screen"!==this.params.centerOffsetUnits;return r!==e&&Object(m.k)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(Object(m.r)(se,r),Object(m.f)(r,r,Object(m.e)(se,se,t[2])))),r}},{key:"applyCenterOffsetNDC",value:function(e,t,r,i){var n="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(m.k)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}},{key:"applyPolygonOffsetNDC",value:function(e,t,r,i){var n=this.params.shaderPolygonOffset;if(e!==i&&Object(m.k)(i,e),n){var a=r.aboveGround?1:-1,o=a*Object(c.p)(t[3]);i[2]-=(o||a)*n}return i}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output?new ee(e):4===e.output?new te(e):void 0}},{key:"calculateRelativeScreenBounds",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(O.l)();return re(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}]),r}(S.a),$=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,Object(i.a)(Object(i.a)({},e),e.material.params))).updateParameters(),a}return Object(a.a)(r,[{key:"beginSlot",value:function(e){return e===(this._material.params.drawInSecondSlot?20:19)||23===e}},{key:"updateParameters",value:function(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Z,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}]),r}(_.a),ee=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e))._isOcclusionSlot=!1,i}return Object(a.a)(r,[{key:"beginSlot",value:function(e){if(23===e)return!0;var t=this._material.params.drawInSecondSlot?20:19;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}},{key:"technique",get:function(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Z,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(Z,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}},{key:"bind",value:function(e){var t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}]),r}($),te=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){return Object(n.a)(this,r),t.call(this,Object(i.a)(Object(i.a)({},e),{},{output:4}))}return r}($);function re(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ae;return Object(v.c)(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function ie(e,t,r,i,n,a,o,s){var c=t-n-(s[0]>0?i[0]*s[0]:0),l=c+i[0]+2*n,u=r-n-(s[1]>0?i[1]*s[1]:0),d=u+i[1]+2*n;if(o.textureIsSignedDistanceField){var h=o.distanceFieldBoundingBox;c+=i[0]*h[0],u+=i[1]*h[1],l-=i[0]*(1-h[2]),d-=i[1]*(1-h[3]),c-=a,l+=a,u-=a,d+=a}return e[0]>c&&e[0]<l&&e[1]>u&&e[1]<d}var ne={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ae=Object(b.a)(),oe=Object(g.e)(),se=Object(g.e)(),ce=Object(u.d)(),le=Object(g.e)(),ue=Object(g.e)(),de=Object(h.b)(),he=Object(h.b)(),fe=Object(p.d)(),pe=Object(g.e)(),ve={normal:le,cosAngle:0},be=Object(p.d)(),me=1,ge=2,ye=[0,0],Oe=Object(g.g)(0,0,1),je=Object(i.a)({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(b.e)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1},S.b),xe=Object(j.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2"),_e=function(){function e(t){Object(n.a)(this,e),this.material=t,this.vertexBufferLayout=xe}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){Object(k.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(k.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6);var n,a,o,s,c=t.vertexAttributes.get("uv0").data;if(null==c||c.length<4){var l=this.material.params;n=0,a=0,o=l.texCoordScale[0],s=l.texCoordScale[1]}else n=c[0],a=c[1],o=c[2],s=c[3];o=Math.min(1.99999,o+1),s=Math.min(1.99999,s+1);for(var u=t.indices.get("position").length,d=r.uv0,h=i,f=0;f<u;++f)d.set(h,0,n),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,n),d.set(h,1,s),h+=1,d.set(h,0,n),d.set(h,1,a),h+=1;Object(k.b)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,r.color,i,6);for(var p=t.indices.get("size"),v=t.vertexAttributes.get("size").data,b=p.length,m=r.size,g=i,y=0;y<b;++y)for(var O=v[2*p[y]],j=v[2*p[y]+1],x=0;x<6;++x)m.set(g,0,O),m.set(g,1,j),g+=1;t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(k.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(k.a)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,r.auxpos2,i,6)}}]),e}()},893:function(e,t,r){"use strict";r.d(t,"a",(function(){return B}));var i=r(10),n=r(2),a=r(3),o=r(5),s=r(6),c=r(11),l=r(7),u=r(35),d=r(30),h=r(58),f=r(79),p=r(663),v=r(597),b=r(598),m=r(661),g=r(681),y=r(625),O=r(567),j=r(696),x=r(729),_=r(620),S=r(654),w=r(41),C=r(38),k=r(0),P=r(557),E=r(575),T=r(642),A=r(609),R=r(618),D=r(624),M=r(619),I=r(610),L=r(701),z=r(830),F=r(544),V=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e,i,a){var o;return Object(n.a)(this,r),(o=t.call(this,e,i,a)).stipplePattern=null,o.stippleTextureBind=null,o.stippleTextureRepository=e.stippleTextureRepository,o}return Object(a.a)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),i=this.configuration,n=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new I.a(e.rctx,n,M.a)}},{key:"dispose",value:function(){Object(w.a)(Object(C.a)(r.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if(Object(T.c)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){var r=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){var i=Object(l.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1},n=i.pixelSize,a=i.sdfNormalizer;this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/(n*t.camera.pixelRatio)),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var o=Object(l.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",o[0],o[1],o[2],o.length>3?o[3]:1)}4===this.configuration.output&&Object(E.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(T.d)(this.program,e),Object(P.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){var e=this.configuration,t=Object(F.g)(770,1,771,771),r=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(F.f)({blending:r,depthTest:L.b,depthWrite:i,colorWrite:F.c,stencilWrite:e.sceneHasOcludees?L.h:null,stencilTest:e.sceneHasOcludees?t?L.d:L.c:null})};return 0===e.output?(this._occludeePipelineState=r(!0,e.transparent||e.stippleEnabled?t:null,F.d),r(!1,e.transparent||e.stippleEnabled?t:null,F.d)):r(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),r}(R.a);V.shader=new A.a(z.a,(function(){return r.e(208).then(r.bind(null,1114))}));var G=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.sceneHasOcludees=!1,e}return r}(D.a);Object(k.a)([Object(D.b)({count:8})],G.prototype,"output",void 0),Object(k.a)([Object(D.b)()],G.prototype,"slicePlaneEnabled",void 0),Object(k.a)([Object(D.b)()],G.prototype,"vertexColors",void 0),Object(k.a)([Object(D.b)()],G.prototype,"transparent",void 0),Object(k.a)([Object(D.b)()],G.prototype,"draped",void 0),Object(k.a)([Object(D.b)()],G.prototype,"stippleEnabled",void 0),Object(k.a)([Object(D.b)()],G.prototype,"stippleOffColorEnabled",void 0),Object(k.a)([Object(D.b)()],G.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(k.a)([Object(D.b)()],G.prototype,"sceneHasOcludees",void 0);var U=c.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),B=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e,q)).techniqueConfig=new G,i}return Object(a.a)(r,[{key:"getTechniqueConfig",value:function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1,this.techniqueConfig.draped=!1;var t=Object(l.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(l.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,r,i,n,a,o,s,c){c?Object(_.e)(e,i,a,1,o):this.intersectLineGeometry(e,t,r,i,o)}},{key:"intersectLineGeometry",value:function(e,t,r,i,n){if(i.options.selectionMode&&!Object(S.e)(t))if(Object(O.g)(r)){var a=e.vertexAttributes.get("position").data,o=i.camera,s=re;Object(d.c)(s,i.point);Object(h.w)(ie[0],s[0]-2,s[1]+2,0),Object(h.w)(ie[1],s[0]+2,s[1]+2,0),Object(h.w)(ie[2],s[0]+2,s[1]-2,0),Object(h.w)(ie[3],s[0]-2,s[1]-2,0);for(var c=0;c<4;c++)if(!o.unprojectFromRenderScreen(ie[c],ne[c]))return;Object(v.f)(o.eye,ne[0],ne[1],ae),Object(v.f)(o.eye,ne[1],ne[2],oe),Object(v.f)(o.eye,ne[2],ne[3],se),Object(v.f)(o.eye,ne[3],ne[0],ce);for(var l=Number.MAX_VALUE,u=0;u<a.length-5;u+=3)if(W[0]=a[u]+r[12],W[1]=a[u+1]+r[13],W[2]=a[u+2]+r[14],Y[0]=a[u+3]+r[12],Y[1]=a[u+4]+r[13],Y[2]=a[u+5]+r[14],!(Object(v.t)(ae,W)<0&&Object(v.t)(ae,Y)<0||Object(v.t)(oe,W)<0&&Object(v.t)(oe,Y)<0||Object(v.t)(se,W)<0&&Object(v.t)(se,Y)<0||Object(v.t)(ce,W)<0&&Object(v.t)(ce,Y)<0)){if(o.projectToRenderScreen(W,Q),o.projectToRenderScreen(Y,J),Q[2]<0&&J[2]>0){Object(h.j)(Z,W,Y);var f=o.frustum,b=-Object(v.t)(f[4],W)/Object(h.h)(Z,Object(v.q)(f[4]));Object(h.e)(Z,Z,b),Object(h.f)(W,W,Z),o.projectToRenderScreen(W,Q)}else if(Q[2]>0&&J[2]<0){Object(h.j)(Z,Y,W);var m=o.frustum,g=-Object(v.t)(m[4],Y)/Object(h.h)(Z,Object(v.q)(m[4]));Object(h.e)(Z,Z,g),Object(h.f)(Y,Y,Z),o.projectToRenderScreen(Y,J)}else if(Q[2]<0&&J[2]<0)continue;Q[2]=0,J[2]=0;var y=Object(p.e)(Object(p.f)(Q,J,ee),s);y<l&&(l=y,Object(h.k)(K,W),Object(h.k)($,Y))}var j=i.rayBeginPoint,x=i.rayEndPoint;if(l<4){var _=Number.MAX_VALUE;if(Object(p.a)(Object(p.f)(K,$,ee),Object(p.f)(j,x,te),X)){Object(h.j)(X,X,j);var w=Object(h.p)(X);Object(h.e)(X,X,1/w),_=w/Object(h.m)(j,x)}n(_,X)}}else U.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return!1;var i=r.get("position");return Object(m.a)(i,null,!1,t)}},{key:"createBufferWriter",value:function(){var e=this.params.vertexColors?x.b:x.c;return Object(l.j)(this.params.stipplePattern)?new x.a(e):new H(e.clone().vec3f("auxpos1"))}},{key:"getGLMaterial",value:function(e){return 0===e.output||4===e.output?new N(e):void 0}}]),r}(y.a),N=function(e){Object(o.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(r,[{key:"updateParameters",value:function(){this._technique=this._techniqueRep.releaseAndAcquire(V,this._material.getTechniqueConfig(this._output),this._technique)}},{key:"beginSlot",value:function(e){return 3===e||23===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}},{key:"ensureParameters",value:function(e){0===this._output&&this._updateOccludeeState(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),r}(g.a),H=function(){function e(t){Object(n.a)(this,e),this.vertexBufferLayout=t}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,r,i){Object(j.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i),this.writeAuxpos1(e,t,r,i)}},{key:"writeAuxpos1",value:function(e,t,r,i){var n=r.getField("auxpos1",b.u),a=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;i*=c;for(var u=0;u<a.length;u+=2)for(var d=3*a[u],h=o[d],f=o[d+1],p=o[d+2],v=s[0]*h+s[4]*f+s[8]*p+s[12],m=s[1]*h+s[5]*f+s[9]*p+s[13],g=s[2]*h+s[6]*f+s[10]*p+s[14],y=0;y<2;++y)l[i]=v,l[i+1]=m,l[i+2]=g,i+=c}}]),e}(),q=Object(i.a)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},y.b),W=Object(f.e)(),Y=Object(f.e)(),Z=Object(f.e)(),X=Object(f.e)(),Q=Object(u.d)(),J=Object(u.d)(),K=Object(f.e)(),$=Object(f.e)(),ee=Object(p.d)(),te=Object(p.d)(),re=Object(f.e)(),ie=[Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)()],ne=[Object(f.e)(),Object(f.e)(),Object(f.e)(),Object(f.e)()],ae=Object(v.d)(),oe=Object(v.d)(),se=Object(v.d)(),ce=Object(v.d)()},895:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i,n=r(542),a=r(826),o=r(538);function s(e){e.fragment.code.add(Object(o.a)(i||(i=Object(n.a)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var c,l,u,d,h=r(718),f=r(842);function p(e,t){e.include(h.a,t),e.include(s),e.include(a.a),t.ssrEnabled&&e.include(f.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(Object(o.a)(c||(c=Object(n.a)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),e.fragment.code.add(Object(o.a)(l||(l=Object(n.a)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\nfloat reflectionHit = 0.;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}"])))),t.ssrEnabled?e.fragment.code.add(Object(o.a)(u||(u=Object(n.a)(["vec4 viewPosition = vec4(positionView.xyz, 1.0);\nvec3 viewDir = normalize(viewPosition.xyz);\nvec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\nfloat correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\nvec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\nvec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\nreflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n}\nfloat seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\nreturn tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n}"])))):e.fragment.code.add(Object(o.a)(d||(d=Object(n.a)(["return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n}"]))))}},924:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return l}));r(12);var i=r(567);function n(e,t,r){switch(e){default:return a(t,r);case"square":return o(t,r);case"cross":return c(t,r);case"x":return l(t,r);case"kite":return s(t,r);case"triangle":return u(t,r)}}function a(e,t){for(var r=e,n=new Uint8Array(4*r*r),a=r/2-.5,o=t/2,s=0;s<r;s++)for(var c=0;c<r;c++){var l=c+r*s,u=c-a,d=s-a,h=Math.sqrt(u*u+d*d)-o;h=h/e+.5,Object(i.h)(h,n,4*l)}return n}function o(e,t){return d(e,t,!1)}function s(e,t){return d(e,t,!0)}function c(e,t){return h(e,t,!1)}function l(e,t){return h(e,t,!0)}function u(e,t){for(var r=new Uint8Array(4*e*e),n=-.5,a=Math.sqrt(1.25),o=(e-t)/2,s=0;s<e;s++)for(var c=0;c<e;c++){var l=s*e+c,u=(c-o)/t,d=(s-o+.75)/t,h=-(1*u+n*d)/a,f=(1*(u-1)+n*-d)/a,p=-d,v=Math.max(h,f,p);Object(i.h)(v*t/e+.5,r,4*l)}return r}function d(e,t,r){r&&(t/=Math.SQRT2);for(var n=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,c=.5*e-a-.75,l=a*e+o;if(r){var u=(s+c)/Math.SQRT2;c=(c-s)/Math.SQRT2,s=u}var d=Math.max(Math.abs(s),Math.abs(c))-.5*t;d=d/e+.5,Object(i.h)(d,n,4*l)}return n}function h(e,t,r){r&&(t*=Math.SQRT2);for(var n=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var c=s-.5*e,l=.5*e-o-1,u=o*e+s;if(r){var d=(c+l)/Math.SQRT2;l=(l-c)/Math.SQRT2,c=d}var h=void 0;h=(h=(c=Math.abs(c))>(l=Math.abs(l))?c>n?Math.sqrt((c-n)*(c-n)+l*l):l:l>n?Math.sqrt(c*c+(l-n)*(l-n)):c)/e+.5,Object(i.h)(h,a,4*u)}return a}},935:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g}));var i,n,a,o,s,c,l,u,d,h,f,p=r(542),v=r(716),b=r(538);function m(e,t){e.attributes.add("featureValue","vec4"),e.vertex.code.add(Object(b.a)(i||(i=Object(p.a)(["bool isCapVertex() {\nreturn featureValue.w == 1.0;\n}"])))),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(Object(b.a)(n||(n=Object(p.a)(["vec2 getSize() {\nreturn size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n}"]))))):e.vertex.code.add(Object(b.a)(a||(a=Object(p.a)(["vec2 getSize(){\nreturn size.xy;\n}"])))),t.vvOpacity?(e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(Object(b.a)(o||(o=Object(p.a)(["uniform float vvOpacityValues[vvOpacityNumber];\nuniform float vvOpacityOpacities[vvOpacityNumber];\nvec4 applyOpacity(vec4 color) {\nfloat value = featureValue.z;\nif (value <= vvOpacityValues[0]) {\nreturn vec4( color.xyz, vvOpacityOpacities[0]);\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n}\n}\nreturn vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);\n}"]))))):e.vertex.code.add(Object(b.a)(s||(s=Object(p.a)(["vec4 applyOpacity(vec4 color){\nreturn color;\n}"])))),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(Object(b.a)(c||(c=Object(p.a)(["uniform float vvColorValues[vvColorNumber];\nuniform vec4 vvColorColors[vvColorNumber];\nvec4 getColor() {\nfloat value = featureValue.y;\nif (value <= vvColorValues[0]) {\nreturn applyOpacity(vvColorColors[0]);\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n}\n}\nreturn applyOpacity(vvColorColors[vvColorNumber - 1]);\n}"]))))):e.vertex.code.add(Object(b.a)(l||(l=Object(p.a)(["vec4 getColor(){\nreturn applyOpacity(vec4(1, 1, 1, 1));\n}"])))),e.include(v.a),e.attributes.add("profileRight","vec4"),e.attributes.add("profileUp","vec4"),e.attributes.add("profileVertexAndNormal","vec4"),e.vertex.code.add(Object(b.a)(u||(u=Object(p.a)(["vec3 calculateVPos() {\nvec2 size = getSize();\nvec3 origin = position;\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileVertex = profileVertexAndNormal.xy * size;\nvec2 profileNormal = profileVertexAndNormal.zw;\nfloat positionOffsetAlongProfilePlaneNormal = 0.0;\nfloat normalOffsetAlongProfilePlaneNormal = 0.0;"])))),e.vertex.code.add(Object(b.a)(d||(d=Object(p.a)(["if(!isCapVertex()) {\nvec2 rotationRight = vec2(profileRight.w, profileUp.w);\nfloat maxDistance = length(rotationRight);"])))),e.vertex.code.add(Object(b.a)(h||(h=Object(p.a)(["rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);\nfloat rx = dot(profileVertex, rotationRight);\nif (abs(rx) > maxDistance) {\nvec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);\nfloat ry = dot(profileVertex, rotationUp);\nprofileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n}\n}else{\npositionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];\nnormalOffsetAlongProfilePlaneNormal = profileUp.w;\n}\nvec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\nreturn origin + offset;\n}"])))),e.vertex.code.add(Object(b.a)(f||(f=Object(p.a)(["vec3 localNormal() {\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileNormal = profileVertexAndNormal.zw;\nvec3 normal = right * profileNormal.x + up * profileNormal.y;\nif(isCapVertex()) {\nnormal += forward * profileUp.w;\n}\nreturn normal;\n}"]))))}function g(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}},936:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return E}));var i,n,a,o,s,c,l,u,d,h=r(542),f=r(703),p=r(557),v=r(607),b=r(935),m=r(695),g=r(575),y=r(580),O=r(705),j=r(736),x=r(568),_=r(798),S=r(795),w=r(643),C=r(621),k=r(538),P=r(561);function E(e){var t=new P.a;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(b.a,e),0!==e.output&&7!==e.output||(t.include(v.a,{linearDepth:!1}),e.receiveShadows&&t.include(w.a,e),t.include(f.a,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(k.a)(i||(i=Object(h.a)(["\n      void main() {\n        vpos = calculateVPos();\n        vnormal = normalize(localNormal());\n\n        ","\n        gl_Position = transformPosition(proj, view, vpos);\n\n        ","\n\n        vcolor = getColor();\n      }\n    "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(y.a),t.include(x.b,e)),7===e.output&&(t.include(p.a,e),t.fragment.uniforms.add("camPos","vec3"),t.fragment.uniforms.add("localOrigin","vec3"),t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(Object(k.a)(n||(n=Object(h.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        float combinedOpacity = vcolor.a * opacity;\n        gl_FragColor = vec4(combinedOpacity);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(p.a,e),t.include(j.a,e),t.include(O.a,e),e.receiveShadows&&t.include(w.a,e),t.include(_.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.include(C.a),t.fragment.code.add(Object(k.a)(a||(a=Object(h.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        shadingParams.normalView = vnormal;\n        vec3 normal = shadingNormal(shadingParams);\n        float ssao = evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity = vcolor.a * opacity;\n        albedo += 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor = vec4(shadedColor, combinedOpacity);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),1!==e.output&&3!==e.output||(t.include(v.a,{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(Object(k.a)(o||(o=Object(h.a)(["void main() {\nvpos = calculateVPos();\ngl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}"])))),t.include(p.a,e),t.include(m.a,e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(Object(k.a)(s||(s=Object(h.a)(["void main() {\ndiscardBySlice(vpos);\noutputDepth(depth);\n}"]))))),2===e.output&&(t.include(v.a,{linearDepth:!1}),t.include(S.a,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(Object(k.a)(c||(c=Object(h.a)(["void main(void) {\nvpos = calculateVPos();\nvnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(p.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(k.a)(l||(l=Object(h.a)(["void main() {\ndiscardBySlice(vpos);\nvec3 normal = normalize(vnormal);\nif (gl_FrontFacing == false) normal = -normal;\ngl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n}"]))))),4===e.output&&(t.include(v.a,{linearDepth:!1}),t.include(S.a,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(Object(k.a)(u||(u=Object(h.a)(["void main(void) {\nvpos = calculateVPos();\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(p.a,e),t.include(g.a),t.fragment.code.add(Object(k.a)(d||(d=Object(h.a)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var T=Object.freeze({__proto__:null,build:E})},937:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return F}));var i,n,a,o,s,c,l,u,d,h,f,p,v,b,m,g,y,O,j,x,_,S=r(542),w=r(557),C=r(607),k=r(682),P=r(695),E=r(575),T=r(580),A=r(568),R=r(578),D=r(621),M=r(538),I=r(561),L=.70710678118,z=L;function F(e){var t=new I.a;e.draped||t.extensions.add("GL_OES_standard_derivatives");var r=1===e.output;t.include(C.a,{linearDepth:r}),t.include(k.a,e),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),r&&(t.include(P.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),e.draped?t.vertex.uniforms.add("worldToScreenRatio","float"):(t.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),t.vertex.uniforms.add("camPos","vec3"),t.attributes.add("boundingRect","mat3")),t.attributes.add("position","vec3"),t.attributes.add("uvMapSpace","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");var F=3===e.style||4===e.style||5===e.style;return F&&t.vertex.code.add(Object(M.a)(i||(i=Object(S.a)(["\n      const mat2 rotate45 = mat2(",", ",",\n                                 ",", ",");\n    "])),M.a.float(L),M.a.float(-z),M.a.float(z),M.a.float(L))),e.draped||(t.vertex.code.add(Object(M.a)(n||(n=Object(S.a)(["vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\nfloat projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);\nreturn center + halfVector * clamp(projectedLength, -1.0, 1.0);\n}"])))),t.vertex.code.add(Object(M.a)(a||(a=Object(S.a)(["vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\nfloat d = dot(planeNormal, planePoint);\nfloat t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\nreturn rayOrigin + t * rayDir;\n}"])))),t.vertex.code.add(Object(M.a)(o||(o=Object(S.a)(["\n      float boundingRectDistanceToCamera() {\n        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);\n        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);\n        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);\n        vec3 n = normalize(cross(halfU, halfV));\n\n        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);\n\n        float viewAngle = dot(viewDir, n);\n        float minViewAngle = ",";\n\n        if (abs(viewAngle) < minViewAngle) {\n          // view direction is (almost) parallel to plane -> clamp it to min angle\n          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir = normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint = uProjected + vProjected - center;\n\n        return length(closestPoint - camPos);\n      }\n    "])),M.a.float(.08715574274)))),t.vertex.code.add(Object(M.a)(s||(s=Object(S.a)(["\n    vec2 scaledUV() {\n      vec2 uv = uvMapSpace.xy ",";\n      vec2 uvCellOrigin = uvMapSpace.zw ",";\n\n      ","\n\n      vec2 uvOffset = mod(uvCellOrigin * ratio, ",");\n      return uvOffset + (uv * ratio);\n    }\n  "])),F?" * rotate45":"",F?" * rotate45":"",e.draped?Object(M.a)(c||(c=Object(S.a)(["\n            float ratio = worldToScreenRatio;\n          "]))):Object(M.a)(l||(l=Object(S.a)(["\n            float distanceToCamera = boundingRectDistanceToCamera();\n            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;\n\n            // Logarithmically discretize ratio to avoid jittering\n            float step = 0.1;\n            ratio = log(ratio);\n            ratio = ceil(ratio / step) * step;\n            ratio = exp(ratio);\n          "]))),M.a.float(e.patternSpacing))),t.vertex.code.add(Object(M.a)(u||(u=Object(S.a)(["\n    void main(void) {\n      vuv = scaledUV();\n      vpos = position;\n      ","\n      forwardNormalizedVertexColor();\n      gl_Position = ","\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",r?Object(M.a)(d||(d=Object(S.a)(["transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);"]))):Object(M.a)(h||(h=Object(S.a)(["transformPosition(proj, view, vpos);"]))))),t.include(w.a,e),t.fragment.include(D.a),t.fragment.uniforms.add("matColor","vec4"),e.draped&&t.fragment.uniforms.add("texelSize","float"),4===e.output&&t.include(E.a),e.multipassTerrainEnabled&&(t.fragment.include(T.a),t.include(A.b,e)),4!==e.output&&(t.fragment.code.add(Object(M.a)(f||(f=Object(S.a)(["\n      const float lineWidth = ",";\n      const float spacing = ",";\n      const float spacingINV = ",";\n\n      float coverage(float p, float txlSize) {\n        p = mod(p, spacing);\n\n        float halfTxlSize = txlSize / 2.0;\n\n        float start = p - halfTxlSize;\n        float end = p + halfTxlSize;\n\n        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -= min(lineWidth, mod(start, spacing));\n        coverage -= max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    "])),M.a.float(e.lineWidth),M.a.float(e.patternSpacing),M.a.float(1/e.patternSpacing))),e.draped||t.fragment.code.add(Object(M.a)(p||(p=Object(S.a)(["const int maxSamples = 5;\nfloat sample(float p) {\nvec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));\nfloat fwidth = dxdy.x + dxdy.y;\nivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\nvec2 invSamples = 1.0 / vec2(samples);\nfloat accumulator = 0.0;\nfor (int j = 0; j < maxSamples; j++) {\nif(j >= samples.y) {\nbreak;\n}\nfor (int i = 0; i < maxSamples; i++) {\nif(i >= samples.x) {\nbreak;\n}\nvec2 step = vec2(i,j) * invSamples - 0.5;\naccumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n}\n}\naccumulator /= float(samples.x * samples.y);\nreturn accumulator;\n}"]))))),t.fragment.code.add(Object(M.a)(v||(v=Object(S.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      vec4 color = ","\n      color = highlightSlice(color, vpos);\n\n      ","\n\n      if (color.a < ",") {\n        discard;\n      }\n\n      ","\n\n      ","\n      ","\n      ",";\n    }\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.attributeColor?"vColor * matColor;":"matColor;",4!==e.output?Object(M.a)(b||(b=Object(S.a)(["color.a *= ",";"])),function(e){function t(t){return e.draped?Object(M.a)(j||(j=Object(S.a)(["coverage(vuv.",", texelSize)"])),t):Object(M.a)(x||(x=Object(S.a)(["sample(vuv.",")"])),t)}switch(e.style){case 3:case 0:return t("y");case 4:case 1:return t("x");case 5:case 2:return Object(M.a)(_||(_=Object(S.a)(["\n        1.0 - (1.0 - ",") * (1.0 - ",")\n      "])),t("x"),t("y"));default:return"0.0"}}(e)):"",M.a.float(R.c),7===e.output?Object(M.a)(m||(m=Object(S.a)(["gl_FragColor = vec4(color.a);"]))):"",0===e.output?Object(M.a)(g||(g=Object(S.a)(["gl_FragColor = color; ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",4===e.output?Object(M.a)(y||(y=Object(S.a)(["outputHighlight();"]))):"",1===e.output?Object(M.a)(O||(O=Object(S.a)(["outputDepth(linearDepth);"]))):"")),t}var V=Object.freeze({__proto__:null,build:F})},963:function(e,t,r){"use strict";r.r(t),r.d(t,"fetch",(function(){return ee})),r.d(t,"gltfToEngineResources",(function(){return ie})),r.d(t,"parseUrl",(function(){return re}));var i=r(4),n=r.n(i),a=r(13),o=r(10),s=r(9),c=r(345),l=r(7),u=r(235),d=r(563),h=r(100),f=r(547),p=r(58),v=r(79),b=r(304),m=r(598),g=r(669),y=r(930),O=r(958),j=r(932),x=r(951),_=r(933),S=r(54),w=r(163),C=r(18),k=r(11),P=r(21),E=r(434),T=r(812),A=r(662),R=r(753),D=r(717),M=k.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function I(e,t){return L.apply(this,arguments)}function L(){return(L=Object(s.a)(n.a.mark((function e(t,r){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t,r);case 2:return i=e.sent,e.t0=i,e.next=6,q(i.textureDefinitions,r);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return F.apply(this,arguments)}function F(){return(F=Object(s.a)(n.a.mark((function e(t,r){var i,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=Object(l.k)(r)&&r.streamDataRequester)){e.next=3;break}return e.abrupt("return",V(t,i,r));case 3:return e.next=5,Object(w.c)(Object(S.default)(t,Object(l.s)(r)));case 5:if(!0!==(a=e.sent).ok){e.next=8;break}return e.abrupt("return",a.value.data);case 8:Object(P.u)(a.error),U(a.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t,r){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(n.a.mark((function e(t,r,i){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.c)(r.request(t,"json",i));case 2:if(!0!==(a=e.sent).ok){e.next=5;break}return e.abrupt("return",a.value);case 5:Object(P.u)(a.error),U(a.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){throw new C.a("","Request for object resource failed: ".concat(e))}function B(e){var t=e.params,r=t.topology,i=!0;switch(t.vertexAttributes||(M.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var n=t.faces;if(n){if(t.vertexAttributes)for(var a in t.vertexAttributes){var o=n[a];o&&o.values?(null!=o.valueType&&"UInt32"!==o.valueType&&(M.warn("Unsupported indexed geometry indices type '".concat(o.valueType,"', only UInt32 is currently supported")),i=!1),null!=o.valuesPerElement&&1!==o.valuesPerElement&&(M.warn("Unsupported indexed geometry values per element '".concat(o.valuesPerElement,"', only 1 is currently supported")),i=!1)):(M.warn("Indexed geometry does not specify face indices for '".concat(a,"' attribute")),i=!1)}}else M.warn("Indexed geometries must specify faces"),i=!1;break;default:M.warn("Unsupported topology '".concat(r,"'")),i=!1}e.params.material||(M.warn("Geometry requires material"),i=!1);var s=e.params.vertexAttributes;for(var c in s)s[c].values||(M.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function N(e,t){var r=[],i=[],n=[],a=[],o=e.resource,s=E.a.parse(o.version||"1.0","wosr");X.validate(s);for(var c=o.model.name,u=o.model.geometries,d=o.materialDefinitions,h=e.textures,f=0,p=new Map,b=0;b<u.length;b++){var m=u[b];if(B(m)){var g=Z(m),y=m.params.vertexAttributes,O=[];for(var j in y){var x=y[j],_=x.values;O.push([j,{data:_,size:x.valuesPerElement,exclusive:!0}])}var S=[];if("PerAttributeArray"!==m.params.topology){var w=m.params.faces;for(var C in w)S.push([C,new Uint32Array(w[C].values)])}var k=h&&h[g.texture];if(k&&!p.has(g.texture)){var P=k.image,T=k.params,M=new R.a(P,T);a.push(M),p.set(g.texture,M)}var I=p.get(g.texture),L=I?I.id:void 0,z=n[g.material]?n[g.material][g.texture]:null;if(!z){var F=d[g.material.substring(g.material.lastIndexOf("/")+1)].params;1===F.transparency&&(F.transparency=0);var V=k&&k.alphaChannelUsage,G=F.transparency>0||"transparency"===V||"maskAndTransparency"===V,U=k?Y(k.alphaChannelUsage):void 0,N={ambient:Object(v.f)(F.diffuse),diffuse:Object(v.f)(F.diffuse),opacity:1-(F.transparency||0),transparent:G,textureAlphaMode:U,textureAlphaCutoff:.33,textureId:L,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:F.externalColorMixMode||"tint",textureAlphaPremultiplied:!!k&&!!k.params.preMultiplyAlpha};Object(l.k)(t)&&t.materialParamsMixin&&Object.assign(N,t.materialParamsMixin),z=new D.a(N),n[g.material]||(n[g.material]={}),n[g.material][g.texture]=z}i.push(z);var q=new A.a(O,S);f+=S.position?S.position.length:0,r.push(q)}}return{name:c,stageResources:{textures:a,materials:i,geometries:r},pivotOffset:o.model.pivotOffset,boundingBox:H(r),numberOfVertices:f,lodThreshold:null}}function H(e){var t=Object(b.h)();return e.forEach((function(e){var r=e.boundingInfo;Object(l.k)(r)&&(Object(b.n)(t,r.getBBMin()),Object(b.n)(t,r.getBBMax()))})),t}function q(e,t){return W.apply(this,arguments)}function W(){return(W=Object(s.a)(n.a.mark((function e(t,r){var i,o,s,c,u,d,h,f;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],o=function(e){var n=t[e],a=n.images[0].data;if(!a)return M.warn("Externally referenced texture data is not yet supported"),"continue";var o=n.encoding+";base64,"+a,s="/textureDefinitions/"+e,c="rgba"===n.channels?n.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==Y(c)},d=Object(l.k)(r)&&r.disableTextures?Promise.resolve(null):Object(T.a)(o,r);i.push(d.then((function(e){return{refId:s,image:e,params:u,alphaChannelUsage:c}})))},e.t0=n.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,"continue"!==o(s)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(i);case 12:c=e.sent,u={},d=Object(a.a)(c);try{for(d.s();!(h=d.n()).done;)f=h.value,u[f.refId]=f}catch(p){d.e(p)}finally{d.f()}return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function Z(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var X=new E.a(1,2,"wosr"),Q=r(934),J=r(833),K=r(834),$=r(711);function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,u,d,h,f,p,v,b;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(i=re(Object(c.a)(t))).fileType){e.next=7;break}return e.next=4,r.cache?r.cache.loadWOSR(i.url,r):I(i.url,r);case 4:return a=e.sent,s=N(a,r),e.abrupt("return",{lods:[s],referenceBoundingBox:s.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:a.remove});case 7:return e.next=9,r.cache?r.cache.loadGLTF(i.url,r,r.usePBR):Object(x.a)(new j.a(r.streamDataRequester),i.url,r,r.usePBR);case 9:if(u=e.sent,d=Object(l.i)(u.model.meta,"ESRI_proxyEllipsoid"),u.meta.isEsriSymbolResource&&Object(l.k)(d)&&-1!==u.meta.uri.indexOf("/RealisticTrees/")&&ne(u,d),h=u.meta.isEsriSymbolResource?{usePBR:r.usePBR,isSchematic:!1,treeRendering:u.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:r.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},f=Object(o.a)(Object(o.a)({},r.materialParamsMixin),{},{treeRendering:u.customMeta.esriTreeRendering}),null==i.specifiedLodIndex){e.next=18;break}return p=ie(u,h,f,i.specifiedLodIndex),v=p[0].boundingBox,0!==i.specifiedLodIndex&&(v=ie(u,h,f,0)[0].boundingBox),e.abrupt("return",{lods:p,referenceBoundingBox:v,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 18:return b=ie(u,h,f),e.abrupt("return",{lods:b,referenceBoundingBox:b[0].boundingBox,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ie(e,t,r,i){var n=e.model,a=Object(d.b)(),s=new Array,c=new Map,h=new Map;return n.lods.forEach((function(e,d){if(void 0===i||d===i){var f={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(l.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(b.h)()};s.push(f),e.parts.forEach((function(e){var i=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=n.materials.get(e.material),d=Object(l.k)(e.attributes.texCoord0),p=Object(l.k)(e.attributes.normal),v=function(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}(s.alphaMode);if(!c.has(i)){if(d){if(Object(l.k)(s.textureColor)&&!h.has(s.textureColor)){var j=n.textures.get(s.textureColor),x=Object(o.a)(Object(o.a)({},j.parameters),{},{preMultiplyAlpha:1!==v});h.set(s.textureColor,new R.a(j.data,x))}if(Object(l.k)(s.textureNormal)&&!h.has(s.textureNormal)){var S=n.textures.get(s.textureNormal);h.set(s.textureNormal,new R.a(S.data,S.parameters))}if(Object(l.k)(s.textureOcclusion)&&!h.has(s.textureOcclusion)){var w=n.textures.get(s.textureOcclusion);h.set(s.textureOcclusion,new R.a(w.data,w.parameters))}if(Object(l.k)(s.textureEmissive)&&!h.has(s.textureEmissive)){var C=n.textures.get(s.textureEmissive);h.set(s.textureEmissive,new R.a(C.data,C.parameters))}if(Object(l.k)(s.textureMetallicRoughness)&&!h.has(s.textureMetallicRoughness)){var k=n.textures.get(s.textureMetallicRoughness);h.set(s.textureMetallicRoughness,new R.a(k.data,k.parameters))}}var P=Math.pow(s.color[0],1/Q.a),E=Math.pow(s.color[1],1/Q.a),T=Math.pow(s.color[2],1/Q.a),M=Math.pow(s.emissiveFactor[0],1/Q.a),I=Math.pow(s.emissiveFactor[1],1/Q.a),L=Math.pow(s.emissiveFactor[2],1/Q.a),z=Object(l.k)(s.textureColor)&&d?h.get(s.textureColor):null;c.set(i,new D.a(Object(o.a)(Object(o.a)({},t),{},{transparent:0===v,textureAlphaMode:v,textureAlphaCutoff:s.alphaCutoff,diffuse:[P,E,T],ambient:[P,E,T],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:p?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(l.k)(z)?z.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(l.k)(s.textureNormal)&&d?h.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:Object(l.k)(z)&&!!z.params.preMultiplyAlpha,occlusionTextureId:Object(l.k)(s.textureOcclusion)&&d?h.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(l.k)(s.textureEmissive)&&d?h.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(l.k)(s.textureMetallicRoughness)&&d?h.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[M,I,L],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},r)))}var F=function(e,t){switch(t){case 4:return Object(_.c)(e);case 5:return Object(_.b)(e);case 6:return Object(_.a)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),V=e.attributes.position.count,G=Object(O.a)(m.u,V);Object(g.e)(G,e.attributes.position,e.transform);var U=[["position",{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]],B=[["position",F]];if(Object(l.k)(e.attributes.normal)){var N=Object(O.a)(m.u,V);Object(u.a)(a,e.transform),Object(g.a)(N,e.attributes.normal,a),U.push(["normal",{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]),B.push(["normal",F])}if(Object(l.k)(e.attributes.tangent)){var H=Object(O.a)(m.C,V);Object(u.a)(a,e.transform),Object(y.c)(H,e.attributes.tangent,a),U.push(["tangent",{data:H.typedBuffer,size:H.elementCount,exclusive:!0}]),B.push(["tangent",F])}if(Object(l.k)(e.attributes.texCoord0)){var q=Object(O.a)(m.m,V);Object(J.b)(q,e.attributes.texCoord0),U.push(["uv0",{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),B.push(["uv0",F])}if(Object(l.k)(e.attributes.color)){var W=Object(O.a)(m.J,V);if(4===e.attributes.color.elementCount)e.attributes.color instanceof m.C?Object(y.b)(W,e.attributes.color,255):e.attributes.color instanceof m.J?Object(K.a)(W,e.attributes.color):e.attributes.color instanceof m.H&&Object(y.b)(W,e.attributes.color,1/256);else{Object(K.b)(W,255,255,255,255);var Y=new m.B(W.buffer,0,4);e.attributes.color instanceof m.u?Object(g.d)(Y,e.attributes.color,255):e.attributes.color instanceof m.B?Object($.a)(Y,e.attributes.color):e.attributes.color instanceof m.z&&Object(g.d)(Y,e.attributes.color,1/256)}U.push(["color",{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]),B.push(["color",F])}var Z=new A.a(U,B);f.stageResources.geometries.push(Z),f.stageResources.materials.push(c.get(i)),d&&(Object(l.k)(s.textureColor)&&f.stageResources.textures.push(h.get(s.textureColor)),Object(l.k)(s.textureNormal)&&f.stageResources.textures.push(h.get(s.textureNormal)),Object(l.k)(s.textureOcclusion)&&f.stageResources.textures.push(h.get(s.textureOcclusion)),Object(l.k)(s.textureEmissive)&&f.stageResources.textures.push(h.get(s.textureEmissive)),Object(l.k)(s.textureMetallicRoughness)&&f.stageResources.textures.push(h.get(s.textureMetallicRoughness))),f.numberOfVertices+=V;var X=Z.boundingInfo;Object(l.k)(X)&&(Object(b.n)(f.boundingBox,X.getBBMin()),Object(b.n)(f.boundingBox,X.getBBMax()))}))}})),s}function ne(e,t){for(var r=0;r<e.model.lods.length;++r){var i=e.model.lods[r];e.customMeta.esriTreeRendering=!0;var n,o=Object(a.a)(i.parts);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.attributes.normal;if(Object(l.j)(c))return;for(var u=s.attributes.position,d=u.count,b=Object(v.e)(),g=Object(v.e)(),y=Object(v.e)(),j=Object(O.a)(m.J,d),x=Object(O.a)(m.u,d),_=Object(h.c)(Object(f.d)(),s.transform),S=0;S<d;S++){u.getVec(S,g),c.getVec(S,b),Object(p.q)(g,g,s.transform),Object(p.j)(y,g,t.center),Object(p.b)(y,y,t.radius);var w=y[2],C=Object(p.p)(y),k=Math.min(.45+.55*C*C,1);Object(p.b)(y,y,t.radius),Object(p.q)(y,y,_),Object(p.r)(y,y),r+1!==e.model.lods.length&&e.model.lods.length>1&&Object(p.i)(y,y,b,w>-1?.2:Math.min(-4*w-3.8,1)),x.setVec(S,y),j.set(S,0,255*k),j.set(S,1,255*k),j.set(S,2,255*k),j.set(S,3,255)}s.attributes.normal=x,s.attributes.color=j}}catch(P){o.e(P)}finally{o.f()}}}},964:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r(13),n=r(2),a=r(3),o=(r(12),r(7)),s=r(547),c=r(58),l=r(79),u=r(579),d=function e(){Object(n.a)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},h=r(793),f=r(829),p=r(654),v=1e-5,b=function(){function e(t){Object(n.a)(this,e),this.options=new d,this.results=new h.b,this.transform=new f.a,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=v,this.verticalOffset=null,this._ray={origin:Object(l.e)(),direction:Object(l.e)()},this._rayEndPoint=Object(l.e)(),this._rayStartPointTransformed=Object(l.e)(),this._rayEndPointTransformed=Object(l.e)(),this.viewingMode=null==t?1:t}return Object(a.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}},{key:"reset",value:function(e,t){this.resetWithRay(Object(u.e)(e,t,this._ray))}},{key:"resetWithRay",value:function(e){e!==this._ray&&Object(u.b)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(c.f)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;this.point=r,this.camera=n,this.filterPredicate=s,this.tolerance=null==a?v:a;var l=Object(f.c)(this.verticalOffset);Object(o.k)(t)&&t.length>0&&function(){var r,n=c?function(t){c(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},a=Object(i.a)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=s.getSpatialQueryAccelerator&&s.getSpatialQueryAccelerator();Object(o.k)(u)?(Object(o.k)(l)?u.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,n,l):u.forEachAlongRay(e._ray.origin,e._ray.direction,n),e.options.selectionMode&&e.options.hud&&u.forEachDegenerateObject(n)):s.objects.forAll((function(e){return n(e)}))}}catch(d){a.e(d)}finally{a.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this;this._numObjectsTested++;var r=e.geometryRecords;if(r){var n,a,l=e.id,u=e.transformation,d=Object(f.c)(this.verticalOffset),v=Object(i.a)(r);try{var b=function(){var r=a.value,i=r.geometry,f=r.material,v=r.instanceParameters;if(Object(p.e)(v))return"continue";n=i.id,t.transform.setAndInvalidateLazyTransforms(u,r.getShaderTransformation()),Object(c.q)(t._rayStartPointTransformed,t._ray.origin,t.transform.inverse),Object(c.q)(t._rayEndPointTransformed,t._rayEndPoint,t.transform.inverse);var b=t.transform.transform;Object(o.k)(d)&&(d.objectTransform=t.transform),f.intersect(i,v,t.transform.transform,t,t._rayStartPointTransformed,t._rayEndPointTransformed,(function(r,i,a,c,u,d){if(r>=0){if(Object(o.k)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,r))return;var f="Object3D ".concat(l);if(u)return void((null==t.results.hud.dist||r<t.results.hud.dist)&&t.results.hud.set(e,f,r,i,s.a,c,d,n,a));var p=function(t){return t.set(e,f,r,i,b,c,null,n,a)};if((null==t.results.min.drapedLayerOrder||c>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||r<t.results.min.dist)&&p(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||c<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||r>t.results.max.dist)&&p(t.results.max),2===t.options.store){var v=new h.a(t._ray);p(v),t.results.all.push(v)}}}),r.shaderTransformation)};for(v.s();!(a=v.n()).done;)b()}catch(m){v.e(m)}finally{v.f()}}}},{key:"sortResults",value:function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))}}]),e}();b.DEFAULT_TOLERANCE=v},979:function(e,t,r){"use strict";r.r(t),r.d(t,"create",(function(){return u})),r.d(t,"projectGeometry",(function(){return h}));var i=r(4),n=r.n(i),a=r(9),o=r(74),s=r(18),c=r(93),l=r(805);function u(){return d.apply(this,arguments)}function d(){return d=Object(a.a)(n.a.mark((function e(){var t,i,a,l=arguments;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:null,i=l.length>1?l[1]:void 0,!o.a.geometryServiceUrl){e.next=9;break}return e.next=6,r.e(26).then(r.bind(null,884));case 6:return e.t0=e.sent.default,e.t1={url:o.a.geometryServiceUrl},e.abrupt("return",new e.t0(e.t1));case 9:if(t){e.next=11;break}throw new s.a("internal:geometry-service-url-not-configured");case 11:return a="portal"in t?t.portal||c.a.getDefault():t,e.next=14,a.load({signal:i});case 14:if(!(a.helperServices&&a.helperServices.geometry&&a.helperServices.geometry.url)){e.next=21;break}return e.next=18,r.e(26).then(r.bind(null,884));case 18:return e.t2=e.sent.default,e.t3={url:a.helperServices.geometry.url},e.abrupt("return",new e.t2(e.t3));case 21:throw new s.a("internal:geometry-service-url-not-configured");case 22:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function h(e,t){return f.apply(this,arguments)}function f(){return f=Object(a.a)(n.a.mark((function e(t,r){var i,a,o,c,d,h=arguments;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.length>2&&void 0!==h[2]?h[2]:null,a=h.length>3?h[3]:void 0,e.next=4,u(i,a);case 4:return o=e.sent,(c=new l.a).geometries=[t],c.outSpatialReference=r,e.next=9,o.project(c,{signal:a});case 9:if(!(d=e.sent)||!Array.isArray(d)||1!==d.length){e.next=12;break}return e.abrupt("return",d[0]);case 12:throw new s.a("internal:geometry-service-projection-failed");case 13:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}}}]);
//# sourceMappingURL=52.c5e7e60a.chunk.js.map