"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[3708],{5629:(t,e,n)=>{n.d(e,{f:()=>a});var i=n(71353),o=n(585),r=n(50628);function a(t,e,n){if(null==e||null==n)return null;const i=new o.Z({spatialReference:n});return(0,r.projectBuffer)(t,e,0,s,n,0,1)?(i.x=s[0],i.y=s[1],i.z=s[2],i):null}const s=(0,i.c)()},85305:(t,e,n)=>{n.d(e,{Kf:()=>l,pt:()=>s});n(14226),n(11186);var i=n(71353),o=n(83448),r=(n(78952),n(29691),n(14320),n(82218),n(23470));function a(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return{operations:t,value:t.create()}}(t);return n.operations=t,t.copy(e,n.value),n}function s(t){return a(r.s,(0,r.f)(0,0,0,(0,o.Iu)(t).radius))}function l(t,e,n,i){return t.operations.axisAt(t.value,e,n,i)}(0,i.c)();(0,i.c)()},49076:(t,e,n)=>{n.d(e,{T2:()=>Rt,IJ:()=>zt});var i=n(27366),o=n(52639),r=n(91505),a=n(42537),s=n(92026),l=n(97942),p=n(47898),c=n(94172),u=n(68860),h=n(49861),d=(n(25243),n(63780)),v=(n(93169),n(69912)),g=n(93655),y=n(74509),m=(n(59486),n(84652)),f=n(11186),_=n(71353),b=n(42137),x=n(2170),w=n(69662),C=n(92975),S=n(22018),M=n(89494),T=n(48976),O=n(98131),P=n(14320),I=n(585);function E(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=n?[t,e,n]:[t,e]}function V(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=n?{x:t,y:e,z:n}:{x:t,y:e}}class R{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((t=>this.mapToLocal(t))).filter(d.pC)}get doUnnormalization(){return!1}}class G extends R{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e),this._defaultZ=n,this.transform=(0,M.c)(),this.transformInv=(0,M.c)(),this.transform=(0,M.a)(t),(0,S.i)(this.transformInv,this.transform)}makeMapPoint(t,e){return E(t,e,this._defaultZ)}mapToLocal(t){return V(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return E(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}class Z extends R{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=(0,_.c)(),this.tangentFrameUpWS=(0,_.c)(),this.tangentFrameRightWS=(0,_.c)(),this.tangentFrameForwardWS=(0,_.c)(),this.localFrameRightWS=(0,_.c)(),this.localFrameUpWS=(0,_.c)(),this.worldToLocalTransform=(0,O.a)(),this.localToWorldTransform=(0,O.a)(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,P.R.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,P.R.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,P.R.Z,this.tangentFrameForwardWS);const i=(0,_.c)();(0,f.i)(i,this.tangentFrameForwardWS,(0,f.j)(n,this.tangentFrameForwardWS)),(0,f.f)(this.localFrameRightWS,n,i),(0,f.n)(this.localFrameRightWS,this.localFrameRightWS),(0,f.b)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,T.r)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,T.i)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(t,e){return E(t,e,this.defaultZ)}mapToLocal(t){const e=(0,_.c)();this.view.renderCoordsHelper.toRenderCoords(new I.Z({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),(0,f.v)(e,e,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,this.view.spatialReference);return null!=n?V(n.x/this.scale,n.y/this.scale):null}localToMap(t){const e=(0,_.c)();this.view.renderCoordsHelper.toRenderCoords(new I.Z({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),(0,f.v)(e,e,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,this.view.spatialReference);return null!=n?E(n.x,n.y,this.defaultZ):null}}function z(t,e){if("2d"===t.type)return new G(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if("3d"===t.type){const n=e.length>2?new I.Z({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new I.Z({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Z(t,n)}return null}var D=n(77577),k=n(29909),H=n(80885);function F(t,e){const n=new I.Z({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(n.z=t[2]),n}function A(t,e,n){const i=new k.Z({paths:t,spatialReference:e});return n&&(0,w.nc)(i),i}function W(t,e,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=(0,m.d9)(t);o.forEach((t=>{const e=t[0],n=t[t.length-1];(0,d.fS)(e,n)&&1!==t.length||t.push(t[0])}));let r=new H.Z({rings:o,spatialReference:e});return r.rings.forEach((t=>{(0,w.bu)(t)||t.reverse()})),n&&(0,w.nc)(r),i&&r.isSelfIntersecting&&(0,C.JY)(e)&&(r=(0,x.simplify)(r)),r}function U(t,e,n){const i=e.mapToLocalMultiple(t),o=[],r={x:i[0].x,y:i[0].y},a=i[1].x,s=i[1].y,l=Math.round(a-r.x),p=Math.round(s-r.y),c=Math.max(Math.abs(l),Math.abs(p));if(n){const t={x:r.x+c,y:r.y+c},e={x:r.x-c,y:r.y-c};o.push(V(t.x,e.y),V(e.x,e.y),V(e.x,t.y),V(t.x,t.y))}else{const t={x:l>0?r.x+c:r.x-c,y:p>0?r.y+c:r.y-c};o.push(V(r.x,r.y),V(t.x,r.y),V(t.x,t.y),V(r.x,t.y))}return L(W([o.map((t=>e.localToMap(t))).filter(d.pC)],e.spatialReference,e.doUnnormalization,!0),o,e)}function L(t,e,n){const i=N(e[3],e[2],n),o=N(e[1],e[2],n),r=N(e[0],e[1],n),a=N(e[0],e[3],n);return{geometry:t,midpoints:null!=i&&null!=o&&null!=r&&null!=a?{top:i,right:o,bottom:r,left:a}:null}}function N(t,e,n){Y[0]=t.x,Y[1]=t.y,Y[2]=0,j[0]=e.x,j[1]=e.y,j[2]=0,(0,f.p)(Y,Y,j,.5),q.x=Y[0],q.y=j[1],q.z=j[2];const i=n.localToMap(q);return null!=i?F(i,n.spatialReference):null}const q=V(0,0,0),Y=(0,_.c)(),j=(0,_.c)();function Q(t,e,n,i){const o=e.mapToLocalMultiple(t);let r=null,a=null;if(n)r=o[0],a=o[1];else{const t=o[0],e=o[1],n=Math.round(e.x-t.x),i=Math.round(e.y-t.y),s=Math.max(Math.abs(n),Math.abs(i));r=V(n>0?t.x+s/2:t.x-s/2,i>0?t.y+s/2:t.y-s/2),a=V(Math.abs(n)>Math.abs(i)?r.x-s/2:r.x,Math.abs(n)>Math.abs(i)?r.y:r.y-s/2)}const s=e.localToMap(r),l=e.localToMap(a);if(null==s||null==l)return null;e.doUnnormalization&&(0,w.Sq)([[s,l]],e.spatialReference);const p=F(s,e.spatialReference),c=F(l,e.spatialReference),h=(0,u.c9)(e.spatialReference);let d=0;if((0,C.JY)(e.spatialReference))d=h*(0,x.distance)(p,c,null);else{const t=r.x-a.x,e=r.y-a.y;d=h*Math.sqrt(t*t+e*e)*(i||1)}const v=new b.Z({center:p,radius:d,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:W(v.rings,v.spatialReference,!1),center:p,edge:c}}var X=n(86547),B=n(29919),J=n(87888),K=n(52349),$=n(77560),tt=n(5986),et=n(85305),nt=n(44179),it=n(38054),ot=n(88396),rt=n(6394),at=n(78952),st=n(5629),lt=n(94393),pt=n(15559);const ct=(()=>{const t=(0,_.c)(),e=(0,_.c)(),n=(0,_.c)();return(i,o)=>{var r,a;if((0,f.s)(e,i.x,i.y,null!==(r=i.z)&&void 0!==r?r:0),(0,f.s)(n,o.x,o.y,null!==(a=o.z)&&void 0!==a?a:0),(0,f.h)(e,n))return null;if(!(0,lt.k)(e,i.spatialReference,e)||!(0,lt.k)(n,o.spatialReference,n)){(0,f.f)(t,n,e),t[2]=0,(0,f.n)(t,t);let i=(0,ot.x)(rt.e,t);return t[0]<0&&(i=2*Math.PI-i),(0,p.GJ)(i,"radians","geographic")}const{azimuth:s}=(0,pt.cA)(ht,e,n);return null!=s?(0,p.GJ)(s,"degrees","geographic"):void 0}})(),ut=(()=>{const t=(0,_.c)(),e=(0,_.c)();return(n,i,o)=>{let{x:r,y:a,z:s,spatialReference:l}=n;const c=null!==s&&void 0!==s?s:0;(0,f.s)(t,r,a,c);const h=(0,p.hw)((0,u.En)(o.value,o.unit,"degrees"),o.rotationType,"geographic");if(!(0,tt.S)(t,l,t,at.Z.WGS84)){const t=(0,p.hw)(h,"geographic","arithmetic"),e=(0,u.En)(t,"degrees","radians");return new I.Z({x:r+i*Math.cos(e),y:a+i*Math.sin(e),z:c,spatialReference:l})}return(0,pt.TB)(e,t,h,i),e[2]=c,(0,st.f)(e,at.Z.WGS84,l)}})(),ht=new pt._q;var dt=n(25003);function vt(t,e,n,i){if(!e)return;const{spatialReference:o}=t;if(!(0,u.j5)(o))return;const r=(0,dt.m)(o),a=(0,u.j5)(r);if(!a)return;const s=(0,it.SN)(t,n,i),l=mt;if(!(0,tt.S)(s,o,l,r))return;const c=(0,p.mE)(e,a);if("3d"===(null===n||void 0===n?void 0:n.type)&&"local"===n.viewingMode)l[0]+=c;else{const t=(0,et.pt)(r),e=(0,et.Kf)(t,l,P.R.X,ft);(0,f.q)(l,l,e,c)}if(!(0,tt.S)(l,r,l,o))return;const h=(0,f.o)(s,l);return new nt.LM(s,h)}function gt(t,e,n,i){if(!e)return;const o=(0,it.SN)(t,n,i),r=ut(t,1,e);if(!r)return;const a=(0,it.SN)(r,n,i);return new nt.aU(o,a)}function yt(t,e,n,i){if(null==t)return;const o=(0,dt.m)(e),r=(0,u.y)(o);return r?new nt.SP((0,p.mE)(t,r)):void 0}const mt=(0,_.c)(),ft=(0,_.c)();var _t=n(4943),bt=n(40545);let xt=class extends _t.h{constructor(t){super(t),this.type="draw-point",this.elevation=(0,bt.do)()}get allFields(){return[this.elevation]}};(0,i._)([(0,h.Cb)()],xt.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],xt.prototype,"elevation",void 0),(0,i._)([(0,h.Cb)()],xt.prototype,"allFields",null),(0,i._)([(0,h.Cb)()],xt.prototype,"helpMessage",void 0),xt=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawPointTooltipInfo")],xt);let wt=class extends _t.h{constructor(t){super(t),this.type="draw-polyline",this.orientation=(0,bt.Zq)(),this.distance=(0,bt.wD)({title:t=>t.messages.sketch.distance}),this.elevation=(0,bt.do)(),this.totalLength=(0,bt.wD)({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.totalLength]}};(0,i._)([(0,h.Cb)()],wt.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],wt.prototype,"orientation",void 0),(0,i._)([(0,h.Cb)()],wt.prototype,"distance",void 0),(0,i._)([(0,h.Cb)()],wt.prototype,"elevation",void 0),(0,i._)([(0,h.Cb)()],wt.prototype,"totalLength",void 0),(0,i._)([(0,h.Cb)()],wt.prototype,"allFields",null),(0,i._)([(0,h.Cb)()],wt.prototype,"helpMessage",void 0),wt=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],wt);let Ct=class extends _t.h{constructor(t){super(t),this.type="draw-polygon",this.orientation=(0,bt.Zq)(),this.distance=(0,bt.wD)({title:t=>t.messages.sketch.distance}),this.elevation=(0,bt.do)(),this.area=(0,bt.UR)({readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.area]}};(0,i._)([(0,h.Cb)()],Ct.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],Ct.prototype,"distance",void 0),(0,i._)([(0,h.Cb)()],Ct.prototype,"elevation",void 0),(0,i._)([(0,h.Cb)()],Ct.prototype,"area",void 0),(0,i._)([(0,h.Cb)()],Ct.prototype,"allFields",null),(0,i._)([(0,h.Cb)()],Ct.prototype,"helpMessage",void 0),Ct=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],Ct);let St=class extends _t.h{constructor(t){super(t),this.type="draw-mesh",this.elevation=(0,bt.do)()}get allFields(){return[this.elevation]}};(0,i._)([(0,h.Cb)()],St.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],St.prototype,"elevation",void 0),(0,i._)([(0,h.Cb)()],St.prototype,"allFields",null),(0,i._)([(0,h.Cb)()],St.prototype,"helpMessage",void 0),St=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],St);let Mt=class extends _t.h{constructor(t){super(t),this.type="draw-rectangle",this.xSize=p.yP,this.ySize=p.yP,this.area=p.MQ}get allFields(){return[]}};(0,i._)([(0,h.Cb)()],Mt.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],Mt.prototype,"xSize",void 0),(0,i._)([(0,h.Cb)()],Mt.prototype,"ySize",void 0),(0,i._)([(0,h.Cb)()],Mt.prototype,"area",void 0),(0,i._)([(0,h.Cb)()],Mt.prototype,"allFields",null),Mt=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],Mt);let Tt=class extends _t.h{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=p.MQ}get allFields(){return[]}};(0,i._)([(0,h.Cb)()],Tt.prototype,"type",void 0),(0,i._)([(0,h.Cb)()],Tt.prototype,"radius",void 0),(0,i._)([(0,h.Cb)()],Tt.prototype,"xSize",void 0),(0,i._)([(0,h.Cb)()],Tt.prototype,"ySize",void 0),(0,i._)([(0,h.Cb)()],Tt.prototype,"area",void 0),(0,i._)([(0,h.Cb)()],Tt.prototype,"allFields",null),Tt=(0,i._)([(0,v.j)("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],Tt);var Ot=n(73476),Pt=n(64357),It=n(59418),Et=n(27088);class Vt{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let Rt=class extends(r.Z.EventedMixin(B.m)){constructor(t){super(t),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new K.Z,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new $.Z,this._getPointConstraint=(0,l.H)((t=>t)),this._getPolylineOrPolygonConstraint=(0,l.H)(((t,e,n)=>function(t){let e;for(const o of t){var n,i;o&&(e=null!==(n=null===(i=e)||void 0===i?void 0:i.intersect(o))&&void 0!==n?n:o)}return e}([t,e,n]))),this._getDistanceConstraint=(0,l.H)(vt),this._getOrientationConstraint=(0,l.H)(gt),this._getElevationConstraint=(0,l.H)(yt)}initialize(){this.internalGraphicsLayer=new g.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation();const t=this.tooltipOptions,e=this.view.type;this.tooltipInfos={point:new xt({tooltipOptions:t,viewType:e}),polyline:new wt({tooltipOptions:t,viewType:e}),polygon:new Ct({tooltipOptions:t,viewType:e}),mesh:new St({tooltipOptions:t,viewType:e}),rectangle:new Mt({tooltipOptions:t}),circle:new Tt({tooltipOptions:t})},this.addHandles([this.drawOperation.on("vertex-add",(t=>this.onVertexAdd(t))),this.drawOperation.on("vertex-remove",(t=>this.onVertexRemove(t))),this.drawOperation.on("vertex-update",(t=>this.onVertexUpdate(t))),this.drawOperation.on("cursor-update",(t=>this.onCursorUpdate(t))),this.drawOperation.on("complete",(t=>this.onComplete(t))),(0,c.YP)((()=>this.cursor),(t=>{this.drawOperation.cursor=t}),c.tX),(0,c.YP)((()=>this.tooltipOptions.enabled),(t=>{this.tooltip=t?new Ot.u({view:this.view,info:this._tooltipInfo}):(0,s.SC)(this.tooltip)}),c.tX),(0,Et.EH)((()=>this._updateTooltipInfo()))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,s.SC)(this.drawOperation),this.tooltip=(0,s.SC)(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,s.SC)(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return(0,p.yG)(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}get updating(){var t,e;return null!==(t=null===(e=this.drawOperation)||void 0===e?void 0:e.updating)&&void 0!==t&&t}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){const e=this._tooltipInfo;if("key-down"===t.type&&t.key===J.T6.enterInputMode&&null!=e&&e.editableFields.length>0&&this.tooltipOptions.inputEnabled)return e.enterInputMode(),void t.stopPropagation();this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.removeHandles(Zt.outline),this.removeHandles(Zt.regularVertices),this.removeHandles(Zt.activeVertex),this.removeHandles(Gt)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(this._graphic,t),this._graphic;const e=this._graphic=new o.Z({...this.graphicProperties,symbol:this.graphicSymbol});return this.updateGraphicGeometry(e,t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles((0,a.kB)((()=>{this.internalGraphicsLayer.remove(e),(0,s.SC)(e),this._graphic===e&&(this._graphic=null)})),Gt),e}updateGraphicGeometry(t,e){t.geometry=e}_getCreateOperationGeometry(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};const{drawOperation:n}=this;if(null==n||0===n.numVertices)return null;const{coordinateHelper:i,view:o}=n,r=n.stagedVertex,a=n.committedVertices,s=a.slice(),l=null!=r;l&&s.push(i.pointToArray(r));const p=l?i.pointToArray(r):a.splice(-1)[0],c=s.length,u=o.spatialReference,h="3d"===o.type&&"global"===o.viewingMode,v=new Vt;switch(this.geometryType){case"point":case"mesh":v.regularVertices=a,v.activeVertex=p,v.full=i.arrayToPoint(s[0]);break;case"multipoint":v.regularVertices=a,v.activeVertex=p,c>0&&(v.full=function(t,e){return new D.Z({points:t,spatialReference:e})}(s,u));break;case"polyline":v.regularVertices=a,v.activeVertex=p,c>0&&(v.full=A([s],u,h));break;case"polygon":v.regularVertices=a,v.activeVertex=p,c>0&&(v.full=W([s],u,h,!0));break;case"circle":if(c>0){const t=z(o,s[0]);if(1===c&&e.operationComplete){const e=s[0],n=t.makeMapPoint(e[0]+Dt*o.resolution,e[1]);v.circle=Q([e,n],t,!0),v.full=null!=v.circle?v.circle.geometry:null}else 2===c&&(this.forceUniformSize?(v.circle=Q(s,t,this.centered),v.full=null!=v.circle?v.circle.geometry:null):(v.rectangle=function(t,e,n){const i=e.mapToLocalMultiple(t),o=i[0],r=i[1],a=Math.round(r.x-o.x),s=Math.round(r.y-o.y),l=V(n?o.x:o.x+a/2,n?o.y:o.y+s/2),p=n?a:a/2,c=n?s:s/2,u=[],h=2*Math.PI/60;function v(t){const e=Math.cos(t),n=Math.sin(t);return V(p*e+l.x,c*n+l.y)}for(let d=0;d<60;d++)u.push(v(d*h));u.push(u[0]);const{spatialReference:g,doUnnormalization:y}=e,m=W([u.map((t=>e.localToMap(t))).filter(d.pC)],g,y,!1),f=e.localToMap(v(Math.PI/2)),_=e.localToMap(v(0)),b=e.localToMap(v(-Math.PI/2)),x=e.localToMap(v(Math.PI));return{geometry:m,midpoints:null!=f&&null!=_&&null!=b&&null!=x?{top:F(f,g),right:F(_,g),bottom:F(b,g),left:F(x,g)}:null}}(s,t,this.centered),v.full=v.rectangle.geometry))}break;case"rectangle":if(c>0){const t=z(o,s[0]);if(1===c&&e.operationComplete){const e=s[0],n=t.makeMapPoint(e[0]+Dt*o.resolution,e[1]);v.rectangle=U([e,n],t,!0),v.full=v.rectangle.geometry}else 2===c&&(v.rectangle=this.forceUniformSize?U(s,t,this.centered):function(t,e,n){let i=e.mapToLocalMultiple(t);if(1===i.length){const t=48,e=i[0];i=[V(e.x-t,e.y+t),V(e.x+t,e.y-t),V(e.x+t,e.y-t),V(e.x-t,e.y+t)]}const o=[],r={x:i[0].x,y:i[0].y},a={x:i[1].x,y:i[1].y};if(n){const t=Math.round(a.x-r.x),e=Math.round(a.y-r.y);o.push(V(r.x-t,r.y-e),V(a.x,r.y-e),V(a.x,a.y),V(r.x-t,a.y))}else o.push(V(r.x,r.y),V(a.x,r.y),V(a.x,a.y),V(r.x,a.y));return L(W([o.map((t=>e.localToMap(t))).filter(d.pC)],e.spatialReference,e.doUnnormalization,!0),o,e)}(s,t,this.centered),v.full=v.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":v.outline=c>1?A([s],u,h):null;break;case"polygon":v.outline=c>1?W([s],u,h):null;break;case"circle":case"rectangle":v.outline="polygon"===(null===(t=v.full)||void 0===t?void 0:t.type)?W(v.full.rings,u,h):null}return v}initializeGraphic(t){return(0,a.kB)()}onComplete(t){this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(t){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-add",t)}onVertexRemove(t){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),Zt.outline):this.removeHandles(Zt.outline),null!=t.regularVertices?this.addHandles(this.onRegularVerticesChanged(t.regularVertices),Zt.regularVertices):this.removeHandles(Zt.regularVertices),null!=t.activeVertex?this.addHandles(this.onActiveVertexChanged(t.activeVertex),Zt.activeVertex):this.removeHandles(Zt.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(Gt)):this._destroyAllVisualisations()}get _tooltipInfo(){var t;const{drawOperation:e,graphic:n,view:i}=this;if(!e)return null;const o=this.tooltipInfos,r=null===n||void 0===n||null===(t=n.geometry)||void 0===t?void 0:t.type;switch(this.geometryType){case"point":return"2d"===i.type&&0===this.defaultZ?null:"point"===r?o.point:null;case"polyline":return"polyline"===r?o.polyline:null;case"polygon":return"polygon"===r?o.polygon:null;case"rectangle":return"polygon"===r?o.rectangle:null;case"circle":return"polygon"===r?o.circle:null;case"mesh":return"mesh"===r?o.mesh:null;default:return null}}_updateTooltipInfo(){const{_tooltipInfo:t,tooltip:e}=this;if(t&&e){switch(t.type){case"draw-point":this._updateDrawPointTooltipInfo(t);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(t);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(t);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(t);break;case"draw-circle":this._updateDrawCircleTooltipInfo(t);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(t)}e.info=t}}_updateDrawPointTooltipInfo(t){const{drawOperation:e,graphic:n,view:i,tooltipOptions:o}=this,{elevationInfo:r,stagedVertex:a}=e;if(t.tooltipOptions=o,t.viewType=i.type,t.helpMessage=(0,X.A)("point",null===n||void 0===n?void 0:n.geometry),this.updateElevation(t.elevation),!a)return void(e.constraint=void 0);const s=e.coordinateHelper.spatialReference;e.constraint=this._getPointConstraint(this._getElevationConstraint(t.elevation.committed,s,i,r))}_updateDrawPolylineTooltipInfo(t){const e=this._createOperationGeometry,n=null!=e?e.full:null;if("polyline"!==(null===n||void 0===n?void 0:n.type))return;const{drawOperation:i,tooltipOptions:o,view:r}=this,{lastVertex:a,stagedVertex:s}=i;this._updatePolylineOrPolygonCommon(t,s);const l=(0,It.Ul)(n,this._elevationMode);t.totalLength.actual=null!==l&&void 0!==l?l:p.yP,t.totalLength.hidden=null==length||!a,t.tooltipOptions=o,t.viewType=r.type,t.helpMessage=(0,X.A)("polyline",n),this.updateElevation(t.elevation)}_updateDrawPolygonTooltipInfo(t){const e=this._createOperationGeometry,n=null!=e?e.full:null;if("polygon"!==(null===n||void 0===n?void 0:n.type))return;const{drawOperation:i,tooltipOptions:o,view:r}=this,{lastVertex:a}=i;let s=i.stagedVertex;"polygon"===(null===n||void 0===n?void 0:n.type)&&a&&!s&&(s=n.getPoint(0,n.rings[0].length-1)),this._updatePolylineOrPolygonCommon(t,s);const l=(0,Pt.k)(n,this._elevationMode);t.area.actual=null!==l&&void 0!==l?l:p.MQ,t.area.hidden=null==l&&!a,t.tooltipOptions=o,t.viewType=r.type,t.helpMessage=(0,X.A)("polygon",n),this.updateElevation(t.elevation)}_updatePolylineOrPolygonCommon(t,e){const{view:n,drawOperation:i}=this,{elevationInfo:o,lastVertex:r}=i;if(!r||!e)return t.distance.hidden=!0,t.orientation.hidden=!0,void(i.constraint=void 0);const a=(0,It.FQ)(r,e,this._elevationMode);t.distance.actual=null!==a&&void 0!==a?a:p.yP,t.distance.hidden=!1;const s=ct(r,e);t.orientation.actual=null!==s&&void 0!==s?s:p.Ww,t.orientation.hidden=!1;const l=i.coordinateHelper.spatialReference;i.constraint=this._getPolylineOrPolygonConstraint(this._getDistanceConstraint(r,t.distance.committed,n,o),this._getOrientationConstraint(r,t.orientation.committed,n,o),this._getElevationConstraint(t.elevation.committed,l,n,o))}updateDrawMeshTooltipInfo(t){}_updateDrawRectangleTooltipInfo(t){var e,n,i;t.tooltipOptions=this.tooltipOptions,t.xSize=null!==(e=this._xSize)&&void 0!==e?e:p.yP,t.ySize=null!==(n=this._ySize)&&void 0!==n?n:p.yP,t.area=null!==(i=this._fullGeometryArea)&&void 0!==i?i:p.MQ}_updateDrawCircleTooltipInfo(t){var e,n,i,o;const{forceUniformSize:r}=this;t.tooltipOptions=this.tooltipOptions,t.radius=r?null!==(e=this._circleRadius)&&void 0!==e?e:p.yP:null,t.xSize=r?null:null!==(n=this._xSize)&&void 0!==n?n:p.yP,t.ySize=r?null:null!==(i=this._ySize)&&void 0!==i?i:p.yP,t.area=null!==(o=this._fullGeometryArea)&&void 0!==o?o:p.MQ}get _circleRadius(){var t;const e=this._createOperationGeometry;return null!=(null===e||void 0===e||null===(t=e.circle)||void 0===t?void 0:t.center)&&null!=e.circle.edge?(0,It.GQ)(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){var t;const e=null===(t=this._createOperationGeometry)||void 0===t||null===(t=t.rectangle)||void 0===t?void 0:t.midpoints;return null!=e?(0,It.GQ)(e.left,e.right,this._elevationMode):null}get _ySize(){var t;const e=null===(t=this._createOperationGeometry)||void 0===t||null===(t=t.rectangle)||void 0===t?void 0:t.midpoints;return null!=e?(0,It.GQ)(e.top,e.bottom,this._elevationMode):null}get _fullGeometryArea(){var t;const e=null===(t=this._createOperationGeometry)||void 0===t?void 0:t.full;return"polygon"!==(null===e||void 0===e?void 0:e.type)?null:(0,Pt.k)(e,this._elevationMode)}updateElevation(t){t.actual=this._vertexTooltipElevation}get _vertexTooltipElevation(){var t,e;const{tooltipOptions:n,view:i,drawOperation:o}=this;if(null==o)return this._defaultElevation;const r=null!==(t=o.stagedVertex)&&void 0!==t?t:o.lastVertex;if(null==r||"2d"===i.type)return this._defaultElevation;const a={mode:n.elevation.mode,offset:0},s=(null!==(e=(0,y.vQ)(i,r,o.elevationInfo,a))&&void 0!==e?e:0)*(0,u._R)(r.spatialReference);return(0,p.yG)(s,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}_clearConstraints(){for(const[,t]of Object.entries(this.tooltipInfos))t.unlockAllFields()}};(0,i._)([(0,h.Cb)()],Rt.prototype,"_createOperationGeometry",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"_defaultElevation",null),(0,i._)([(0,h.Cb)({value:!0})],Rt.prototype,"centered",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"cursor",null),(0,i._)([(0,h.Cb)({nonNullable:!0})],Rt.prototype,"defaultZ",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"drawOperation",void 0),(0,i._)([(0,h.Cb)({value:!0})],Rt.prototype,"enabled",null),(0,i._)([(0,h.Cb)({value:!0})],Rt.prototype,"forceUniformSize",null),(0,i._)([(0,h.Cb)({constructOnly:!0})],Rt.prototype,"geometryType",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"graphic",null),(0,i._)([(0,h.Cb)({constructOnly:!0})],Rt.prototype,"graphicProperties",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"graphicSymbol",null),(0,i._)([(0,h.Cb)({constructOnly:!0})],Rt.prototype,"hasZ",void 0),(0,i._)([(0,h.Cb)({constructOnly:!0,type:K.Z})],Rt.prototype,"labelOptions",void 0),(0,i._)([(0,h.Cb)({constructOnly:!0})],Rt.prototype,"geometryToPlace",void 0),(0,i._)([(0,h.Cb)({constructOnly:!0})],Rt.prototype,"mode",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"snappingManager",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"snapToScene",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"tooltip",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"tooltipInfos",void 0),(0,i._)([(0,h.Cb)({constructOnly:!0,type:$.Z})],Rt.prototype,"tooltipOptions",void 0),(0,i._)([(0,h.Cb)({readOnly:!0})],Rt.prototype,"type",void 0),(0,i._)([(0,h.Cb)({readOnly:!0})],Rt.prototype,"updating",null),(0,i._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Rt.prototype,"view",void 0),(0,i._)([(0,h.Cb)()],Rt.prototype,"_tooltipInfo",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_circleRadius",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_xSize",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_ySize",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_fullGeometryArea",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_vertexTooltipElevation",null),(0,i._)([(0,h.Cb)()],Rt.prototype,"_elevationMode",null),Rt=(0,i._)([(0,v.j)("esri.views.draw.DrawGraphicTool")],Rt);const Gt="create-operation-graphic",Zt={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function zt(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Dt=48},71719:(t,e,n)=>{n.d(e,{wW:()=>R});var i=n(27366),o=n(7138),r=n(91505),a=n(84652),s=n(92026),l=n(66978),p=n(94172),c=n(17842),u=n(49861),h=(n(25243),n(69912)),d=n(48732),v=n(46634),g=n(70178),y=n(74509),m=n(50951);const f="click";class _{constructor(t){let{grabbableForEvent:e}=t;this.events=new r.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=!0,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var b=n(14813),x=n(74229),w=n(84954),C=n(87268),S=n(38054),M=n(52349),T=n(77560),O=n(34019),P=n(80151),I=(n(63780),n(93169),n(99912));let E=class extends o.Z{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,l.Ds)((async(t,e,n,i)=>{const o=this._frameTask;if(null==o)return;const r=await o.schedule((()=>e.snap({...t,context:n,signal:i})),i);r.valid&&await o.schedule((()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){var t;const e="3d"===this.view.type?null===(t=this.view)||void 0===t||null===(t=t.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=null!=e?e.registerTask(I.T8.SNAPPING):I.sq}destroy(){this._abortController=(0,s.IM)(this._abortController),this._frameTask=(0,s.hw)(this._frameTask)}update(t,e,n){this._snapPoints=t;const{point:i,scenePoint:o}=t,r=e.update({point:i,scenePoint:o,context:n});return this.stagedPoint=r,r}async snap(t,e,n){const{point:i,scenePoint:o}=t;return this.stagedPoint=e.update({point:i,scenePoint:o,context:n}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,n,this._abortController.signal)}async resnap(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,s.IM)(this._abortController),this._snapPoints=null}};(0,i._)([(0,u.Cb)({constructOnly:!0})],E.prototype,"view",void 0),(0,i._)([(0,u.Cb)()],E.prototype,"stagedPoint",null),(0,i._)([(0,u.Cb)()],E.prototype,"constrainResult",void 0),(0,i._)([(0,u.Cb)()],E.prototype,"_stagedPoint",void 0),E=(0,i._)([(0,h.j)("esri.views.interactive.snapping.SnappingOperation")],E);var V=n(64674);let R=class extends(r.Z.EventedMixin(o.Z)){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this._stagedPointerId=null,this._updatingHandles=new v.R,this.constraint=void 0,this.isDraped=!0,this.labelOptions=new M.Z,this.tooltipOptions=new T.Z,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,null==t.elevationInfo&&(this.elevationInfo=(0,y.mF)(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,i="viewingMode"in e.state?e.state.viewingMode:m.JY.Local,o="segment"===t||"multipoint"===t?"polyline":t;this.coordinateHelper=(0,b.Y6)(this.hasZ,this.hasM,n),this._editGeometryOperations=new C.c(new w.XE(o,this.coordinateHelper)),this._snappingOperation=new E({view:e,constrainResult:t=>{var e;return t?null===(e=this._getEffectiveDrawSurface())||void 0===e?void 0:e.constrainZ(t):void 0}}),this.addHandles([(0,p.YP)((()=>this.stagedVertex),(t=>{null!=t&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(t)}],operation:"apply",type:"vertex-update"})}),{sync:!0,equals:(t,e)=>(0,s._W)(t,e,g.k)}),(0,p.YP)((()=>this.view.viewpoint),((t,e)=>{t&&e&&(0,d.Hg)(t,e)&&this._onViewpointChange()}))]),this._activeComponent=new w.wA(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;null!=r&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([(0,p.YP)((()=>this.labelOptions.enabled),(t=>{r.visible=t}),p.tX),this.on("cursor-update",(()=>{const t=this.stagedVertex;r.stagedVertex=null!=t?this.coordinateHelper.pointToVector(t):null}))])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(t=>{const e=t.vertices.map((t=>({componentIndex:0,vertexIndex:t.index,coordinates:this.coordinateHelper.vectorToArray(t.pos)}))),n=e.map((t=>t.coordinates));switch(t.type){case"vertex-add":this.emit(t.type,{...t,added:n,vertices:e});break;case"vertex-update":this.emit(t.type,{...t,updated:n,vertices:e});break;case"vertex-remove":this.emit(t.type,{...t,removed:n,vertices:e})}const i=this._activeComponent.getLastVertex(),o=null!=i?this.coordinateHelper.vectorToDehydratedPoint(i.pos):null;null!=o&&null!=this.lastVertex&&(0,g.k)(this.lastVertex,o)||(this.lastVertex=o)})));const a=this._manipulator=new _({grabbableForEvent:t=>"click"!==this.drawingMode||"touch"===t.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(a),a.grabbable="point"!==t,this.addHandles([this._createManipulatorDragPipeline(a),a.events.on("immediate-click",(t=>this._onImmediateClick(t))),a.events.on("immediate-double-click",(t=>this._onImmediateDoubleClick(t))),(0,p.YP)((()=>({effectiveCursor:this.effectiveCursor})),(t=>{let{effectiveCursor:e}=t;a.cursor=e}),p.tX)]),(0,V.Ob)(this,(()=>{var t;const e=null!==(t=this.view.inputManager.latestPointerType)&&void 0!==t?t:"mouse",n=this._getSnappingContext(e);null!=this.snappingManager&&this._updatingHandles.addPromise((0,l.R8)(this._snappingOperation.resnap(this.snappingManager,n)))}))}destroy(){(0,s.SC)(this.segmentLabels),(0,s.SC)(this._snappingOperation),this._editGeometryOperations=(0,s.SC)(this._editGeometryOperations),this._updatingHandles.destroy()}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}set drawingMode(t){this._set("drawingMode",null!==t&&void 0!==t?t:f)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return null!=this.stagedVertex?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get stagedVertex(){const t=this._snappingOperation.stagedPoint,{constraint:e,elevationInfo:n,view:i}=this;if(!t||!e)return t;const o=(0,S.SN)(t,i,n),r=o?e.closestTo(o):void 0;return r?(0,S.Ju)(r,t.spatialReference):t}set stagedVertex(t){this._snappingOperation.stagedPoint=(0,a.d9)(t)}get updating(){return this._updatingHandles.updating}get vertices(){const t=this.committedVertices;return null!=this.stagedVertex&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),null!=this.stagedVertex){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const e=t&&t.aborted||!1;this._snappingOperation.abort(),null!=this.snappingManager&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.stagedVertex=null;const n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map(((t,e)=>({componentIndex:0,vertexIndex:e,coordinates:t}))),aborted:e,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const e=this._activeComponent;if("polygon"===this.geometryType&&e.vertices.length>2){if(this._vertexWithinPointerDistance(e.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(e.vertices[e.vertices.length-1].pos,t))return e.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return(0,x.Xd)(t,((t,e,n,i)=>{const o="touch"===i&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:r,cancelSnapping:a}=(0,P.W)({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new O.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:i,visualizer:this.snappingVisualizer}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next((t=>(o&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),t))).next(a),e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this.stagedVertex=t.mapStart,("segment"===this.geometryType||o&&0===this.numVertices)&&this.commitStagedVertex()),t))).next((0,x.BS)(this.view,this.elevationInfo)).next(...r).next((t=>(o&&(this.stagedVertex=t.mapEnd,"end"===t.action&&this.commitStagedVertex()),t))).next((t=>("end"===t.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),t)))}))}_createManipulatorDragPipelineFreehand(t){return(0,x.Xd)(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(null==this.stagedVertex&&(this.stagedVertex=t.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this.stagedVertex=t.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return t}))}))}_createManipulatorDragPipelineHybrid(t){return(0,x.Xd)(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(null==this.stagedVertex&&(this.stagedVertex=t.mapStart),this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this.stagedVertex=t.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return t}))}))}get _drawAtFixedElevation(){return("segment"===this.geometryType||"polygon"===this.geometryType)&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(null==this.elevationDrawSurface)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,e=!1;return null!=this.elevationInfo&&"absolute-height"===this.elevationInfo.mode&&(e=!0),null!=this.snapToSceneEnabled&&(e=this.snapToSceneEnabled),null!=this.elevationInfo&&"on-the-ground"===this.elevationInfo.mode&&(e=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),e=!1),e?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){var e;return null===(e=this._getEffectiveDrawSurface())||void 0===e?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===t.pointerType&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if("mouse"===t.pointerType&&2===t.button||this._manipulator.dragging)return;const e=this._activeComponent;if(null!=this._closeOnClickVertexIndex(t.screenPoint))return t.stopPropagation(),void this.complete();const n=this._screenToMap(t.screenPoint);if(null!=n)switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(null!=this.stagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),null!=this.stagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),("point"===this.geometryType||"segment"===this.geometryType&&2===e.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===e.vertices.length)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=(0,c.vW)(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId;const n=this._snappingOperation,i=this._manipulator;this._pointerDownStates.has(t.pointerId)||i.grabbing||!i.interactive?n.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(e,t.pointerType))}_onViewpointChange(){var t;const e=this._manipulator;"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._pointerDownStates.has(this._stagedPointerId)&&!e.grabbing&&e.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,null!==(t=this._stagedPointerType)&&void 0!==t?t:"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,e){var n;const i=this._snappingOperation,o=this._closeOnClickVertexIndex(t);if(null!=o)return this._closeOnVertex(o),void i.abort();const r=this._screenToMap(t),a=this._requiresScenePoint?null===(n=this.drawSurface)||void 0===n?void 0:n.screenToMap(t):null;if(null==r)return this._hideDefaultCursor=!0,void i.abort();this._hideDefaultCursor=!1;const s=this.snappingManager;if(null==s)return this.stagedVertex=r,void i.abort();const p=this._getSnappingContext(e);this._updatingHandles.addPromise((0,l.R8)(i.snap({point:r,scenePoint:a},s,p)))}_closeOnVertex(t){this.stagedVertex=null;const e={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}_screenToMap(t){var e;return null===(e=this._getEffectiveDrawSurface())||void 0===e?void 0:e.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return e=>{if("start"===e.action&&(t=this._screenToMap(e.screenStart)),null==t)return null;const n=this._screenToMap(e.screenEnd);return null!=n?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return null!=n&&function(t,e,n){const i=t.x-e.x,o=t.y-e.y;return i*i+o*o<=n}(n,e,25)}_getSnappingContext(t){var e;const n=this._drawAtFixedElevation?null===(e=this.elevationDrawSurface)||void 0===e?void 0:e.defaultZ:null;return new O.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=n?{value:n,elevationInfo:this.elevationInfo}:null})}};(0,i._)([(0,u.Cb)()],R.prototype,"_hideDefaultCursor",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"_snappingOperation",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"_snappingEnabled",null),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"graphic",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"constraint",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"defaultZ",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"isDraped",void 0),(0,i._)([(0,u.Cb)({value:f})],R.prototype,"drawingMode",null),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"elevationDrawSurface",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"elevationInfo",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0,type:M.Z})],R.prototype,"labelOptions",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0,type:T.Z})],R.prototype,"tooltipOptions",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"geometryType",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"hasM",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"hasZ",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"cursor",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"effectiveCursor",null),(0,i._)([(0,u.Cb)()],R.prototype,"loading",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"manipulators",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"drawSurface",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"segmentLabels",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"snappingManager",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"snappingVisualizer",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"snapToSceneEnabled",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"stagedVertex",null),(0,i._)([(0,u.Cb)()],R.prototype,"lastVertex",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"updating",null),(0,i._)([(0,u.Cb)({constructOnly:!0})],R.prototype,"view",void 0),R=(0,i._)([(0,h.j)("esri.views.draw.DrawOperation")],R)},46640:(t,e,n)=>{n.d(e,{aL:()=>s,hP:()=>p,iW:()=>l});var i=n(17842),o=n(55946),r=n(37818),a=n(74509);class s{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._elevationInfo=t,this.defaultZ=e,this._view=n,this._excludeGraphics=i}screenToMap(t){if(null!=this.defaultZ)return this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,i.s1)(t.x,t.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const e=this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,i.s1)(t.x,t.y),this._elevationInfo,0,this._excludeGraphics);return null!=e&&(e.z=void 0),e}mapToScreen(t){const e=(0,o.T)(t.x,t.y,(0,a.vQ)(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(e)}constrainZ(t){const{defaultZ:e}=this;return null!=e&&t.z!==e&&((t=(0,r.WG)(t)).z=e),t}}class l{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.view=t,this.elevationInfo=e,this.exclude=n}screenToMap(t){const e=this.view.toMap(t,{exclude:this.exclude});return null!=e&&(e.z=(0,a.Ou)(e,this.view,this.elevationInfo)),e}mapToScreen(t){let e=t;return null!=this.elevationInfo&&(e=(0,o.T)(t.x,t.y,(0,a.vQ)(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(e)}constrainZ(t){return t}}class p{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.view=t,this.hasZ=e,this.defaultZ=n,this.mapToScreen=e=>t.toScreen(e),this.screenToMap=e?e=>{const i=t.toMap(e);return i.z=n,i}:e=>t.toMap(e)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=(0,r.WG)(t)).z=e),t}}},29919:(t,e,n)=>{n.d(e,{m:()=>d});var i,o=n(27366),r=n(7138),a=n(32718),s=n(66978),l=n(49861),p=(n(25243),n(63780),n(93169),n(69912)),c=n(99034),u=n(40281);!function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"}(i||(i={}));class h{constructor(){this._isToolEditable=!0,this._manipulators=new u.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable;this.addMany([t],e)}addMany(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable;for(const n of t){const t={manipulator:n,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((t=>{let{manipulator:e}=t;return e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((o=>{let{manipulator:r,attached:a}=o;if(!a||!r.interactive)return;const s=r.intersectionDistance(t,e);null!=s&&s<i&&(i=s,n=r)})),n}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===i.Always||(this._isToolEditable?t.visibilityPredicate===i.WhenToolEditable:t.visibilityPredicate===i.WhenToolNotEditable)}}let d=class extends r.Z{constructor(t){super(t),this.manipulators=new h,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[c.bH.MANAGER,!0],[c.bH.USER,!0]]),this._creationFinishedResolver=(0,s.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(c.bH.USER)}set editable(t){this.setEditableFlag(c.bH.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view?(this.view.focus(),this.onActivate()):a.Z.getLogger(this).error("Can't activate tool if view is not defined.")}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===c.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){var e;return null!==(e=this._editableFlags.get(t))&&void 0!==e&&e}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(c.bH.USER)&&this.getEditableFlag(c.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,o._)([(0,l.Cb)({constructOnly:!0})],d.prototype,"view",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"active",null),(0,o._)([(0,l.Cb)({value:!0})],d.prototype,"visible",null),(0,o._)([(0,l.Cb)({value:!0})],d.prototype,"editable",null),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"manipulators",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"updating",null),(0,o._)([(0,l.Cb)()],d.prototype,"cursor",null),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"automaticManipulatorSelection",void 0),(0,o._)([(0,l.Cb)()],d.prototype,"hasFocusedManipulators",null),(0,o._)([(0,l.Cb)()],d.prototype,"hasGrabbedManipulators",void 0),(0,o._)([(0,l.Cb)()],d.prototype,"hasHoveredManipulators",void 0),(0,o._)([(0,l.Cb)()],d.prototype,"firstGrabbedManipulator",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"created",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],d.prototype,"removeIncompleteOnCancel",void 0),d=(0,o._)([(0,p.j)("esri.views.interactive.InteractiveToolBase")],d)},74229:(t,e,n)=>{n.d(e,{AN:()=>C,BS:()=>P,Cf:()=>_,M2:()=>y,Mz:()=>E,QY:()=>w,Xd:()=>g,a9:()=>m,bD:()=>x,hM:()=>O,kY:()=>M,oq:()=>b,zh:()=>S});n(59486);var i=n(63780),o=(n(93169),n(84652)),r=n(16889),a=n(17842),s=n(71353),l=n(79803),p=n(37818),c=n(67331),u=n(74509),h=n(50951),d=n(20008),v=n(585);function g(t,e){return t.events.on("drag",function(t,e){let n=null,i=null;return o=>{if("cancel"===o.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const r={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};"start"===o.action&&null==n&&(n=new O,i=new O,e(t,n,i,o.pointerType,r)),null!=n&&n.execute(r),"end"===o.action&&null!=n&&(n=null,i=null)}}(t,e))}function y(t,e){var n;const i=[t.x,t.y,null!==(n=t.z)&&void 0!==n?n:0],o=e,r=[Math.cos(o),Math.sin(o)],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===a)return null;r[0]/=a,r[1]/=a;const s=t=>{const e=(t.x-i[0])*r[0]+(t.y-i[1])*r[1];t.x=i[0]+e*r[0],t.y=i[1]+e*r[1]};return t=>(s(t.mapStart),s(t.mapEnd),{...t,axis:r})}function m(t,e){let n=null;return i=>{if("start"===i.action&&(n=function(t,e,n){const i=t.geometry,o=(0,p.D)(e);if(null==i)return null;if("mesh"===i.type)return function(t,e,n,i){if(e.vertexSpace.isRelative)return function(t,e,n,i){const o=f(n.getOriginPoint(e.spatialReference),i),r=e.spatialReference;return null==o?null:{move:(e,i,a,s)=>{const p=(0,d.pB)(o.clone(),e,i,a);if(p.spatialReference.equals(r))n.setOriginFromPoint(p);else{const t=(0,l.project)(p,r);null!=t&&n.setOriginFromPoint(t)}if(n.isGeoreferenced)t.notifyGeometryChanged();else{const e="end"===s;t.notifyMeshTransformChanged(e?{action:c.u.UpdateFastLocalOrigin}:{})}}}}(t,e,e.vertexSpace,n);if(!e.spatialReference.equals(n))return null;let o=0,r=0,a=0;return{move:(n,s,l)=>{const p=n-o,c=s-r,u=l-a;if(p||c||u){var d;const g=new v.Z(e.origin.x+p,e.origin.y+c,(null!==(d=e.origin.z)&&void 0!==d?d:0)+u,e.origin.spatialReference);e.centerAt(g,{geographic:e.vertexSpace.isRelative?void 0:i===h.JY.Global}),t.notifyGeometryChanged(),o=n,r=s,a=l}}}}(t,i,o,n);const r=f(i,o),a=i.spatialReference;return null==r?null:{move:(e,n,i)=>{const o=(0,d.pB)(r.clone(),e,n,i);o.spatialReference.equals(a)?t.geometry=o:t.geometry=(0,l.project)(o,a)}}}(t,i.mapStart.spatialReference,e)),null==n)return null;const o=i.mapEnd.x-i.mapStart.x,r=i.mapEnd.y-i.mapStart.y,a=i.mapEnd.z-i.mapStart.z;return n.move(o,r,a,i.action),{...i,translationX:o,translationY:r,translationZ:a}}}function f(t,e){return null==t?null:t.spatialReference.equals(e)?t.clone():(0,l.project)(t,e)}function _(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,o=null;const r=null==n||null!==(e=t.spatialReference)&&void 0!==e&&e.equals(n)?t=>t:t=>null!=t?(0,l.project)(t,n):t,a={exclude:[],...i};return e=>{if("start"===e.action&&(o=r(t.toMap(e.screenStart,a))),null==o)return null;const n=r(t.toMap(e.screenEnd,a));return null!=n?{...e,mapStart:o,mapEnd:n}:null}}function b(t,e){const n=t.map((t=>m(t,e))).filter(i.pC);return t=>{const e=t.mapEnd.x-t.mapStart.x,i=t.mapEnd.y-t.mapStart.y,o=t.mapEnd.z-t.mapStart.z;return n.forEach((e=>e(t))),{...t,translationX:e,translationY:i,translationZ:o}}}function x(t){return null!=t.geometry&&"mesh"===t.geometry.type?function(t,e){var n;const{vertexSpace:i}=e;if(i.isGeoreferenced){const n=e.vertexAttributes.clonePositional();return i=>(e.vertexAttributes=n,t.notifyGeometryChanged(),i)}const o=(0,s.g)(i.origin),r=null===(n=e.transform)||void 0===n?void 0:n.clone();return n=>(e.transform=r,e.vertexSpace.origin=o,t.notifyMeshTransformChanged(),n)}(t,t.geometry):function(t,e){const n=new Map;for(const i of e)n.set(i,(0,o.d9)(t[i]));return e=>(n.forEach(((e,n)=>{t[n]=e})),e)}(t,["geometry"])}function w(t){const e=t.map((t=>x(t))).filter((t=>null!=t));return t=>(e.forEach((e=>e(t))),t)}function C(){let t=0,e=0,n=0;return i=>{"start"===i.action&&(t=i.mapStart.x,e=i.mapStart.y,n=i.mapStart.z);const o=i.mapEnd.x-t,r=i.mapEnd.y-e,a=i.mapEnd.z-n;return t=i.mapEnd.x,e=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:o,mapDeltaY:r,mapDeltaZ:a,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function S(){let t=0,e=0;return n=>{"start"===n.action&&(t=n.screenStart.x,e=n.screenStart.y);const i=n.screenEnd.x-t,o=n.screenEnd.y-e;return t=n.screenEnd.x,e=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:o}}}function M(t,e){let n=null,i=0,o=0;return s=>{var l;if("start"===s.action&&(n=null===(l=t.toScreen)||void 0===l?void 0:l.call(t,e),null!=n&&(n.x<0||n.x>t.width||n.y<0||n.y>t.height?n=null:(i=s.screenStart.x-n.x,o=s.screenStart.y-n.y))),null==n)return null;const p=(0,r.uZ)(s.screenEnd.x-i,0,t.width),c=(0,r.uZ)(s.screenEnd.y-o,0,t.height),u=(0,a.vW)(p,c);return s.screenStart=n,s.screenEnd=u,s}}const T=()=>{};class O{constructor(){this.execute=T}next(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O;return null!=t&&(this.execute=n=>{const i=t(n);null!=i&&e.execute(i)}),e}}function P(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===t.type)return t=>t;let i=null;return o=>{"start"===o.action&&(i=t.toMap(o.screenStart,{exclude:n}),null!=i&&(i.z=(0,u.Ou)(i,t,e)));const r=t.toMap(o.screenEnd,{exclude:n});null!=r&&(r.z=(0,u.Ou)(r,t,e));const a=null!=i&&null!=r?{sceneStart:i,sceneEnd:r}:null;return{...o,scenePoints:a}}}function I(t,e,n){var i,o;const r=null!==(i=e.elevationProvider.getElevation(t.x,t.y,null!==(o=t.z)&&void 0!==o?o:0,t.spatialReference,"scene"))&&void 0!==i?i:0,a=(0,p.WG)(t);return a.z=r,a.hasZ=!0,a.z=(0,u.Ou)(a,e,n),a}function E(t,e){if("2d"===t.type)return t=>t;let n=null;return i=>{"start"===i.action&&(n=I(i.mapStart,t,e));const o=I(i.mapEnd,t,e),r=null!=n&&null!=o?{sceneStart:n,sceneEnd:o}:null;return{...i,scenePoints:r}}}},92583:(t,e,n)=>{n.d(e,{lv:()=>g,mO:()=>d,nn:()=>h});var i=n(88396),o=n(11186),r=n(71353),a=n(82218),s=n(51378),l=n(254),p=n(12225),c=n(29014),u=n(34778);function h(t,e){return v(t,e,!1)}function d(t,e){return v(t,e,!0)}function v(t,e,n){if(t instanceof u.y){if(t.operation instanceof l.z)return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=n?-1:1,s=(0,r.f)(i*t.dx,i*t.dy,i*t.dz);(0,o.g)(e.origin,e.origin,s),(0,a.u)(e)}(t.operation,e,n),!0;if(t.operation instanceof p.S)return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=n?-t.angle:t.angle;(0,o.J)(e.basis1,e.basis1,r.Z,i),(0,o.J)(e.basis2,e.basis2,r.Z,i),(0,a.u)(e)}(t.operation,e,n),!0;if(t.operation instanceof c.q)return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=n?1/t.factor1:t.factor1,s=n?1/t.factor2:t.factor2;(0,o.i)(e.basis1,e.basis1,r),(0,o.i)(e.basis2,e.basis2,s),(0,i.u)(e.origin,e.origin,t.origin,t.axis1,r),(0,i.u)(e.origin,e.origin,t.origin,t.axis2,s),(0,a.u)(e)}(t.operation,e,n),!0}return!1}function g(t,e,n,o){o||(o=(0,a.a)());const r=(0,i.s)(s.qW.get(),t[1],-t[0]),l=(0,i.s)(s.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=(0,i.s)(s.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),c=s.qW.get();e.components.forEach((e=>e.vertices.forEach((e=>{const n=e.pos;(0,i.s)(c,(0,i.g)(t,n),(0,i.g)(r,n)),(0,i.z)(l,l,c),(0,i.A)(p,p,c)}))));const u=1e-6,h=(0,i.s)(s.qW.get(),p[0]-l[0]<u?n/2:0,p[1]-l[1]<u?n/2:0);return(0,i.c)(l,l,h),(0,i.i)(p,p,h),(0,i.a)(o.basis1,t,(p[0]-l[0])/2),(0,i.a)(o.basis2,r,(p[1]-l[1])/2),(0,i.s)(o.origin,l[0]*t[0]+l[1]*r[0],l[0]*t[1]+l[1]*r[1]),(0,i.i)(o.origin,o.origin,o.basis1),(0,i.i)(o.origin,o.origin,o.basis2),(0,a.u)(o),o}},80151:(t,e,n)=>{n.d(e,{W:()=>h});var i=n(92026),o=n(66978),r=n(94172),a=n(70178),s=n(37818),l=n(74509),p=n(74229),c=n(34019),u=n(99912);function h(t){let{predicate:e=(()=>!0),snappingManager:n,snappingContext:s,updatingHandles:h,useZ:m=!0}=t;const f=new p.hM;if(null==n)return{snappingStep:[y,f],cancelSnapping:y};let _,b=null,x=null,w=null;const C=()=>{var t;b=(0,i.IM)(b),n.doneSnapping(),null!==(t=x)&&void 0!==t&&t.frameTask.remove(),x=null,_=(0,i.hw)(_),w=null},S=function(t,e,n){return(0,o.Ds)((async(i,o)=>{let{frameTask:r,point:s,scenePoint:l,context:p,event:c,delta:u,getLastState:h}=i;const d=await r.schedule((()=>t.snap({point:s,scenePoint:l,context:p,signal:o})),o);if(d.valid){let i=await r.schedule((()=>d.apply()),o);const l=h();null!=l.point&&s!==l.point&&(i=t.update({point:l.point,scenePoint:l.scenePoint,context:p})),null!=l.updatePoint&&(0,a.k)(i,l.updatePoint)||(g(c.mapEnd,i,u,e),n.execute(c))}}))}(n,m,f);let M=null,T=null,O=null;return{snappingStep:[t=>{if(!e(t))return t;const{action:i}=t;if("start"===i){const{info:e}=t,i=function(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(u.T8.SNAPPING):u.sq}(n.view);if(x=function(t,e,n){return{context:new c.N({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:n}}(s,t,i),x.context.selfSnappingZ=null,!m&&null!=e){var a;const t=function(t,e){if(!t.hasZ())return null;const n=e.vertices;let i=null;for(const o of n){const e=t.getZ(o.pos);if(null!=i&&null!=e&&Math.abs(e-i)>1e-6)return null;null==i&&(i=e)}return i}(s.coordinateHelper,e.handle.component);null!=t&&(x.context.selfSnappingZ={value:t,elevationInfo:null!==(a=s.elevationInfo)&&void 0!==a?a:l.jG})}}if(null!=x){const{context:e,originalScenePos:a,originalPos:s}=x,{mapEnd:l,mapStart:p,scenePoints:c}=t,u=d(s,v(l,p)),y=v(p,s),f={...t,action:"update"},C=x.context,P=function(t,e){return null==t||null==e?null:d(t,v(e.sceneEnd,e.sceneStart))}(a,c),I=n.update({point:u,scenePoint:P,context:e});if(O=I,g(l,I,y,m),M=u,T=P,"end"!==i){const{frameTask:t}=x;null==b&&(b=new AbortController),w=e=>{h.addPromise((0,o.R8)(S({frameTask:t,event:f,context:C,point:u,scenePoint:P,delta:y,getLastState:()=>({point:M,scenePoint:T,updatePoint:e.forceUpdate?null:O})},b.signal)))},w({forceUpdate:!1}),null==_&&(_=(0,r.YP)((()=>n.options.effectiveEnabled),(()=>{var t;return null===(t=w)||void 0===t?void 0:t({forceUpdate:!0})})))}}return"end"===i&&C(),t},f],cancelSnapping:t=>(C(),t)}}function d(t,e){let[n,i,o]=e;const r=(0,s.WG)(t);return r.x+=n,r.y+=i,r.hasZ&&(r.z+=o),r}function v(t,e){const n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function g(t,e,n,i){let[o,r,a]=n;t.x=e.x+o,t.y=e.y+r,i&&t.hasZ&&e.hasZ&&(t.z=e.z+a)}function y(t){return t}},40545:(t,e,n)=>{n.d(e,{UR:()=>y,do:()=>g,wD:()=>v,Zq:()=>d});var i=n(17768),o=n(47898),r=n(68860),a=n(27366),s=n(7138),l=n(71907),p=n(49861),c=(n(25243),n(63780),n(93169),n(69912));let u=class extends s.Z{constructor(t){super(t),this.committed=null,this.disabled=!1,this.hidden=!1,this.id=(0,l.D)(),this.inputValue=null,this.readOnly=!1}get dirty(){return null!=this.inputValue}get locked(){return null!=this.committed}lock(t){this.inputValue=null,this.committed=null!==t&&void 0!==t?t:this.actual}unlock(){this.committed=null,this.inputValue=null}};(0,a._)([(0,p.Cb)()],u.prototype,"actual",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"committed",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"createQuantity",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"disabled",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"hidden",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"format",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"id",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"inputValue",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"readOnly",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"suffix",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"title",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"toInputUnits",void 0),(0,a._)([(0,p.Cb)()],u.prototype,"dirty",null),(0,a._)([(0,p.Cb)()],u.prototype,"locked",null),u=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.fields.TooltipField")],u);let h=class extends u{constructor(t){super(t),this.mode="absolute-height"}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{actual:o.yP,createQuantity:(t,n)=>(0,o.yG)(t,e(n)),toInputUnits:(t,n)=>(0,o.nn)(t,e(n)),format:(t,e)=>e.formatters.verticalLength(t),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch.elevation,...t}}};(0,a._)([(0,p.Cb)()],h.prototype,"mode",void 0),h=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],h);const d=t=>{const e=t=>t.inputUnitInfos.orientation.unit;return new u({actual:o.Ww,createQuantity:(t,n)=>(0,o.GJ)(t,e(n),"geographic"),toInputUnits:(t,n)=>{let{value:a,unit:s,rotationType:l}=t;const p=(0,o.hw)((0,r.En)(a,s,"degrees"),l,"geographic"),c=i.BV.normalize(p,0,!0),u=e(n),h=(0,r.En)(c,"degrees",u);return(0,o.GJ)(h,u,"geographic")},format:(t,e)=>e.formatters.angle(t),suffix:t=>t.inputUnitInfos.orientation.abbreviation,title:t=>t.messages.sketch.orientation,...t})},v=t=>{const e=t=>t.inputUnitInfos.length.unit;return new u({actual:o.yP,createQuantity:(t,n)=>(0,o.yG)(t,e(n)),toInputUnits:(t,n)=>(0,o.nn)(t,e(n)),format:(t,e)=>e.formatters.length(t),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})},g=t=>new h(t),y=t=>{const e=t=>t.inputUnitInfos.area.unit;return new u({actual:o.MQ,createQuantity:(t,n)=>(0,o.ne)(t,e(n)),toInputUnits:(t,n)=>(0,o.nn)(t,e(n)),format:(t,e)=>e.formatters.area(t),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,...t})}}}]);
//# sourceMappingURL=3708.44bbc6d1.chunk.js.map