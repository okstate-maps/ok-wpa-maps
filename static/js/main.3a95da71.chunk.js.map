{"version":3,"sources":["IntroJoyride.jsx","FormTemplates.jsx","WebMapView.js","App.js","serviceWorker.js","index.js"],"names":["IntroJoyride","props","useState","content","className","alt","src","process","placement","target","disableBeacon","scale","icon","href","steps","callback","data","status","type","STATUS","FINISHED","SKIPPED","includes","toggleIntro","continuous","floaterProps","disableAnimation","run","runIntro","scrollToFirstStep","showProgress","showSkipButton","styles","options","zIndex","width","CreateFormTemplate","title","elements","label","fieldName","ReviewFormTemplate","fieldInfos","actions","id","getRandomInt","max","Math","floor","random","WebMapView","featureTileUrl","featureVectorUrl","backgroundFeatureUrl","mapRef","React","createRef","workflow","editThis","bind","sayThanks","reviewWorkflow","getRandomFeatureForReview","getRandomBackgroundFeature","toggleLoadIndicator","rotationChange","updateTimesChecked","state","updateFeature","mapRotation","backgroundFeatureObjectIds","loadIndicator","that","this","randomId","objectIds","length","q","featureVectorLayer","createQuery","where","queryFeatures","then","response","view","goTo","features","geometry","extent","popup","visible","setState","whenLayerView","layerView","highlightedFeature","highlight","backgroundFeatureExtent","oids","featId","backgroundFeatureLayer","definitionExpression","when","queryExtent","query","spatialRelationship","distance","units","returnCentroid","returnGeometry","resp","queryObjectIds","newLoadVal","oldLoadVal","loadIndicatorWatch","remove","newRot","oldRot","propName","ui","add","compass","prevProps","prevState","snapshot","loadModules","css","ArcGISMap","Basemap","MapView","FeatureLayer","TileLayer","Compass","Editor","watchUtils","featureTileLayer","url","map","basemap","baseLayers","container","current","highlightOptions","color","fillOpacity","dockEnabled","dockOptions","buttonEnabled","breakpoint","watch","refreshButton","document","createElement","addEventListener","alert","popupTemplate","formTemplate","groupDisplay","on","e","updatedFeatures","editor","addedFeatures","addedFeatureId","objectId","outFields","feats","setAttribute","creds","userId","edits","updateFeatures","applyEdits","allowedWorkflows","layerInfos","layer","allowAttachments","deleteEnabled","postInitialize","init","messages","widgetLabel","addFeature","editFeature","viewModel","newVal","oldVal","editButton","getElementsByClassName","disabled","classList","removeAttribute","event","action","popupEnabled","upFeat","currentTimesChecked","getAttribute","setModalContent","openModal","setTimeout","closeModal","close","activeWorkFlow","startUpdateWorkflowAtFeatureEdit","selectedFeature","spinnerEnabled","arrComp","domNode","evt","preventDefault","ref","Component","config","window","location","customStyles","top","left","right","bottom","marginRight","transform","App","welcomeScreen","toggleWelcomeScreen","modalIsOpen","setIsOpen","setWorkflow","modalContent","creatorCount","setCreatorCount","setCreds","userName","setUserName","esriId","setEsriId","info","setInfo","listOfRandomPraise","randomPraise","signUpUrl","Modal","setAppElement","useEffect","OAuthInfo","Portal","appId","registerOAuthInfos","hash","aURL","vars","hashes","slice","indexOf","split","i","parseHashArgs","token","access_token","un","username","exp","expires_in","registerToken","expires","server","getCredential","portalUrl","checkSignInStatus","load","p","user","fullName","outStatistics","onStatisticField","outStatisticFieldName","statisticType","catch","oauthInfo","isOpen","onAfterOpen","onRequestClose","style","contentLabel","onClick","class","credential","fontSize","destroy","pathname","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","error","console","message"],"mappings":"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","file":"static/js/main.3a95da71.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Joyride, { CallBackProps, STATUS, Step, StoreHelpers } from 'react-joyride';\r\nexport function IntroJoyride(props) {\r\n\tconst [steps, setSteps] = useState([\r\n  \r\n    {\r\n      content: \r\n          <div>\r\n            <h1>Draw and transcribe map data</h1>\r\n            <div className='imgContainer'>\r\n              <img alt='Draw a shape representing a \r\n                    parcel of land and transcribe the ' \r\n                  src={process.env.PUBLIC_URL + '/img/wpa3.gif'}/>\r\n            </div>\r\n          </div>,\r\n      placement: 'auto',\r\n      target: '.drawShapes',\r\n      disableBeacon: true\r\n    },    \r\n    // {\r\n    //   content: \r\n    //       <div>\r\n    //         <h1>Draw and transcribe map data</h1>\r\n    //         <div>\r\n              \r\n    //         </div>\r\n    //       </div>,\r\n    //   placement: 'auto',\r\n    //   target: '.drawShapes',\r\n    //   disableBeacon: false\r\n    // },\r\n\r\n    {\r\n      content: \r\n      <div>\r\n        <h1>Review existing entries</h1>\r\n        <h3>If you don't see any errors, click <strong><calcite-icon scale='s' icon=\"check\"></calcite-icon>Looks Good!</strong></h3>\r\n        <div className='imgContainer'>\r\n          <img alt='Reviewing parcels' \r\n               src={process.env.PUBLIC_URL + '/img/wpa7.gif'}/>\r\n        </div>\r\n      </div>,\r\n      placement: 'auto',\r\n      target: '.reviewShapes',\r\n      disableBeacon: true\r\n    \r\n    },\r\n    {\r\n      content: \r\n      <div>\r\n        <h1>Review existing entries</h1>\r\n        <h3>If you see something incorrect or missing, click <strong><calcite-icon scale='s' icon=\"pencil\"></calcite-icon>Edit feature</strong></h3>\r\n        <div className='imgContainer'>\r\n          <img alt='Reviewing parcels' \r\n               src={process.env.PUBLIC_URL + '/img/wpa8.gif'}/>\r\n        </div>\r\n      </div>,\r\n      placement: 'auto',\r\n      target: '.reviewShapes',\r\n      disableBeacon: true\r\n\r\n    },\r\n    {\r\n      content: \r\n      <>\r\n        <h3>Right click and drag to change the rotation of the map.</h3>\r\n        <div className='imgContainer'>\r\n          <img alt='Demonstration of rotating the map' \r\n               src={process.env.PUBLIC_URL + '/img/wpa4.gif'}/>\r\n        </div>\r\n        <p> Press the compass button to reset</p>\r\n      </>,\r\n      placement: 'center',\r\n      target: 'body',\r\n      disableBeacon: true\r\n\r\n    },\r\n    {\r\n      content: \r\n      <>\r\n        <h3>Keep track of your progress.</h3>\r\n        <div className='imgContainer'>\r\n        </div>\r\n        <p>Sign in with your ArcGIS Online account. Or, <a href={\"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id=l3OWRmRCGfkAN4Dh&redirect_uri=http://localhost:3000/ok-wpa-maps&response_type=code\"}>\r\ncreate one</a> for free.</p>\r\n\r\n      </>,\r\n      placement: 'center',\r\n      target: '.trackProgress',\r\n      disableBeacon: true\r\n\r\n    },\r\n    {\r\n      content: \r\n          <div>\r\n            <a href=\"https://info.library.okstate.edu/map-room/wpa-maps\"><h1>Click to learn more about the collection</h1></a>\r\n          </div>,\r\n      placement: 'center',\r\n      target: 'body',\r\n      disableBeacon: true\r\n    },      \r\n    \r\n  ]);\r\n\r\n  function handleJoyrideCallback(data) {\r\n    const { status, type } = data;\r\n    const finishedStatuses = [STATUS.FINISHED, STATUS.SKIPPED];\r\n    if (finishedStatuses.includes(status)) {\r\n      props.toggleIntro(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n   <Joyride\r\n          callback={handleJoyrideCallback}\r\n          continuous={true}\r\n          floaterProps={{disableAnimation:true}}\r\n          run={props.runIntro}\r\n          scrollToFirstStep={true}\r\n          showProgress={true}\r\n          showSkipButton={true}\r\n          steps={steps}\r\n          styles={{\r\n            options: {\r\n              zIndex: 10000,\r\n              width: 800\r\n            },\r\n          }}\r\n        />\r\n  )\r\n}\r\n\r\nexport default IntroJoyride;","const editThisAction = {\r\n    title: 'Edit feature',\r\n    id: 'edit-this',\r\n    className: 'esri-icon-edit'\r\n};\r\n\r\nconst thisLooksOkAction = {\r\n    title: 'Looks good!',\r\n    id: 'this-looks-ok',\r\n    className: 'esri-icon-check-mark'\r\n};\r\n\r\nexport const CreateFormTemplate = {\r\n        title: 'Land Info',\r\n        elements: [{ // Autocasts to new GroupElement\r\n          type: 'group',\r\n          label: 'Owner Information',\r\n          elements: [\r\n              {\r\n                type: 'field',\r\n                fieldName: 'OwnerLastName',\r\n                label: 'Owner\\'s Last Name (if an individual)'\r\n              },\r\n\r\n              {\r\n                type: 'field',\r\n                fieldName: 'OwnerFirstNameAndMI',\r\n                label: 'Owner\\'s First Name or initials (if an individual)'\r\n              },   \r\n              {\r\n                type: 'field',\r\n                fieldName: 'OwnerOrgName',\r\n                label: 'Owner (if an entity or organization)'\r\n              }\r\n          ]\r\n        },\r\n\r\n        { // Autocasts to new GroupElement\r\n          type: 'group',\r\n          label: 'Land and Improvement Valuation',\r\n          elements: [\r\n             {\r\n                type: 'field',\r\n                fieldName: 'LandValue',\r\n                label: 'Land Value'\r\n              },\r\n              {\r\n                type: 'field',\r\n                fieldName: 'ImprovementsValue2',\r\n                label: 'Improvements Value'\r\n              },\r\n          ]\r\n        },\r\n           {\r\n                type: 'field',\r\n                fieldName: 'TaxExempt',\r\n                label: 'Marked with an X?'\r\n              }\r\n        ]\r\n      }\r\n\r\n\r\nexport const ReviewFormTemplate = {\r\n    title: 'Please doublecheck the info below.',\r\n    content: [\r\n      {\r\n        type: 'fields',\r\n        fieldInfos: [\r\n          {\r\n            fieldName: 'OwnerLastName',\r\n            label: 'Owner\\'s Last Name (if an individual)'\r\n          },\r\n\r\n          {\r\n            fieldName: 'OwnerFirstNameAndMI',\r\n            label: 'Owner\\'s First Name or initials (if an individual)'\r\n          },   \r\n          {\r\n            fieldName: 'OwnerOrgName',\r\n            label: 'Owner (if an entity or organization)'\r\n          },\r\n          {\r\n            fieldName: 'LandValue',\r\n            label: 'Land Value'\r\n          },\r\n          {\r\n            fieldName: 'ImprovementsValue2',\r\n            label: 'Improvements Value'\r\n          },\r\n          {\r\n            fieldName: 'TaxExempt',\r\n            label: 'Marked with an X?'\r\n          }\r\n        ]\r\n      }\r\n    ],\r\n    //overwriteActions: true,\r\n    actions: [thisLooksOkAction, editThisAction]\r\n}\r\n\r\n\r\n\r\nexport default CreateFormTemplate;","import React from 'react';\r\nimport {CreateFormTemplate, ReviewFormTemplate} from './FormTemplates';\r\nimport { loadModules } from 'esri-loader';\r\n\r\nfunction getRandomInt(max) {\r\n    return Math.floor(Math.random() * Math.floor(max));\r\n}\r\n\r\nexport class WebMapView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.featureTileUrl = 'https://tiles.arcgis.com/tiles/jWQlP64OuwDh6GGX/arcgis/rest/services/_wpa_all_6Aug2020/MapServer';\r\n    this.featureVectorUrl = 'https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0';\r\n    this.backgroundFeatureUrl = 'https://services1.arcgis.com/jWQlP64OuwDh6GGX/ArcGIS/rest/services/Oklahoma_Public_Land_Survey_Sections/FeatureServer/0';\r\n    this.mapRef = React.createRef();\r\n    this.workflow = props.workflow;\r\n    this.editThis = this.editThis.bind(this);\r\n    this.sayThanks = this.sayThanks.bind(this);\r\n    this.reviewWorkflow = this.reviewWorkflow.bind(this);\r\n    this.getRandomFeatureForReview = this.getRandomFeatureForReview.bind(this);\r\n    this.getRandomBackgroundFeature = this.getRandomBackgroundFeature.bind(this);\r\n    this.toggleLoadIndicator = this.toggleLoadIndicator.bind(this);\r\n    this.rotationChange = this.rotationChange.bind(this);\r\n    this.updateTimesChecked = this.updateTimesChecked.bind(this);\r\n    this.state = {\r\n                  updateFeature: null,\r\n                  mapRotation: 0,\r\n                  backgroundFeatureObjectIds: null,\r\n                  loadIndicator: true\r\n                };\r\n    }\r\n\r\n  getRandomFeatureForReview() {\r\n    var that = this;\r\n    var randomId = getRandomInt(this.objectIds.length - 1);     \r\n    var q = this.featureVectorLayer.createQuery();\r\n    q.where = 'OBJECTID = ' + this.objectIds[randomId];\r\n    this.featureVectorLayer.queryFeatures(q).then((response) => {\r\n      that.view.goTo(response.features[0].geometry.extent);\r\n      that.view.popup.features = response.features;\r\n      that.view.popup.visible = true;\r\n      that.setState({updateFeature: response.features[0]});\r\n      this.view.whenLayerView(this.featureVectorLayer).then(function(layerView){\r\n        that.highlightedFeature = layerView.highlight(response.features[0]);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  getRandomBackgroundFeature() {\r\n    var backgroundFeatureExtent;\r\n    var oids = this.state.backgroundFeatureObjectIds;\r\n    var featId = oids[getRandomInt(oids.length)];\r\n\r\n    this.backgroundFeatureLayer.definitionExpression = 'OBJECTID = ' + featId;\r\n    \r\n    this.backgroundFeatureLayer\r\n        .when(() =>{\r\n            return this.backgroundFeatureLayer.queryExtent();\r\n        })\r\n        .then((response) => {\r\n          backgroundFeatureExtent = response.extent;\r\n          let query = this.featureVectorLayer.createQuery();\r\n              query.spatialRelationship = 'contains';\r\n              query.distance = 250;\r\n              query.units = 'feet';\r\n              query.returnCentroid = true;\r\n              query.returnGeometry = false;\r\n              query.geometry = response.extent; \r\n          return this.featureVectorLayer.queryFeatures(query)\r\n         }).then((resp) => {\r\n            if (resp.features.length === 0){\r\n              this.view.goTo(backgroundFeatureExtent);\r\n            }\r\n            else {\r\n              this.getRandomBackgroundFeature();\r\n            }\r\n         });\r\n    }\r\n\r\n  reviewWorkflow() {\r\n    var that = this;    \r\n    this.featureVectorLayer.queryObjectIds().then((objectIds) => {\r\n      that.objectIds = objectIds;\r\n      that.getRandomFeatureForReview();\r\n    });\r\n  }\r\n\r\n  toggleLoadIndicator(newLoadVal, oldLoadVal) {\r\n    this.setState({\"loadIndicator\": newLoadVal});\r\n    this.loadIndicatorWatch.remove(); //remove after initial load. It gets too messy IMO \r\n  }\r\n\r\n  rotationChange(newRot, oldRot, propName) {\r\n    if (oldRot === 0 && newRot !== 0) {\r\n      this.view.ui.add(this.compass, 'top-left');\r\n    }\r\n\r\n    if (oldRot !== 0 && newRot === 0) {\r\n      this.view.ui.remove(this.compass);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    //console.log(\"componentDidUpdate\");\r\n    if (prevState.backgroundFeatureObjectIds === null &&\r\n      this.state.backgroundFeatureObjectIds !== null) {\r\n      this.getRandomBackgroundFeature();\r\n    }\r\n  }\r\n  \r\n  componentDidMount() {\r\n    // lazy load the required ArcGIS API for JavaScript modules and CSS\r\n    loadModules(['esri/Map', 'esri/Basemap', \r\n                 'esri/views/MapView', \r\n                 'esri/layers/FeatureLayer',\r\n                 'esri/views/layers/FeatureLayerView',\r\n                 'esri/layers/TileLayer',\r\n                 'esri/widgets/Compass',\r\n                 'esri/widgets/Editor',\r\n                 //'esri/widgets/DistanceMeasurement2D'\r\n                 'esri/core/watchUtils'], { css: true })\r\n    .then(([ArcGISMap, Basemap, MapView, FeatureLayer, \r\n            FeatureLayerView, TileLayer, Compass, Editor,\r\n            //DistanceMeasurement2D,\r\n            watchUtils]) => {\r\n\r\n      const featureTileLayer = new TileLayer({\r\n        url: this.featureTileUrl\r\n      });\r\n\r\n      this.map = new ArcGISMap({\r\n        basemap: new Basemap({baseLayers:[featureTileLayer]})\r\n      });\r\n      \r\n      this.view = new MapView({\r\n        container: this.mapRef.current,\r\n        map: this.map,\r\n        highlightOptions: {\r\n          color: '#fe5c00',\r\n          fillOpacity: 0.1\r\n        },\r\n        popup: {\r\n          dockEnabled: true,\r\n          dockOptions: {\r\n            // Disables the dock button from the popup\r\n            buttonEnabled: false,\r\n            // Ignore the default sizes that trigger responsive docking\r\n            breakpoint: false\r\n          }\r\n        }\r\n        //center: [-98.5, 35.5],\r\n        //zoom: 8\r\n      });\r\n    \r\n      this.compass = new Compass({\r\n        view: this.view\r\n      });\r\n      \r\n      this.loadIndicatorWatch = this.view.watch('updating', this.toggleLoadIndicator);\r\n      this.view.watch('rotation', this.rotationChange);\r\n\r\n      var refreshButton = document.createElement('div');\r\n          refreshButton.className = 'esri-icon-refresh esri-widget--button esri-widget esri-interactive ';\r\n          refreshButton.title = this.workflow === 'create' ? \r\n            'Go to another random location.' : \r\n            'Get another entry to review.';\r\n      \r\n      refreshButton.addEventListener('click', () => {\r\n        switch (this.workflow) {\r\n          case 'create': \r\n            this.getRandomBackgroundFeature();\r\n            break;\r\n          case 'update':\r\n            this.getRandomFeatureForReview();\r\n            break;\r\n          default:\r\n            alert('moo');\r\n        }\r\n      });\r\n\r\n      this.view.ui.add(refreshButton, 'bottom-left');\r\n\r\n      //measurement widget, but let's not use it for now\r\n      \r\n      // this.measurement = new DistanceMeasurement2D({\r\n      //   view: this.view,\r\n      //   activeTool: 'distance',\r\n      //   unit: 'feet'\r\n      // });\r\n      //this.view.ui.add(this.measurement, 'bottom-left');\r\n      \r\n\r\n      this.featureVectorLayer = new FeatureLayer({\r\n        url: this.featureVectorUrl,\r\n        popupTemplate: ReviewFormTemplate,\r\n        formTemplate: CreateFormTemplate,\r\n        groupDisplay: 'sequential'\r\n      });\r\n\r\n      \r\n      this.featureVectorLayer.on('edits', (e) => {\r\n        if (e.updatedFeatures.length > 0 && this.highlightedFeature) {\r\n          this.sayThanks();\r\n          this.view.ui.remove(this.editor);\r\n        }\r\n        if (e.addedFeatures.length > 0) {\r\n          let addedFeatureId = e.addedFeatures[0].objectId;\r\n          let addedFeature = this.featureVectorLayer.queryFeatures({objectIds: [addedFeatureId],\r\n                                                                    outFields: ['OBJECTID','CREATOR_PUBLIC']}).then(\r\n            (feats) => {feats.features[0].setAttribute('CREATOR_PUBLIC', this.props.creds.userId);\r\n              let edits = {updateFeatures: [feats.features[0]]}\r\n              this.featureVectorLayer.applyEdits(edits);});\r\n   \r\n        }\r\n      } );\r\n\r\n      this.editor = new Editor({\r\n          view: this.view,\r\n          allowedWorkflows: [this.workflow],\r\n          layerInfos: [{\r\n            view: this.view,\r\n            layer: this.featureVectorLayer,\r\n            allowAttachments: false,\r\n            deleteEnabled: false\r\n          }]\r\n        });\r\n\r\n\r\n      // I can't believe this is the only way to override widget labelling, but here we are\r\n      this.editor.postInitialize = function(){\r\n        watchUtils.init(this,'messages', (messages) => {\r\n          messages.widgetLabel = 'WPA Maps';\r\n          messages.addFeature = 'Draw a new shape';\r\n          messages.editFeature = 'Review an existing record';\r\n        });\r\n      };\r\n\r\n      //an attempt to prevent identical features from being created due to lack of feedback\r\n      //from the editor widget\r\n      this.editor.viewModel.watch('syncing', function(newVal,oldVal, propName, target){\r\n        let editButton = document.getElementsByClassName('esri-editor__control-button');\r\n        if (editButton.length === 0){\r\n          return;\r\n        }\r\n        \r\n        if (newVal === true) {\r\n          \r\n          editButton[0].disabled = 'disabled';\r\n          editButton[0].classList.add('esri-button--disabled');\r\n        }\r\n          \r\n        if (newVal === false) {\r\n\r\n          editButton[0].removeAttribute('disabled');\r\n          editButton[0].classList.remove('esri-button--disabled');\r\n        }\r\n      })\r\n\r\n      // Event handler that fires each time an action is clicked\r\n      var that = this;\r\n      this.view.popup.on('trigger-action', function (event) {\r\n            if (event.action.id === 'edit-this') {\r\n              that.editThis();\r\n            }\r\n\r\n            if (event.action.id === 'this-looks-ok'){\r\n              that.updateTimesChecked();\r\n            }\r\n\r\n          });   \r\n\r\n      // for creation, pick a random background feature and zoom to it\r\n      if (this.workflow === 'create') {\r\n          \r\n          this.backgroundFeatureLayer = new FeatureLayer({\r\n            url: this.backgroundFeatureUrl\r\n          });\r\n\r\n          this.backgroundFeatureLayer.queryObjectIds()\r\n            .then((oids) => {\r\n              that.setState({\"backgroundFeatureObjectIds\": oids});\r\n              that.map.add(this.backgroundFeatureLayer);\r\n          });\r\n          this.featureVectorLayer.popupEnabled = false;\r\n          this.view.ui.add(this.editor, 'bottom-right');\r\n      }\r\n\r\n      // for reviewing, pick a random polygon and zoom to it\r\n      if (this.workflow === 'update') {\r\n        this.reviewWorkflow();\r\n      }\r\n\r\n      this.map.add(this.featureVectorLayer);\r\n      });\r\n  }\r\n\r\n  updateTimesChecked() {\r\n    var upFeat = this.state.updateFeature;\r\n    var currentTimesChecked = upFeat.getAttribute('timesChecked');\r\n    upFeat.setAttribute('timesChecked', currentTimesChecked + 1);\r\n    var edits = {updateFeatures: [upFeat]};\r\n    this.featureVectorLayer.applyEdits(edits);\r\n    this.highlightedFeature.remove();\r\n  }\r\n\r\n  sayThanks() {\r\n    var that = this;\r\n\r\n    this.props.setModalContent(\r\n      <div>\r\n        <h1>Thank you!</h1>\r\n        <p>Here's another entry to check.</p>\r\n      </div>\r\n    );\r\n    this.props.openModal();\r\n    setTimeout(function(){\r\n      that.props.closeModal(); \r\n      }, 2000);\r\n\r\n    this.highlightedFeature.remove();\r\n    this.getRandomFeatureForReview();\r\n    this.view.popup.close();\r\n  }\r\n  editThis() {\r\n        var view = this.view;\r\n        var editor = this.editor; \r\n        view.when(function () {\r\n\r\n            // If the EditorViewModel's activeWorkflow is null, make the popup not visible\r\n            if (!editor.viewModel.activeWorkFlow) {\r\n              view.popup.visible = false;\r\n              // Call the Editor update feature edit workflow\r\n              editor.startUpdateWorkflowAtFeatureEdit(\r\n                view.popup.selectedFeature\r\n              );\r\n              view.ui.add(editor, 'bottom-right');\r\n              view.popup.spinnerEnabled = false;\r\n            }\r\n\r\n            // We need to set a timeout to ensure the editor widget is fully rendered. We\r\n            // then grab it from the DOM stack\r\n            setTimeout(function () {\r\n              // Use the editor's back button as a way to cancel out of editing\r\n              let arrComp = editor.domNode.getElementsByClassName(\r\n                'esri-editor__back-button esri-interactive'\r\n              );\r\n              if (arrComp.length === 1) {\r\n                // Add a tooltip for the back button\r\n                arrComp[0].setAttribute(\r\n                  'title',\r\n                  'Cancel edits, return to popup'\r\n                );\r\n                // Add a listerner to listen for when the editor's back button is clicked\r\n                arrComp[0].addEventListener('click', function (evt) {\r\n                  // Prevent the default behavior for the back button and instead remove the editor and reopen the popup\r\n                  evt.preventDefault();\r\n                  view.ui.remove(editor);\r\n                  // view.popup.open({\r\n                  //   features: features\r\n                  // });\r\n                });\r\n              }\r\n            }, 150);\r\n        \r\n          \r\n        });\r\n      }\r\n\r\n  componentWillUnmount() {\r\n    if (this.view) {\r\n      // destroy the map view\r\n      this.view.container = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.state.loadIndicator && <div className='loadIndicator'>LOADING</div>} \r\n        <div className='webmap' ref={this.mapRef} />\r\n      </>\r\n    );\r\n  }\r\n}","import React, { useState, useEffect } from 'react';\nimport Modal from 'react-modal';\nimport { loadModules } from 'esri-loader';\nimport { IntroJoyride } from './IntroJoyride';\nimport { WebMapView } from './WebMapView';\n\n//import { loadScript, loadModules } from 'esri-loader';\nimport \"@esri/calcite-components\";\nimport './App.css';\n\nconst config = {\n  appId: 'l3OWRmRCGfkAN4Dh',\n  redirect_uri: window.location\n  };\n\n\nfunction parseHashArgs(aURL) {\n\n  aURL = aURL || window.location.href;\n  \n  var vars = {};\n  var hashes = aURL.slice(aURL.indexOf('#') + 1).split('&');\n\n    for(var i = 0; i < hashes.length; i++) {\n       var hash = hashes[i].split('=');\n      \n       if(hash.length > 1) {\n         vars[hash[0]] = hash[1];\n       } else {\n        vars[hash[0]] = null;\n       }      \n    }\n\n    return vars;\n}\n\nconst customStyles = {\n  content : {\n    top                   : '50%',\n    left                  : '50%',\n    right                 : 'auto',\n    bottom                : 'auto',\n    marginRight           : '-50%',\n    transform             : 'translate(-50%, -50%)'\n  }\n};\n\nfunction App() {\n  const [welcomeScreen, toggleWelcomeScreen] = useState(true);\n  const [modalIsOpen, setIsOpen] = useState(false);\n  const [workflow, setWorkflow] = useState(0);\n  const [modalContent, setModalContent] = useState('');\n  const [runIntro, toggleIntro] = useState(false);\n  const [creatorCount, setCreatorCount] = useState(false);\n  const [creds, setCreds] = useState(false);\n  const [userName, setUserName] = useState(false);\n  const [esriId, setEsriId] = useState(false);\n  const [info, setInfo] = useState(false);\n\n  var listOfRandomPraise= [\n    'Good job!',\n    'Way to go!',\n    'Wow!',\n    'That\\'s super!',\n    'Awesome!',\n    'Alright!'\n  ];\n\n\n  const [randomPraise, setRandomPraise] = useState(\n    listOfRandomPraise[Math.floor(Math.random() * Math.floor(listOfRandomPraise.length))]\n  );\n\n  let signUpUrl = \"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id=\" + config.appId +\"&redirect_uri=\"+config.redirect_uri+\"&response_type=token\";\n  Modal.setAppElement('#root');\n\n  function openModal() {\n    setIsOpen(true);\n  }\n\n  function afterOpenModal() {\n    // references are now sync'd and can be accessed.\n    //subtitle.style.color = '#f00';\n  }\n\n  function closeModal(){\n    setIsOpen(false);\n  }\n\n  useEffect(() => {\n    loadModules(['esri/identity/OAuthInfo','esri/identity/IdentityManager',\n                 'esri/layers/FeatureLayer', 'esri/portal/Portal'], { css: true })\n    .then(([OAuthInfo, esriId, FeatureLayer, Portal]) => {\n    \n      var info = new OAuthInfo({\n          appId: 'l3OWRmRCGfkAN4Dh', //your app id goes here\n          popup: false\n      });\n\n      setInfo(info);\n      setEsriId(esriId);\n      esriId.registerOAuthInfos([info]);\n\n\n      let hash = parseHashArgs();\n      if (\"access_token\" in hash) {\n        let token = hash.access_token;\n        let un = hash.username;\n        let exp = hash.expires_in;\n        esriId.registerToken({\n          token: token,\n          userId: un,\n          expires: exp,\n          server: \"https://www.arcgis.com/sharing/rest\"\n        });\n        esriId.getCredential(info.portalUrl + '/sharing');;\n      }\n      \n      esriId\n        .checkSignInStatus(info.portalUrl + '/sharing')\n        .then((creds) => {\n          setCreds(creds);\n          var portal = new Portal(info.portalUrl).load().then((p) => {\n            setUserName(p.user.fullName);\n          });\n\n\n          var layer =  new FeatureLayer({\n            url: 'https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0'\n          });\n          var q = layer.createQuery();\n          q.where = 'CREATOR_PUBLIC = \\'' + creds.userId + '\\'';\n          q.outStatistics =[\n            {\n              onStatisticField: 'CREATOR_PUBLIC',\n              outStatisticFieldName: 'CREATOR_COUNT',\n              statisticType: 'count'\n            }\n          ];\n    \n          layer.queryFeatures(q).then(resp => {\n            if (resp.features.length > 0){\n              setCreatorCount(resp.features[0].getAttribute('CREATOR_COUNT'));\n            }\n\n          })\n        })\n        .catch(() => {\n\n          //esriId.getCredential(info.portalUrl + '/sharing')\n        });\n\n      \n   });\n\n  }, []);\n    \n\n    return (\n      <div className=\"App\">\n        <IntroJoyride runIntro={runIntro}\n                      toggleIntro={toggleIntro} \n                      oauthInfo={info}/>\n        <Modal\n          isOpen={modalIsOpen}\n          onAfterOpen={afterOpenModal}\n          onRequestClose={closeModal}\n          style={customStyles}\n          contentLabel=\"Modal\"\n        >\n          {modalContent}\n        </Modal>\n\n        {welcomeScreen === true &&\n          <>\n\n            <h1>Oklahoma 1936 Land Ownership Map Transcription</h1>\n            \n            <div className='flex-row'>\n              <button className='drawShapes' onClick={() => {toggleWelcomeScreen(false); setWorkflow('create')}}>\n                  <calcite-icon scale='l' class=\"big-icon\" icon=\"addInNew\"></calcite-icon> \n                  <br/>Draw some shapes\n              </button>\n              <button className='reviewShapes' onClick={() => {toggleWelcomeScreen(false); setWorkflow('update')}}>\n                  <calcite-icon scale='l' class=\"big-icon\" icon=\"editAttributes\"></calcite-icon> \n                  <br/>Review existing shapes\n              </button>\n              <button onClick={() => {toggleIntro(!runIntro)}}>\n                  <calcite-icon scale='l' class=\"big-icon\" icon=\"question\"></calcite-icon> \n                  <br/>View the intro\n              </button>\n            </div>\n\n            {userName === false &&\n            <div className=\"trackProgress\">\n              <h2>Track your progress:</h2>\n              <div className='flex-row'>\n                <br/><br/>\n                <button className='signInOut' onClick={function(){esriId.getCredential(info.portalUrl + '/sharing')\n                  .then((credential) => {setCreds(credential);})}}>\n                  <calcite-icon scale='l' className=\"big-icon\" icon=\"sign-in\"></calcite-icon> \n                <br/> Sign in</button>\n\n                <a href={signUpUrl}><button className='createAccount'>\n                  <calcite-icon scale='l' className=\"big-icon\" icon=\"user-plus\"></calcite-icon> \n                <br/> Create an account</button></a>\n              </div> \n            </div>\n              //\"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id=l3OWRmRCGfkAN4Dh&redirect_uri=http://localhost:3000/ok-wpa-maps&response_type=code\"\n            }\n            {userName !== false && creatorCount !== false &&\n              <div class='flex-row'>\n                <h3>Hi {userName}! So far you've added \n                  <span style={{fontSize:'2em'}}>&nbsp;{creatorCount}&nbsp;</span> \n                    {creatorCount === 1 ? 'shape' : 'shapes'}. {creatorCount > 0 ? randomPraise : ''}\n                </h3>\n                <br/><button className='signInOut' onClick={function(){creds.destroy(); window.location = window.location.pathname}}>\n                   <calcite-icon scale='l' class=\"big-icon\" icon=\"sign-out\"></calcite-icon> <br/> Click to sign out\n                  </button>\n              </div>\n            }\n        \n          </>\n        }\n        \n        {welcomeScreen === false &&\n          <WebMapView \n            workflow={workflow} \n            creds={creds}\n            openModal={openModal}\n            closeModal={closeModal}\n            setModalContent={setModalContent}/>\n        }\n      </div>\n    );\n  }\n\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}