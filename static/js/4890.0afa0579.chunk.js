"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[4890],{542:(e,t,s)=>{s.d(t,{c:()=>S});s(81806);var i=s(86300),o=s(85827),r=s(9377),n=s(30726),l=s(97255),a=(s(40181),s(93453)),h=(s(15389),s(96345),s(6645)),c=s(76718),y=s(36911),u=s(9243);class d{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let s=1;const i=new Uint32Array(e);this.layerUIDs=[];const o=i[s++];for(let r=0;r<o;r++)this.layerUIDs[r]=i[s++];this.bufferDataOffset=s,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}class f extends d{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.lineIndexStart=s[i++],this.lineIndexCount=s[i++];const o=s[i++];if(o>0){this.patternMap=new Map;for(let e=0;e<o;e++){const e=s[i++],t=s[i++],o=s[i++];this.patternMap.set(e,[t,o])}}this.bufferDataOffset=i}get usedMemory(){var e,t,s,i;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(i=this.vao)||void 0===i?void 0:i.usedMemory)&&void 0!==s?s:0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,n.WD)(this.vao)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),o=new Int32Array(i.buffer),r=i[s++],n=this.layer.lineMaterial,l=new u.R(e,n.geometryLayout,new Int32Array(o.buffer,4*s,r));s+=r;const a=i[s++],h=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,a));s+=a,this.vao=new y.Z(e,l,h)}}class m extends d{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.fillIndexStart=s[i++],this.fillIndexCount=s[i++],this.outlineIndexStart=s[i++],this.outlineIndexCount=s[i++];const o=s[i++];if(o>0){this.patternMap=new Map;for(let e=0;e<o;e++){const e=s[i++],t=s[i++],o=s[i++];this.patternMap.set(e,[t,o])}}this.bufferDataOffset=i}get usedMemory(){var e,t,s,i,o,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(i=this.fillVAO)||void 0===i?void 0:i.usedMemory)&&void 0!==s?s:0)+(null!==(o=null===(r=this.outlineVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==o?o:0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,n.WD)(this.fillVAO),this.outlineVAO=(0,n.WD)(this.outlineVAO)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),o=new Int32Array(i.buffer),r=i[s++],n=this.layer,l=n.fillMaterial,a=new u.R(e,l.geometryLayout,new Int32Array(o.buffer,4*s,r));s+=r;const h=i[s++],d=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,h));s+=h;const f=i[s++],m=n.outlineMaterial,_=new u.R(e,m.geometryLayout,new Int32Array(o.buffer,4*s,f));s+=f;const p=i[s++],b=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,p));s+=p,this.fillVAO=new y.Z(e,a,d),this.outlineVAO=new y.Z(e,_,b)}}class _ extends d{constructor(e,t,s){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(e),o=new Int32Array(e),r=new Float32Array(e);let n=this.bufferDataOffset;this.isIconSDF=!!i[n++];const l=i[n++],c=i[n++],y=i[n++],u=new a.A(l,c,y,0),d=i[n++];for(let a=0;a<d;a++){const e=i[n++],t=i[n++],s=i[n++];this.iconPerPageElementsMap.set(e,[t,s])}const f=i[n++];for(let a=0;a<f;a++){const e=i[n++],t=i[n++],s=i[n++];this.glyphPerPageElementsMap.set(e,[t,s])}const m=i[n++],_=i[n++];this.iconOpacity=new Int32Array(m),this.textOpacity=new Int32Array(_),n=(0,h.X1)(i,o,r,n,this.symbols,s,u),this.bufferDataOffset=n}get usedMemory(){var e,t,s,i,o,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(i=this.iconVAO)||void 0===i?void 0:i.usedMemory)&&void 0!==s?s:0)+(null!==(o=null===(r=this.textVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==o?o:0)+(0,l.Qf)(this.iconOpacity)+(0,l.Qf)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const t of this.iconPerPageElementsMap.values())e+=t[1];for(const t of this.glyphPerPageElementsMap.values())e+=t[1];return e/3}doDestroy(){this.iconVAO=(0,n.WD)(this.iconVAO),this.textVAO=(0,n.WD)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,t=this.iconVAO.buffer("opacity");e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);const s=this.textOpacity,i=this.textVAO.buffer("opacity");s.length>0&&s.byteLength===i.usedMemory&&i.setSubData(s,0,0,s.length)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),o=new Int32Array(i.buffer),r=i[s++],n=this.layer,l=n.iconMaterial,a=new u.R(e,l.geometryLayout,new Int32Array(o.buffer,4*s,r));s+=r;const h=i[s++],d=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,h));s+=h;const f=i[s++],m=n.textMaterial,_=new u.R(e,m.geometryLayout,new Int32Array(o.buffer,4*s,f));s+=f;const p=i[s++],b=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,p));s+=p;const g=new u.R(e,l.opacityLayout,this.iconOpacity.buffer),S=new u.R(e,m.opacityLayout,this.textOpacity.buffer);this.iconVAO=new y.Z(e,new Map([["geometry",a],["opacity",g]]),d),this.textVAO=new y.Z(e,new Map([["geometry",_],["opacity",S]]),b)}}class p extends d{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.circleIndexStart=s[i++],this.circleIndexCount=s[i++],this.bufferDataOffset=i}get usedMemory(){var e,t,s,i;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(i=this.vao)||void 0===i?void 0:i.usedMemory)&&void 0!==s?s:0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,n.WD)(this.vao)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),o=new Int32Array(i.buffer),r=i[s++],n=this.layer.circleMaterial,l=new u.R(e,n.geometryLayout,new Int32Array(o.buffer,4*s,r));s+=r;const a=i[s++],h=c.g.createIndex(e,35044,new Uint32Array(i.buffer,4*s,a));s+=a,this.vao=new y.Z(e,l,h)}}var b=s(62887),g=s(78440);class S extends g.Y{constructor(e,t,s,i,o,n,l){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;super(e,t,s,i,o,n,r.vA,r.vA),this.styleRepository=l,this._owner=a,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=e.id}get styleLayerUIDs(){return Array.from(this.layerData.keys())}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<b.zk}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.zk)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var t,s;let i=!1;for(const o of e){const e=this.layerData.get(o);e&&(this._usedMemory-=e.usedMemory,3===e.type&&this.symbols.delete(o)&&(i=!0),e.destroy(),this.layerData.delete(o))}null!==(t=this._owner)&&void 0!==t&&t.updateTileSize(this),i&&(null!==(s=this.featureIndex)&&void 0!==s&&s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const e=this.layerData.values();for(const t of e)if(t.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(S._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){var e;0===--this._referenced&&(null!==(e=this._owner)&&void 0!==e&&e.onDisposeTile(this),this.dispose(),this.stage=null)}retain(){++this._referenced}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(e){var t;null===(t=this.featureIndex)||void 0===t||t.clear();let s=!1;if(e){var i;const{bucketsWithData:t,emptyBuckets:o}=e,r=this._createRenderBuckets(t);if(o&&o.byteLength>0){const e=new Uint32Array(o);for(const t of e)this._deleteLayerData(t)}for(const[e,i]of r)this._deleteLayerData(e),3===i.type&&(this.symbols.set(e,i.symbols),s=!0),this._usedMemory+=i.usedMemory,this.layerData.set(e,i);null===(i=this._owner)||void 0===i||i.updateTileSize(this)}this._hasSymbolBuckets=!1;for(const o of this.layerData.values())3===o.type&&(this._hasSymbolBuckets=!0);s&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),s=this.width/this.rangeX*t,o=this.height/this.rangeY*t,r=[0,0];e.toScreen(r,[this.x,this.y]);const n=this.transforms.tileUnitsToPixels;(0,i.D_)(n),(0,i.Tl)(n,n,r),(0,i.e$)(n,n,Math.PI*e.rotation/180),(0,i.hs)(n,n,[s,o,1])}_createTransforms(){return{displayViewScreenMat3:(0,o.vt)(),tileMat3:(0,o.vt)(),tileUnitsToPixels:(0,o.vt)()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;for(const s of e.values())t.has(s)||(s.destroy(),t.add(s));e.clear()}_createRenderBuckets(e){const t=new Map,s=new Map;for(const i of e){const e=this._deserializeBucket(i,s);for(const s of e.layerUIDs)t.set(s,e)}return t}_deserializeBucket(e,t){let s=t.get(e);if(s)return s;switch(new Uint32Array(e)[0]){case 1:s=new m(e,this.styleRepository);break;case 2:s=new f(e,this.styleRepository);break;case 3:s=new _(e,this.styleRepository,this);break;case 4:s=new p(e,this.styleRepository)}return t.set(e,s),s}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._usedMemory-=t.usedMemory,t.destroy(),this.layerData.delete(e)}}},4890:(e,t,s)=>{s.d(t,{J:()=>M});var i=s(75540),o=s(85827),r=s(62887),n=s(6645);class l{constructor(e,t,s,i,l,a){this._symbols=e,this._styleRepository=i,this._zoom=l,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new n.xT(t,s,r.o2),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180),i.cachedStyles&&(this._styleProps=i.cachedStyles);for(const r of e)for(const e of r.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,o.o8)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){var s;const o=this._symbols[this._currentLayerCursor],r=this._getProperties(o.styleLayerUID),n=null===(s=this._styleRepository.layerContexts)||void 0===s?void 0:s.get(o.styleLayerUID);for(;this._currentSymbolCursor<o.symbols.length;this._currentSymbolCursor++){var i;if(this._currentSymbolCursor%100==99&&performance.now()-t>e)return!1;const s=o.symbols[this._currentSymbolCursor];if(null===(i=s.uniqueSymbol)||void 0===i||!i.show)continue;const l=this._computeCoordinates(s,r,n),a=s.uniqueSymbol;if(!a.show)continue;const{iconAllowOverlap:h,textAllowOverlap:c}=r;for(const e of l){if(!e.enabled)continue;const t=a.parts[e.partIndex];t.show&&(!(e.partIndex?c:h)&&this._doesCollide(e)&&(e.hard?a.show=!1:t.show=!1))}a.show&&this._insertColliders(a.parts,l,r)}}return!0}_insertColliders(e,t,s){const{iconIgnorePlacement:i,textIgnorePlacement:o}=s;for(const r of t){if(!r.enabled)continue;if(r.partIndex?o:i)continue;if(!e[r.partIndex].show)continue;const t=r.xScreen+r.dxScreen,s=r.yScreen+r.dyScreen,n=t+r.width,l=s+r.height,[a,h,c,y]=this._gridIndex.getCellSpan(t,s,n,l);for(let e=h;e<=y;e++)for(let t=a;t<=c;t++)this._gridIndex.cells[e][t].push(r)}}_computeCoordinates(e,t,s){const{iconRotationAlignment:i,textRotationAlignment:o,iconTranslate:r,iconTranslateAnchor:n,textTranslate:l,textTranslateAnchor:a}=t,h=this._si,c=this._co,y=this._zoom,u=this._allNeededMatrices.get(e.tile),d=e.uniqueSymbol,f=e.colliders(s);let m=0;for(const _ of f){const[e,t]=0===_.partIndex?r:l,s=0===_.partIndex?n:a,d=_.minLod<=y&&y<=_.maxLod;m+=d?0:1,_.enabled=d,_.xScreen=_.xTile*u[0]+_.yTile*u[3]+u[6],_.yScreen=_.xTile*u[1]+_.yTile*u[4]+u[7],0===s?(_.xScreen+=c*e-h*t,_.yScreen+=h*e+c*t):(_.xScreen+=e,_.yScreen+=t),1===(0===_.partIndex?i:o)?(_.dxScreen=_.dxPixels,_.dyScreen=_.dyPixels):(_.dxScreen=c*(_.dxPixels+_.width/2)-h*(_.dyPixels+_.height/2)-_.width/2,_.dyScreen=h*(_.dxPixels+_.width/2)+c*(_.dyPixels+_.height/2)-_.height/2)}return f.length>0&&m===f.length&&d&&(d.show=!1),f}_getProperties(e){var t,s;const i=this._styleProps.get(e);if(i)return i;const o=null===(t=(s=this._styleRepository).getLayerStyleProperties)||void 0===t?void 0:t.call(s,e,this._zoom);return this._styleProps.set(e,o),o}_doesCollide(e){const t=e.xScreen+e.dxScreen,s=e.yScreen+e.dyScreen,i=t+e.width,o=s+e.height,[r,n,l,a]=this._gridIndex.getCellSpan(t,s,i,o);for(let h=n;h<=a;h++)for(let n=r;n<=l;n++){const r=this._gridIndex.cells[h][n];for(const n of r){if(null!=n.labelId&&null!=e.labelId&&n.labelId===e.labelId)continue;const r=n.xScreen+n.dxScreen,l=n.yScreen+n.dyScreen,a=r+n.width,h=l+n.height;if(!(i<r||t>a||o<l||s>h))return!0}}return!1}}var a=s(542),h=s(5095);function c(e){var t,s,i;return null!==(t=(null===(s=e.uniqueSymbol)||void 0===s?void 0:s.show)&&(null===(i=e.uniqueSymbol)||void 0===i?void 0:i.lastShow))&&void 0!==t&&t}function y(e,t){if(e.priority-t.priority)return e.priority-t.priority;if(c(e)&&!c(t))return-1;if(c(t)&&!c(e))return 1;const s=e.tile.key,i=t.tile.key;return s.world-i.world?s.world-i.world:s.level-i.level?s.level-i.level:s.row-i.row?s.row-i.row:s.col-i.col?s.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class u{get running(){return this._running}constructor(e,t,s,i,o,r,n,l){this.selectionMode=e,this._visibleTiles=t,this._symbolRepository=s,this._styleRepository=i,this._createCollisionJob=o,this._assignTileSymbolsOpacity=r,this._symbolLayerSorter=n,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_isFeatureFiltered(e,t,s){const i=t.getFilterFlags(e),o=i&h.LY,r=null==s.featureEffect||s.featureEffect.excludedLabelsVisible||i&h.g0;return!(o&&r)}_getFilteredByLayer(){var e;let t;if(null!==(e=this._styleRepository)&&void 0!==e&&e.layerContexts)for(const o of this._symbolRepository.uniqueSymbols){var s;const e=null===(s=this._styleRepository.layerContexts)||void 0===s?void 0:s.get(o.styleLayerUID);if(null!==e&&void 0!==e&&e.attributeView)for(const s of o.uniqueSymbols){var i;null!==(i=t)&&void 0!==i||(t=new Map),t.get(o.styleLayerUID)||t.set(o.styleLayerUID,new Set);const r=t.get(o.styleLayerUID),n=e.attributeView,l=e.layerView;this._isFeatureFiltered(s.id,n,l)&&r.add(s.id)}}return t}_resetSelection(){for(let e=0;e<this._symbolRepository.uniqueSymbols.length;e++){const t=this._symbolRepository.uniqueSymbols[e];for(let e=0;e<t.uniqueSymbols.length;e++){const s=t.uniqueSymbols[e];for(const e of s.tileSymbols)e.selectedForRendering=!1}}}_createSelectionJob(){var e;const t="feature-tile"===this.selectionMode?f:m,s=this._symbolRepository.uniqueSymbols;this._resetSelection();const i=[];let o=0,r=0;const n=this._isLayerVisible,l=this._getFilteredByLayer(),a=null===(e=this._styleRepository)||void 0===e?void 0:e.layerContexts;const h=this._symbolLayerSorter;return{work:function(e){let h;const c=performance.now();for(;r<s.length;r++,o=0){var u;const y=s[r],d=y.styleLayerUID,f=null===l||void 0===l?void 0:l.get(d);let m=0;if(a){const e=a.get(d).layerView;m=e.view.allLayerViews.items.indexOf(e)}if(!n(d)){i[r]||(i[r]={styleLayerUID:d,layerOrder:m,symbols:[]});continue}i[u=r]||(i[u]={styleLayerUID:d,symbols:[],layerOrder:m});const _=i[r];for(;o<y.uniqueSymbols.length;o++){if(h=y.uniqueSymbols[o],o%100==99&&performance.now()-c>e)return!1;if(h.lastShow=h.show,h.id&&null!==f&&void 0!==f&&f.has(h.id)){h.show=!1,h.parts[0].show=!1,h.parts[1].show=!1;continue}const s=t(h);if(s){s.selectedForRendering=!0,_.symbols.push(s),h.show=!0;for(const e of h.parts)e.show=!0}else h.show=!1}}for(const t of i)t.symbols.sort(y);return i.sort((e,t)=>t.layerOrder-e.layerOrder),!0},get sortedSymbols(){return i.sort(h)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let s=0;function i(t,s){for(const e of t.symbols.values())d(e,s);e(t,s);for(const e of t.childrenTiles)i(e,s)}return{work(o){const r=performance.now();for(;s<t.length;s++){if(performance.now()-r>o)return!1;const n=t[s];if(null!=n.parentTile)continue;const l=performance.now();n instanceof a.c?i(n,l):e(n,l)}return!0}}}}function d(e,t){for(const s of e){const e=s.uniqueSymbol;for(const s of e.parts){const i=s.targetOpacity>.5?1:-1;s.startOpacity+=i*((t-s.startTime)/r.zk),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=t,s.targetOpacity=e.show&&s.show?1:0}}}function f(e){var t,s;let i=null,o=null,r=null;for(const n of e.tileSymbols){const e=n.tile;e.isReady&&e.isCoverage?i=n:e.isReady?o=n:e.rendering&&(r=n)}return null!==(t=null!==(s=i)&&void 0!==s?s:o)&&void 0!==t?t:r}function m(e){let t=null,s=!1,i=!1;for(const o of e.tileSymbols)if(!i||!s){const e=o.tile;(!t||e.isCoverage||e.neededForCoverage&&!s)&&(t=o,(e.neededForCoverage||e.isCoverage)&&(i=!0),e.isCoverage&&(s=!0))}return i?t:null}var _=s(36458);class p{static fromSymbols(e,t){let s=e.length;if(s>=b){let i=t;do{i/=2,s/=4}while(s>g&&i>S);const o=new n.xT(t,t,i);for(const t of e)o.getCell(t.xTile,t.yTile).push(t);return new p(t,e,o)}return new p(t,e,null)}constructor(e,t,s){this.tileCoordRange=e,this._symbols=t,this._index=s}addSymbols(e){for(const t of e)this._symbols.push(t);if(this._index)for(const t of e)this._index.getCell(t.xTile,t.yTile).push(t)}removeSymbols(e){const t=new Set(e);if(this._symbols=this._symbols.filter(e=>!t.has(e)),this._index)for(const s of this._index.cells)for(let e=0;e<s.length;e++)s[e]=s[e].filter(e=>!t.has(e))}getSymbols(){return this._symbols}getCandidate(e,t,s,i){if(!this._index){for(const o of this._symbols)if(s===o.hash&&Math.abs(e-o.xTile)<=i&&Math.abs(t-o.yTile)<=i)return o;return null}const o=this._index.getCellSpan(e-i,t-i,e+i,t+i),[r,n,l,a]=o;for(let h=n;h<=a;h++)for(let o=r;o<=l;o++){const r=this._index.cells[h][o];for(const o of r)if(s===o.hash&&Math.abs(e-o.xTile)<=i&&Math.abs(t-o.yTile)<=i)return o}return null}}const b=32,g=8,S=64;class w{constructor(e,t){this.tileCoordRange=e,this._visibleTiles=t,this._indexMapByTile=new Map,this._uniqueSymbolsByStyleLayerId=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}registerVectorTile(e,t){var s;const i=this._ensureIndexMap(e),o=null!==(s=null===t||void 0===t?void 0:t.values())&&void 0!==s?s:i.keys();for(const r of o){const e=i.get(r);e&&(this._removeSymbols(r,e.getSymbols()),i.delete(r))}this._addSymbols(e.key,i,e.symbols),this._invalidate()}unregisterVectorTile(e){this._removeTile(e),this._invalidate()}registerFeatureTile(e){this._ensureIndexMap(e),this._invalidate()}unregisterFeatureTile(e){this._removeTile(e),this._invalidate()}insertFeatureTileMetrics(e,t){const s=this._indexMapByTile.get(e);if(!s)throw new Error("tile ".concat(e.id," not registered!"));this._addSymbols(e.key,s,v(t)),this._invalidate()}removeFeatureTileMetrics(e,t){const s=this._indexMapByTile.get(e);if(!s)return;const i=v(t);for(const[o,r]of s.entries()){const e=i.get(o);e&&(r.removeSymbols(e),this._removeSymbols(o,e))}this._invalidate()}deleteStyleLayers(e){for(const t of this._indexMapByTile.values())for(const s of e){const e=t.get(s);e&&(this._removeSymbols(s,e.getSymbols()),t.delete(s))}this._invalidate()}querySymbols(e,t,s,i){const o=[];for(const[r,l]of this._uniqueSymbolsByStyleLayerId.entries())for(const i of l){const l=i.tileSymbols.find(e=>e.selectedForRendering);l&&(0,n.OI)(l,e,t*(window.devicePixelRatio||1),s)&&o.push({vtlSymbol:l,styleLayerUID:r,tileKey:l.tile.key})}return o}_ensureIndexMap(e){let t=this._indexMapByTile.get(e);return t||(t=new Map,this._indexMapByTile.set(e,t)),t}_invalidate(){this._uniqueSymbolLayerArray=null}_addSymbols(e,t,s){for(const[i,o]of s){let e=t.get(i);e?e.addSymbols(o):(e=p.fromSymbols(o,this.tileCoordRange),t.set(i,e))}this._updateUniqueSymbols(e,s)}_removeTile(e){const t=this._indexMapByTile.get(e);if(t){for(const[e,s]of t.entries())this._removeSymbols(e,s.getSymbols());this._indexMapByTile.delete(e),this._invalidate()}}_removeSymbols(e,t){for(const s of t){const t=s.uniqueSymbol;if(t){if(t.tileSymbols=t.tileSymbols.filter(e=>e!==s),0===t.tileSymbols.length){const s=this._uniqueSymbolsByStyleLayerId.get(e);s.delete(t),0===s.size&&this._uniqueSymbolsByStyleLayerId.delete(e)}s.uniqueSymbol=null}}}_updateUniqueSymbols(e,t){if(0!==t.size){for(const s of this._visibleTiles)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,t);for(const[e,s]of t)for(const t of s)if(!t.uniqueSymbol){t.uniqueSymbol=new _.w(t);let s=this._uniqueSymbolsByStyleLayerId.get(e);s||(s=new Set,this._uniqueSymbolsByStyleLayerId.set(e,s)),s.add(t.uniqueSymbol)}}}_matchSymbols(e,t,s){if(e.key.level>t.level){const s=e.key.level-t.level;if(e.key.row>>s!==t.row||e.key.col>>s!==t.col)return}if(t.level>e.key.level){const s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}const i=new Map;for(const[o,r]of s){const s=[],l=20+(e.key.level<t.level?1:1<<e.key.level-t.level),a=this._indexMapByTile.get(e),h=null===a||void 0===a?void 0:a.get(o);if(h)for(const i of r){if(i.uniqueSymbol)continue;const o=(0,n.Ag)(this.tileCoordRange,i.xTile,t,e.key),r=(0,n.tE)(this.tileCoordRange,i.yTile,t,e.key),a=-20,c=this.tileCoordRange+20;if(!(o>=a&&o<c&&r>=a&&r<c)){s.push(i);continue}const y=h.getCandidate(o,r,i.hash,l),u=null===y||void 0===y?void 0:y.uniqueSymbol;u?(i.uniqueSymbol=u,u.tileSymbols.push(i)):s.push(i)}s.length>0&&i.set(o,s)}for(const o of e.childrenTiles||[])this._matchSymbols(o,t,i)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsByStyleLayerId,t=new Array(e.size);let s,i=0;for(const[o,r]of e){const e=new Array(r.size);s=0;for(const t of r)e[s++]=t;t[i]={styleLayerUID:o,uniqueSymbols:e},i++}return t}}function v(e){const t=new Map;for(const s of e){const e=s.labelClassId;let i=t.get(e);i||(i=[],t.set(e,i)),i.push(s)}return t}const x=1e-6;class M{constructor(e,t,s,o,n){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r.av;this.styleRepository=t,this._declutterBudget=l,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=(0,i.v)(!1);this._symbolRepository=new w(n,o),this._symbolDeclutterer=new u(e,o,this._symbolRepository,this.styleRepository,(e,t,s)=>this._createCollisionJob(e,t,s),s,(e,t)=>{var s,i,o,r,n,l;return(null!==(s=null===(i=(o=this.styleRepository).getStyleLayerByUID)||void 0===i||null===(i=i.call(o,e.styleLayerUID))||void 0===i?void 0:i.z)&&void 0!==s?s:0)-(null!==(r=null===(n=(l=this.styleRepository).getStyleLayerByUID)||void 0===n||null===(n=n.call(l,t.styleLayerUID))||void 0===n?void 0:n.z)&&void 0!==r?r:0)},e=>{var t,s,i;const o=null===(t=(s=this.styleRepository).getStyleLayerByUID)||void 0===t?void 0:t.call(s,e);if(o){var r;if(this._zoom+x<o.minzoom||this._zoom-x>=o.maxzoom)return!1;const e=null===(r=o.getLayoutProperty)||void 0===r?void 0:r.call(o,"visibility");if(e&&1===e.getValue())return!1}const n=null===(i=this.styleRepository.layerContexts)||void 0===i?void 0:i.get(e);return!(n&&!n.layerView.layer.visible)})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(e,t,s){return this.updateDecluttererViewState(),new l(e,t,s,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}registerFeatureTile(e){this.symbolRepository?(this.symbolRepository.registerFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}unregisterFeatureTile(e){this.symbolRepository?(this._symbolRepository.unregisterFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}insertFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.insertFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}removeFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.removeFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}addTile(e){e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",()=>{this._symbolRepository.registerVectorTile(e),this.restartDeclutter()})),this._symbolRepository.registerVectorTile(e),this.restartDeclutter()}removeTile(e){const t=this._tileToHandle.get(e);t&&(this._symbolRepository.unregisterVectorTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}update(e,t){this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};const s=[0,0];t.toScreen(s,t.center);const i=[0,0];return t.toScreen(i,this._declutterViewState.center),this._offsetFromScreenCenter[0]=s[0]-i[0],this._offsetFromScreenCenter[1]=s[1]-i[1],this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach(e=>e.remove()),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(e){this._symbolRepository.deleteStyleLayers(e)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(this._declutterBudget),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null,this._fading.value=!1},1.5*r.zk)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}}},6645:(e,t,s)=>{s.d(t,{Ag:()=>r,OI:()=>u,X1:()=>h,jy:()=>c,tE:()=>n,xT:()=>a});var i=s(55033),o=s(36458);function r(e,t,s,i){return l(e,t,s.level,s.col,i.key.level,i.key.col)}function n(e,t,s,i){return l(e,t,s.level,s.row,i.level,i.row)}function l(e,t,s,i,o,r){const n=s-o;if(n>=0)return(t>>n)+(i-(r<<n))*(e>>n);const l=-n;return t-(r-(i<<l))*(e>>l)<<l}class a{constructor(e,t,s){this._rows=Math.ceil(t/s),this._columns=Math.ceil(e/s),this._cellSize=s,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[i][e]=[]}}getCell(e,t){const s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][i]||null}getCellSpan(e,t,s,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function h(e,t,s,i,r,n,l){const a=t[i++];for(let h=0;h<a;h++){const a=new o.D(n,l);a.xTile=t[i++],a.yTile=t[i++],a.hash=t[i++],a.priority=t[i++],a.featureIndex=t[i++];const h=t[i++],c=a.colliders();for(let e=0;e<h;e++){const e=t[i++],o=t[i++],r=t[i++],n=t[i++],l=!!t[i++],a=t[i++],h=s[i++],y=s[i++],u=t[i++],d=t[i++];c.push({xTile:e,yTile:o,dxPixels:r,dyPixels:n,hard:l,partIndex:a,width:u,height:d,minLod:h,maxLod:y})}const y=e[i++];for(let t=0;t<y;t++)a.textVertexRanges.push([e[i++],e[i++]]);const u=e[i++];for(let t=0;t<u;t++)a.iconVertexRanges.push([e[i++],e[i++]]);r.push(a)}return i}function c(e,t,s){for(const[i,o]of e.symbols)y(e,t,s,o,i)}function y(e,t,s,i,o){const r=e.layerData.get(o);if(3===r.type){for(const t of i){const i=t.uniqueSymbol;let o;if(t.selectedForRendering){const t=i.parts[0],r=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*r)|n<<7:n?255:0;o=l<<24|l<<16|l<<8|l}else o=0;for(const[e,s]of t.iconVertexRanges)for(let t=e;t<e+s;t+=4)r.iconOpacity[t/4]=o;if(t.selectedForRendering){const t=i.parts[1],r=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*r)|n<<7:n?255:0;o=l<<24|l<<16|l<<8|l}else o=0;for(const[e,s]of t.textVertexRanges)for(let t=e;t<e+s;t+=4)r.textOpacity[t/4]=o}r.lastOpacityUpdate=t,r.opacityChanged=!0}}function u(e,t,s,o){const r=e.colliders();let n,l,a,h;for(const y of r){var c;if(null!==(c=e.uniqueSymbol)&&void 0!==c&&c.show&&e.uniqueSymbol.parts[y.partIndex].show&&(n=y.xScreen-o[0]+y.dxScreen,l=y.yScreen-o[1]+y.dyScreen,a=n+y.width,h=l+y.height,(0,i.w4)(s,t.x,t.y,n,l,a,h)))return!0}return!1}},36458:(e,t,s)=>{s.d(t,{D:()=>i,w:()=>o});class i{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.uniqueSymbol=null,this._colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}colliders(){return this._colliders}}class o{constructor(e){this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1,this.lastShow=!1,this.tileSymbols=[e],this.id=e.id}}}}]);
//# sourceMappingURL=4890.0afa0579.chunk.js.map