(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[62,9,35],{1122:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Ye}));var r=i(26),n=i(23),a=i(13),s=i(4),o=i.n(s),l=i(9),u=i(2),c=i(3),h=i(41),f=i(38),y=i(5),v=i(6),p=i(0),d=i(80),b=i(18),_=i(68),g=i(19),m=i(11),O=i(7),k=i(21),x=i(25),w=i(1),j=(i(15),i(12)),P=i(8),S=i(313),M=i(139),I=i(10),T=i(54),C=i(431),L=i(320),D=i(549),A=(i(551),i(548),i(547),i(552),i(543),i(545)),R=i(550),E=i(598),z=function(){function e(t,i){Object(u.a)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new E.a(0,0,t,i))}return Object(c.a)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new E.a;for(var i=null,r=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,r=n)}return null===i?new E.a:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new E.a(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new E.a(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new E.a(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new E.a(i.x,i.y+t,e,i.height-t))),new E.a(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),B=function(){function e(t,i,r){Object(u.a)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new z(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return Object(c.a)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,n=[],s=this._glyphSource,o=new Set,l=Object(a.a)(t);try{for(l.s();!(i=l.n()).done;){var u=i.value,c=Math.floor(.00390625*u);o.add(c)}}catch(f){l.e(f)}finally{l.f()}var h=[];return o.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))h.push(r._rangePromises.get(i));else{var n=s.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,n),h.push(n)}}})),Promise.all(h).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var o,l=Object(a.a)(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=i[u];if(c)n[u]={sdf:!0,rect:c.rect,metrics:c.metrics,page:c.page,code:u};else{var h=s.getGlyph(e,u);if(h&&h.metrics){var y=h.metrics,v=void 0;if(0===y.width)v=new E.a(0,0,0,0);else{var p=y.width+6,d=y.height+6,b=p%4?4-p%4:4,_=d%4?4-d%4:4;1===b&&(b=5),1===_&&(_=5),(v=r._binPack.allocate(p+b,d+_)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new z(r.width-4,r.height-4),v=r._binPack.allocate(p+b,d+_));var g=r._glyphData[r._currentPage],m=h.bitmap,O=void 0,k=void 0;if(m)for(var x=0;x<d;x++){O=p*x,k=r.width*(v.y+x+1)+v.x;for(var w=0;w<p;w++)g[k+w+1]=m[O+w]}}i[u]={rect:v,metrics:y,tileIDs:null,page:r._currentPage},n[u]={sdf:!0,rect:v,metrics:y,page:r._currentPage,code:u},r._dirties[r._currentPage]=!0}}}}catch(f){l.e(f)}finally{l.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var a=this._glyphData[r.page],s=r.rect,o=void 0,l=void 0,u=0;u<s.height;u++)for(o=this.width*(s.y+u)+s.x,l=0;l<s.width;l++)a[o+l]=0;delete i[n],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new A.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(this._glyphData[i]),e.bindTexture(n,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=Object(a.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),V=i(422),U=function(){function e(t){if(Object(u.a)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),n=void 0,a=void 0,s=void 0,o=void 0,l=void 0,c=void 0,h=void 0;r.next();)switch(r.tag()){case 1:n=r.getUInt32();break;case 2:a=r.getBytes();break;case 3:s=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:l=r.getSInt32();break;case 6:c=r.getSInt32();break;case 7:h=r.getUInt32();break;default:r.skip()}r.release(),n&&(this._metrics[n]={width:s,height:o,left:l,top:c,advance:h},this._bitmaps[n]=a)}else i.skip();i.release()}else t.skip()}return Object(c.a)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),F=function(){function e(){Object(u.a)(this,e),this._ranges=[]}return Object(c.a)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),H=function(){function e(t){Object(u.a)(this,e),this._glyphInfo={},this._baseURL=t}return Object(c.a)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,n=r+255,a=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+n);return Object(T.default)(a,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new U(new V.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new U)}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new F),t}}]),e}(),q=i(564),N="dasharray-",G=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(u.a)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new z(t-4,i-4)}return Object(c.a)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=Object(a.a)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,a,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this._mosaicRects[e];if(o)return o;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(N)?(t=this._rasterizeDash(e),r=(i=Object(n.a)(t,2))[0],a=i[1],s=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var l=r.width,u=r.height,c=this._allocateImage(l,u),h=Object(n.a)(c,3),f=h[0],y=h[1],v=h[2];return f.width<=0?null:(this._copy(f,r,y,v,s,a),o={rect:f,width:l,height:u,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:y},this._mosaicRects[e]=o,o)}},{key:"getSpriteItems",value:function(e){var t,i={},r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[n.name]=this.getSpriteItem(n.name,n.repeat)}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,a=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+n,r.y+2+a],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new A.a(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(n,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,n,a,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(s?s.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&o||console.error("Source or target images are uninitialized!");var u=s?i.width:this._sprites.width;e._copyBits(o,u,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,a),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new E.a(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,a=t%4?4-t%4:4;1===n&&(n=5),1===a&&(a=5);var s=this._binPack.allocate(e+n,t+a);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),a=q.c.rasterizeDash(i,r),s=Object(n.a)(a,3),o=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,n,a,s,o,l,u,c){var h=r*t+i,f=o*a+s;if(c){f-=a;for(var y=-1;y<=u;h=((++y+u)%u+r)*t+i,f+=a)for(var v=-1;v<=l;v++)n[f+v]=e[h+(v+l)%l]}else for(var p=0;p<u;p++){for(var d=0;d<l;d++)n[f+d]=e[h+d];h+=t,f+=a}}}]),e}(),Y=i(917);function X(e,t,i,r,n,a){e.fillStyle=t,e.fillRect(i,r,n,a)}function W(e,t,i,r,n,a){e.strokeStyle=t,e.strokeRect(i,r,n,a)}function J(e,t){for(var i=window.COLLISION_XRAY,r=0;r<t.length;++r){var n=!t[r].unique.show;if(i||!n){var s,o=Object(a.a)(t[r].colliders);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(l.enabled){var u=!t[r].unique.parts[l.partIndex].show;if(i||!u){var c=l.xScreen,h=l.yScreen,f=l.dxScreen,y=l.dyScreen;e.globalAlpha=n||u?.2:1,X(e,"green",c-1,h-1,3,3),W(e,"red",c+f,h+y,l.width,l.height),X(e,"blue",c+f-1,h+y-1,3,3),e.globalAlpha=1}}}}catch(v){o.e(v)}finally{o.f()}}}}var Q=i(160),K=new C.a(10),Z=new Map,$=function(){function e(t,i,r){Object(u.a)(this,e),this._vectorTileLayer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return Object(c.a)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var i,r,n,a,s,l,u=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in i=this._vectorTileLayer,r=i.sourceNameToSource,n=[],r)n.push(this._fetchTileMap(r[a],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){u._spriteMosaic=new G(1024,1024,250),u._spriteMosaic.setSpriteSource(e)})),s=this._styleRepository,l=new H(s.glyphs),e.abrupt("return",(this._glyphMosaic=new B(1024,1024,l),this._broadcastPromise=Object(L.b)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){return u._connection=e,Promise.all(u._connection.broadcast("setStyle",{style:i.currentStyleInfo.style,vectorTileLayerMaxBuffers:Object(j.a)("vectortilelayer-max-buffers")},t))})),Promise.all(n)));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var i=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=new Promise((function(e,r){Promise.all(i._connection.broadcast("updateStyle",t)).then(e,r)})),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,n,a,s,l=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:for(a in this._styleRepository=t,r=this._vectorTileLayer.sourceNameToSource,n=[],r)n.push(this._fetchTileMap(r[a],null));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){l._spriteMosaic=new G(1024,1024,250),l._spriteMosaic.setSpriteSource(e)})),s=new H(t.glyphs),e.abrupt("return",(this._glyphMosaic=new B(1024,1024,s),this._broadcastPromise=new Promise((function(e,t){Promise.all(l._connection.broadcast("setStyle",{style:i,vectorTileLayerMaxBuffers:Object(j.a)("vectortilelayer-max-buffers")})).then(e,t)})),n.push(this._broadcastPromise),Promise.all(n)));case 8:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._vectorTileLayer.sourceNameToSource,n=[];for(var a in r)n.push(a);return i._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,a=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.getAvailableClient().then((function(i){return i.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},Object(I.a)(Object(I.a)({},t),{},{transferList:a})).then((function(e){return{tileData:e}}))}))}))}},{key:"getSprites",value:function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){!function(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var n=r.perf;n[e]=n[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},n[e].time+=t,n[e].samples.push(t),(null==n[e].min||t<n[e].min)&&(n[e].min=t),(null==n[e].max||t>n[e].max)&&(n[e].max=t)}}(e.key,e.milliseconds,"ms")}},{key:"_getTilePayload",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i,r){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Q.a.pool.acquire(t.id),a=this._vectorTileLayer.sourceNameToSource[i].getSourceTileUrl(n.level,n.row,n.col),Q.a.pool.release(n),e.prev=2,e.next=5,this.request(a,r);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!Object(k.m)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"request",value:function(e,t){return Object(T.default)(e,Object(I.a)({responseType:"array-buffer"},t)).then((function(e){return e.data}))}},{key:"_fetchTileMap",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.capabilities.operations.supportsTileMap||!t.tileIndex){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(t.tileMapURL){e.next=4;break}return e.abrupt("return");case 4:if(!(r=K.get(t.tileMapURL))){e.next=7;break}return e.abrupt("return",void(t.tileIndex=r));case 7:if(!Z.has(t.tileMapURL)){e.next=20;break}return e.prev=8,e.next=11,Z.get(t.tileMapURL);case 11:n=e.sent,t.tileIndex=new Y.a(n.data),e.next=19;break;case 15:if(e.prev=15,e.t0=e.catch(8),!Object(k.m)(e.t0)){e.next=19;break}throw e.t0;case 19:return e.abrupt("return");case 20:return a=Object(T.default)(t.tileMapURL,i),Z.set(t.tileMapURL,a),e.prev=22,e.next=25,a;case 25:n=e.sent,Z.delete(t.tileMapURL),K.put(t.tileMapURL,t.tileIndex),t.tileIndex=new Y.a(n.data),e.next=35;break;case 31:if(e.prev=31,e.t1=e.catch(22),Z.delete(t.tileMapURL),!Object(k.m)(e.t1)){e.next=35;break}throw e.t1;case 35:case"end":return e.stop()}}),e,null,[[8,15],[22,31]])})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._vectorTileLayer.sourceNameToSource,r=new Array;for(var n in i){var a=i[n].getRefKey(e,t);r.push(a)}return Object(k.j)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])r.push(null);else{var a=this._getTilePayload(t[n].value,e[n],i);r.push(a)}return Object(k.j)(r).then((function(e){for(var i={},r=[],n=0;n<e.length;n++)if(e[n].value&&e[n].value&&e[n].value.protobuff&&e[n].value.protobuff.byteLength>0){var a=t[n].value.id;i[e[n].value.sourceName]={refKey:a,protobuff:e[n].value.protobuff},r.push(e[n].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}(),ee=i(318),te=i(238),ie=function(e,t){return e+1/(1<<2*t)},re=function(){function e(t,i){Object(u.a)(this,e),this._tiles=new Map,this._tileCache=new ee.a(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return Object(c.a)(e,[{key:"destroy",value:function(){var e,t=Object(a.a)(this._tiles);try{for(t.s();!(e=t.n()).done;){var i=Object(n.a)(e.value,2);i[0];i[1].dispose()}}catch(r){t.e(r)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,i=this.tileInfoView,r=i.getTileCoverage(e.state,0,"smallest"),s=r.spans,o=r.lodInfo,l=o.level,u=this._tiles,c=new Set,h=new Set,f=Object(a.a)(s);try{for(f.s();!(t=f.n()).done;)for(var y=t.value,v=y.row,p=y.colFrom,d=y.colTo,b=p;b<=d;b++){var _=Q.a.getId(l,v,o.normalizeCol(b),o.getWorldForColumn(b)),g=this._getOrAcquireTile(_);c.add(_),g.processed()?this._addToContainer(g):h.add(new Q.a(_))}}catch(z){f.e(z)}finally{f.f()}var m,O=Object(a.a)(u);try{for(O.s();!(m=O.n()).done;){var k=Object(n.a)(m.value,2),x=k[0];k[1].isCoverage=c.has(x)}}catch(z){O.e(z)}finally{O.f()}var w,j=Object(a.a)(h);try{for(j.s();!(w=j.n()).done;){var P=w.value;this._findPlaceholdersForMissingTiles(P,c)}}catch(z){j.e(z)}finally{j.f()}var S,M=!1,I=Object(a.a)(u);try{for(I.s();!(S=I.n()).done;){var T=Object(n.a)(S.value,2),C=T[0],L=T[1];L.neededForCoverage=c.has(C),L.neededForCoverage||L.isHoldingForFade&&i.intersects(r,L.key)&&c.add(C),L.isFading&&(M=!0)}}catch(z){I.e(z)}finally{I.f()}var D,A=Object(a.a)(this._tiles);try{for(A.s();!(D=A.n()).done;){var R=Object(n.a)(D.value,2),E=R[0];R[1];c.has(E)||this._releaseTile(E)}}catch(z){A.e(z)}finally{A.f()}return te.a.pool.release(r),!M}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,r=[],s=Object(a.a)(this._tiles);try{for(s.s();!(i=s.n()).done;){var o=Object(n.a)(i.value,2),l=(o[0],o[1]);this._addPlaceholderChild(r,l,e,t)}}catch(c){s.e(c)}finally{s.f()}var u=r.reduce(ie,0);Math.abs(1-u)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=this._tiles,r=e;;){if(!(r=ne(r))||t.has(r))return;var n=i.get(r);if(n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new Q.a(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],r=this._container;if(!r.contains(e)){var s,o=this._visibleTiles,l=Object(a.a)(o);try{for(l.s();!(s=l.n()).done;){var u=Object(n.a)(s.value,2),c=(u[0],u[1]);this._canConnectDirectly(e,c)&&i.push(c),Object(O.j)(t)&&this._canConnectDirectly(c,e)&&(t=c)}}catch(b){l.e(b)}finally{l.f()}if(Object(O.k)(t)){var h,f=Object(a.a)(i);try{for(f.s();!(h=f.n()).done;){var y=h.value;t.childrenTiles.delete(y),e.childrenTiles.add(y),y.parentTile=e}}catch(b){f.e(b)}finally{f.f()}t.childrenTiles.add(e),e.parentTile=t}else{var v,p=Object(a.a)(i);try{for(p.s();!(v=p.n()).done;){var d=v.value;e.childrenTiles.add(d),d.parentTile=e}}catch(b){p.e(b)}finally{p.f()}}o.set(e.id,e),r.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),Object(O.k)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,i=Object(a.a)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var r=t.value;Object(O.k)(e.parentTile)&&e.parentTile.childrenTiles.add(r)}}catch(o){i.e(o)}finally{i.f()}}var n,s=Object(a.a)(e.childrenTiles);try{for(s.s();!(n=s.n()).done;){n.value.parentTile=e.parentTile}}catch(o){s.e(o)}finally{s.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,n=r.level,a=r.row,s=r.col,o=r.world,l=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,i.level===n&&i.row===a&&i.col===s&&i.world===o)return!0;if(l.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(o)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/512)+1,r=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function ne(e){var t=e.split("/"),i=Object(n.a)(t,4),r=i[0],a=i[1],s=i[2],o=i[3],l=parseInt(r,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(o,10))}var ae=i(235),se=i(305),oe=function e(t){Object(u.a)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t},le=function e(){Object(u.a)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1};function ue(e,t,i,r,n,a){var s=i-n;if(s>=0)return(t>>s)+(r-(a<<s))*(e>>s);var o=-s;return t-(a-(r<<o))*(e>>o)<<o}var ce=function(){function e(t,i,r){Object(u.a)(this,e),this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(var n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(var a=0;a<this._columns;a++)this.cells[n][a]=[]}}return Object(c.a)(e,[{key:"getCell",value:function(e,t){var i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}},{key:"getCellSpan",value:function(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function he(e,t,i,r,s){var o=e.layerData.get(s);if(3===o.type){var l,u=Object(a.a)(r);try{for(u.s();!(l=u.n()).done;){var c=l.value,h=c.unique,f=void 0;if(c.selectedForRendering){var y=h.parts[0],v=y.startOpacity,p=y.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===p;var d=i?Math.floor(127*v)|p<<7:p?255:0;f=d<<24|d<<16|d<<8|d}else f=0;var b,_=Object(a.a)(c.iconVertexRanges);try{for(_.s();!(b=_.n()).done;)for(var g=Object(n.a)(b.value,2),m=g[0],O=g[1],k=m;k<m+O;k+=4)o.iconOpacity[k/4]=f}catch(D){_.e(D)}finally{_.f()}if(c.selectedForRendering){var x=h.parts[1],w=x.startOpacity,j=x.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===j;var P=i?Math.floor(127*w)|j<<7:j?255:0;f=P<<24|P<<16|P<<8|P}else f=0;var S,M=Object(a.a)(c.textVertexRanges);try{for(M.s();!(S=M.n()).done;)for(var I=Object(n.a)(S.value,2),T=I[0],C=I[1],L=T;L<T+C;L+=4)o.textOpacity[L/4]=f}catch(D){M.e(D)}finally{M.f()}}}catch(D){u.e(D)}finally{u.f()}o.lastOpacityUpdate=t,o.opacityChanged=!0}}var fe=function(){function e(t,i){Object(u.a)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var r=1,n=new Uint32Array(t);this.layerUIDs=[];for(var a=n[r++],s=0;s<a;s++)this.layerUIDs[s]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}return Object(c.a)(e,[{key:"isPreparedForRendering",get:function(){return Object(O.j)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){Object(O.j)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),ye=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r){var n;Object(u.a)(this,i),(n=t.call(this,e,r)).type=2,n.lineIndexStart=0,n.lineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.lineIndexStart=a[s++],n.lineIndexCount=a[s++];var o=a[s++];if(o>0){for(var l=new Map,c=0;c<o;c++){var h=a[s++],f=a[s++],y=a[s++];l.set(h,[f,y])}n.patternMap=l}return n.bufferDataOffset=s,n}return Object(c.a)(i,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){Object(O.k)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(O.k)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(O.k)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.lineVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.lineIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=this.layer.lineMaterial;this.lineVertexArrayObject=new R.a(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),i}(fe),ve=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r){var n;Object(u.a)(this,i),(n=t.call(this,e,r)).type=1,n.fillIndexStart=0,n.fillIndexCount=0,n.outlineIndexStart=0,n.outlineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.fillIndexStart=a[s++],n.fillIndexCount=a[s++],n.outlineIndexStart=a[s++],n.outlineIndexCount=a[s++];var o=a[s++];if(o>0){for(var l=new Map,c=0;c<o;c++){var h=a[s++],f=a[s++],y=a[s++];l.set(h,[f,y])}n.patternMap=l}return n.bufferDataOffset=s,n}return Object(c.a)(i,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){Object(O.k)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(O.k)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(O.k)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(O.k)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(O.k)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(O.k)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.fillVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.fillIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=r[i++];this.outlineVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,o)),i+=o;var l=r[i++];this.outlineIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,l)),i+=l;var u=this.layer,c=u.fillMaterial,h=u.outlineMaterial;this.fillVertexArrayObject=new R.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new R.a(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),i}(fe),pe=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r,n){var a;Object(u.a)(this,i),(a=t.call(this,e,r)).type=3,a.iconPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.symbolInstances=[],a.isIconSDF=!1,a.opacityChanged=!1,a.lastOpacityUpdate=0,a.symbols=[];var s=new Uint32Array(e),o=new Int32Array(e),l=new Float32Array(e),c=a.bufferDataOffset;a.isIconSDF=!!s[c++];for(var h=s[c++],f=0;f<h;f++){var y=s[c++],v=s[c++],p=s[c++];a.iconPerPageElementsMap.set(y,[v,p])}for(var d=s[c++],b=0;b<d;b++){var _=s[c++],g=s[c++],m=s[c++];a.glyphPerPageElementsMap.set(_,[g,m])}var O=s[c++],k=s[c++];return a.iconOpacity=new Int32Array(O),a.textOpacity=new Int32Array(k),c=function(e,t,i,r,n,a){for(var s=t[r++],o=0;o<s;o++){var l=new oe(a);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];for(var u=t[r++],c=0;c<u;c++){var h=t[r++],f=t[r++],y=t[r++],v=t[r++],p=!!t[r++],d=t[r++],b=i[r++],_=i[r++],g=t[r++],m=t[r++];l.colliders.push({xTile:h,yTile:f,dxPixels:y,dyPixels:v,hard:p,partIndex:d,width:g,height:m,minLod:b,maxLod:_})}for(var O=e[r++],k=0;k<O;k++)l.textVertexRanges.push([e[r++],e[r++]]);for(var x=e[r++],w=0;w<x;w++)l.iconVertexRanges.push([e[r++],e[r++]]);n.push(l)}return r}(s,o,l,c,a.symbols,n),a.bufferDataOffset=c,a}return Object(c.a)(i,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,i=Object(a.a)(this.iconPerPageElementsMap);try{for(i.s();!(e=i.n()).done;){var r=Object(n.a)(e.value,2);r[0];t+=r[1][1]}}catch(u){i.e(u)}finally{i.f()}var s,o=Object(a.a)(this.glyphPerPageElementsMap);try{for(o.s();!(s=o.n()).done;){var l=Object(n.a)(s.value,2);l[0];t+=l[1][1]}}catch(u){o.e(u)}finally{o.f()}return t/3}},{key:"doDestroy",value:function(){Object(O.k)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(O.k)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(O.k)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(O.k)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(O.k)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(O.k)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(O.k)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(O.k)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=Object(O.s)(this.iconOpacity),t=Object(O.s)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var i=Object(O.s)(this.textOpacity),r=Object(O.s)(this.textOpacityBuffer);i.length>0&&i.byteLength===r.size&&r.setSubData(i)}}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.iconVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.iconIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=r[i++];this.textVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,o)),i+=o;var l=r[i++];this.textIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,l)),i+=l,this.iconOpacityBuffer=D.a.createVertex(e,35044,Object(O.s)(this.iconOpacity).buffer),this.textOpacityBuffer=D.a.createVertex(e,35044,Object(O.s)(this.textOpacity).buffer);var u=this.layer,c=u.iconMaterial,h=u.textMaterial;this.iconVertexArrayObject=new R.a(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new R.a(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),i}(fe),de=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r){var n;Object(u.a)(this,i),(n=t.call(this,e,r)).type=4,n.circleIndexStart=0,n.circleIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;return n.circleIndexStart=a[s++],n.circleIndexCount=a[s++],n.bufferDataOffset=s,n}return Object(c.a)(i,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){Object(O.k)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(O.k)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(O.k)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.circleVertexBuffer=D.a.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.circleIndexBuffer=D.a.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var o=this.layer.circleMaterial;this.circleVertexArrayObject=new R.a(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),i}(fe),be=i(758),_e=i(584),ge=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r,n,a,s,o){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return Object(u.a)(this,i),(l=t.call(this,e,r,n,a,s,4096,4096))._memCache=c,l.type="vector-tile",l._referenced=0,l._hasSymbolBuckets=!1,l._memoryUsedByLayerData=0,l.layerData=new Map,l.layerCount=0,l.status="loading",l.allSymbolsFadingOut=!1,l.lastOpacityUpdate=0,l.symbols=new Map,l.isCoverage=!1,l.neededForCoverage=!1,l.decluttered=!1,l.invalidating=!1,l.parentTile=null,l.childrenTiles=new Set,l._processed=!1,l._referenced=1,l.styleRepository=o,l.id=e.id,l}return Object(c.a)(i,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<be.d}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<be.d)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,i=!1,r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.layerData.has(n)){var s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,3===s.type&&this.symbols.has(n)&&(this.symbols.delete(n),i=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}}}catch(o){r.e(o)}finally{r.f()}Object(O.k)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(me.delete(this),i._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var i,r=this._createRenderBuckets(e),s=Object(a.a)(r);try{for(s.s();!(i=s.n()).done;){var o=Object(n.a)(i.value,2),l=o[0],u=o[1];if(this.layerData.has(l)){var c=this.layerData.get(l);this._memoryUsedByLayerData-=u.memoryUsed,c.destroy(),this.layerData.delete(l),this.layerCount--}3===u.type&&(this.symbols.set(l,u.symbols),t=!0),this._memoryUsedByLayerData+=u.memoryUsed,this.layerData.set(l,u),this.layerCount++}}catch(v){s.e(v)}finally{s.f()}Object(O.k)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var h,f=Object(a.a)(this.layerData);try{for(f.s();!(h=f.n()).done;){var y=Object(n.a)(h.value,2);y[0];3===y[1].type&&(this._hasSymbolBuckets=!0)}}catch(v){f.e(v)}finally{f.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){Object(h.a)(Object(f.a)(i.prototype),"setTransform",this).call(this,e,t);var r=t/(e.resolution*e.pixelRatio),n=this.width/this.rangeX*r,a=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);var o=this.transforms.tileUnitsToPixels;Object(ae.b)(o),Object(ae.c)(o,o,s),Object(ae.k)(o,o,Math.PI*e.rotation/180),Object(ae.d)(o,o,[n,a,1])}},{key:"_createTransforms",value:function(){return{dvs:Object(se.b)(),tileMat3:Object(se.b)(),tileUnitsToPixels:Object(se.b)()}}},{key:"_createRenderBuckets",value:function(e){var t,i=new Map,r=new Map,n=Object(a.a)(e);try{for(n.s();!(t=n.n()).done;){var s,o=t.value,l=this._deserializeBucket(o,r),u=Object(a.a)(l.layerUIDs);try{for(u.s();!(s=u.n()).done;){var c=s.value;i.set(c,l)}}catch(h){u.e(h)}finally{u.f()}}}catch(h){n.e(h)}finally{n.f()}return i}},{key:"_deserializeBucket",value:function(e,t){var i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new ve(e,this.styleRepository);break;case 2:i=new ye(e,this.styleRepository);break;case 3:i=new pe(e,this.styleRepository,this);break;case 4:i=new de(e,this.styleRepository)}return t.set(e,i),i}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),i}(_e.a),me=new Map;var Oe=i(67);function ke(e,t,i,r,s,o){var l,u=r.iconRotationAlignment,c=r.textRotationAlignment,h=r.iconTranslate,f=r.iconTranslateAnchor,y=r.textTranslate,v=r.textTranslateAnchor,p=0,d=Object(a.a)(e.colliders);try{for(d.s();!(l=d.n()).done;){var b=l.value,_=0===b.partIndex?h:y,g=Object(n.a)(_,2),m=g[0],O=g[1],k=0===b.partIndex?f:v,x=b.minLod<=o&&o<=b.maxLod;p+=x?0:1,b.enabled=x,b.xScreen=b.xTile*s[0]+b.yTile*s[3]+s[6],b.yScreen=b.xTile*s[1]+b.yTile*s[4]+s[7],0===k?(b.xScreen+=i*m-t*O,b.yScreen+=t*m+i*O):(b.xScreen+=m,b.yScreen+=O),1===(0===b.partIndex?u:c)?(b.dxScreen=b.dxPixels,b.dyScreen=b.dyPixels):(b.dxScreen=i*(b.dxPixels+b.width/2)-t*(b.dyPixels+b.height/2)-b.width/2,b.dyScreen=t*(b.dxPixels+b.width/2)+i*(b.dyPixels+b.height/2)-b.height/2)}}catch(w){d.e(w)}finally{d.f()}e.colliders.length>0&&p===e.colliders.length&&(e.unique.show=!1)}var xe=function(){function e(t,i,r,n,s,o){Object(u.a)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new ce(i,r,be.a),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var l,c=Object(a.a)(t);try{for(c.s();!(l=c.n()).done;){var h,f=l.value,y=Object(a.a)(f.symbols);try{for(y.s();!(h=y.n()).done;){var v=h.value;this._allNeededMatrices.has(v.tile)||this._allNeededMatrices.set(v.tile,Object(se.a)(v.tile.transforms.tileUnitsToPixels))}}catch(p){y.e(p)}finally{y.f()}}}catch(p){c.e(p)}finally{c.f()}}return Object(c.a)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,o=r+e.height,l=t.getCellSpan(i,r,s,o),u=Object(n.a)(l,4),c=u[0],h=u[1],f=u[2],y=u[3],v=h;v<=y;v++)for(var p=c;p<=f;p++){var d,b=t.cells[v][p],_=Object(a.a)(b);try{for(_.s();!(d=_.n()).done;){var g=d.value,m=g.xScreen+g.dxScreen,O=g.yScreen+g.dyScreen,k=m+g.width,x=O+g.height;if(!(s<m||i>k||o<O||r>x))return!0}}catch(w){_.e(w)}finally{_.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],o=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var l=s.symbols[this._currentSymbolCursor];if(l.unique.show){ke(l,this._si,this._co,o,this._allNeededMatrices.get(l.tile),this._zoom);var u=l.unique;if(u.show){var c,h=o.iconAllowOverlap,f=o.iconIgnorePlacement,y=o.textAllowOverlap,v=o.textIgnorePlacement,p=Object(a.a)(l.colliders);try{for(p.s();!(c=p.n()).done;){var d=c.value;if(d.enabled){var b=u.parts[d.partIndex];b.show&&!(d.partIndex?y:h)&&i(d)&&(d.hard?u.show=!1:b.show=!1)}}}catch(D){p.e(D)}finally{p.f()}if(u.show){var _,g=Object(a.a)(l.colliders);try{for(g.s();!(_=g.n()).done;){var m=_.value;if(m.enabled&&(!(m.partIndex?v:f)&&u.parts[m.partIndex].show))for(var O=m.xScreen+m.dxScreen,k=m.yScreen+m.dyScreen,x=O+m.width,w=k+m.height,j=this._gridIndex.getCellSpan(O,k,x,w),P=Object(n.a)(j,4),S=P[0],M=P[1],I=P[2],T=P[3],C=M;C<=T;C++)for(var L=S;L<=I;L++)this._gridIndex.cells[C][L].push(m)}}catch(D){g.e(D)}finally{g.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),n=0!==r.getLayoutValue("symbol-placement",i),a=r.getLayoutValue("icon-rotation-alignment",i);2===a&&(a=n?0:1);var s=r.getLayoutValue("text-rotation-alignment",i);2===s&&(s=n?0:1);var o=r.getPaintValue("icon-translate",i),l=r.getPaintValue("icon-translate-anchor",i),u=r.getPaintValue("text-translate",i),c=r.getPaintValue("text-translate-anchor",i),h={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:a,textRotationAlignment:s,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:c,textTranslate:u};return this._styleProps.set(e,h),h}}]),e}();function we(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var je=function(){function e(t,i,r,n,a,s){Object(u.a)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=a,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return Object(c.a)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var n,s=i.uniqueSymbols[r],o=Object(a.a)(s.tileSymbols);try{for(o.s();!(n=o.n()).done;){n.value.selectedForRendering=!1}}catch(y){o.e(y)}finally{o.f()}}var l=[],u=0,c=0,h=this._isLayerVisible;var f=this._symbolLayerSorter;return{work:function(t){for(var i,r=performance.now();c<e.length;c++,u=0){var n=e[c],s=n.styleLayerUID;if(h(s)){l[c]=l[c]||{styleLayerUID:s,symbols:[]};for(var o=l[c];u<n.uniqueSymbols.length;u++){if(i=n.uniqueSymbols[u],u%100==99&&performance.now()-r>t)return!1;var f,v=null,p=!1,d=!1,b=Object(a.a)(i.tileSymbols);try{for(b.s();!(f=b.n()).done;){var _=f.value;if(!d||!p){var g=_.tile;(!v||g.isCoverage||g.neededForCoverage&&!p)&&(v=_,(g.neededForCoverage||g.isCoverage)&&(d=!0),g.isCoverage&&(p=!0))}}}catch(y){b.e(y)}finally{b.f()}if(v.selectedForRendering=!0,d){o.symbols.push(v),i.show=!0;var m,O=Object(a.a)(i.parts);try{for(O.s();!(m=O.n()).done;){m.value.show=!0}}catch(y){O.e(y)}finally{O.f()}}else i.show=!1}}else l[c]||(l[c]={styleLayerUID:s,symbols:[]})}var k,x=Object(a.a)(l);try{for(x.s();!(k=x.n()).done;){k.value.symbols.sort(we)}}catch(y){x.e(y)}finally{x.f()}return!0},get sortedSymbols(){return l.sort(f)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var s,o=t.symbols,l=Object(a.a)(o);try{for(l.s();!(s=l.n()).done;){var u=Object(n.a)(s.value,2);u[0];Pe(u[1],i)}}catch(f){l.e(f)}finally{l.f()}e(t,i);var c,h=Object(a.a)(t.childrenTiles);try{for(h.s();!(c=h.n()).done;){r(c.value,i)}}catch(f){h.e(f)}finally{h.f()}}return{work:function(e){for(var n=performance.now();i<t.length;i++){if(performance.now()-n>e)return!1;var a=t[i];Object(O.k)(a.parentTile)||r(a,performance.now())}return!0}}}}]),e}();function Pe(e,t){var i,r=Object(a.a)(e);try{for(r.s();!(i=r.n()).done;){var n,s=i.value.unique,o=Object(a.a)(s.parts);try{for(o.s();!(n=o.n()).done;){var l=n.value,u=l.targetOpacity>.5?1:-1;l.startOpacity+=u*((t-l.startTime)/be.d),l.startOpacity=Math.min(Math.max(l.startOpacity,0),1),l.startTime=t,l.targetOpacity=s.show&&l.show?1:0}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}}var Se=function(){function e(t,i,r){Object(u.a)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return Object(c.a)(e,[{key:"uniqueSymbols",get:function(){return Object(O.j)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var s,o=Object(a.a)(t);try{for(o.s();!(s=o.n()).done;){var l=s.value;i.symbols.has(l)&&(r.set(l,i.symbols.get(l)),i.symbols.delete(l))}}catch(P){o.e(P)}finally{o.f()}}else{var u,c=Object(a.a)(e.layerData);try{for(c.s();!(u=c.n()).done;){var h=Object(n.a)(u.value,2),f=h[0];h[1];i.symbols.has(f)&&(r.set(f,i.symbols.get(f)),i.symbols.delete(f))}}catch(P){c.e(P)}finally{c.f()}}this._removeSymbols(r);var y,v=e.symbols,p=new Map,d=Object(a.a)(v);try{for(d.s();!(y=d.n()).done;){var b=Object(n.a)(y.value,2),_=b[0],g=b[1],m=g.length;if(m>=32){var O=this.tileCoordRange;do{O/=2,m/=4}while(m>8&&O>64);var k=new ce(this.tileCoordRange,this.tileCoordRange,O);p.set(_,{flat:g,index:k}),i.symbols.set(_,{flat:g,index:k});var x,w=Object(a.a)(g);try{for(w.s();!(x=w.n()).done;){var j=x.value;k.getCell(j.xTile,j.yTile).push(j)}}catch(P){w.e(P)}finally{w.f()}}else p.set(_,{flat:g}),i.symbols.set(_,{flat:g})}}catch(P){d.e(P)}finally{d.f()}this._addSymbols(e.key,v)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=Object(a.a)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,s=Object(n.a)(t.value,2),o=s[0],l=s[1],u=new Map,c=Object(a.a)(e);try{for(c.s();!(r=c.n()).done;){var h=r.value;l.symbols.has(h)&&(u.set(h,l.symbols.get(h)),l.symbols.delete(h))}}catch(f){c.e(f)}finally{c.f()}this._removeSymbols(u),0===l.symbols.size&&this._tiles.delete(o)}}catch(f){i.e(f)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,s=Object(a.a)(e.symbols);try{for(s.s();!(i=s.n()).done;){var o=Object(n.a)(i.value,2),l=o[0];o[1];t.symbols.has(l)&&(r.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(u){s.e(u)}finally{s.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){var r,s=Object(n.a)(t.value,2),o=s[0],l=s[1].flat,u=Object(a.a)(l);try{for(u.s();!(r=u.n()).done;){for(var c=r.value,h=c.unique,f=h.tileSymbols,y=f.length-1,v=0;v<y;v++)if(f[v]===c){f[v]=f[y];break}if(f.length=y,0===y){var p=this._uniqueSymbolsReferences.get(o);p.delete(h),0===p.size&&this._uniqueSymbolsReferences.delete(o)}c.unique=null}}catch(d){u.e(d)}finally{u.f()}}}catch(d){i.e(d)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,s=Object(a.a)(r);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.parentTile||o.key.world!==e.world||o.key.level===e.level&&!o.key.equals(e)||this._matchSymbols(o,e,t)}}catch(_){s.e(_)}finally{s.f()}var l,u=Object(a.a)(t);try{for(u.s();!(l=u.n()).done;){var c,h=Object(n.a)(l.value,2),f=h[0],y=h[1],v=Object(a.a)(y);try{for(v.s();!(c=v.n()).done;){var p=c.value;if(Object(O.j)(p.unique)){var d=this._createUnique();p.unique=d,d.tileSymbols.push(p);var b=this._uniqueSymbolsReferences.get(f);b||(b=new Set,this._uniqueSymbolsReferences.set(f,b)),b.add(d)}}}catch(_){v.e(_)}finally{v.f()}}}catch(_){u.e(_)}finally{u.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){var o,l=Object(a.a)(e.childrenTiles);try{for(l.s();!(o=l.n()).done;){var u=o.value;this._matchSymbols(u,t,i)}}catch(q){l.e(q)}finally{l.f()}}else{var c,h=new Map,f=Object(a.a)(i);try{for(f.s();!(c=f.n()).done;){var y,v=Object(n.a)(c.value,2),p=v[0],d=v[1],b=[],_=Object(a.a)(d);try{for(_.s();!(y=_.n()).done;){var g=y.value,m=ue(this.tileCoordRange,g.xTile,t.level,t.col,e.key.level,e.key.col),k=ue(this.tileCoordRange,g.yTile,t.level,t.row,e.key.level,e.key.row);m>=0&&m<this.tileCoordRange&&k>=0&&k<this.tileCoordRange&&b.push({symbol:g,xTransformed:m,yTransformed:k})}}catch(q){_.e(q)}finally{_.f()}var x=[],w=e.key.level<t.level?1:1<<e.key.level-t.level,j=this._tiles.get(e.id).symbols.get(p);if(j){var P,S=j.flat,M=Object(a.a)(b);try{for(M.s();!(P=M.n()).done;){var I,T=P.value,C=!1,L=T.xTransformed,D=T.yTransformed;I=Object(O.k)(j.index)?j.index.getCell(L,D):S;var A,R=T.symbol,E=R.hash,z=Object(a.a)(I);try{for(z.s();!(A=z.n()).done;){var B=A.value;if(E===B.hash&&Math.abs(L-B.xTile)<=w&&Math.abs(D-B.yTile)<=w){var V=B.unique;R.unique=V,V.tileSymbols.push(R),C=!0;break}}}catch(q){z.e(q)}finally{z.f()}C||x.push(R)}}catch(q){M.e(q)}finally{M.f()}}x.length>0&&h.set(p,x)}}catch(q){f.e(q)}finally{f.f()}var U,F=Object(a.a)(e.childrenTiles);try{for(F.s();!(U=F.n()).done;){var H=U.value;this._matchSymbols(H,t,h)}}catch(q){F.e(q)}finally{F.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),s=0,o=Object(a.a)(i);try{for(o.s();!(t=o.n()).done;){var l=Object(n.a)(t.value,2),u=l[0],c=l[1],h=new Array(c.size);e=0;var f,y=Object(a.a)(c);try{for(y.s();!(f=y.n()).done;){var v=f.value;h[e++]=v}}catch(p){y.e(p)}finally{y.f()}r[s]={styleLayerUID:u,uniqueSymbols:h},s++}}catch(p){o.e(p)}finally{o.f()}return r}}]),e}(),Me=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e,r){var s;return Object(u.a)(this,i),(s=t.call(this)).styleRepository=e,s._tileToHandle=new Map,s._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},s._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},s._completed=!1,s._symbolRepository=new Se(4096,r,(function(){return new le})),s._symbolDeclutterer=new je(r,s._symbolRepository,(function(e,t,i){return new xe(e,t,i,s.styleRepository,s._zoom,s._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,i){var r,s=Object(a.a)(e.symbols);try{for(s.s();!(r=s.n()).done;){var o=Object(n.a)(r.value,2),l=o[0];he(e,t,i,o[1],l)}}catch(u){s.e(u)}finally{s.f()}}(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return s.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-s.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=s.styleRepository.getStyleLayerByUID(e);if(s._zoom<t.minzoom||s._zoom>t.maxzoom)return!1;var i=t.getLayoutProperty("visibility");return!i||1!==i.getValue()})),s}return Object(c.a)(i,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(be.b),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;Object(O.k)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*be.d)}},{key:"_notifyUnstable",value:function(){Object(O.k)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),i}(Oe.a),Ie=i(535),Te=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(){return Object(u.a)(this,i),t.apply(this,arguments)}return Object(c.a)(i,[{key:"_createTransforms",value:function(){return{dvs:Object(se.b)(),tileMat3:Object(se.b)()}}}]),i}(_e.a),Ce=i(591),Le=1e-6;function De(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||1!==i.getValue()&&(void 0===e.minzoom||e.minzoom<t+Le)&&(void 0===e.maxzoom||e.maxzoom>=t-Le))return!0}return!1}var Ae=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e))._backgroundTiles=[],r._pointToCallbacks=new Map,r}return Object(c.a)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),Object(O.k)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,i){var r=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,Object(O.j)(this._symbolFader)){var n=new Me(this._styleRepository,this.children);n.on("fade-start",(function(){r.emit("fade-start"),r.requestRender()})),n.on("fade-complete",(function(){r.emit("fade-complete"),r.requestRender()})),this._symbolFader=n}Object(O.s)(this._symbolFader).styleRepository=i}},{key:"deleteStyleLayers",value:function(e){Object(O.k)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[t,i],n=Object(k.g)(),e.abrupt("return",(this._pointToCallbacks.set(r,n),this.requestRender(),n.promise));case 2:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"enterTileInvalidation",value:function(){var e,t=Object(a.a)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.invalidating=!0}}catch(i){t.e(i)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return Object(I.a)(Object(I.a)({},Object(h.a)(Object(f.a)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==Ie.c.MAP&&e.drawPhase!==Ie.c.DEBUG||void 0===this._spriteMosaic||Object(h.a)(Object(f.a)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return Object(h.a)(Object(f.a)(i.prototype),"addChild",this).call(this,e),Object(O.k)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return Object(O.k)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),Object(h.a)(Object(f.a)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){if(e.drawPhase!==Ie.c.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){var t=e.context,r=t.getBoundFramebufferObject();e.drawPhase=Ie.c.HITTEST;var n=e.painter.effects.hittest;n.bind(e),this._doRender(e),n.draw(e,this._pointToCallbacks),t.bindFramebuffer(r)}}else Object(h.a)(Object(f.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];Object(O.k)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}Object(h.a)(Object(f.a)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){Object(O.k)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=this._styleRepository;if(r){var n=r.layers,s=!0;e.drawPhase===Ie.c.HITTEST&&(s=!1),r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),Object(h.a)(Object(f.a)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===Ie.c.MAP&&this._fade(e.displayLevel,e.state);var o=this.children.filter((function(e){return e.visible&&e.hasData()}));if(o&&0!==o.length){var l,u=Object(a.a)(o);try{for(u.s();!(l=u.n()).done;){l.value.triangleCount=0}}catch(p){u.e(p)}finally{u.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var c=n.length-1;c>=0;c--)this._renderStyleLayer(n[c],e,o);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(s),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var y=0;y<n.length;y++)this._renderStyleLayer(n[y],e,o);t.setDepthTestEnabled(!1),e.renderPass="symbol";for(var v=0;v<n.length;v++)this._renderStyleLayer(n[v],e,o);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}}},{key:"_fade",value:function(e,t){Object(O.k)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var r=t.painter,n=t.renderPass;if(void 0!==e){var s=e.getLayoutProperty("visibility");if(!s||1!==s.getValue()){var o;switch(e.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==n)return;o="vtlLine";break;case 4:if("symbol"!==n)return;o="vtlCircle";break;case 3:if("symbol"!==n)return;o="vtlSymbol"}if(i=3===e.type?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==o){var l=t.displayLevel;if(0===i.length||void 0!==e.minzoom&&e.minzoom>=l+Le||void 0!==e.maxzoom&&e.maxzoom<l-Le)return}var u=e.uid;t.styleLayerUID=u,t.styleLayer=e;var c,h=Object(a.a)(i);try{for(h.s();!(c=h.n()).done;){if(c.value.layerData.has(u)){r.renderObjects(t,i,o);break}}}catch(f){h.e(f)}finally{h.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var i,r=e.context,n=e.displayLevel,s=e.painter,o=e.state,l=this._styleRepository,u=!1,c=Object(a.a)(t);try{for(c.s();!(i=c.n()).done;){var h=i.value;if(De(l.getLayerById(h),n)){u=!0;break}}}catch(B){c.e(B)}finally{c.f()}if(u){var f=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),y=f.spans,v=f.lodInfo,p=v.level,d=Object(M.l)(),b=[];if(this._renderPasses){var _=this._renderPasses[0];Object(O.k)(this._clippingInfos)&&(_.brushes[0].prepareState(e,this._clippingInfos[0]),_.brushes[0].drawMany(e,this._clippingInfos))}var g,m,k=this._backgroundTiles,x=0,w=Object(a.a)(y);try{for(w.s();!(m=w.n()).done;)for(var j=m.value,P=j.row,S=j.colFrom,I=j.colTo,T=S;T<=I;T++){if(x<k.length)(g=k[x]).key.set(p,P,v.normalizeCol(T),v.getWorldForColumn(T)),this._tileInfoView.getTileBounds(d,g.key,!1),g.x=d[0],g.y=d[3];else{var C=new Q.a(p,P,v.normalizeCol(T),v.getWorldForColumn(T)),L=this._tileInfoView.getTileBounds(Object(M.l)(),C);g=new Te(C,L[0],L[3],512,512,4096,4096),k.push(g)}g.setTransform(o,this._tileInfoView.getTileResolution(g.key)),b.push(g),x++}}catch(B){w.e(B)}finally{w.f()}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(7680,7680,7681),r.setStencilFunction(514,0,255);var D=!0;e.drawPhase===Ie.c.HITTEST&&(D=!1),r.setStencilTestEnabled(D);var A,R=Object(a.a)(t);try{for(R.s();!(A=R.n()).done;){var E=A.value,z=l.getLayerById(E);De(z,n)&&(e.styleLayerUID=z.uid,e.styleLayer=z,s.renderObjects(e,b,"vtlBackground"))}}catch(B){R.e(B)}finally{R.f()}te.a.pool.release(f)}}}]),i}(Ce.a),Re=i(852),Ee=i(585),ze=i(14),Be=i(651),Ve=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this)).requestRender=r.requestRender.bind(Object(ze.a)(r)),r._layerView=e,r._canvas=document.createElement("canvas"),r._context=r._canvas.getContext("2d"),r._bitmap=new Be.a(null,"standard",!1),r.addChild(r._bitmap),r}return Object(c.a)(i,[{key:"doRender",value:function(e){var t=e.state,r=this._createCustomRenderParams(e),n=r.pixelRatio,a=this._canvas,s=this._bitmap;a.width=t.size[0]*n,a.height=t.size[1]*n,s.resolution=t.resolution,s.pixelRatio=n,s.x=t.viewpoint.targetGeometry.x-Math.abs(t.extent.xmax-t.extent.xmin)/2,s.y=t.viewpoint.targetGeometry.y+Math.abs(t.extent.ymax-t.extent.ymin)/2,this._layerView.render(r),s.source=a,s.rotation=t.rotation,Object(h.a)(Object(f.a)(i.prototype),"doRender",this).call(this,e)}},{key:"_createCustomRenderParams",value:function(e){var t=window.devicePixelRatio,i=Object(I.a)(Object(I.a)({},e.state),{},{pixelRatio:t});return Object(I.a)(Object(I.a)({},e),{},{pixelRatio:t,context:this._context,state:i})}}]),i}(i(699).a),Ue=i(213),Fe=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(){var e;return Object(u.a)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return Object(c.a)(i,[{key:"getTileParentId",value:function(e){var t=Q.a.pool.acquire(e),i=0===t.level?null:Q.a.getId(t.level-1,t.row>>1,t.col>>1,t.world);return Q.a.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,r){var n=Object(h.a)(Object(f.a)(i.prototype),"getTileCoverage",this).call(this,e,t,r);if(!n)return n;var a=1<<n.lodInfo.level;return n.spans=n.spans.filter((function(e){return e.row>=0&&e.row<a})),n}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var n=0;n<r.length-1;n++)if(e>(i=r[n+1]).scale)return(t=r[n]).level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=Ue.a.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),i}(i(409).a),He=i(477),qe=i(576),Ne=m.a.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),Ge=function(e){Object(y.a)(i,e);var t=Object(v.a)(i);function i(){var e;return Object(u.a)(this,i),(e=t.apply(this,arguments))._styleChanges=[],e._handles=new _.a,e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e}return Object(c.a)(i,[{key:"initialize",value:function(){var e=this,t=this.layer.tileInfo;if((t&&t.spatialReference).equals(this.view.spatialReference)){var i=this.layer.currentStyleInfo,r=i.style,n=i.spriteUrl,a=i.glyphsUrl;this._styleRepository=new Re.a(r,{spriteUrl:n,glyphsUrl:a}),this._tileInfoView=new Fe(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new Ae(this._tileInfoView),this._tileHandler=new $(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){e._collisionBoxesDisplay&&e._collisionBoxesDisplay.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),Object(x.a)(this.layer,"symbolCollisionBoxesVisible",(function(t){t?(e._collisionBoxesDisplay=new Ve({render:function(t){return e._renderCollisionBoxes(t.context)}}),e.container.addChild(e._collisionBoxesDisplay)):(e.container.removeChild(e._collisionBoxesDisplay),e._collisionBoxesDisplay=null)}))])}else this.addResolvingPromise(Promise.reject(new b.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}},{key:"destroy",value:function(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}},{key:"hitTest",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r,n,a,s,l,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(t,i);case 6:if((r=e.sent)&&0!==r.length){e.next=9;break}return e.abrupt("return",null);case 9:if(n=r[0]-1,a=this._styleRepository,s=a.getStyleLayerByUID(n)){e.next=12;break}return e.abrupt("return",null);case 12:return l=a.getStyleLayerIndex(s.id),u=new d.a({attributes:{layerId:l,layerName:s.id,layerUID:n}}),e.abrupt("return",(u.layer=this.layer,u.sourceLayer=this.layer,u));case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this;this._start(),this._handles.add([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:0,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var i=e._styleRepository,r=i.getLayerById(t.layer);if(!r)return;var n=3===r.type;i.setPaintProperties(t.layer,t.paint),n&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var n=Object(S.a)(r.layout,t.layout);if(!Object(O.j)(n)){if(Object(S.b)(n,"visibility")&&1===function(e){if(Object(O.j)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return i.setLayoutProperties(t.layer,t.layout),3===r.type&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:1,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);r&&(i.setStyleLayerVisibility(t.layer,t.visibility),3===r.type&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:2,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:3,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()}))])}},{key:"detach",value:function(){this._stop(),this._handles.removeAll()}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"canResume",value:function(){var e=Object(h.a)(Object(f.a)(i.prototype),"canResume",this).call(this),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,n=t.currentStyleInfo;if(n&&n.layerDefinition){var a=n.layerDefinition;a.minScale&&a.minScale<r&&(e=!1),a.maxScale&&a.maxScale>r&&(e=!1)}}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),e&&(i.setData(e.tileData),t.requestUpdate(),t.notifyChange("updating"))})).catch((function(e){t.notifyChange("updating"),Object(k.m)(e)||Ne.error(e)}))})),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new re({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new He.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new He.a({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,i);case 2:return r=e.sent,e.abrupt("return",(this.notifyChange("updating"),r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=Object(l.a)(o.a.mark((function e(t,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,i,r,n,s,l,u,c,h,f,y,v,p=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),Ne.error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,r=[],t.forEach((function(e){if(3===e.type){var t=e.data,n=i.getLayerById(t.layer);n&&r.push(n.uid)}})),n=[],t.forEach((function(e){var t=e.type,r=e.data;switch(t){case 0:i.setPaintProperties(r.layer,r.paint),s=r.layer;break;case 1:i.setLayoutProperties(r.layer,r.layout),s=r.layer;break;case 3:return void i.deleteStyleLayer(r.layer);case 2:i.setStyleLayer(r.layer,r.index),s=r.layer.id}var a=i.getLayerById(s);a&&n.push(a.uid)})),l=this._vectorTileContainer.children,r.length>0){this._vectorTileContainer.deleteStyleLayers(r),u=Object(a.a)(l);try{for(u.s();!(c=u.n()).done;)c.value.deleteLayerData(r)}catch(o){u.e(o)}finally{u.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(n.length>0)){e.next=22;break}h=[],f=Object(a.a)(l);try{for(v=function(){var e=y.value,t=p._fetchQueue.push(e.key).then((function(t){return p._parseQueue.push({key:e.key,data:t,styleLayerUIDs:n})})).then((function(t){return e.setData(t.tileData)}));h.push(t)},f.s();!(y=f.n()).done;)v()}catch(o){f.e(o)}finally{f.f()}return e.next=22,Promise.all(h);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,i,r,n,a,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo,i=t.style,r=t.spriteUrl,n=t.glyphsUrl,a=Object(g.a)(i),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new Re.a(a,{spriteUrl:r,glyphsUrl:n}),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=Object(k.d)(),s=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,a),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),Object(k.m)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!s.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:l=e.sent,this._vectorTileContainer.setStyleResources(l,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds(Object(M.l)(),e);return new ge(e,t[0],t[3],512,512,this._styleRepository)}},{key:"_renderCollisionBoxes",value:function(e){var t,i=Object(a.a)(this._vectorTileContainer.children);try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.symbols){var o,l=[],u=Object(a.a)(s.symbols);try{for(u.s();!(o=u.n()).done;){var c=Object(n.a)(o.value,2),h=(c[0],c[1]);l.push.apply(l,Object(r.a)(h))}}catch(f){u.e(f)}finally{u.f()}J(e,l)}}}catch(f){i.e(f)}finally{i.f()}}}]),i}(Object(Ee.a)(qe.a));Object(p.a)([Object(w.b)()],Ge.prototype,"_fetchQueue",void 0),Object(p.a)([Object(w.b)()],Ge.prototype,"_parseQueue",void 0),Object(p.a)([Object(w.b)()],Ge.prototype,"_isTileHandlerReady",void 0),Object(p.a)([Object(w.b)()],Ge.prototype,"suspended",void 0),Object(p.a)([Object(w.b)()],Ge.prototype,"fading",void 0),Object(p.a)([Object(w.b)()],Ge.prototype,"updating",void 0);var Ye=Ge=Object(p.a)([Object(P.a)("esri.views.2d.layers.VectorTileLayerView2D")],Ge)},536:function(e,t,i){"use strict";i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return b})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return _})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return d})),i.d(t,"j",(function(){return m}));var r=i(2),n=i(3),a=i(13),s=i(19),o=i(73),l=i(553);function u(e){var t,i=Object(s.a)(e);return(t=i)&&(Object(o.g)(t)?y(t.rings):Object(o.h)(t)?y(t.paths):Object(o.e)(t)&&f(t.points)),i}function c(e){if(e)for(var t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function h(e){if(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){c(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function f(e){if(e)for(var t=e.length,i=1;i<t;++i)e[i][0]+=e[i-1][0],e[i][1]+=e[i-1][1]}function y(e){if(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){f(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function v(e){e&&(Object(o.g)(e)?h(e.rings):Object(o.h)(e)?h(e.paths):Object(o.e)(e)&&c(e.points))}function p(e){if(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){d(t.value)}}catch(r){i.e(r)}finally{i.f()}}}function d(e){e&&e.reverse()}function b(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}function _(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function g(e){return e[4]}function m(e,t){e[4]=t}var O=function(){function e(t,i,n,a){Object(r.a)(this,e),this.acceptPolygon=i,this.acceptPolyline=n,this.geomUnitsPerPoint=a,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,t&&(Object(o.g)(t)?i&&(this.multiPath=t.rings,this.isClosed=!0):Object(o.h)(t)?n&&(this.multiPath=t.paths,this.isClosed=!1):Object(o.d)(t)&&i&&(this.multiPath=x(t).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new l.a}return Object(n.a)(e,[{key:"next",value:function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}]),e}(),k=function(){function e(t,i,n,a){Object(r.a)(this,e),this.inputGeometries=t,this.acceptPolygon=i,this.acceptPolyline=n,this.geomUnitsPerPoint=a,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}return Object(n.a)(e,[{key:"next",value:function(){for(;;){if(!this.multiPath){for(var e=this.inputGeometries.next();e;){if(Object(o.g)(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):Object(o.h)(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):Object(o.d)(e)&&this.acceptPolygon&&(this.multiPath=x(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}}}]),e}();function x(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}},553:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(2),n=i(3),a=function(){function e(){Object(r.a)(this,e),this.setIdentity()}return Object(n.a)(e,[{key:"getAngle",value:function(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}},{key:"setIdentity",value:function(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0}},{key:"setTranslate",value:function(e,t){this.tx=e,this.ty=t}},{key:"setTranslateZ",value:function(e){this.tz=e}},{key:"setRotateCS",value:function(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t}},{key:"setRotate",value:function(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0}},{key:"setRotateY",value:function(e){this.ry=e}},{key:"setScale",value:function(e){this.s=e}},{key:"setMeasure",value:function(e){this.m=e}}]),e}()},563:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(2),n=i(3),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.x=t,this.y=i,this.width=n,this.height=a}return Object(n.a)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},564:function(e,t,i){"use strict";i.d(t,"a",(function(){return L})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return D}));var r=i(26),n=i(10),a=i(13),s=i(2),o=i(3),l=i(40),u=i(11),c=i(65),h=i(553),f=i(5),y=i(6),v=i(139),p=i(303),d=i(73),b=i(589),_=i(568),g=i(563),m=Math.PI/180,O=u.a.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),k=function(){function e(t){Object(s.a)(this,e),this._t=t}return Object(o.a)(e,[{key:"clone",value:function(){return new e(this._t.slice())}},{key:"transform",value:function(e){var t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}},{key:"scale",value:function(e,t){var i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=t,i[4]*=t,i[5]*=t,this}},{key:"scaleRatio",value:function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}},{key:"translate",value:function(e,t){var i=this._t;return i[2]+=e,i[5]+=t,this}},{key:"rotate",value:function(t){return this.multiply(e.createRotate(t))}},{key:"multiply",value:function(e){var t=this._t,i=e._t,r=t[0]*i[0]+t[3]*i[1],n=t[1]*i[0]+t[4]*i[1],a=t[2]*i[0]+t[5]*i[1]+i[2],s=t[0]*i[3]+t[3]*i[4],o=t[1]*i[3]+t[4]*i[4],l=t[2]*i[3]+t[5]*i[4]+i[5];return t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=l,this}}],[{key:"createIdentity",value:function(){return new e([1,0,0,0,1,0])}},{key:"createScale",value:function(t,i){return new e([t,0,0,0,i,0])}},{key:"createTranslate",value:function(t,i){return new e([0,0,t,0,0,i])}},{key:"createRotate",value:function(t){var i=Math.cos(t),r=Math.sin(t);return new e([i,-r,0,r,i,0])}}]),e}(),x=function(){function e(t){Object(s.a)(this,e),this._transfos=[],this._sizeTransfos=[],this._transfos.push(t||k.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}return Object(o.a)(e,[{key:"transformPt",value:function(e){return this._transfos[this._transfos.length-1].transform(e)}},{key:"transformSize",value:function(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}},{key:"back",value:function(){return this._transfos[this._transfos.length-1]}},{key:"push",value:function(e,t){var i=t?e.scaleRatio():1;e.multiply(this.back()),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}},{key:"pop",value:function(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}},{key:"drawSymbol",value:function(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t)}}},{key:"drawMultiLayerSymbol",value:function(e,t){if(e){var i=e.symbolLayers;if(i){var r=e.effects;if(r){var n=this.executeEffects(r,t);if(n)for(var a=n.next();a;)this.drawSymbolLayers(i,a),a=n.next()}else this.drawSymbolLayers(i,t)}}}},{key:"executeEffects",value:function(e,t){var i,r=new b.a(t),n=Object(a.a)(e);try{for(n.s();!(i=n.n()).done;){var s=i.value,o=Object(_.a)(s);o&&(r=o.execute(r,s,1))}}catch(l){n.e(l)}finally{n.f()}return r}},{key:"drawSymbolLayers",value:function(e,t){for(var i=e.length;i--;){var r=e[i];if(r&&!1!==r.enable){var n=r.effects;if(n){var a=this.executeEffects(n,t);if(a)for(var s=a.next();s;)this.drawSymbolLayer(r,s),s=a.next()}else this.drawSymbolLayer(r,t)}}}},{key:"drawSymbolLayer",value:function(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}},{key:"drawHatchFill",value:function(e,t){var i=this._buildHatchPolyline(e,t,1);i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}},{key:"drawMarkerLayer",value:function(e,t){var i=e.markerPlacement;if(i){var r=Object(_.b)(i);if(r){var n="CIMMarkerPlacementInsidePolygon"===i.type;n&&this.pushClipPath(t);var a=r.execute(t,i,1);if(a)for(var s=a.next();s;)this.drawMarker(e,s),s=a.next();n&&this.popClipPath()}}else{var o=new h.a;o.tx=t.x,o.ty=t.y,this.drawMarker(e,o)}}},{key:"drawMarker",value:function(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}},{key:"drawPictureMarker",value:function(e,t){if(e){var i=e.size||10,r=k.createIdentity(),n=e.anchorPoint;if(n){var a=n.x,s=n.y;"Absolute"!==e.anchorPointUnits&&(a*=i,s*=i),r.translate(-a,-s)}e.rotation&&r.rotate(e.rotation*m),r.translate(e.offsetX||0,e.offsetY||0),r.translate(t.tx,t.ty),this.push(r,!1),this.drawImage(e.url,i,e.scaleX),this.pop()}}},{key:"drawVectorMarker",value:function(e,t){if(e){var i=e.markerGraphics;if(i){var r=e.size,n=e.frame,s=n?n.ymax-n.ymin:0,o=r&&s?r/s:1,l=k.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));var u=e.anchorPoint;if(u){var c=u.x,h=u.y;"Absolute"!==e.anchorPointUnits?n&&(c*=n.xmax-n.xmin,h*=n.ymax-n.ymin):(c/=o,h/=o),l.translate(-c,-h)}1!==o&&l.scale(o,o),e.rotation&&l.rotate(e.rotation*m),l.translate(e.offsetX||0,e.offsetY||0),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);var f,y=Object(a.a)(i);try{for(y.s();!(f=y.n()).done;){var v=f.value;v&&v.symbol&&v.geometry||O.error("Invalid marker graphic",v),this.drawSymbol(v.symbol,v.geometry)}}catch(p){y.e(p)}finally{y.f()}this.pop()}}}},{key:"_buildHatchPolyline",value:function(e,t,i){var r=(void 0!==e.separation?e.separation:4)*i,n=void 0!==e.rotation?e.rotation:0;if(0===r)return null;r<0&&(r=-r);for(var a=0,s=.5*r;a>s;)a-=r;for(;a<-s;)a+=r;var o=Object(v.l)();Object(p.a)(o,t),o[0]-=s,o[1]-=s,o[2]+=s,o[3]+=s;for(var l=[[o[0],o[1]],[o[0],o[3]],[o[2],o[3]],[o[2],o[1]]];n>180;)n-=180;for(;n<0;)n+=180;var u,c,h,f,y=Math.cos(n*m),d=Math.sin(n*m),b=-r*d,_=r*y;a=(void 0!==e.offsetX?e.offsetX*i:0)*d-(void 0!==e.offsetY?e.offsetY*i:0)*y,u=h=Number.MAX_VALUE,c=f=-Number.MAX_VALUE;for(var g=0,O=l;g<O.length;g++){var k=O[g],x=k[0],w=k[1],j=y*x+d*w,P=-d*x+y*w;u=Math.min(u,j),h=Math.min(h,P),c=Math.max(c,j),f=Math.max(f,P)}for(var S=y*u-d*(h=Math.floor(h/r)*r)-b*a/r,M=d*u+y*h-_*a/r,I=y*c-d*h-b*a/r,T=d*c+y*h-_*a/r,C=1+Math.round((f-h)/r),L=[],D=0;D<C;D++)S+=b,M+=_,I+=b,T+=_,L.push([[S,M],[I,T]]);return{paths:L}}}]),e}(),w=function(e){Object(f.a)(i,e);var t=Object(y.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).reset(),e}return Object(o.a)(i,[{key:"reset",value:function(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}},{key:"envelope",value:function(){return new g.a(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}},{key:"drawSolidFill",value:function(e){if(e&&!(this._clipCount>0))if(Object(d.g)(e))this._processPath(e.rings,0);else if(Object(d.h)(e))this._processPath(e.paths,0);else if(Object(d.d)(e)){var t=P(e);t&&this._processPath(t.rings,0)}}},{key:"drawSolidStroke",value:function(e,t,i){if(e&&!(this._clipCount>0)){var r=.5*this.transformSize(i);if(Object(d.g)(e))this._processPath(e.rings,r);else if(Object(d.h)(e))this._processPath(e.paths,r);else if(Object(d.d)(e)){var n=P(e);n&&this._processPath(n.rings,r)}}}},{key:"pushClipPath",value:function(e){this.drawSolidFill(e),++this._clipCount}},{key:"popClipPath",value:function(){--this._clipCount}},{key:"drawImage",value:function(e,t,i){var r=t/2;this._merge(this.transformPt([0,0]),r)}},{key:"_processPath",value:function(e,t){if(e){var i,r=Object(a.a)(e);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=n?n.length:0;if(s>1){this._merge(this.transformPt(n[0]),t);for(var o=1;o<s;++o)this._merge(this.transformPt(n[o]),t)}}}catch(l){r.e(l)}finally{r.f()}}}},{key:"_merge",value:function(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}]),i}(x),j=function(e){Object(f.a)(i,e);var t=Object(y.a)(i);function i(e,r){var n;return Object(s.a)(this,i),(n=t.call(this,r))._ctx=e,n}return Object(o.a)(i,[{key:"drawSolidFill",value:function(e,t){if(e){if(Object(d.g)(e))this._buildPath(e.rings,!0);else if(Object(d.h)(e))this._buildPath(e.paths,!0);else{if(!Object(d.d)(e))return;this._buildPath(P(e).rings,!0)}var i=this._ctx;i.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",i.fill("evenodd")}}},{key:"drawSolidStroke",value:function(e,t,i,r,n,a){if(e&&t&&0!==i){if(Object(d.g)(e))this._buildPath(e.rings,!0);else if(Object(d.h)(e))this._buildPath(e.paths,!1);else{if(!Object(d.d)(e))return;this._buildPath(P(e).rings,!0)}var s=this._ctx;s.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",s.lineWidth=this.transformSize(i)+.5,this._setCapStyle(r),this._setJoinStyle(n),s.miterLimit=a,s.stroke()}}},{key:"pushClipPath",value:function(e){if(this._ctx.save(),Object(d.g)(e))this._buildPath(e.rings,!0);else if(Object(d.h)(e))this._buildPath(e.paths,!0);else{if(!Object(d.d)(e))return;this._buildPath(P(e).rings,!0)}this._ctx.clip("evenodd")}},{key:"popClipPath",value:function(){this._ctx.restore()}},{key:"drawImage",value:function(e,t,i){}},{key:"_buildPath",value:function(e,t){var i=this._ctx;if(i.beginPath(),e){var r,n=Object(a.a)(e);try{for(n.s();!(r=n.n()).done;){var s=r.value,o=s?s.length:0;if(o>1){var l=this.transformPt(s[0]);i.moveTo(l[0],l[1]);for(var u=1;u<o;++u)l=this.transformPt(s[u]),i.lineTo(l[0],l[1]);t&&i.closePath()}}}catch(c){n.e(c)}finally{n.f()}}}},{key:"_setCapStyle",value:function(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}},{key:"_setJoinStyle",value:function(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}}]),i}(x),P=function(e){return e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null},S=i(590),M=Math.PI,I=M/2,T=u.a.getLogger("esri.symbols.cim.CIMSymbolHelper");function C(e,t){switch(t.type){case"CIMSymbolReference":e.drawSymbol(t.symbol,{type:"point",x:0,y:0});break;case"CIMPointSymbol":e.drawSymbol(t,{type:"point",x:0,y:0});break;case"CIMTextSymbol":break;case"CIMVectorMarker":var i=new h.a;e.drawMarker(t,i)}return e.envelope()}var L=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"getEnvelope",value:function(e){var t=new w;if(Array.isArray(e)){var i,r,n=Object(a.a)(e);try{for(n.s();!(r=n.n()).done;){var s=r.value;i?i.union(C(t,s)):i=C(t,s)}}catch(o){n.e(o)}finally{n.f()}return i}return C(t,e)}},{key:"getTextureAnchor",value:function(e){var t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];var i=96/72,r=(t.x+.5*t.width)*i,n=-(t.y+.5*t.height)*i,a=t.width*i+2,s=t.height*i+2;return[r/a,n/s,s]}},{key:"rasterize",value:function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=i||this.getEnvelope(t);if(!n||n.width<=0||n.height<=0)return[null,0,0,0,0];var a=96/72,s=(n.x+.5*n.width)*a,o=(n.y+.5*n.height)*a;e.width=n.width*a,e.height=n.height*a,i||(e.width+=2,e.height+=2);var l=e.getContext("2d"),u=k.createScale(a,-a);u.translate(.5*e.width-s,.5*e.height+o);var c=new j(l,u);switch(t.type){case"CIMPointSymbol":var f={type:"point",x:0,y:0};c.drawSymbol(t,f);break;case"CIMVectorMarker":var y=new h.a;c.drawMarker(t,y)}var v=l.getImageData(0,0,e.width,e.height),p=new Uint8Array(v.data);if(r)for(var d,b=0;b<p.length;b+=4)d=p[b+3]/255,p[b]=p[b]*d,p[b+1]=p[b+1]*d,p[b+2]=p[b+2]*d;return[p,e.width,e.height,-s/e.width,-o/e.height]}},{key:"fromSimpleMarker",value:function(e){var t,i,r,n=50,a=e.style;if("circle"===a||"esriSMSCircle"===a){var s=Math.acos(.995),o=Math.ceil(M/s/4);0===o&&(o=1),s=I/o,o*=4;var l=[];l.push([n,0]);for(var u=1;u<o;u++)l.push([n*Math.cos(u*s),-n*Math.sin(u*s)]);l.push([n,0]),t={rings:[l]},i={xmin:-n,ymin:-n,xmax:n,ymax:n}}else if("cross"===a||"esriSMSCross"===a){t={rings:[[[0,n],[0,0],[n,0],[n,-0],[0,-0],[0,-n],[-0,-n],[-0,-0],[-n,-0],[-n,0],[-0,0],[-0,n],[0,n]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n}}else if("diamond"===a||"esriSMSDiamond"===a)t={rings:[[[-n,0],[0,n],[n,0],[0,-n],[-n,0]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("square"===a||"esriSMSSquare"===a)t={rings:[[[-n,-n],[-n,n],[n,n],[n,-n],[-n,-n]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if("x"===a||"esriSMSX"===a){t={rings:[[[0,0],[50,n],[n,50],[0,0],[n,-50],[50,-n],[0,-0],[-50,-n],[-n,-50],[-0,0],[-n,50],[-50,n],[0,0]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n}}else if("triangle"===a||"esriSMSTriangle"===a){var c=57.735026918962575,h=-c,f=2/3*100,y=f-100;t={rings:[[[h,y],[0,f],[c,y],[h,y]]]},i={xmin:h,ymin:y,xmax:c,ymax:f}}else"arrow"!==a&&"esriSMSArrow"!==a||(t={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n});if(t&&i){var v=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&v.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});var p={type:"CIMPolygonSymbol",symbolLayers:v};r={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t,symbol:p}]}]}}return r}},{key:"fromCIMHatchFill",value:function(e){for(var t=void 0!==e.separation?e.separation:4,i=t/2,r=this._getLineSymbolPeriod(e.lineSymbol)||4;r<4;)r*=2;var n=r/2;return{type:"CIMVectorMarker",frame:{xmin:-n,xmax:n,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-n,0],[n,0]]]},symbol:e.lineSymbol}],size:t}}},{key:"_getLineSymbolPeriod",value:function(e){if(e){var t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers){var i,r=Object(a.a)(e.symbolLayers);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=this._getEffectsRepeat(n.effects);if(s)return s;if(n){var o=this._getPlacementRepeat(n.markerPlacement);if(o)return o}}}catch(l){r.e(l)}finally{r.f()}}}return 0}},{key:"_getEffectsRepeat",value:function(e){if(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r)switch(r.type){case"CIMGeometricEffectDashes":var n=r.dashTemplate;if(n&&n.length){var s,o=0,l=Object(a.a)(n);try{for(l.s();!(s=l.n()).done;){o+=s.value}}catch(u){l.e(u)}finally{l.f()}return 1&n.length&&(o*=2),o}break;case"CIMGeometricEffectWave":return r.period;default:T.error("unsupported geometric effect type ".concat(r.type))}}}catch(u){i.e(u)}finally{i.f()}}return 0}},{key:"_getPlacementRepeat",value:function(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":var t=e.placementTemplate;if(t&&t.length){var i,r=0,n=Object(a.a)(t);try{for(n.s();!(i=n.n()).done;){r+=i.value}}catch(s){n.e(s)}finally{n.f()}return 1&t.length&&(r*=2),r}}return 0}},{key:"fromCIMInsidePolygon",value:function(e){var t,i,r,a,s=e.markerPlacement,o=Object(n.a)({type:e.type},e);return o.markerPlacement=null,o.anchorPoint=null,!0===s.shiftOddRows?(i=s.stepX/2,r=s.stepY,a=2*s.stepY,t=[{x:-i,y:0},{x:i,y:0},{x:0,y:r},{x:0,y:-r}].map((function(e){return{type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[o]}}}))):(i=s.stepX/2,r=s.stepY/2,a=s.stepY,t=[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[o]}}]),{type:"CIMVectorMarker",frame:{xmin:-i,xmax:i,ymin:-r,ymax:r},markerGraphics:t,size:a}}},{key:"getFillColor",value:function(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers){var i,r=Object(a.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=e.getFillColor(n);if(null!=s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getFillColor(t.symbol);case"CIMSolidFill":return t.color}}},{key:"getStrokeColor",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var i,r=Object(a.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=e.getStrokeColor(n);if(void 0!==s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getStrokeColor(t.symbol);case"CIMSolidStroke":return t.color}}},{key:"getStrokeWidth",value:function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers){var i,r=Object(a.a)(t.symbolLayers);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=e.getStrokeWidth(n);if(void 0!==s)return s}}catch(o){r.e(o)}finally{r.f()}}break;case"CIMTextSymbol":return e.getStrokeWidth(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}},{key:"getSize",value:function(t){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var i=0;if(t.symbolLayers){var r,n=Object(a.a)(t.symbolLayers);try{for(n.s();!(r=n.n()).done;){var s=r.value,o=e.getSize(s);o>i&&(i=o)}}catch(l){n.e(l)}finally{n.f()}}return i;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return t.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return t.size}}},{key:"getMarkerScaleRatio",value:function(e){if(e&&"CIMVectorMarker"===e.type&&!1!==e.scaleSymbolsProportionally&&e.frame){var t=e.frame.ymax-e.frame.ymin;return e.size/t}return 1}}]),e}(),D=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"rasterizeSimpleFill",value:function(e,t,i){"solid"!==t&&"none"!==t&&"esriSFSSolid"!==t&&"esriSFSNull"!==t||console.error("Unexpected: style does not require rasterization");var r=Object(c.m)(Math.ceil(i)),n=this._isHorizontalOrVertical(t)?8*r:16*r,a=2*r;e.width=n,e.height=n;var s=e.getContext("2d");s.strokeStyle="#FFFFFF",s.lineWidth=r,s.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(s.moveTo(n/2,-a),s.lineTo(n/2,n+a)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(s.moveTo(-a,n/2),s.lineTo(n+a,n/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(s.moveTo(-a,-a),s.lineTo(n+a,n+a),s.moveTo(n-a,-a),s.lineTo(n+a,a),s.moveTo(-a,n-a),s.lineTo(a,n+a)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(s.moveTo(n+a,-a),s.lineTo(-a,n+a),s.moveTo(a,-a),s.lineTo(-a,a),s.moveTo(n+a,n-a),s.lineTo(n-a,n+a)),s.stroke();for(var o,l=s.getImageData(0,0,e.width,e.height),u=new Uint8Array(l.data),h=0;h<u.length;h+=4)o=u[h+3]/255,u[h]=u[h]*o,u[h+1]=u[h+1]*o,u[h+2]=u[h+2]*o;return[u,e.width,e.height]}},{key:"rasterizeSimpleLine",value:function(e,t){var i;switch(t){case"butt":i="Butt";break;case"square":i="Square";break;default:i="Round"}var r,n="Butt"===i;switch(e){case"dash":case"esriSLSDash":r=n?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":r=n?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":r=n?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":r=n?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":r=n?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":r=n?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":r=n?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":r=n?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":r=n?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":r=n?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":T.error("Unexpected: style does not require rasterization"),r=[0,0];break;default:T.error("Tried to rasterize SLS, but found an unexpected style: ".concat(e,"!")),r=[0,0]}return this.rasterizeDash(r,i)}},{key:"rasterizeDash",value:function(e,t){var i="Butt"===t,n="Square"===t,s=!i&&!n;e.length%2==1&&(e=[].concat(Object(r.a)(e),Object(r.a)(e)));var o,l=15.5,u=0,c=Object(a.a)(e);try{for(c.s();!(o=c.n()).done;){u+=o.value}}catch(I){c.e(I)}finally{c.f()}var h,f=Math.round(u*l),y=new Float32Array(31*f),v=7.75,p=0,d=0,b=.5,_=!0,g=Object(a.a)(e);try{for(g.s();!(h=g.n()).done;){var m=h.value;for(p=d,d+=m*l;b<=d;){for(var O=.5;O<31;){var k=(O-.5)*f+b-.5,x=s?(O-l)*(O-l):Math.abs(O-l);y[k]=_?i?Math.max(Math.max(p+v-b,x),Math.max(b-d+v,x)):x:s?Math.min((b-p)*(b-p)+x,(b-d)*(b-d)+x):n?Math.min(Math.max(b-p,x),Math.max(d-b,x)):Math.min(Math.max(b-p+v,x),Math.max(d+v-b,x)),O++}b++}_=!_}}catch(I){g.e(I)}finally{g.f()}for(var w=y.length,j=new Uint8Array(4*w),P=0;P<w;++P){var M=(s?Math.sqrt(y[P]):y[P])/l;Object(S.a)(M,j,4*P)}return[j,f,31]}},{key:"_isHorizontalOrVertical",value:function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}}]),e}(),A=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"findApplicableOverrides",value:function(t,i,r){if(i){if(t.primitiveName){var n,s=!1,o=Object(a.a)(r);try{for(o.s();!(n=o.n()).done;){if(n.value.primitiveName===t.primitiveName){s=!0;break}}}catch(x){o.e(x)}finally{o.f()}if(!s){var l,u=Object(a.a)(i);try{for(u.s();!(l=u.n()).done;){var c=l.value;c.primitiveName===t.primitiveName&&r.push(c)}}catch(x){u.e(x)}finally{u.f()}}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var h,f=Object(a.a)(t.effects);try{for(f.s();!(h=f.n()).done;){var y=h.value;e.findApplicableOverrides(y,i,r)}}catch(x){f.e(x)}finally{f.f()}}if(t.symbolLayers){var v,p=Object(a.a)(t.symbolLayers);try{for(p.s();!(v=p.n()).done;){var d=v.value;e.findApplicableOverrides(d,i,r)}}catch(x){p.e(x)}finally{p.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(t.effects){var b,_=Object(a.a)(t.effects);try{for(_.s();!(b=_.n()).done;){var g=b.value;e.findApplicableOverrides(g,i,r)}}catch(x){_.e(x)}finally{_.f()}}if(t.markerPlacement&&e.findApplicableOverrides(t.markerPlacement,i,r),"CIMVectorMarker"===t.type){if(t.markerGraphics){var m,O=Object(a.a)(t.markerGraphics);try{for(O.s();!(m=O.n()).done;){var k=m.value;e.findApplicableOverrides(k,i,r),e.findApplicableOverrides(k.symbol,i,r)}}catch(x){O.e(x)}finally{O.f()}}}else"CIMCharacterMarker"===t.type?e.findApplicableOverrides(t.symbol,i,r):"CIMHatchFill"===t.type&&e.findApplicableOverrides(t.lineSymbol,i,r)}}}},{key:"applyOverrides",value:function(t,i,r,n){if(i){var s=function(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e};if(t.primitiveName){var o,l=Object(a.a)(i);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(u.primitiveName===t.primitiveName){var c=s(u.propertyName);if(n&&n.push({cim:t,nocapPropertyName:c,value:t[c]}),u.expression&&(u.value=e.toValue(u.propertyName,u.expression)),r){var h,f=!1,y=Object(a.a)(r);try{for(y.s();!(h=y.n()).done;){h.value.primitiveName===t.primitiveName&&(f=!0)}}catch(P){y.e(P)}finally{y.f()}f||r.push(u)}t[c]=u.value}}}catch(P){l.e(P)}finally{l.f()}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects){var v,p=Object(a.a)(t.effects);try{for(p.s();!(v=p.n()).done;){var d=v.value;e.applyOverrides(d,i,r,n)}}catch(P){p.e(P)}finally{p.f()}}if(t.symbolLayers){var b,_=Object(a.a)(t.symbolLayers);try{for(_.s();!(b=_.n()).done;){var g=b.value;e.applyOverrides(g,i,r,n)}}catch(P){_.e(P)}finally{_.f()}}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(t.effects){var m,O=Object(a.a)(t.effects);try{for(O.s();!(m=O.n()).done;){var k=m.value;e.applyOverrides(k,i,r,n)}}catch(P){O.e(P)}finally{O.f()}}if("CIMVectorMarker"===t.type&&t.markerGraphics){var x,w=Object(a.a)(t.markerGraphics);try{for(w.s();!(x=w.n()).done;){var j=x.value;e.applyOverrides(j,i,r,n),e.applyOverrides(j.symbol,i,r,n)}}catch(P){w.e(P)}finally{w.f()}}}}}},{key:"restoreOverrides",value:function(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.cim[r.nocapPropertyName]=r.value}}catch(n){i.e(n)}finally{i.f()}}},{key:"buildOverrideKey",value:function(e){var t,i="",r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;void 0!==n.value&&(i+="".concat(n.primitiveName).concat(n.propertyName).concat(JSON.stringify(n.value)))}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"toValue",value:function(e,t){if("DashTemplate"===e)return t.split(" ").map((function(e){return Number(e)}));if("Color"===e){var i=new l.a(t).toRgba();return i[3]*=255,i}return t}}]),e}()},568:function(e,t,i){"use strict";i.d(t,"a",(function(){return fe})),i.d(t,"b",(function(){return ye}));var r=i(13),n=i(2),a=i(3),s=i(19),o=i(73),l=i(536),u=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new c(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();u.instance=null;var c=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._angleTolerance=void 0!==i.angleTolerance?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.g)(e)){this._isClosed=!0;var t=Object(s.a)(e);return this._processMultipath(t.rings),t}if(Object(o.h)(e)){this._isClosed=!1;var i=Object(s.a)(e);return this._processMultipath(i.paths),i}if(Object(o.d)(e)){if(this._maxCosAngle)return e;this._isClosed=!0;var r=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(r),{rings:[r]}}e=this._inputGeometries.next()}return null}},{key:"_processMultipath",value:function(e){if(e){var t,i=Object(r.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;this._processPath(n)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_processPath",value:function(e){if(e){var t,i,r,n,a,s,o=e.length,u=e[0];this._isClosed&&++o;for(var c=1;c<o;++c){var h,f=(h=this._isClosed&&c===o-1?e[0]:e[c])[0]-u[0],y=h[1]-u[1],v=Math.sqrt(f*f+y*y);c>1&&v>0&&r>0&&(t*f+i*y)/v/r<=this._maxCosAngle&&Object(l.j)(u,1),1===c&&(n=f,a=y,s=v),v>0&&(u=h,t=f,i=y,r=v)}this._isClosed&&r>0&&s>0&&(t*n+i*a)/s/r<=this._maxCosAngle&&Object(l.j)(e[0],1)}}}]),e}(),h=i(5),f=i(6),y=.03,v=function(){function e(){Object(n.a)(this,e),this._path=[]}return Object(a.a)(e,[{key:"path",value:function(){return this._path}},{key:"addPath",value:function(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()}},{key:"startPath",value:function(e){this._path.push(e)}},{key:"lineTo",value:function(e){this._path.push(e)}},{key:"close",value:function(){var e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))}}],[{key:"mergePath",value:function(e,t){t&&Array.prototype.push.apply(e,t)}}]),e}(),p=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}},{key:"calculateLength",value:function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}},{key:"calculateSegLength",value:function(e,t){return this.calculateLength(e[t],e[t+1])}},{key:"calculatePathLength",value:function(e){for(var t=0,i=e?e.length:0,r=0;r<i-1;++r)t+=this.calculateSegLength(e,r);return t}},{key:"calculatePathArea",value:function(e){for(var t=0,i=e?e.length:0,r=0;r<i-1;++r)t+=(e[r+1][0]-e[r][0])*(e[r+1][1]+e[r][1]);return t/2}},{key:"getCoord2D",value:function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}},{key:"getSegCoord2D",value:function(e,t,i){return this.getCoord2D(e[t],e[t+1],i)}},{key:"getAngle",value:function(e,t,i){var r=t[0]-e[0],n=t[1]-e[1];return Math.atan2(n,r)}},{key:"getSegAngle",value:function(e,t,i){return this.getAngle(e[t],e[t+1],i)}},{key:"getAngleCS",value:function(e,t,i){var r=t[0]-e[0],n=t[1]-e[1],a=Math.sqrt(r*r+n*n);return a>0?[r/a,n/a]:[1,0]}},{key:"getSegAngleCS",value:function(e,t,i){return this.getAngleCS(e[t],e[t+1],i)}},{key:"cut",value:function(e,t,i,r){return[i<=0?e[t]:this.getSegCoord2D(e,t,i),r>=1?e[t+1]:this.getSegCoord2D(e,t,r)]}},{key:"addSegment",value:function(e,t,i){i&&e.push(t[0]),e.push(t[1])}},{key:"getSubCurve",value:function(e,t,i){var r=[];return this.appendSubCurve(r,e,t,i)?r:null}},{key:"appendSubCurve",value:function(e,t,i,r){for(var n=t?t.length-1:0,a=0,s=!0,o=0;o<n;){var l=this.calculateSegLength(t,o);if(0!==l){if(s){if(a+l>i){var u=(i-a)/l,c=1,h=!1;a+l>=r&&(c=(r-a)/l,h=!0);var f=this.cut(t,o,u,c);if(f&&this.addSegment(e,f,s),h)break;s=!1}}else{if(a+l>r){var y=this.cut(t,o,0,(r-a)/l);y&&this.addSegment(e,y,s);break}this.addSegment(e,[t[o],t[o+1]],s)}a+=l,++o}else++o}return!0}},{key:"getCIMPointAlong",value:function(e,t){for(var i=e?e.length-1:0,r=0,n=-1;n<i;){++n;var a=this.calculateSegLength(e,n);if(0!==a){if(r+a>t){var s=(t-r)/a;return this.getCoord2D(e[n],e[n+1],s)}r+=a}}return null}},{key:"isEmpty",value:function(e,t){if(!e||e.length<=1)return!0;for(var i=e?e.length-1:0,r=-1;r<i;){if(e[++r+1][0]!==e[r][0]||e[r+1][1]!==e[r][1])return!1;if(t&&e[r+1][2]!==e[r][2])return!1}return!0}},{key:"offset",value:function(e,t,i,r,n){if(!e||e.length<2)return null;var a=e.length,s=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(s){if(e.length<3)return null;--a}for(var o=[],l=s?e[a-1]:null,u=e[0],c=0;c<a;c++){var h=c===a-1?s?e[0]:null:e[c+1];if(l)if(h){var f=[h[0]-u[0],h[1]-u[1]];this.normalize(f);var y=[u[0]-l[0],u[1]-l[1]];this.normalize(y);var v=y[0]*f[1]-y[1]*f[0],p=y[0]*f[0]+y[1]*f[1];if(v>=0==t<=0){var d=[f[0]-y[0],f[1]-y[1]];this.normalize(d);var b=Math.sqrt((1+p)/2);if(b>1/r){var _=-Math.abs(t)/b;o.push([u[0]-d[0]*_,u[1]-d[1]*_])}}else switch(i){case"Mitered":var g=Math.sqrt((1+p)/2);if(g>0&&1/g<r){var m=[f[0]-y[0],f[1]-y[1]];this.normalize(m);var O=Math.abs(t)/g;o.push([u[0]-m[0]*O,u[1]-m[1]*O]);break}case"Bevelled":o.push([u[0]+y[1]*t,u[1]-y[0]*t]),o.push([u[0]+f[1]*t,u[1]-f[0]*t]);break;case"Rounded":o.push([u[0]+y[1]*t,u[1]-y[0]*t]);for(var k=.2,x=1;x<5;x++,k+=.2){var w=[y[1]*(1-k)+f[1]*k,-y[0]*(1-k)-f[0]*k];this.normalize(w),o.push([u[0]+w[0]*t,u[1]+w[1]*t])}o.push([u[0]+f[1]*t,u[1]-f[0]*t]);break;default:if(v<0)o.push([u[0]+(y[1]+y[0])*t,u[1]+(y[1]-y[0])*t]),o.push([u[0]+(f[1]-f[0])*t,u[1]-(f[0]+f[1])*t]);else{var j=Math.sqrt((1+Math.abs(p))/2),P=[f[0]-y[0],f[1]-y[1]];this.normalize(P);var S=t/j;o.push([u[0]-P[0]*S,u[1]-P[1]*S])}}}else{var M=[u[0]-l[0],u[1]-l[1]];this.normalize(M),o.push([u[0]+M[1]*t,u[1]-M[0]*t])}else{var I=[h[0]-u[0],h[1]-u[1]];this.normalize(I),o.push([u[0]+I[1]*t,u[1]-I[0]*t])}l=u,u=h}return s&&o.push([o[0][0],o[0][1]]),o}}]),e}(),d=1.7320508075688772,b=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new _(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();b.instance=null;var _=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new p,s._width=(void 0!==r.width?r.width:5)*a,s._arrowType=void 0!==r.geometricEffectArrowType?r.geometricEffectArrowType:"OpenEnded",s._offsetFlattenError=y*a,s}return Object(a.a)(i,[{key:"processPath",value:function(e){switch(this._arrowType){default:return this._constructSimpleArrow(e,!0);case"Block":return this._constructSimpleArrow(e,!1);case"Crossed":return this._constructCrossedArrow(e)}}},{key:"_constructSimpleArrow",value:function(e,t){var i=this._curveHelper.calculatePathLength(e),r=this._width;i<2*r&&(r=i/2);var n=this._curveHelper.getSubCurve(e,0,i-r);if(!n)return null;var a=r/2;if(this._curveHelper.isEmpty(n,!1))return null;var s=this._constructOffset(n,-a);if(!s)return null;var o=this._constructOffset(n,a);if(!o)return null;var l=this._constructArrowBasePoint(s,-a/2);if(!l)return null;var u=this._constructArrowBasePoint(o,a/2);if(!u)return null;var c=e[e.length-1];t||(this._makeControlPoint(o,!0),this._makeControlPoint(s,!0));var h=new v;return h.addPath(o,!0),h.lineTo(u),this._makeControlPoint(h.path()),h.lineTo(c),this._makeControlPoint(h.path()),h.lineTo(l),this._makeControlPoint(h.path()),h.addPath(s,!1),t?{paths:[h.path()]}:(h.close(),{rings:[h.path()]})}},{key:"_constructCrossedArrow",value:function(e){var t=this._curveHelper.calculatePathLength(e),i=this._width;t<3.732050807568877*i&&(i=t/3.732050807568877);var r=this._curveHelper.getSubCurve(e,0,t-i*(1+d));if(!r)return null;var n=i/2;if(this._curveHelper.isEmpty(r,!1))return null;var a=this._constructOffset(r,n);if(!a)return null;var s=this._constructOffset(r,-n);if(!s)return null;var o=this._curveHelper.getSubCurve(e,0,t-i);if(!o)return null;if(this._curveHelper.isEmpty(o,!1))return null;var l=this._constructOffset(o,n);if(!l)return null;var u=this._constructOffset(o,-n);if(!u)return null;var c=l[l.length-1],h=this._constructArrowBasePoint(l,n/2);if(!h)return null;var f=u[u.length-1],y=this._constructArrowBasePoint(u,-n/2);if(!y)return null;var p=e[e.length-1];this._makeControlPoint(a,!1),this._makeControlPoint(s,!1);var b=new v;return b.addPath(a,!0),this._makeControlPoint(b.path()),b.lineTo(f),b.lineTo(y),this._makeControlPoint(b.path()),b.lineTo(p),this._makeControlPoint(b.path()),b.lineTo(h),this._makeControlPoint(b.path()),b.lineTo(c),this._makeControlPoint(b.path()),b.addPath(s,!1),{paths:[b.path()]}}},{key:"_constructOffset",value:function(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}},{key:"_constructArrowBasePoint",value:function(e,t){if(!e||e.length<2)return null;var i=e[e.length-2],r=e[e.length-1],n=[r[0]-i[0],r[1]-i[1]];return this._curveHelper.normalize(n),[r[0]+n[1]*t,r[1]-n[0]*t]}},{key:"_makeControlPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(l.j)(t?e[0]:e[e.length-1],1)}}]),i}(l.a),g=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new m(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();g.instance=null;var m=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._curveHelper=new p,this._size=(void 0!==i.size?i.size:1)*r,this._offsetFlattenError=y*r}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e))if(this._size>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError);if(i)return{rings:[i]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if(Object(o.g)(e)){if(0===this._size)return e;var n,a=[],s=Object(r.a)(e.rings);try{for(s.s();!(n=s.n()).done;){var l=n.value,u=this._curveHelper.offset(l,this._size,"Rounded",4,this._offsetFlattenError);u&&a.push(u)}}catch(b){s.e(b)}finally{s.f()}if(a.length)return{rings:a}}if(Object(o.h)(e)&&this._size>0){var c,h=[],f=Object(r.a)(e.paths);try{for(f.s();!(c=f.n()).done;){var y=c.value;if(y&&y.length>1){var v=this._curveHelper.offset(y,this._size,"Rounded",4,this._offsetFlattenError),p=this._curveHelper.offset(y,-this._size,"Rounded",4,this._offsetFlattenError);if(v&&p){for(var d=p.length-1;d>=0;d--)v.push(p[d]);v.push([v[0][0],v[0][1]]),h.push(v)}}}}catch(b){f.e(b)}finally{f.f()}if(h.length)return{rings:h}}Object(o.f)(e)&&this._size,e=this._inputGeometries.next()}return null}}]),e}(),O=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new k(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();O.instance=null;var k=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new p,s._beginCut=(void 0!==r.beginCut?r.beginCut:1)*a,s._endCut=(void 0!==r.endCut?r.endCut:1)*a,s._middleCut=(void 0!==r.middleCut?r.middleCut:0)*a,s._invert=void 0!==r.invert&&r.invert,s._beginCut<0&&(s._beginCut=0),s._endCut<0&&(s._endCut=0),s._middleCut<0&&(s._middleCut=0),s}return Object(a.a)(i,[{key:"processPath",value:function(e){var t=this._beginCut,i=this._endCut,r=this._middleCut,n=this._curveHelper.calculatePathLength(e),a=[];if(this._invert)if(0===t&&0===i&&0===r);else if(t+i+r>=n)a.push(e);else{var s=this._curveHelper.getSubCurve(e,0,t);s&&a.push(s),(s=this._curveHelper.getSubCurve(e,.5*(n-r),.5*(n+r)))&&a.push(s),(s=this._curveHelper.getSubCurve(e,n-i,i))&&a.push(s)}else if(0===t&&0===i&&0===r)a.push(e);else if(t+i+r>=n);else if(0===r){var o=this._curveHelper.getSubCurve(e,t,n-i);o&&a.push(o)}else{var l=this._curveHelper.getSubCurve(e,t,.5*(n-r));l&&a.push(l),(l=this._curveHelper.getSubCurve(e,.5*(n+r),n-i))&&a.push(l)}return 0===a.length?null:{paths:a}}}]),i}(l.a),x=i(23),w=1e-7,j=function(){function e(){Object(n.a)(this,e),this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}return Object(a.a)(e,[{key:"isEmpty",value:function(){return 0===this._values.length}},{key:"size",value:function(){return this._values.length}},{key:"init",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._setEmpty(),!e||0===e.length)return!1;for(var r=0;r<e.length;r++){var n=Math.abs(e[r]);i&&n<w&&(n=w),this._values.push(n),this._length+=n}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}},{key:"scale",value:function(e){for(var t=this._values?this._values.length:0,i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}},{key:"addValue",value:function(e){this._length+=e,this._values.push(e)}},{key:"firstValue",value:function(){return this._values[0]}},{key:"lastValue",value:function(){return this._values[this._values.length-1]}},{key:"nextValue",value:function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}},{key:"reset",value:function(){this._currentValue=-1}},{key:"length",value:function(){return this._length}},{key:"_setEmpty",value:function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}]),e}(),P=function(){function e(){Object(n.a)(this,e),this.reset()}return Object(a.a)(e,[{key:"reset",value:function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}},{key:"isValid",value:function(){return-1!==this.segment}},{key:"copyTo",value:function(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}]),e}(),S=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(n.a)(this,i),(e=t.call(this,r,a))._tolerance=y,e._currentPosition=new P,e}return Object(a.a)(i,[{key:"updateTolerance",value:function(e){this._tolerance=y*e}},{key:"init",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this.setPosAtNextPart()}},{key:"curPositionIsValid",value:function(){return this._currentPosition.isValid()}},{key:"nextPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new P;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}},{key:"curPointAndAngle",value:function(e){e.pt=this._getPoint(this._currentPosition);var t=this._getAngle(this._currentPosition),i=Object(x.a)(t,2),r=i[0],n=i[1];e.ca=r,e.sa=n}},{key:"nextPointAndAngle",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new P;if(!this._nextPosition(e,r,null,i))return!1;r.copyTo(this._currentPosition),t.pt=this._getPoint(r);var n=this._getAngle(r),a=Object(x.a)(n,2),s=a[0],o=a[1];return t.ca=s,t.sa=o,!0}},{key:"nextCurve",value:function(e){if(0===e)return null;var t=[],i=new P;return this._nextPosition(e,i,t,1)?(i.copyTo(this._currentPosition),t):null}},{key:"isPathEnd",value:function(){return this._currentPosition.isPathEnd}},{key:"getPathEnd",value:function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}},{key:"_nextPosition",value:function(e,t,i,r){if(this._currentPosition.isPathEnd)return!1;var n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.length)if(0===n){var a=this._path[t.segment];i.push([a[0],a[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,n));var s=this._path[t.segment+1];i.push([s[0],s[1]])}if(n=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this.nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==r&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,1===r?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){if(0===i.length)if(0===n){var o=this._path[t.segment];i.push([o[0],o[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,n));var l=t.abscissa/t.segmentLength;if(1===l){var u=this._path[t.segment+1];i.push([u[0],u[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,l))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}},{key:"_getPoint",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)}},{key:"_getAngle",value:function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)}},{key:"setPosAtNextPart",value:function(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===Object(l.f)(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}for(var e=this._partSegCount;e;)this.previousSegment(),--e;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;var t=this.getStartPointIndex();this._ctrlPtBegin=1===Object(l.f)(this._path[t]);var i=t+this._partSegCount+1;if(i>=this._path.length&&(i=0),this._ctrlPtEnd=1===Object(l.f)(this._path[i]),this._patternLength>0){var r=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,a=Math.round((this._partLength-(r+n))/this._patternLength);a<=0&&(a=r+n>0?0:1),this._partLengthRatio=this._partLength/(r+n+a*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}},{key:"hasNextSegment",value:function(){return this._seg<this._path.length-2}},{key:"previousSegment",value:function(){return--this._seg}},{key:"nextSegment",value:function(){return++this._seg}},{key:"getStartPointIndex",value:function(){return this._seg}},{key:"getEndPointIndex",value:function(){return this._seg+1}}]),i}(p),M=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new I(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();M.instance=null;var I=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._walker=new S,s._walker.updateTolerance(a),s._endings=r.lineDashEnding,s._customDashPos=void 0!==r.offsetAlongLine?r.offsetAlongLine*a:0,s._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*a:0,s._pattern=new j,s._pattern.init(r.dashTemplate,!0),s._pattern.scale(a),s}return Object(a.a)(i,[{key:"processPath",value:function(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){var t=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(t=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var i=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||i<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}var r;if(this.iteratePath)r=this._pattern.nextValue();else{var n;switch(this._endings){default:n=.5*this._pattern.firstValue();break;case"HalfGap":n=.5*-this._pattern.lastValue();break;case"FullGap":n=-this._pattern.lastValue();break;case"FullPattern":n=0;break;case"NoConstraint":case"Custom":n=-this._customDashPos}var a=n/this._pattern.length();n=(a-=Math.floor(a))*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();for(var s=!1;n>=r;)n-=r,r=this._pattern.nextValue(),s=!s;r-=n,s?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}var o=this._walker.nextCurve(r);return o?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),v.mergePath(o,this._firstCurve),this._firstCurve=null)):(r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(o=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,o=this._firstCurve,this._firstCurve=null),{paths:[o]}}}]),i}(l.a),T=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new C(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();T.instance=null;var C=function(){function e(t,i,r){switch(Object(n.a)(this,e),this._inputGeometries=t,this._curveHelper=new p,this._width=(void 0!==i.width?i.width:2)*r,i.method){default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square"}this._option=i.option,this._offsetFlattenError=y*r}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;var t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if(Object(o.g)(e)&&this._width>0){var i,n=[],a=Object(r.a)(e.rings);try{for(a.s();!(i=a.n()).done;){var s=i.value,l=this._curveHelper.calculatePathLength(s),u=this._curveHelper.offset(s,this._width,this._method,4,this._offsetFlattenError);u&&(l<0&&u.reverse(),n.push(u))}}catch(c){a.e(c)}finally{a.f()}if(n.length)return{rings:n}}e=this._inputGeometries.next()}return null}}]),e}(),L=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new D(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();L.instance=null;var D=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new p,s._length=(void 0!==r.length?r.length:20)*a,s._angle=void 0!==r.angle?r.angle:225,s._position=void 0!==r.position?r.position:50,s._length<0&&(s._length=-s._length),s._position<20&&(s._position=20),s._position>80&&(s._position=80),s._mirror=!1,s}return Object(a.a)(i,[{key:"processPath",value:function(e){if(this._curveHelper.isEmpty(e,!1))return null;var t=e[0],i=e[e.length-1],r=[i[0]-t[0],i[1]-t[1]];this._curveHelper.normalize(r);var n=[t[0]+(i[0]-t[0])*this._position/100,t[1]+(i[1]-t[1])*this._position/100],a=Math.cos((90-this._angle)/180*Math.PI),s=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(s=-s),this._mirror=!this._mirror,{paths:[[t,[n[0]-this._length/2*a,n[1]-this._length/2*s],[n[0]+this._length/2*a,n[1]+this._length/2*s],i]]}}}]),i}(l.a),A=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new R(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();A.instance=null;var R=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?-i.offsetY*r:0}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(Object(o.d)(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if(Object(o.g)(e)){var t=Object(s.a)(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if(Object(o.h)(e)){var i=Object(s.a)(e);return this._moveMultipath(i.paths,this._offsetX,this._offsetY),i}if(Object(o.e)(e)){var r=Object(s.a)(e);return this._movePath(r.points,this._offsetX,this._offsetY),r}if(Object(o.f)(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null}},{key:"_moveMultipath",value:function(e,t,i){if(e){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._movePath(s,t,i)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_movePath",value:function(e,t,i){if(e){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;s[0]+=t,s[1]+=i}}catch(o){a.e(o)}finally{a.f()}}}}]),e}(),E=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new z(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();E.instance=null;var z=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._curveHelper=new p,this._offset=(void 0!==i.offset?i.offset:1)*r,this._method=i.method,this._option=i.option,this._offsetFlattenError=y*r}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._offset)return e;if(Object(o.d)(e)){if("Rounded"===this._method&&this._offset>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError);return i?{rings:[i]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if(Object(o.g)(e)){var n,a=[],s=Object(r.a)(e.rings);try{for(s.s();!(n=s.n()).done;){var l=n.value,u=this._curveHelper.offset(l,this._offset,this._method,4,this._offsetFlattenError);u&&a.push(u)}}catch(p){s.e(p)}finally{s.f()}if(a.length)return{rings:a}}if(Object(o.h)(e)){var c,h=[],f=Object(r.a)(e.paths);try{for(f.s();!(c=f.n()).done;){var y=c.value,v=this._curveHelper.offset(y,this._offset,this._method,4,this._offsetFlattenError);v&&h.push(v)}}catch(p){f.e(p)}finally{f.f()}if(h.length)return{paths:h}}e=this._inputGeometries.next()}return null}}]),e}(),B=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new V(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();B.instance=null;var V=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._reverse=void 0===i.reverse||i.reverse}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if(Object(o.h)(e)){var t=Object(s.a)(e);return Object(l.h)(t.paths),t}e=this._inputGeometries.next()}return null}}]),e}(),U=i(139),F=i(303),H=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new q(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();H.instance=null;var q=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._rotateAngle=void 0!==i.angle?-i.angle*Math.PI/180:0}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._rotateAngle)return e;var t=Object(U.l)();Object(F.a)(t,e);var i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;if(Object(o.d)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(n.rings,i,r),n}if(Object(o.g)(e)){var a=Object(s.a)(e);return this._rotateMultipath(a.rings,i,r),a}if(Object(o.h)(e)){var l=Object(s.a)(e);return this._rotateMultipath(l.paths,i,r),l}if(Object(o.e)(e)){var u=Object(s.a)(e);return this._rotatePath(u.points,i,r),u}if(Object(o.f)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_rotateMultipath",value:function(e,t,i){if(e){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._rotatePath(s,t,i)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_rotatePath",value:function(e,t,i){if(e){var n,a=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle),o=Object(r.a)(e);try{for(o.s();!(n=o.n()).done;){var l=n.value,u=l[0]-t,c=l[1]-i;l[0]=t+u*a-c*s,l[1]=i+u*s+c*a}}catch(h){o.e(h)}finally{o.f()}}}}]),e}(),N=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new G(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();N.instance=null;var G=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._xFactor=void 0!==i.xScaleFactor?i.xScaleFactor:1.15,this._yFactor=void 0!==i.yScaleFactor?i.yScaleFactor:1.15}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(1===this._xFactor&&1===this._yFactor)return e;var t=Object(U.l)();Object(F.a)(t,e);var i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;if(Object(o.d)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(n.rings,i,r),n}if(Object(o.g)(e)){var a=Object(s.a)(e);return this._scaleMultipath(a.rings,i,r),a}if(Object(o.h)(e)){var l=Object(s.a)(e);return this._scaleMultipath(l.paths,i,r),l}if(Object(o.e)(e)){var u=Object(s.a)(e);return this._scalePath(u.points,i,r),u}if(Object(o.f)(e))return e;e=this._inputGeometries.next()}return null}},{key:"_scaleMultipath",value:function(e,t,i){if(e){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;this._scalePath(s,t,i)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"_scalePath",value:function(e,t,i){if(e){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,o=(s[0]-t)*this._xFactor,l=(s[1]-i)*this._yFactor;s[0]=t+o,s[1]=i+l}}catch(u){a.e(u)}finally{a.f()}}}}]),e}(),Y=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new J(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Y.instance=null;var X,W,J=function(){function e(t,i,r){Object(n.a)(this,e),this._inputGeometries=t,this._height=(void 0!==i.amplitude?i.amplitude:2)*r,this._period=(void 0!==i.period?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new j,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new S,this._walker.updateTolerance(r)}return Object(a.a)(e,[{key:"next",value:function(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period)return e;if(Object(o.h)(e)){var t=this._processGeom(e.paths);if(t.length)return{paths:t}}if(Object(o.g)(e)){var i=this._processGeom(e.rings);if(i.length)return{rings:i}}e=this._inputGeometries.next()}return null}},{key:"_processGeom",value:function(e){var t,i=[],n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(this._walker.init(a,this._pattern))switch(this._style){default:i.push(this._constructCurve(a,!1));break;case"Square":i.push(this._constructSquare(a));break;case"Triangle":i.push(this._constructTriangle(a));break;case"Random":i.push(this._constructCurve(a,!0))}else i.push(a)}}catch(s){n.e(s)}finally{n.f()}return i}},{key:"_constructCurve",value:function(e,t){var i=new v,r=this._walker.calculatePathLength(e),n=Math.round(r/this._period);0===n&&(n=1);var a=16*n+1,s=r/n,o=this._period/16,l=1/a,u=2*Math.PI*r/s,c=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),y=.75-Math.random()/2,p=.75-Math.random()/2,d={};this._walker.curPointAndAngle(d),i.startPath(d.pt);for(var b=0;;){if(!this._walker.nextPointAndAngle(o,d)){i.lineTo(e[e.length-1]);break}var _=b,g=void 0;if(b+=l,t){var m=this._height/2*(1+.3*Math.sin(y*u*_+c));g=m*Math.sin(u*_+h),g+=m*Math.sin(p*u*_+f),g/=2}else g=.5*this._height*Math.sin(.5*u*_);i.lineTo([d.pt[0]-g*d.sa,d.pt[1]+g*d.ca])}return i.path()}},{key:"_constructSquare",value:function(e){var t=new v,i=this._walker.calculatePathLength(e);Math.round(i/this._period);for(var r=!0;;){var n=!1;if(this._walker.curPositionIsValid()){var a={};this._walker.curPointAndAngle(a);var s={};if(this._walker.nextPointAndAngle(this._period,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(r?(t.startPath(a.pt),r=!1):t.lineTo(a.pt),t.lineTo([a.pt[0]-this._height/2*a.sa,a.pt[1]+this._height/2*a.ca]),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca]),n=!0)}}if(!n){t.lineTo(this._walker.getPathEnd());break}}return t.path()}},{key:"_constructTriangle",value:function(e){var t=new v,i=this._walker.calculatePathLength(e);Math.round(i/this._period);for(var r=!0;;){var n=!1;if(this._walker.curPositionIsValid()){var a={};this._walker.curPointAndAngle(a);var s={};if(this._walker.nextPointAndAngle(this._period/2,s)){var o={};this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(r?(t.startPath(a.pt),r=!1):t.lineTo(a.pt),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca])),n=!0)}}if(!n){t.lineTo(this._walker.getPathEnd());break}}return t.path()}}]),e}();(W=X||(X={})).NoConstraint="NoConstraint",W.WithMarkers="WithMarkers",W.WithFullGap="WithFullGap",W.WithHalfGap="WithHalfGap",W.Custom="Custom";var Q=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new K(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Q.instance=null;var K=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._grometryWalker=new S,s._grometryWalker.updateTolerance(a),s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*a:0,s._originalEndings=r.endings,s._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*a:0,s._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*a:0,s._pattern=new j,s._pattern.init(r.placementTemplate,!1),s._pattern.scale(a),s._endings=s._originalEndings,s}return Object(a.a)(i,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===X.WithFullGap&&this.isClosed?this._endings=X.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;var i,r=!0;switch(this._endings){case X.NoConstraint:i=-this._position,i=this._adjustPosition(i),r=!1;break;case X.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case X.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case X.WithMarkers:i=0;break;case X.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._grometryWalker.init(e,this._pattern,r))return null;this._pattern.reset();for(var n=0;i>n;)i-=n,n=this._pattern.nextValue();t=n-=i,this.iteratePath=!0}var a={};return this._grometryWalker.nextPointAndAngle(t,a)?this._endings===X.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===X.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(a.pt[0]+this._offset*a.sa,a.pt[1]-this._offset*a.ca),this._angleToLine&&this.internalPlacement.setRotateCS(a.ca,a.sa),this.internalPlacement):(this.iteratePath=!1,null)}},{key:"_adjustPosition",value:function(e){var t=e/this._pattern.length();return(t-=Math.floor(t))*this._pattern.length()}}]),i}(l.b),Z=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new $(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();Z.instance=null;var $=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!1,!0))._curveHelper=new p,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*a:0,s._type=r.extremityPlacement,s._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*a:0,s._beginProcessed=!1,s}return Object(a.a)(i,[{key:"processPath",value:function(e){var t;switch(this._type){default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);case"None":}return t}},{key:"_atExtremities",value:function(e,t,i){var r=e.length;if(r<2)return null;for(var n,a=i?1:r-2,s=i?r:-1,o=i?1:-1,u=0,c=i?e[0]:e[r-1],h=a;h!==s;h+=o){n=c,c=e[h];var f=this._curveHelper.calculateLength(n,c);if(u+f>t){var y=(t-u)/f,v=this._curveHelper.getAngleCS(n,c,y),p=Object(x.a)(v,2),d=p[0],b=p[1],_=Object(l.e)(n,c,y);return this.internalPlacement.setTranslate(_[0]-this._offset*b,_[1]+this._offset*d),this._angleToLine&&this.internalPlacement.setRotateCS(-d,-b),this.internalPlacement}u+=f}return null}}]),i}(l.b),ee=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new te(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ee.instance=null;var te=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._walker=new S,s._walker.updateTolerance(a),s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*a:0,s._beginGap=void 0!==r.beginPosition?r.beginPosition*a:0,s._endGap=void 0!==r.endPosition?r.endPosition*a:0,s._flipFirst=void 0===r.flipFirst||r.flipFirst,s._pattern=new j,s._pattern.init(r.positionArray,!1,!1),s._subPathLen=0,s._posCount=s._pattern.size(),s._isFirst=!0,s._prevPos=0,s}return Object(a.a)(i,[{key:"processPath",value:function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath){var i=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+i;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();var n=this._pattern.nextValue()*this._subPathLen,a=this._beginGap+n;t=a-this._prevPos,this._prevPos=a,this.iteratePath=!0}var s={};if(!this._walker.nextPointAndAngle(t,s,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]+this._offset*s.sa,s.pt[1]-this._offset*s.ca);var o,l,u=this._isFirst&&this._flipFirst;return this._angleToLine?(o=s.ca,l=s.sa):(o=1,l=0),u&&(o=-o,l=-l),this.internalPlacement.setRotateCS(o,l),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}]),i}(l.b),ie=i(553);var re=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new ne(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();re.instance=null;var ne=function(){function e(t,i,r){if(Object(n.a)(this,e),this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==i.stepX?Math.abs(i.stepX):16)*r,this._stepY=(void 0!==i.stepY?Math.abs(i.stepY):16)*r,0!==this._stepX&&0!==this._stepY&&t&&function(e){return void 0!==e.rings}(t)&&t.rings){if(this._gridType=void 0!==i.gridType?i.gridType:"Fixed","Random"===this._gridType)this._randomness=void 0!==i.randomness?i.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else{if(this._randomness=0,this._gridAngle=void 0!==i.gridAngle?i.gridAngle:0,this._shiftOddRows=void 0!==i.shiftOddRows&&i.shiftOddRows,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?i.offsetY*r:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new ie.a,this._calculateMinMax(t),this._geometry=t}}return Object(a.a)(e,[{key:"next",value:function(){return this._geometry?this._nextInside():null}},{key:"_calculateMinMax",value:function(e){var t,i,n,a,s,o,l,u;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,s=o=Number.MAX_VALUE,l=u=-Number.MAX_VALUE;var c,h=Object(r.a)(e.rings);try{for(h.s();!(c=h.n()).done;)for(var f=c.value,y=f?f.length:0,v=0;v<y;++v)t=f[v][0]-this._graphicOriginX-this._offsetX,i=f[v][1]-this._graphicOriginY-this._offsetY,n=this._cosAngle*t-this._sinAngle*i,a=this._sinAngle*t+this._cosAngle*i,s=Math.min(s,n),l=Math.max(l,n),o=Math.min(o,a),u=Math.max(u,a)}catch(p){h.e(p)}finally{h.f()}s+=this._graphicOriginX,l+=this._graphicOriginX,o+=this._graphicOriginY,u+=this._graphicOriginY,this._xMin=Math.round(s/this._stepX),this._xMax=Math.round(l/this._stepX),this._yMin=Math.round(o/this._stepY),this._yMax=Math.round(u/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1}},{key:"_nextInside",value:function(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}var e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);var t=this._currentY*this._stepY+this._offsetY,i=void 0,r=void 0;return this._currentX++,"Random"===this._gridType?(i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Math.random())*2/3,r=this._graphicOriginY+t+this._stepY*this._randomness*(.5-Math.random())*2/3):(i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,r=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t),this._internalPlacement.setTranslate(i,r),this._internalPlacement}}}]),e}(),ae=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new se(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ae.instance=null;var se=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new p,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*a:0,s._relativeTo=r.relativeTo,s._position=void 0!==r.startPointOffset?r.startPointOffset*a:0,s._epsilon=.001*a,s}return Object(a.a)(i,[{key:"processPath",value:function(e){var t=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){var i=this._curSegment;this._curSegment++;var r=e[i-1],n=e[i],a=this._curveHelper.calculateLength(r,n);if(!(a<this._epsilon)){var s=.5+this._position/a,o=this._curveHelper.getAngleCS(r,n,s),u=Object(x.a)(o,2),c=u[0],h=u[1],f=Object(l.e)(r,n,s);return this.internalPlacement.setTranslate(f[0]-this._offset*h,f[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(c,h),this.internalPlacement}}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&Object(l.i)(e);var y=this.onLine(e,t);return"LineEnd"===this._relativeTo&&Object(l.i)(e),y}},{key:"onLine",value:function(e,t){var i,r=!1;switch(this._relativeTo){default:i=this._curveHelper.calculatePathLength(e)/2+t;break;case"LineBeginning":i=t;break;case"LineEnd":i=t,r=!0}for(var n,a=e.length,s=0,o=e[0],u=1;u<a;++u){n=o,o=e[u];var c=this._curveHelper.calculateLength(n,o);if(s+c>i){var h=(i-s)/c,f=this._curveHelper.getAngleCS(n,o,h),y=Object(x.a)(f,2),v=y[0],p=y[1],d=Object(l.e)(n,o,h),b=r?this._offset:-this._offset;return this.internalPlacement.setTranslate(d[0]-b*p,d[1]+b*v),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-v,-p):this.internalPlacement.setRotateCS(v,p)),this.internalPlacement}s+=c}return null}}]),i}(l.b),oe=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new le(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();oe.instance=null;var le=function(e){Object(h.a)(i,e);var t=Object(f.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,!0,!0))._curveHelper=new p,s._angleToLine=void 0===r.angleToLine||r.angleToLine,s._offset=void 0!==r.offset?r.offset*a:0,s._endPoints=void 0===r.placeOnEndPoints||r.placeOnEndPoints,s._controlPoints=void 0===r.placeOnControlPoints||r.placeOnControlPoints,s._regularVertices=void 0===r.placeOnRegularVertices||r.placeOnRegularVertices,s._tags=[],s._tagIterator=0,s}return Object(a.a)(i,[{key:"processPath",value:function(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;var t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);var i=t[0],r=t[1];if(0!==this._offset){var n=Math.cos(t[2]),a=Math.sin(t[2]);i-=this._offset*a,r+=this._offset*n}return this.internalPlacement.setTranslate(i,r),this._tagIterator++,this.internalPlacement}},{key:"_preparePath",value:function(e){this._tags.length=0,this._tagIterator=0;for(var t,i,r=Object(l.g)(e),n=e.length-1,a=0,s=0,o=0,u=0,c=0;a<n;){t=e[++a-1],i=e[a];var h=Object(l.f)(t),f=Object(l.f)(i);(this._angleToLine||0!==this._offset)&&(u=this._curveHelper.getAngle(t,i,0)),1===a?r?(s=u,o=h):this._endPoints&&this._tags.push([t[0],t[1],u]):1===h?this._controlPoints&&this._tags.push([t[0],t[1],ue(c,u)]):this._regularVertices&&this._tags.push([t[0],t[1],ue(c,u)]),(this._angleToLine||0!==this._offset)&&(c=this._curveHelper.getAngle(t,i,1)),a===n&&(r?1===f||1===o?this._controlPoints&&this._tags.push([i[0],i[1],ue(c,s)]):this._regularVertices&&this._tags.push([i[0],i[1],ue(c,s)]):this._endPoints&&this._tags.push([i[0],i[1],c]))}this._tagIterator=0}}]),i}(l.b);function ue(e,t){for(var i=Math.PI;Math.abs(t-e)>i+2e-15;)t-e>i?t-=2*i:t+=2*i;return(e+t)/2}var ce=function(){function e(){Object(n.a)(this,e)}return Object(a.a)(e,[{key:"execute",value:function(e,t,i){return new he(e,t,i)}}],[{key:"local",value:function(){return null===e.instance&&(e.instance=new e),e.instance}}]),e}();ce.instance=null;var he=function(){function e(t,i,r){Object(n.a)(this,e),this._geometry=t,this._offsetX=void 0!==i.offsetX?i.offsetX*r:0,this._offsetY=void 0!==i.offsetY?i.offsetY*r:0,this._method=void 0!==i.method?i.method:"OnPolygon",this._internalPlacement=new ie.a}return Object(a.a)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e&&function(e){return void 0!==e.rings}(e)?this._polygonCenter(e):null}},{key:"_polygonCenter",value:function(e){this._method;var t=Object(U.l)();return Object(F.a)(t,e),this._internalPlacement.setTranslate((t[2]+t[0])/2+this._offsetX,(t[3]+t[1])/2-this._offsetY),!0?this._internalPlacement:null}}]),e}();function fe(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return u.local();case"CIMGeometricEffectArrow":return b.local();case"CIMGeometricEffectBuffer":return g.local();case"CIMGeometricEffectCut":return O.local();case"CIMGeometricEffectDashes":return M.local();case"CIMGeometricEffectDonut":return T.local();case"CIMGeometricEffectJog":return L.local();case"CIMGeometricEffectMove":return A.local();case"CIMGeometricEffectOffset":return E.local();case"CIMGeometricEffectReverse":return B.local();case"CIMGeometricEffectRotate":return H.local();case"CIMGeometricEffectScale":return N.local();case"CIMGeometricEffectWave":return Y.local()}return null}function ye(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return Q.local();case"CIMMarkerPlacementAtExtremities":return Z.local();case"CIMMarkerPlacementAtRatioPositions":return ee.local();case"CIMMarkerPlacementInsidePolygon":return re.local();case"CIMMarkerPlacementOnLine":return ae.local();case"CIMMarkerPlacementOnVertices":return oe.local();case"CIMMarkerPlacementPolygonCenter":return ce.local()}return null}},576:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var r=i(2),n=i(3),a=i(5),s=i(6),o=i(0),l=i(29),u=i(67),c=i(63),h=i(211),f=i(11),y=i(7),v=i(178),p=i(1),d=(i(12),i(15),i(8)),b=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).layer=null,n.parent=null,n}return Object(n.a)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw f.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),t),t}}))}},{key:"fullOpacity",get:function(){return Object(y.t)(this.get("layer.opacity"),1)*Object(y.t)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}(Object(c.b)(Object(h.a)(Object(v.b)(u.a.EventedMixin(l.a)))));Object(o.a)([Object(p.b)()],b.prototype,"fullOpacity",null),Object(o.a)([Object(p.b)()],b.prototype,"layer",void 0),Object(o.a)([Object(p.b)()],b.prototype,"parent",void 0),Object(o.a)([Object(p.b)({readOnly:!0})],b.prototype,"suspended",null),Object(o.a)([Object(p.b)({readOnly:!0})],b.prototype,"suspendInfo",null),Object(o.a)([Object(p.b)({readOnly:!0})],b.prototype,"legendEnabled",null),Object(o.a)([Object(p.b)({type:Boolean,readOnly:!0})],b.prototype,"updating",null),Object(o.a)([Object(p.b)({readOnly:!0})],b.prototype,"updatingProgress",null),Object(o.a)([Object(p.b)()],b.prototype,"visible",null);var _=b=Object(o.a)([Object(d.a)("esri.views.layers.LayerView")],b)},584:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(23),n=i(2),a=i(3),s=i(5),o=i(6),l=i(235),u=i(588),c=i(160),h=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,r,a,s,o){var l,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o;return Object(n.a)(this,i),(l=t.call(this)).triangleCountReportedInDebug=0,l.triangleCount=0,l.texture=null,l.key=new c.a(e),l.x=r,l.y=a,l.width=s,l.height=o,l.rangeX=u,l.rangeY=h,l}return Object(a.a)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=e.toScreenNoRotation([0,0],[this.x,this.y]),s=Object(r.a)(a,2),o=s[0],u=s[1],c=this.width/this.rangeX*i,h=this.height/this.rangeY*i;Object(l.l)(n,c,0,0,0,h,0,o,u,1),Object(l.i)(this.transforms.dvs,e.displayViewMat3,n)}}]),i}(u.a)},585:function(e,t,i){"use strict";i.d(t,"a",(function(){return L}));var r,n=i(2),a=i(3),s=i(41),o=i(38),l=i(5),u=i(6),c=i(0),h=i(31),f=i(125),y=i(25),v=i(1),p=(i(12),i(15),i(11),i(8)),d=i(631),b=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return i}(i(20).a),_=b=Object(c.a)([Object(p.a)("esri.views.layers.support.ClipArea")],b),g=r=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(a.a)(i,[{key:"clone",value:function(){return new r({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(_);Object(c.a)([Object(v.b)({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0),Object(c.a)([Object(v.b)({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0),Object(c.a)([Object(v.b)({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0),Object(c.a)([Object(v.b)({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0),Object(c.a)([Object(v.b)({readOnly:!0})],g.prototype,"version",null);var m,O=g=r=Object(c.a)([Object(p.a)("esri.views.layers.support.ClipRect")],g),k=(i(76),i(104)),x=i(73),w=i(48),j=i(90),P={base:k.a,key:"type",typeMap:{extent:w.a,polygon:j.a}},S=m=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(a.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new m({geometry:this.geometry.clone()})}}]),i}(_);Object(c.a)([Object(v.b)({types:P,json:{read:x.a,write:!0}})],S.prototype,"geometry",void 0),Object(c.a)([Object(v.b)({readOnly:!0})],S.prototype,"version",null);var M=S=m=Object(c.a)([Object(p.a)("esri.views.layers.support.Geometry")],S),I=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(a.a)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(_);Object(c.a)([Object(v.b)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),Object(c.a)([Object(v.b)({readOnly:!0})],I.prototype,"version",null);var T=I=Object(c.a)([Object(p.a)("esri.views.layers.support.Path")],I),C=h.a.ofType({key:"type",base:_,typeMap:{rect:O,path:T,geometry:M}}),L=function(e){var t=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).clips=new C,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(a.a)(i,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new d.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(y.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(y.a)(this,["layer.opacity","container"],(function(){var e,i;t.container&&(t.container.opacity=null!=(e=null==(i=t.layer)?void 0:i.opacity)?e:1)}),!0),Object(y.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(y.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){var a=!r,s=!n;!a&&e<=r&&(a=!0),!s&&e>=n&&(s=!0),t=a&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(o.a)(i.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),i}(e);return Object(c.a)([Object(v.b)({type:C,set:function(e){var t=Object(f.b)(e,this._get("clips"),C);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(v.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(v.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(v.b)()],t.prototype,"container",void 0),Object(c.a)([Object(v.b)()],t.prototype,"suspended",void 0),Object(c.a)([Object(v.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(v.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(v.b)()],t.prototype,"updating",null),Object(c.a)([Object(v.b)()],t.prototype,"view",void 0),t=Object(c.a)([Object(p.a)("esri.views.2d.layers.LayerView2D")],t)}},589:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(2),n=i(3),a=(i(19),function(){function e(t){Object(r.a)(this,e),this._geometry=t}return Object(n.a)(e,[{key:"next",value:function(){var e=this._geometry;return this._geometry=null,e}}]),e}())},590:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=[1,256,65536,16777216],n=[1/256,1/65536,1/16777216,1/4294967296],a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0,r=0;r<4;r++)i+=e[t+r]*n[r];return i}(new Uint8ClampedArray([255,255,255,255]));function s(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=o(e,0,a),s=0;s<4;s++)t[i+s]=Math.floor(256*l(n*r[s]))}function o(e,t,i){return e<t?t:e>i?i:e}function l(e){return e-Math.floor(e)}},591:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(13),n=i(2),a=i(3),s=i(41),o=i(38),l=i(5),u=i(6),c=i(12),h=i(535),f=i(627),y=i(675),v=i(672),p=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},d=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this))._tileInfoView=e,r}return Object(a.a)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(p),this.setStencilReference(),Object(s.a)(Object(o.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=Object(s.a)(Object(o.a)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=Object(s.a)(Object(o.a)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[v.a],drawPhase:h.c.DEBUG|h.c.MAP|h.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),Object(c.a)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[y.a],drawPhase:h.c.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=this._tileInfoView.getTileResolution(n.key);n.setTransform(e,a)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=Object(r.a)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(n){i.e(n)}finally{i.f()}}}]),i}(f.a)},598:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(2),n=i(3),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.x=t,this.y=i,this.width=n,this.height=a}return Object(n.a)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},639:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),n=i(3),a=i(7),s=function(){function e(t,i,n){Object(r.a)(this,e),this.pixelBlock=t,this.extent=i,this.originalPixelBlock=n}return Object(n.a)(e,[{key:"width",get:function(){return Object(a.k)(this.pixelBlock)?this.pixelBlock.width:0}},{key:"height",get:function(){return Object(a.k)(this.pixelBlock)?this.pixelBlock.height:0}},{key:"render",value:function(e){var t=this.pixelBlock;if(!Object(a.j)(t)){var i=this.filter({pixelBlock:t});if(!Object(a.j)(i.pixelBlock)){var r=i.pixelBlock.getAsRGBA(),n=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);n.data.set(r),e.putImageData(n,0,0)}}}},{key:"getRenderedRasterPixels",value:function(){var e=this.filter({pixelBlock:this.pixelBlock});return Object(a.j)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}]),e}()},651:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(23),n=i(2),a=i(3),s=i(14),o=i(41),l=i(38),u=i(5),c=i(6),h=i(7),f=i(235),y=i(305),v=i(382),p=(i(549),i(551),i(12),i(548),i(547),i(552),i(543),i(545)),d=(i(550),i(588)),b=i(639);function _(e,t,i){var r={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&i&&(r.width=t,r.height=i),new p.a(e,r)}var g=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(n.a)(this,i),(e=t.call(this)).requestRenderOnSourceChangedEnabled=o,e._textureInvalidated=!0,e.stencilRef=0,e.coordScale=[1,1],e._height=void 0,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e._width=void 0,e.x=0,e.y=0,e.blendFunction=a,e.source=r,e.requestRender=e.requestRender.bind(Object(s.a)(e)),e}return Object(a.a)(i,[{key:"destroy",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(e){this._height=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateTexture()}},{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(e){this._width=e}},{key:"beforeRender",value:function(e){Object(o.a)(Object(l.a)(i.prototype),"beforeRender",this).call(this,e),this.updateTexture(e.context)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:Object(y.b)()}}},{key:"setTransform",value:function(e){var t=Object(f.b)(this.transforms.dvs),i=e.toScreenNoRotation([0,0],[this.x,this.y]),n=Object(r.a)(i,2),a=n[0],s=n[1],o=this.resolution/this.pixelRatio/e.resolution,l=o*this.width,u=o*this.height,c=Math.PI*this.rotation/180;Object(f.c)(t,t,Object(v.b)(a,s)),Object(f.c)(t,t,Object(v.b)(l/2,u/2)),Object(f.k)(t,t,-c),Object(f.c)(t,t,Object(v.b)(-l/2,-u/2)),Object(f.h)(t,t,Object(v.b)(l,u)),Object(f.i)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"setSamplingProfile",value:function(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}},{key:"bind",value:function(e,t){this._texture&&e.bindTexture(this._texture,t)}},{key:"updateTexture",value:function(e){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(this._textureInvalidated){this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));var i,r=this.source;if(r){if(this._texture.resize(this.sourceWidth,this.sourceHeight),(i=r)&&"render"in i)if(r instanceof b.a){var n=r.getRenderedRasterPixels();this._texture.setData(Object(h.k)(n)?n.renderedRasterPixels:null)}else this._texture.setData(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(r));else(function(e){return e&&!("render"in e)})(r)&&this._texture.setData(r);this.ready()}else this._texture.setData(null)}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}}]),i}(d.a)},691:function(e,t,i){"use strict";function r(e){return"h"in e&&"s"in e&&"v"in e}function n(e){return"l"in e&&"a"in e&&"b"in e}function a(e){return"l"in e&&"c"in e&&"h"in e}function s(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return _}));var o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function u(e,t){var i,r,n=[];if(e[0].length!==t.length)throw"dimensions do not match";var a=e.length,s=e[0].length,o=0;for(i=0;i<a;i++){for(o=0,r=0;r<s;r++)o+=e[i][r]*t[r];n.push(o)}return n}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),i=u(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function h(e){var t=u(l,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function f(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function y(e){var t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function v(e){return f(c(e))}function p(e){return h(y(e))}function d(e){return function(e){var t=e.l,i=e.a,r=e.b,n=Math.sqrt(i*i+r*r),a=Math.atan2(r,i);return{l:t,c:n,h:a=a>0?a:a+2*Math.PI}}(f(c(e)))}function b(e){return h(y(function(e){var t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}function _(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:a(e)?b(e):n(e)?p(e):s(e)?h(e):r(e)?function(e){var t,i=(e.h+360)%360/60,r=e.s/100,n=e.v/100*255,a=n*r,s=a*(1-Math.abs(i%2-1));switch(Math.floor(i)){case 0:t={r:a,g:s,b:0};break;case 1:t={r:s,g:a,b:0};break;case 2:t={r:0,g:a,b:s};break;case 3:t={r:0,g:s,b:a};break;case 4:t={r:s,g:0,b:a};break;case 5:case 6:t={r:a,g:0,b:s};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+n-a),t.g=Math.round(t.g+n-a),t.b=Math.round(t.b+n-a),t}(e):e}function g(e){return r(e)?e:function(e){var t=e.r,i=e.g,r=e.b,n=Math.max(t,i,r),a=n-Math.min(t,i,r),s=n,o=0===a?0:n===t?(i-r)/a%6:n===i?(r-t)/a+2:(t-i)/a+4,l=0===a?0:a/s;return o<0&&(o+=6),{h:o*=60,s:l*=100,v:s*=100/255}}(_(e))}function m(e){return n(e)?e:v(_(e))}function O(e){return a(e)?e:d(_(e))}function k(e,t){var i=v(e);return i.l*=1-t,p(i)}},699:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(26),n=i(2),a=i(3),s=i(41),o=i(38),l=i(5),u=i(6),c=i(687),h=i(535),f=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return Object(a.a)(i,[{key:"requiresDedicatedFBO",get:function(){return this.children.some((function(e){return"additive"===e.blendFunction}))}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"bitmap",brushes:[c.a.bitmap],target:function(){return t.children},drawPhase:h.c.MAP});return[].concat(Object(r.a)(Object(s.a)(Object(o.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[n])}}]),i}(i(627).a)},742:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return c}));var r=Number.POSITIVE_INFINITY,n=Math.PI,a=2*n,s=128/n,o=n/180,l=1/Math.LN2;function u(e,t){return(e%=t)>=0?e:e+t}function c(e){return u(e*s,256)}function h(e){return Math.log(e)*l}function f(e,t,i){return e*(1-i)+t*i}},807:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(2),n=i(3),a=function(){function e(t){Object(r.a)(this,e),this._array=[],t<=0&&console.error("strideInBytes must be positive!"),this._stride=t}return Object(n.a)(e,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}},{key:"reset",value:function(){this.array.length=0}},{key:"toBuffer",value:function(){return new Uint32Array(this._array).buffer}}],[{key:"i1616to32",value:function(e,t){return 65535&e|t<<16}},{key:"i8888to32",value:function(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}},{key:"i8816to32",value:function(e,t,i){return 255&e|(255&t)<<8|i<<16}}]),e}()},852:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(13),n=i(2),a=i(3),s=i(884),o=function(){function e(t,i){var r=this;if(Object(n.a)(this,e),this._style=t,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,t.layers||(t.layers=[]),this.version=parseFloat(t.version),this.sprite=i?i.spriteUrl:t.sprite,this.glyphs=i?i.glyphsUrl:t.glyphs,this.layers=t.layers.map((function(e,t,i){return r._create(e,t,i)})),this.layers)for(var a,s=0;s<this.layers.length;s++)a=this.layers[s],this._layerByName[a.id.toLowerCase()]=a,this._uidToLayer.set(a.uid,a),0===a.type&&this.backgroundBucketIds.push(a.id);this._identifyRefLayers()}return Object(a.a)(e,[{key:"isPainterDataDriven",value:function(e){var t=this._layerByName[e.toLowerCase()];return!!t&&t.isPainterDataDriven()}},{key:"getStyleLayerId",value:function(e){return e>=this.layers.length?null:this.layers[e].id}},{key:"getStyleLayerByUID",value:function(e){var t=this._uidToLayer.get(e);return null!=t?t:null}},{key:"getStyleLayerIndex",value:function(e){var t=this._layerByName[e.toLowerCase()];return t?this.layers.indexOf(t):-1}},{key:"setStyleLayer",value:function(t,i){if(t&&t.id){var r=this._style;null!=i&&i>=this.layers.length&&(i=this.layers.length-1);var n,a=!0,s=this._layerByName[t.id.toLowerCase()];if(s){var o=this.layers.indexOf(s);i||(i=o),i===o?(a=!1,n=e._recreateLayer(t,s),this.layers[i]=n,r.layers[i]=t):(this.layers.splice(o,1),r.layers.splice(o,1),n=this._create(t,i,this.layers),this.layers.splice(i,0,n),r.layers.splice(i,0,t))}else n=this._create(t,i,this.layers),!i||i>=this.layers.length?(this.layers.push(n),r.layers.push(t)):(this.layers.splice(i,0,n),r.layers.splice(i,0,t));this._layerByName[t.id.toLowerCase()]=n,this._uidToLayer.set(n.uid,n),a&&this._recomputeZValues(),this._identifyRefLayers()}}},{key:"getStyleLayer",value:function(e){var t=this._layerByName[e.toLowerCase()];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}},{key:"deleteStyleLayer",value:function(e){var t=this._layerByName[e.toLowerCase()];if(t){delete this._layerByName[e.toLowerCase()],this._uidToLayer.delete(t.uid);var i=this.layers.indexOf(t);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}},{key:"getLayerById",value:function(e){return this._layerByName[e.toLowerCase()]}},{key:"getLayoutProperties",value:function(e){var t=this._layerByName[e.toLowerCase()];return t?t.layout:null}},{key:"getPaintProperties",value:function(e){var t=this._layerByName[e.toLowerCase()];return t?t.paint:null}},{key:"setPaintProperties",value:function(t,i){var r=this._layerByName[t.toLowerCase()];if(r){var n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:i},a=e._recreateLayer(n,r),s=this.layers.indexOf(r);this.layers[s]=a,this._style.layers[s].paint=i,this._layerByName[r.id.toLowerCase()]=a,this._uidToLayer.set(r.uid,a)}}},{key:"setLayoutProperties",value:function(t,i){var r=this._layerByName[t.toLowerCase()];if(r){var n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:i,paint:r.paint},a=e._recreateLayer(n,r),s=this.layers.indexOf(r);this.layers[s]=a,this._style.layers[s].layout=i,this._layerByName[r.id.toLowerCase()]=a,this._uidToLayer.set(r.uid,a)}}},{key:"setStyleLayerVisibility",value:function(t,i){var r=this._layerByName[t.toLowerCase()];if(r){var n=r.layout||{};n.visibility=i;var a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:n,paint:r.paint},s=e._recreateLayer(a,r),o=this.layers.indexOf(r);this.layers[o]=s,this._style.layers[o].layout=n,this._layerByName[r.id.toLowerCase()]=s,this._uidToLayer.set(r.uid,s)}}},{key:"getStyleLayerVisibility",value:function(e){var t,i=this._layerByName[e.toLowerCase()];if(!i)return"none";var r=i.layout;return null!=(t=null==r?void 0:r.visibility)?t:"visible"}},{key:"_recomputeZValues",value:function(){for(var e=this.layers,t=1/(e.length+1),i=0;i<e.length;i++)e[i].z=1-(1+i)*t}},{key:"_identifyRefLayers",value:function(){var e,t=[],i=[],n=0,a=Object(r.a)(this.layers);try{for(a.s();!(e=a.n()).done;){var s=e.value,o=s.layout;if(1===s.type){var l,u=s,c=s.source+"|"+s.sourceLayer;c+=null!=(l="|"+(null==o?void 0:o.visibility))?l:"",c+="|"+s.minzoom,c+="|"+s.maxzoom,c+="|"+JSON.stringify(s.filter),(u.hasDataDrivenFill||u.hasDataDrivenOutline)&&(c+="|"+n),t.push({key:c,layer:s})}else if(2===s.type){var h,f=s,y=s.source+"|"+s.sourceLayer;y+=null!=(h="|"+(null==o?void 0:o.visibility))?h:"",y+="|"+s.minzoom,y+="|"+s.maxzoom,y+="|"+JSON.stringify(s.filter),y+="|"+(void 0!==o?o["line-cap"]:""),y+="|"+(void 0!==o?o["line-join"]:""),f.hasDataDrivenLine&&(y+="|"+n),i.push({key:y,layer:s})}++n}}catch(v){a.e(v)}finally{a.f()}this._assignRefLayers(t),this._assignRefLayers(i)}},{key:"_assignRefLayers",value:function(e){var t,i;e.sort((function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}));for(var r=e.length,n=0;n<r;n++){var a=e[n];if(a.key===t)a.layer.refLayerId=i;else if(t=a.key,i=a.layer.id,1===a.layer.type){if(!a.layer.getPaintProperty("fill-outline-color"))for(var s=n+1;s<r;s++){var o=e[s];if(o.key!==t)break;if(o.layer.getPaintProperty("fill-outline-color")){e[n]=o,e[s]=a,i=o.layer.id;break}}}else if(2===a.layer.type)for(var l=a.layer,u=n+1;u<r;u++){var c=e[u];if(c.key!==t)break;var h=c.layer;(l.canUseThinTessellation&&!h.canUseThinTessellation||!l.canUseThinTessellation&&(h.getPaintProperty("line-pattern")||h.getPaintProperty("line-dasharray")))&&(l=h,e[n]=c,e[u]=a,i=c.layer.id)}}}},{key:"_create",value:function(e,t,i){var r=1-(1+t)*(1/(i.length+1)),n=this._runningId++;switch(e.type){case"background":return new s.a(0,e,r,n);case"fill":return new s.c(1,e,r,n);case"line":return new s.e(2,e,r,n);case"symbol":return new s.f(3,e,r,n);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new s.b(4,e,r,n)}throw new Error("Unknown vector tile layer")}}],[{key:"_recreateLayer",value:function(e,t){switch(e.type){case"background":return new s.a(0,e,t.z,t.uid);case"fill":return new s.c(1,e,t.z,t.uid);case"line":return new s.e(2,e,t.z,t.uid);case"symbol":return new s.f(3,e,t.z,t.uid);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new s.b(4,e,t.z,t.uid)}}}]),e}()},884:function(e,t,i){"use strict";i.d(t,"a",(function(){return Ue})),i.d(t,"b",(function(){return Ne})),i.d(t,"c",(function(){return Fe})),i.d(t,"d",(function(){return Ge})),i.d(t,"e",(function(){return He})),i.d(t,"f",(function(){return qe})),i.d(t,"g",(function(){return Ye}));var r=i(5),n=i(6),a=i(13),s=i(2),o=i(3),l=i(10),u=i(7),c=i(807),h=function(){function e(t){Object(s.a)(this,e),this._locations=new Map,this._key=t}return Object(o.a)(e,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return 7&this._key}},{key:"defines",value:function(){return[]}},{key:"getStride",value:function(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}},{key:"getAttributeLocations",value:function(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}},{key:"getLayoutInfo",value:function(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}},{key:"getEncodingInfos",value:function(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}},{key:"getUniforms",value:function(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}},{key:"getShaderHeader",value:function(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}},{key:"getShaderMain",value:function(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}},{key:"setDataUniforms",value:function(e,t,i,r,n){var s,o=this.getUniforms(),l=Object(a.a)(o);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=u.name,h=u.type,f=(0,u.getValue)(i,t,r,n);if(null!==f)switch(h){case"float":e.setUniform1f(c,f);break;case"vec2":e.setUniform2fv(c,f);break;case"vec4":e.setUniform4fv(c,f)}}}catch(y){l.e(y)}finally{l.f()}}},{key:"encodeAttributes",value:function(e,t,i,r){for(var n=this.attributesInfo(),s=this.getEncodingInfos(),o=[],l=0,u=0,c=0,h=Object.keys(s);c<h.length;c++){var f,y,v=h[c],p=s[v],d=n[v],b=d.type,_=d.precisionFactor,g=d.isLayout?i.getLayoutProperty(v):i.getPaintProperty(v),m=null==(f=g.interpolator)?void 0:f.getInterpolationRange(t),O=0,k=Object(a.a)(p);try{for(k.s();!(y=k.n()).done;){var x=y.value,w=x.offset,j=x.bufferElementsToAdd;if(j>0){for(var P=0;P<j;P++)o.push(0);l+=u,u=x.bufferElementsToAdd}var S=null!=r?r:g.getValue(m?m[O]:t,e);switch(b){case 0:case 1:o[l]|=this._encodeByte(S*(_||1),8*w);break;case 2:case 3:o[l]|=this._encodeShort(S*(_||1),8*w);break;case 4:case 5:o[l]|=this._encodeByte(S*(_||1),8*w),o[l]|=this._encodeByte(S*(_||1),8*w+8);break;case 6:case 7:o[l]|=this._encodeShort(S*(_||1),8*w),o[l]|=this._encodeShort(S*(_||1),8*w+16);break;case 8:case 9:o[l]|=this._encodeByte(S*(_||1),8*w),o[l]|=this._encodeByte(S*(_||1),8*w+8),o[l]|=this._encodeByte(S*(_||1),8*w+16),o[l]|=this._encodeByte(S*(_||1),8*w+24);break;case 10:o[l]=this._encodeColor(S);break;case 11:case 12:this._encodePattern(l,o,S);break;default:throw new Error("Unsupported encoding type")}O++}}catch(M){k.e(M)}finally{k.f()}}return o}},{key:"getAtributeState",value:function(e){var t=0,i=3+2*e;return t|=this._bit(i),t|=this._bit(i+1)<<1}},{key:"_buildAttributesInfo",value:function(){var t,i=[],r={},n={},s=-1,o=this.attributesInfo(),l=this.attributes(),u=-1,c=Object(a.a)(l);try{for(c.s();!(t=c.n()).done;){var h=t.value;u++;var f=this.getAtributeState(u);if(0!==f&&3!==f){var y=o[h],v=[];r[h]=v;for(var p=y.type,d=0;d<f;d++){var b=e._encodingInfo[p],_=b.dataType,g=b.bytesPerElement,m=b.count,O=b.normalized,k=g*m,x=n[_],w=0;if(!x||x.count+m>4)x={dataIndex:++s,count:0,offset:0},4!==m&&(n[_]=x),i.push({location:-1,name:"a_data_"+s,count:m,type:_,normalized:O}),w=Math.ceil(Math.max(k/4,1));else{var j=i[x.dataIndex];j.count+=m,w=Math.ceil(Math.max(j.count*g/4,1))-Math.ceil(Math.max(x.offset/4,1))}v.push({dataIndex:x.dataIndex,offset:x.offset,bufferElementsToAdd:w}),x.offset+=k,x.count+=m}}}}catch(B){c.e(B)}finally{c.f()}for(var P=0,S=i;P<S.length;P++){var M=S[P];switch(M.type){case 5120:case 5121:M.count=4;case 5122:case 5123:M.count+=M.count%2}}this._buildVertexBufferLayout(i);var I,T=0,C=this._layoutInfo.geometry,L=Object(a.a)(C);try{for(L.s();!(I=L.n()).done;){var D=I.value;this._locations.set(D.name,T++)}}catch(B){L.e(B)}finally{L.f()}var A=this._layoutInfo.opacity;if(A){var R,E=Object(a.a)(A);try{for(E.s();!(R=E.n()).done;){var z=R.value;this._locations.set(z.name,T++)}}catch(B){E.e(B)}finally{E.f()}}this._buildShaderInfo(i,r),this._propertyEncodingInfo=r}},{key:"_buildVertexBufferLayout",value:function(e){var t={},i=this.geometryInfo(),r=i[0].stride;if(0===e.length)t.geometry=i;else{var n,s=[],o=r,u=Object(a.a)(e);try{for(u.s();!(n=u.n()).done;){var c=n.value;r+=f(c.type)*c.count}}catch(g){u.e(g)}finally{u.f()}var h,y=Object(a.a)(i);try{for(y.s();!(h=y.n()).done;){var v=h.value,p=Object(l.a)({},v);p.stride=r,s.push(p)}}catch(g){y.e(g)}finally{y.f()}var d,b=Object(a.a)(e);try{for(b.s();!(d=b.n()).done;){var _=d.value;s.push({name:_.name,count:_.count,type:_.type,offset:o,stride:r,normalized:_.normalized||!1,divisor:0}),o+=f(_.type)*_.count}}catch(g){b.e(g)}finally{b.f()}t.geometry=s}this.opacityInfo()&&(t.opacity=this.opacityInfo()),this._layoutInfo=t,this._stride=r}},{key:"_buildShaderInfo",value:function(t,i){var r,n=this,s="\n",o="\n",l=[],c=Object(a.a)(t);try{for(c.s();!(r=c.n()).done;){var h=r.value;s+="attribute ".concat(this._getType(h.count)," ").concat(h.name,";\n")}}catch(g){c.e(g)}finally{c.f()}var f,v=this.attributes(),p=this.attributesInfo(),d=-1,b=Object(a.a)(v);try{var _=function(){var t=f.value;d++;var r=p[t],a=r.name,c=r.type,h=r.precisionFactor,v=r.isLayout,b=h&&1!==h?" * "+1/h:"",_=e._encodingInfo[c],g=_.bytesPerElement,m=_.count,O=function(e){return"a_data_".concat(e.dataIndex).concat(y(m,e.offset,g))};switch(n.getAtributeState(d)){case 0:var k=n._getType(m),x="u_".concat(a);l.push({name:x,type:k,getValue:function(e,i,r,n){var a=v?e.getLayoutValue(t,i):e.getPaintValue(t,i);if(11===c){var s=e.getDashKey(a,e.getLayoutValue("line-cap",i)),o=n.getMosaicItemPosition(s,!1);if(Object(u.j)(o))return null;var l=o.tl,h=o.br;return[l[0],h[1],h[0],l[1]]}if(12===c){var f=n.getMosaicItemPosition(a,-1===t.indexOf("line-"));if(Object(u.j)(f))return null;var y=f.tl,p=f.br;return[y[0],p[1],p[0],y[1]]}if(10===c){var d=a[3];return[d*a[0],d*a[1],d*a[2],d]}return a}}),s+="uniform ".concat(k," ").concat(x,";\n"),o+="".concat(k," ").concat(a," = ").concat(x,";\n");break;case 1:var w=O(i[t][0]);o+="".concat(n._getType(m)," ").concat(a," = ").concat(w).concat(b,";\n");break;case 2:var j="u_t_".concat(a);l.push({name:j,type:"float",getValue:function(e,i,r,n){return(v?e.getLayoutProperty(t):e.getPaintProperty(t)).interpolator.interpolationUniformValue(r,i)}}),s+="uniform float ".concat(j,";\n");var P=O(i[t][0]),S=O(i[t][1]);o+="".concat(n._getType(m)," ").concat(a," = mix(").concat(P).concat(b,", ").concat(S).concat(b,", ").concat(j,");\n")}};for(b.s();!(f=b.n()).done;)_()}catch(g){b.e(g)}finally{b.f()}this._shaderHeader=s,this._shaderMain=o,this._uniforms=l}},{key:"_bit",value:function(e){return(this._key&1<<e)>>e}},{key:"_getType",value:function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}},{key:"_encodeColor",value:function(e){var t=255*e[3];return c.a.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}},{key:"_encodePattern",value:function(e,t,i){if(i&&i.rect){var r=i.rect,n=i.width,a=i.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+a,16),t[e+1]=this._encodeShort(r.x+2+n,0),t[e+1]|=this._encodeShort(r.y+2,16)}}},{key:"_encodeByte",value:function(e,t){return(255&e)<<t}},{key:"_encodeShort",value:function(e,t){return(65535&e)<<t}}]),e}();h._encodingInfo={0:{dataType:5120,bytesPerElement:1,count:1,normalized:!1},1:{dataType:5121,bytesPerElement:1,count:1,normalized:!1},2:{dataType:5122,bytesPerElement:2,count:1,normalized:!1},3:{dataType:5123,bytesPerElement:2,count:1,normalized:!1},4:{dataType:5120,bytesPerElement:1,count:2,normalized:!1},5:{dataType:5121,bytesPerElement:1,count:2,normalized:!1},6:{dataType:5122,bytesPerElement:2,count:2,normalized:!1},7:{dataType:5123,bytesPerElement:2,count:2,normalized:!1},8:{dataType:5120,bytesPerElement:1,count:4,normalized:!1},9:{dataType:5121,bytesPerElement:1,count:4,normalized:!1},10:{dataType:5121,bytesPerElement:1,count:4,normalized:!0},11:{dataType:5123,bytesPerElement:2,count:4,normalized:!1},12:{dataType:5123,bytesPerElement:2,count:4,normalized:!1}};var f=function(e){switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1}},y=function(e,t,i){var r=t/i;if(1===e)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(r){case 0:return".xyz";case 1:return".yzw"}return""},v=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return i.GEOMETRY_LAYOUT}},{key:"opacityInfo",value:function(){return null}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);v.ATTRIBUTES=[],v.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}],v.ATTRIBUTES_INFO={};var p=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return i.GEOMETRY_LAYOUT}},{key:"opacityInfo",value:function(){return null}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);p.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],p.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],p.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}};var d=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return i.GEOMETRY_LAYOUT}},{key:"opacityInfo",value:function(){return null}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);d.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],d.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],d.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}};var b=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r){var n;return Object(s.a)(this,i),(n=t.call(this,e)).usefillColor=r,n}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return i.GEOMETRY_LAYOUT}},{key:"opacityInfo",value:function(){return null}},{key:"attributes",value:function(){return this.usefillColor?i.ATTRIBUTES_FILL:i.ATTRIBUTES_OUTLINE}},{key:"attributesInfo",value:function(){return this.usefillColor?i.ATTRIBUTES_INFO_FILL:i.ATTRIBUTES_INFO_OUTLINE}}]),i}(h);b.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],b.ATTRIBUTES_FILL=["fill-color","fill-opacity"],b.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}],b.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}},b.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};var _=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return i.GEOMETRY_LAYOUT}},{key:"opacityInfo",value:function(){return null}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);_.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],_.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_extrude_offset",count:4,type:5120,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_dir_normal",count:4,type:5120,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:12,stride:16,normalized:!1,divisor:0}],_.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}};var g=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],m=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}],O=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return g}},{key:"opacityInfo",value:function(){return m}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);O.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],O.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}};var k=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e){return Object(s.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"geometryInfo",value:function(){return g}},{key:"opacityInfo",value:function(){return m}},{key:"attributes",value:function(){return i.ATTRIBUTES}},{key:"attributesInfo",value:function(){return i.ATTRIBUTES_INFO}}]),i}(h);k.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],k.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}};var x=i(26),w=i(40),j=i(691),P=i(294),S=i(742),M={kind:"null"},I={kind:"number"},T={kind:"string"},C={kind:"boolean"},L={kind:"color"},D={kind:"object"},A={kind:"value"};function R(e,t){return{kind:"array",itemType:e,n:t}}var E=[M,I,T,C,L,D,R(A)];function z(e){if("array"===e.kind){var t=z(e.itemType);return"number"==typeof e.n?"array<".concat(t,", ").concat(e.n,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}function B(e){if(null===e)return M;if("string"==typeof e)return T;if("boolean"==typeof e)return C;if("number"==typeof e)return I;if(e instanceof w.a)return L;if(Array.isArray(e)){var t,i,r=Object(a.a)(e);try{for(r.s();!(i=r.n()).done;){var n=B(i.value);if(t){if(t!==n){t=A;break}}else t=n}}catch(s){r.e(s)}finally{r.f()}return R(t||A,e.length)}return"object"==typeof e?D:A}function V(e,t){if("array"===t.kind)return"array"===e.kind&&(0===e.n&&"value"===e.itemType.kind||V(e.itemType,t.itemType))&&("number"!=typeof t.n||t.n===e.n);if("value"===t.kind){var i,r=Object(a.a)(E);try{for(r.s();!(i=r.n()).done;){if(V(e,i.value))return!0}}catch(n){r.e(n)}finally{r.f()}}return t.kind===e.kind}function U(e){if(null===e)return"";var t=typeof e;return"string"===t?e:"number"===t||"boolean"===t?String(e):e instanceof w.a?e.toString():JSON.stringify(e)}var F=function(){function e(t){Object(s.a)(this,e),this.parent=t,this.vars={}}return Object(o.a)(e,[{key:"add",value:function(e,t){this.vars[e]=t}},{key:"get",value:function(e){return this.vars[e]?this.vars[e]:this.parent?this.parent.get(e):null}}]),e}(),H=function(){function e(){Object(s.a)(this,e),this.type=A}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return null==e?void 0:e.id}}],[{key:"parse",value:function(t){if(t.length>1)throw new Error('"id" does not expect arguments');return new e}}]),e}(),q=function(){function e(){Object(s.a)(this,e),this.type=T}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){if(!e)return null;switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}],[{key:"parse",value:function(t){if(t.length>1)throw new Error('"geometry-type" does not expect arguments');return new e}}]),e}(),N=function(){function e(){Object(s.a)(this,e),this.type=D}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return null==e?void 0:e.values}}],[{key:"parse",value:function(t){if(t.length>1)throw new Error('"properties" does not expect arguments');return new e}}]),e}(),G=function(){function e(){Object(s.a)(this,e),this.type=I}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return t}}],[{key:"parse",value:function(t){if(t.length>1)throw new Error('"zoom" does not expect arguments');return new e}}]),e}(),Y=function(){function e(t,i,r){Object(s.a)(this,e),this.lhs=t,this.rhs=i,this.compare=r,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.compare(this.lhs.evaluate(e,t),this.rhs.evaluate(e,t))}}],[{key:"parse",value:function(t,i,r){if(3!==t.length&&4!==t.length)throw new Error('"'.concat(t[0],'" expects 2 or 3 arguments'));if(4===t.length)throw new Error('"'.concat(t[0],'" collator not supported'));return new e(De(t[1],i),De(t[2],i),r)}}]),e}(),X=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e===t}))}}]),i}(Y),W=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e!==t}))}}]),i}(Y),J=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e<t}))}}]),i}(Y),Q=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e<=t}))}}]),i}(Y),K=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e>t}))}}]),i}(Y),Z=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return Y.parse(e,t,(function(e,t){return e>=t}))}}]),i}(Y),$=function(){function e(t){Object(s.a)(this,e),this.arg=t,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return!this.arg.evaluate(e,t)}}],[{key:"parse",value:function(t,i){if(2!==t.length)throw new Error('"!" expects 1 argument');return new e(De(t[1],i))}}]),e}(),ee=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r=Object(a.a)(this.args);try{for(r.s();!(i=r.n()).done;){if(!i.value.evaluate(e,t))return!1}}catch(n){r.e(n)}finally{r.f()}return!0}}],[{key:"parse",value:function(t,i){for(var r=[],n=1;n<t.length;n++)r.push(De(t[n],i));return new e(r)}}]),e}(),te=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r=Object(a.a)(this.args);try{for(r.s();!(i=r.n()).done;){if(i.value.evaluate(e,t))return!0}}catch(n){r.e(n)}finally{r.f()}return!1}}],[{key:"parse",value:function(t,i){for(var r=[],n=1;n<t.length;n++)r.push(De(t[n],i));return new e(r)}}]),e}(),ie=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r=Object(a.a)(this.args);try{for(r.s();!(i=r.n()).done;){if(i.value.evaluate(e,t))return!1}}catch(n){r.e(n)}finally{r.f()}return!0}}],[{key:"parse",value:function(t,i){for(var r=[],n=1;n<t.length;n++)r.push(De(t[n],i));return new e(r)}}]),e}(),re=function(){function e(t,i,r){Object(s.a)(this,e),this.type=t,this.args=i,this.fallback=r}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r=Object(a.a)(this.args);try{for(r.s();!(i=r.n()).done;){var n=i.value;if(n.condition.evaluate(e,t))return n.output.evaluate(e,t)}}catch(s){r.e(s)}finally{r.f()}return this.fallback.evaluate(e,t)}}],[{key:"parse",value:function(t,i,r){if(t.length<4)throw new Error('"case" expects at least 3 arguments');if(t.length%2==1)throw new Error('"case" expects an odd number of arguments');for(var n,a=[],s=1;s<t.length-1;s+=2){var o=De(t[s],i),l=De(t[s+1],i,r);n||(n=l.type),a.push({condition:o,output:l})}var u=De(t[t.length-1],i,r);return n||(n=u.type),new e(n,a,u)}}]),e}(),ne=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.args=i}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r=Object(a.a)(this.args);try{for(r.s();!(i=r.n()).done;){var n=i.value.evaluate(e,t);if(null!==n)return n}}catch(s){r.e(s)}finally{r.f()}return null}}],[{key:"parse",value:function(t,i){if(t.length<2)throw new Error('"coalesce" expects at least 1 argument');for(var r,n=[],a=1;a<t.length;a++){var s=De(t[a],i);r||(r=s.type),n.push(s)}return new e(r,n)}}]),e}(),ae=function(){function e(t,i,r,n,a){Object(s.a)(this,e),this.type=t,this.input=i,this.labels=r,this.outputs=n,this.fallback=a}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.input.evaluate(e,t);return(this.outputs[this.labels[i]]||this.fallback).evaluate(e,t)}}],[{key:"parse",value:function(t,i){if(t.length<3)throw new Error('"match" expects at least 3 arguments');if(t.length%2==0)throw new Error('"case" expects an even number of arguments');for(var r,n,s=De(t[1],i),o=[],l={},u=2;u<t.length-1;u+=2){var c=t[u];Array.isArray(c)||(c=[c]);var h,f=Object(a.a)(c);try{for(f.s();!(h=f.n()).done;){var y=h.value,v=typeof y;if("string"!==v&&"number"!==v)throw new Error('"match" requires string or number literal as labels');if(n){if(v!==n)throw new Error('"match" requires labels to have the same type')}else n=v;l[y]=o.length}}catch(d){f.e(d)}finally{f.f()}var p=De(t[u+1],i);r||(r=p.type),o.push(p)}return new e(r,s,l,o,De(t[t.length-1],i))}}]),e}(),se=function(){function e(t,i,r,n,a){Object(s.a)(this,e),this.operator=t,this.type=i,this.interpolation=r,this.input=n,this.stops=a}return Object(o.a)(e,[{key:"evaluate",value:function(t,i){var r=this.stops;if(1===r.length)return r[0][1].evaluate(t,i);var n=this.input.evaluate(t,i);if(n<=r[0][0])return r[0][1].evaluate(t,i);if(n>=r[r.length-1][0])return r[r.length-1][1].evaluate(t,i);for(var a=0;++a<r.length&&!(n<r[a][0]););var s=r[a-1][0],o=r[a][0],u=e.interpolationRatio(this.interpolation,n,s,o),c=r[a-1][1].evaluate(t,i),h=r[a][1].evaluate(t,i);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(c)&&Array.isArray(h))return c.map((function(e,t){return Object(S.e)(e,h[t],u)}));if("color"===this.type.kind&&c instanceof w.a&&h instanceof w.a){var f=new w.a(c),y=new w.a(h);return new w.a([Object(S.e)(f.r,y.r,u),Object(S.e)(f.g,y.g,u),Object(S.e)(f.b,y.b,u),Object(S.e)(f.a,y.a,u)])}if("number"===this.type.kind&&"number"==typeof c&&"number"==typeof h)return Object(S.e)(c,h,u);throw new Error('"'.concat(this.operator,'" cannot interpolate type ').concat(z(this.type)))}if("interpolate-hcl"===this.operator){var v=Object(j.d)(c),p=Object(j.d)(h),d=p.h-v.h,b=Object(j.e)({h:v.h+u*(d>180||d<-180?d-360*Math.round(d/360):d),c:Object(S.e)(v.c,p.c,u),l:Object(S.e)(v.l,p.l,u)});return new w.a(Object(l.a)({a:Object(S.e)(c.a,h.a,u)},b))}if("interpolate-lab"===this.operator){var _=Object(j.c)(c),g=Object(j.c)(h),m=Object(j.e)({l:Object(S.e)(_.l,g.l,u),a:Object(S.e)(_.a,g.a,u),b:Object(S.e)(_.b,g.b,u)});return new w.a(Object(l.a)({a:Object(S.e)(c.a,h.a,u)},m))}throw new Error('Unexpected operator "'.concat(this.operator,'"'))}},{key:"interpolationUniformValue",value:function(t,i){var r=this.stops;if(1===r.length)return 0;if(t>=r[r.length-1][0])return 0;for(var n=0;++n<r.length&&!(t<r[n][0]););var a=r[n-1][0],s=r[n][0];return e.interpolationRatio(this.interpolation,i,a,s)}},{key:"getInterpolationRange",value:function(e){var t=this.stops;if(1===t.length){var i=t[0][0];return[i,i]}var r=t[t.length-1][0];if(e>=r)return[r,r];for(var n=0;++n<t.length&&!(e<t[n][0]););return[t[n-1][0],t[n][0]]}}],[{key:"parse",value:function(t,i,r){var n=t[0];if(t.length<5)throw new Error('"'.concat(n,'" expects at least 4 arguments'));var a=t[1];if(!Array.isArray(a)||0===a.length)throw new Error('"'.concat(a,'" is not a valid interpolation'));switch(a[0]){case"linear":if(1!==a.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==a.length||"number"!=typeof a[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==a.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var s=1;s<5;s++){var o=a[s];if("number"!=typeof o||o<0||o>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error('"'.concat(t[0],'" unknown interpolation type "').concat(a[0],'"'))}if(t.length%2!=1)throw new Error('"'.concat(n,'" expects an even number of arguments'));var l,u=De(t[2],i,I);"interpolate-hcl"===n||"interpolate-lab"===n?l=L:r&&"value"!==r.kind&&(l=r);for(var c=[],h=3;h<t.length;h+=2){var f=t[h];if("number"!=typeof f)throw new Error('"'.concat(n,'" requires stop inputs as literal numbers'));if(c.length&&c[c.length-1][0]>=f)throw new Error('"'.concat(n,'" requires strictly ascending stop inputs'));var y=De(t[h+1],i,l);l||(l=y.type),c.push([f,y])}if(l&&l!==L&&l!==I&&("array"!==l.kind||l.itemType!==I))throw new Error('"'.concat(n,'" cannot interpolate type ').concat(z(l)));return new e(n,l,a,u,c)}},{key:"interpolationRatio",value:function(t,i,r,n){var a=0;return"linear"===t[0]?a=e.exponentialInterpolationRatio(i,1,r,n):"exponential"===t[0]?a=e.exponentialInterpolationRatio(i,t[1],r,n):"cubic-bezier"===t[0]&&(a=Object(P.c)(t[1],t[2],t[3],t[4])(e.exponentialInterpolationRatio(i,1,r,n),1e-5)),a<0?a=0:a>1&&(a=1),a}},{key:"exponentialInterpolationRatio",value:function(e,t,i,r){var n=r-i;if(0===n)return 0;var a=e-i;return 1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}}]),e}(),oe=function(){function e(t,i,r){Object(s.a)(this,e),this.type=t,this.input=i,this.stops=r}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.stops;if(1===i.length)return i[0][1].evaluate(e,t);for(var r=this.input.evaluate(e,t),n=0;++n<i.length&&!(r<i[n][0]););return this.stops[n-1][1].evaluate(e,t)}}],[{key:"parse",value:function(t,i){if(t.length<5)throw new Error('"step" expects at least 4 arguments');if(t.length%2!=1)throw new Error('"step" expects an even number of arguments');var r,n=De(t[1],i,I),a=[];a.push([-1/0,De(t[2],i)]);for(var s=3;s<t.length;s+=2){var o=t[s];if("number"!=typeof o)throw new Error('"step" requires stop inputs as literal numbers');if(a.length&&a[a.length-1][0]>=o)throw new Error('"step" requires strictly ascending stop inputs');var l=De(t[s+1],i);r||(r=l.type),a.push([o,l])}return new e(r,n,a)}}]),e}(),le=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.output=i}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.output.evaluate(e,t)}}],[{key:"parse",value:function(t,i,r){if(t.length<4)throw new Error('"let" expects at least 3 arguments');if(t.length%2==1)throw new Error('"let" expects an odd number of arguments');for(var n=new F(i),a=1;a<t.length-1;a+=2){var s=t[a];if("string"!=typeof s)throw new Error('"let" requires a string to define variable names - found '.concat(s));n.add(s,De(t[a+1],i))}var o=De(t[t.length-1],n,r);return new e(o.type,o)}}]),e}(),ue=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.output=i}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.output.evaluate(e,t)}}],[{key:"parse",value:function(t,i,r){if(2!==t.length||"string"!=typeof t[1])throw new Error('"var" requires just one literal string argument');var n=i.get(t[1]);if(!n)throw new Error("".concat(t[1],' must be defined before being used in a "var" expression'));return new e(r||A,n)}}]),e}(),ce=function(){function e(t,i,r){Object(s.a)(this,e),this.type=t,this.index=i,this.array=r}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.index.evaluate(e,t),r=this.array.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return r[i]}}],[{key:"parse",value:function(t,i){if(3!==t.length)throw new Error('"at" expects 2 arguments');var r=De(t[1],i,I),n=De(t[2],i);return new e(n.type.itemType,r,n)}}]),e}(),he=function(){function e(t,i){Object(s.a)(this,e),this.key=t,this.obj=i,this.type=A}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.key.evaluate(e,t);return this.obj?this.obj.evaluate(e,t)[i]:null==e?void 0:e.values[i]}}],[{key:"parse",value:function(t,i){switch(t.length){case 2:return new e(De(t[1],i));case 3:return new e(De(t[1],i),De(t[2],i));default:throw new Error('"get" expects 1 or 2 arguments')}}}]),e}(),fe=function(){function e(t,i){Object(s.a)(this,e),this.key=t,this.obj=i,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.key.evaluate(e,t);return this.obj?i in this.obj.evaluate(e,t):!(null==e||!e.values[i])}}],[{key:"parse",value:function(t,i){switch(t.length){case 2:return new e(De(t[1],i));case 3:return new e(De(t[1],i),De(t[2],i));default:throw new Error('"has" expects 1 or 2 arguments')}}}]),e}(),ye=function(){function e(t,i){Object(s.a)(this,e),this.key=t,this.vals=i,this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.key.evaluate(e,t);return-1!==this.vals.evaluate(e,t).indexOf(i)}}],[{key:"parse",value:function(t,i){if(3!==t.length)throw new Error('"in" expects 2 arguments');return new e(De(t[1],i),De(t[2],i))}}]),e}(),ve=function(){function e(t,i,r){Object(s.a)(this,e),this.item=t,this.array=i,this.from=r,this.type=I}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.item.evaluate(e,t),r=this.array.evaluate(e,t);if(this.from){var n=this.from.evaluate(e,t);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return r.indexOf(i,n)}return r.indexOf(i)}}],[{key:"parse",value:function(t,i){if(t.length<3||t.length>4)throw new Error('"index-of" expects 3 or 4 arguments');var r=De(t[1],i),n=De(t[2],i);return 4===t.length?new e(r,n,De(t[3],i,I)):new e(r,n)}}]),e}(),pe=function(){function e(t){Object(s.a)(this,e),this.arg=t,this.type=I}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.arg.evaluate(e,t);if("string"==typeof i)return i.length;if(Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}],[{key:"parse",value:function(t,i){if(2!==t.length)throw new Error('"length" expects 2 arguments');return new e(De(t[1],i))}}]),e}(),de=function(){function e(t,i,r,n){Object(s.a)(this,e),this.type=t,this.array=i,this.from=r,this.to=n}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this.array.evaluate(e,t);if(!Array.isArray(i)&&"string"!=typeof i)throw new Error('"slice" input must be an array or a string');var r=this.from.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"slice" index out of bounds');if(r!==Math.floor(r))throw new Error('"slice" index must be an integer');if(this.to){var n=this.to.evaluate(e,t);if(n<0||n>=i.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return i.slice(r,n)}return i.slice(r)}}],[{key:"parse",value:function(t,i){if(t.length<3||t.length>4)throw new Error('"slice" expects 2 or 3 arguments');var r=De(t[1],i),n=De(t[2],i,I);if(n.type!==I)throw new Error('"slice" index must return a number');if(4===t.length){var a=De(t[3],i,I);if(a.type!==I)throw new Error('"slice" index must return a number');return new e(r.type,r,n,a)}return new e(r.type,r,n)}}]),e}(),be=function(){function e(){Object(s.a)(this,e),this.type=C}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return e&&void 0!==e.id}}],[{key:"parse",value:function(t){if(1!==t.length)throw new Error('"has-id" expects no arguments');return new e}}]),e}(),_e=function(){function e(t,i){Object(s.a)(this,e),this.args=t,this.calculate=i,this.type=I}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i;return this.args&&(i=this.args.map((function(i){return i.evaluate(e,t)}))),this.calculate(i)}}],[{key:"parse",value:function(t,i,r){return new e(t.slice(1).map((function(e){return De(e,i)})),r)}}]),e}(),ge=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){switch(e.length){case 2:return _e.parse(e,t,(function(e){return-e[0]}));case 3:return _e.parse(e,t,(function(e){return e[0]-e[1]}));default:throw new Error('"-" expects 1 or 2 arguments')}}}]),i}(_e),me=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return _e.parse(e,t,(function(e){var t,i=1,r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){i*=t.value}}catch(n){r.e(n)}finally{r.f()}return i}))}}]),i}(_e),Oe=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){if(3===e.length)return _e.parse(e,t,(function(e){return e[0]/e[1]}));throw new Error('"/" expects 2 arguments')}}]),i}(_e),ke=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){if(3===e.length)return _e.parse(e,t,(function(e){return e[0]%e[1]}));throw new Error('"%" expects 2 arguments')}}]),i}(_e),xe=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){if(3===e.length)return _e.parse(e,t,(function(e){return Math.pow(e[0],e[1])}));throw new Error('"^" expects 1 or 2 arguments')}}]),i}(_e),we=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,null,[{key:"parse",value:function(e,t){return _e.parse(e,t,(function(e){var t,i=0,r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){i+=t.value}}catch(n){r.e(n)}finally{r.f()}return i}))}}]),i}(_e),je=function(){function e(t,i){Object(s.a)(this,e),this.args=t,this.calculate=i,this.type=I}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i;return this.args&&(i=this.args.map((function(i){return i.evaluate(e,t)}))),this.calculate(i)}}],[{key:"parse",value:function(t,i){return new e(t.slice(1).map((function(e){return De(e,i)})),e.ops[t[0]])}}]),e}();je.ops={abs:function(e){return Math.abs(e[0])},acos:function(e){return Math.acos(e[0])},asin:function(e){return Math.asin(e[0])},atan:function(e){return Math.atan(e[0])},ceil:function(e){return Math.ceil(e[0])},cos:function(e){return Math.cos(e[0])},e:function(){return Math.E},floor:function(e){return Math.floor(e[0])},ln:function(e){return Math.log(e[0])},ln2:function(){return Math.LN2},log10:function(e){return Math.log(e[0])/Math.LN10},log2:function(e){return Math.log(e[0])/Math.LN2},max:function(e){return Math.max.apply(Math,Object(x.a)(e))},min:function(e){return Math.min.apply(Math,Object(x.a)(e))},pi:function(){return Math.PI},round:function(e){return Math.round(e[0])},sin:function(e){return Math.sin(e[0])},sqrt:function(e){return Math.sqrt(e[0])},tan:function(e){return Math.tan(e[0])}};var Pe=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=T}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.args.map((function(i){return i.evaluate(e,t)})).join("")}}],[{key:"parse",value:function(t,i){return new e(t.slice(1).map((function(e){return De(e,i)})))}}]),e}(),Se=function(){function e(t,i){Object(s.a)(this,e),this.arg=t,this.calculate=i,this.type=T}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.calculate(this.arg.evaluate(e,t))}}],[{key:"parse",value:function(t,i){if(2!==t.length)throw new Error("".concat(t[0]," expects 1 argument"));return new e(De(t[1],i),e.ops[t[0]])}}]),e}();Se.ops={downcase:function(e){return e.toLowerCase()},upcase:function(e){return e.toUpperCase()}};var Me=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=L}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this._validate(this.args[0].evaluate(e,t)),r=this._validate(this.args[1].evaluate(e,t)),n=this._validate(this.args[2].evaluate(e,t));return new w.a({r:i,g:r,b:n})}},{key:"_validate",value:function(e){if("number"!=typeof e||e<0||e>255)throw new Error("".concat(e,": invalid color component"));return Math.round(e)}}],[{key:"parse",value:function(t,i){if(4!==t.length)throw new Error('"rgb" expects 3 arguments');return new e(t.slice(1).map((function(e){return De(e,i)})))}}]),e}(),Ie=function(){function e(t){Object(s.a)(this,e),this.args=t,this.type=L}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i=this._validate(this.args[0].evaluate(e,t)),r=this._validate(this.args[1].evaluate(e,t)),n=this._validate(this.args[2].evaluate(e,t)),a=this._validateAlpha(this.args[3].evaluate(e,t));return new w.a({r:i,g:r,b:n,a:a})}},{key:"_validate",value:function(e){if("number"!=typeof e||e<0||e>255)throw new Error("".concat(e,": invalid color component"));return Math.round(e)}},{key:"_validateAlpha",value:function(e){if("number"!=typeof e||e<0||e>1)throw new Error("".concat(e,": invalid alpha color component"));return e}}],[{key:"parse",value:function(t,i){if(5!==t.length)throw new Error('"rgba" expects 4 arguments');return new e(t.slice(1).map((function(e){return De(e,i)})))}}]),e}(),Te=function(){function e(t){Object(s.a)(this,e),this.color=t,this.type=R(I,4)}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return new w.a(this.color.evaluate(e,t)).toRgba()}}],[{key:"parse",value:function(t,i){if(2!==t.length)throw new Error('"to-rgba" expects 1 argument');return new e(De(t[1],i))}}]),e}(),Ce=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.args=i}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){var i,r,n=Object(a.a)(this.args);try{for(n.s();!(r=n.n()).done;){var s=r.value.evaluate(e,t);if(V(i=B(s),this.type))return s}}catch(o){n.e(o)}finally{n.f()}throw new Error("Expected ".concat(z(this.type)," but got ").concat(z(i)))}}],[{key:"parse",value:function(t,i){var r=t[0];if(t.length<2)throw new Error("".concat(r," expects at least one argument"));var n,a=1;if("array"===r){if(t.length>2){switch(t[1]){case"string":n=T;break;case"number":n=I;break;case"boolean":n=C;break;default:throw new Error('"array" type argument must be string, number or boolean')}a++}else n=A;var s;if(t.length>3){if(null!==(s=t[2])&&("number"!=typeof s||s<0||s!==Math.floor(s)))throw new Error('"array" length argument must be a positive integer literal');a++}n=R(n,s)}else switch(r){case"string":n=T;break;case"number":n=I;break;case"boolean":n=C;break;case"object":n=D}for(var o=[];a<t.length;a++){var l=De(t[a],i);o.push(l)}return new e(n,o)}}]),e}(),Le=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.args=i}return Object(o.a)(e,[{key:"evaluate",value:function(t,i){if(this.type===C)return Boolean(this.args[0].evaluate(t,i));if(this.type===T)return U(this.args[0].evaluate(t,i));if(this.type===I){var r,n=Object(a.a)(this.args);try{for(n.s();!(r=n.n()).done;){var s=r.value,o=Number(s.evaluate(t,i));if(!isNaN(o))return o}}catch(f){n.e(f)}finally{n.f()}return null}if(this.type===L){var l,u=Object(a.a)(this.args);try{for(u.s();!(l=u.n()).done;){var c=l.value;try{var h=e.toColor(c.evaluate(t,i));if(h instanceof w.a)return h}catch(y){}}}catch(f){u.e(f)}finally{u.f()}return null}}}],[{key:"parse",value:function(t,i){var r=t[0],n=e.types[r];if(n===C||n===T){if(2!==t.length)throw new Error("".concat(r," expects one argument"))}else if(t.length<2)throw new Error("".concat(r," expects at least one argument"));for(var a=[],s=1;s<t.length;s++){var o=De(t[s],i);a.push(o)}return new e(n,a)}},{key:"toBoolean",value:function(e){return Boolean(e)}},{key:"toString",value:function(e){return U(e)}},{key:"toNumber",value:function(e){var t=Number(e);if(isNaN(t))throw new Error('"'.concat(e,'" is not a number'));return t}},{key:"toColor",value:function(e){if(e instanceof w.a)return e;if("string"==typeof e){var t=w.a.fromString(e);if(t)return t;throw new Error('"'.concat(e,'" is not a color'))}if(Array.isArray(e))return w.a.fromArray(e);throw new Error('"'.concat(e,'" is not a color'))}}]),e}();function De(e,t,i){var r=typeof e;if("string"===r||"boolean"===r||"number"===r||null===e){if(i)switch(i.kind){case"string":"string"!==r&&(e=Le.toString(e));break;case"number":"number"!==r&&(e=Le.toNumber(e));break;case"color":e=Le.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");var n=e[0];if("string"!=typeof n)throw new Error("First element of expression must be a string");var a=Ae[n];if(void 0===a)throw new Error('Invalid expression operator "'.concat(n,'"'));if(!a)throw new Error('Unimplemented expression operator "'.concat(n,'"'));return a.parse(e,t,i)}Le.types={"to-boolean":C,"to-color":L,"to-number":I,"to-string":T};var Ae={array:Ce,boolean:Ce,collator:null,format:null,image:null,literal:function(){function e(t){Object(s.a)(this,e),this.val=t,this.type=B(t)}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return this.val}}],[{key:"parse",value:function(t){if(2!==t.length)throw new Error('"literal" expects 1 argument');return new e(t[1])}}]),e}(),number:Ce,"number-format":null,object:Ce,string:Ce,"to-boolean":Le,"to-color":Le,"to-number":Le,"to-string":Le,typeof:function(){function e(t){Object(s.a)(this,e),this.arg=t,this.type=T}return Object(o.a)(e,[{key:"evaluate",value:function(e,t){return z(B(this.arg.evaluate(e,t)))}}],[{key:"parse",value:function(t,i){if(2!==t.length)throw new Error('"typeof" expects 1 argument');return new e(De(t[1],i))}}]),e}(),accumulated:null,"feature-state":null,"geometry-type":q,id:H,"line-progress":null,properties:N,at:ce,get:he,has:fe,in:ye,"index-of":ve,length:pe,slice:de,"!":$,"!=":W,"<":J,"<=":Q,"==":X,">":K,">=":Z,all:ee,any:te,case:re,coalesce:ne,match:ae,within:null,interpolate:se,"interpolate-hcl":se,"interpolate-lab":se,step:oe,let:le,var:ue,concat:Pe,downcase:Se,"is-supported-script":null,"resolved-locale":null,upcase:Se,rgb:Me,rgba:Ie,"to-rgba":Te,"-":ge,"*":me,"/":Oe,"%":ke,"^":xe,"+":we,abs:je,acos:je,asin:je,atan:je,ceil:je,cos:je,e:je,floor:je,ln:je,ln2:je,log10:je,log2:je,max:je,min:je,pi:je,round:je,sin:je,sqrt:je,tan:je,zoom:G,"heatmap-density":null,"has-id":be,none:ie},Re=function(){function e(t){Object(s.a)(this,e),this._expression=t}return Object(o.a)(e,[{key:"filter",value:function(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(i){return console.log(i.message),!0}}}],[{key:"createFilter",value:function(t){if(!t)return null;this.isLegacyFilter(t)&&(t=this.convertLegacyFilter(t));try{var i;return new e(De(t,null,C))}catch(i){return console.log(i.message),null}}},{key:"isLegacyFilter",value:function(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(var t=1;t<e.length;t++)if(!this.isLegacyFilter(e[1]))return!1;return!0;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}}},{key:"convertLegacyFilter",value:function(t){if(!Array.isArray(t)||0===t.length)return!0;var i=t[0];if(1===t.length)return"any"!==i;switch(i){case"==":return e.convertComparison("==",t[1],t[2]);case"!=":return e.negate(e.convertComparison("==",t[1],t[2]));case">":case"<":case">=":case"<=":return e.convertComparison(i,t[1],t[2]);case"in":return e.convertIn(t[1],t.slice(2));case"!in":return e.negate(e.convertIn(t[1],t.slice(2)));case"any":case"all":case"none":return e.convertCombining(i,t.slice(1));case"has":return e.convertHas(t[1]);case"!has":return e.negate(e.convertHas(t[1]));default:throw new Error("Unexpected legacy filter.")}}},{key:"convertComparison",value:function(e,t,i){switch(t){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",t],i]}}},{key:"convertIn",value:function(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}},{key:"convertHas",value:function(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}},{key:"convertCombining",value:function(e,t){return[e].concat(t.map(this.convertLegacyFilter))}},{key:"negate",value:function(e){return["!",e]}}]),e}(),Ee=function e(){Object(s.a)(this,e)};Ee.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Ee.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}},Ee.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Ee.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},Ee.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}},Ee.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},Ee.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Ee.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};var ze=function(){function e(t,i){var r;switch(Object(s.a)(this,e),this.isDataDriven=!1,this.interpolator=null,t.type){case"number":case"color":r=!0;break;case"array":r="number"===t.value;break;default:r=!1}if(null==i&&(i=t.default),Array.isArray(i)&&i.length>0&&Ae[i[0]]){var n={number:I,color:L,string:T,boolean:C,enum:T};try{var o=De(i,null,"array"===t.type?R(n[t.value]||A,t.length):n[t.type]);this.getValue=this._buildExpression(o,t),this.isDataDriven=!0,o instanceof se&&o.input instanceof G&&(this.interpolator=o)}catch(f){console.log(f.message),this.getValue=this._buildSimple(t.default)}}else{r&&"interval"===i.type&&(r=!1);var l=i&&i.stops&&i.stops.length>0;if(l){var u,c=Object(a.a)(i.stops);try{for(c.s();!(u=c.n()).done;){var h=u.value;h[1]=this._validate(h[1],t)}}catch(y){c.e(y)}finally{c.f()}}if(this.isDataDriven=!!i&&!!i.property,this.isDataDriven)if(void 0!==i.default&&(i.default=this._validate(i.default,t)),l)switch(i.type){case"identity":this.getValue=this._buildIdentity(i,t);break;case"categorical":this.getValue=this._buildCategorical(i,t);break;default:this.getValue=r?this._buildInterpolate(i,t):this._buildInterval(i,t)}else this.getValue=this._buildIdentity(i,t);else l?this.getValue=r?this._buildZoomInterpolate(i):this._buildZoomInterval(i):(i=this._validate(i,t),this.getValue=this._buildSimple(i))}}return Object(o.a)(e,[{key:"_validate",value:function(t,i){if("number"===i.type){if(t<i.minimum)return i.minimum;if(t>i.maximum)return i.maximum}else"color"===i.type?t=e._parseColor(t):"enum"===i.type?"string"==typeof t&&(t=i.values.indexOf(t)):"array"===i.type&&"enum"===i.value?t=t.map((function(e){return"string"==typeof t?i.values.indexOf(e):e})):"string"===i.type&&(t=U(t));return t}},{key:"_buildSimple",value:function(e){return function(){return e}}},{key:"_buildExpression",value:function(e,t){var i=this;return function(r,n){try{var a=e.evaluate(n,r);return void 0===a?t.default:i._validate(a,t)}catch(s){return console.log(s.message),t.default}}}},{key:"_buildIdentity",value:function(e,t){var i=this;return function(r,n){var a;return n&&(a=n.values[e.property]),void 0!==a&&(a=i._validate(a,t)),null!=a?a:void 0!==e.default?e.default:t.default}}},{key:"_buildCategorical",value:function(e,t){var i=this;return function(r,n){var a;return n&&(a=n.values[e.property]),void 0!==(a=i._categorical(a,e.stops))?a:void 0!==e.default?e.default:t.default}}},{key:"_buildInterval",value:function(e,t){var i=this;return function(r,n){var a;return n&&(a=n.values[e.property]),"number"==typeof a?i._interval(a,e.stops):void 0!==e.default?e.default:t.default}}},{key:"_buildInterpolate",value:function(e,t){var i=this;return function(r,n){var a;return n&&(a=n.values[e.property]),"number"==typeof a?i._interpolate(a,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}},{key:"_buildZoomInterpolate",value:function(e){var t=this;return function(i){return t._interpolate(i,e.stops,e.base||1)}}},{key:"_buildZoomInterval",value:function(e){var t=this;return function(i){return t._interval(i,e.stops)}}},{key:"_categorical",value:function(e,t){for(var i=t.length,r=0;r<i;r++)if(t[r][0]===e)return t[r][1]}},{key:"_interval",value:function(e,t){for(var i=t.length,r=0,n=0;n<i&&t[n][0]<=e;n++)r=n;return t[r][1]}},{key:"_interpolate",value:function(e,t,i){for(var r,n,a=t.length,s=0;s<a;s++){var o=t[s];if(!(o[0]<=e)){n=o;break}r=o}if(r&&n){var l=n[0]-r[0],u=e-r[0],c=1===i?u/l:(Math.pow(i,u)-1)/(Math.pow(i,l)-1);if(Array.isArray(r[1])){for(var h=r[1],f=n[1],y=[],v=0;v<h.length;v++)y.push(Object(S.e)(h[v],f[v],c));return y}return Object(S.e)(r[1],n[1],c)}return r?r[1]:n?n[1]:void 0}}],[{key:"_isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"_parseColor",value:function(e){return Array.isArray(e)?e:("string"==typeof e&&(e=new w.a(e)),e instanceof w.a&&!this._isEmpty(e)?w.a.toUnitRGBA(e):void 0)}}]),e}(),Be=i(534),Ve=function(){function e(t,i,r,n){switch(Object(s.a)(this,e),this.type=t,this.typeName=i.type,this.id=i.id,this.source=i.source,this.sourceLayer=i["source-layer"],this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this.filter=i.filter,this.layout=i.layout,this.paint=i.paint,this.z=r,this.uid=n,t){case 0:this._layoutDefinition=Ee.backgroundLayoutDefinition,this._paintDefinition=Ee.backgroundPaintDefinition;break;case 1:this._layoutDefinition=Ee.fillLayoutDefinition,this._paintDefinition=Ee.fillPaintDefinition;break;case 2:this._layoutDefinition=Ee.lineLayoutDefinition,this._paintDefinition=Ee.linePaintDefinition;break;case 3:this._layoutDefinition=Ee.symbolLayoutDefinition,this._paintDefinition=Ee.symbolPaintDefinition;break;case 4:this._layoutDefinition=Ee.circleLayoutDefinition,this._paintDefinition=Ee.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}return Object(o.a)(e,[{key:"getFeatureFilter",value:function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=Re.createFilter(this.filter)}},{key:"getLayoutProperty",value:function(e){return this._layoutProperties[e]}},{key:"getPaintProperty",value:function(e){return this._paintProperties[e]}},{key:"getLayoutValue",value:function(e,t,i){var r,n=this._layoutProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._layoutDefinition[e].default),r}},{key:"getPaintValue",value:function(e,t,i){var r,n=this._paintProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._paintDefinition[e].default),r}},{key:"isPainterDataDriven",value:function(){var e=this._paintProperties;if(e)for(var t in e)if(e[t].isDataDriven)return!0;return!1}},{key:"_parseLayout",value:function(e){var t={};for(var i in e){var r=this._layoutDefinition[i];r&&(t[i]=new ze(r,e[i]))}return t}},{key:"_parsePaint",value:function(e){var t={};for(var i in e){var r=this._paintDefinition[i];r&&(t[i]=new ze(r,e[i]))}return t}},{key:"computeAttributesKey",value:function(e,t,i,r){var n,s=0,o=0,l=Object(a.a)(t);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=3;if(!u||u!==r){var h=i[u],f=h.isLayout,y=h.isOptional,v=f?this.getLayoutProperty(u):this.getPaintProperty(u);c=null!=v&&v.interpolator?2:null!=v&&v.isDataDriven?1:y&&!v?3:0}o|=c<<s,s+=2}}catch(p){l.e(p)}finally{l.f()}return o<<3|e}}]),e}(),Ue=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r,n,a){var o;return Object(s.a)(this,i),(o=t.call(this,e,r,n,a)).backgroundMaterial=new v(o.computeAttributesKey(0,v.ATTRIBUTES,v.ATTRIBUTES_INFO)),o}return i}(Ve),Fe=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r,n,a){var o;Object(s.a)(this,i);var l=(o=t.call(this,e,r,n,a)).getPaintProperty("fill-color"),u=o.getPaintProperty("fill-opacity"),c=o.getPaintProperty("fill-pattern");o.hasDataDrivenColor=null==l?void 0:l.isDataDriven,o.hasDataDrivenOpacity=null==u?void 0:u.isDataDriven,o.hasDataDrivenFill=o.hasDataDrivenColor||o.hasDataDrivenOpacity||(null==c?void 0:c.isDataDriven);var h=o.getPaintProperty("fill-outline-color");return o.outlineUsesFillColor=!h,o.hasDataDrivenOutlineColor=null==h?void 0:h.isDataDriven,o.hasDataDrivenOutline=h?h.isDataDriven:!!l&&l.isDataDriven,o.hasDataDrivenOutline=(h?o.hasDataDrivenOutlineColor:o.hasDataDrivenColor)||o.hasDataDrivenOpacity,o.fillMaterial=new d(o.computeAttributesKey(1,d.ATTRIBUTES,d.ATTRIBUTES_INFO)),o.outlineMaterial=new b(o.computeAttributesKey(2,o.outlineUsesFillColor?b.ATTRIBUTES_FILL:b.ATTRIBUTES_OUTLINE,o.outlineUsesFillColor?b.ATTRIBUTES_INFO_FILL:b.ATTRIBUTES_INFO_OUTLINE),o.outlineUsesFillColor),o}return i}(Ve),He=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r,n,a){var o,l,u,c,h,f,y,v,p,d;Object(s.a)(this,i);var b=(o=t.call(this,e,r,n,a)).getPaintProperty("line-pattern");if(o.lineMaterial=new _(o.computeAttributesKey(3,_.ATTRIBUTES,_.ATTRIBUTES_INFO,b?"line-dasharray":"")),o.hasDataDrivenLine=(null==(l=o.getPaintProperty("line-blur"))?void 0:l.isDataDriven)||(null==(u=o.getPaintProperty("line-color"))?void 0:u.isDataDriven)||(null==(c=o.getPaintProperty("line-gap-width"))?void 0:c.isDataDriven)||(null==(h=o.getPaintProperty("line-offset"))?void 0:h.isDataDriven)||(null==(f=o.getPaintProperty("line-opacity"))?void 0:f.isDataDriven)||(null==(y=o.getPaintProperty("line-pattern"))?void 0:y.isDataDriven)||(null==(v=o.getPaintProperty("line-dasharray"))?void 0:v.isDataDriven)||(null==(p=o.getLayoutProperty("line-cap"))?void 0:p.isDataDriven)||(null==(d=o.getPaintProperty("line-width"))?void 0:d.isDataDriven),o.canUseThinTessellation=!1,!o.hasDataDrivenLine){var g=o.getPaintProperty("line-width");if(!g||"number"==typeof g&&.5*g<Be.C){var m=o.getPaintProperty("line-offset");(!m||"number"==typeof m&&0===m)&&(o.canUseThinTessellation=!0)}}return o}return Object(o.a)(i,[{key:"getDashKey",value:function(e,t){var i;switch(t){default:i="Butt";break;case 1:i="Round";break;case 2:i="Square"}return"dasharray-[".concat(e.toString(),"]-").concat(i)}}]),i}(Ve),qe=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r,n,a){var o,l,u,c,h,f,y,v,p,d,b,_,g;return Object(s.a)(this,i),(o=t.call(this,e,r,n,a)).iconMaterial=new O(o.computeAttributesKey(4,O.ATTRIBUTES,O.ATTRIBUTES_INFO)),o.textMaterial=new k(o.computeAttributesKey(6,k.ATTRIBUTES,k.ATTRIBUTES_INFO)),o.hasDataDrivenIcon=(null==(l=o.getPaintProperty("icon-color"))?void 0:l.isDataDriven)||(null==(u=o.getPaintProperty("icon-halo-blur"))?void 0:u.isDataDriven)||(null==(c=o.getPaintProperty("icon-halo-color"))?void 0:c.isDataDriven)||(null==(h=o.getPaintProperty("icon-halo-width"))?void 0:h.isDataDriven)||(null==(f=o.getPaintProperty("icon-opacity"))?void 0:f.isDataDriven)||(null==(y=o.getLayoutProperty("icon-size"))?void 0:y.isDataDriven),o.hasDataDrivenText=(null==(v=o.getPaintProperty("text-color"))?void 0:v.isDataDriven)||(null==(p=o.getPaintProperty("text-halo-blur"))?void 0:p.isDataDriven)||(null==(d=o.getPaintProperty("text-halo-color"))?void 0:d.isDataDriven)||(null==(b=o.getPaintProperty("text-halo-width"))?void 0:b.isDataDriven)||(null==(_=o.getPaintProperty("text-opacity"))?void 0:_.isDataDriven)||(null==(g=o.getLayoutProperty("text-size"))?void 0:g.isDataDriven),o}return i}(Ve),Ne=function(e){Object(r.a)(i,e);var t=Object(n.a)(i);function i(e,r,n,a){var o;return Object(s.a)(this,i),(o=t.call(this,e,r,n,a)).circleMaterial=new p(o.computeAttributesKey(5,p.ATTRIBUTES,p.ATTRIBUTES_INFO)),o}return i}(Ve),Ge=function(){function e(t,i,r){var n,a,o,l,u,c;Object(s.a)(this,e),this.allowOverlap=t.getLayoutValue("icon-allow-overlap",i),this.ignorePlacement=t.getLayoutValue("icon-ignore-placement",i),this.keepUpright=t.getLayoutValue("icon-keep-upright",i),this.optional=t.getLayoutValue("icon-optional",i),this.rotationAlignment=t.getLayoutValue("icon-rotation-alignment",i),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),null!=(n=c=t.getLayoutProperty("icon-anchor"))&&n.isDataDriven?this._anchorProp=c:this.anchor=t.getLayoutValue("icon-anchor",i),null!=(a=c=t.getLayoutProperty("icon-offset"))&&a.isDataDriven?this._offsetProp=c:this.offset=t.getLayoutValue("icon-offset",i),null!=(o=c=t.getLayoutProperty("icon-padding"))&&o.isDataDriven?this._paddingProp=c:this.padding=t.getLayoutValue("icon-padding",i),null!=(l=c=t.getLayoutProperty("icon-rotate"))&&l.isDataDriven?this._rotateProp=c:this.rotate=t.getLayoutValue("icon-rotate",i),null!=(u=c=t.getLayoutProperty("icon-size"))&&u.isDataDriven?this._sizeProp=c:this.size=t.getLayoutValue("icon-size",i)}return Object(o.a)(e,[{key:"update",value:function(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}}]),e}(),Ye=function(){function e(t,i,r){var n,a,o,l,u,c,h,f,y,v,p,d;Object(s.a)(this,e),this.allowOverlap=t.getLayoutValue("text-allow-overlap",i),this.ignorePlacement=t.getLayoutValue("text-ignore-placement",i),this.keepUpright=t.getLayoutValue("text-keep-upright",i),this.optional=t.getLayoutValue("text-optional",i),this.rotationAlignment=t.getLayoutValue("text-rotation-alignment",i),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),null!=(n=d=t.getLayoutProperty("text-anchor"))&&n.isDataDriven?this._anchorProp=d:this.anchor=t.getLayoutValue("text-anchor",i),null!=(a=d=t.getLayoutProperty("text-justify"))&&a.isDataDriven?this._justifyProp=d:this.justify=t.getLayoutValue("text-justify",i),null!=(o=d=t.getLayoutProperty("text-letter-spacing"))&&o.isDataDriven?this._letterSpacingProp=d:this.letterSpacing=t.getLayoutValue("text-letter-spacing",i),null!=(l=d=t.getLayoutProperty("text-line-height"))&&l.isDataDriven?this._lineHeightProp=d:this.lineHeight=t.getLayoutValue("text-line-height",i),null!=(u=d=t.getLayoutProperty("text-max-angle"))&&u.isDataDriven?this._maxAngleProp=d:this.maxAngle=t.getLayoutValue("text-max-angle",i),null!=(c=d=t.getLayoutProperty("text-max-width"))&&c.isDataDriven?this._maxWidthProp=d:this.maxWidth=t.getLayoutValue("text-max-width",i),null!=(h=d=t.getLayoutProperty("text-offset"))&&h.isDataDriven?this._offsetProp=d:this.offset=t.getLayoutValue("text-offset",i),null!=(f=d=t.getLayoutProperty("text-padding"))&&f.isDataDriven?this._paddingProp=d:this.padding=t.getLayoutValue("text-padding",i),null!=(y=d=t.getLayoutProperty("text-rotate"))&&y.isDataDriven?this._rotateProp=d:this.rotate=t.getLayoutValue("text-rotate",i),null!=(v=d=t.getLayoutProperty("text-size"))&&v.isDataDriven?this._sizeProp=d:this.size=t.getLayoutValue("text-size",i),null!=(p=d=t.getLayoutProperty("text-writing-mode"))&&p.isDataDriven?this._writingModeProp=d:this.writingMode=t.getLayoutValue("text-writing-mode",i)}return Object(o.a)(e,[{key:"update",value:function(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}}]),e}()},917:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(2),n=i(3),a=i(21),s=i(424),o=i(160),l=function(){function e(t){if(Object(r.a)(this,e),t instanceof s.a)this._tilemapCache=t;else{if(!t||!("index"in t))throw new Error("Invalid tilemap!");this._tilemap=t.index}}return Object(n.a)(e,[{key:"dataKey",value:function(e,t){if(this._tilemapCache){var i=e.level,r=e.row,n=e.col,s=new o.a(e);return this._tilemapCache.fetchAvailabilityUpsample(i,r,n,s,t).then((function(){return s.world=e.world,s})).catch((function(e){if(Object(a.m)(e))throw e;return null}))}return this._getIndexedDataKey(e)}},{key:"forEach",value:function(e,t,i,r,n){this._callback=n,this._maxLevel=t+e,this._forEach(this._tilemap,t,i,r)}},{key:"_forEach",value:function(e,t,i,r){0!==e&&(this._callback(t,i,r),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*i,2*r),this._forEach(e[1],t+1,2*i,2*r+1),this._forEach(e[2],t+1,2*i+1,2*r),this._forEach(e[3],t+1,2*i+1,2*r+1)))}},{key:"_getIndexedDataKey",value:function(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);for(var i=e;0!==i.level;)i=new o.a(i.level-1,i.row>>1,i.col>>1,i.world),t.push(i);var r,n,a=this._tilemap,s=t.pop();if(1===a)return Promise.resolve(s);for(;t.length;)if(n=(1&(r=t.pop()).col)+((1&r.row)<<1),a){if(0===a[n]){s=null;break}if(1===a[n]){s=r;break}s=r,a=a[n]}return Promise.resolve(s)}}]),e}()}}]);
//# sourceMappingURL=62.888d87a8.chunk.js.map