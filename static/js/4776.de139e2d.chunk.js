"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[4776,4035],{32500:(e,t,i)=>{i.d(t,{I:()=>M,b:()=>b});var n,a,r,o=i(30168),s=i(37081),l=i(33280),c=i(94951),h=i(15226),d=i(26461),u=i(116),p=i(82552),_=i(58406),g=i(98634),v=i(64201),m=i(19253),f=i(25920),y=i(4760);function b(e){const t=new v.kG,{vertex:i,fragment:b}=t;return(0,p.Sv)(i,e),t.include(c.w,e),t.attributes.add(y.T.POSITION,"vec3"),t.attributes.add(y.T.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(y.T.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add((0,g.H)(n||(n=(0,o.Z)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0;\n      gl_Position = transformPosition(proj, view, vpos);\n\n      ","\n    }\n  "])),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":"")),t.include(l.f5,e),t.include(h.l,e),b.uniforms.add(new m.A("tex",(e=>e.texture)),new _.p("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.output===s.H.Alpha?b.code.add((0,g.H)(a||(a=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      fragColor = vec4(alpha);\n    }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.F))):(b.include(u.Y),b.code.add((0,g.H)(r||(r=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      fragColor = texture(tex, vTexCoord) * opacity;\n\n      if (fragColor.a < ",") {\n        discard;\n      }\n\n      fragColor = highlightSlice(fragColor, vpos);\n      ","\n    }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.F),e.transparencyPassType===f.A.Color?"fragColor = premultiplyAlpha(fragColor);":""))),t}const M=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},18300:(e,t,i)=>{i.d(t,{L:()=>b,b:()=>m});var n,a,r=i(30168),o=i(14226),s=i(81949),l=i(88396),c=i(6394),h=i(8084),d=i(82999),u=i(58406),p=i(98634),_=i(8654),g=i(64201),v=i(4760);function m(e){const t=new g.kG;t.include(h.j,e);const{vertex:i,fragment:s}=t;return i.uniforms.add(new _.g("modelView",((e,t)=>(0,o.w)(y,t.camera.viewMatrix,e.origin))),new _.g("proj",((e,t)=>t.camera.projectionMatrix)),new u.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new d.A("pixelToNDC",((e,t)=>(0,l.s)(f,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))),t.attributes.add(v.T.START,"vec3"),t.attributes.add(v.T.END,"vec3"),t.attributes.add(v.T.UP,"vec3"),t.attributes.add(v.T.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add((0,p.H)(n||(n=(0,r.Z)(["void main() {\nvec3 pos = mix(start, end, extrude.x);\nvec4 viewPos = modelView * vec4(pos, 1);\nvec4 projPos = proj * viewPos;\nvec2 ndcPos = projPos.xy / projPos.w;\nvec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;\nvec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);\nvec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\nvec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\nndcPos += length(lxy) * projExtrudeDir;\nvec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\nvec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;\nvViewStart = (modelView * vec4(start, 1)).xyz;\nvViewEnd = (modelView * vec4(end, 1)).xyz;\nvViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\nfloat xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\nndcPos.x += xPaddingPixels * pixelToNDC.x;\nuv = ndcPos * 0.5 + 0.5;\ngl_Position = vec4(ndcPos, 0, 1);\n}"])))),s.uniforms.add(new u.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),s.code.add((0,p.H)(a||(a=(0,r.Z)(["float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\nvec3 origin = mix(start, end, 0.5);\nvec3 basis = end - origin;\nvec3 posAtOrigin = pos - origin;\nfloat x = dot(normalize(basis), posAtOrigin);\nfloat y = dot(plane.xyz, posAtOrigin);\nfloat dx = max(abs(x) - length(basis), 0.0);\nfloat dy = y;\nfloat dist = length(vec2(dx, dy));\nfloat width = fwidth(y);\nfloat maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\nfloat pixelDist = dist / min(width, maxPixelDistance);\nreturn abs(pixelDist);\n}\nvoid main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nvec3 dEndStart = vViewEnd - vViewStart;\nif (dot(dEndStart, dEndStart) < 1e-5) {\ndiscard;\n}\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nfloat distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\nvec4 color = laserlineProfile(distance);\nfloat alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\nfragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n}"])))),t}const f=(0,c.a)(),y=(0,s.a)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},83671:(e,t,i)=>{i.d(t,{L:()=>X,b:()=>V,d:()=>z});var n,a,r,o,s,l,c,h,d,u,p,_,g,v,m=i(30168),f=i(16889),y=i(88396),b=i(6394),M=i(11186),S=i(71353),w=i(90045),x=i(67077),O=i(85981),E=i(55652),T=i(23470),C=i(8084),A=i(24967),P=i(82999),D=i(49450),R=i(95276),I=i(58406),L=i(98634),G=i(64201);const z=(0,f.Vl)(6);function V(e){const t=new G.kG;t.include(A.k),t.include(C.j,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new I.p("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add((0,L.H)(n||(n=(0,m.Z)(["float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.spherical){const e=(e,t,i)=>(0,M.e)(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>(0,M.e)(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add(new R.N("heightManifoldOrigin",((i,n)=>(e(U,i,n),t(W,n),(0,M.f)(W,W,U),(0,M.n)(F,W),F[3]=(0,M.l)(W),F))),new D.J("globalOrigin",((e,i)=>t(U,i))),new I.p("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,M.o)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,M.l)(e.heightManifoldTarget)))),i.code.add((0,L.H)(a||(a=(0,m.Z)(["float globeDistancePixels(float posInGlobalOriginLength) {\nfloat dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}\nfloat heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nvec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);\nfloat cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);\nvec3 posInGlobalOrigin = globalOrigin - pos;\nfloat posInGlobalOriginLength = length(posInGlobalOrigin);\nfloat sphericalDistance = globeDistancePixels(posInGlobalOriginLength);\nfloat planarDistance = planeDistancePixels(heightPlane, pos);\nreturn cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;\n}"]))))}else i.code.add((0,L.H)(r||(r=(0,m.Z)(["float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nreturn planeDistancePixels(heightPlane, pos);\n}"]))));if(e.pointDistanceEnabled&&(i.uniforms.add(new I.p("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add((0,L.H)(o||(o=(0,m.Z)(["float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"]))))),e.intersectsLineEnabled&&(i.uniforms.add(new I.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.code.add((0,L.H)(s||(s=(0,m.Z)(["float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}"]))))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add((0,L.H)(l||(l=(0,m.Z)(["bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}"])))),i.code.add((0,L.H)(c||(c=(0,m.Z)(["void main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nvec4 color = vec4(0, 0, 0, 0);"])))),e.heightManifoldEnabled){i.uniforms.add(new P.A("angleCutoff",(e=>j(e))),new R.N("heightPlane",((e,t)=>H(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,U),t.camera.viewMatrix))));const t=e.spherical?(0,L.H)(h||(h=(0,m.Z)(["normalize(globalOrigin - pos)"]))):(0,L.H)(d||(d=(0,m.Z)(["heightPlane.xyz"])));i.code.add((0,L.H)(u||(u=(0,m.Z)(["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ",")));\n      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "])),t))}return e.pointDistanceEnabled&&(i.uniforms.add(new P.A("angleCutoff",(e=>j(e))),new R.N("pointDistanceSphere",((e,t)=>function(e,t){return(0,M.e)(B,e.pointDistanceOrigin,t.camera.viewMatrix),B[3]=(0,M.o)(e.pointDistanceOrigin,e.pointDistanceTarget),B}(e,t)))),i.code.add((0,L.H)(p||(p=(0,m.Z)(["{\nfloat pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n}"]))))),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new P.A("angleCutoff",(e=>j(e))),new R.N("lineVerticalPlane",((e,t)=>function(e,t){const i=(0,O.KU)(e.lineVerticalPlaneSegment,.5,U),n=e.renderCoordsHelper.worldUpAtPosition(i,Z),a=(0,M.n)(W,e.lineVerticalPlaneSegment.vector),r=(0,M.b)(F,n,a);return(0,M.n)(r,r),H(e.lineVerticalPlaneSegment.origin,r,t.camera.viewMatrix)}(e,t))),new D.J("lineVerticalStart",((e,t)=>function(e,t){const i=(0,M.c)(U,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),(0,M.e)(i,i,t.camera.viewMatrix)}(e,t))),new D.J("lineVerticalEnd",((e,t)=>function(e,t){const i=(0,M.g)(U,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),(0,M.e)(i,i,t.camera.viewMatrix)}(e,t)))),i.code.add((0,L.H)(_||(_=(0,m.Z)(["{\nif (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}\n}"]))))),e.intersectsLineEnabled&&(i.uniforms.add(new P.A("angleCutoff",(e=>j(e))),new D.J("intersectsLineStart",((e,t)=>(0,M.e)(U,e.lineStartWorld,t.camera.viewMatrix))),new D.J("intersectsLineEnd",((e,t)=>(0,M.e)(U,e.lineEndWorld,t.camera.viewMatrix))),new D.J("intersectsLineDirection",((e,t)=>((0,M.c)(F,e.intersectsLineSegment.vector),F[3]=0,(0,M.n)(U,(0,w.t)(F,F,t.camera.viewMatrix))))),new I.p("intersectsLineRadius",(e=>e.intersectsLineRadius))),i.code.add((0,L.H)(g||(g=(0,m.Z)(["{\nif (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}\n}"]))))),i.code.add((0,L.H)(v||(v=(0,m.Z)(["fragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n}"])))),t}function j(e){return(0,y.s)(N,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,f.Vl)(2))))}function H(e,t,i){return(0,M.e)(Y,e,i),(0,M.c)(F,t),F[3]=0,(0,w.t)(F,F,i),(0,E.Yq)(Y,F,k)}const N=(0,b.a)(),U=(0,S.c)(),F=(0,x.c)(),Z=(0,S.c)(),W=(0,S.c)(),Y=(0,S.c)(),k=(0,E.Ue)(),B=(0,T.c)(),X=Object.freeze(Object.defineProperty({__proto__:null,build:V,defaultAngleCutoff:z},Symbol.toStringTag,{value:"Module"}))},72511:(e,t,i)=>{i.d(t,{S:()=>R,b:()=>A});var n,a,r,o,s,l,c,h,d,u,p=i(30168),_=i(67077),g=i(43505),v=i(37081),m=i(33280),f=i(94951),y=i(15226),b=i(26461),M=i(116),S=i(82552),w=i(49450),x=i(95276),O=i(98634),E=i(64201),T=i(25920),C=i(4760);function A(e){const t=new E.kG,i=e.multipassEnabled&&(e.output===v.H.Color||e.output===v.H.Alpha);t.include(f.w,e),t.include(g.A,e),t.include(m.f5,e);const{vertex:_,fragment:A}=t;return A.include(M.Y),(0,S.Sv)(_,e),A.uniforms.add(new x.N("uColor",(e=>e.color))),t.attributes.add(C.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(C.T.OFFSET,"vec3"),e.shadingEnabled&&((0,S._8)(_),t.attributes.add(C.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),_.code.add((0,O.H)(n||(n=(0,p.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&_.code.add((0,O.H)(a||(a=(0,p.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),_.code.add((0,O.H)(r||(r=(0,p.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),i&&t.include(y.l,e),A.code.add((0,O.H)(o||(o=(0,p.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),i?"terrainDepthTest(depth);":"")),e.shadingEnabled?(A.uniforms.add(new w.J("shadingDirection",(e=>e.shadingDirection))),A.uniforms.add(new x.N("shadedColor",(e=>P(e.shadingTint,e.color)))),A.code.add((0,O.H)(s||(s=(0,p.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(uColor, shadedColor, shadingFactor);"]))))):A.code.add((0,O.H)(l||(l=(0,p.Z)(["vec4 finalColor = uColor;"])))),A.code.add((0,O.H)(c||(c=(0,p.Z)(["\n      ","\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),e.output===v.H.ObjectAndLayerIdColor?(0,O.H)(h||(h=(0,p.Z)(["finalColor.a = 1.0;"]))):"",O.H.float(b.b),e.output===v.H.Alpha?(0,O.H)(d||(d=(0,p.Z)(["fragColor = vec4(finalColor.a);"]))):"",e.output===v.H.Color?(0,O.H)(u||(u=(0,p.Z)(["fragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.transparencyPassType===T.A.Color?"fragColor = premultiplyAlpha(fragColor);":""):"")),t}function P(e,t){const i=1-e[3],n=e[3]+t[3]*i;return 0===n?(D[3]=n,D):(D[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,D[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,D[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,D[3]=t[3],D)}const D=(0,_.c)(),R=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},11316:(e,t,i)=>{i.d(t,{S:()=>p,b:()=>u});var n,a,r=i(30168),o=i(82552),s=i(95276),l=i(58406),c=i(98634),h=i(64201),d=i(4760);function u(e){const t=new h.kG,{vertex:i,fragment:u,attributes:p,varyings:_}=t;return(0,o.Sv)(i,e),p.add(d.T.POSITION,"vec3"),p.add(d.T.UV0,"vec2"),_.add("vUV","vec2"),i.code.add((0,c.H)(n||(n=(0,r.Z)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),u.uniforms.add(new s.N("backgroundColor",(e=>e.backgroundColor)),new s.N("gridColor",(e=>e.gridColor)),new l.p("gridWidth",(e=>e.gridWidth))),u.code.add((0,c.H)(a||(a=(0,r.Z)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\nfragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),t}const p=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},151:(e,t,i)=>{function n(){return new Float32Array(4)}function a(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,n){const a=new Float32Array(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a}function o(){return n()}function s(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function c(){return r(0,1,0,0)}function h(){return r(0,0,1,0)}function d(){return r(0,0,0,1)}i.d(t,{c:()=>a,f:()=>r});const u=o(),p=s(),_=l(),g=c(),v=h(),m=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:m,UNIT_X:_,UNIT_Y:g,UNIT_Z:v,ZEROS:u,clone:a,create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:r,ones:s,unitW:d,unitX:l,unitY:c,unitZ:h,zeros:o},Symbol.toStringTag,{value:"Module"}))},96866:(e,t,i)=>{i.d(t,{B:()=>p});var n=i(10064),a=i(9997),r=i(80292),o=i(35995),s=i(71907),l=i(33397),c=i(25265),h=i(49861),d=i(22892),u=i(53283);function p(e){var t;const i=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return(t,n)=>{const a=function(e,t,i){var n;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,i){const n=(0,l.Oe)(t,i);return{type:String,read:(e,t,i)=>{const a=(0,u.r)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer(t,a,s,l){if(null===l||void 0===l||!l.resources)return"string"==typeof t?void(a[s]=(0,u.t)(t,l)):void(a[s]=t.write({},l));const h=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,u.t)(h,{...l,verifyItemRelativeUrls:null!==l&&void 0!==l&&l.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},u.M.NO),m=n.type!==String&&(!(0,r.l)(this)||(null===l||void 0===l?void 0:l.origin)&&this.originIdOf(i)>(0,c.M9)(l.origin)),f={object:this,propertyName:i,value:t,targetUrl:p,dest:a,targetPropertyName:s,context:l,params:e};null!==l&&void 0!==l&&l.portalItem&&p&&!(0,o.YP)(p)?m&&null!==e&&void 0!==e&&e.contentAddressed?_(f):m?function(e){var t;const{context:i,targetUrl:n,params:a,value:r,dest:s,targetPropertyName:l}=e;if(!i.portalItem)return;const c=i.portalItem.resourceFromPath(n),h=v(r,n,i),u=(0,d.B)(h),p=(0,o.Ml)(c.path),m=null!==(t=null===a||void 0===a?void 0:a.compress)&&void 0!==t&&t;u===p?(i.resources&&g({...e,resource:c,content:h,compress:m,updates:i.resources.toUpdate}),s[l]=n):_(e)}(f):function(e){let{context:t,targetUrl:i,dest:n,targetPropertyName:a}=e;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),n[a]=i)}(f):null!==l&&void 0!==l&&l.portalItem&&(null==p||null!=(0,u.i)(p)||(0,o.jc)(p)||m)?_(f):a[s]=p}}}}(e,t,i);switch(null!==(n=null===e||void 0===e?void 0:e.type)&&void 0!==n?n:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=u.a;return{read:e,write:t}}}}(e,t,n);for(const e of i){const i=(0,h.CJ)(t,e,n);for(const e in a)i[e]=a[e]}}}function _(e){var t,i,r,l;const{targetUrl:c,params:h,value:p,context:_,dest:m,targetPropertyName:f}=e;if(!_.portalItem)return;const y=(0,u.p)(c),b=v(p,c,_);if(null!==h&&void 0!==h&&h.contentAddressed&&"json"!==b.type)return void(null===(t=_.messages)||void 0===t||t.push(new n.Z("persistable:contentAddressingUnsupported",'Property "'.concat(f,'" is trying to serializing a resource with content of type ').concat(b.type," with content addressing. Content addressing is only supported for json resources."),{content:b})));const M=null!==h&&void 0!==h&&h.contentAddressed&&"json"===b.type?(0,a.F)(b.jsonString):null!==(i=null===y||void 0===y?void 0:y.filename)&&void 0!==i?i:(0,s.D)(),S=(0,o.v_)(null!==(r=null===h||void 0===h?void 0:h.prefix)&&void 0!==r?r:null===y||void 0===y?void 0:y.prefix,M),w="".concat(S,".").concat((0,d.B)(b));if(null!==h&&void 0!==h&&h.contentAddressed&&_.resources&&"json"===b.type){var x;const e=null!==(x=_.resources.toKeep.find((e=>e.resource.path===w)))&&void 0!==x?x:_.resources.toAdd.find((e=>e.resource.path===w));if(e)return void(m[f]=e.resource.itemRelativeUrl)}const O=_.portalItem.resourceFromPath(w);(0,o.jc)(c)&&_.resources&&_.resources.pendingOperations.push((0,o.gi)(c).then((e=>{O.path="".concat(S,".").concat((0,d.B)({type:"blob",blob:e})),m[f]=O.itemRelativeUrl})).catch((()=>{})));const E=null!==(l=null===h||void 0===h?void 0:h.compress)&&void 0!==l&&l;_.resources&&g({...e,resource:O,content:b,compress:E,updates:_.resources.toAdd}),m[f]=O.itemRelativeUrl}function g(e){let{object:t,propertyName:i,updates:n,resource:a,content:r,compress:o}=e;n.push({resource:a,content:r,compress:o,finish:e=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(t,i,e)}})}function v(e,t,i){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(i))}}},80292:(e,t,i)=>{function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>n})},37998:(e,t,i)=>{i.d(t,{B:()=>c});var n=i(16889),a=i(14226),r=i(71353),o=i(73680),s=i(96334),l=i(92975);function c(e,t,i,n){if(null==e||null==n)return!1;const r=(0,s.eT)(e,s.Jz),c=(0,s.eT)(n,s.sp);if(r===c&&!h(c)&&(r!==s.Ej.UNKNOWN||(0,l.fS)(e,n)))return(0,a.d)(i,t),!0;if(h(c)){const e=s.rf[r][s.Ej.LON_LAT],n=s.rf[s.Ej.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,u,0),n(u,0,p,0),(0,o.y)(d*u[0],d*u[1],i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}if((c===s.Ej.WEB_MERCATOR||c===s.Ej.PLATE_CARREE)&&(r===s.Ej.WGS84||r===s.Ej.CGCS2000&&c===s.Ej.PLATE_CARREE||r===s.Ej.SPHERICAL_ECEF||r===s.Ej.WEB_MERCATOR)){const e=s.rf[r][s.Ej.LON_LAT],n=s.rf[s.Ej.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,u,0),n(u,0,p,0),r===s.Ej.SPHERICAL_ECEF?(0,o.s)(d*u[0],d*u[1],i):(0,a.g)(i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}return!1}function h(e){return e===s.Ej.SPHERICAL_ECEF||e===s.Ej.SPHERICAL_MARS_PCPF||e===s.Ej.SPHERICAL_MOON_PCPF}const d=(0,n.Vl)(1),u=(0,r.c)(),p=(0,r.c)()},73680:(e,t,i)=>{i.d(t,{s:()=>r,y:()=>a});var n=i(14226);function a(e,t,i){const n=Math.sin(e),a=Math.cos(e),r=Math.sin(t),o=Math.cos(t),s=i;return s[0]=-n,s[4]=-r*a,s[8]=o*a,s[12]=0,s[1]=a,s[5]=-r*n,s[9]=o*n,s[13]=0,s[2]=0,s[6]=o,s[10]=r,s[14]=0,s[3]=0,s[7]=0,s[11]=0,s[15]=1,s}function r(e,t,i){return a(e,t,i),(0,n.t)(i,i),i}},76046:(e,t,i)=>{i.d(t,{Z:()=>m});var n,a=i(27366),r=i(46784),o=i(49861),s=(i(25243),i(63780),i(93169),i(69912)),l=i(14226),c=i(81949),h=i(48976),d=i(98131),u=i(11186),p=i(71353),_=i(45238);let g=n=class extends r.wq{constructor(e){super(e),this.translation=(0,p.c)(),this.rotationAxis=(0,p.e)(_.up),this.rotationAngle=0,this.scale=(0,p.f)(1,1,1)}get rotation(){return(0,_.uT)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,p.g)((0,_.ZZ)(e)),this.rotationAngle=(0,_.EU)(e)}get localMatrix(){const e=(0,c.a)();return(0,h.s)(v,(0,_.ZZ)(this.rotation),(0,_.WH)(this.rotation)),(0,l.f)(e,v,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.i)((0,c.a)(),this.localMatrix)}applyLocal(e,t){return(0,u.e)(t,e,this.localMatrix)}applyLocalInverse(e,t){return(0,u.e)(t,e,this.localMatrixInverse)}equals(e){return this===e||null!=e&&(0,l.e)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,p.g)(this.translation),rotationAxis:(0,p.g)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,p.g)(this.scale)};return new n(e)}};(0,a._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"translation",void 0),(0,a._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"rotationAxis",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],g.prototype,"rotationAngle",void 0),(0,a._)([(0,o.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],g.prototype,"rotation",null),(0,a._)([(0,o.Cb)()],g.prototype,"localMatrix",null),(0,a._)([(0,o.Cb)()],g.prototype,"localMatrixInverse",null),g=n=(0,a._)([(0,s.j)("esri.geometry.support.MeshTransform")],g);const v=(0,d.a)(),m=g},45238:(e,t,i)=>{i.d(t,{EU:()=>_,Ue:()=>l,WH:()=>g,ZZ:()=>p,qC:()=>d,qw:()=>u,uT:()=>c,up:()=>v,zk:()=>h});var n=i(16889),a=i(48976),r=i(98131),o=i(11186),s=i(71353);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;return[e[0],e[1],e[2],e[3]]}function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,o.c)(i,e),i[3]=t,i}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,o.b)(i,e,t),(0,o.n)(i,i),i[3]=-(0,o.d)(e,t),i}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,a.s)(m,e,g(e)),(0,a.s)(f,t,g(t)),(0,a.m)(m,f,m),function(e,t){return e[3]=t,e}(i,(0,n.BV)((0,a.g)(i,m)))}function u(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l();return c(s.U,e,y),c(s.b,t,b),c(s.d,i,M),d(y,b,y),d(y,M,n),n}function p(e){return e}function _(e){return e[3]}function g(e){return(0,n.Vl)(e[3])}const v=[0,0,1,0],m=(0,r.a)(),f=(0,r.a)(),y=(l(),l()),b=l(),M=l()},22892:(e,t,i)=>{i.d(t,{B:()=>a});var n=i(35995);function a(e){return r[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,n.Ml)(e);return l[t]||o}(e.url)}(e)]||s}const r={},o="text/plain",s=r[o],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const c in l)r[l[c]]=c},89534:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool3D:()=>Wi,ExtentTransformTool:()=>ns,GraphicMoveTool:()=>Ja,GraphicReshapeTool:()=>xr,GraphicTransformTool:()=>kr});var n=i(27366),a=i(86950),r=i(42537),o=i(92026),s=i(94172),l=i(49861),c=i(25243),h=i(63780),d=i(93169),u=i(69912),p=i(11186),_=i(71353),g=i(74509),v=i(64575),m=i(17842),f=(i(32718),i(10064),i(51995)),y=i(7138),b=i(14921),M=i(66978),S=i(58935),w=i(88396),x=i(6394),O=i(69662),E=i(41201),T=i(74177);i(42877);let C=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),A=(e,t,i)=>{for(let n=0,a=t.length;n<a;n++){let a=t[n];Array.isArray(a)?A(e,a,i):null!=a&&!1!==a&&("string"==typeof a&&(a=C(a)),i.push(a))}};i(88367);const P={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let D=class extends y.Z{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){const e=this._textShadowColor.toCss(!0);return"0 0 ".concat(this._textShadowSize,"px ").concat(e)}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new f.Z([0,0,0,.6]),this.textColor=new f.Z([255,255,255]),this._textShadowSize=1}render(){return function(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let n,a;return i&&1===i.length&&"string"==typeof i[0]?n=i[0]:i&&(a=[],A(e,i,a),0===a.length&&(a=void 0)),{vnodeSelector:e,properties:t,children:a,text:""===n?void 0:n,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font="".concat(this.fontSize,"px ").concat(t);const i=this._padding,n=this._borderRadius,a=e.measureText(this.text).width,r=this.fontSize,o=R[this.anchor];e.textAlign="center",e.textBaseline="middle";const s=a+2*i,l=r+2*i,c=this.x+o.x*s,h=this.y+o.y*l;this._roundedRect(e,c,h,s,l,n),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const d=this.x+(o.x+.5)*s,u=this.y+(o.y+.5)*l;this._renderTextShadow(e,this.text,d,u),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,u)}_renderTextShadow(e,t,i,n){e.lineJoin="miter",e.fillStyle="rgba(".concat(this._textShadowColor.r,", ").concat(this._textShadowColor.g,", ").concat(this._textShadowColor.b,", ").concat(1/I.length,")");const a=this._textShadowSize;for(const[r,o]of I)e.fillText(t,i+a*r,n+a*o)}_roundedRect(e,t,i,n,a,r){e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+n-r,i),e.arcTo(t+n,i,t+n,i+r,r),e.lineTo(t+n,i+a-r),e.arcTo(t+n,i+a,t+n-r,i+a,r),e.lineTo(t+r,i+a),e.arcTo(t,i+a,t,i+a-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in P)e[P[t]]=this.anchor===t;return e}};(0,n._)([(0,l.Cb)()],D.prototype,"x",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"y",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"position",null),(0,n._)([(0,l.Cb)()],D.prototype,"text",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"fontSize",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"anchor",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"visible",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"isDecoration",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"backgroundColor",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"textColor",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"_textShadowSize",void 0),(0,n._)([(0,l.Cb)()],D.prototype,"_textShadowColor",null),(0,n._)([(0,l.Cb)()],D.prototype,"_textShadow",null),(0,n._)([(0,l.Cb)()],D.prototype,"_padding",null),(0,n._)([(0,l.Cb)()],D.prototype,"_borderRadius",null),D=(0,n._)([(0,u.j)("esri.views.overlay.TextOverlayItem")],D);const R={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},I=[];{const e=16;for(let t=0;t<360;t+=360/e)I.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=D;var G=i(59418);const z={default:15,far:25};let V=class extends y.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,b.vr)((async e=>{const t=await(0,E.ME)("esri/core/t9n/Units");(0,M.k_)(e),this._messagesUnits=t}));this.addHandles([(0,s.YP)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,s.on)((()=>{var e;return null===(e=this.context)||void 0===e?void 0:e.editGeometryOperations}),e,(()=>this._update())))),(0,r.kB)((()=>e.abort())),(0,s.YP)((()=>this._colors),(e=>this._updateStyle(e)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return z[this.edgeDistance]}get _colors(){var e,t;const i=null!==(e=null===(t=this.context)||void 0===t?void 0:t.view.effectiveTheme.textColor)&&void 0!==e?e:f.Z.fromArray([255,255,255]);return{textColor:i,backgroundColor:(0,a.G)((0,a.mj)(i,a.K6.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const e=this.context;if(null==e)return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:n}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const a=t.length;for(let r=0;r<a;++r){const o=[];if(t[r].iterateVertices((e=>{o.push(n.toXYZ(e.pos))})),0===r&&null!=this.stagedVertex&&o.push(n.toXYZ(this.stagedVertex)),o.length<2)continue;const s=o[0],l=o[o.length-1];"polygon"===i.type&&o.length>2&&!(0,p.G)(s,l)&&o.push(s);const c=1===a&&!(0,O.bu)(o);let h=N,d=U;this.toScreenPointArray(e,s,h);for(let t=1;t<o.length;++t){const i=o[t-1],n=o[t];this.toScreenPointArray(e,n,d),this._addLabel(e,i,h,n,d,c),[h,d]=[d,h]}}this._destroyUnusedLabels()}_updateStyle(e){let{textColor:t,backgroundColor:i}=e;const n=this._nextLabelIndex,a=this._labelInfos;for(let r=0;r<n;++r){const{label:e}=a[r];e.textColor=t,e.backgroundColor=i}}_addLabel(e,t,i,n,a,r){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||(0,w.k)(i,a)<3025)return void(o.visible=!1);const s=null!=e.graphicState?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,g.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:l}=e.editGeometryOperations.data,c=(0,G.MU)(t,n,l,s),h=this._messagesUnits,d=(0,T.R)(e.view);o.text=null!=h&&null!=c?(0,S.N9)(h,c,d):"",o.visible=!0;const u=a[0]-i[0],p=a[1]-i[1];r?(0,w.s)(j,-p,u):(0,w.s)(j,p,-u),(0,w.e)(j,j),(0,w.a)(j,j,this._edgeDistancePixels),(0,w.l)(H,i,a,.5),(0,w.i)(H,H,j),o.position=[H[0],H[1]],Math.abs(j[0])>Math.abs(j[1])?o.anchor=j[0]>0?"left":"right":o.anchor=-j[1]<0?"top":"bottom"}_getOrCreateLabel(e){var t;const i=this._labelInfos.length>this._nextLabelIndex,{textColor:n,backgroundColor:a}=this._colors;if(i){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=n,t.backgroundColor=a,e}const r=new L({anchor:"center",fontSize:10,textColor:n,backgroundColor:a});null===(t=e.view.overlay)||void 0===t||t.items.add(r);const o={label:r};return this._labelInfos.push(o),this._nextLabelIndex=this._labelInfos.length,o}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel(e){var t;let{label:i}=e;null!==(t=this.context)&&void 0!==t&&null!==(t=t.view.overlay)&&void 0!==t&&t.items.remove(i),i.destroy()}};(0,n._)([(0,l.Cb)()],V.prototype,"context",void 0),(0,n._)([(0,l.Cb)()],V.prototype,"stagedVertex",void 0),(0,n._)([(0,l.Cb)()],V.prototype,"visible",void 0),(0,n._)([(0,l.Cb)()],V.prototype,"edgeDistance",void 0),(0,n._)([(0,l.Cb)()],V.prototype,"updating",null),(0,n._)([(0,l.Cb)()],V.prototype,"_messagesUnits",void 0),(0,n._)([(0,l.Cb)()],V.prototype,"_edgeDistancePixels",null),(0,n._)([(0,l.Cb)()],V.prototype,"_colors",null),V=(0,n._)([(0,u.j)("esri.views.interactive")],V);const j=(0,x.a)(),H=(0,x.a)(),N=(0,m.s1)(),U=(0,m.s1)();var F=i(11208);let Z=class extends V{getCameraOrExtent(e){let{view:t}=e;return t.state.camera}toScreenPointArray(e,t){let{view:i,elevationInfo:n,editGeometryOperations:a}=e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,m.s1)();const{spatialReference:o}=a.data.coordinateHelper;return(0,F.RS)(t,o,n,i,W),i.state.camera.projectToScreen(W,r),r}};Z=(0,n._)([(0,u.j)("esri.views.3d.interactive.SegmentLabels3D")],Z);const W=(0,_.c)();var Y=i(5986),k=i(90045),B=i(151),X=i(70444),q=i(95773),Q=i(85981),J=i(40885),K=i(79056),$=i(26279),ee=i(78289),te=i(78485);class ie{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=$.eZ.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const i=null===(t=this._resources)||void 0===t?void 0:t.layerView;i&&(i.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),i=new ne({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new ne({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ee.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ee.T.UPDATE),this._resources.geometriesAdded=!0))}}let ne=class extends((0,K.IG)(y.Z)){constructor(e){super(e),this.drapeSourceType=$.Lw.Features,this.updatePolicy=te.j.SYNC,this.renderGroup=$.eZ.Outline}};(0,n._)([(0,l.Cb)({constructOnly:!0})],ne.prototype,"view",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],ne.prototype,"drapeSourceType",void 0),(0,n._)([(0,l.Cb)()],ne.prototype,"renderGroup",void 0),ne=(0,n._)([(0,u.j)("DrapedVisualElementLayerView")],ne);class ae{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,s.YP)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var re=i(79100),oe=i(66327),se=i(97882);class le{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==re.U.Mesh&&t.type!==re.U.Line&&t.type!==re.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==re.U.Mesh&&t.type!==re.U.Line&&t.type!==re.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const n=new se.F(i,{pickable:!1,updatePolicy:te.j.SYNC}),a=new oe.T({castShadow:!1}),r=e.createResources(a,n);r.forEach((e=>{i.add(e),e.type===re.U.Texture&&e.load(i.renderView.renderingContext)})),i.add(a),n.add(a);const o=e.cameraChanged,l=o?(0,s.YP)((()=>t.state.camera),(e=>o(e)),s.nn):null;this._resources={layer:n,object:a,external:r,cameraHandle:l},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===re.U.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class ce extends ae{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new le(this.createObject3DResourceFactory(e.view)),this.drapedResources=new ie(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var he=i(50951),de=i(86372),ue=i(50256),pe=i(55158),_e=i(80658),ge=i(4760),ve=i(82144),me=i(31132),fe=i(27627),ye=i(18300),be=i(8548),Me=i(36207);class Se extends me.A{initializeProgram(e){return new fe.$(e.rctx,Se.shader.get().build(this.configuration),we)}initializePipeline(){return(0,Me.sm)({blending:(0,Me.if)(be.zi.ONE,be.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Me.BK})}}Se.shader=new ve.J(ye.L,(()=>i.e(7515).then(i.bind(i,97515))));const we=new Map([[ge.T.START,0],[ge.T.END,1],[ge.T.UP,2],[ge.T.EXTRUDE,3]]);var xe=i(44070);class Oe{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,_.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,de.bg)(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,p.s)(this._origin,e[t],e[t+1],e[t+2])}else(0,p.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(be.MX.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new _e.U(e,we,{data:(0,ue.K)(Ce)},{data:xe.f.createVertex(e,be.l1.STATIC_DRAW,i)})}_ensureVertexData(e,t){var i;if(!this._dirty)return;const n=this._createDataBuffer(t);null!==(i=e.vertexBuffers.data)&&void 0!==i&&i.setData(n),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=Ce.createBuffer(t),n=this._origin;let a=0,r=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=(0,p.s)(Te,o[e],o[e+1],o[e+2]);0===e?r=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,r);const s=this._renderCoordsHelper.worldUpAtPosition(t,Ee),l=a+2*e,c=(0,p.f)(Te,t,n);if(e<o.length-3){i.up.setVec(l,s),i.up.setVec(l+3,s),i.up.setVec(l+5,s);for(let e=0;e<6;e++)i.start.setVec(l+e,c);i.extrude.setValues(l,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,s),i.up.setVec(l-4,s),i.up.setVec(l-5,s);for(let e=-6;e<0;e++)i.end.setVec(l+e,c)}}a+=this._numberOfRenderVertices(o)}return i.buffer}}const Ee=(0,_.c)(),Te=(0,_.c)(),Ce=(0,pe.U$)().vec3f(ge.T.START).vec3f(ge.T.END).vec3f(ge.T.UP).vec2f(ge.T.EXTRUDE);var Ae=i(70374),Pe=i(93822),De=i(22909),Re=i(33559);class Ie extends Re.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,n._)([(0,Re.o)()],Ie.prototype,"contrastControlEnabled",void 0);var Le=i(16889),Ge=i(98634),ze=i(7566),Ve=i(83671);class je extends Ge.K{constructor(){super(...arguments),this.innerColor=(0,_.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,_.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,Le.Vl)(6),this.pointDistanceOrigin=(0,_.c)(),this.pointDistanceTarget=(0,_.c)(),this.lineVerticalPlaneSegment=(0,Q.Ue)(),this.intersectsLineSegment=(0,Q.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,_.c)(),this.lineStartWorld=(0,_.c)(),this.lineEndWorld=(0,_.c)()}}class He extends me.A{initializeProgram(e){return new fe.$(e.rctx,He.shader.get().build(this.configuration),ze.i)}initializePipeline(){return(0,Me.sm)({blending:(0,Me.if)(be.zi.ONE,be.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Me.BK})}}He.shader=new ve.J(Ve.L,(()=>i.e(5693).then(i.bind(i,45693))));class Ne extends Ie{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,n._)([(0,Re.o)()],Ne.prototype,"heightManifoldEnabled",void 0),(0,n._)([(0,Re.o)()],Ne.prototype,"pointDistanceEnabled",void 0),(0,n._)([(0,Re.o)()],Ne.prototype,"lineVerticalPlaneEnabled",void 0),(0,n._)([(0,Re.o)()],Ne.prototype,"intersectsLineEnabled",void 0),(0,n._)([(0,Re.o)()],Ne.prototype,"spherical",void 0);let Ue=class extends Ae.He{constructor(e){super(e),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=he.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new je,this.produces=new Map([[Pe.r.LASERLINES,()=>!this.contrastControlEnabled],[Pe.r.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return Ae.of}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,p.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,p.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,p.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,Q.JG)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,Q.JG)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Oe(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Oe(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,De.LO)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e,this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new Ne;const t=new Ie;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(Se,t)}uninitializeRenderContext(){this._technique=(0,o.RY)(this._technique),this._pathVerticalPlaneData=(0,o.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,o.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===he.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(He,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,this._passParameters,e.bindParameters),i.screen.draw()}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,X.iL)((0,J.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),Fe),Fe.c0=-Number.MAX_VALUE,!(0,q.zq)(t.frustum,Fe))return;(0,X.Ws)(Fe,this._passParameters.lineStartWorld),(0,X.S$)(Fe,this._passParameters.lineEndWorld)}else(0,p.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,p.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Ue.prototype,"contrastControlEnabled",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ue.prototype,"_isDecoration",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ue.prototype,"renderCoordsHelper",void 0),Ue=(0,n._)([(0,u.j)("esri.views.3d.support.LaserLineRenderer")],Ue);const Fe=(0,X.Ue)();class Ze extends ae{constructor(e){super(e),this._angleCutoff=Ve.d,this._style={},this._heightManifoldTarget=(0,_.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,Q.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,p.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,We);this.intersectsLine=(0,Q.al)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,Q.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,Q.JG)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,_.g)(e.origin),target:e.target?(0,_.g)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new Ue({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const We=(0,_.c)();var Ye=i(98061),ke=i(70619),Be=i(56529),Xe=i(39077),qe=i(58901);class Qe extends ce{constructor(e){super(e),this._ray=(0,J.Ue)(),this._isWorldDown=!1,this._start=(0,_.c)(),this._end=(0,_.f)(1,0,0),this._width=1,this._color=(0,B.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,B.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=tt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Be.yD.OccludeAndTransparent,this._fadedExtensions=nt,this._laserline=new Ze({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,p.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,p.f)(this._end,e,this._end),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,p.h)(this._start,e)||((0,p.c)(this._start,e),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,p.h)(this._end,e)||((0,p.c)(this._end,e),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,k.h)(e,this._color)||((0,k.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,k.h)(e,this._innerColor)||((0,k.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,k.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,B.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Be.yD.OccludeAndTransparentStencil?Be.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:nt,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new qe.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new qe.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new Xe.z(t)}_createGeometry(e){const t=this.extensionType===tt.FADED,i=t?[(0,_.c)(),(0,_.c)(),(0,_.c)(),(0,_.c)()]:[(0,_.c)(),(0,_.c)()];return(0,ke.rh)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===tt.FADED?this._updateLineSegmentFinite(et):this._updateLineSegmentInfinite(this._extensionType,et)}_updateLineSegmentFinite(e){return(0,Q.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,X.iL)(this._ray,Je),e){case tt.LINE:Je.c0=-Number.MAX_VALUE;break;case tt.RAY:case tt.GROUND_RAY:{var n;const e=this._ray.origin,t=null!==(n=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==n?n:0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,p.E)(Je.ray.direction,Je.ray.direction),this._extensionType===tt.GROUND_RAY&&null!=t&&(Je.c1=Math.abs(i-t));break}}if(!(0,q.zq)(i.frustum,Je))return this._updateLineSegmentFinite(t);const a=(0,X.Ws)(Je,Ke),r=(0,X.S$)(Je,$e);return(0,Q.zk)(a,r,t)}_updateVertexAttributesObject3D(e,t){var i;const n=null===(i=e.geometries[0].getMutableAttribute(ge.T.POSITION))||void 0===i?void 0:i.data;if(!n)return;let a=0;for(const r of this._lineVertices(t))n[a++]=r[0],n[a++]=r[1],n[a++]=r[2];e.geometryVertexAttributeUpdated(e.geometries[0],ge.T.POSITION)}_updateVertexAttributesDraped(e,t){var i;const n=null===(i=e.getMutableAttribute(ge.T.POSITION))||void 0===i?void 0:i.data;if(!n)return;let a=0;for(const r of this._lineVertices(t))n[a++]=r[0],n[a++]=r[1],n[a++]=Ye.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===tt.FADED?(yield(0,Q.KU)(e,-this.fadedExtensions.start,Ke),yield(0,Q.KU)(e,0,Ke),yield(0,Q.KU)(e,1,Ke),yield(0,Q.KU)(e,1+this.fadedExtensions.end,Ke)):(yield(0,Q.KU)(e,0,Ke),yield(0,Q.KU)(e,1,Ke))}}const Je=(0,X.Ue)(),Ke=(0,_.c)(),$e=(0,_.c)(),et=(0,Q.Ue)();var tt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(tt||(tt={}));const it=1/3,nt={start:it,end:it};var at=i(55946);class rt extends ce{constructor(e){super(e),this._location=(0,_.c)(),this._direction=(0,_.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,B.f)(1,0,1,1),this._renderOccluded=Be.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,p.h)(this._location,e)||((0,p.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,p.h)(this._direction,e)||((0,p.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,p.n)(this._direction,(0,p.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,k.h)(e,this._color)||((0,k.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new qe.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[n,a]=this._createGeometries(e);t.addGeometry(n),t.addGeometry(a),i.push(n),i.push(a),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new qe.U(this.materialParameters),t=(0,s.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new Xe.z(e)))}_createGeometries(e){return[(0,ke.rh)(e,[(0,_.c)(),(0,_.c)()]),(0,ke.rh)(e,[(0,_.c)(),(0,_.c)()])]}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,ht),(0,p.g)(ot,this.location,this.direction),t.projectToScreen(ot,dt),(0,w.e)(dt,(0,w.c)(dt,dt,ht)),this._updateVertexAttributesObject3D(t,e,0,ht,dt,1),this._updateVertexAttributesObject3D(t,e,1,ht,dt,-1)}_updateVertexAttributesObject3D(e,t,i,n,a,r){var o;const s=t.geometries[i],l=null===(o=s.getMutableAttribute(ge.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:h}=this._computeStartEnd(a,n,r,this.offset,this.width,this.length);e.unprojectFromScreen((0,m.c$)(c),ot),l[0]=ot[0],l[1]=ot[1],l[2]=ot[2],e.unprojectFromScreen((0,m.c$)(h),ot),l[3]=ot[0],l[4]=ot[1],l[5]=ot[2],t.geometryVertexAttributeUpdated(s,ge.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:n,width:a,length:r,offset:o}=this,s=ut;s.spatialReference=t.renderer.spatialReference,s.x=n[0],s.y=n[1];const l=this.view.overlayPixelSizeInMapUnits(s)*i,c=a*l,h=r*l,d=o*l;this._updateVertexAttributesDraped(e[0],c,h,d,-1),this._updateVertexAttributesDraped(e[1],c,h,d,1)}_updateVertexAttributesDraped(e,t,i,n,a){var r;const o=null===(r=e.getMutableAttribute(ge.T.POSITION))||void 0===r?void 0:r.data;if(!o)return;const{location:s,direction:l}=this,{start:c,end:h}=this._computeStartEnd(l,s,a,n,t,i);o[0]=c[0],o[1]=c[1],o[2]=Ye.gi,o[3]=h[0],o[4]=h[1],o[5]=Ye.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,n,a,r){const o=(0,w.a)(st,(0,w.s)(st,e[1]*i,e[0]*-i),n+a/2),s=(0,w.i)(lt,(0,w.i)(lt,(0,w.i)(lt,t,(0,w.a)(lt,e,r/2)),o),o);return{start:s,end:(0,w.i)(ct,s,(0,w.a)(ct,e,-r))}}}const ot=(0,_.c)(),st=(0,x.a)(),lt=(0,x.a)(),ct=(0,x.a)(),ht=(0,m.s1)(),dt=(0,m.s1)(),ut=(0,at.T)(0,0,void 0,null);var pt=i(67077),_t=i(41414),gt=i(51378),vt=i(14226),mt=i(81949);class ft extends ae{constructor(e){super(e),this._resources=null,this._transform=(0,mt.a)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,vt.h)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new se.F(e,{pickable:!1,updatePolicy:te.j.SYNC}),i=new oe.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var yt=i(69691),bt=i(78935),Mt=i(67794),St=i(48800);class wt extends ft{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,pt.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,pt.f)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,k.h)(e,this._color)||((0,k.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,k.h)(e,this._outlineColor)||((0,k.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(ge.T.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,e.geometryVertexAttributeUpdated(e.geometries[0],ge.T.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,Mt.Rg)(this._primitive),distanceFieldBoundingBox:Ot,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null===(e=this._texture)||void 0===e?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/xt}createExternalResources(){this._texture=(0,Mt.cU)(this._primitive,this._preferredTextureSize),this._material=new St.A(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,Le.uZ)(2*this._geometrySize,16,128)}calculateMapBounds(e){var t;const i=null===(t=this.object)||void 0===t?void 0:t.geometries[0];if(!i)return!1;const n=i.attributes.get(ge.T.POSITION);return(0,Y.S)(n.data,this.view.renderCoordsHelper.spatialReference,Et,this.view.spatialReference),(0,_t.G1)(e,Et),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:n}=this.view,a=(0,yt.w7)(e,n,bt.o.fromElevationInfo(this.elevationInfo),i),r=(0,p.s)(gt.WM.get(),e.x,e.y,a),o=gt.WM.get();(0,Y.S)(r,e.spatialReference,o,i.spatialReference);const s=this._geometrySize;return(0,ke.dV)(t,null,o,null,[s,s],[0,0,0,1])}}const xt=Mt.hy,Ot=[xt/2,xt/2,1-xt/2,1-xt/2],Et=(0,_.c)();var Tt=i(91526),Ct=i(95774),At=i(66832);class Pt extends ce{constructor(e){super(e),this._maxSize=0,this._position=(0,_.c)(),this._up=(0,_.c)(),this._right=(0,_.c)(),this._renderOccluded=Be.yD.OccludeAndTransparent,this._color=(0,pt.f)(1,0,0,1),this._outlineColor=(0,pt.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Be.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,k.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,k.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:n}=e;this._maxSize=Math.min((0,p.o)(i,t),(0,p.o)(i,n))/3,(0,p.n)(this._up,(0,p.f)(this._up,t,i)),(0,p.n)(this._right,(0,p.f)(this._right,n,i)),(0,p.c)(this._position,i),this.recreateGeometry()}_createObject3DResources(e){const t=new At.E(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new qe.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,p.h)(this._up,_.Z)&&(0,p.h)(this._right,_.Z))return;const n=this._createGeometries(t,i);for(const a of n)e.addGeometry(a);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new At.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new qe.U(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new Xe.z(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,s.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:i,right:n,corner:a}=this._getVertices(),r=this._quadGeometryData(i,n,a,e);return t?[r,(0,ke.rh)(t,[i,a,n])]:[r]}_getVertices(){let e=this._up,t=this._right;const i=(0,p.g)(gt.WM.get(),e,t);return this.isDraped&&(e=(0,p.c)(gt.WM.get(),e),t=(0,p.c)(gt.WM.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,vt.d)(Dt,this._position),(0,vt.b)(Dt,Dt,[n,n,n]),e.transformation=Dt}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:n,_size:a}=this,r=(0,p.c)(gt.WM.get(),n);r[2]=Ye.gi;const o=Rt;o.spatialReference=t.renderer.spatialReference,o.x=r[0],o.y=r[1];const s=a*(this.view.overlayPixelSizeInMapUnits(o)*i),l=Math.min(this._maxSize,s);(0,vt.d)(Dt,r),(0,vt.b)(Dt,Dt,[l,l,1]);for(const c of e)c.transformation=Dt}_quadGeometryData(e,t,i,n){return new Ct.Z(n,[[ge.T.POSITION,new Tt.a([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const Dt=(0,mt.a)(),Rt=(0,at.T)(0,0,void 0,null);var It=i(38054),Lt=i(76014),Gt=i(80371),zt=i(64674),Vt=i(38561),jt=i(53397);class Ht extends Vt.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof jt.w?t.length:0)-(e instanceof jt.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t,a=Nt(t);return(0,r.ed)(new wt({view:n,primitive:"circle",geometry:(0,It.Ju)(e.intersectionPoint,i),elevationInfo:e.isDraped?g.tR:g.jG,size:20,outlineSize:2,color:a.intersectionPointColor,outlineColor:a.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),o=Ut(e.point,e.domain,t);return(0,r.ed)(new wt({view:i,primitive:"circle",geometry:(0,It.Ju)(o,n),elevationInfo:Ft(e,t),size:20,outlineSize:2,color:a.pointColor,outlineColor:a.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),o=Ut(e.lineStart,e.domain,t),s=Ut(e.lineEnd,e.domain,t);return(0,r.ed)(this._createLineSegmentHint(e.type,o,s,n,Ft(e,t),i,a,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),{isDraped:o}=e,s=Ft(e,t),l=Ut(e.lineStart,e.domain,t),c=Ut(e.lineEnd,e.domain,t),h=Wt(l,n,s,i,o),d=Wt(c,n,s,i,o),u=(0,p.p)(d,h,d,.5),_=new rt({view:i,attached:!1,offset:Lt.c.parallelLineHintOffset,length:Lt.c.parallelLineHintLength,width:Lt.c.parallelLineHintWidth,color:a.parallelSignColor,location:u,renderOccluded:o?Be.yD.OccludeAndTransparent:Be.yD.Opaque,isDraped:o,renderGroup:$.eZ.SnappingHint,isDecoration:!0});return _.setDirectionFromPoints(h,u),_.attached=!0,(0,r.ed)(_)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),o=Ft(e,t),{isDraped:s}=e,l=Ut(e.previousVertex,e.domain,t),c=Ut(e.centerVertex,e.domain,t),h=Ut(e.nextVertex,e.domain,t),d=Wt(l,n,o,i,s),u=Wt(c,n,o,i,s),p=Wt(h,n,o,i,s);return(0,r.ed)(new Pt({view:i,attached:!0,color:s?a.rightAngleColorDraped:a.rightAngleColor,renderOccluded:s?Be.yD.OccludeAndTransparent:Be.yD.Transparent,outlineRenderOccluded:s?Be.yD.OccludeAndTransparent:Be.yD.Opaque,outlineColor:a.rightAngleOutlineColor,outlineSize:Lt.c.rightAngleHintOutlineSize,size:Lt.c.rightAngleHintSize,isDraped:s,geometry:{previous:d,center:u,next:p},renderGroup:$.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,n,a,r,o){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const h=Wt(t,n,a,r,s),d=Wt(i,n,a,r,s),u=new Qe({view:r,extensionType:tt.FADED,start:h,end:d,isDraped:s,color:o.lineColor,renderOccluded:s?Be.yD.OccludeAndTransparent:Be.yD.Opaque,renderGroup:$.eZ.SnappingHint,isDecoration:!0});switch(e){case zt.ze.TARGET:u.width=Lt.c.lineHintWidthTarget,u.fadedExtensions={start:0,end:Lt.c.lineHintFadedExtensions};break;case zt.ze.REFERENCE_EXTENSION:u.width=Lt.c.lineHintWidthReference,u.fadedExtensions={start:0,end:0};break;case zt.ze.REFERENCE:u.width=Lt.c.lineHintWidthReference,u.fadedExtensions={start:l?Lt.c.lineHintFadedExtensions:0,end:c?Lt.c.lineHintFadedExtensions:0}}return u.attached=!0,u}}function Nt(e){const{effectiveTheme:t}=e.view,i=f.Z.toUnitRGBA(t.accentColor),n=[0,0,0,0];return{intersectionPointColor:n,intersectionPointOutlineColor:i,pointColor:n,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:f.Z.toUnitRGBA((0,a.G)(t.accentColor,.5)),rightAngleOutlineColor:i}}function Ut(e,t,i){const n=Zt(t,i);return null==n?e:(0,It.Ue)(e[0],e[1],n)}function Ft(e,t){return null!=Zt(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?g.tR:g.jG}function Zt(e,t){let{selfSnappingZ:i}=t;return e===Gt.B.SELF&&null!=i?i.value:null}function Wt(e,t,i,n,a){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,_.c)();if(a){const i=n.basemapTerrain.overlayManager.renderer.spatialReference;(0,Y.S)(e,t,r,i)}else(0,F.RS)(e,t,i,n,r);return r}var Yt=i(67331);function kt(e){const{graphic:t}=e;return[(0,s.YP)((()=>e.displaying),(e=>{e?function(e){const{geometry:t}=e;Xt(t)&&e.notifyMeshTransformChanged({action:Yt.u.EnableFastUpdates})}(t):Bt(t)}),{...s.tX}),(0,r.kB)((()=>Bt(t)))]}function Bt(e){const{geometry:t}=e;Xt(t)&&e.notifyMeshTransformChanged({action:Yt.u.DisableFastUpdates})}function Xt(e){return"mesh"===(null===e||void 0===e?void 0:e.type)&&!e.vertexSpace.isGeoreferenced}var qt=i(86700);const Qt=.3;function Jt(e,t){t&&Object.assign(e,t)}class Kt{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=Be.yD.Opaque,this.color=e.accent}}class $t{constructor(e){let{colors:t,...i}=e;this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.accent,this.outlineColor=t.outline,this.renderOccluded=Be.yD.Opaque,this.hoverOutlineColor=t.selectedOutline,Jt(this,i)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:(0,a.O)(e),renderOccluded:this.renderOccluded})}}class ei{constructor(e){let{colors:t,...i}=e;this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=Be.yD.Transparent,this.minSquaredEdgeLength=900,this.color=(0,a.G)(t.accent,.5),this.hoverColor=t.accent,Jt(this,i)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:(0,a.O)(e),renderOccluded:this.renderOccluded})}}class ti{constructor(e){this.vertex=new $t({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new $t({colors:e,color:(0,a.vG)((0,a.G)(e.accent,2/3),.5),outlineColor:(0,a.G)(e.outline,.5),size:8,collisionPadding:8}),this.selected=new $t({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new ei({colors:e})}}class ii{constructor(e){let{colors:t,...i}=e;this.width=1.5,this.stipplePattern=(0,qt.z5)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=Be.yD.OccludeAndTransparent,this.color=t.selected,this.stippleOffColor=t.outline,this.innerColor=t.selected,Jt(this,i)}apply(e){e.color=(0,a.O)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,a.O)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,a.O)(this.innerColor),e.renderOccluded=this.renderOccluded}}class ni{constructor(e){let{colors:t,...i}=e;this.size=4,this.outlineSize=1,this.shape="square",this.color=t.selected,this.outlineColor=t.outline,Jt(this,i)}apply(e){e.color=(0,a.O)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,a.O)(this.outlineColor),e.primitive=this.shape}}class ai{constructor(e){let{colors:t,...i}=e;this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Qt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=t.selected,this.glowColor=t.accent,this.heightFillColor=t.accent,Jt(this,i)}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i={glowColor:f.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:f.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class ri{constructor(e){this.outline=new ii({colors:e,color:e.stippleOff,renderOccluded:Be.yD.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new ii({colors:e,color:e.stippleOn,renderOccluded:Be.yD.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new ai({colors:e,globalAlpha:Qt,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class oi{constructor(e){this.outline=new ni({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ai({colors:e,globalAlpha:Qt,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class si extends ii{constructor(e){let{colors:t,...i}=e;super({colors:t}),this.extensionType=tt.GROUND_RAY,Jt(this,i)}}class li{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineGraphics=new ri(e),this.pointGraphics=new oi(e),this.heightPlane=new ai({colors:e,globalAlpha:Qt,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new ai({colors:e,globalAlpha:Qt,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new si({colors:e,color:(0,a.G)(e.accent,.5),falloff:2,innerColor:(0,a.G)(e.selected,0),renderOccluded:Be.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:tt.GROUND_RAY})}}let ci=class extends y.Z{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:(0,a.mj)(e),selected:f.Z.fromArray([255,255,255,t]),selectedOutline:f.Z.fromArray([255,255,255,t]),staged:f.Z.fromArray([12,207,255,t]),stagedSolid:f.Z.fromArray([12,207,255,1]),outline:f.Z.fromArray([0,0,0,.5*t]),stippleOn:f.Z.fromArray([255,255,255,1]),stippleOff:f.Z.fromArray([0,0,0,.5])}}get visualElements(){return new li(this.colors)}get manipulators(){return new ti(this.colors)}get zManipulator(){return new Kt(this.colors)}};(0,n._)([(0,l.Cb)()],ci.prototype,"colors",null),(0,n._)([(0,l.Cb)()],ci.prototype,"visualElements",null),(0,n._)([(0,l.Cb)()],ci.prototype,"manipulators",null),(0,n._)([(0,l.Cb)()],ci.prototype,"zManipulator",null),(0,n._)([(0,l.Cb)()],ci.prototype,"getTheme",void 0),ci=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.settings.Settings")],ci);var hi=i(91505),di=i(50628),ui=i(79685),pi=i(78081);class _i extends ce{constructor(e){var t;super(e),this._attachmentOrigin=(0,at.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new hi.Z,this._geometry=null,this._width=1,this._color=(0,B.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,B.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Be.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Ze({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=null===(t=e.attached)||void 0===t||t}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,k.h)(e,this._color)||((0,k.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,k.h)(e,this._innerColor)||((0,k.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,k.h)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,B.c)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=null===(e=this.object3dResources.resources)||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,p.s)(vi,0,0,0);let i=0;for(const n of t)n.computeAttachmentOrigin(gi)&&((0,p.g)(vi,vi,gi),i++);return 0===i?null:((0,p.i)(vi,vi,1/i),this.view.renderCoordsHelper.fromRenderCoords(vi,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Be.yD.OccludeAndTransparentStencil?Be.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){this._createRenderGeometries(t,i);for(const n of i)e.addGeometry(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[]}_createObject3DResources(e){const t=new qe.U(this._materialParameters),i=new Array;return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new qe.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:i}=this,n=i.basemapTerrain.spatialReference;return null==t||null==n?[]:(0,pi.r)(t,n).lines.map((t=>{let{position:a}=t;const r={overlayInfo:{spatialReference:n,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:a},removeDuplicateStartEnd:this._isClosed};return new Xe.z((0,ui.Y)(e,r))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const n=i.attributes.get(ge.T.POSITION),a=(0,de.bg)(n.data.length);(0,di.projectBuffer)(n.data,t.spatialReference,0,a,this.view.spatialReference,0,n.data.length/3),(0,_t.G1)(e,a)}return!0}_createRenderGeometries(e,t){var i;const n=this.geometry;if(null==n)return;const a=(0,pi.V)(n,this.view.elevationProvider,this.view.renderCoordsHelper,bt.o.fromElevationInfo(null!==(i=this.elevationInfo)&&void 0!==i?i:new v.Z({mode:(0,g.VW)(n,null)}))),r=new Array;for(const{position:o,mapPositions:s}of a.lines){const i={mapPositions:s,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};t.push((0,ui.Y)(e,i)),r.push(o)}this._laserline.pathVerticalPlane=r}}const gi=(0,_.c)(),vi=(0,_.c)();var mi=i(68401),fi=i(25158),yi=i(37081),bi=i(23620),Mi=i(97731),Si=i(33236),wi=i(78041),xi=i(25920),Oi=i(8883),Ei=i(72511);class Ti extends me.A{initializeProgram(e){return new fe.$(e.rctx,Ti.shader.get().build(this.configuration),Ai)}_setPipelineState(e){const t=this.configuration,i=e===xi.A.NONE,n=e===xi.A.FrontFace;return(0,Me.sm)({blending:t.output!==yi.H.Color&&t.output!==yi.H.Alpha||!t.transparent?null:i?wi.wu:(0,wi.j7)(e),culling:(0,Me.zp)(t.cullFace),depthTest:{func:n?be.wb.LESS:t.shadingEnabled?be.wb.LEQUAL:be.wb.LESS},depthWrite:i?t.writeDepth?Me.LZ:null:(0,wi.K5)(e),colorWrite:Me.BK,polygonOffset:i||n?null:wi.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Ti.shader=new ve.J(Ei.S,(()=>i.e(6556).then(i.bind(i,36556))));class Ci extends Oi.W{constructor(){super(...arguments),this.output=yi.H.Color,this.cullFace=mi.Vr.None,this.transparencyPassType=xi.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,n._)([(0,Re.o)({count:yi.H.COUNT})],Ci.prototype,"output",void 0),(0,n._)([(0,Re.o)({count:mi.Vr.COUNT})],Ci.prototype,"cullFace",void 0),(0,n._)([(0,Re.o)({count:xi.A.COUNT})],Ci.prototype,"transparencyPassType",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"transparent",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"writeDepth",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"screenSizeEnabled",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"shadingEnabled",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"multipassEnabled",void 0),(0,n._)([(0,Re.o)()],Ci.prototype,"cullAboveGround",void 0),(0,n._)([(0,Re.o)({constValue:!1})],Ci.prototype,"occlusionPass",void 0);const Ai=new Map([[ge.T.POSITION,0],[ge.T.NORMAL,1],[ge.T.OFFSET,2]]);class Pi extends Be.F5{constructor(e){super(e,new Ri),this.supportsEdges=!0,this._configuration=new Ci,this._vertexAttributeLocations=Ai}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,n,a,r){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(ge.T.OFFSET),o={applyToVertex:(e,n,a,r)=>{const o=(0,p.s)(Li,t.data[3*r],t.data[3*r+1],t.data[3*r+2]),s=(0,p.s)(Gi,e,n,a);return(0,p.i)(o,o,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(o)),(0,p.g)(s,s,o),[s[0],s[1],s[2]]},applyToAabb:e=>{const t=(0,_t.be)(e,Li);return(0,_t.bA)(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};(0,De.Bw)(e,i,n,a,o,r)}else(0,De.Bw)(e,i,n,a,void 0,r)}produces(e,t){if(t===yi.H.Highlight)return e===Pe.r.OPAQUE_MATERIAL;if(t===yi.H.Color||t===yi.H.Alpha||t===yi.H.ObjectAndLayerIdColor){let t=Pe.r.OPAQUE_MATERIAL;return this._isTransparent&&(t=this.parameters.writeDepth?Pe.r.TRANSPARENT_MATERIAL:Pe.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===Pe.r.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new Di(e)}createBufferWriter(){return new Ii(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class Di extends bi.Z{beginSlot(e){return this.ensureTechnique(Ti,e)}}class Ri extends Be.Mt{constructor(){super(...arguments),this.color=(0,pt.f)(1,1,1,1),this.shadingTint=(0,pt.f)(0,0,0,.25),this.shadingDirection=(0,p.n)((0,_.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=mi.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class Ii{constructor(e){this.screenSizeEnabled=e;const t=(0,pe.U$)().vec3f(ge.T.POSITION).vec3f(ge.T.NORMAL);this.screenSizeEnabled&&t.vec3f(ge.T.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(ge.T.POSITION).indices.length}write(e,t,i,n,a){if((0,Si.NK)(i,this.vertexBufferLayout,e,t,n,a),this.screenSizeEnabled){if(!i.attributes.has(ge.T.OFFSET))throw new Error("".concat(ge.T.OFFSET," vertex attribute required for screenSizeEnabled ShadedColorMaterial"));{const e=i.attributes.get(ge.T.OFFSET);(0,Mi.hu)(3===e.size);const r=n.getField(ge.T.OFFSET,fi.ct);if(!r)throw new Error("unable to acquire view for "+ge.T.OFFSET);(0,Si.ho)(e,t,r,a)}}}}const Li=(0,_.c)(),Gi=(0,_.c)();class zi extends ft{constructor(e){super(e),this.view=null,this._renderOccluded=Be.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,pt.b)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,pt.b)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,k.h)(e,this._color)||((0,k.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,k.h)(e,this._outlineColor)||((0,k.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,i,n,a){const r=(0,de.bg)(3*e.length),o=(0,de.bg)(r.length);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));const s=(0,yt.rR)(r,t,0,o,0,r,0,r.length/3,i,n,a),l=null!=s;return{numVertices:e.length,position:r,mapPositions:o,projectionSuccess:l,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,bt.o.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position;for(let r=0;r<n;++r){const e=(0,p.s)(Vi,a[3*r],a[3*r+1],a[3*r+2]),t=ji(this._vertexMaterial,.5,e),n=ji(this._vertexOutlineMaterial,.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:n})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new Pi({...this._vertexMaterialParameters,writeDepth:!0,cullFace:mi.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Pi({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:mi.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const Vi=(0,_.c)();function ji(e,t,i){return(0,ke.PI)(e,t,16,16,{offset:i})}var Hi=i(94687),Ni=i(49076),Ui=i(71719),Fi=i(46640),Zi=i(4035);let Wi=class extends Ni.T2{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new ci({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new v.Z({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null===(t=e.hasZ)||void 0===t||t;return{...e,elevationInfo:(0,g.mF)(i)}}return e}initializeGraphic(e){const{view:t}=this,i=this._createGraphicState=new Hi.F({graphic:e});return(0,r.AL)([t.maskOccludee(e),t.trackGraphicState(i),(0,s.YP)((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(e=>{let{element:t,isDraped:i}=e;t&&(t.isDraped=i)}),s.tX),this._setupLoadingIndicator(i),...kt(i)])}updateDrawMeshTooltipInfo(e){const{graphic:t,tooltipOptions:i,view:n}=this;e.tooltipOptions=i,e.viewType=n.type,e.helpMessage=(0,Zi.getDrawMeshHelpMessage)(t,this.view),this.updateElevation(e.elevation)}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Ui.wW({view:this.view,manipulators:this.manipulators,geometryType:(0,Ni.IJ)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Fi.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Fi.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ht,segmentLabels:t?new Z:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,g.Zz)(this.hasZ,this.elevationInfo),cursor:this.cursor})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),(0,r.kB)();const i=this._settings,n=i.manipulators.vertex,l=new zi({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=i.visualElements.zVerticalLine,h=new Qe({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=h;const d=(0,r.AL)([(0,s.YP)((()=>i.visualElements.zVerticalLine),(e=>e.apply(h)),s.nn),(0,s.YP)((()=>({selectedColor:(0,a.O)(i.colors.selected),outlineColor:(0,a.O)(i.manipulators.vertex.outlineColor)})),(e=>{let{selectedColor:t,outlineColor:i}=e;l.color=t,l.outlineColor=i}),s.nn),(0,r.kB)((()=>{this._activeVertexVisualElement=(0,o.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,o.SC)(this._verticalLineVisualElement)}))]);return l.attached=!0,d}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:i,elevationProvider:n}=this.view;(0,p.s)(ki,e[0],e[1],e[2]),Yi.setFromElevationInfo(this.elevationInfo),ki[2]=(0,yt.w7)(ki,n,Yi,i),i.toRenderCoords(ki,this.view.spatialReference,ki)?(t.setStartEndFromWorldDownAtLocation(ki),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,r.kB)();const t=this.internalGraphicsLayer.elevationInfo,{view:i}=this,n=this._settings,a=new _i({view:i,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,g.Zz)(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=a;const l=(0,r.AL)([(0,s.YP)((()=>n.visualElements.lineGraphics.outline),(e=>e.apply(a)),s.nn),(0,s.YP)((()=>n.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),s.nn),(0,r.kB)((()=>{this._outlineVisualElement=(0,o.SC)(this._outlineVisualElement)}))]);return a.attached=!0,a.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,r.kB)();const{view:t}=this,i=this._settings,n=i.manipulators.vertex,l=new zi({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0}),c=(0,r.AL)([(0,s.YP)((()=>({color:(0,a.O)(i.manipulators.vertex.color),outlineColor:(0,a.O)(i.manipulators.vertex.outlineColor)})),(e=>{let{color:t,outlineColor:i}=e;l.color=t,l.outlineColor=i}),s.nn),(0,r.kB)((()=>{this._verticesVisualElement=(0,o.SC)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e,t){if("mesh"===this.geometryType&&"point"===(null===t||void 0===t?void 0:t.type)){const i=this.geometryToPlace;return i&&i.centerAt(t),void(i&&e.geometry===i?i.vertexSpace.isGeoreferenced?e.notifyGeometryChanged():e.notifyMeshTransformChanged():e.geometry=i)}super.updateGraphicGeometry(e,t)}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const i=(0,r.kB)((()=>{t.loading=!1}));let n;const a=()=>n&&cancelAnimationFrame(n);return(0,r.AL)([(0,s.gx)((()=>e.displaying),(()=>{a(),n=requestAnimationFrame((()=>i.remove()))}),{...s.tX,once:!0}),(0,r.kB)(a),i])}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Wi.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Wi.prototype,"geometryType",void 0),(0,n._)([(0,l.Cb)()],Wi.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Wi.prototype,"view",void 0),Wi=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Wi);const Yi=new bt.o,ki=(0,_.c)();var Bi=i(40281),Xi=i(47898),qi=i(46634),Qi=i(37818),Ji=(i(59486),i(41644)),Ki=i(22753),$i=i(11873),en=i(83448),tn=i(79803),nn=i(73680),an=i(96334),rn=i(65156),on=i(55652),sn=i(77648);function ln(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,J.Ue)();return cn(e,(0,m.md)(t),i),(0,p.n)(i.direction,i.direction),i}function cn(e,t,i){return function(e,t,i){const n=(0,m.Wv)((0,w.j)(gt.WM.get(),t));if(n[2]=0,!e.unprojectFromRenderScreen(n,i.origin))return null;const a=(0,m.Wv)((0,w.j)(gt.WM.get(),t));a[2]=1;const r=e.unprojectFromRenderScreen(a,gt.WM.get());return null==r?null:((0,p.f)(i.direction,r,i.origin),i)}(e,e.screenToRender(t,(0,m.Wv)(gt.WM.get())),i)}var hn=i(86755),dn=i(99034),un=i(585);class pn{constructor(e){var t;this.metadata=void 0,this._camera=new hn.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,mt.a)(),this._worldFrame=null,this._renderLocation=(0,_.c)(),this._renderLocationDirty=!0,this._location=new un.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new un.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=dn.jg.None,this._focused=!1,this.events=new hi.Z.EventEmitter,this._screenLocation={screenPointArray:(0,m.s1)(),renderScreenPointArray:(0,m.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const i=null===(t=this.view.state)||void 0===t?void 0:t.camera;i&&this._camera.copyFrom(i)}destroy(){this._applyObjectTransform=An,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return null===(e=this.view)||void 0===e?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,r.kB)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){_n(e)&&(this._screenLocationDirty=!0),(0,vt.h)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,mt.a)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,vt.g)(i),!0;case"global":{const n=(0,en.Iu)(e.renderCoordsHelper.spatialReference);(0,an.PR)(t,0,Sn,0,n.radius),(0,nn.y)((0,Le.Vl)(Sn[0]),(0,Le.Vl)(Sn[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,Qi.WG)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,Qi.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,Qi.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,_n(this._modelTransform)){const t=this._calculateModelTransformOffset(Tn);e=(0,p.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,m.md)(e,gn),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,w.k)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,bn),o=n*this.screenLocation.pixelSize,s=cn(this._camera,i,mn);if(null==s)return null;for(const i of e){if(0===i.length)continue;const e=(0,p.e)(Sn,i[0],r);for(let t=1;t<i.length;t++){const n=(0,p.e)(wn,i[t],r),l=(0,Q.Gr)((0,Q.zk)(e,n,vn),s);if(null!=l&&l<o*o){const t=(0,p.g)(gt.WM.get(),e,n);(0,p.i)(t,t,.5);const i=(0,m.So)(gt.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,p.c)(e,n)}}break}case"disc":{var r;const e=this.collisionType.direction,t=null!==(r=this.collisionType.offset)&&void 0!==r?r:_.Z,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,bn),l=n*this.screenLocation.pixelSize,c=cn(this._camera,i,mn);if(null==c)return null;const h=(0,Ki.f)(fn,s),d=(0,p.t)(On,e,h),u=(0,p.e)(En,t,s);(0,on.Yq)(u,d,Mn);const g=xn;if((0,on.BR)(Mn,c,g)&&(0,p.a)(g,u)<l*l)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,bn),s=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=cn(this._camera,i,mn);if(null==l)return null;const c=(0,Ki.f)(fn,o),h=(0,p.t)(On,t,c),d=this._calculateModelTransformPosition(En);(0,on.Yq)(d,h,Mn);const u=xn;if(!(0,on.BR)(Mn,l,u))break;for(const i of e){if(0===i.length)continue;const e=(0,p.e)(Sn,i[0],o);for(let t=1;t<i.length;t++){const n=(0,p.e)(wn,i[t],o),r=(0,Q.Jk)((0,Q.zk)(e,n,vn),u);if(null!=r&&r<s*s){const t=(0,p.g)(gt.WM.get(),e,n);(0,p.i)(t,t,.5);const i=(0,m.So)(gt.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,p.c)(e,n)}}break}default:(0,Ji.Bg)(this.collisionType)}return null}attach(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new se.F(t,{pickable:!1,updatePolicy:te.j.SYNC}),i.engineLayerId=this._engineLayer.id):(null===t||void 0===t?void 0:t.getObject)&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,tn.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new un.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}}).manipulator3D;e.engineLayerReferences--;const t=0===e.engineLayerReferences;this._removeResourcesFromStage(),t&&(e.engineLayerId=null,(0,o.SC)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,tn.projectPoint)(this.location,Cn,e.spatialReference)&&(0,rn.Qn)(e.extent,Cn)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){var e,t,i,n;if(null==this.elevationInfo)return;let a=null,r=0;const o=null!==(e=this.elevationInfo.offset)&&void 0!==e?e:0;switch(this.elevationInfo.mode){case"on-the-ground":a=null!==(t=(0,sn.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==t?t:0;break;case"relative-to-ground":r=(null!==(i=(0,sn.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==i?i:0)+o;break;case"relative-to-scene":r=(null!==(n=(0,sn.KO)(this.view.elevationProvider,this.location,"scene"))&&void 0!==n?n:0)+o;break;case"absolute-height":r=o}return r!==this._elevation.offset||a!==this._elevation.override?(this._elevation.offset=r,void(this._elevation.override=a)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=bn;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?dn.Q9.Focused:dn.Q9.Unfocused)|(this.selected?dn.Q9.Selected:dn.Q9.Unselected),a=this._noDisplayCount>0;for(const{stateMask:r,objects:o}of i){if(a){for(const e of o)e.visible=!1;continue}const e=(r&dn.Q9.All)!==dn.Q9.None,i=(r&dn.jg.All)!==dn.jg.None,s=!e||(n&r)==(r&dn.Q9.All),l=!i||(this.state&r)==(r&dn.jg.All);if(s&&l)for(const n of o)n.visible=!0,n.transformation=t;else for(const t of o)t.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((e=>{let{geometry:{material:n}}=e;i.has(n)||(t.push(n),i.add(n))}));const n=new Map;this._renderObjects.forEach((e=>{const t=new oe.T({castShadow:!1,geometries:[e.geometry]}),i=n.get(e.stateMask)||[];i.push(t),n.set(e.stateMask,i)}));const a=[];n.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id)||0;0===n&&e.add(t),i.set(t.id,n+1)})),t.forEach((t=>{let{objects:n}=t;i.addMany(n),e.addMany(n)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;t.forEach((t=>{let{objects:n}=t;i.removeMany(n),e.removeMany(n)})),n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id);1===n?(e.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,yn);return(0,p.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,p.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,vt.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,vt.m)(t,t,this._worldFrame),(0,vt.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){let e=!1;if(null!=this._engineResources)for(const t of this._engineResources.objectsByState){for(const i of t.objects)if(i.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function _n(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const gn=(0,m.s1)(),vn=(0,Q.Ue)(),mn=(0,J.Ue)(),fn=(0,$i.a)(),yn=(0,mt.a)(),bn=(0,mt.a)(),Mn=(0,on.Ue)(),Sn=(0,_.c)(),wn=(0,_.c)(),xn=(0,_.c)(),On=(0,_.c)(),En=(0,_.c)(),Tn=(0,_.c)(),Cn=new un.Z({x:0,y:0,z:0,spatialReference:null}),An=()=>{};class Pn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dn.Q9.None;this.geometry=e,this.stateMask=t}}var Dn=i(96387);function Rn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Be.yD.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=(0,a.gp)(e),r=!(e[3]<1);return i?new Pi({color:n,writeDepth:r,cullFace:mi.Vr.Back,renderOccluded:t,isDecoration:!0}):new At.E({color:n,writeDepth:r,cullFace:mi.Vr.Back,renderOccluded:t,isDecoration:!0})}function In(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Be.yD.OccludeAndTransparent;const i=(0,a.gp)(e);return new At.E({color:i,writeDepth:!0,cullFace:mi.Vr.Front,renderOccluded:t,isDecoration:!0})}const Ln=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1});const Gn=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function zn(e,t,i,n){const a=(0,p.f)(gt.WM.get(),e,i),r=Vn(a,(0,p.b)(gt.WM.get(),n,a),i,gt.MP.get());(0,vt.i)(r,r);const o=(0,p.e)(gt.WM.get(),t,r);return Math.atan2(o[1],o[0])}function Vn(e,t,i,n){const a=(0,p.n)(gt.WM.get(),e),r=(0,p.n)(gt.WM.get(),t),o=(0,p.b)(gt.WM.get(),a,r);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function jn(e,t){const i=e.getViewForGraphic(t);return null!=i&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function Hn(e,t,i){const n=jn(e,i);null==n?function(e,t){if(null==t)return;const i="mesh"===t.type?t.anchor:(0,Dn.zE)(t);null!=i&&(e.location=(0,Qi.kB)(i))}(t,i.geometry):t.elevationAlignedLocation=n}var Nn=i(55793);function Un(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings;for(const i of t)for(let e=0;e<i.length-1;e++){const t=i[e],n=i[e+1],a=t[0]-n[0],r=t[1]-n[1];if(a*a+r*r>Nn.Ho)return Math.atan2(n[1]-t[1],n[0]-t[0])}return 0}var Fn=i(77498);function Zn(e){return"on-the-ground"!==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(e)).mode&&!(null==e.geometry||!e.geometry.hasZ)}var Wn,Yn,kn=i(76432);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Wn||(Wn={})),function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Yn||(Yn={}));class Bn{constructor(){this.grabbingState=Wn.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Wn.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===Yn.TRANSLATE_Z&&(this.zManipulator=e),e instanceof pn&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&t===Yn.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Wn.ANY,t){case Yn.TRANSLATE_Z:this.grabbingState|=Wn.Z;break;case Yn.TRANSLATE_XY:this.grabbingState|=Wn.XY}}))}}function Xn(e){const{view:t,graphic:i}=e,n=new Hi.F({graphic:i}),a=function(e,t){const{view:i,graphic:n}=e,a=new _i({view:i,geometry:Qn(n)?n.geometry:null,elevationInfo:(0,g.RL)(n),attached:!1,isDecoration:!0}),o=new ci({getTheme:()=>i.effectiveTheme}),l=()=>{a.attached=t.displaying},c=(0,r.AL)([(0,s.YP)((()=>o.visualElements.lineGraphics.outline),(e=>e.apply(a)),s.nn),(0,s.YP)((()=>o.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),s.nn),(0,s.YP)((()=>t.displaying),l),(0,s.YP)((()=>t.isDraped),(e=>{a.isDraped=e})),t.on("changed",(()=>a.geometry=Qn(n)?n.geometry:null)),(0,r.ed)(a)]);return l(),{visualElement:a,remove:()=>c.remove()}}(e,n),o=[a,qn(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:()=>(0,r.R5)(o)}}function qn(e,t,i){const{graphic:n,view:a}=e,o=[],l=(0,g.RL)(n),c="on-the-ground"===l.mode||!l.offset&&"absolute-height"!==l.mode,h=new Bn,d=new ci({getTheme:()=>a.effectiveTheme}),u=d.visualElements,_=new Qe({view:a,extensionType:u.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0}),v=(0,Le.Vl)(u.heightPlaneAngleCutoff),m=new Ze({view:a,attached:!1,angleCutoff:v,isDecoration:!0}),f=(0,kn.t)(1);o.push((0,s.YP)((()=>({lineShadowStyle:d.visualElements.lineGraphics.shadowStyle,pointShadowStyle:d.visualElements.pointGraphics.shadowStyle,alpha:f.value})),(e=>{let{lineShadowStyle:i,pointShadowStyle:n,alpha:a}=e;i.apply(t,a),n.apply(_,a)}),s.nn));const y=(0,kn.t)(1);o.push((0,s.YP)((()=>({heightPlane:d.visualElements.heightPlane,alpha:y.value})),(e=>{let{heightPlane:t,alpha:i}=e;return t.apply(m,i)}),s.nn));const b=()=>{if(h.update(e),!i.displaying||c&&(i.isDraped||!Qn(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,_.attached=!1,void(m.attached=!1);t.laserlineEnabled=!0;const a=h.grabbingState&Wn.XY?u.laserlineAlphaMultiplier:1;f.value=a;const r=h.grabbingState&Wn.Z?u.laserlineAlphaMultiplier:1;y.value=r,function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=i?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(_,h),function(e,t,i,n){if(n.numSelected>0){(0,p.s)(Jn,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===Yn.TRANSLATE_XY&&e.selected&&e instanceof pn&&((0,p.g)(Jn,Jn,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,p.i)(Jn,Jn,1/t),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;null!=n&&e.view.renderCoordsHelper.toRenderCoords(n,Jn)?(i.heightManifoldTarget=Jn,i.attached=!0):i.attached=!1}}(e,t,m,h)};o.push((0,s.YP)((()=>d.visualElements.zVerticalLine),(e=>e.apply(_)),s.nn)),o.push(i.on("changed",b),(0,s.YP)((()=>i.displaying),b),t.events.on("attachment-origin-changed",b),(0,r.ed)(_),(0,r.ed)(m));const M=[],S=()=>{(0,r.R5)(M),M.length=0,e.forEachManipulator((e=>M.push(e.events.on("grab-changed",b)))),e.forEachManipulator((e=>M.push(e.events.on("select-changed",b)))),b()};return S(),o.push(e.onManipulatorsChanged(S),(0,r.iU)((()=>(0,r.AL)(M)))),(0,r.AL)(o)}function Qn(e){return null!=e.geometry&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const Jn=(0,_.c)();var Kn=i(68859);function $n(e){const{view:t,graphic:i}=e,n=new Hi.F({graphic:i}),a=[],o=function(e,t,i){const{view:n,graphic:a}=e,o=new wt({view:n,geometry:ea(a),elevationInfo:(0,g.RL)(a),isDecoration:!0});return function(e,t,i,n){const a=()=>{t.attached=i.displaying},o=new ci({getTheme:()=>e.view.effectiveTheme});(function(e,t,i,n){const{view:a,graphic:o}=e;let s=null;const l=e=>{null!=s&&(s.remove(),s=null),i.isDraped&&null!=e&&(s=function(e,t,i){const n=e.elevationProvider.spatialReference;(0,Kn.K)(t,ta,n);const a=ta[0],r=ta[1];return e.elevationProvider.on("elevation-change",(e=>{(0,rn.jE)(e.extent,a,r)&&i()}))}(a,e,(()=>{t.geometry=e})))},c=()=>{const e=ea(o);l(e),t.geometry=e};n.push(i.on("changed",c),(0,r.iU)((()=>s))),c()})(e,t,i,n),o.visualElements.pointGraphics.outline.apply(t),n.push((0,s.YP)((()=>i.displaying),a,s.nn))}(e,o,t,i),i.push((0,r.ed)(o)),o}(e,n,a);return function(e,t,i,n){const{view:a,graphic:o}=e,l=new ci({getTheme:()=>a.effectiveTheme}),c=new Qe({view:a,extensionType:l.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0});i.push((0,s.YP)((()=>l.visualElements.zVerticalLine),(e=>e.apply(c)),s.nn));const h=new Ze({view:a,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),d=(0,Le.Vl)(l.visualElements.heightPlaneAngleCutoff),u=new Ze({view:a,attached:!1,angleCutoff:d,isDecoration:!0}),_=(0,g.RL)(e.graphic),v=bt.o.fromElevationInfo(_),m="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,f=new Bn,y=(0,kn.t)(1);i.push((0,s.YP)((()=>({heightPlane:l.visualElements.heightPlane,alpha:y.value})),(e=>{let{heightPlane:t,alpha:i}=e;return t.apply(u,i)}),s.nn));const b=(0,kn.t)(1);i.push((0,s.YP)((()=>({shadowStyle:l.visualElements.pointGraphics.shadowStyle,alpha:b.value})),(e=>{let{shadowStyle:t,alpha:i}=e;return t.apply(h,i)}),s.nn));const M=()=>{f.update(e);const i=ea(o),r=m&&(t.isDraped||null==i||!i.hasZ);let s=!0;if(r||null==i)s=!1;else{const e=(0,yt.w7)(i,a.elevationProvider,v,a.renderCoordsHelper);(0,p.s)(ta,i.x,i.y,e),(0,Y.S)(ta,i.spatialReference,ta,a.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(ta),h.intersectsWorldUpAtLocation=ta}const d=f.grabbingState&Wn.Z?l.visualElements.laserlineAlphaMultiplier:1;y.value=d;const _=(0,_t.cS)(ia);!r&&t.displaying&&n.calculateMapBounds(_)&&(0,Y.S)((0,_t.KE)(_,ta),a.spatialReference,ta,a.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=ta,u.attached=!0):u.attached=!1;const g=f.grabbingState&Wn.XY?l.visualElements.laserlineAlphaMultiplier:1;b.value=g;const M=s&&t.displaying&&!r;h.attached=M,c.attached=M};i.push((0,s.YP)((()=>[t.displaying,t.isDraped]),M),t.on("changed",M)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",M))})),i.push((0,r.ed)(h)),i.push((0,r.ed)(c)),i.push((0,r.ed)(u)),M()}(e,n,a,o),a.push(t.trackGraphicState(n)),{visualElement:o,remove:()=>(0,r.R5)(a)}}function ea(e){const t=e.geometry;return null==t?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const ta=(0,_.c)(),ia=(0,_t.Ue)();function na(e){switch(e.graphic.geometry.type){case"point":case"mesh":return $n(e);case"polygon":case"polyline":return Xn(e);default:return null}}const aa=70,ra=Math.ceil(aa/3*2),oa=160,sa=5*Math.PI/12,la=1*Math.PI/3;var ca=i(100);class ha{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof pn&&e(t,i)}))}}var da,ua=i(40927),pa=(i(88153),i(54463),i(76783),i(74229));function _a(e,t){return ga(e,(()=>t))}function ga(e,t){const i=(0,_.c)(),n=(0,_.c)();let a=!1;return r=>{const o=t(r);if("start"===r.action){const t=(0,m.md)(r.screenStart,(0,m.c$)(gt.qW.get())),n=cn(e.state.camera,t,Sa);null!=n&&(a=(0,on.BR)(o,n,i))}if(!a)return null;const s=(0,m.md)(r.screenEnd,(0,m.c$)(gt.qW.get())),l=cn(e.state.camera,s,Sa);return null==l?null:(0,on.BR)(o,l,n)?{...r,renderStart:i,renderEnd:n,plane:o,ray:l}:null}}function va(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=null;return o=>{if("start"===o.action&&(r=e.sceneIntersectionHelper.intersectElevationFromScreen((0,m.s1)(o.screenStart.x,o.screenStart.y),t,i,a),null!=r&&null!=n&&!(0,tn.projectPoint)(r,r,n)))return null;if(null==r)return null;const s=e.sceneIntersectionHelper.intersectElevationFromScreen((0,m.s1)(o.screenEnd.x,o.screenEnd.y),t,i,a);return null==s||null!=n&&!(0,tn.projectPoint)(s,s,n)?null:{...o,mapStart:r,mapEnd:s}}}(e,i,(0,g.Ou)(t,e,i),n,a)}function ma(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return va(e,i,(0,g.RL)(t),n,a)}function fa(e,t,i){let n=null;const a=new pa.hM;return a.next(_a(e,function(e,t){const i=ba,n=Ma,a=(0,on.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,i);const r=(0,p.b)(a,i,(0,p.f)(n,t,e.state.camera.eye));return(0,p.b)(r,r,i),(0,on.Yq)(t,r,a)}(e,t))).next(function(e,t){const i=(0,_.c)(),n=(0,p.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const a=(0,_.c)(),r=(0,_.c)(),o=a=>((0,p.f)(a,a,t),(0,ua.nF)(i,a,a),"global"===e.viewingMode&&(0,p.l)(a)*Math.sign((0,p.j)(i,a))<.001-n&&(0,p.f)(a,(0,p.i)(a,i,.001),t),(0,p.g)(a,a,t),a);return e=>(e.renderStart=o((0,p.c)(a,e.renderStart)),e.renderEnd=o((0,p.c)(r,e.renderEnd)),e)}(e,t)).next(ya(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),e=>(n=null,a.execute(e),n)}function ya(e,t){const i=e.renderCoordsHelper;return e=>{const n=i.fromRenderCoords(e.renderStart,t),a=i.fromRenderCoords(e.renderEnd,t);return null!=n&&null!=a?{...e,mapStart:n,mapEnd:a}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(da||(da={}));const ba=(0,_.c)(),Ma=(0,_.c)(),Sa=(0,J.Ue)();function wa(e,t,i,n){const a=(i,n)=>t({action:i,graphic:e,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY});return i(((t,i,r)=>(i.next((e=>("start"===e.action&&a("start",e),e))).next((0,pa.a9)(e,n)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e})),{steps:i,cancel:r=r.next((0,pa.bD)(e)).next((e=>(a("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))}function xa(e){if(null==(null===e||void 0===e?void 0:e.axis))return 1;const{mapStart:t,mapEnd:i,axis:n}=e,a=[i.x-t.x,i.y-t.y];return a[0]*n[0]+a[1]*n[1]>0?1:-1}class Oa extends ha{constructor(e){super(),this._handles=new ca.Z,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=aa,this._updateAfterDrag=!1,this.events=new hi.Z,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=(0,o.SC)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,g.RL)(n),r=n.geometry.spatialReference;return wa(n,i,(t=>this.createDragPipeline(((i,n,a,r,o)=>(({steps:n,cancel:a}=e(i,n,a,r,o)),t(i,n,a))),a,r,n)),this._view.state.viewingMode)}createDragPipeline(e,t,i,n){return(0,r.AL)(this._arrowManipulatorInfos.map(((a,r)=>{let{manipulator:o}=a;return(0,pa.Xd)(o,((a,o,s,l,c)=>{const h=o.next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,pa.kY)(this._view,a.elevationAlignedLocation)).next(va(this._view,a.elevationAlignedLocation,t,i,n)).next((0,pa.M2)(a.location,this.angle+(r+1)*Math.PI*.5)).next((0,pa.zh)());e(a,h,s,l,c)}))})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator(e,t){let{manipulator:i,transform:n}=e;const a=this._radius/aa,r=54*a,o=r*Math.sqrt(3)/2,s=(0,ke.DA)(this._opaqueMaterial,o,r/2,r/2,.02);(0,ke.mx)(s,(0,vt.d)(gt.MP.get(),(0,p.s)(gt.WM.get(),0,-o/3,0))),i.renderObjects=[new Pn(s,dn.Q9.Focused),new Pn(s.instantiate({material:this._transparentMaterial}),dn.Q9.Unfocused)],i.radius=o/3*2*1.2;const l=(0,vt.j)(gt.MP.get(),t*Math.PI/2),c=(0,vt.d)(gt.MP.get(),(0,p.s)(gt.WM.get(),0,100*a,0));(0,vt.m)(n,l,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,vt.c)(gt.MP.get(),e,(0,_.f)(0,0,1));if(null==t)return;const i=(0,vt.E)(gt.MP.get(),(0,p.s)(gt.WM.get(),this.displayScale,this.displayScale,this.displayScale)),n=(0,vt.m)(gt.MP.get(),i,t);for(const a of this._arrowManipulatorInfos){const e=(0,vt.m)(gt.MP.get(),n,a.transform);a.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new pn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)}}),i={manipulator:t,transform:(0,mt.a)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Transparent,isDecoration:!0});return this._handles.add((0,s.YP)((()=>f.Z.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),s.nn)),t}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((e=>{let{manipulator:t}=e;return t}))}}}class Ea{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(null!=i){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=e}_snap(e){const t=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=t&&null!=this._view&&(t.z=(0,g.Ou)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const i=new pa.hM;return this._next=i,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},i]}}class Ta extends ha{constructor(e){super(),this._handles=new ca.Z,this._snapToScene=new Ea,this._scale=1,this._radius=aa,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,o.SC)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,g.RL)(n),r=n.geometry.spatialReference;return wa(n,i,(t=>this.createDragPipeline(((i,n,a,r,o)=>(({steps:n,cancel:a}=e(i,n,a,r,o)),t(i,n,a))),a,r,n)),this._view.state.viewingMode)}createDragPipeline(e,t,i,n){const a=this._view;return(0,pa.Xd)(this._manipulator,((r,o,s,l,c)=>{const h=o.next((0,pa.kY)(a,r.elevationAlignedLocation)).next(va(a,r.elevationAlignedLocation,t,i,n)).next(...this._snapToScene.createDragEventPipelineStep(a,t)).next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,pa.zh)());e(r,h,s,l,c)}))}_updateManipulatorTransform(){const e=(0,vt.E)(gt.MP.get(),(0,p.s)(gt.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new pn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,ke.nb)(this._discMaterial,.02,1,128,(0,_.f)(0,0,1),(0,_.f)(0,0,0));e.transformation=(0,vt.E)((0,mt.a)(),(0,_.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new Pn(e,dn.Q9.Focused),new Pn(e.instantiate({material:this._discMaterialTransparent}),dn.Q9.Unfocused)],this._manipulator.radius=this._radius/aa*80}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Transparent,isDecoration:!0});return this._handles.add((0,s.YP)((()=>f.Z.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),s.nn)),t}get test(){return{discManipulator:this._manipulator}}}class Ca extends ha{constructor(e){super(),this._radius=aa,this.events=new hi.Z,this._tool=e.tool,this._view=e.view;const t=new ci({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const i=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Rn(this._createDarkenedColor(i,1,.25),Be.yD.Occlude),materialFocused:Rn(this._createDarkenedColor(i,1,0),Be.yD.Occlude),materialOccludedUnfocused:Rn(this._createDarkenedColor(i,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:Rn(this._createDarkenedColor(i,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=(0,s.YP)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=this._createDarkenedColor(e,1,.25),i=this._createDarkenedColor(e,1,0),n=this._createDarkenedColor(e,.7,0),a=this._createDarkenedColor(e,.85,0),{materialUnfocused:r,materialFocused:o,materialOccludedUnfocused:s,materialOccludedFocused:l}=this._materials;r.setParameters({color:t}),o.setParameters({color:i}),s.setParameters({color:n}),l.setParameters({color:a})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=(0,o.hw)(this._themeHandle),this._manipulator.applyObjectTransform=Ra,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const n=t.graphic.geometry.spatialReference;return wa(t.graphic,i,(t=>this.createDragPipeline(((i,n,a,r,o)=>(({steps:n,cancel:a}=e(i,n,a,r,o)),t(i,n,a))),n)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return(0,pa.Xd)(this._manipulator,((n,a,r,o,s)=>{const l=a.next((e=>({...e,manipulatorType:Yn.TRANSLATE_Z}))).next(fa(i,n.renderLocation,t)).next((0,pa.zh)());e(n,l,r,o,s)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/aa,i=e.zManipulator.height*t,n=e.zManipulator.coneHeight*t,a=e.zManipulator.coneWidth*t,r=e.zManipulator.width*t,o=[(0,_.f)(0,0,0),(0,_.f)(0,0,i)],s=[(0,_.f)(0,0,0),(0,_.f)(0,0,i+n)],l=(e=>{const t=(0,mt.a)();if((0,vt.w)(t,t,[0,0,i]),(0,vt.r)(t,t,Math.PI/2),e){const i=1+2*e/a;(0,vt.b)(t,t,[i,i,i])}return t})(0),{materialUnfocused:c,materialFocused:h,materialOccludedUnfocused:d,materialOccludedFocused:u}=this._materials,p=(0,ke.PD)(c,o,r/2,16,!1),g=(0,ke.QL)(c,n,a/2,16,!1);g.transformation=l,this._manipulator.renderObjects=[new Pn(g,dn.Q9.Unfocused),new Pn(p,dn.Q9.Unfocused),new Pn(g.instantiate({material:h}),dn.Q9.Focused),new Pn(p.instantiate({material:h}),dn.Q9.Focused),new Pn(g.instantiate({material:d}),dn.Q9.Unfocused),new Pn(p.instantiate({material:d}),dn.Q9.Unfocused),new Pn(g.instantiate({material:u}),dn.Q9.Focused),new Pn(p.instantiate({material:u}),dn.Q9.Focused)],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[s]}}_createManipulator(){const e=this._view,t=new pn({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const i=e.state.camera,n=Aa;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const a=(0,p.r)(i.eye,n),r=i.computeRenderPixelSizeAtDist(a),o=(0,p.f)(Pa,n,i.eye);(0,p.n)(o,o);const s=Da;e.renderCoordsHelper.worldUpAtPosition(Aa,s);const l=Math.abs((0,p.j)(o,s)),c=(0,p.b)(Pa,o,s),h=(0,p.b)(Pa,c,s),d=(0,Le.uZ)(l,.01,1),u=1-Math.sqrt(1-d*d)/d/i.fullWidth,_=this._settings,g=this._radius/aa,v=_.zManipulator.width*g;(0,p.i)(h,(0,p.n)(h,h),(1/u-1)*a+r*v),t[12]-=Pa[0],t[13]-=Pa[1],t[14]-=Pa[2]},this._manipulator=t,this._updateManipulator()}_createDarkenedColor(e,t,i){const n=(0,a._j)(e,i);return n.a*=t,f.Z.toUnitRGBA(n)}get test(){return{manipulator:this._manipulator}}}const Aa=(0,_.c)(),Pa=(0,_.c)(),Da=(0,_.c)(),Ra=()=>{};class Ia extends ha{constructor(e){super(),this._handles=new ca.Z,this._interactive=!0;const{tool:t,view:i,snapToScene:n,radius:a}=e;this._view=i,this.xyManipulation=new Ta({tool:t,view:i,snapToScene:n,radius:a}),this.xyAxisManipulation=new Oa({tool:t,view:i,radius:a}),this.zManipulation=new Ca({tool:t,view:i,radius:a}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return(0,r.AL)([this.xyManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ga.XY,t,i,n,a,r)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ga.XY_AXIS,t,i,n,a,r)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ga.Z,t,i,n,a,r)),t,i)])}createDragPipeline(e,t,i,n){return(0,r.AL)([this.xyManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ga.XY,t,i,n,a,r)),t,i,n),this.xyAxisManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ga.XY_AXIS,t,i,n,a,r)),t,i,n),this.zManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ga.Z,t,i,n,a,r)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,d.Z)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const n=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(La),this._handles.add(t,La)};for(const a of i)this._handles.add(a.events.on("focus-changed",n));this._view.inputManager&&this._handles.add((0,s.gx)((()=>{var e;return null===(e=this._view.inputManager)||void 0===e?void 0:e.latestPointerType}),n)),n()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?ra:aa}}const La="disable-xy-axis-display";var Ga;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(Ga||(Ga={}));var za=i(2346);class Va extends ha{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e){return wa(this._graphicState.graphic,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,n=null!=i.geometry?i.geometry.spatialReference:null;return(0,pa.Xd)(this._manipulator,((a,r,o,s,l)=>{const c=r.next(function(e,t,i,n){const a=t.toMap(e.screenStart,{include:[i]});return null!=a?ma(t,i,a,n):null}(l,t,i,n)).next((0,pa.AN)()).next((0,pa.zh)());e(a,c,o,s,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new za.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}var ja=i(57889),Ha=i(29919),Na=i(87268),Ua=i(77560),Fa=i(34019),Za=i(80151),Wa=i(73476),Ya=i(40524),ka=i(4914);class Ba{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Xa{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class qa{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}const Qa="manipulators";let Ja=class extends(hi.Z.EventedMixin(Ha.m)){constructor(e){super(e),this._infos=new Map,this.graphics=new Bi.Z,this.enableZ=!0,this.tooltipOptions=new Ua.Z,this.type="move-3d",this._updatingHandles=new qi.R,this._moveManipulation=null,this._tooltip=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{view:e}=this;this.addHandles([this.graphics.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateGraphicInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),(0,s.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new Wa.u({view:e}):(0,o.SC)(this._tooltip)}),s.tX)]);const t=this.graphics.toArray();this._updateGraphicInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this._moveManipulation=(0,o.SC)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}reset(){}_updateGraphicInfos(e){let{added:t,removed:i}=e;for(const a of t){if((0,ja.P)(a)!==Fn.e.SUPPORTED)continue;const e=new Ka(a),t=this.view.trackGraphicState(e.state);this._infos.set(e.graphic,{info:e,handle:t})}for(const a of i){var n;null!==(n=this._infos.get(a))&&void 0!==n&&n.handle.remove(),this._infos.delete(a)}}_setupFastTransformUpdates(e){for(const t of e){const{info:e}=this._infos.get(t);this.addHandles(kt(e.state),t)}}_refreshManipulators(){if(this.removeHandles(Qa),this._moveManipulation=(0,o.SC)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values(),(e=>{let{info:t}=e;return t}));this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Va({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()})),e.events.on("grab-changed",(e=>{var t;let{action:i}=e;const{tooltipOptions:n,_tooltip:a}=this;null!=a&&("start"===i?(null!==(t=this._translateGraphicTooltipInfo)&&void 0!==t||(this._translateGraphicTooltipInfo=new Ya.$E({tooltipOptions:n})),a.info=this._translateGraphicTooltipInfo,a.info.tooltipOptions=n,a.info.distance=Xi.yP):a.clear())}))],Qa))),this.addHandles(t.manipulationXY.createDragPipeline(((t,i,n,a)=>this._buildDragEventPipeline(e,Ga.XY,t,i,n,a))),Qa)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Ia({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ia.radiusForSymbol(e[0].graphic.symbol):aa});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.at(0)}),i.stopPropagation()})),Qa)}));const i=t=>i=>{this.addHandles(i.events.on("focus-changed",(i=>{let{action:n}=i;const a=this._tooltip;null!=a&&("focus"===n?this._updateMoveTooltip(e,t):a.clear())})),Qa)};this._moveManipulation.xyManipulation.forEachManipulator(i(Ga.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Ga.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Ga.Z));const n=()=>this._updateMoveManipulation(e);for(const r of e)this.addHandles([r.state.on("changed",n),(0,s.YP)((()=>r.state.displaying),n)],Qa);const a=e[e.length-1];this.addHandles(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a))),Qa),this.addHandles(t.createDragPipeline(((t,i,n,a,r)=>this._buildDragEventPipeline(e,t,i,n,a,r)),(0,g.RL)(a.graphic),a.graphic.geometry.spatialReference,a.graphic),Qa),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const i=t.graphic,n=na({view:this.view,graphic:i,forEachManipulator:e=>{var i,n;null!==(i=t.manipulationXY)&&void 0!==i&&i.forEachManipulator(e),null===(n=this._moveManipulation)||void 0===n||n.forEachManipulator(e)},onManipulatorsChanged:()=>(0,r.kB)()});null!=n&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof _i&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),(0,s.YP)((()=>t.state.isDraped),(()=>this._updateMoveManipulation(e)))],Qa),this.addHandles(n,Qa))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=Un(e.graphic.geometry))}_updateMoveManipulation(e){const t=(0,at.T)(0,0,0,this.view.spatialReference);let i=0,n=!1;const a=this._moveManipulation;if(a){var r;for(const a of e){if(!a.state.displaying)continue;const e=a.state.graphic;this.enableZ&&Zn(e)&&(n=!0);const r=a.geometryRepresentation instanceof _i&&!a.state.isDraped?a.geometryRepresentation.attachmentOrigin:jn(this.view,e);if(null!=r){var o;const{x:e,y:n,z:a}=r;t.x+=e,t.y+=n,a&&(null!==(o=t.z)&&void 0!==o||(t.z=0),t.z+=a),i++}}i>0?(t.x/=i,t.y/=i,null!==(r=t.z)&&void 0!==r||(t.z=0),t.z/=i,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=n):a.available=!1}}_buildDragEventPipeline(e,t,i,n,a,r){const o=[],s=[];let l=null,c=null;const h=()=>{for(const e of o)e.dragging=!1;o.length=0,s.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===Ga.XY){const t=e[0].graphic;({steps:n,cancel:a}=this._buildSnappingPipelineSteps(t,(0,g.RL)(t),n,a,r))}return a=a.next((e=>{var t;return null===(t=c)||void 0===t?void 0:t(e)})).next((()=>(this.emit("graphic-move-stop",new qa(s)),this.destroyed||h(),null))),{steps:n=n.next((t=>{if("start"===t.action){o.length=0,s.length=0;for(const t of e){var n,a;t.dragging||(null===(n=t.manipulationXY)||void 0===n||!n.hasManipulator(i))&&(null===(a=t.manipulationXY)||void 0===a?void 0:a.grabbing)||(o.push(t),s.push(t.graphic),t.dragging=!0)}if(0!==s.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,pa.oq)(s,this.view.state.viewingMode),c=(0,pa.QY)(s),this.emit("graphic-move-start",new Ba(s)),this.destroyed))return null}return 0!==s.length?t:null})).next((e=>{var t;return null===(t=l)||void 0===t?void 0:t(e)})).next((i=>(this._updateMoveTooltip(e,t,i),i))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),n=i.x-t.x,a=i.y-t.y;if(this.emit("graphic-move",new Xa(n,a,s)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new qa(s)),this.destroyed)return null;h()}return null})),cancel:a}}_updateMoveTooltip(e,t,i){var n,a,r;const{tooltipOptions:o,_tooltip:s}=this;if(null==s)return;s.clear();const l=0===e.length?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case Ga.XY:s.info=null!==(n=this._translateGraphicTooltipInfo)&&void 0!==n?n:this._translateGraphicTooltipInfo=new Ya.$E({tooltipOptions:o}),this._updateMoveTooltipDistance(s.info,i,((e,t)=>(0,G.GQ)(e,t,l)));break;case Ga.XY_AXIS:s.info=null!==(a=this._translateGraphicXYTooltipInfo)&&void 0!==a?a:this._translateGraphicXYTooltipInfo=new Ya.in({tooltipOptions:o}),this._updateMoveTooltipDistance(s.info,i,((e,t)=>{const n=(0,G.GQ)(e,t,l);return(0,Xi.bA)(n,xa(i))}));break;case Ga.Z:s.info=null!==(r=this._translateGraphicZTooltipInfo)&&void 0!==r?r:this._translateGraphicZTooltipInfo=new Ya.QW({tooltipOptions:o}),this._updateMoveTooltipDistance(s.info,i,ka._e)}s.info.tooltipOptions=o}_updateMoveTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Xi.yP}else e.distance=Xi.yP}_buildSnappingPipelineSteps(e,t,i,n,a){const r=e.geometry;if(null==r||"point"!==r.type&&"mesh"!==r.type)return{steps:i,cancel:n};const o=("point"===r.type?r:r.anchor).clone(),s=new Fa.N({elevationInfo:t,pointer:a,editGeometryOperations:Na.c.fromGeometry(o,this.view.state.viewingMode),visualizer:new Ht,excludeFeature:e}),l=this.snappingManager,{snappingStep:c,cancelSnapping:h}=(0,Za.W)({snappingContext:s,snappingManager:l,updatingHandles:this._updatingHandles});return n=n.next(h),{steps:i=i.next((t=>(o.z=(0,g.vQ)(this.view,o,(0,g.RL)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:s.coordinateHelper.pointToVector(o)}))).next(...c),cancel:n}}get test(){return{tooltip:this._tooltip}}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ja.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],Ja.prototype,"graphics",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ja.prototype,"enableZ",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,type:Ua.Z})],Ja.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ja.prototype,"snappingManager",void 0),(0,n._)([(0,l.Cb)()],Ja.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],Ja.prototype,"updating",null),Ja=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Ja);class Ka{constructor(e){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Hi.F({graphic:e})}get graphic(){return this.state.graphic}}var $a=i(46684),er=i(68860),tr=i(29909),ir=i(74579),nr=i(3711);function ar(e,t,i){const n="on-the-ground"===i.mode?nr.v.XY:nr.v.XYZ;return new nr.A(e,n,t,0)}function rr(e,t,i){const n=(0,_.c)();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;const a=or(e,t,(0,on.mJ)(i.plane)),r=or(e,t,i.edgeDirection);if(null==a||null==r)return null;const o=(0,p.b)((0,_.c)(),a,r);return(0,on.Yq)(n,o,(0,on.Ue)())}function or(e,t,i){const n=(0,at.T)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),a=(0,_.c)(),r=(0,_.c)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(n,r)?(0,p.C)(r,a,r):null}var sr=i(63920),lr=i(153),cr=i(4943);let hr=class extends cr.h{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Xi.yP,this.area=null,this.totalLength=null}};(0,n._)([(0,l.Cb)()],hr.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],hr.prototype,"distance",void 0),(0,n._)([(0,l.Cb)()],hr.prototype,"area",void 0),(0,n._)([(0,l.Cb)()],hr.prototype,"totalLength",void 0),hr=(0,n._)([(0,u.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],hr);var dr=i(40545),ur=i(64357),pr=i(30541),_r=i(78952);let gr=class extends(hi.Z.EventedMixin(y.Z)){constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new ca.Z,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Mr.NONE,this._updatingHandles=new qi.R,this._recreatingManipulators=!1,this._settings=new ci({getTheme:()=>this.view.effectiveTheme}),this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null,this._translateVertexTooltipInfo=null,this._translateVertexXYTooltipInfo=null,this._translateVertexZTooltipInfo=null,this._edgeOffsetTooltipInfo=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._settings.manipulators,n=i.vertex;this._vertexManipulatorMaterial=Rn((0,a.O)(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=In((0,a.O)(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=In((0,a.O)(n.hoverOutlineColor),n.renderOccluded);const r=i.edge;this._edgeManipulatorMaterial=Rn((0,a.O)(r.color),r.renderOccluded),this._edgeManipulatorOutlineMaterial=In((0,a.O)(r.outlineColor),r.renderOccluded);const o=i.edgeOffset;this._edgeOffsetManipulatorMaterial=Rn((0,a.O)(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Rn((0,a.O)(o.hoverColor),o.renderOccluded,!1);const l=i.selected;this._selectedManipulatorMaterial=Rn((0,a.O)(l.color),l.renderOccluded),this._selectedManipulatorOutlineMaterial=In((0,a.O)(l.outlineColor),l.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=In((0,a.O)(l.hoverOutlineColor),l.renderOccluded);const c=this._graphicState=new Hi.F({graphic:e});this._tooltip=new Wa.u({view:t}),this.addHandles([(0,s.YP)((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(e=>{let{vertexSettings:t,edgeSettings:i,edgeOffsetSettings:n,selectedSettings:a}=e;t.applyColor(this._vertexManipulatorMaterial),t.applyOutline(this._vertexManipulatorOutlineMaterial),t.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),i.applyColor(this._edgeManipulatorMaterial),i.applyOutline(this._edgeManipulatorOutlineMaterial),n.applyColor(this._edgeOffsetManipulatorMaterial),n.applyHover(this._edgeOffsetManipulatorHoverMaterial),a.applyColor(this._selectedManipulatorMaterial),a.applyOutline(this._selectedManipulatorOutlineMaterial),a.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,s.YP)((()=>c.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,s.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(e=>{let{labels:t,enabled:i,edgeOffsetEnabled:n}=e;null!=t&&(t.visible=i,t.edgeDistance=n?"far":"default")}),s.nn),(0,s.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),s.nn),this.view.trackGraphicState(c)])}destroy(){this._segmentLabels=(0,o.SC)(this._segmentLabels),this._tooltip=(0,o.SC)(this._tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,o.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,o.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._editGeometryOperations)return;const t=(0,g.RL)(this.graphic);for(const i of this._editGeometryOperations.data.components){const n=null===e||void 0===e?void 0:e.byComponentIndex.get(i.index);for(const e of i.vertices){const i=null===n||void 0===n?void 0:n.has(e.index);this._createVertexOrEdgeManipulator(e,t,i)}for(const e of i.edges)this._createVertexOrEdgeManipulator(e,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const e=this._editGeometryOperations.redo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const e=this._editGeometryOperations.undo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if(null!=e&&null!=this.inputGeometry&&(0,O.Pt)(e,this.inputGeometry))for(const n of this._manipulatorInfos)if("vertex"===n.type&&n.manipulator.selected){const{index:e,component:{index:i}}=n.handle,{byComponentIndex:a}=t,r=a.get(i)||new Set;r.add(e),a.set(i,r)}if(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,o.SC)(this._editGeometryOperations),this._segmentLabels=(0,o.SC)(this._segmentLabels),null==e)return void(this._recreatingManipulators=!1);const i="mesh"===e.type?e.anchor:e;this._editGeometryOperations=Na.c.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new Z({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,g.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const n=[],a=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),r=e===Sr.SELECTED_OR_ALL&&a;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.grabbing||r&&!o.manipulator.selected||n.push(o),i++);if(0===n.length)return t;if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(Mr.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Mr.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Mr.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:n}=e;if(!t&&!i&&!n)return;const a=[];for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected&&!r.manipulator.grabbing||r===e.info)&&a.push(r);this._moveVertices(a,e,lr.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Mr.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Mr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Mr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Mr.MOVING:switch(this._reshapeEventState){case Mr.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Mr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Mr.RESHAPING:switch(this._reshapeEventState){case Mr.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Mr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new Va({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,n)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=this._editGeometryOperations.createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(Sr.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Ga.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=(0,o.hw)(e))})),n.next((()=>this._onDragCancel(!0,(()=>e=(0,o.hw)(e)))))}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))))}_createMoveManipulation(e){const{graphic:t,tool:i,view:n}=this,a=this._graphicState;this._moveManipulation=new Ia({tool:i,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Zn(t),snapToScene:!1,radius:Ia.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const r=e=>t=>{this.addHandles(t.events.on("focus-changed",(t=>{let{action:i}=t;"focus"===i&&this._tooltipOptions.enabled?this._updateTranslateTooltip(e):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(r(Ga.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(Ga.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(Ga.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const o=t.geometry.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((n,a,r,o,s)=>{const{snappingStep:l,cancelSnapping:c}=(0,Za.W)({predicate:e=>!!e.info,snappingManager:i.snappingManager,snappingContext:new Fa.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:e,pointer:s,excludeFeature:t,visualizer:new Ht}),updatingHandles:this._updatingHandles,useZ:!1});return o=o.next((e=>(this._onDragCancel(),e))).next(c),{steps:r=r.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===Yn.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,pa.BS)(this.view,e,t)).next(...l).next((0,pa.AN)()).next((e=>this._perGraphicManipulatorDragAction(Sr.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(n,e),e))),cancel:o}}),e,o,t),(0,s.YP)((()=>a.displaying),(()=>this._updateMoveManipulationPosition()),s.nn),a.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,s.YP)((()=>a.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),s.nn)])}_createVisualElements(){const{graphic:e,view:t}=this,i=na({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Yn.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof _i?i.visualElement:null),null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e){var t,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic);const a=this._settings.manipulators.edgeOffset,o=a.size/2,s=o+a.collisionPadding,l=o/s,c=l*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,ke.DA)(this._edgeOffsetManipulatorMaterial,c,l/2,l/2,a.height,a.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,ke.DA)(this._edgeOffsetManipulatorMaterial,-c,l/2,l/2,a.height,-a.offset));const h=[new Pn(this._edgeOffsetManipulatorGeometryInside.instantiate(),dn.Q9.Unfocused),new Pn(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),dn.Q9.Focused),new Pn(this._edgeOffsetManipulatorGeometryOutside.instantiate(),dn.Q9.Unfocused),new Pn(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),dn.Q9.Focused)],d=new pn({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==n.mode||(0,ir.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:n,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||null===(t=this.graphic.layer)||void 0===t||!t.visible),collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),u=new pn({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||null===(i=this.graphic.layer)||void 0===i||!i.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),p={manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:u,elevationInfo:n,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(p,a.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(p);const v=[];for(const r of[p.handle.leftVertex,p.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(r);null!=e&&v.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(p))))}p.locationUpdateHandle=(0,r.AL)(v),this._manipulatorHandles.add(p.locationUpdateHandle,d),this._manipulatorHandles.add([this._watchAndUpdateGrabState(d,!0),this._watchAndUpdateGrabState(u,!0)],d),this._manipulatorHandles.add((0,pa.Xd)(d,this._createEdgeOffsetPipeline(p,n)),d),this._manipulatorHandles.add((0,pa.Xd)(u,((e,t,i,a)=>{if("touch"===a)this._createEdgeOffsetPipeline(p,n)(e,t,i);else if(this.enableMoveGraphic){const a=this.graphic,r=null!=a.geometry?a.geometry.spatialReference:null;t.next((e=>this._trackNumDragging(e))).next((0,pa.kY)(this.view,e.elevationAlignedLocation)).next(va(this.view,e.elevationAlignedLocation,n,r,a)).next((0,pa.zh)()).next((0,pa.AN)()).next((e=>this._perGraphicManipulatorDragAction(Sr.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Ga.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear()})),i.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),d);const m=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([d.events.on("immediate-click",m),u.events.on("immediate-click",m),d.events.on("focus-changed",(e=>{var t;let{action:i}=e;const{_tooltipOptions:n,_tooltip:a}=this;"focus"===i&&n.enabled?(a.info=null!==(t=this._edgeOffsetTooltipInfo)&&void 0!==t?t:this._edgeOffsetTooltipInfo=new hr({tooltipOptions:n}),a.info.distance=Xi.yP,a.info.tooltipOptions=n,this._updateTooltipAreaOrTotalLength(a.info)):a.clear()}))],d),this._manipulatorInfos.push(p),this.manipulators.add(d),this.manipulators.add(u),this.emit("manipulators-changed"),p}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,n=e.edgeManipulator,a=()=>{e.visibilityHandle=(0,o.hw)(e.visibilityHandle);const a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),s=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=a&&null!=s&&function(e,t,i){const n=i.projectToRenderScreen(e,(0,m.J$)()),a=i.projectToRenderScreen(t,(0,m.J$)());return null!=n&&null!=a?(0,p.m)((0,p.f)(n,n,a)):0}(a.manipulator.renderLocation,s.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!n.focused||l)&&(i.grabbable=!l,n.grabbable=!l,e.visibilityHandle=(0,r.AL)([i.disableDisplay(),(0,r.kB)((()=>{i.grabbable=!0,n.grabbable=this.enableMoveGraphic}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),n.events.on("focus-changed",a),(0,r.kB)((()=>{(0,o.hw)(e.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)}))],i),a()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._editGeometryOperations.data,i=rr(this.view,e.manipulator.elevationAlignedLocation,ar(t,e.handle,e.manipulator.elevationInfo)),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==a)return;const r=n.manipulator.renderLocation,o=a.manipulator.renderLocation,s=null!=i?function(e,t,i){const n=(0,on.mJ)(e),a=(0,p.C)((0,_.c)(),t,i),r=(0,p.b)((0,_.c)(),a,n),o=(0,p.b)((0,_.c)(),a,r);return(0,mt.f)(a[0],a[1],a[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1)}(i,r,o):mt.I;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const l=(0,p.l)((0,p.f)(fr,r,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,n,a)=>{this._clearSelection();const{step:r,cleanup:o}=this._initializeEdgeOffset(e,t);n.next((e=>this._trackNumDragging(e))).next((0,pa.kY)(this.view,i.elevationAlignedLocation)).next(r).next(function(e){return ga(e,(e=>e.plane))}(this.view)).next(ya(this.view,this._editGeometryOperations.data.spatialReference)).next((0,pa.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&o()})),a.next((()=>{i.metadata.deleting||(o(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t){const{view:i}=this,n=this._editGeometryOperations,l=ar(n.data.coordinateHelper,e.handle,t),c=n.createUndoGroup(),h=rr(i,e.manipulator.elevationAlignedLocation,l);if(l.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(l.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}const d=()=>new tr.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),u=this._settings,p=new _i({view:i,isDraped:this._graphicState.isDraped,geometry:d(),elevationInfo:e.elevationInfo,width:u.visualElements.lineGraphics.outline.width,attached:!1,isDecoration:!0});let _;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(e),_=(0,o.hw)(_)},v=this.on("undo",g);return _=(0,r.AL)([(0,s.YP)((()=>(0,a.O)(this._accentColor)),(e=>p.color=e),s.nn),(0,r.ed)(p),(0,s.YP)((()=>this._graphicState.isDraped),(e=>p.isDraped=e)),this._graphicState.on("changed",(()=>p.geometry=d())),c,v]),p.attached=!0,{step:e=>null==l||null==h?(g(),null):{...e,operation:l,plane:h},cleanup:g}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||null==t.operation)return t;this._updateEventState(Mr.RESHAPING);const{mapDeltaX:i,mapDeltaY:n,mapDeltaZ:a}=t;return(i||n||a)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return null==t||null==i?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{var t;const{mapEnd:i,signedDistance:n,operation:a}=e,{_tooltip:r,_tooltipOptions:o}=this;return o.enabled&&null!=n?(r.info=null!==(t=this._edgeOffsetTooltipInfo)&&void 0!==t?t:this._edgeOffsetTooltipInfo=new hr({tooltipOptions:o}),r.info.tooltipOptions=o,r.info.distance="end"===e.action?Xi.yP:function(e,t,i,n,a){if(e){const e=a.toXYZ(a.pointToVector(i)),r=(0,on.nF)(n,e,gt.WM.get()),o=(0,pr.FB)(r,e,a.spatialReference);if(null!=o)return(0,Xi.yG)(o.value*Math.sign(t),o.unit)}return(0,Xi.yG)(t*(0,er.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,n*a.selectedArrow,i,a.plane,this._editGeometryOperations.data.coordinateHelper),this._updateTooltipAreaOrTotalLength(r.info),e):(r.clear(),e)}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const n=null===(t=e.handle.leftVertex.leftEdge)||void 0===t?void 0:t.leftVertex,a=e.handle.leftVertex,r=null===(i=e.handle.rightVertex.rightEdge)||void 0===i?void 0:i.rightVertex,o=e.handle.rightVertex,s=this._editGeometryOperations.data.coordinateHelper,l=[];if(n&&s.distance(n.pos,a.pos)<yr){const e=this._getManipulatorInfoFromHandle(a);null!=e&&l.push(e)}if(s.distance(a.pos,o.pos)<yr||r&&s.distance(r.pos,o.pos)<yr){const e=this._getManipulatorInfoFromHandle(o);null!=e&&l.push(e)}l.length&&this._removeVertices(l)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{view:a}=this,s=this._settings;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,i);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(s.manipulators.vertex);this._vertexManipulatorGeometry=(0,ke.PI)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,ke.PI)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(s.manipulators.edge);this._edgeManipulatorGeometry=(0,ke.PI)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,ke.PI)(this._edgeManipulatorOutlineMaterial,t,16,16)}const{geometry:l}=this.graphic,c=null===l||void 0===l?void 0:l.type,h="point"===c||"mesh"===c?[]:[new Pn(this._vertexManipulatorGeometry.instantiate(),br.Vertex|dn.Q9.Unselected),new Pn(this._vertexManipulatorOutlineGeometry.instantiate(),br.Vertex|dn.Q9.Unfocused|dn.Q9.Unselected),new Pn(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),br.Vertex|dn.Q9.Focused|dn.Q9.Unselected),new Pn(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),dn.Q9.Selected),new Pn(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),dn.Q9.Selected|dn.Q9.Unfocused),new Pn(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),dn.Q9.Selected|dn.Q9.Focused)];this.enableMidpoints&&h.push(new Pn(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),br.Edge|dn.Q9.Focused|dn.Q9.Unselected),new Pn(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),br.Edge|dn.Q9.Focused|dn.Q9.Unselected),new Pn(this._edgeManipulatorGeometry.instantiate(),br.Edge|dn.Q9.Unfocused|dn.Q9.Unselected),new Pn(this._edgeManipulatorOutlineGeometry.instantiate(),br.Edge|dn.Q9.Unfocused|dn.Q9.Unselected));const d=new pn({view:a,renderObjects:h,elevationInfo:i,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||null===(t=this.graphic.layer)||void 0===t||!t.visible),metadata:{deleting:!1}});d.selected=n,this._setTypeSpecificManipulatorSettings(d,e,i);const u="edge"===e.type?{manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:d,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(u),this.manipulators.add(d),this._updateManipulatorPosition(u),"edge"===u.type){const e=[];for(const t of[u.handle.leftVertex,u.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);null!=i&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(u))))}u.locationUpdateHandle=(0,r.AL)(e),this._manipulatorHandles.add(u.locationUpdateHandle,d)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(d,!0),d);const p=(0,pa.Xd)(d,((e,t,n,a)=>{let r=null;const{snappingStep:s,cancelSnapping:l}=(0,Za.W)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Fa.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:i,pointer:a,excludeFeature:this.graphic,visualizer:new Ht}),updatingHandles:this._updatingHandles,useZ:!1});n=n.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>r=(0,o.hw)(r))),t))).next(l),t.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(r=this._editGeometryOperations.createUndoGroup()),"edge"===u.type){const t=this._splitEdgeManipulator(u);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:u,snapOrigin:u.handle.pos}})).next((0,pa.kY)(this.view,e.elevationAlignedLocation)).next(ma(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next((0,pa.BS)(this.view,i,this.graphic)).next(...s).next((0,pa.AN)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(r=(0,o.hw)(r)),this._updateTranslateVertexTooltip(e,Ga.XY,t)}))}));return this._manipulatorHandles.add([p,d.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,u))),d.events.on("select-changed",(()=>{u.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),d.events.on("focus-changed",(e=>{let{action:t}=e;"focus"===t&&"edge"!==u.type?this._updateTranslateVertexTooltip(d,Ga.XY):this._tooltip.clear()}))],d),this.emit("manipulators-changed"),u}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Mr.NONE:break;case Mr.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Mr.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(Mr.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){const{graphic:n}=this,a=this._settings;switch(t.type){case"vertex":{e.state=br.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:r}=a.manipulators.vertex;e.radius=t/2+r,e.elevationInfo=i;const{geometry:o}=n,s=null===o||void 0===o?void 0:o.type;e.interactive=null!=s&&"point"!==s&&"mesh"!==s;break}case"edge":{e.state=br.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:r}=a.manipulators.edge;e.radius=t/2+r,e.elevationInfo="on-the-ground"!==i.mode||(0,ir.YW)(n.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Mr.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==n||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,{geometry:i}=this.graphic,n=null===i||void 0===i?void 0:i.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=n&&"point"!==n&&"mesh"!==n,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,h.e$)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(null==e)return;const t=this._editGeometryOperations;if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,mr),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==n)return;const a=i.manipulator,r=n.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=a.location,n=r.location,o=.5,s=i.x+o*(n.x-i.x),l=i.y+o*(n.y-i.y),c=i.hasZ&&n.hasZ?0:void 0;e.manipulator.location=(0,at.T)(s,l,c,t.data.spatialReference)}else(0,p.p)(fr,a.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=fr}}_splitEdgeManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const i=this._editGeometryOperations,n=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,o.hw)(e.locationUpdateHandle);const a=(0,g.RL)(this.graphic);let r;this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(n)):(r=e,r.handle=n,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(r),this.enableEdgeOffset||this._updateTranslateVertexTooltip(r.manipulator,Ga.XY),this._updateSelection(e.manipulator);const s=this._updateEventState(Mr.RESHAPING),l=i.data.coordinateHelper.vectorToArray(r.handle.pos),c=i.data.components.indexOf(n.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:c,vertexIndex:n.index}],added:l}),s&&this._updateEventState(Mr.NONE),r}_updateMoveManipulationPosition(){const e=(0,p.s)(fr,0,0,0);let t=0,i=!1,n=null,a=null;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected?(t++,(0,p.g)(e,e,r.manipulator.renderLocation),null==n||r.selectedIndex>n.selectedIndex?(a=n,n=r):(null==a||r.selectedIndex>a.selectedIndex)&&(a=r)):i=!0);if(0===t){const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Zn(this.graphic),this._moveManipulation.angle=Un(this.graphic.geometry),this._moveManipulation.radius=Ia.radiusForSymbol(this.graphic.symbol)}else{const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Zn(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let i=0;if(null!=n){const e=n.handle.pos,t=null!=a?a.handle.pos:n.handle.leftEdge&&n.handle.leftEdge.leftVertex?n.handle.leftEdge.leftVertex.pos:null,r=null==a&&n.handle.rightEdge&&n.handle.rightEdge.rightVertex?n.handle.rightEdge.rightVertex.pos:null;t&&r?this._moveManipulation.xyAxisManipulation.available=!1:t?i=vr(t,e):r&&(i=vr(e,r))}this._moveManipulation.angle=i,this._moveManipulation.radius=ra}0!==t&&i?((0,p.i)(e,e,1/t),mr.spatialReference=this._editGeometryOperations.data.spatialReference,mr.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,mr),this._moveManipulation.elevationAlignedLocation=mr):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?Hn(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,i=this._editGeometryOperations;for(const a of e)if("vertex"===a.type&&i.canRemoveVertex(a.handle.component)){var n;t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=null===(n=i.removeVertices([a.handle]).removedVertices)||void 0===n?void 0:n[0].createdEdge;e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}));this.outputGeometry=i.data.geometry;const n=this._updateEventState(Mr.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(n&&(this._updateEventState(Mr.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?lr.O.NEW_STEP:lr.O.ACCUMULATE_STEPS;const n=this._editGeometryOperations;n.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=n.data.geometry;for(const a of e)this._updateManipulatorPosition(a)}_offsetEdge(e,t){if(null==t.operation||null==t.signedDistance)return;const i=this._editGeometryOperations,n=t.operation.clone();n.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===sr.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===sr.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){var i,n,a;const{_tooltipOptions:r,_tooltip:o}=this;if(!r.enabled)return;const s=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Ga.XY:o.info=null!==(i=this._translateGraphicTooltipInfo)&&void 0!==i?i:this._translateGraphicTooltipInfo=new Ya.$E({tooltipOptions:r}),this._updateTranslateTooltipDistance(o.info,t,((e,t)=>(0,G.GQ)(e,t,s)));break;case Ga.XY_AXIS:o.info=null!==(n=this._translateGraphicXYTooltipInfo)&&void 0!==n?n:this._translateGraphicXYTooltipInfo=new Ya.in({tooltipOptions:r}),this._updateTranslateTooltipDistance(o.info,t,((e,i)=>{const n=(0,G.GQ)(e,i,s);return(0,Xi.bA)(n,xa(t))}));break;case Ga.Z:o.info=null!==(a=this._translateGraphicZTooltipInfo)&&void 0!==a?a:this._translateGraphicZTooltipInfo=new Ya.QW({tooltipOptions:r}),this._updateTranslateTooltipDistance(o.info,t,ka._e)}o.info.tooltipOptions=r}_updateTranslateVertexTooltip(e,t,i){var n,a,r;const{_tooltipOptions:o,_tooltip:s}=this;if(!o.enabled)return;const l=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case Ga.XY:s.info=null!==(n=this._translateVertexTooltipInfo)&&void 0!==n?n:this._translateVertexTooltipInfo=new Ya.nk({tooltipOptions:o}),this._updateTranslateTooltipDistance(s.info,i,((e,t)=>(0,G.GQ)(e,t,l))),this._updateTooltipAreaOrTotalLength(s.info);break;case Ga.XY_AXIS:s.info=null!==(a=this._translateVertexXYTooltipInfo)&&void 0!==a?a:this._translateVertexXYTooltipInfo=new Ya.c1({tooltipOptions:o}),this._updateTranslateTooltipDistance(s.info,i,((e,t)=>{const n=(0,G.GQ)(e,t,l);return(0,Xi.bA)(n,xa(i))})),this._updateTooltipAreaOrTotalLength(s.info);break;case Ga.Z:s.info=null!==(r=this._translateVertexZTooltipInfo)&&void 0!==r?r:this._translateVertexZTooltipInfo=new Ya.j({tooltipOptions:o}),this._updateTranslateTooltipDistance(s.info,i,ka._e)}const c=(0,ka.g1)(e.elevationAlignedLocation);null!=c&&(s.info.elevation=(0,dr.do)({actual:c})),s.info.tooltipOptions=o}_updateTranslateTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Xi.yP}else e.distance=Xi.yP}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(null==t)return e.area=null,void(e.totalLength=null);const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,ur.k)(t,i):null,e.totalLength="polyline"===t.type?(0,G.Ul)(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function vr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,n._)([(0,l.Cb)()],gr.prototype,"_editGeometryOperations",void 0),(0,n._)([(0,l.Cb)()],gr.prototype,"_segmentLabels",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],gr.prototype,"tool",void 0),(0,n._)([(0,l.Cb)()],gr.prototype,"_tooltip",void 0),(0,n._)([(0,l.Cb)()],gr.prototype,"inputGeometry",null),(0,n._)([(0,l.Cb)()],gr.prototype,"outputGeometry",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],gr.prototype,"updating",null),(0,n._)([(0,l.Cb)()],gr.prototype,"manipulators",null),(0,n._)([(0,l.Cb)()],gr.prototype,"view",null),(0,n._)([(0,l.Cb)()],gr.prototype,"graphic",null),(0,n._)([(0,l.Cb)()],gr.prototype,"enableZShape",null),(0,n._)([(0,l.Cb)()],gr.prototype,"enableZVertex",null),(0,n._)([(0,l.Cb)()],gr.prototype,"enableMoveGraphic",null),(0,n._)([(0,l.Cb)()],gr.prototype,"enableMidpoints",null),(0,n._)([(0,l.Cb)()],gr.prototype,"enableEdgeOffset",null),(0,n._)([(0,l.Cb)()],gr.prototype,"_labelOptions",null),(0,n._)([(0,l.Cb)()],gr.prototype,"_tooltipOptions",null),(0,n._)([(0,l.Cb)()],gr.prototype,"_accentColor",null),gr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],gr);const mr=(0,at.T)(0,0,void 0,_r.Z.WGS84),fr=(0,_.c)(),yr=1e-6;var br,Mr,Sr;!function(e){e.Vertex=dn.jg.Custom1,e.Edge=dn.jg.Custom2}(br||(br={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Mr||(Mr={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Sr||(Sr={}));var wr=i(52349);let xr=class extends(hi.Z.EventedMixin(Ha.m)){constructor(e){super(e),this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new wr.Z,this.tooltipOptions=new Ua.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new gr({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation())),(0,s.YP)((()=>this.graphic),(()=>this._updateGraphic()),s.tX)]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,o.SC)(this._reshapeOperation)}get updating(){var e,t;return null!==(e=null===(t=this._reshapeOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}_updateGeometry(){const e=(0,$a.b)(this.graphic);this._reshapeOperation.inputGeometry=null!=e?e.clone():null}_updateGraphic(){if(this.removeHandles("onGraphicGeometryChange"),this._updateGeometry(),(0,$a.P)(this.graphic)!==Fn.e.SUPPORTED)return;const e=(0,s.YP)((()=>{var e;return null===(e=this.graphic)||void 0===e?void 0:e.geometry}),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),s.Z_);this.addHandles(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0;const{graphic:t}=this,{geometry:i}=t;"mesh"===(null===i||void 0===i?void 0:i.type)&&"point"===e.type?(t.geometry=i.centerAt(e),t.notifyGeometryChanged()):t.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;null!=this.graphic&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){var e;return null!==(e=this._reshapeOperation.canUndo)&&void 0!==e&&e}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){var e;return null!==(e=this._reshapeOperation.canRedo)&&void 0!==e&&e}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,n._)([(0,l.Cb)()],xr.prototype,"_reshapeOperation",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],xr.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"enableZShape",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"enableZVertex",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"enableMoveGraphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"enableMidpoints",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xr.prototype,"enableEdgeOffset",void 0),(0,n._)([(0,l.Cb)()],xr.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,type:wr.Z})],xr.prototype,"labelOptions",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,type:Ua.Z})],xr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],xr.prototype,"snappingManager",void 0),(0,n._)([(0,l.Cb)()],xr.prototype,"updating",null),(0,n._)([(0,l.Cb)()],xr.prototype,"automaticManipulatorSelection",void 0),xr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],xr);var Or=i(17768),Er=i(99346);let Tr=class extends cr.h{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,n._)([(0,l.Cb)()],Tr.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],Tr.prototype,"rotation",void 0),(0,n._)([(0,l.Cb)()],Tr.prototype,"rotationPrecision",void 0),(0,n._)([(0,l.Cb)()],Tr.prototype,"orientation",void 0),(0,n._)([(0,l.Cb)()],Tr.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.Cb)()],Tr.prototype,"rotationType",void 0),Tr=(0,n._)([(0,u.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Tr);let Cr=class extends cr.h{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};(0,n._)([(0,l.Cb)()],Cr.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],Cr.prototype,"scale",void 0),(0,n._)([(0,l.Cb)()],Cr.prototype,"size",void 0),(0,n._)([(0,l.Cb)()],Cr.prototype,"sizeUnit",void 0),(0,n._)([(0,l.Cb)()],Cr.prototype,"sizePrecision",void 0),Cr=(0,n._)([(0,u.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Cr);let Ar=class extends cr.h{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};var Pr;(0,n._)([(0,l.Cb)()],Ar.prototype,"type",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"orientation",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"rotationType",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"size",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"sizePrecision",void 0),(0,n._)([(0,l.Cb)()],Ar.prototype,"sizeUnit",void 0),Ar=(0,n._)([(0,u.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ar),function(e){e.ScaleIn=dn.jg.Custom2,e.ScaleOut=dn.jg.Custom3,e.RotateLeft=dn.jg.Custom4,e.RotateRight=dn.jg.Custom5,e.Unlocked=dn.jg.Custom7,e.DelayedFocused=dn.jg.Custom8,e.TouchInput=dn.jg.Custom12}(Pr||(Pr={}));let Dr=class extends y.Z{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new hi.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>{var e;return"scale"===(null===(e=this._scaleRotateDragData)||void 0===e?void 0:e.mode)?this.adapter.scale:1}}initialize(){this._tooltip=new Wa.u({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,s.gx)((()=>!this.tooltipOptions.enabled),(()=>this._tooltip.clear()),s.nn),(0,s.YP)((()=>{const{adapter:e}=this,{info:t}=this._tooltip;return t===this._absoluteTooltipInfo&&this.getFocused()?[t,e.size,e.orientationClockwise]:[null]}),(e=>{let[t]=e;t&&this._updateFocusTooltip()}))])}destroy(){var e;null!==(e=this._activeAnimation)&&void 0!==e&&e.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,o.SC)(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,Er.A)({update:t=>{let{deltaTime:i}=t;e.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){var e;null!==(e=this._activeAnimation)&&void 0!==e&&e.frameTask.remove(),this._activeAnimation=(0,o.SC)(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,Yn.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=(0,pa.Xd)(e,((e,i,n)=>{this._scaleRotateDragData=null;const a=this.adapter.startInteraction(),r={mode:"none",origin:(0,_.g)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=r,this._updateDragState();const o=gt.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next(_a(this.tool.view,(0,on.Yq)(e.renderLocation,o,(0,on.Ue)()))).next((e=>{const i=(0,on.mJ)(e.plane),n=zn(e.renderStart,e.renderEnd,r.origin,i),o=Or.Q4.shortestSignedDiff(r.angle,n);r.angleDir=(0,Le.uZ)(r.angleDir+o,-.3,.3),r.angle=n;const s=function(e,t){const i=(0,p.f)(gt.WM.get(),t.renderStart,e.origin),n=(0,p.f)(gt.WM.get(),t.renderEnd,e.origin),a=(0,p.l)(i),r=(0,p.l)(n);return 0===a?0:r/a}(r,e),l=s-this.adapter.scale;if(r.scaleDir=(0,Le.uZ)(r.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===r.mode){const i=this.mode||function(e,t,i,n){const{renderStart:a,renderEnd:r}=e,o=Rr(a,n,gt.WM.get()),s=Rr(r,n,gt.WM.get());if((0,p.a)(o,s)<100)return null;const l=(0,p.f)(gt.WM.get(),a,i),c=(0,p.b)(gt.WM.get(),l,(0,on.mJ)(t)),h=a,d=(0,p.g)(gt.WM.get(),h,c),u=Rr(i,n,gt.WM.get()),_=o,g=Rr(d,n,gt.WM.get()),v=(0,p.f)(gt.WM.get(),g,_),m=(0,p.f)(gt.WM.get(),o,u),f=(0,J.re)(_,v),y=(0,J.re)(u,m);return(0,J.Jk)(f,s)<(0,J.Jk)(y,s)?"rotate":"scale"}(e,e.plane,r.origin,this.tool.view.state.camera);if(null!=i){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}r.mode=i}}switch(r.mode){case"rotate":a.state.angle=r.initialAngle+n;break;case"scale":a.state.scale=s,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:(0,Le.BV)(r.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:s,yScale:s})}break;case"end":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:(0,Le.BV)(r.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:s,yScale:s})}}return"end"===e.action&&(this.startAnimation(Lr(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),a.done()),e})).next(this._updateTooltipPipelineStep(r)),n.next((()=>{if(a.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Lr(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,i){let n=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,n=0,t()},update:e=>{var t;return n+=e,null===(t=a)||void 0===t||!t()||n>=i.delayMs?Ir.STOP:Ir.CONTINUE},destroy:()=>{a&&(e.getFocused=a),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,s.YP)((()=>{var e;return null===(e=this.tool.graphicState)||void 0===e?void 0:e.displaying}),(e=>this._ringManipulator.available=e),s.nn)])}_updateTooltipPipelineStep(e){return t=>{const i=this.tooltipOptions;if(!i.enabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const n=this._tooltip,a=this.tooltipOptions.visualVariables;switch(e.mode){case"scale":{var r;n.info=null!==(r=this._scaleTooltipInfo)&&void 0!==r?r:this._scaleTooltipInfo=new Cr({tooltipOptions:i});const{size:e,scale:t}=this.adapter,o=null===a||void 0===a?void 0:a.size,s=n.info;s.tooltipOptions=i,s.scale={value:t},s.size=null!=e?(0,Xi.yG)(e,"meters"):void 0,s.sizePrecision=Gr(null===o||void 0===o?void 0:o.valueType),s.sizeUnit=null===o||void 0===o?void 0:o.unit;break}case"rotate":{var o,s;n.info=null!==(o=this._rotateTooltipInfo)&&void 0!==o?o:this._rotateTooltipInfo=new Tr({tooltipOptions:i});const{orientationClockwise:e,relativeAngleClockwise:t}=this.adapter,r=null===a||void 0===a?void 0:a.rotation,l=Gr(null===r||void 0===r?void 0:r.valueType),c=n.info;c.tooltipOptions=i,c.rotation=null!=t?(0,Xi.GJ)(t,"radians","geographic"):void 0,c.rotationPrecision=l,c.rotationType=null!==(s=null===r||void 0===r?void 0:r.rotationType)&&void 0!==s?s:"geographic",c.orientation=null!=e?(0,Xi.GJ)(e,"radians","geographic"):void 0,c.orientationPrecision=l;break}}return t}}_updateFocusTooltip(){const{tooltipOptions:e,_tooltip:t}=this;if(e.enabled)if(this.getFocused()){var i,n;const a=e.visualVariables,r=null===a||void 0===a?void 0:a.rotation,o=null===a||void 0===a?void 0:a.size,s=this.mode,{size:l,orientationClockwise:c}=this.adapter,h=null!=c&&(null==s||"rotate"===s),d=null!=l&&(null==s||"scale"===s);t.info=null!==(i=this._absoluteTooltipInfo)&&void 0!==i?i:this._absoluteTooltipInfo=new Ar({tooltipOptions:e});const u=t.info;u.tooltipOptions=e,u.orientation=h?(0,Xi.GJ)(c,"radians","geographic"):void 0,u.orientationPrecision=Gr(null===r||void 0===r?void 0:r.valueType),u.rotationType=null!==(n=null===r||void 0===r?void 0:r.rotationType)&&void 0!==n?n:"geographic",u.size=d?(0,Xi.yG)(l,"meters"):void 0,u.sizeUnit=null===o||void 0===o?void 0:o.unit,u.sizePrecision=Gr(null===o||void 0===o?void 0:o.valueType)}else t.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Pr.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){var e;if(this._ringManipulator.updateStateEnabled(Pr.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==(null===(e=this._scaleRotateDragData)||void 0===e?void 0:e.mode))),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Pr.ScaleIn|Pr.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Pr.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Pr.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Pr.RotateLeft|Pr.RotateRight,!1),this._ringManipulator.updateStateEnabled(Pr.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Pr.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Pr.ScaleIn|Pr.ScaleOut|Pr.RotateLeft|Pr.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,vt.c)(gt.MP.get(),this.adapter.angle,(0,_.f)(0,0,1));if(null==e)return;const t=this.getScale(),i=(0,vt.E)(gt.MP.get(),(0,p.s)(gt.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,vt.m)(gt.MP.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const n=[],a=Math.ceil(128*(t-e)/(2*Math.PI));for(let r=0;r<a+1;r++){const o=e+r*(t-e)/a;n.push((0,_.f)(i*Math.cos(o),i*Math.sin(o),0))}return n},t=t=>e(0,2*Math.PI,t),i=this._createMaterial(1),n=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;return(0,ke.x2)(n,(e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1)},a=t(oa),r=n(a,24),o={left:new Array,right:new Array},s=[];for(let _=0;_<2;_++){const t=_*Math.PI-Math.PI/4,a=Math.PI/2-sa,r=t+a,l=t+Math.PI/2-a,c=e(r,l,190),h=n(c,9);s.push(c),s.push(e(r,l,201)),o.left.push(h),o.right.push(h.instantiate());for(let e=0;e<2;e++){const t=0===e,n=(0,mt.a)();if(t){(0,vt.b)(n,n,[1,-1,1]),(0,vt.k)(n,n,-r,[0,0,1]);const e=Math.round(.2*(c.length-1));n[12]=c[e][0],n[13]=c[e][1],n[14]=c[e][2]}else{(0,vt.k)(n,n,l,[0,0,1]);const e=Math.round(.8*(c.length-1));n[12]=c[e][0],n[13]=c[e][1],n[14]=c[e][2]}const a=(0,ke.DA)(i,60,0,23,.5);(0,ke.mx)(a,n),(t?o.left:o.right).push(a)}}const l=[];for(let _=0;_<2;_++){const t=_*Math.PI-Math.PI/4,i=Math.PI/2-la,a=t+i,r=t+Math.PI/2-i,o=e(a,r,213);l.push(n(o,9))}const c=this._createMaterial(.66),h=this._createMaterial(.5),d=this._createMaterial(.33),u=t(190),p=t(213),v=n(u,9,c),m=n(p,9,d),f=t(130),y=t(107),b=n(f,9,c),M=n(y,9,d);let S=[new Pn(r,Pr.DelayedFocused),new Pn(r.instantiate({material:h}),dn.Q9.None)];this.mode&&"scale"!==this.mode||(S=S.concat([...l.map((e=>new Pn(e,Pr.DelayedFocused|Pr.Unlocked))),new Pn(v,Pr.DelayedFocused|Pr.ScaleIn),new Pn(m,Pr.DelayedFocused|Pr.ScaleIn),new Pn(b,Pr.DelayedFocused|Pr.ScaleOut),new Pn(M,Pr.DelayedFocused|Pr.ScaleOut)])),this.mode&&"rotate"!==this.mode||(S=S.concat([...o.right.map((e=>new Pn(e.instantiate(),Pr.DelayedFocused|Pr.Unlocked))),...o.left.map((e=>new Pn(e,Pr.DelayedFocused|Pr.RotateLeft))),...o.right.map((e=>new Pn(e,Pr.DelayedFocused|Pr.RotateRight)))]));const w=[a,...s];return new pn({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,g.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:w,direction:(0,_.f)(0,0,1)}})}_createMaterial(e){const t=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Transparent,isDecoration:!0});return this.addHandles((0,s.YP)((()=>({color:(0,a.Ch)(this.tool.view.effectiveTheme.accentColor,e)})),(e=>t.setParameters(e)),s.nn)),t}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:e=>this._ringIndicatorDelayMs=e,tooltip:this._tooltip}}};function Rr(e,t,i){return t.projectToScreen(e,zr),(0,p.s)(i,zr[0],zr[1],0)}var Ir;function Lr(e,t){let i=null,n=1;const a=()=>n;return{start:()=>{n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:e=>(n+=((n+1)/2-n)*Math.min(3*e,1),t(),Math.abs(n-1)<.01?Ir.STOP:Ir.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function Gr(e){switch(e){case"integer":case"long":return 0;default:return null}}(0,n._)([(0,l.Cb)({constructOnly:!0})],Dr.prototype,"tool",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Dr.prototype,"adapter",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Dr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.Cb)()],Dr.prototype,"mode",void 0),(0,n._)([(0,l.Cb)()],Dr.prototype,"_activeAnimation",void 0),(0,n._)([(0,l.Cb)()],Dr.prototype,"updating",null),Dr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.transformGraphic.GraphicScaleRotateTransform")],Dr),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Ir||(Ir={}));const zr=(0,m.s1)();var Vr=i(45238),jr=i(76046);function Hr(e){return null!=e.geometry&&"mesh"===e.geometry.type?function(e){return e.vertexSpace.isRelative?function(e,t,i){let n=null===t||void 0===t?void 0:t.clone(),a=(0,_.g)(i.origin),r=null,o=null;return{undo:t=>{var s;r=null===(s=e.transform)||void 0===s?void 0:s.clone(),o=(0,_.g)(i.origin),e.transform=n,e.vertexSpace.origin=a,t.notifyMeshTransformChanged()},redo:t=>{var s;n=null===(s=e.transform)||void 0===s?void 0:s.clone(),a=(0,_.g)(i.origin),e.transform=r,e.vertexSpace.origin=o,t.notifyMeshTransformChanged()}}}(e,e.transform,e.vertexSpace):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:n=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,n.notifyGeometryChanged()},redo:n=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=null;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Nr=class extends y.Z{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,s.gx)((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(e=>{let{interactionState:t}=e;this._updateMeshRotation(t)}),s.Z_),(0,s.gx)((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(e=>{let{interactionState:t}=e;this._updateMeshSize(t)}),s.Z_)])}get initialAngle(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.initialAngle)&&void 0!==e?e:0}get angle(){var e,t;const i=this.geometry.transform;if(null==i)return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.angle)&&void 0!==e?e:0;const n=(0,Vr.ZZ)(i.rotation)[2];return Math.abs(n)>.999999?(0,Le.Vl)((0,Vr.EU)(i.rotation))*Math.sign(n):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.scale)&&void 0!==e?e:1}startInteraction(){const e=new Ur({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return Hr(this.graphic)}_updateMeshRotation(e){const{angle:t,previousAngle:i}=e;e.previousAngle=t;const{geometry:n}=this,{vertexSpace:a}=n,r=(0,Le.BV)(t-i);if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===he.JY.Global,t=this.geometry.anchor;this.geometry.rotate(0,0,r,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{var o;null!==(o=n.transform)&&void 0!==o||(n.transform=new jr.Z);const{transform:e}=n,t=(0,Vr.qw)(0,0,r,Fr);e.rotation=(0,Vr.qC)(e.rotation,t,e.rotation),this.graphic.notifyMeshTransformChanged()}}_updateMeshSize(e){const{scale:t,previousScale:i}=e;e.previousScale=t;const{geometry:n}=this,{vertexSpace:a}=n,r=t/i;if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===he.JY.Global,t=this.geometry.anchor;this.geometry.scale(r,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{var o;null!==(o=n.transform)&&void 0!==o||(n.transform=new jr.Z);const{transform:e}=n;e.scale=(0,p.i)(e.scale,e.scale,r),this.graphic.notifyMeshTransformChanged()}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Nr.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Nr.prototype,"geometry",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Nr.prototype,"viewingMode",void 0),(0,n._)([(0,l.Cb)()],Nr.prototype,"initialAngle",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"angle",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"angleClockwise",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"relativeAngle",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"scale",null),(0,n._)([(0,l.Cb)()],Nr.prototype,"_interactionState",void 0),Nr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Nr);let Ur=class extends y.Z{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,n._)([(0,l.Cb)()],Ur.prototype,"angle",void 0),(0,n._)([(0,l.Cb)()],Ur.prototype,"initialAngle",void 0),(0,n._)([(0,l.Cb)()],Ur.prototype,"previousAngle",void 0),(0,n._)([(0,l.Cb)()],Ur.prototype,"previousScale",void 0),(0,n._)([(0,l.Cb)()],Ur.prototype,"scale",void 0),(0,n._)([(0,l.Cb)()],Ur.prototype,"state",null),Ur=(0,n._)([(0,u.j)("InteractionState")],Ur);const Fr=(0,Vr.Ue)();let Zr=class extends y.Z{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,s.gx)((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),s.Z_))}get initialAngle(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.initialAngle)&&void 0!==e?e:0}get angle(){var e;return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function(e){return-(0,Le.Vl)(e)}(null!==(e=this._orientationReferenceSymbolLayer.heading)&&void 0!==e?e:0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.scale)&&void 0!==e?e:1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),i=this._graphicSymbol;if(null==t||null==i||"point-3d"!==i.type)return null;const n=t.getSymbolLayerSize(i,e);if("size"in n&&null!=n.size)return n.size;const a=this.sizeAxis;return!("width"in n)||null==n.width||null!=a&&"width"!==a&&"all"!==a&&"width-and-depth"!==a?!("depth"in n)||null==e.depth||null!=a&&"depth"!==a&&"all"!==a&&"width-and-depth"!==a?!("height"in n)||null==e.height||null!=a&&"height"!==a&&"all"!==a?null:n.height:n.depth:n.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){var e;return null!=(null===(e=this.graphic)||void 0===e?void 0:e.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return Wr;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),n=e.clone(),a=this.angle,r=new Yr({originalSymbol:n,angle:a,initialSizes:i});this._interactionState=r;const o=()=>{this._interactionState=null};return{state:r,done:o,cancel:()=>{this._graphicSymbol=n,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol(e){let{scale:t,angle:i,originalSymbol:n,initialSizes:a}=e;const r=this._graphicSymbol;if(null==r||"point-3d"!==r.type)return;const o=r.clone(),s=-(0,Le.BV)(i-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(n,o,((e,i,n)=>{var r;const o=(null!==(r=e.heading)&&void 0!==r?r:0)+s;i.heading!==o&&(i.heading=o,l=!0);const c=a[n];if(null!=c&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const e=c.width*t;i.width!==e&&(i.width=e,l=!0);const n=c.depth*t;i.depth!==n&&(i.depth=n,l=!0);const a=c.height*t;i.height!==a&&(i.height=a,l=!0)}})),l&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,n)=>{const a=t.symbolLayers.at(n);"object"===e.type&&"object"===a.type&&i(e,a,n)}))}};(0,n._)([(0,l.Cb)()],Zr.prototype,"initialAngle",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"angle",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"angleClockwise",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"orientation",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"orientationClockwise",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"relativeAngle",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"scale",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"size",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"sizeAxis",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Zr.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)()],Zr.prototype,"_interactionState",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Zr.prototype,"findLayerView",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Zr.prototype,"sizeFilter",void 0),(0,n._)([(0,l.Cb)()],Zr.prototype,"_sizeReferenceSymbolLayer",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"_orientationReferenceSymbolLayer",null),(0,n._)([(0,l.Cb)()],Zr.prototype,"_graphicSymbol",null),Zr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Zr);const Wr={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Yr=class extends y.Z{get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,n._)([(0,l.Cb)()],Yr.prototype,"originalSymbol",void 0),(0,n._)([(0,l.Cb)()],Yr.prototype,"angle",void 0),(0,n._)([(0,l.Cb)()],Yr.prototype,"initialAngle",void 0),(0,n._)([(0,l.Cb)()],Yr.prototype,"initialSizes",void 0),(0,n._)([(0,l.Cb)()],Yr.prototype,"scale",void 0),(0,n._)([(0,l.Cb)()],Yr.prototype,"state",null),Yr=(0,n._)([(0,u.j)("InteractionState")],Yr);let kr=class extends(hi.Z.EventedMixin(Ha.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Ua.Z,this.type="transform-3d",this._updatingHandles=new qi.R,this._scaleRotate=null,this._tooltip=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new Hi.F({graphic:e}),this.addHandles((0,s.YP)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Wa.u({view:t}):(0,o.SC)(this._tooltip)}),s.tX)),this._moveManipulation=new Ia({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Zn(e),radius:Ia.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))));const i=e=>t=>{this.addHandles(t.events.on("focus-changed",(t=>{let{action:i}=t;const n=this._tooltip;null!=n&&("focus"===i?this._updateMoveTooltip(e):n.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(Ga.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Ga.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Ga.Z));const n=(0,g.RL)(e);this._moveManipulation.elevationInfo=n,this.addHandles(kt(this.graphicState));const{geometry:a}=e;if(this._moveManipulation.createGraphicDragPipeline(((i,r,o,s,l)=>{if(null!=a&&i===Ga.XY){const{snappingStep:i,cancelSnapping:r}=(0,Za.W)({snappingContext:new Fa.N({elevationInfo:n,pointer:l,editGeometryOperations:Na.c.fromGeometry(new un.Z({spatialReference:a.spatialReference}),t.state.viewingMode),visualizer:new Ht,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});s=s.next(r),o=o.next((0,pa.Mz)(this.view,n)).next(...i)}return{steps:o=o.next((e=>(this._updateMoveTooltip(i,e),e))),cancel:s}}),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:n,dyScreen:a}=e,r={graphic:i,dxScreen:n,dyScreen:a};switch(t){case"start":this.emit("graphic-translate-start",r),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",r);break;case"end":this.emit("graphic-translate-stop",r)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,s.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Dr({tool:this,mode:e,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([na({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,r.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,s.YP)((()=>t.scale),(()=>this._updateMoveAngle()))].filter(h.pC)),this.addHandles(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof pn&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,o.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,o.SC)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){var e,t;return null!=this.graphic.geometry&&"mesh"===this.graphic.geometry.type?new Nr({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Zr({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer)),sizeAxis:null!==(e=null===(t=this.tooltipOptions)||void 0===t||null===(t=t.visualVariables)||void 0===t||null===(t=t.size)||void 0===t?void 0:t.axis)&&void 0!==e?e:null})}_forEachManipulator(e){var t,i;null!==(t=this._moveManipulation)&&void 0!==t&&t.forEachManipulator(e),null===(i=this._scaleRotate)||void 0===i||i.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,s.YP)((()=>this.graphicState.displaying),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Zn(this.graphic)}))}_createGeometryUndoRecord(){return Hr(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){var e;return this._updatingHandles.updating||!(null===(e=this._scaleRotate)||void 0===e||!e.updating)}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){var e;null===(e=this._scaleRotate)||void 0===e||e.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===he.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){Hn(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(e,t){var i,n,a;const{tooltipOptions:r,_tooltip:o}=this;if(null==o)return;o.clear();const s=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Ga.XY:o.info=null!==(i=this._translateGraphicTooltipInfo)&&void 0!==i?i:this._translateGraphicTooltipInfo=new Ya.$E({tooltipOptions:r}),this._updateMoveTooltipDistance(o.info,t,((e,t)=>(0,G.GQ)(e,t,s)));break;case Ga.XY_AXIS:o.info=null!==(n=this._translateGraphicXYTooltipInfo)&&void 0!==n?n:this._translateGraphicXYTooltipInfo=new Ya.in({tooltipOptions:r}),this._updateMoveTooltipDistance(o.info,t,((e,i)=>{const n=(0,G.GQ)(e,i,s);return(0,Xi.bA)(n,xa(t))}));break;case Ga.Z:o.info=null!==(a=this._translateGraphicZTooltipInfo)&&void 0!==a?a:this._translateGraphicZTooltipInfo=new Ya.QW({tooltipOptions:r}),this._updateMoveTooltipDistance(o.info,t,ka._e)}o.info.tooltipOptions=r}_updateMoveTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Xi.yP}else e.distance=Xi.yP}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:null!=this._scaleRotate?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:e=>null!=this._scaleRotate?this._scaleRotate.test.setRingIndicatorDelayMs(e):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],kr.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],kr.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],kr.prototype,"enableZ",void 0),(0,n._)([(0,l.Cb)()],kr.prototype,"enableRotation",void 0),(0,n._)([(0,l.Cb)()],kr.prototype,"enableScaling",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,type:Ua.Z})],kr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.Cb)()],kr.prototype,"graphicState",void 0),(0,n._)([(0,l.Cb)({value:!1})],kr.prototype,"snapToScene",null),(0,n._)([(0,l.Cb)({constructOnly:!0})],kr.prototype,"snappingManager",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],kr.prototype,"type",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],kr.prototype,"updating",null),kr=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],kr);var Br=i(11582),Xr=i(46784),qr=i(89125),Qr=i(96866);let Jr=class extends((0,Br.J)(Xr.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,o._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,n._)([(0,l.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Jr.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:un.Z}),(0,Qr.B)()],Jr.prototype,"position",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Qr.B)(),(0,qr.p)((e=>Or.BV.normalize((0,c.q9)(e),0,!0)))],Jr.prototype,"heading",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Qr.B)(),(0,qr.p)((e=>Or.BV.normalize((0,c.q9)(e),0,!0)))],Jr.prototype,"tilt",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0}),(0,Qr.B)()],Jr.prototype,"width",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0}),(0,Qr.B)()],Jr.prototype,"height",void 0),Jr=(0,n._)([(0,u.j)("esri.analysis.SlicePlane")],Jr);i(14320);var Kr=i(82218);(0,pt.f)(0,0,0,.04);(0,d.Z)("mac");const $r=1.15,eo=1.15,to=(Math.cos((0,Le.Vl)(45)),Math.cos((0,Le.Vl)(5)),3),io=11,no=22.5,ao=.3;(0,mt.a)();var ro=i(12594),oo=i(64642),so=i(11983),lo=i(11316);class co extends me.A{initializeProgram(e){return new fe.$(e.rctx,co.shader.get().build(this.configuration),ze.i)}initializePipeline(){return(0,Me.sm)({blending:(0,Me.wK)(be.zi.ONE,be.zi.ONE,be.zi.ONE_MINUS_SRC_ALPHA,be.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:be.wb.LESS},colorWrite:Me.BK})}}co.shader=new ve.J(lo.S,(()=>i.e(8492).then(i.bind(i,18492))));i(18722);i(9738),i(5629),i(85305);var ho;i(53866);function uo(e){const t=(0,p.l)(e.basis1),i=(0,p.l)(e.basis2);return ao*Math.min(t,i)}function po(e){return uo(e)}function _o(e){return 0!==e.direction[0]&&0!==e.direction[1]}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(ho||(ho={}));const go=dn.jg.Custom1;var vo,mo;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(vo||(vo={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(mo||(mo={}));const fo=dn.jg.Custom2,yo=((0,J.Ue)(),Math.PI/2),bo=dn.jg.Custom1,Mo=dn.jg.Custom2;var So,wo=i(48976);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(So||(So={}));class xo extends pn{constructor(e,t){const i=new qe.U({width:1,renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0}),n=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Opaque,isDecoration:!0}),r=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Opaque,isDecoration:!0}),o=new At.E({cullFace:mi.Vr.Back,renderOccluded:Be.yD.Opaque,isDecoration:!0}),l=new At.E({writeDepth:!1,cullFace:mi.Vr.Front,renderOccluded:Be.yD.Transparent,isDecoration:!0});super({view:e,...Oo({offsetMode:t,tubeMaterial:n,tipMaterial:r,capMaterial:o,outlineMaterial:l,calloutMaterial:i})}),this._themeHandle=(0,s.YP)((()=>e.effectiveTheme.accentColor),(e=>{const t=(0,a.mj)(e),s=f.Z.toUnitRGBA(e),c=f.Z.toUnitRGBA(t),h=f.Z.toUnitRGBA(f.Z.blendColors(t,e,.4)),d=f.Z.toUnitRGBA(f.Z.blendColors(t,e,.14));i.setParameters({color:s}),n.setParameters({color:d}),r.setParameters({color:c}),o.setParameters({color:h}),l.setParameters({color:s})}),s.nn)}destroy(){this._themeHandle.remove(),super.destroy()}}function Oo(e){let{offsetMode:t,tubeMaterial:i,tipMaterial:n,capMaterial:a,outlineMaterial:r,calloutMaterial:o}=e;const s=t===So.CENTER_ON_CALLOUT?40:0,l=[(0,_.f)(s,0,-24),(0,_.f)(s,0,24)],c=function(e,t){const i=(0,p.f)((0,_.c)(),e[e.length-1],e[e.length-2]);if((0,p.n)(i,i),(0,p.i)(i,i,no),(0,p.g)(i,i,e[e.length-1]),t){const t=(0,p.f)((0,_.c)(),e[0],e[1]);return(0,p.n)(t,t),(0,p.i)(t,t,no),(0,p.g)(t,t,e[0]),[t,...e,i]}return[...e,i]}(l,!0),h=Eo({vertices:l,padding:0,materials:{tube:i,tip:n,cap:a}}),d=Eo({vertices:l,padding:2.25,materials:{tube:r,tip:r,cap:r}}),u=(0,ke.rh)(o,[[s,0,0],[s-40,0,0]]),g=(0,ke.rh)(o,[[s,0,0],[s-40,0,0]]);return{renderObjects:[...h.normal.map((e=>new Pn(e,dn.Q9.Unfocused|go))),...d.normal.map((e=>new Pn(e,dn.Q9.Unfocused|go))),new Pn(u,dn.Q9.Unfocused|go|fo),...h.focused.map((e=>new Pn(e,dn.Q9.Focused|go))),...d.focused.map((e=>new Pn(e,dn.Q9.Focused|go))),new Pn(g,dn.Q9.Focused|go|fo)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[c]},collisionPriority:1,radius:io,state:go}}function Eo(e){let{vertices:t,padding:i,materials:n}=e;const a=e=>{const a=t.slice(0),r=(0,p.f)(gt.WM.get(),a[0],a[1]);(0,p.n)(r,r);const o=(0,p.f)(gt.WM.get(),a[a.length-1],a[a.length-2]);if((0,p.n)(o,o),i>0){const e=(0,p.i)((0,_.c)(),o,-i);a[a.length-1]=(0,p.g)(e,e,a[a.length-1]);const t=(0,p.i)((0,_.c)(),r,-i);a[0]=(0,p.g)(t,t,a[0])}const s=e?eo:1,l=no*s,c=io*s,h=(0,vt.g)(gt.MP.get());if(i>0){const e=l/4,t=(0,p.s)(gt.WM.get(),0,e,0),n=1+i/e;(0,vt.w)(h,h,t),(0,vt.b)(h,h,(0,p.s)(gt.WM.get(),n,n,n)),(0,vt.w)(h,h,(0,p.i)(t,t,-1/n))}const d=(0,vt.g)((0,mt.a)()),u=(0,_.f)(0,1,0),g=(0,vt.F)((0,mt.a)(),(0,wo.r)(gt.vD.get(),u,o));g[12]=a[a.length-1][0],g[13]=a[a.length-1][1],g[14]=a[a.length-1][2],(0,vt.m)(g,g,h);const v=n.tube,m=function(e,t,i){const n=[],a=12;for(let r=0;r<a;r++){const t=r/a*2*Math.PI;n.push([Math.cos(t)*e,Math.sin(t)*e])}return(0,ke.x2)(i,n,t,[],[],!1)}(to*(e?$r:1)+i,a,v);m.transformation=d;const f=[m],y=n.tip,b=(0,ke.QL)(y,l,c,24,!1,!1,!0);b.transformation=g,f.push(b);const M=n.cap,S=(0,ke.QL)(M,l,c,24,!1,!0,!1);S.transformation=g,f.push(S);const w=(0,vt.F)((0,mt.a)(),(0,wo.r)(gt.vD.get(),u,r));return w[12]=a[0][0],w[13]=a[0][1],w[14]=a[0][2],(0,vt.m)(w,w,h),f.push(b.instantiate({transformation:w})),f.push(S.instantiate({transformation:w})),f};return{normal:a(!1),focused:a(!0)}}var To=i(92583);class Co{constructor(e,t,i,n){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const a=this._tool,r=a.view;this.moveXYGraphicManipulation=new Va({view:r,tool:a,graphicState:this._graphicState}),a.addHandles(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=new xo(r,So.CENTER_ON_CALLOUT),this.moveZManipulator.state|=fo,a.manipulators.add(this.moveZManipulator),a.addHandles([this._createMoveZDragPipeline()]),a.addHandles([a.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYGraphicManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYGraphicManipulation.forEachManipulator(e),e(this.moveZManipulator,Yn.TRANSLATE_Z)}updateManipulators(e,t){const i=this.moveZManipulator,n=(0,vt.o)(gt.MP.get(),e,Math.PI);n[12]=0,n[13]=0,n[14]=0,i.modelTransform=n,i.renderLocation=(0,p.f)(gt.WM.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYGraphicManipulation.grabbing||this.moveXYGraphicManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){var e;const t=this._tool.tooltipOptions;return null!==(e=this._moveXYTooltipInfo)&&void 0!==e?e:this._moveXYTooltipInfo=new Ya.$E({tooltipOptions:t})}_computeMoveZTooltipInfo(){var e;const t=this._tool,i=t.tooltipOptions,n=null!==(e=this._moveZTooltipInfo)&&void 0!==e?e:this._moveZTooltipInfo=new Ya.QW({tooltipOptions:i});if(this.moveZManipulator.dragging){const e=this._bounds,t=e.mapBoundsStart.origin,i=e.mapBounds.origin,a=(0,ka.Cr)(t,i,this._tool.view.spatialReference);if(null==a)return null;n.distance=a}else n.distance=(0,Xi.yG)(0,t.moveUnit);return n}_updateMoveTooltip(e,t){if(t===Ga.XY||t===Ga.XY_AXIS){const t=(0,G.GQ)(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");null!=t&&null!=this._moveXYTooltipInfo&&(this._moveXYTooltipInfo.distance=t)}return e}_createMoveXYGraphicDragPipeline(){return this.moveXYGraphicManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i,Ga.XY)))}_createMoveZDragPipeline(){const e=this._editGeometryOperations.data.spatialReference;return(0,pa.Xd)(this.moveZManipulator,((t,i,n)=>{const a=(0,_.g)(t.renderLocation),r=i.next(fa(this._tool.view,a,e)).next((0,pa.zh)());this._applyGraphicMoveSteps(r,n,Ga.Z)}))}_applyGraphicMoveSteps(e,t,i){const n=this._tool,a=n.graphic,r=e.next((e=>("start"===e.action&&(n.inputState={type:"move"},this._bounds.backupMapBounds(),n.emit("graphic-translate-start",{graphic:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,pa.AN)()).next(this._moveDragUpdateGeometry()).next((e=>{var t,i;const r={graphic:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(null!==(t=e.mapEnd.z)&&void 0!==t?t:0)-(null!==(i=e.mapStart.z)&&void 0!==i?i:0))&&n.emit("graphic-translate",r);break;case"end":n.inputState=null,n.emit("graphic-translate-stop",r)}return e})).next((e=>this._updateMoveTooltip(e,i)));return t.next((()=>{null!=n.inputState&&n.emit("graphic-translate-stop",{graphic:a,dxScreen:0,dyScreen:0}),n.cancel()})),r}_moveDragUpdateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const i=[];for(const e of this._editGeometryOperations.data.components)i.push(...e.vertices);const n="start"===t.action?lr.O.NEW_STEP:lr.O.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);return(0,To.nn)(a,this._bounds.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,t}}}const Ao="theme-style";function Po(e,t){return function(e,t){const i=new Image(t,t);return i.src=e,i}(function(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))}(function(e,t){let{accentColor:i,contrastColor:n}=t;const a=i.toHex(),r=i.a,o=n.toHex(),s=n.a,l=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(Ao);return l&&(l.innerHTML="\n      .contrast-fill { fill: ".concat(o,"; fill-opacity: ").concat(s,"; }\n      .contrast-stroke { stroke: ").concat(o,"; stroke-opacity: ").concat(s,";  }\n      .accent-fill { fill: ").concat(a,"; fill-opacity: ").concat(r,"; }\n      .accent-stroke { stroke: ").concat(a,"; stroke-opacity:  ").concat(r,"; }")),e}(function(e){const t=e.split(",")[1],i=atob(t);return(new DOMParser).parseFromString(i,"image/svg+xml")}(e),t)),t.size)}var Do=i(76873);var Ro=i(17363),Io=i(50411),Lo=i(32500);class Go extends me.A{initializeProgram(e){return new fe.$(e.rctx,Go.shader.get().build(this.configuration),jo)}_setPipelineState(e,t){const i=this.configuration,n=e===xi.A.NONE,a=e===xi.A.FrontFace;return(0,Me.sm)({blending:i.output!==yi.H.Color&&i.output!==yi.H.Alpha||!i.transparent?null:n?zo:(0,wi.j7)(e),culling:(0,Me.zp)(i.cullFace),depthTest:{func:(0,wi.Bh)(e)},depthWrite:n?i.writeDepth?Me.LZ:null:(0,wi.K5)(e),colorWrite:Me.BK,stencilWrite:i.hasOccludees?Io.s3:null,stencilTest:i.hasOccludees?t?Io.eD:Io.RY:null,polygonOffset:n||a?null:(0,wi.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}Go.shader=new ve.J(Lo.I,(()=>i.e(8957).then(i.bind(i,18957))));const zo=(0,Me.if)(be.zi.ONE,be.zi.ONE_MINUS_SRC_ALPHA);class Vo extends Oi.W{constructor(){super(...arguments),this.output=yi.H.Color,this.cullFace=mi.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=xi.A.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,n._)([(0,Re.o)({count:yi.H.COUNT})],Vo.prototype,"output",void 0),(0,n._)([(0,Re.o)({count:mi.Vr.COUNT})],Vo.prototype,"cullFace",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"transparent",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"enableOffset",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"writeDepth",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"hasOccludees",void 0),(0,n._)([(0,Re.o)({count:xi.A.COUNT})],Vo.prototype,"transparencyPassType",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"multipassEnabled",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"cullAboveGround",void 0),(0,n._)([(0,Re.o)()],Vo.prototype,"perspectiveInterpolation",void 0),(0,n._)([(0,Re.o)({constValue:!1})],Vo.prototype,"occlusionPass",void 0);const jo=new Map([[ge.T.POSITION,0],[ge.T.UV0,2],[ge.T.PERSPECTIVEDIVIDE,3]]);class Ho extends so.c{constructor(e){super(e,new Fo),this.supportsEdges=!0,this._vertexAttributeLocations=jo,this._configuration=new Vo}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<wi.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}produces(e,t){return(t===yi.H.Color||t===yi.H.Alpha||t===yi.H.Highlight)&&(e===Pe.r.DRAPED_MATERIAL||(t===yi.H.Highlight?e===Pe.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Pe.r.TRANSPARENT_MATERIAL:Pe.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Pe.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new No(e)}createBufferWriter(){const e=oo.W1.clone();return this.parameters.perspectiveInterpolation&&e.f32(ge.T.PERSPECTIVEDIVIDE),new Uo(e)}}class No extends Ro.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Go,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==yi.H.Color&&this._output!==yi.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Uo extends ro.G{write(e,t,i,n,a){for(const r of this.vertexBufferLayout.fields.keys()){const o=i.attributes.get(r);if(o)if(r===ge.T.PERSPECTIVEDIVIDE){(0,Mi.hu)(1===o.size);const e=n.getField(r,fi.ly);e&&(0,Si.XW)(o,e,a)}else(0,Si.i9)(r,o,e,t,n,a)}}}class Fo extends Be.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=mi.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}class Zo extends pn{constructor(e,t){const i=new Ho({transparent:!0,writeDepth:!1,renderOccluded:Be.yD.Opaque,isDecoration:!0}),n=Ln.calloutWidth,r=new qe.U({width:n,renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0});super({view:e,...Wo({imageMaterial:i,calloutMaterial:r})}),this._currentTexture=null,this._themeHandle=(0,s.YP)((()=>e.effectiveTheme.accentColor),(e=>{const n=(0,a.G)(e,.5),o=(0,a.mj)(e),s=this._currentTexture,l=t(n,o);i.setParameters({textureId:l.texture.id}),r.setParameters({color:f.Z.toUnitRGBA(e)}),this._currentTexture=l,null===s||void 0===s||s.release()}),s.nn)}destroy(){var e;this._themeHandle.remove(),null!==(e=this._currentTexture)&&void 0!==e&&e.release(),super.destroy()}}function Wo(e){let{imageMaterial:t,calloutMaterial:i}=e;const{focusMultiplier:n,calloutLength:a,discRadius:r}=Ln,o=r*n,s=(e,t)=>{const i=[0,1,2,2,3,0];return new Ct.Z(t,[[ge.T.POSITION,new Tt.a([a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],i,3,!0)],[ge.T.UV0,new Tt.a([0,0,1,0,1,1,0,1],i,2,!0)]])},l=(0,ke.rh)(i,[[0,0,0],[a-r,0,0]]),c=(0,ke.rh)(i,[[0,0,0],[a-o,0,0]]),h=go;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:n,radius:r,renderObjects:[new Pn(s(r,t),dn.Q9.Unfocused|h),new Pn(l,dn.Q9.Unfocused|h),new Pn(s(o,t),dn.Q9.Focused|h),new Pn(c,dn.Q9.Focused|h)],state:h}}var Yo=i(34778),ko=i(7068);class Bo{constructor(e,t,i){var n;this._tool=e,this._editGeometryOperations=t,this._bounds=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const a=this._tool,r=a.view,o=!(null!==(n=r._stage)&&void 0!==n&&n.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this.rotateManipulator=new Zo(r,((e,t)=>function(e,t){const{accentColor:i,contrastColor:n,preMultiplyAlpha:a}=t;return e.fromData("heading-rotate:[accent:".concat(i,",contrast:").concat(n,",size:").concat(64,"]"),(()=>new Do.x(Po("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NnoiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3LTEzLjE3IDEuNHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",{accentColor:i,contrastColor:n,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a})))}(r.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:o}))),a.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onRotateGrab(e))),this._createRotateDragPipeline(this.rotateManipulator)]),a.manipulators.add(this.rotateManipulator),a.addHandles([a.on("graphic-rotate-start",(e=>{this._startAngle=e.angle})),a.on("graphic-rotate",(e=>{this._endAngle=e.angle})),a.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,Yn.ROTATE)}updateManipulators(e,t){const i=this._bounds.mapBounds.plane[2]<0?Math.PI:0,n=(0,vt.r)(gt.MP.get(),e,i);n[12]=0,n[13]=0,n[14]=0,this.rotateManipulator.modelTransform=n,this.rotateManipulator.renderLocation=(0,p.g)(gt.WM.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){var e;const t=this._tool.tooltipOptions,i=null!==(e=this._rotateTooltipInfo)&&void 0!==e?e:this._rotateTooltipInfo=new ko.c({tooltipOptions:t});return i.angle=this._startAngle-this._endAngle,i}_onRotateGrab(e){let{action:t,screenPoint:i}=e;const n=this._tool,a=this._bounds;if("start"!==t||!i)return;const r=function(e,t,i,n){const a=t.worldUpAtPosition(e.origin,gt.WM.get()),r=gt.WM.get();switch(i){case vo.HEADING:(0,p.c)(r,a);break;case vo.TILT:(0,p.c)(r,e.basis1)}return(0,on.Yq)(e.origin,r,n)}(a.displayBounds,n.view.renderCoordsHelper,vo.HEADING,(0,on.Ue)()),o=ln(n.view.state.camera,i);(0,on.BR)(r,o,gt.WM.get())&&(a.backupMapBounds(),n.inputState={type:"rotate",rotatePlane:r})}_createRotateDragPipeline(e){const t=this._tool,i=t.graphic;return(0,pa.Xd)(e,((e,n,a)=>{const r=t.inputState;null!=r&&(n.next((e=>("start"===e.action&&t.emit("graphic-rotate-start",{graphic:i,angle:0}),e))).next(_a(t.view,r.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(r)).next(this._rotateDragUpdateGeometry()).next((e=>{const n={graphic:i,angle:(0,Le.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",n);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",n)}return e})),a.next((()=>{null!=t.inputState&&t.emit("graphic-rotate-stop",{graphic:i,angle:0}),t.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,on.mJ)(e.rotatePlane),n=zn(t.renderStart,t.renderEnd,this._bounds.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:n}}}_rotateDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,p.c)((0,_.c)(),t.mapBoundsStart.origin),a=[];for(const e of this._editGeometryOperations.data.components)a.push(...e.vertices);const r="start"===i.action?lr.O.NEW_STEP:lr.O.ACCUMULATE_STEPS,o=this._editGeometryOperations.rotateVertices(a,n,i.rotateAngle,r,Yo.w.REPLACE);return(0,Kr.c)(t.mapBoundsStart,t.mapBounds),(0,To.nn)(o,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}class Xo extends pn{constructor(e,t){const i=_o(t),n=i?4:1,a=2*n,r={renderOccluded:Be.yD.OccludeAndTransparent,isDecoration:!0},o=new qe.U({...r,width:n}),l=new qe.U({...r,width:a}),c=new qe.U({...r,width:1});super({view:e,...Gn,...qo({isCorner:i,unfocusedMaterial:o,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=(0,s.YP)((()=>e.effectiveTheme.accentColor),(e=>{const t=f.Z.toUnitRGBA(e);o.setParameters({color:t}),l.setParameters({color:t}),c.setParameters({color:t})}),s.nn)}destroy(){this._themeHandle.remove(),super.destroy()}}function qo(e){let{isCorner:t,unfocusedMaterial:i,focusedMaterial:n,outlineMaterial:a}=e;const r=t?[(0,_.f)(1,0,0),(0,_.f)(0,0,0),(0,_.f)(0,1,0)]:[(0,_.f)(1,0,0),(0,_.f)(-1,0,0)];return{renderObjects:[new Pn((0,ke.rh)(i,r),dn.Q9.Unfocused|bo),new Pn((0,ke.rh)(n,r),dn.Q9.Focused|bo),new Pn((0,ke.rh)(a,r),Mo)],collisionType:{type:"line",paths:[r]},radius:t?6:4,state:bo}}class Qo{constructor(e,t,i){this._tool=e,this._onDisplayBoundsChanged=t,this.mapBounds=(0,Kr.a)(),this.mapBoundsStart=(0,Kr.a)(),this.displayBounds=(0,Kr.a)(),this._calculateMapBounds(i)}get displayBoundsMargin(){var e,t,i;const{view:n,graphic:a}=this._tool,r=null!==(e=null===(t=n.pointsOfInterest)||void 0===t?void 0:t.centerOnSurfaceFrequent.location)&&void 0!==e?e:null===(i=a.geometry)||void 0===i||null===(i=i.extent)||void 0===i?void 0:i.center;return r?Jo*n.pixelSizeAt(r):0}backupMapBounds(){(0,Kr.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged()}_calculateMapBounds(e){const{view:t,attachmentOrigin:i}=this._tool,n=e.geometry,a=function(e){const t=Un(e);return(0,x.f)(Math.cos(t),Math.sin(t))}(n);(0,w.a)(a,a,-1);const r=t.spatialReference,o=n.spatialReference,s=i?t.pixelSizeAt(i)*(0,er.r6)(r)/(0,er.c9)(o):0;(0,To.lv)(a,e,Ko*s,this.mapBounds)}_calculateDisplayBounds(){var e;const{view:t,attachmentOrigin:i,graphic:n}=this._tool;if(!n.geometry)return;const a=null!==(e=null===i||void 0===i?void 0:i.z)&&void 0!==e?e:(0,yt.w7)(this.mapBounds.origin,t.elevationProvider,bt.o.fromElevationInfo((0,g.RL)(n)),t.renderCoordsHelper),r=(0,Kr.c)(this.mapBounds);r.origin[2]=null!==a&&void 0!==a?a:0,function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;a||(a=(0,Kr.a)()),t.toRenderCoords(e.origin,i,a.origin);const r=gt.WM.get();(0,p.g)(r,e.origin,e.basis1),(0,p.g)(r,r,e.basis2),t.toRenderCoords(r,i,r);const o=gt.WM.get();(0,p.g)(o,e.origin,e.basis1),(0,p.f)(o,o,e.basis2),t.toRenderCoords(o,i,o);const s=gt.WM.get();(0,p.f)(s,e.origin,e.basis1),(0,p.f)(s,s,e.basis2),t.toRenderCoords(s,i,s);const l=gt.WM.get();(0,p.f)(l,e.origin,e.basis1),(0,p.g)(l,l,e.basis2),t.toRenderCoords(l,i,l);const c=(0,p.p)(gt.WM.get(),r,o,.5);(0,p.f)(c,c,a.origin);const h=(0,p.p)(gt.WM.get(),s,l,.5);(0,p.f)(h,a.origin,h),(0,p.p)(a.basis1,c,h,.5);const d=(0,p.p)(gt.WM.get(),l,r,.5);(0,p.f)(d,d,a.origin);const u=(0,p.p)(gt.WM.get(),o,s,.5);(0,p.f)(u,a.origin,u),(0,p.p)(a.basis2,d,u,.5);const _=(0,p.b)(gt.WM.get(),a.basis1,a.basis2),g=(0,p.b)(_,_,a.basis1);(0,p.n)(g,g),(0,p.i)(a.basis2,g,(0,p.j)(a.basis2,g)),(0,p.i)(a.basis1,a.basis1,1+n/(0,p.l)(a.basis1)),(0,p.i)(a.basis2,a.basis2,1+n/(0,p.l)(a.basis2)),(0,Kr.u)(a)}(r,t.renderCoordsHelper,n.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const Jo=10,Ko=80;function $o(e,t,i,n){const a=gt.WM.get();(0,p.f)(a,(0,p.f)(a,e.origin,e.basis1),e.basis2);const r=gt.WM.get();(0,p.q)(r,a,e.basis1,2);const o=gt.WM.get();(0,p.q)(o,r,e.basis2,2);const s=gt.WM.get();(0,p.q)(s,a,e.basis2,2),a[2]=r[2]=o[2]=s[2]=t;const l=n?"on-the-ground":"absolute-height",c=(0,Xi.Fp)((0,G.bZ)(a,r,i,l),(0,G.bZ)(s,o,i,l)),h=(0,Xi.Fp)((0,G.bZ)(r,o,i,l),(0,G.bZ)(a,s,i,l));return null==h||null==c?null:[c,h]}class es{get zMax(){if(!this._zMaxDirty)return this._zMax;const e=this._editGeometryOperations.data;if(e.geometry.hasZ){const i=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const n of e.components)for(const e of n.vertices){var t;const n=null!==(t=i.getZ(e.pos))&&void 0!==t?t:0;this._zMax=Math.max(n,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,i,n,a){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._preserveAspectRatioStep=a,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,Kr.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,x.a)(),this._endScale=(0,x.a)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const r=this._tool,o=r.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new Xo(o,e);return r.addHandles([t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(t,e)]),t})),r.manipulators.addMany(this.resizeManipulators),r.addHandles([r.on("graphic-scale-start",(e=>{(0,w.s)(this._startScale,e.xScale,e.yScale),(0,w.s)(this._endScale,e.xScale,e.yScale)})),r.on("graphic-scale",(e=>{(0,w.s)(this._endScale,e.xScale,e.yScale)})),r.on("graphic-scale-stop",(()=>{(0,w.s)(this._startScale,0,0),(0,w.s)(this._endScale,0,0)})),this._graphicState.on("changed",(()=>{var e;"resize"!==(null===(e=r.inputState)||void 0===e?void 0:e.type)&&(this._zMaxDirty=!0)}))])}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,Yn.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((i,n)=>{!function(e,t,i,n){const a=(0,p.l)(n.basis1),r=(0,p.l)(n.basis2),o=uo(n),s=po(n),l=(0,p.s)(gt.WM.get(),0,0,0);(0,p.g)(l,(0,p.i)(gt.WM.get(),n.basis1,t.direction[0]),(0,p.i)(gt.WM.get(),n.basis2,t.direction[1])),(0,p.g)(l,n.origin,l);let c=0,h=1;if(_o(t))1===t.direction[0]&&-1===t.direction[1]?c=yo:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),h=s;else{const e=0!==t.direction[0]?1:2;c=1===e?yo:0,h=(1===e?r:a)-o}const d=(0,vt.j)(gt.MP.get(),c);(0,vt.b)(d,d,(0,p.s)(gt.WM.get(),h,h,h)),(0,vt.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}(i,this._resizeHandles[n],e,t)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){var e;const t=this._tool,i=t.tooltipOptions,n=null!==(e=this._scaleTooltipInfo)&&void 0!==e?e:this._scaleTooltipInfo=new ko.p({tooltipOptions:i}),a=t.graphic.geometry;if(null==a)return null;const r=$o(this._bounds.mapBounds,this.zMax,a.spatialReference,this._graphicState.isDraped);return null==r?null:(n.xSize=r[0],n.ySize=r[1],null!=this._sizeStart&&this.resizeManipulators.some((e=>e.dragging))?(n.xScale=r[0].value/this._sizeStart[0].value,n.yScale=r[1].value/this._sizeStart[1].value):(n.xScale=1,n.yScale=1),n)}_onResizeGrab(e){let{action:t,screenPoint:i}=e;const n=this._tool,a=this._bounds;if("start"!==t||!i||!n.graphic.geometry)return;const r=ln(n.view.state.camera,i);(0,on.BR)(a.displayBounds.plane,r,gt.WM.get())&&(a.backupMapBounds(),(0,Kr.c)(a.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=a.displayBoundsMargin,this._sizeStart=$o(a.mapBoundsStart,this.zMax,n.graphic.geometry.spatialReference,this._graphicState.isDraped),n.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const i=this._tool,n=i.graphic;return(0,pa.Xd)(e,((e,a,r)=>{null!=i.inputState&&(a.next((e=>("start"===e.action&&i.emit("graphic-scale-start",{graphic:n,xScale:1,yScale:1}),e))).next(_a(i.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:n,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),r.next((()=>{null!=i.inputState&&i.emit("graphic-scale-stop",{graphic:n,xScale:1,yScale:1}),i.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const e=this._bounds;return t=>{const i=this._displayBoundsStart,n=t.handle.direction,a=e.displayBoundsMargin,r=this._displayBoundsMarginStart,o=(0,p.c)(gt.WM.get(),i.origin);(0,p.q)(o,o,i.basis1,-n[0]),(0,p.q)(o,o,i.basis2,-n[1]);const s=(0,p.f)(gt.WM.get(),t.renderEnd,o),l=(0,p.f)(gt.WM.get(),t.renderStart,o),c=_o(t.handle),h=po(i),d=po(e.displayBounds)/h,u=(e,t)=>{if(0===e)return 1;let i=(0,p.l)(t),n=.5*e*(0,p.j)(t,s)/i;const o=n<0?-1:1;c&&(n+=(i-.5*e*(0,p.j)(t,l)/i)*o*d);const h=i<1.5*r?1:ts;return i=Math.max(i-r,ts),o>0&&(n-=a),o*Math.max(o*(n/i),h)};return{...t,factor1:u(n[0],i.basis1),factor2:u(n[1],i.basis2)}}}_resizeDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,p.c)((0,_.c)(),t.mapBoundsStart.origin);(0,p.q)(n,n,t.mapBoundsStart.basis1,-i.handle.direction[0]),(0,p.q)(n,n,t.mapBoundsStart.basis2,-i.handle.direction[1]);const a=(0,w.s)((0,x.a)(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);(0,w.e)(a,a);const r=[];for(const e of this._editGeometryOperations.data.components)r.push(...e.vertices);const o="start"===i.action?lr.O.NEW_STEP:lr.O.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(r,n,a,i.factor1,i.factor2,o,Yo.w.REPLACE);return(0,Kr.c)(t.mapBoundsStart,t.mapBounds),(0,To.nn)(s,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}const ts=1e-6;class is{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new pa.hM;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e),e]}_adjustScaleFactors(e){const t=_o(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}let ns=class extends(hi.Z.EventedMixin(Ha.m)){constructor(e){super(e),this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.tooltipOptions=new Ua.Z,this._preserveAspectRatio=new is,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,graphic:t}=this,i=this._graphicState=new Hi.F({graphic:t}),n=t.geometry,a=this._editGeometryOperations=Na.c.fromGeometry(n,e.state.viewingMode),o=this._bounds=new Qo(this,(()=>this._updateManipulators()),a.data);this._extentMove=new Co(this,i,a,o),this._extentScale=new es(this,i,a,o,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new Bo(this,a,o),this.addHandles([(0,s.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Yn.TRANSLATE_Z))),(0,s.YP)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,Yn.SCALE))))),(0,s.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Yn.ROTATE)))]),this._updateAllManipulatorAvailability();const l=na({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,r.kB)()});if(null!=l){const{visualElement:e}=l;e instanceof _i&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(l)}this.addHandles([i.on("changed",(()=>this._onGeometryChanged())),(0,s.YP)((()=>i.displaying),(()=>this._updateAllManipulatorAvailability())),(0,s.YP)((()=>i.isDraped),(()=>this._graphicDrapedChanged()),s.nn),(0,s.YP)((()=>{var t;return null===(t=e.pointsOfInterest)||void 0===t?void 0:t.centerOnSurfaceFrequent.location}),(()=>o.updateDisplayBounds())),e.trackGraphicState(i)]);this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((e,i)=>{this.addHandles(e.events.on("immediate-click",(e=>{i===Yn.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{view:e}=this,t=this._tooltip=new Wa.u({view:e}),i=()=>{t.info=this._getUpdatedTooltipInfo()};this.addHandles([this.on("graphic-translate-start",i),this.on("graphic-translate",i),this.on("graphic-translate-stop",(()=>{this._tooltip.clear()})),this.on("graphic-rotate-start",i),this.on("graphic-rotate",i),this.on("graphic-rotate-stop",i),this.on("graphic-scale-start",i),this.on("graphic-scale",i),this.on("graphic-scale-stop",i)]),this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",i),e.events.on("grab-changed",i),e.events.on("drag",(e=>{"cancel"===e.action?this._tooltip.clear():i()}))])}))}_getUpdatedTooltipInfo(){var e,t;return this.tooltipOptions.enabled?null!==(e=null!==(t=this._extentMove.getUpdatedTooltipInfo())&&void 0!==t?t:this._extentScale.getUpdatedTooltipInfo())&&void 0!==e?e:this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(as),this._bounds.updateDisplayBounds(),this._graphicState.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&(0,rn.jE)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),as)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=function(e,t){return Vn(e.basis1,e.basis2,e.origin,t)}(e,gt.MP.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof pn){const n=this._graphicState.displaying,a=this.enableZ&&Zn(this.graphic);switch(t){case Yn.ROTATE:e.available=n&&this.enableRotation;break;case Yn.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||a),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?bo:Mo;break;case Yn.TRANSLATE_Z:e.available=n&&a;break;default:e.available=n}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get moveUnit(){var e;return null!==(e=(0,er.j5)(this.view.spatialReference))&&void 0!==e?e:"meters"}get attachmentOrigin(){var e,t,i;const n=this.graphic.geometry,a=this._graphicState.isDraped?null:null===(e=this._outlineVisualElement)||void 0===e?void 0:e.attachmentOrigin;return this._attachmentOrigin=null!==(t=null!==a&&void 0!==a?a:jn(this.view,this.graphic))&&void 0!==t?t:null===n||void 0===n||null===(i=n.extent)||void 0===i?void 0:i.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const e=this._editGeometryOperations.undo();(0,To.mO)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}this.inputState=null}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();(0,To.mO)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();(0,To.nn)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get test(){return{moveZManipulator:this._extentMove.moveZManipulator,resizeManipulators:this._extentScale.resizeManipulators,rotateManipulator:this._extentRotate.rotateManipulator,tooltip:this._tooltip}}};(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],ns.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],ns.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)()],ns.prototype,"enableZ",void 0),(0,n._)([(0,l.Cb)()],ns.prototype,"enableScaling",void 0),(0,n._)([(0,l.Cb)()],ns.prototype,"enableRotation",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,type:Ua.Z})],ns.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.Cb)()],ns.prototype,"preserveAspectRatio",null),(0,n._)([(0,l.Cb)()],ns.prototype,"moveUnit",null),(0,n._)([(0,l.Cb)()],ns.prototype,"grabbing",void 0),(0,n._)([(0,l.Cb)()],ns.prototype,"inputState",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],ns.prototype,"type",void 0),ns=(0,n._)([(0,u.j)("esri.views.3d.interactive.editingTools.transformGraphic.ExtentTransformTool")],ns);const as="draped-elevation-changes"},8084:(e,t,i)=>{i.d(t,{j:()=>m});var n,a,r,o,s,l,c=i(30168),h=i(21002),d=i(96415),u=i(82999),p=i(49450),_=i(58406),g=i(98634),v=i(19253);function m(e,t){const i=e.fragment;i.include(h.S),e.include(d.GZ),i.uniforms.add(new _.p("globalAlpha",(e=>e.globalAlpha)),new p.J("glowColor",(e=>e.glowColor)),new _.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new _.p("glowFalloff",(e=>e.glowFalloff)),new p.J("innerColor",(e=>e.innerColor)),new _.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new v.A("depthMap",((e,t)=>{var i;return null===(i=t.linearDepth)||void 0===i?void 0:i.colorTexture})),new u.A("nearFar",((e,t)=>t.camera.nearFar)),new v.A("frameColor",((e,t)=>t.mainColor))),i.code.add((0,g.H)(n||(n=(0,c.Z)(["vec4 blendPremultiplied(vec4 source, vec4 dest) {\nfloat oneMinusSourceAlpha = 1.0 - source.a;\nreturn vec4(\nsource.rgb + dest.rgb * oneMinusSourceAlpha,\nsource.a + dest.a * oneMinusSourceAlpha\n);\n}"])))),i.code.add((0,g.H)(a||(a=(0,c.Z)(["vec4 premultipliedColor(vec3 rgb, float alpha) {\nreturn vec4(rgb * alpha, alpha);\n}"])))),i.code.add((0,g.H)(r||(r=(0,c.Z)(["vec4 laserlineProfile(float dist) {\nif (dist > glowWidth) {\nreturn vec4(0.0);\n}\nfloat innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\nfloat glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\nreturn blendPremultiplied(\npremultipliedColor(innerColor, innerAlpha),\npremultipliedColor(glowColor, glowAlpha)\n);\n}"])))),i.code.add((0,g.H)(o||(o=(0,c.Z)(["bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\nfloat depth = linearDepthFromTexture(depthMap, uv, nearFar);\nif (-depth == nearFar[0]) {\nreturn false;\n}\npos = reconstructPosition(gl_FragCoord.xy, depth);\nnormal = normalize(cross(dFdx(pos), dFdy(pos)));\nfloat ddepth = fwidth(depth);\ndepthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\nreturn true;\n}"])))),t.contrastControlEnabled?(i.uniforms.add(new _.p("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),i.code.add((0,g.H)(s||(s=(0,c.Z)(["float rgbToLuminance(vec3 color) {\nreturn dot(vec3(0.2126, 0.7152, 0.0722), color);\n}\nvec4 laserlineOutput(vec4 color) {\nfloat backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);\nfloat alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\nreturn color * alpha;\n}"]))))):i.code.add((0,g.H)(l||(l=(0,c.Z)(["vec4 laserlineOutput(vec4 color) {\nreturn color * globalAlpha;\n}"]))))}},43505:(e,t,i)=>{i.d(t,{A:()=>l});var n,a=i(30168),r=i(82552),o=i(58406),s=i(98634);function l(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,r.hY)(i,t),i.uniforms.add(new o.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new o.p("screenSizeScale",(e=>e.screenSizeScale))),i.code.add((0,s.H)(n||(n=(0,a.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));\nreturn viewDirectionDistance * perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}},4035:(e,t,i)=>{i.r(t),i.d(t,{getDrawMeshHelpMessage:()=>s});var n=i(68860),a=i(11186),r=i(71353),o=i(74509);function s(e,t){var i,r,s,u;const p=null===e||void 0===e?void 0:e.geometry;if(!e||"mesh"!==(null===p||void 0===p?void 0:p.type)||!t)return;const{renderCoordsHelper:_,elevationProvider:g}=t,{camera:v}=t.state,{extent:m}=p,{center:f,spatialReference:y}=m,b=(0,n.c9)(y),M=(0,n._R)(y),S=(0,n.c9)(_.spatialReference),w=m.width*b,x=m.height*M,O=(null!==(i=m.zmax)&&void 0!==i?i:0)*M,E=O-(null!==(r=m.zmin)&&void 0!==r?r:0)*M,T=Math.max(w,x,E)/S,{x:C,y:A}=f,P=null!==(s=f.z)&&void 0!==s?s:0;(0,a.s)(d,C,A,P),_.toRenderCoords(d,y,d);const D=T/v.computeScreenPixelSizeAt(d);if(D>v.width*c)return"meshTooClose";if(D<l)return"meshTooFar";const R=(0,o.RL)(e),{absoluteZ:I}=(0,o.tq)(C,A,O,y,t,R);return I<(null!==(u=g.getElevation(C,A,P,y,"ground"))&&void 0!==u?u:0)*M+E*h?"meshUnderground":"mesh"}const l=20,c=1,h=.1,d=(0,r.c)()},7068:(e,t,i)=>{i.d(t,{c:()=>l,p:()=>c});var n=i(27366),a=i(47898),r=i(49861),o=i(69912),s=i(4943);let l=class extends s.h{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,n._)([(0,r.Cb)()],l.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],l.prototype,"angle",void 0),l=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let c=class extends s.h{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=a.yP,this.ySize=a.yP}};(0,n._)([(0,r.Cb)()],c.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],c.prototype,"xScale",void 0),(0,n._)([(0,r.Cb)()],c.prototype,"yScale",void 0),(0,n._)([(0,r.Cb)()],c.prototype,"xSize",void 0),(0,n._)([(0,r.Cb)()],c.prototype,"ySize",void 0),c=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],c)},40524:(e,t,i)=>{i.d(t,{$E:()=>l,QW:()=>c,c1:()=>p,in:()=>h,j:()=>u,nk:()=>d});var n=i(27366),a=i(47898),r=i(49861),o=i(69912),s=i(4943);let l=class extends s.h{constructor(e){super(e),this.type="translate-graphic",this.distance=a.yP}clear(){this.distance=a.yP}};(0,n._)([(0,r.Cb)()],l.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],l.prototype,"distance",void 0),l=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let c=class extends s.h{constructor(e){super(e),this.type="translate-graphic-z",this.distance=a.yP}clear(){this.distance=a.yP}};(0,n._)([(0,r.Cb)()],c.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],c.prototype,"distance",void 0),c=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],c);let h=class extends s.h{constructor(e){super(e),this.type="translate-graphic-xy",this.distance=a.yP}};(0,n._)([(0,r.Cb)()],h.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],h.prototype,"distance",void 0),h=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],h);let d=class extends s.h{constructor(e){super(e),this.type="translate-vertex",this.distance=a.yP,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,r.Cb)()],d.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],d.prototype,"distance",void 0),(0,n._)([(0,r.Cb)()],d.prototype,"elevation",void 0),(0,n._)([(0,r.Cb)()],d.prototype,"area",void 0),(0,n._)([(0,r.Cb)()],d.prototype,"totalLength",void 0),d=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],d);let u=class extends s.h{constructor(e){super(e),this.type="translate-vertex-z",this.distance=a.yP,this.elevation=null}clear(){this.distance=a.yP,this.elevation=null}};(0,n._)([(0,r.Cb)()],u.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],u.prototype,"distance",void 0),(0,n._)([(0,r.Cb)()],u.prototype,"elevation",void 0),u=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],u);let p=class extends s.h{constructor(e){super(e),this.type="translate-vertex-xy",this.distance=a.yP,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,r.Cb)()],p.prototype,"type",void 0),(0,n._)([(0,r.Cb)()],p.prototype,"distance",void 0),(0,n._)([(0,r.Cb)()],p.prototype,"elevation",void 0),(0,n._)([(0,r.Cb)()],p.prototype,"area",void 0),(0,n._)([(0,r.Cb)()],p.prototype,"totalLength",void 0),p=(0,n._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],p)}}]);
//# sourceMappingURL=4776.de139e2d.chunk.js.map