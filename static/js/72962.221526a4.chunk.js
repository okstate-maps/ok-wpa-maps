"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[72962],{72962:(t,e,i)=>{i.d(e,{AddAssociationWorkflow:()=>C});var o,s=i(6326),a=i(50076),r=i(54901),n=i(50346),l=i(68134),d=i(46053),c=(i(81806),i(76460),i(47249),i(87990)),u=i(31933),w=i(71220),p=i(20072),y=i(1723),h=i(91967),A=i(95600);let g=o=class extends h.A{constructor(t){super(t),this.editorItem=null,this.feature=null,this.utilityNetwork=null,this.associationType=null,this.parent=null,this.associationInput=null,this.viewModel=null}static async create(t){const{feature:e,parent:i,viewModel:s,utilityNetwork:a,associationType:r,associationInput:n}=t,l=(0,A.x$)(s.editorItems,e.sourceLayer);return new o({editorItem:l,feature:e,parent:i,viewModel:s,utilityNetwork:a,associationType:r,associationInput:n})}};(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],g.prototype,"editorItem",void 0),(0,s.Cg)([(0,d.MZ)()],g.prototype,"feature",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],g.prototype,"utilityNetwork",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],g.prototype,"associationType",void 0),(0,s.Cg)([(0,d.MZ)()],g.prototype,"parent",void 0),(0,s.Cg)([(0,d.MZ)()],g.prototype,"associationInput",void 0),(0,s.Cg)([(0,d.MZ)()],g.prototype,"viewModel",void 0),g=o=(0,s.Cg)([(0,c.$)("esri.widgets.Editor.AddAssociationWorkflowData")],g);var v,M,f=i(88877),m=i(82141),k=i(26547);const _={exit:Symbol()};let C=(v=class extends f.A{constructor(t){super(t),this._utilityNetworkAssociationAddAssociationViewModel=new m.A,this._highlightHelper=null,this.sourceFeatureItem=null,this.type="add-association"}initialize(){const{data:t}=this,{view:e}=t.viewModel;e&&(this._highlightHelper=new p.A({view:e,highlightName:y.n4}),this.addHandles((0,r.hA)(()=>{var t;return null===(t=this._highlightHelper)||void 0===t?void 0:t.removeAll()})));const i=new AbortController;this.addHandles((0,r.rE)(i)),this._updatingHandles.addPromise(this._setup(i))}get editorItem(){return this.data.editorItem}get formViewModel(){return this._formViewModel}get utilityNetworkAssociationAddAssociationViewModel(){return this._utilityNetworkAssociationAddAssociationViewModel}get hasPendingEdits(){return!!this._utilityNetworkAssociationAddAssociationViewModel.selectedFeature}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get reliesOnOwnerAdminPrivileges(){return this.editorItem.capabilities.create.reliesOnOwnerAdminPrivileges}async enter(){this._addHandles()}exit(){this.removeHandles(_.exit)}async start(){return await super.start(),null}async _setup(t){const{data:e}=this,{feature:i}=e;try{const[o]=await(0,A.TT)([i],i.sourceLayer,e.viewModel.view.spatialReference,t.signal);if((0,n.G4)(t))return;const s=o.sourceLayer&&"getFeatureTitle"in o.sourceLayer?await o.sourceLayer.getFeatureTitle(o):(0,k.R)(o);if((0,n.G4)(t))return;this.sourceFeatureItem={feature:i,label:s},this._initializeUtilityNetworkAssociationAddAssociationViewModel()}catch(o){await this.cancel({force:!0,error:new a.A("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:o}})})}}_initializeUtilityNetworkAssociationAddAssociationViewModel(){const{viewModel:{view:t},utilityNetwork:e,associationType:i}=this.data,o=this._utilityNetworkAssociationAddAssociationViewModel;o.graphic=this.sourceFeatureItem.feature,o.map=null===t||void 0===t?void 0:t.map,o.utilityNetwork=e,o.layer=this.layer,o.associationType=i,o.highlightHelper=this._highlightHelper,e.networkSystemLayers.loadAssociationsTable()}_addHandles(){const t=this._utilityNetworkAssociationAddAssociationViewModel;this.addHandles([(0,l.wB)(()=>t.selectedLayer,t=>{t&&this.go("add-association-select-feature")}),(0,l.wB)(()=>t.selectedFeature,t=>{t&&this.go("add-association-create-association")})],_.exit)}static async create(t){const e=new M({data:await g.create(t),onCommit:this._onCommitFactory(t.applyEditsFeatureService)});return e._set("steps",this._createWorkflowSteps(e)),e}static _createWorkflowSteps(t){return[{id:"add-association-select-layer",async setUp(){const{utilityNetworkAssociationAddAssociationViewModel:e}=t.data.viewModel;e&&(e.selectedLayer=null,e.selectedFeature=null,e.association=null)},async tearDown(){}},{id:"add-association-select-feature",async setUp(){const{utilityNetworkAssociationAddAssociationViewModel:e}=t.data.viewModel;e&&(e.selectedFeature=null,e.association=null)},async tearDown(){}},{id:"add-association-create-association",async setUp(){},async tearDown(){}}]}},M=v,v._onCommitFactory=t=>async e=>{var i,o;const{feature:s,utilityNetwork:r,associationInput:n}=e,{utilityNetworkAssociationAddAssociationViewModel:l}=e.viewModel,{association:d}=l;await r.networkSystemLayers.loadAssociationsTable();const c=null===r||void 0===r?void 0:r.generateAddAssociations([d]);if(!c)throw new a.A("editor:failed-to-add-association","Could not create payload needed to add association");const p=s.sourceLayer,y=(0,u.Sv)(p)&&p.parent?p.parent:p,h=null===(i=(0,w.f)([y]).values().next().value)||void 0===i?void 0:i.featureService;if(!h)throw new a.A("editor:failed-to-delete-association","Could not retrieve feature service needed to delete association");await(null===h||void 0===h?void 0:h.load());const A=null!==(o=null===r||void 0===r?void 0:r.gdbVersion)&&void 0!==o?o:void 0;await t(h,[c],{gdbVersion:A}),await n.refresh()},v);(0,s.Cg)([(0,d.MZ)()],C.prototype,"_utilityNetworkAssociationAddAssociationViewModel",void 0),(0,s.Cg)([(0,d.MZ)()],C.prototype,"_formViewModel",void 0),(0,s.Cg)([(0,d.MZ)()],C.prototype,"editorItem",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"formViewModel",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"sourceFeatureItem",void 0),(0,s.Cg)([(0,d.MZ)()],C.prototype,"hasPendingEdits",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"layer",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"parent",null),(0,s.Cg)([(0,d.MZ)()],C.prototype,"reliesOnOwnerAdminPrivileges",null),C=M=(0,s.Cg)([(0,c.$)("esri.widgets.Editor.AddAssociationWorkflow")],C)}}]);
//# sourceMappingURL=72962.221526a4.chunk.js.map