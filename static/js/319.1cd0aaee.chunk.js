"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[319],{85981:(t,e,n)=>{n.d(e,{AR:()=>m,Gr:()=>_,JG:()=>a,Jk:()=>h,KU:()=>f,Ue:()=>d,al:()=>u,ct:()=>l,nF:()=>p,zk:()=>g});var o=n(16889),i=n(21530),s=n(11186),r=n(71353),c=n(51378);function d(t){return t?{origin:(0,r.g)(t.origin),vector:(0,r.g)(t.vector)}:{origin:(0,r.c)(),vector:(0,r.c)()}}function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d();return u(t.origin,t.vector,e)}function u(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d();return(0,s.c)(n.origin,t),(0,s.c)(n.vector,e),n}function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d();return(0,s.c)(n.origin,t),(0,s.f)(n.vector,e,t),n}function h(t,e){const n=(0,s.f)(c.WM.get(),e,t.origin),i=(0,s.j)(t.vector,n),r=(0,s.j)(t.vector,t.vector),d=(0,o.uZ)(i/r,0,1),a=(0,s.f)(c.WM.get(),(0,s.i)(c.WM.get(),t.vector,d),n);return(0,s.j)(a,a)}function p(t,e,n){return l(t,e,0,1,n)}function f(t,e,n){return(0,s.g)(n,t.origin,(0,s.i)(n,t.vector,e))}function l(t,e,n,i,r){const{vector:d,origin:a}=t,u=(0,s.f)(c.WM.get(),e,a),g=(0,s.j)(d,u)/(0,s.m)(d);return(0,s.i)(r,d,(0,o.uZ)(g,n,i)),(0,s.g)(r,r,t.origin)}function _(t,e){if(v(t,function(t,e){const n=M.get();return n.origin=t,n.vector=e,n}(e.origin,e.direction),!1,b)){const{tA:e,pB:n,distance2:o}=b;if(e>=0&&e<=1)return o;if(e<0)return(0,s.a)(t.origin,n);if(e>1)return(0,s.a)((0,s.g)(c.WM.get(),t.origin,t.vector),n)}return null}function m(t,e,n){return!!v(t,e,!0,b)&&((0,s.c)(n,b.pA),!0)}function v(t,e,n,i){const r=1e-6,d=t.origin,a=(0,s.g)(c.WM.get(),d,t.vector),u=e.origin,g=(0,s.g)(c.WM.get(),u,e.vector),h=c.WM.get(),p=c.WM.get();if(h[0]=d[0]-u[0],h[1]=d[1]-u[1],h[2]=d[2]-u[2],p[0]=g[0]-u[0],p[1]=g[1]-u[1],p[2]=g[2]-u[2],Math.abs(p[0])<r&&Math.abs(p[1])<r&&Math.abs(p[2])<r)return!1;const f=c.WM.get();if(f[0]=a[0]-d[0],f[1]=a[1]-d[1],f[2]=a[2]-d[2],Math.abs(f[0])<r&&Math.abs(f[1])<r&&Math.abs(f[2])<r)return!1;const l=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],_=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],m=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],b=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-_*_;if(Math.abs(b)<r)return!1;let M=(l*_-m*v)/b,C=(l+_*M)/v;n&&(M=(0,o.uZ)(M,0,1),C=(0,o.uZ)(C,0,1));const w=c.WM.get(),W=c.WM.get();return w[0]=d[0]+M*f[0],w[1]=d[1]+M*f[1],w[2]=d[2]+M*f[2],W[0]=u[0]+C*p[0],W[1]=u[1]+C*p[1],W[2]=u[2]+C*p[2],i.tA=M,i.tB=C,i.pA=w,i.pB=W,i.distance2=(0,s.a)(w,W),!0}const b={tA:0,tB:0,pA:(0,r.c)(),pB:(0,r.c)(),distance2:0},M=new i.x((()=>d()))},50319:(t,e,n)=>{n.r(e),n.d(e,{default:()=>f});var o=n(27366),i=n(66978),s=(n(32718),n(25243),n(63780),n(93169),n(10064),n(69912)),r=n(11186),c=n(71353),d=n(85981),a=n(23470),u=n(78329),g=n(83715);function h(t,e,n){const o=(0,a.c)(),i=(0,a.g)(o);return(0,r.q)(i,i,t,.5),(0,r.q)(i,i,e,.5),o[3]=(0,r.o)(i,t),(0,r.g)(i,i,n),o}let p=class{constructor(){this._idToComponent=new Map,this._components=new u.Z((t=>t.bounds)),this._edges=new u.Z((t=>t.bounds)),this._tmpLineSegment=(0,d.Ue)(),this._tmpP1=(0,c.c)(),this._tmpP2=(0,c.c)(),this._tmpP3=(0,c.c)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,i.k_)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>(this._addCandidates(t,e,n),n.length<1e3)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if(null==t.info){const{id:e,uid:o}=t;n.push({id:e,uid:o})}return!0}),t.bounds),!n.length)return;const o={components:n},i=await this.remoteClient.invoke("fetchAllEdgeLocations",o,null!==e&&void 0!==e?e:{});for(const s of i.components)this._setFetchEdgeLocations(s)}async add(t){const e=new l(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>(n.component===e&&t.push(n),!0)),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(null==e||t.uid!==e.uid)return;const n=g.n_.createView(t.locations),o=new Array(n.count),i=(0,c.c)(),s=(0,c.c)();for(let c=0;c<n.count;c++){n.position0.getVec(c,i),n.position1.getVec(c,s);const r=h(i,s,t.origin),d=new _(e,c,r);o[c]=d}this._edges.add(o);const{objectIds:r,origin:d}=t;e.info={locations:n,objectIds:r,origin:d}}_addCandidates(t,e,n){const{info:o}=e.component,{origin:i,objectIds:s}=o,c=o.locations,d=c.position0.getVec(e.index,this._tmpP1),a=c.position1.getVec(e.index,this._tmpP2);(0,r.g)(d,d,i),(0,r.g)(a,a,i);const u=s[c.componentIndex.get(e.index)];this._addEdgeCandidate(t,u,d,a,n),this._addVertexCandidate(t,u,d,n),this._addVertexCandidate(t,u,a,n)}_addEdgeCandidate(t,e,n,o,i){if(!t.returnEdge)return;const s=(0,a.g)(t.bounds),u=(0,d.zk)(n,o,this._tmpLineSegment),g=(0,d.nF)(u,s,this._tmpP3);(0,a.n)(t.bounds,g)&&i.push({type:"edge",objectId:e,target:(0,c.g)(g),distance:(0,r.o)(s,g),start:(0,c.g)(n),end:(0,c.g)(o)})}_addVertexCandidate(t,e,n,o){if(!t.returnVertex)return;const i=(0,a.g)(t.bounds);(0,a.n)(t.bounds,n)&&o.push({type:"vertex",objectId:e,target:(0,c.g)(n),distance:(0,r.o)(i,n)})}};p=(0,o._)([(0,s.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],p);const f=p;class l{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++l.uid}}l.uid=0;class _{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=319.1cd0aaee.chunk.js.map