(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[10,107,167],{1120:function(e,t,n){"use strict";n.r(t),n.d(t,"DrawGraphicTool3D",(function(){return mn})),n.d(t,"GraphicMoveTool",(function(){return $i})),n.d(t,"GraphicReshapeTool",(function(){return br})),n.d(t,"GraphicTransformTool",(function(){return Rr})),n.d(t,"ExtentTransformTool",(function(){return Aa}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(0),l=n(124),u=n(7),h=n(25),d=n(1),p=n(12),f=n(15),v=n(11),b=n(8),g=n(140),m=n(323),O=n(40),y=n(58),j=n(79),_=n(41),x=n(38),w=n(68),k=n(406),S=n(698),M=n(815),E=n(762),P=n(662),T=n(578),D=function(){function e(t){var n=this;Object(r.a)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(function(e){n._resourcesCreated&&(e?n._createResources():n._destroyResources())}))}return Object(a.a)(e,[{key:"applyProps",value:function(e){var t=!1;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t}},{key:"destroy",value:function(){this.attached=!1}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}(),R=n(65),C=n(60),A=n(557),V=n(596),z=n(677),I=n(13),G=n(718),L=n(646),F=n(100),U=n(546),H=n(608),N=n(617),q=n(623),B=n(609),W=n(921),Z=n(543),X=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build(i);return new B.a(e.rctx,r,n.attributeLocations)}},{key:"bind",value:function(e,t,n){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*n.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*n.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",n.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/n.fullWidth,2/n.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",n.projectionMatrix),Object(F.t)(Q,n.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",Q),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}},{key:"initializePipeline",value:function(){return Object(Z.f)({blending:Object(Z.h)(1,771),colorWrite:Z.c})}},{key:"bindPipelineState",value:function(e){e.setPipelineState(this.pipeline)}}]),n}(N.a);X.shader=new H.a(W.a,(function(){return n.e(205).then(n.bind(null,1103))})),X.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);var Y=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).contrastControlEnabled=!1,e}return n}(q.a);Object(c.a)([Object(q.b)()],Y.prototype,"contrastControlEnabled",void 0);var Q=Object(U.d)(),J=n(549),K=n(550),$=function(){function e(t){Object(r.a)(this,e),this._renderCoordsHelper=t,this._buffers=null,this._origin=Object(j.e)(),this._dirty=!1,this._count=0,this._vao=null}return Object(a.a)(e,[{key:"vertices",set:function(e){var t,n=new Float64Array(3*e.length),i=0,r=Object(I.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[i++]=a[0],n[i++]=a[1],n[i++]=a[2]}}catch(o){r.e(o)}finally{r.f()}this.buffers=[n]}},{key:"buffers",set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],n=3*Math.floor(t.length/3/2);Object(y.w)(this._origin,t[n+0],t[n+1],t[n+2])}else Object(y.w)(this._origin,0,0,0);this._dirty=!0}},{key:"origin",get:function(){return this._origin}},{key:"draw",value:function(e){var t=this.ensureVAO(e);Object(u.k)(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}},{key:"dispose",value:function(){Object(u.k)(this._vao)&&this._vao.dispose()}},{key:"ensureVAO",value:function(e){return Object(u.j)(this._buffers)?null:(Object(u.j)(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}},{key:"createVAO",value:function(e,t){var n=this.createDataBuffer(t);return this._dirty=!1,new K.a(e,X.attributeLocations,{data:Object(G.a)(ne)},{data:J.a.createVertex(e,35044,n)})}},{key:"ensureVertexData",value:function(e,t){if(this._dirty){var n=this.createDataBuffer(t);e.vertexBuffers.data.setData(n),this._dirty=!1}}},{key:"numberOfRenderVertices",value:function(e){return 2*(e.length/3-1)*3}},{key:"createDataBuffer",value:function(e){var t=this,n=e.reduce((function(e,n){return e+t.numberOfRenderVertices(n)}),0);this._count=n;var i,r=ne.createBuffer(n),a=this._origin,o=0,s=0,c=Object(I.a)(e);try{for(c.s();!(i=c.n()).done;){for(var l=i.value,u=0;u<l.length;u+=3){var h=Object(y.w)(te,l[u+0],l[u+1],l[u+2]);0===u?s=this._renderCoordsHelper.getAltitude(h):this._renderCoordsHelper.setAltitude(h,s);var d=this._renderCoordsHelper.worldUpAtPosition(h,ee),p=o+2*u,f=Object(y.j)(te,h,a);if(u<l.length-3){r.up.setVec(p,d),r.up.setVec(p+3,d),r.up.setVec(p+5,d);for(var v=0;v<6;v++)r.start.setVec(p+v,f);r.extrude.setValues(p+0,0,-1),r.extrude.setValues(p+1,1,-1),r.extrude.setValues(p+2,1,1),r.extrude.setValues(p+3,0,-1),r.extrude.setValues(p+4,1,1),r.extrude.setValues(p+5,0,1)}if(u>0){r.up.setVec(p-2,d),r.up.setVec(p-4,d),r.up.setVec(p-5,d);for(var b=-6;b<0;b++)r.end.setVec(p+b,f)}}o+=this.numberOfRenderVertices(l)}}catch(g){c.e(g)}finally{c.f()}return r.buffer}}]),e}(),ee=Object(j.e)(),te=Object(j.e)(),ne=Object(L.a)().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude"),ie=n(891),re=n(566),ae=n(619),oe=n(618),se=n(817),ce=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build(i);return new B.a(e.rctx,r,oe.a)}},{key:"bind",value:function(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);var n=null!=e.angleCutoff?e.angleCutoff:se.c;this.program.setUniform2f("angleCutoff",Math.cos(n),Math.cos(Math.max(0,n-Object(R.f)(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}},{key:"initializePipeline",value:function(){return Object(Z.f)({blending:Object(Z.h)(1,771),colorWrite:Z.c})}}]),n}(N.a);ce.shader=new H.a(se.a,(function(){return n.e(206).then(n.bind(null,1104))}));var le=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).heightManifoldEnabled=!1,e.pointDistanceEnabled=!1,e.lineVerticalPlaneEnabled=!1,e.intersectsLineEnabled=!1,e.contrastControlEnabled=!1,e}return n}(q.a);Object(c.a)([Object(q.b)()],le.prototype,"heightManifoldEnabled",void 0),Object(c.a)([Object(q.b)()],le.prototype,"pointDistanceEnabled",void 0),Object(c.a)([Object(q.b)()],le.prototype,"lineVerticalPlaneEnabled",void 0),Object(c.a)([Object(q.b)()],le.prototype,"intersectsLineEnabled",void 0),Object(c.a)([Object(q.b)()],le.prototype,"contrastControlEnabled",void 0);var ue=Object(j.e)(),he=Object(A.e)(),de={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(R.f)(6),globalAlphaContrastBoost:2};function pe(e,t,n,i){var r=ue,a=he;Object(y.q)(r,t,i),Object(y.k)(a,n),a[3]=0,Object(k.m)(a,a,i),Object(V.g)(r,a,e)}var fe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{contrastControlEnabled:!1};Object(r.a)(this,e),this._renderCoordsHelper=t,this._config=i,this._technique=null,this._projInfo=Object(A.e)(),this._zScale=Object(C.a)(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(j.e)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(j.e)(),this._pointDistanceTarget=Object(j.e)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=Object(P.d)(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=Object(P.d)(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(j.e)(),this._tempDir=Object(j.e)(),this._tempUp=Object(j.e)(),this._tempVec3A=Object(j.e)(),this._tempVec3B=Object(j.e)(),this._tempVec4=Object(A.e)(),this._tempPlane=Object(V.d)(),this._tempSphere=Object(z.b)(),this._params=Object(ae.c)(n,de)}return Object(a.a)(e,[{key:"renderSlots",get:function(){return[this._config.contrastControlEnabled?18:17]}},{key:"needsLinearDepth",get:function(){return!0}},{key:"heightManifoldEnabled",get:function(){return this._heightManifoldEnabled},set:function(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldTarget},set:function(e){Object(y.k)(this._heightManifoldTarget,e),this._requestRender()}},{key:"pointDistanceEnabled",get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}},{key:"pointDistanceTarget",get:function(){return this._pointDistanceTarget},set:function(e){Object(y.k)(this._pointDistanceTarget,e),this._requestRender()}},{key:"pointDistanceOrigin",get:function(){return this._pointDistanceOrigin},set:function(e){Object(y.k)(this._pointDistanceOrigin,e),this._requestRender()}},{key:"lineVerticalPlaneEnabled",get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){Object(P.c)(e,this._lineVerticalPlaneSegment),this._requestRender()}},{key:"intersectsLineEnabled",get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}},{key:"intersectsLineSegment",get:function(){return this._intersectsLineSegment},set:function(e){Object(P.c)(e,this._intersectsLineSegment),this._requestRender()}},{key:"intersectsLineRadius",get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}},{key:"pathVerticalPlaneEnabled",get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(u.k)(this._pathVerticalPlaneData)&&this._requestRender())}},{key:"pathVerticalPlaneVertices",set:function(e){Object(u.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new $(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"pathVerticalPlaneBuffers",set:function(e){Object(u.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new $(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"setParameterValues",value:function(e){Object(ae.h)(this._params,e)&&this._requestRender()}},{key:"initializeRenderContext",value:function(e){this._context=e;var t=e.renderContext.rctx;this._quadVAO=Object(ie.b)(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new le;var n=new Y;n.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(X,n)}},{key:"uninitializeRenderContext",value:function(){this._quadVAO=Object(u.f)(this._quadVAO),this._technique=Object(u.q)(this._technique),this._pathVerticalPlaneData=Object(u.f)(this._pathVerticalPlaneData),this._pathTechnique=Object(u.q)(this._pathTechnique)}},{key:"render",value:function(e){var t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,n=this.pathVerticalPlaneEnabled;if(!t&&!n)return!0;var i=e.camera;return Object(re.f)(i.projectionMatrix,i.fullWidth,i.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),n&&this.renderPath(e),!0}},{key:"renderUnified",value:function(e){var t=e.rctx,n=this._selectTechnique(),i=n.program;t.useProgram(i),n.bindPipelineState(t),this._bindGlobalUniforms(e,i),this.bindHeightManifoldUniforms(e,i),this.bindPointDistanceUniforms(e,i),this.bindLineVerticalPlaneUniforms(e,i),this.bindIntersectsLineUniforms(e,i),n.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}},{key:"renderPath",value:function(e){if(!Object(u.j)(this._pathVerticalPlaneData)&&!Object(u.j)(this._pathTechnique)){var t=e.rctx,n=this._pathTechnique,i=n.program;t.useProgram(i),n.bindPipelineState(t),this._bindGlobalUniforms(e,i),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}}},{key:"bindHeightManifoldUniforms",value:function(e,t){if(this.heightManifoldEnabled){var n=this._tempVec3A,i=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,n),pe(i,this._heightManifoldTarget,n,e.camera.viewMatrix),t.setUniform4fv("heightPlane",i)}}},{key:"bindPointDistanceUniforms",value:function(e,t){if(this._pointDistanceEnabled){var n=e.camera,i=this._tempSphere;Object(y.k)(i,this._pointDistanceOrigin),Object(y.q)(i,i,n.viewMatrix),i[3]=Object(y.m)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",i[0],i[1],i[2],i[3])}}},{key:"bindLineVerticalPlaneUniforms",value:function(e,t){if(this._lineVerticalPlaneEnabled){var n=this._renderCoordsHelper,i=e.camera,r=this._tempPlane,a=this._tempVec3A,o=this._tempUp,s=this._tempDir,c=this._tempNormal;Object(P.h)(this._lineVerticalPlaneSegment,.5,a),n.worldUpAtPosition(a,o),Object(y.r)(s,this._lineVerticalPlaneSegment.vector),Object(y.g)(c,o,s),Object(y.r)(c,c),pe(r,this._lineVerticalPlaneSegment.origin,c,i.viewMatrix),t.setUniform4fv("lineVerticalPlane",r);var l=this._tempVec3A;Object(y.k)(l,this._lineVerticalPlaneSegment.origin),n.setAltitude(l,0),Object(y.q)(l,l,i.viewMatrix),t.setUniform3fv("lineVerticalStart",l);var u=this._tempVec3B;Object(y.f)(u,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),n.setAltitude(u,0),Object(y.q)(u,u,i.viewMatrix),t.setUniform3fv("lineVerticalEnd",u)}}},{key:"bindIntersectsLineUniforms",value:function(e,t){if(this._intersectsLineEnabled){var n=be,i=ge;if(this._intersectsLineInfinite){var r=e.camera;if(Object(M.c)(Object(T.g)(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),ve),ve.c0=-Number.MAX_VALUE,!Object(E.d)(r.frustum,ve))return;Object(M.e)(ve,n),Object(M.d)(ve,i)}else Object(y.k)(n,this._intersectsLineSegment.origin),Object(y.f)(i,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var a=this._tempVec3A;Object(y.q)(a,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",a);var o=this._tempVec4;Object(y.k)(o,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(k.m)(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Object(y.q)(i,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",i),Object(y.r)(o,o),t.setUniform3f("intersectsLineDirection",o[0],o[1],o[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}}},{key:"_bindGlobalUniforms",value:function(e,t){var n=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",n.near,n.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}},{key:"_requestRender",value:function(){this._context&&this._context.requestRender()}},{key:"_selectTechnique",value:function(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(ce,this._techniqueConfig,this._technique),this._technique}}]),e}(),ve=Object(M.a)(),be=Object(j.e)(),ge=Object(j.e)(),me=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e.view))._angleCutoff=se.c,i._style={},i._heightManifoldTarget=Object(j.e)(),i._heightManifoldEnabled=!1,i._intersectsLine=Object(P.d)(),i._intersectsLineEnabled=!1,i._intersectsLineInfinite=!1,i._lineVerticalPlaneSegment=null,i._pathVerticalPlaneBuffers=null,i._pointDistanceLine=null,i.applyProps(e),i}return Object(a.a)(n,[{key:"testData",get:function(){return this.renderer}},{key:"createResources",value:function(){this.ensureRenderer()}},{key:"destroyResources",value:function(){this.disposeRenderer()}},{key:"updateVisibility",value:function(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){Object(u.k)(e)?(Object(y.k)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if(Object(u.j)(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,Oe);this.intersectsLine=Object(P.g)(e,t),this.intersectsLineInfinite=!0}}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){Object(u.k)(e)?(Object(P.c)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=Object(u.k)(e)?Object(P.c)(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=Object(u.k)(e)?{origin:Object(j.c)(e.origin),target:Object(j.c)(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}},{key:"syncRenderer",value:function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(u.k)(this._pointDistanceLine)||Object(u.k)(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}},{key:"ensureRenderer",value:function(){Object(u.k)(this.renderer)||(this.renderer=new fe(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}},{key:"syncStyle",value:function(){Object(u.j)(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}},{key:"syncAngleCutoff",value:function(){Object(u.j)(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}},{key:"syncHeightManifold",value:function(){Object(u.j)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}},{key:"syncIntersectsLine",value:function(){Object(u.j)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}},{key:"syncIntersectsLineInfinite",value:function(){Object(u.j)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}},{key:"syncPathVerticalPlane",value:function(){Object(u.j)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(u.k)(this._pathVerticalPlaneBuffers)&&this.visible,Object(u.k)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}},{key:"syncLineVerticalPlane",value:function(){Object(u.j)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(u.k)(this._lineVerticalPlaneSegment)&&this.visible,Object(u.k)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}},{key:"syncPointDistance",value:function(){Object(u.j)(this.renderer)||(this.renderer.pointDistanceEnabled=Object(u.k)(this._pointDistanceLine)&&this.visible,Object(u.k)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}},{key:"disposeRenderer",value:function(){Object(u.k)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}]),n}(D),Oe=Object(j.e)(),ye=n(664),je=n(771),_e=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e.view))._resources=null,i._transform=Object(U.d)(),i}return Object(a.a)(n,[{key:"object",get:function(){return Object(u.k)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){Object(F.f)(this._transform,e),Object(u.k)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!Object(u.j)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new je.a({isPickable:!1,updatePolicy:1});e.add(t);var n=new ye.a({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),e.addMany(n.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(n),t.add(n),this.visible||n.setVisible(!1),this._resources={layer:t,object:n}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!Object(u.j)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){Object(u.j)(this._resources)||this._resources.object.setVisible(e)}}]),n}(D),xe=n(645),we=n(707),ke=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._ray=Object(T.c)(),i._externalResources=null,i._handles=new w.a,i._isWorldDown=!1,i._start=Object(j.e)(),i._end=Object(j.g)(1,0,0),i._width=1,i._color=Object(S.c)(1,0,1,1),i._polygonOffset=!1,i._writeDepthEnabled=!0,i._innerWidth=0,i._innerColor=Object(S.c)(1,1,1,1),i._stippleIntegerRepeats=!0,i._stipplePattern=null,i._stippleOffColor=null,i._falloff=0,i._extensionType=0,i._laserlineStyle=null,i._laserlineEnabled=!1,i._renderOccluded=4,i._fadedExtensions=De,i.applyProps(e),i}return Object(a.a)(n,[{key:"createExternalResources",value:function(){var e=this,t=new we.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()})));var n=new me({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:n}}},{key:"destroyExternalResources",value:function(){Object(u.k)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){Object(u.k)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[Object(j.e)(),Object(j.e)()],n=3===this.extensionType;n&&t.push(Object(j.e)(),Object(j.e)());var i=n?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=xe.a.createPolylineGeometry(t,null,i);e.addGeometry(r,Object(u.s)(this._externalResources).material),this.updateVertices(r)}},{key:"updateVisibility",value:function(e){Object(_.a)(Object(x.a)(n.prototype),"updateVisibility",this).call(this,e),Object(u.k)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,Object(y.k)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(y.j)(this._end,e,this._end),Object(T.e)(this._start,this._end,this._ray),this.updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,Object(y.o)(this._start,e)||(Object(y.k)(this._start,e),Object(T.e)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,Object(y.o)(this._end,e)||(Object(y.k)(this._end,e),Object(T.e)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(k.g)(e,this._color)||(Object(k.c)(this._color,e),this.updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(k.g)(e,this._innerColor)||(Object(k.c)(this._innerColor,e),this.updateMaterial())}},{key:"stippleIntegerRepeats",get:function(){return this._stippleIntegerRepeats},set:function(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(u.k)(e)!==Object(u.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){(Object(u.j)(e)||Object(u.j)(this._stippleOffColor)||!Object(k.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(u.k)(e)?Object(S.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&Object(u.k)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,Object(u.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(u.k)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(u.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=Object(u.t)(e,De),this.recreateGeometry()}},{key:"updateMaterial",value:function(){Object(u.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"updateGeometry",value:function(){Object(u.k)(this.object)&&this.updateVertices(this.object.geometries[0])}},{key:"updateVertices",value:function(e){var t=3===this._extensionType?this.updateLineSegmentFinite(Pe):this.updateLineSegmentInfinite(this._extensionType,Pe);this.updateVertexAttributes(e,t),Object(u.k)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"updateLineSegmentFinite",value:function(e){return Object(P.f)(this._start,this._end,e)}},{key:"updateLineSegmentInfinite",value:function(e,t){var n=this.view.state.camera;switch(Object(M.c)(this._ray,Se),e){case 0:Se.c0=-Number.MAX_VALUE;break;case 1:case 2:var i=this._ray.origin,r=Object(u.t)(this.view.elevationProvider.getElevation(i[0],i[1],i[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(i);this._isWorldDown&&a<r&&Object(y.s)(Se.ray.direction,Se.ray.direction),2===this._extensionType&&null!=r&&(Se.c1=Math.abs(a-r))}if(!Object(E.d)(n.frustum,Se))return Object(P.f)(this._start,this._end,t);var o=Object(M.e)(Se,Me),s=Object(M.d)(Se,Ee);return Object(P.f)(o,s,t)}},{key:"updateVertexAttributes",value:function(e,t){var n=e.getMutableAttribute("position").data;if(3===this.extensionType){var i=Object(P.h)(t,-this.fadedExtensions.start,Me);n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=Object(P.h)(t,0,Me);n[3]=r[0],n[4]=r[1],n[5]=r[2];var a=Object(P.h)(t,1,Me);n[6]=a[0],n[7]=a[1],n[8]=a[2];var o=Object(P.h)(t,1+this.fadedExtensions.end,Me);n[9]=o[0],n[10]=o[1],n[11]=o[2]}else{var s=Object(P.h)(t,0,Me);n[0]=s[0],n[1]=s[1],n[2]=s[2];var c=Object(P.h)(t,1,Me);n[3]=c[0],n[4]=c[1],n[5]=c[2]}Object(u.k)(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}]),n}(_e),Se=Object(M.a)(),Me=Object(j.e)(),Ee=Object(j.e)(),Pe=Object(P.d)(),Te=1/3,De={start:Te,end:Te},Re=n(35),Ce=n(30),Ae=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._handles=new w.a,i._location=Object(j.e)(),i._direction=Object(j.g)(1,0,0),i._width=1,i._offset=1,i._length=18,i._color=Object(S.c)(1,0,1,1),i._renderOccluded=4,i.applyProps(e),i}return Object(a.a)(n,[{key:"location",get:function(){return this._location},set:function(e){Object(y.o)(this._location,e)||(Object(y.k)(this._location,e),this.updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){Object(y.o)(this._direction,e)||(Object(y.k)(this._direction,e),this.updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){Object(y.r)(this._direction,Object(y.j)(this._direction,t,e)),this.updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this.updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){Object(k.g)(e,this._color)||(Object(k.c)(this._color,e),this.updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new we.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=xe.a.createPolylineGeometry([Object(j.e)(),Object(j.e)()]),n=xe.a.createPolylineGeometry([Object(j.e)(),Object(j.e)()]),i=Object(u.s)(this._externalResources).material;e.addGeometry(t,i,U.a),e.addGeometry(n,i,U.a),this.updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){Object(u.k)(this._externalResources)&&e(this._externalResources.material)}},{key:"updateMaterial",value:function(){Object(u.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"updateGeometry",value:function(){var e=this.object;Object(u.j)(e)||this.updateVertices(e)}},{key:"updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,ze),Object(y.f)(Ve,this.location,this.direction),t.projectToScreen(Ve,Ie),Object(Ce.f)(Ie,Object(Ce.a)(Ie,Ie,ze)),this.updateVertexAttributes(t,e,0,ze,Ie,1),this.updateVertexAttributes(t,e,1,ze,Ie,-1)}},{key:"updateVertexAttributes",value:function(e,t,n,i,r,a){var o=t.geometryRecords[n].geometry.getMutableAttribute("position").data,s=Object(Ce.b)(Ge,Object(Ce.s)(Ge,r[1]*a,r[0]*-a),this.offset+this.width/2),c=Object(Ce.i)(Le,Object(Ce.i)(Le,Object(Ce.i)(Le,i,Object(Ce.b)(Le,r,this.length/2)),s),s),l=Object(Ce.i)(Fe,c,Object(Ce.b)(Fe,r,-this.length));e.unprojectFromScreen(c,Ve),o[0]=Ve[0],o[1]=Ve[1],o[2]=Ve[2],e.unprojectFromScreen(l,Ve),o[3]=Ve[0],o[4]=Ve[1],o[5]=Ve[2],t.geometryVertexAttrsUpdated(n)}}]),n}(_e),Ve=Object(j.e)(),ze=Object(Re.f)(),Ie=Object(Re.f)(),Ge=Object(Re.f)(),Le=Object(Re.f)(),Fe=Object(Re.f)(),Ue=n(383),He=n(304),Ne=n(569),qe=function(){function e(t){Object(r.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(a.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"object",get:function(){return Object(u.k)(this._resources)?this._resources.object:null}},{key:"resources",get:function(){return Object(u.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){if(this.resourceFactory.recreateGeometry){var e=this.resourceFactory.view._stage;if(!Object(u.j)(this._resources)&&e){var t=this._resources.object;this._resources.external.forEach((function(t){2===t.type&&e.remove(t)})),t.removeAllGeometries();var n=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(n)}}else this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?this._resources||this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var n=new je.a({isPickable:!1,updatePolicy:1});t.add(n);var i=new ye.a({castShadow:!1}),r=this.resourceFactory.createResources(i,n);r.forEach((function(e){return t.add(e)})),t.add(i),n.add(i),this._syncVisible();var a=this.resourceFactory.cameraChanged?Object(h.a)(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:n,object:i,external:r,cameraHandle:a}}}},{key:"_destroyResources",value:function(){if(!Object(u.j)(this._resources)){var e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((function(t){null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}}},{key:"_syncVisible",value:function(){Object(u.j)(this._resources)||this._resources.object.setVisible(this._visible)}}]),e}(),Be=n(625),We=n(655),Ze=n(923),Xe=n(752),Ye=n(888),Qe=function(){function e(t){var n=this;Object(r.a)(this,e),this.view=null,this._geometry=null,this._size=3,this._color=Object(A.g)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(A.g)(1,1,1,1),this._elevationInfo=null,this.resources=new qe({view:t.view,createResources:function(e){return n.createResources(e)},recreateGeometry:function(e,t){return e.geometry=n.recreateGeometry(t,e.material),Object(u.k)(e.geometry)?[e.geometry]:[]}});var i=!0;for(var a in t)a in this?"attached"===a?i=t[a]:this[a]=t[a]:console.error("Cannot set unknown property",a);this.attached=i}return Object(a.a)(e,[{key:"destroy",value:function(){this.resources.destroy()}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e}},{key:"attached",get:function(){return this.resources.attached},set:function(e){this.resources.attached=e}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(u.k)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){Object(k.g)(e,this._color)||(Object(k.c)(this._color,e),this.updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,Object(u.k)(this.resources)&&this.resources.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(k.g)(e,this._outlineColor)||(Object(k.c)(this._outlineColor,e),this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}},{key:"updateMaterial",value:function(){var e=this.resources.resources;Object(u.j)(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}},{key:"updateSizeAttribute",value:function(){var e=this.resources.resources,t=this.resources.object;if(!Object(u.j)(e)&&!Object(u.j)(t)){var n=e.geometry;if(!Object(u.j)(n)){var i=n.getMutableAttribute("size").data,r=this.geometrySize;i[0]=r,i[1]=r,t.geometryVertexAttrsUpdated(0)}}}},{key:"materialParameters",value:function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Ke,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}},{key:"geometrySize",get:function(){return this._size/Je}},{key:"recreateGeometry",value:function(e,t){var n=this.createRenderGeometry();return Object(u.k)(n)&&e.addGeometry(n,t),n}},{key:"createResources",value:function(e){var t=this.createTexture(),n=new Ye.a(this.materialParameters(t.id)),i=this.recreateGeometry(e,n);return{material:n,texture:t,geometry:i,forEach:function(e){e(t),e(n),Object(u.k)(this.geometry)&&e(this.geometry)}}}},{key:"preferredTextureSize",get:function(){return Object(R.d)(Object(R.l)(2*this.geometrySize),16,128)}},{key:"createTexture",value:function(){var e=this.preferredTextureSize;return new Xe.a(Object(Ze.f)(this._primitive,e,e*Je),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}},{key:"calculateMapBounds",value:function(e){if(Object(u.j)(this.resources.resources)||Object(u.j)(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.vertexAttributes.get("position");return Object(Ue.r)(t.data,this.view.renderCoordsHelper.spatialReference,$e,this.view.spatialReference),Object(He.k)(e,$e),!0}},{key:"createRenderGeometry",value:function(){var e=this.geometry;if(Object(u.j)(e))return null;var t=this.view,n=t.renderCoordsHelper,i=t.elevationProvider,r=Object(Be.e)(e,i,We.a.fromElevationInfo(this.elevationInfo),n),a=Object(y.w)(Ne.d.get(),e.x,e.y,r),o=Ne.d.get();Object(Ue.r)(a,e.spatialReference,o,n.spatialReference);var s=this.geometrySize;return xe.a.createPointGeometry(null,o,null,[s,s],[0,0,0,1])}}]),e}(),Je=.5,Ke=[Je/2,Je/2,1-Je/2,1-Je/2],$e=Object(j.e)(),et=n(26),tt=n(661),nt=n(754),it=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._handles=new w.a,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=Object(j.e)(),i._up=Object(j.e)(),i._right=Object(j.e)(),i._renderOccluded=4,i._color=Object(S.c)(1,0,0,1),i._outlineColor=Object(S.c)(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=16,i.applyProps(e),i}return Object(a.a)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(k.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(k.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,n=e.center,i=e.next;this._maxSize=Math.min(Object(y.m)(n,t),Object(y.m)(n,i))/3,Object(y.r)(this._up,Object(y.j)(this._up,t,n)),Object(y.r)(this._right,Object(y.j)(this._right,i,n)),Object(y.k)(this._position,n),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new nt.a(this.quadMaterialParameters),this._outlineMaterial=new we.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=Object(y.f)(Ne.d.get(),this._up,this._right),n=xe.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(n,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);Object(F.j)(rt),Object(F.t)(rt,rt,this._position),Object(F.g)(rt,rt,[i,i,i]),Object(u.k)(e)&&(e.transformation=rt)}},{key:"_quadGeometryData",value:function(e,t){var n=Object(y.f)(Ne.d.get(),e,t);return new tt.a([["position",{size:3,data:[0,0,0].concat(Object(et.a)(t),Object(et.a)(e),Object(et.a)(n)),exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}]),n}(_e),rt=Object(U.d)(),at=n(143),ot=n(57),st=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"visualizeIntersectionPoint",value:function(e,t){var n=t.coordinateHelper,i=t.elevationInfo,r=t.view;return Object(l.a)(new Qe({view:r,primitive:"circle",geometry:n.vectorToPoint(e.intersectionPoint),elevationInfo:i,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:O.a.toUnitRGBA(at.a.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var n=t.coordinateHelper,i=t.elevationInfo,r=t.view;return Object(l.a)(new Qe({view:r,primitive:"circle",geometry:n.vectorToPoint(e.point),elevationInfo:i,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:O.a.toUnitRGBA(at.a.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var n=t.coordinateHelper,i=t.elevationInfo,r=t.view;return Object(l.a)(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,n,i,r,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var n=t.coordinateHelper,i=t.elevationInfo,r=t.view,a=Object(ot.a)(e.lineStart,n,i,t.view),o=Object(ot.a)(e.lineEnd,n,i,t.view),s=Object(y.i)(o,a,o,.5),c=new Ae({view:r,attached:!1,offset:at.a.parallelLineHintOffset,length:at.a.parallelLineHintLength,width:at.a.parallelLineHintWidth,color:O.a.toUnitRGBA(at.a.orange),location:s,renderOccluded:16});return c.setDirectionFromPoints(a,s),c.attached=!0,Object(l.a)(c)}},{key:"visualizeRightAngleQuad",value:function(e,t){var n=t.coordinateHelper,i=t.elevationInfo,r=t.view;return Object(l.a)(new it({view:r,attached:!0,color:O.a.toUnitRGBA(at.a.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:O.a.toUnitRGBA(at.a.orange),outlineSize:at.a.rightAngleHintOutlineSize,size:at.a.rightAngleHintSize,geometry:{previous:Object(ot.a)(e.previousVertex,n,i,r),center:Object(ot.a)(e.centerVertex,n,i,r),next:Object(ot.a)(e.nextVertex,n,i,r)}}))}},{key:"createLineSegmentHintFromMap",value:function(e,t,n,i,r,a){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=Object(j.e)(),l=Object(j.e)();return Object(ot.c)(t,n,i,r,a,c,l),this.createLineSegmentHint(e,a,c,l,o,s)}},{key:"createLineSegmentHint",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new ke({view:t,extensionType:3,start:n,end:i,color:O.a.toUnitRGBA(at.a.orange),renderOccluded:16});switch(e){case 0:o.width=at.a.lineHintWidthTarget,o.fadedExtensions={start:0,end:at.a.lineHintFadedExtensions};break;case 2:o.width=at.a.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case 1:o.width=at.a.lineHintWidthReference,o.fadedExtensions={start:r?at.a.lineHintFadedExtensions:0,end:a?at.a.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),n}(n(919).a),ct=n(14),lt=n(691),ut=n(869),ht={main:new O.a([255,127,0]),selected:new O.a([255,255,255]),staged:new O.a([12,207,255]),outline:new O.a([0,0,0,.5]),selectedOutline:new O.a([255,255,255])},dt=.3;function pt(e,t){var n=e.clone();return n.a*=t,n}function ft(e,t){var n=e.clone(),i=Object(lt.b)(n);i.s*=t;var r=Object(lt.e)(i);return n.r=r.r,n.g=r.g,n.b=r.b,n}function vt(e,t){if(t)for(var n in t)e[n]=t[n]}var bt=function e(t){Object(r.a)(this,e),this.color=ht.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,vt(this,t)},gt=function(){function e(t){Object(r.a)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=ht.main,this.outlineColor=ht.outline,this.renderOccluded=16,this.hoverOutlineColor=ht.selectedOutline,vt(this,t)}return Object(a.a)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameterValues({color:Et(n),transparent:"color"!==e||n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),mt=function(){function e(t){Object(r.a)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=pt(ht.main,.5),this.hoverColor=ht.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,vt(this,t)}return Object(a.a)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameterValues({color:Et(n),transparent:n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),Ot=function e(t){Object(r.a)(this,e),this.vertex=new gt({color:ht.main,outlineColor:ht.outline}),this.edge=new gt({color:ft(pt(ht.main,2/3),.5),outlineColor:pt(ht.outline,.5),size:8,collisionPadding:8}),this.selected=new gt({color:ht.selected,outlineColor:ht.outline}),this.edgeOffset=new mt,vt(this,t)},yt=function(){function e(t){Object(r.a)(this,e),this.color=ht.selected,this.width=1.5,this.stipplePattern=Object(ut.a)([5,5]),this.stippleOffColor=ht.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=ht.selected,this.renderOccluded=4,vt(this,t)}return Object(a.a)(e,[{key:"apply",value:function(e){e.color=Et(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Et(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Et(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),jt=function(){function e(t){Object(r.a)(this,e),this.color=ht.selected,this.size=4,this.outlineSize=1,this.outlineColor=ht.outline,this.shape="square",vt(this,t)}return Object(a.a)(e,[{key:"apply",value:function(e){e.color=Et(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Et(this.outlineColor),e.primitive=this.shape}}]),e}(),_t=function(){function e(t){Object(r.a)(this,e),this.innerColor=ht.selected,this.innerWidth=1,this.glowColor=ht.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=dt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=ht.main,vt(this,t)}return Object(a.a)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={glowColor:O.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:O.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}]),e}(),xt=function e(t){Object(r.a)(this,e),this.outline=new yt({color:ht.outline,renderOccluded:8,stippleOffColor:ht.selected,stipplePattern:Object(ut.a)([5,5]),width:1.5,innerWidth:0}),this.staged=new yt({color:ht.selected,renderOccluded:8,innerColor:ht.staged,stippleOffColor:ht.outline,stipplePattern:Object(ut.a)([5,5]),width:1.5}),this.shadowStyle=new _t({globalAlpha:dt,glowColor:ht.main,glowFalloff:8,glowWidth:8,innerColor:ht.selected,innerWidth:1}),vt(this,t)},wt=function e(t){Object(r.a)(this,e),this.outline=new jt({color:ht.selected,outlineColor:ht.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new _t({globalAlpha:dt,glowColor:ht.main,glowFalloff:1.5,glowWidth:6,innerColor:ht.selected,innerWidth:1,radius:2}),vt(this,t)},kt=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this)).extensionType=2,vt(Object(ct.a)(i),e),i}return n}(yt),St=function e(t){Object(r.a)(this,e),this.lineGraphics=new xt,this.pointGraphics=new wt,this.heightPlane=new _t({globalAlpha:dt,glowColor:ht.main,glowFalloff:8,glowWidth:8,innerColor:ht.selected,innerWidth:1}),this.heightBox=new _t({globalAlpha:dt,glowColor:ht.main,glowFalloff:8,glowWidth:8,innerColor:ht.selected,innerWidth:0,heightFillColor:ht.main}),this.zVerticalLine=new kt({color:pt(ht.main,.5),falloff:2,innerColor:pt(ht.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,vt(this,t)},Mt=function(){function e(t){Object(r.a)(this,e),this.visualElements=new St,this.reshapeManipulators=new Ot,this.zManipulator=new bt,vt(this,t)}return Object(a.a)(e,[{key:"colorToVec4",value:function(e){return Et(e)}}]),e}();function Et(e){return Object(A.d)(O.a.toUnitRGBA(e))}var Pt=new Mt,Tt=n(67),Dt=n(611),Rt=n(29),Ct=n(211),At=function(){function e(t){Object(r.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(a.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return Object(u.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?Object(u.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?Object(u.j)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new Vt({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var n=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;n&&n.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!Object(u.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!Object(u.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){Object(u.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),Vt=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).drapeSourceType=1,i.updatePolicy=1,i}return n}(Object(Ct.a)(Rt.a));Object(c.a)([Object(d.b)({constructOnly:!0})],Vt.prototype,"view",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],Vt.prototype,"drapeSourceType",void 0),Vt=Object(c.a)([Object(b.a)("DrapedVisualElementLayerView")],Vt);var zt=n(822),It=n(660),Gt=n(795),Lt=function(){function e(t){var n=this;Object(r.a)(this,e),this.view=null,this._attachmentOrigin=Object(Dt.g)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Tt.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(S.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(S.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new qe({view:t.view,createResources:function(e){return n.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,n.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new At({view:t.view,createResources:function(){return n.createDrapedResources()},recreateGeometry:function(e){e.geometries=n.createRenderGeometriesDraped(e.material),n.attachmentOriginChanged()}});var i=!0;for(var a in this._laserline=new me({view:t.view}),t)a in this?"attached"===a?i=t[a]:this[a]=t[a]:console.error("Cannot set unknown property",a);this.attached=i}return Object(a.a)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&Object(u.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(k.g)(e,this._color)||(Object(k.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(k.g)(e,this._innerColor)||(Object(k.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(u.k)(e)!==Object(u.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&Object(k.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(S.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(u.k)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(u.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(y.w)(Ht,0,0,0);var t,n=0,i=Object(I.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.vertexAttributes.get("position"),o=r.indices.get("position"),s=Object(u.s)(this.resources.resources).material.isClosed(a.data,o);Object(It.a)(a,o,s,Ut)&&(Object(y.f)(Ht,Ht,Ut),n++)}}catch(c){i.e(c)}finally{i.f()}return 0===n?null:(Object(y.e)(Ht,Ht,1/n),this.view.renderCoordsHelper.fromRenderCoords(Ht,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){Object(u.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(u.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}},{key:"isClosed",get:function(){return Object(u.k)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,n){var i,r=this.createRenderGeometries(),a=Object(I.a)(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;e.addGeometry(o,t),n.push(o)}}catch(s){a.e(s)}finally{a.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new we.a(this.materialParameters),n=[];return this.recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}}},{key:"createDrapedResources",value:function(){var e=new we.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}},{key:"createRenderGeometriesDraped",value:function(e){var t=this.geometry;if(Object(u.j)(t))return[];var n,i=Object(zt.c)(t,this.view.basemapTerrain.spatialReference),r=[],a=Object(I.a)(i.lines);try{for(a.s();!(n=a.n()).done;){var o=n.value.position,s={attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?1:0},c=new Gt.a(Object(zt.a)(s),e),l=Object(He.h)(Ft);Object(He.k)(l,o),Object(k.l)(c.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),r.push(c)}}catch(h){a.e(h)}finally{a.f()}return r}},{key:"calculateMapBounds",value:function(e){if(Object(u.j)(this.resources.resources))return!1;var t,n=this.view.renderCoordsHelper,i=Object(I.a)(this.resources.resources.geometries);try{for(i.s();!(t=i.n()).done;){var r=t.value.vertexAttributes.get("position"),a=new Float64Array(r.data.length);Object(Ue.l)(r.data,n.spatialReference,0,a,this.view.spatialReference,0,r.data.length/3),Object(He.k)(e,a)}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"createRenderGeometries",value:function(){var e,t=this.geometry;if(Object(u.j)(t))return[];var n,i=Object(zt.b)(t,this.view.elevationProvider,this.view.renderCoordsHelper,We.a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new m.a({mode:Object(g.d)(t,null)}))),r=[],a=[],o=Object(I.a)(i.lines);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.position,l={attributeData:{position:c,mapPosition:s.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};r.push(Object(zt.a)(l)),a.push(c)}}catch(h){o.e(h)}finally{o.f()}return this._laserline.pathVerticalPlane=a,r}}]),e}(),Ft=Object(He.f)(),Ut=Object(j.e)(),Ht=Object(j.e)(),Nt=n(796),qt=n(597),Bt=n(680),Wt=n(624),Zt=n(695),Xt=n(924),Yt=n(556),Qt=n(567),Jt=n(641),Kt=n(612),$t=n(925),en=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new B.a(e.rctx,r,nn)}},{key:"bindPass",value:function(e,t){var n=this.configuration,i=n.screenSizeEnabled,r=n.shadingEnabled,a=e.color,o=e.shadingTint,s=e.shadingDirection;Object(Jt.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",a),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Qt.a)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(rn,o,a)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(Xt.b)(this.program,e,t)}},{key:"bindDraw",value:function(e){Object(Jt.d)(this.program,e),Object(Jt.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(Yt.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"blendColor",value:function(e,t,n){var i=1-t[3],r=t[3]+n[3]*i;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+n[0]*n[3]*i)/r,e[1]=(t[1]*t[3]+n[1]*n[3]*i)/r,e[2]=(t[2]*t[3]+n[2]*n[3]*i)/r,e[3]=n[3],e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,i=2===e;return Object(Z.f)({blending:0!==t.output&&7!==t.output||!t.transparent?null:n?Kt.g:Object(Kt.a)(e),culling:Object(Z.b)(t.cullFace),depthTest:{func:i?513:t.shadingEnabled?515:513},depthWrite:n?t.writeDepth&&Z.d:Object(Kt.c)(e),colorWrite:Z.c,polygonOffset:n||i?null:Kt.d})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),n}(N.a);en.shader=new H.a($t.a,(function(){return n.e(212).then(n.bind(null,1110))}));var tn=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(q.a);Object(c.a)([Object(q.b)({count:8})],tn.prototype,"output",void 0),Object(c.a)([Object(q.b)({count:3})],tn.prototype,"cullFace",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"slicePlaneEnabled",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"transparent",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"writeDepth",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"screenSizeEnabled",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"shadingEnabled",void 0),Object(c.a)([Object(q.b)({count:4})],tn.prototype,"transparencyPassType",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"multipassTerrainEnabled",void 0),Object(c.a)([Object(q.b)()],tn.prototype,"cullAboveGround",void 0);var nn=new Map([["position",0],["normal",1],["offset",2]]),rn=Object(A.e)(),an=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,sn)).supportsEdges=!0,i.techniqueConfig=new tn,i._vertexAttributeLocations=nn,i}return Object(a.a)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,n,i,r,a,o){var s=this;if(this.params.screenSizeEnabled){var c=e.vertexAttributes.get("offset"),l={applyToVertex:function(e,t,n,r){var a=Object(y.w)(ln,c.data[3*r+0],c.data[3*r+1],c.data[3*r+2]),o=Object(y.w)(un,e,t,n);return Object(y.e)(a,a,s.params.screenSize*i.camera.computeRenderPixelSizeAt(a)),Object(y.f)(o,o,a),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=Object(He.d)(e,ln);return Object(He.v)(e,s.params.screenSize*i.camera.computeRenderPixelSizeAt(t))}};Object(ae.f)(e,t,i,r,a,l,o)}else Object(ae.f)(e,t,i,r,a,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new on(e):void 0}},{key:"createBufferWriter",value:function(){return new cn(this.params.screenSizeEnabled)}}]),n}(Wt.a),on=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(n,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(en,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(4===this._output)return 3===e;var t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t||23===e}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),n}(Bt.a),sn=Object(i.a)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(y.r)(Object(j.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},Wt.b),cn=function(){function e(t){Object(r.a)(this,e),this.screenSizeEnabled=t;var n=Object(L.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&n.vec3f("offset"),this.vertexBufferLayout=n}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,i){if(Object(Zt.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var r=t.vertexAttributes.get("offset"),a=t.indices.get("offset");Object(re.a)(3===r.size);var o=n.getField("offset",qt.u);if(!o)throw new Error("unable to acquire view for offset");Object(Zt.e)(a,r.data,e.invTranspTransformation,o,i)}}}]),e}(),ln=Object(j.e)(),un=Object(j.e)(),hn=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).view=null,i._renderOccluded=4,i._vertices=null,i._spatialReference=null,i._color=Pt.colorToVec4(Pt.reshapeManipulators.vertex.color),i._size=Pt.reshapeManipulators.vertex.size,i._outlineColor=Pt.colorToVec4(Pt.reshapeManipulators.vertex.outlineColor),i._outlineSize=Pt.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return Object(a.a)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){Object(k.g)(e,this._color)||(Object(k.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(k.g)(e,this._outlineColor)||(Object(k.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if(Object(u.j)(e)||0===e.length)return[];for(var t=Object(Nt.c)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,We.a.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position,a=0;a<i;++a){var o=Object(y.w)(dn,r[3*a+0],r[3*a+1],r[3*a+2]),s=pn(.5,o),c=pn(.5,o);n.push({vertexGeometry:s,vertexOutlineGeometry:c})}return n}},{key:"createGeometries",value:function(e){var t,n=this.createRenderGeometries(),i=Object(I.a)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.vertexGeometry,o=r.vertexOutlineGeometry;e.addGeometry(a,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(s){i.e(s)}finally{i.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new an(Object(i.a)(Object(i.a)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new an(Object(i.a)(Object(i.a)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),n}(_e),dn=Object(j.e)();function pn(e,t){return xe.a.createSphereGeometry(e,16,16,{offset:t})}var fn=n(418),vn=n(955),bn=n(956),gn=n(920),mn=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._activeVertexVisualElement=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i.geometryType=null,i.type="draw-3d",i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this.elevationInfo,t=e.mode,n=e.offset;this.internalGraphicsLayer.elevationInfo=new m.a({mode:t,offset:n})}},{key:"normalizeCtorArgs",value:function(e){if(!e.elevationInfo){var t,n=null==(t=e.hasZ)||t;return Object(i.a)(Object(i.a)({},e),{},{elevationInfo:{mode:n?"absolute-height":"on-the-ground",offset:0}})}return e}},{key:"initializeGraphic",value:function(e){var t=this;return this._createGraphicState=new fn.a({graphic:e}),Object(l.b)([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),Object(h.a)(this._createGraphicState,"isDraped",(function(e){Object(u.k)(t._outlineVisualElement)&&(t._outlineVisualElement.isDraped=e)}))])}},{key:"makeDrawOperation",value:function(){return new bn.a({view:this.view,manipulators:this.manipulators,geometryType:Object(vn.b)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new gn.c(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new gn.a(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new st})}},{key:"onActiveVertexChanged",value:function(e){var t=this;return Object(u.k)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new hn({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Pt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=Pt.colorToVec4(Pt.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Object(l.c)((function(){t._activeVertexVisualElement=Object(u.e)(t._activeVertexVisualElement)})))}},{key:"onOutlineChanged",value:function(e){var t=this;if(Object(u.k)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;var n=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Lt({view:this.view,geometry:e,elevationInfo:n,isDraped:Object(u.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(g.c)(this.hasZ,n),attached:!1}),Pt.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),Pt.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Object(l.c)((function(){t._outlineVisualElement=Object(u.e)(t._outlineVisualElement)}))}},{key:"onRegularVerticesChanged",value:function(e){var t=this;return Object(u.k)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new hn({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Pt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Object(l.c)((function(){t._verticesVisualElement=Object(u.e)(t._verticesVisualElement)})))}}]),n}(vn.a);Object(c.a)([Object(d.b)({constructOnly:!0})],mn.prototype,"elevationInfo",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],mn.prototype,"geometryType",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],mn.prototype,"type",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],mn.prototype,"view",void 0),mn=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],mn);var On=n(31),yn=n(63),jn=n(725),_n=(n(76),n(215)),xn=n(64),wn=n(235),kn=n(562),Sn=n(161),Mn=n(139),En=n(764);function Pn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(T.c)();return Tn(e,e.screenToRender(t,Object(Re.b)(Ne.d.get())),n)}function Tn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(T.c)(),i=Object(Re.b)(Object(Ce.c)(Ne.d.get(),t));if(i[2]=0,!e.unprojectFromRenderScreen(i,n.origin))return null;var r=Object(Re.b)(Object(Ce.c)(Ne.d.get(),t));r[2]=1;var a=e.unprojectFromRenderScreen(r,Ne.d.get());return Object(u.j)(a)?null:(Object(y.j)(n.direction,a,n.origin),n)}var Dn=n(748),Rn=n(47),Cn=function(){function e(t){for(var n in Object(r.a)(this,e),this.idHint=0,this.camera=new Dn.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(U.d)(),this._worldFrame=null,this._renderLocation=Object(j.e)(),this._renderLocationDirty=!0,this._location=new Rn.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new Rn.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new Tt.a.EventEmitter,this._screenLocation={screenPointArray:Object(Re.f)(),renderScreenPointArray:Object(Re.d)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[n]=t[n];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return Object(a.a)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(xn.d)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){An(e)&&(this._screenLocationDirty=!0),Object(F.f)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(U.d)()),function(e,t,n){switch(e.viewingMode){case"local":return Object(F.j)(n),!0;case"global":var i=Object(Sn.e)(e.renderCoordsHelper.spatialReference);Object(Ue.t)(t,0,Hn,0,i.radius),Object(Ue.b)(Object(R.f)(Hn[0]),Object(R.f)(Hn[1]),n)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){Object(jn.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){Object(jn.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=Object(u.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this.ensureScreenLocation(),this._screenLocation}},{key:"ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,An(this._modelTransform)){var t=this._calculateModelTransformOffset(Zn);e=Object(y.f)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var n=Object(Re.i)(e,Vn),i=this._getCollisionRadius(t),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(Ce.j)(this.screenLocation.screenPointArray,n)<i*i)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":var a=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,Fn),c=i*this.screenLocation.pixelSize,l=Pn(this.camera,n,In);if(Object(u.j)(l))return null;var h,d=Object(I.a)(a);try{for(d.s();!(h=d.n()).done;){var p=h.value;if(0!==p.length)for(var f=Object(y.q)(Hn,p[0],s),v=1;v<p.length;v++){var b=Object(y.q)(Nn,p[v],s),g=Object(P.b)(Object(P.f)(f,b,zn),l);if(null!=g&&g<c*c){var m=Object(y.f)(Ne.d.get(),f,b);Object(y.e)(m,m,.5);var O=Object(Re.a)(Ne.d.get());return this.camera.projectToRenderScreen(m,O),O[2]+r}Object(y.k)(f,b)}}}catch(ne){d.e(ne)}finally{d.f()}break;case"disc":var _,x=this.collisionType.direction,w=null!=(_=this.collisionType.offset)?_:j.b,k=this._getWorldToScreenObjectScale(),S=this._calculateObjectTransform(k,Fn),M=i*this.screenLocation.pixelSize,E=Pn(this.camera,n,In);if(Object(u.j)(E))return null;var T=Object(wn.f)(Gn,S),D=Object(y.x)(Bn,x,T),R=Object(y.q)(Wn,w,S);Object(V.g)(R,D,Un);var C=qn;if(Object(V.m)(Un,E,C)&&Object(y.l)(C,R)<M*M)return this.screenLocation.renderScreenPointArray[2]+r;break;case"ribbon":var A=this.collisionType,z=A.paths,G=A.direction,L=this._getWorldToScreenObjectScale(),F=this._calculateObjectTransform(L,Fn),U=i*this.camera.computeScreenPixelSizeAt(this.renderLocation),H=Pn(this.camera,n,In);if(Object(u.j)(H))return null;var N=Object(wn.f)(Gn,F),q=Object(y.x)(Bn,G,N),B=this._calculateModelTransformPosition(Wn);Object(V.g)(B,q,Un);var W=qn;if(!Object(V.m)(Un,H,W))break;var Z,X=Object(I.a)(z);try{for(X.s();!(Z=X.n()).done;){var Y=Z.value;if(0!==Y.length)for(var Q=Object(y.q)(Hn,Y[0],F),J=1;J<Y.length;J++){var K=Object(y.q)(Nn,Y[J],F),$=Object(P.e)(Object(P.f)(Q,K,zn),W);if(null!=$&&$<U*U){var ee=Object(y.f)(Ne.d.get(),Q,K);Object(y.e)(ee,ee,.5);var te=Object(Re.a)(Ne.d.get());return this.camera.projectToRenderScreen(ee,te),te[2]+r}Object(y.k)(Q,K)}}}catch(ne){X.e(ne)}finally{X.f()}break;default:Object(_n.a)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var n=t.manipulator3D;if(Object(u.j)(n.engineLayerId)){var i=new je.a({isPickable:!1,updatePolicy:1});this.view._stage.add(i),n.engineLayerId=i.id,this._engineLayer=i}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(n.engineLayerId));n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._materialIdReferences=n.materialIdReferences,Object(u.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,n.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(Ue.a)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Rn.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var n=0===t.engineLayerReferences;n&&(t.engineLayerId=null),this._removeResourcesFromStage(n),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){Object(Ue.n)(this.location,Xn,e.spatialReference),Object(Mn.h)(e.extent,Xn)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if(Object(u.j)(this.elevationInfo))return!1;var t=null,n=0,i=Object(u.t)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(u.t)(Object(En.b)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":n=Object(u.t)(Object(En.b)(this.view.elevationProvider,e,"ground"),0)+i;break;case"relative-to-scene":n=Object(u.t)(Object(En.b)(this.view.elevationProvider,e,"scene"),0)+i;break;case"absolute-height":n=i}return(n!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=n,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=Fn;if(!0===this.autoScaleRenderObjects){var n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);var i,r=this._ensureEngineResources().objectsByState,a=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0,s=Object(I.a)(r);try{for(s.s();!(i=s.n()).done;){var c=i.value,l=c.stateMask,u=c.objects;if(o){var h,d=Object(I.a)(u);try{for(d.s();!(h=d.n()).done;){h.value.setVisible(!1)}}catch(y){d.e(y)}finally{d.f()}}else{var p=!(0!=(15&l))||(a&l)==(15&l),f=!(0!=(65520&l))||(this.state&l)==(65520&l);if(p&&f){var v,b=Object(I.a)(u);try{for(b.s();!(v=b.n()).done;){var g=v.value;g.setVisible(!0),g.transformation=t}}catch(y){b.e(y)}finally{b.f()}}else{var m,O=Object(I.a)(u);try{for(O.s();!(m=O.n()).done;){m.value.setVisible(!1)}}catch(y){O.e(y)}finally{O.f()}}}}}catch(y){s.e(y)}finally{s.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if(Object(u.j)(this._engineResources)){var e=Object(u.s)(this._engineLayer),t=[],n=new Set;this.renderObjects.forEach((function(e){var i=e.material;n.has(i)||(t.push(i),n.add(i))}));var i=new Map;this._renderObjects.forEach((function(e){var t=new ye.a({castShadow:!1});!function(e,t){var n=t.geometry,i=t.material,r=t.transform;Array.isArray(n)?n.forEach((function(t){return e.addGeometry(t,i,r)})):e.addGeometry(n,i,r)}(t,e);var n=e.stateMask||0,r=i.get(n)||[];r.push(t),i.set(n,r)}));var r=[];i.forEach((function(e,t){return r.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!Object(u.j)(this._engineResources)){var t=this._engineResources,n=t.objectsByState,i=t.layer;t.materials.forEach((function(t){var n=Object(u.s)(e._materialIdReferences),i=n.get(t.id)||0;0===i&&e.view._stage.add(t),n.set(t.id,i+1)})),n.forEach((function(t){var n=t.objects;i.addMany(n),e.view._stage.addMany(n)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!Object(u.j)(this._engineResources)){var n=this._engineResources,i=n.objectsByState,r=n.layer,a=n.materials;i.forEach((function(t){var n=t.objects;r.removeMany(n),e.view._stage.removeMany(n)})),a.forEach((function(t){var n=Object(u.s)(e._materialIdReferences),i=n.get(t.id);1===i?(e.view._stage.remove(t),n.delete(t.id)):n.set(t.id,i-1)})),t&&this.view._stage.remove(r),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,Ln);return Object(y.w)(e,n[12],n[13],n[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return Object(y.j)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return Object(F.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(F.n)(t,t,this._worldFrame),Object(F.n)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(u.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if(Object(u.k)(this._engineResources))for(var t in this._engineResources.objectsByState){var n,i=this._engineResources.objectsByState[t],r=Object(I.a)(i.objects);try{for(r.s();!(n=r.n()).done;){if(n.value.isVisible){e=!0;break}}}catch(a){r.e(a)}finally{r.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function An(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var Vn=Object(Re.f)(),zn=Object(P.d)(),In=Object(T.c)(),Gn=Object(kn.b)(),Ln=Object(U.d)(),Fn=Object(U.d)(),Un=Object(V.d)(),Hn=Object(j.e)(),Nn=Object(j.e)(),qn=Object(j.e)(),Bn=Object(j.e)(),Wn=Object(j.e)(),Zn=Object(j.e)(),Xn=new Rn.a({x:0,y:0,z:0,spatialReference:null}),Yn=n(626);function Qn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(A.g)(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return n?new an({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t}):new nt.a({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t})}function Jn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=Object(A.g)(e[0],e[1],e[2],4===e.length?e[3]:1);return new nt.a({color:n,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function Kn(e,t,n,i){var r=Object(y.j)(Ne.d.get(),e,n),a=$n(r,Object(y.g)(Ne.d.get(),i,r),n,Ne.a.get());Object(F.c)(a,a);var o=Object(y.q)(Ne.d.get(),t,a);return Math.atan2(o[1],o[0])}function $n(e,t,n,i){var r=Object(y.r)(Ne.d.get(),e),a=Object(y.r)(Ne.d.get(),t),o=Object(y.g)(Ne.d.get(),r,a);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=0,i[4]=a[0],i[5]=a[1],i[6]=a[2],i[7]=0,i[8]=o[0],i[9]=o[1],i[10]=o[2],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function ei(e,t){var n=e.getViewForGraphic(t);return Object(u.k)(n)&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(t,e.spatialReference):null}function ti(e,t,n){var i=ei(e,n);Object(u.k)(i)?t.elevationAlignedLocation=i:function(e,t){if(Object(u.j)(t))return;var n="mesh"===t.type?t.anchor:Object(Yn.a)(t);Object(u.j)(n)||(e.location=Object(jn.b)(n))}(t,n.geometry)}function ni(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.e)(e);return"on-the-ground"!==t.mode&&!(Object(u.j)(e.geometry)||!e.geometry.hasZ)}var ii=function(){function e(){Object(r.a)(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return Object(a.a)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,n){if(0===n&&(t.zManipulator=e),e instanceof Cn&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),Object(u.j)(t.firstGrabbedXY)&&e.grabbing&&1===n&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,n){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))}}]),e}();function ri(e){var t=e.view,n=e.graphic,i=new fn.a({graphic:n}),r=function(e,t){var n=e.view,i=e.graphic,r=new Lt({view:n,geometry:oi(i)?i.geometry:null,elevationInfo:Object(g.e)(i),attached:!1});Pt.visualElements.lineGraphics.shadowStyle.apply(r);var a=function(){r.attached=t.displaying};Pt.visualElements.lineGraphics.outline.apply(r);var o=[t.watch("displaying",a),t.watch("isDraped",(function(e){return r.isDraped=e})),t.on("changed",(function(){return r.geometry=oi(i)?i.geometry:null})),Object(l.a)(r)];return a(),{visualElement:r,remove:function(){return Object(l.b)(o).remove()}}}(e,i),a=[r,ai(e,r.visualElement,i),t.maskOccludee(n),t.trackGraphicState(i)];return{visualElement:r.visualElement,remove:function(){return Object(l.b)(a).remove()}}}function ai(e,t,n){var i=e.graphic,r=e.view,a=[],o=Object(g.e)(i),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new ii,h=new ke({view:r,extensionType:Pt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Pt.visualElements.pointGraphics.shadowStyle.apply(h);var d=Object(R.f)(Pt.visualElements.heightPlaneAngleCutoff),p=new me({view:r,attached:!1,angleCutoff:d});Pt.visualElements.heightPlane.apply(p);var f=1,v=1,b=function(){if(c.update(e),!n.displaying||s&&(n.isDraped||!oi(i)||!i.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(p.attached=!1);t.laserlineEnabled=!0;var r=4&c.grabbingState?Pt.visualElements.laserlineAlphaMultiplier:1;r!==f&&(f=r,Pt.visualElements.lineGraphics.shadowStyle.apply(t,r),Pt.visualElements.pointGraphics.shadowStyle.apply(h,r));var a=2&c.grabbingState?Pt.visualElements.laserlineAlphaMultiplier:1;a!==v&&(v=a,Pt.visualElements.heightPlane.apply(p,a)),function(e,t){var n=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(u.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(u.k)(n)?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(h,c),function(e,t,n,i){if(i.numSelected>0){Object(y.w)(si,0,0,0);var r=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof Cn&&(Object(y.f)(si,si,e.renderLocation),r++)})),r>0?(n.heightManifoldTarget=Object(y.e)(si,si,1/r),n.attached=!0):n.attached=!1}else{var a=t.attachmentOrigin;Object(u.k)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,si)?(n.heightManifoldTarget=si,n.attached=!0):n.attached=!1}}(e,t,p,c)};Pt.visualElements.zVerticalLine.apply(h),a.push(n.on("changed",b),n.watch("displaying",b),t.events.on("attachment-origin-changed",b),Object(l.a)(h),Object(l.a)(p));var m=[],O=function(){Object(l.b)(m).remove(),m.length=0,e.forEachManipulator((function(e){return m.push(e.events.on("grab-changed",b))})),e.forEachManipulator((function(e){return m.push(e.events.on("select-changed",b))})),b()};return O(),a.push(e.onManipulatorsChanged(O),Object(l.d)((function(){return Object(l.b)(m)}))),Object(l.b)(a)}function oi(e){return Object(u.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var si=Object(j.e)();function ci(e){var t=e.view,n=e.graphic,i=new fn.a({graphic:n}),r=[],a=function(e,t,n){var i=e.view,r=e.graphic,a=new Qe({view:i,geometry:li(r),elevationInfo:Object(g.e)(r),attached:!1});return function(e,t,n,i){var r=function(){return t.attached=n.displaying};(function(e,t,n,i){var r=e.view,a=e.graphic,o=null,s=function(e){Object(u.k)(o)&&(o.remove(),o=null),n.isDraped&&Object(u.k)(e)&&(o=function(e,t,n){var i=e.elevationProvider.spatialReference;Object(Ue.o)(t,ui,i);var r=ui[0],a=ui[1];return e.elevationProvider.on("elevation-change",(function(e){Object(Mn.j)(e.extent,r,a)&&n()}))}(r,e,(function(){t.geometry=e})))},c=function(){var e=li(a);s(e),t.geometry=e};i.push(n.on("changed",c),Object(l.d)((function(){return o}))),c()})(e,t,n,i),Pt.visualElements.pointGraphics.outline.apply(t),i.push(Object(h.a)(n,"displaying",r))}(e,a,t,n),n.push(Object(l.a)(a)),a}(e,i,r);return function(e,t,n,i){var r=e.view,a=e.graphic,o=new ke({view:r,extensionType:Pt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Pt.visualElements.zVerticalLine.apply(o);var s=new me({view:r,intersectsLineInfinite:!0,attached:!1});Pt.visualElements.pointGraphics.shadowStyle.apply(s);var c=Object(R.f)(Pt.visualElements.heightPlaneAngleCutoff),h=new me({view:r,attached:!1,angleCutoff:c});Pt.visualElements.heightPlane.apply(h);var d=Object(g.e)(e.graphic),p=We.a.fromElevationInfo(d),f="on-the-ground"===d.mode||!d.offset&&"absolute-height"!==d.mode,v=new ii,b=1,m=1,O=function(){v.update(e);var n=li(a),c=f&&(t.isDraped||Object(u.j)(n)||!n.hasZ),l=!0;if(!c&&Object(u.k)(n)){var d=Object(Be.e)(n,r.elevationProvider,p,r.renderCoordsHelper);Object(y.w)(ui,n.x,n.y,d),Object(Ue.r)(ui,n.spatialReference,ui,r.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(ui),s.intersectsWorldUpAtLocation=ui}else l=!1;var g=2&v.grabbingState?Pt.visualElements.laserlineAlphaMultiplier:1;g!==b&&(b=g,Pt.visualElements.heightPlane.apply(h,g));var O=Object(He.h)(hi);!c&&t.displaying&&i.calculateMapBounds(O)&&Object(Ue.r)(Object(He.q)(O,ui),r.spatialReference,ui,r.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=ui,h.attached=!0):h.attached=!1;var j=4&v.grabbingState?Pt.visualElements.laserlineAlphaMultiplier:1;j!==m&&(m=j,Pt.visualElements.pointGraphics.shadowStyle.apply(s,j));var _=l&&t.displaying&&!c;s.attached=_,o.attached=_};n.push(t.watch(["displaying","isDraped"],O),t.on("changed",O)),e.forEachManipulator((function(e){n.push(e.events.on("grab-changed",O))})),n.push(Object(l.a)(s)),n.push(Object(l.a)(o)),n.push(Object(l.a)(h)),O()}(e,i,r,a),r.push(t.trackGraphicState(i)),{visualElement:a,remove:function(){Object(l.b)(r).remove()}}}function li(e){var t=e.geometry;return Object(u.j)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}var ui=Object(j.e)(),hi=Object(He.f)();function di(e){switch(Object(u.s)(e.graphic.geometry).type){case"point":case"mesh":return ci(e);case"polygon":case"polyline":return ri(e);default:return null}}var pi=[1,.5,0],fi=70,vi=Math.ceil(fi/3*2),bi=160,gi=5*Math.PI/12,mi=1*Math.PI/3,Oi=function(){function e(){Object(r.a)(this,e),this._available=!0}return Object(a.a)(e,[{key:"location",set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"renderLocation",get:function(){var e;return this.forEachManipulator3D((function(t){e||(e=t.renderLocation)})),e}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,n){t instanceof Cn&&e(t,n)}))}}]),e}(),yi=n(678),ji=(n(963),n(828),n(652));function _i(e,t){return xi(e,(function(){return t}))}function xi(e,t){var n=Object(j.e)(),r=Object(j.e)(),a=!1;return function(o){var s=t(o);if("start"===o.action){var c=Object(Re.i)(o.screenStart,Object(Re.c)(Ne.c.get())),l=Pn(e.state.camera,c,Di);Object(u.k)(l)&&(a=Object(V.m)(s,l,n))}if(!a)return null;var h=Object(Re.i)(o.screenEnd,Object(Re.c)(Ne.c.get())),d=Pn(e.state.camera,h,Di);return Object(u.j)(d)?null:Object(V.m)(s,d,r)?Object(i.a)(Object(i.a)({},o),{},{renderStart:n,renderEnd:r,plane:s,ray:d}):null}}function wi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return function(s){if("start"===s.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Re.f)(s.screenStart.x,s.screenStart.y),t,n,a),Object(u.k)(o)&&Object(u.k)(r)&&!Object(Ue.n)(o,o,r)))return null;if(Object(u.j)(o))return null;var c=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Re.f)(s.screenEnd.x,s.screenEnd.y),t,n,a);return Object(u.k)(c)?Object(u.k)(r)&&!Object(Ue.n)(c,c,r)?null:Object(i.a)(Object(i.a)({},s),{},{mapStart:o,mapEnd:c}):null}}function ki(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return wi(e,n,Object(g.g)(t,e,n),i,r)}function Si(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return ki(e,n,Object(g.e)(t),i,r)}function Mi(e,t,n){var i=null,r=new ji.a;return r.next(_i(e,function(e,t){var n=Pi,i=Ti,r=Object(V.d)();e.renderCoordsHelper.worldUpAtPosition(t,n);var a=Object(y.g)(r,n,Object(y.j)(i,t,e.state.camera.eye));return Object(y.g)(a,a,n),Object(V.g)(t,a,r)}(e,t))).next(function(e,t){var n=Object(j.e)(),i=Object(y.p)(t);e.renderCoordsHelper.worldUpAtPosition(t,n);var r=Object(j.e)(),a=Object(j.e)(),o=function(r){return Object(y.j)(r,r,t),Object(yi.c)(n,r,r),"global"===e.viewingMode&&Object(y.p)(r)*Object(R.p)(Object(y.h)(n,r))<.001-i&&Object(y.j)(r,Object(y.e)(r,n,.001),t),Object(y.f)(r,r,t),r};return function(e){return e.renderStart=o(Object(y.k)(r,e.renderStart)),e.renderEnd=o(Object(y.k)(a,e.renderEnd)),e}}(e,t)).next(Ei(e,n)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),function(e){return i=null,r.execute(e),i}}function Ei(e,t){var n=e.renderCoordsHelper;return function(e){var r=n.fromRenderCoords(e.renderStart,t),a=n.fromRenderCoords(e.renderEnd,t);return Object(u.k)(r)&&Object(u.k)(a)?Object(i.a)(Object(i.a)({},e),{},{mapStart:r,mapEnd:a}):null}}var Pi=Object(j.e)(),Ti=Object(j.e)(),Di=Object(T.c)();function Ri(e,t,n,i){var r=e.graphic,a=function(e,n){return t({action:e,graphic:r,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n((function(e,t,n){var o=t.next((function(e){return"start"===e.action&&a("start",e),e})).next(Object(ji.g)(r,i)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e}));return n.next(Object(ji.i)(r)).next((function(){a("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function Ci(e){if(Object(u.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var n=t[0],i=t[1];return Math.atan2(i[1]-n[1],i[0]-n[0])}var Ai=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this))._handles=new w.a,i._arrowManipulatorInfos=new Array,i._opaqueMaterial=i.createMaterial(),i._transparentMaterial=i.createMaterial(.5),i._angle=0,i._scale=1,i._radius=fi,i._updateAfterDrag=!1,i.events=new Tt.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulators(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(a.a)(n,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles=Object(u.e)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){this._arrowManipulatorInfos.map((function(t){var n=t.manipulator;return e(n,1)}))}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,r=t.graphic,a=Object(g.e)(r),o=Object(u.s)(r.geometry).spatialReference;return Ri(t,n,(function(t){return i.createDragPipeline((function(n,i,r,a,o){return t(n,e(n,i,r,a,o),r)}),a,o,r)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,n,r){var a=this;return Object(l.b)(this._arrowManipulatorInfos.map((function(o,s){var c=o.manipulator;return Object(ji.e)(c,(function(o,c,l,u,h){var d=c.next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:1})})).next(Object(ji.f)(a._view,o.elevationAlignedLocation)).next(ki(a._view,o.elevationAlignedLocation,t,n,r)).next(Object(ji.d)(o.location,a.angle+(s+1)*Math.PI*.5)).next(Object(ji.c)());e(o,d,l,u,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var n=e.manipulator,i=e.transform,r=this._radius/fi,a=54*r,o=a*Math.sqrt(3)/2,s=xe.a.createExtrudedTriangle(o,a/2,a/2,.02);xe.a.transformInPlace(s,Object(F.u)(Ne.a.get(),Object(y.w)(Ne.d.get(),0,-o/3,0))),n.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],n.radius=o/3*2*1.2;var c=Object(F.j)(Ne.a.get());Object(F.a)(c,t*Math.PI/2);var l=Object(F.j)(Ne.a.get());Object(F.u)(l,Object(y.w)(Ne.d.get(),0,100*r,0)),Object(F.n)(i,c,l)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=Object(F.j)(Ne.a.get());Object(F.e)(t,t,e,Object(j.g)(0,0,1));var n=Object(F.v)(Ne.a.get(),Object(y.w)(Ne.d.get(),this.displayScale,this.displayScale,this.displayScale)),i=Object(F.j)(Ne.a.get());Object(F.n)(i,n,t);var r,a=Object(I.a)(this._arrowManipulatorInfos);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=Object(F.n)(Ne.a.get(),i,o.transform);o.manipulator.modelTransform=s}}catch(c){a.e(c)}finally{a.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,n=new Cn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(j.g)(0,0,1)}}),i={manipulator:n,transform:Object(U.d)()};return this._updateArrowManipulator(i,e),this._handles.add(n.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),i}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=O.a.toUnitRGBA(ht.main);return t[3]*=e,new nt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),n}(Oi),Vi=function(){function e(){Object(r.a)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new ji.a,this._enabled=!1}return Object(a.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(u.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,n=this.snap(this.lastDragEvent.screenEnd);if(Object(u.k)(n)){var i={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(i)}}this._enabled=e}},{key:"snap",value:function(e){var t=Object(u.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(u.k)(t)&&Object(u.k)(this.view)&&(t.z=Object(g.g)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var n=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(n.lastDragEvent="end"!==e.action?Object(i.a)({},e):null,n._enabled){var t=n.snap(e.screenEnd);return Object(u.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),zi=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this))._handles=new w.a,i._snapToScene=new Vi,i._discMaterial=i._createMaterial(),i._discMaterialTransparent=i._createMaterial(.5),i._scale=1,i._radius=fi,i._view=e.view,i._tool=e.tool,null!=e.snapToScene&&(i.snapToScene=e.snapToScene),null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(a.a)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,r=t.graphic,a=Object(g.e)(r),o=Object(u.s)(r.geometry).spatialReference;return Ri(t,n,(function(t){return i.createDragPipeline((function(n,i,r,a,o){return t(n,e(n,i,r,a,o),r)}),a,o,r)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,n,r){var a=this,o=this._view;return Object(ji.e)(this._manipulator,(function(s,c,l,u,h){var d=c.next(Object(ji.f)(o,s.elevationAlignedLocation)).next(ki(o,s.elevationAlignedLocation,t,n,r)).next(a._snapToScene.createDragEventPipelineStep(o,t),a._snapToScene.next).next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:1})})).next(Object(ji.c)());e(s,d,l,u,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=Object(F.v)(Ne.a.get(),Object(y.w)(Ne.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new Cn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(j.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=xe.a.createCylinderGeometry(.02,1,128,Object(j.g)(0,0,1),Object(j.g)(0,0,0)),t=Object(F.v)(Object(U.d)(),Object(j.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/fi*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=O.a.toUnitRGBA(ht.main);return t[3]*=e,new nt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),n}(Oi),Ii=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this))._handles=new w.a,i._radius=fi,i.events=new Tt.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i.createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(a.a)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,r=Object(u.s)(t.graphic.geometry).spatialReference;return Ri(t,n,(function(t){return i.createDragPipeline((function(n,i,r,a,o){return t(n,e(n,i,r,a,o),r)}),r)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t){var n=this._view;return Object(ji.e)(this._manipulator,(function(r,a,o,s,c){var l=a.next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:0})})).next(Mi(n,r.renderLocation,t)).next(Object(ji.c)());e(r,l,o,s,c)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/fi,t=Pt.zManipulator.height*e,n=Pt.zManipulator.coneHeight*e,i=Pt.zManipulator.coneWidth*e,r=Pt.zManipulator.width*e,a=[Object(j.g)(0,0,0),Object(j.g)(0,0,t)],o=xe.a.createTubeGeometry(a,r/2,16,!1),s=xe.a.createConeGeometry(n,i/2,16,!1),c=[Object(j.g)(0,0,0),Object(j.g)(0,0,t+n)],l=function(e){var n=Object(U.d)();if(Object(F.t)(n,n,[0,0,t]),Object(F.d)(n,n,Math.PI/2),e){var r=1+2*e/i;Object(F.g)(n,n,[r,r,r])}return n}(0),u=function(e,t){var n=Object(lt.a)(Pt.zManipulator.color,t);return[n.r/255,n.g/255,n.b/255,Pt.zManipulator.color.a*e]},h=Qn(u(1,.25),1),d=Qn(u(1,0),1),p=Qn(u(.7,0),Pt.zManipulator.renderOccluded),f=Qn(u(.85,0),Pt.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:l,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:s,transform:l,material:d,stateMask:2},{geometry:o,material:d,stateMask:2},{geometry:s,transform:l,material:p,stateMask:1},{geometry:o,material:p,stateMask:1},{geometry:s,transform:l,material:f,stateMask:2},{geometry:o,material:f,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}},{key:"createManipulator",value:function(){var e=this,t=new Cn({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var n=e._view.state.camera,i=Gi;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,i);var r=Object(y.n)(n.eye,i),a=n.computeRenderPixelSizeAtDist(r),o=Object(y.j)(Li,i,n.eye);Object(y.r)(o,o);var s=Fi;e._view.renderCoordsHelper.worldUpAtPosition(Gi,s);var c=Math.abs(Object(y.h)(o,s)),l=Object(y.g)(Li,o,s),u=Object(y.g)(Li,l,s),h=Object(R.d)(c,.01,1),d=1-Math.sqrt(1-h*h)/h/n.fullWidth,p=e._radius/fi,f=Pt.zManipulator.width*p;Object(y.e)(u,Object(y.r)(u,u),(1/d-1)*r+a*f),t[12]-=Li[0],t[13]-=Li[1],t[14]-=Li[2]},this._manipulator=t,this.updateManipulator()}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]),n}(Oi),Gi=Object(j.e)(),Li=Object(j.e)(),Fi=Object(j.e)(),Ui=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;Object(r.a)(this,n),(i=t.call(this))._handles=new w.a,i._angleDeferred=null,i._interactive=!0;var a=e.tool,o=e.view,s=e.snapToScene,c=e.radius;return i._view=o,i.xyManipulation=new zi({tool:a,view:o,snapToScene:s,radius:c}),i.xyAxisManipulation=new Ai({tool:a,view:o,radius:c}),i.zManipulation=new Ii({tool:a,view:o,radius:c}),i.xyManipulation.available=e.xyAvailable,i.xyAxisManipulation.available=e.xyAxisAvailable,i.zManipulation.available=e.zAvailable,i.autoHideXYAxis(),i.forEachManipulator((function(e){i._handles.add(e.events.on("grab-changed",(function(){return i.updateManipulatorInteractivity()})))})),i}return Object(a.a)(n,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,n){return Object(l.b)([this.xyManipulation.createGraphicDragPipeline((function(t,n,i,r,a){return e(0,t,n,i,r,a)}),t,n),this.xyAxisManipulation.createGraphicDragPipeline((function(t,n,i,r,a){return e(1,t,n,i,r,a)}),t,n),this.zManipulation.createGraphicDragPipeline((function(t,n,i,r,a){return e(2,t,n,i,r,a)}),t,n)])}},{key:"createDragPipeline",value:function(e,t,n,i){return Object(l.b)([this.xyManipulation.createDragPipeline((function(t,n,i,r,a){return e(0,t,n,i,r,a)}),t,n,i),this.xyAxisManipulation.createDragPipeline((function(t,n,i,r,a){return e(1,t,n,i,r,a)}),t,n,i),this.zManipulation.createDragPipeline((function(t,n,i,r,a){return e(2,t,n,i,r,a)}),n)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,n=this.xyManipulation;if(!Object(p.a)("esri-mobile")){var i=[];n.forEachManipulator((function(e){return i.push(e)})),t.forEachManipulator((function(e){return i.push(e)}));for(var r=function(){var n=[];e.xyAxisVisible?Object(u.k)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(Hi),e._handles.add(n,Hi)},a=0,o=i;a<o.length;a++){var s=o[a];this._handles.add(s.events.on("focus-changed",r))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",r)),r()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e._interactive||n.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=Object(u.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?vi:fi}}]),n}(Oi),Hi="disable-xy-axis-display",Ni=n(926),qi=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this))._handles=new w.a,i._view=e.view,i._tool=e.tool,i._graphicState=e.graphicState,i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(a.a)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return Ri(this._graphicState,e,(function(e){return t.createDragPipeline(e)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e){var t=this._view,n=this._graphicState.graphic,i=Object(u.k)(n.geometry)?n.geometry.spatialReference:null;return Object(ji.e)(this._manipulator,(function(r,a,o,s,c){var l=a.next(function(e,t,n,i){var r=t.toMap(e.screenStart,{include:[n]});return Object(u.k)(r)?Si(t,n,r,i):null}(c,t,n,i)).next(Object(ji.b)()).next(Object(ji.c)());e(r,l,o,s,c)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new Ni.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),n}(Oi),Bi=n(468),Wi=n(770),Zi=n(751),Xi=n(724),Yi=n(787),Qi=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-start"},Ji=function e(t,n,i){Object(r.a)(this,e),this.dx=t,this.dy=n,this.allGraphics=i,this.type="graphic-move"},Ki=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-stop"},$i=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).graphics=new On.a,i.enableZ=!0,i.type="move-3d",i._toolHandles=new w.a,i.snappingPipeline=new Yi.a,i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators(),this.complete()}},{key:"destroy",value:function(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===Object(Bi.a)(e)})).map((function(e){return new er(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this.handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,n=this,r=Object(I.a)(e);try{var a=function(){var r=t.value,a=r.state;r.manipulationXY=new qi({tool:n,view:n.view,graphicState:a}),r.manipulationXY.forEachManipulator((function(e){return n.handles.add(e.events.on("immediate-click",(function(e){n.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:a.graphic})),e.stopPropagation()})))})),n.handles.add(r.manipulationXY.createDragPipeline((function(t,i,r,a){return n.buildDragEventPipeline(e,0,t,i,r,a)})))};for(r.s();!(t=r.n()).done;)a()}catch(o){r.e(o)}finally{r.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,n=new Ui({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ui.radiusForSymbol(e[0].graphic.symbol):fi});this._moveManipulation=n,n.elevationInfo={mode:"absolute-height",offset:0},n.forEachManipulator((function(e){t.handles.add(e.events.on("immediate-click",(function(r){n.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",Object(i.a)(Object(i.a)({},r),{},{graphic:t.graphics.getItemAt(0)})),r.stopPropagation()})))}));var r,a=function(){return t.updateMoveManipulation(e)},o=Object(I.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.handles.add([s.state.on("changed",a),s.state.watch("displaying",a)])}}catch(l){o.e(l)}finally{o.f()}var c=e[e.length-1];this.handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this.handles.add(n.createDragPipeline((function(n,i,r,a,o){return t.buildDragEventPipeline(e,n,i,r,a,o)}),Object(g.e)(c.graphic),Object(u.s)(c.graphic.geometry).spatialReference,c.graphic)),this.updateMoveManipulationAngle(c)}},{key:"createVisualElements",value:function(e){var t,n=this,i=Object(I.a)(e);try{var r=function(){var i=t.value,r=i.graphic,a=di({view:n.view,graphic:r,forEachManipulator:function(e){i.manipulationXY.forEachManipulator(e),n._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return Object(l.c)()}});Object(u.j)(a)||(i.geometryRepresentation=a.visualElement,i.geometryRepresentation instanceof Lt&&n.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(function(){i.state.isDraped||n.updateMoveManipulation(e)})),i.state.watch("isDraped",(function(){return n.updateMoveManipulation(e)}))]),n.handles.add(a))};for(i.s();!(t=i.n()).done;)r()}catch(a){i.e(a)}finally{i.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return Ci(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,n=Object(Dt.g)(0,0,0,this.view.spatialReference),i=0,r=!1,a=this._moveManipulation,o=Object(I.a)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.state.displaying){var c=s.state.graphic;this.enableZ&&ni(c)&&(r=!0);var l=s.geometryRepresentation instanceof Lt&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:ei(this.view,c);Object(u.k)(l)&&(n.x+=l.x,n.y+=l.y,n.z+=l.z,i++)}}}catch(h){o.e(h)}finally{o.f()}i>0?(n.x/=i,n.y/=i,n.z/=i,a.location=n,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=r):a.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,n,i,r,a){var o=this,s=[],c=[],l=null,u=null,h=function(){var e,t=Object(I.a)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(n){t.e(n)}finally{t.f()}s.length=0,c.length=0,l=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var d=e[0].graphic;i=this.buildSnappingPipelineSteps(d,Object(g.e)(d),i,r,a)}var p=i.next((function(t){if("start"===t.action){s.length=0,c.length=0;var i,r=Object(I.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.dragging||!a.manipulationXY.hasManipulator(n)&&a.manipulationXY.grabbing||(s.push(a),c.push(a.graphic),a.dragging=!0)}}catch(h){r.e(h)}finally{r.f()}if(0!==c.length&&(o._moveManipulation.interactive=!1,l=Object(ji.h)(c,o.view.state.viewingMode),u=Object(ji.j)(c),o.emit("graphic-move-start",new Qi(c)),o.destroyed))return null}return 0!==c.length?t:null})).next((function(e){return l(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),n=o.view.toScreen(e.mapEnd),i=n.x-t.x,r=n.y-t.y;if(o.emit("graphic-move",new Ji(i,r,c)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new Ki(c)),o.destroyed)return null;h()}}));return r.next((function(e){return u(e)})).next((function(){if(o.emit("graphic-move-stop",new Ki(c)),o.destroyed)return null;h()})),p}},{key:"buildSnappingPipelineSteps",value:function(e,t,n,r,a){var o=this,s=e.geometry;if(Object(u.j)(s)||"point"!==s.type&&"mesh"!==s.type)return n;var c=("point"===s.type?s:s.anchor).clone(),l=new Xi.a({elevationInfo:t,pointer:a,editGeometryOperations:Zi.a.fromGeometry(c,this.view.state.viewingMode),visualizer:new st,excludeFeature:e}),h=this.snappingManager;return n.next((function(t){return c.z=Object(g.a)(o.view,c,Object(g.e)(e),{mode:"absolute-height",offset:0}),Object(i.a)(Object(i.a)({},t),{},{snapOrigin:l.coordinateHelper.pointToVector(c)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:h,cancel:r,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}}]),n}(Object(yn.b)(Tt.a.EventedMixin(Wi.a)));Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],$i.prototype,"view",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],$i.prototype,"graphics",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],$i.prototype,"enableZ",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],$i.prototype,"snappingManager",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],$i.prototype,"type",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],$i.prototype,"updating",null),$i=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],$i);var er=function(){function e(t){Object(r.a)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new fn.a({graphic:t})}return Object(a.a)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),tr=n(302),nr=n(101),ir=n(204),rr=n(861);function ar(e,t,n){var i="on-the-ground"===n.mode?1:0;return new rr.a(e,i,t,0)}function or(e,t,n){var i=Object(j.e)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;var r=sr(e,t,Object(V.q)(n.plane)),a=sr(e,t,n.edgeDirection);if(Object(u.j)(r)||Object(u.j)(a))return null;var o=Object(y.g)(Object(j.e)(),r,a);return Object(V.g)(i,o,Object(V.d)())}function sr(e,t,n){var i=Object(Dt.g)(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),r=Object(j.e)(),a=Object(j.e)();return e.renderCoordsHelper.toRenderCoords(t,r)&&e.renderCoordsHelper.toRenderCoords(i,a)?Object(y.v)(a,r,a):null}var cr=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._vertexManipulatorMaterial=Qn(Pt.colorToVec4(Pt.reshapeManipulators.vertex.color),Pt.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorOutlineMaterial=Jn(Pt.colorToVec4(Pt.reshapeManipulators.vertex.outlineColor),Pt.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorHoverOutlineMaterial=Jn(Pt.colorToVec4(Pt.reshapeManipulators.vertex.hoverOutlineColor),Pt.reshapeManipulators.vertex.renderOccluded),i._edgeManipulatorMaterial=Qn(Pt.colorToVec4(Pt.reshapeManipulators.edge.color),Pt.reshapeManipulators.edge.renderOccluded),i._edgeManipulatorOutlineMaterial=Jn(Pt.colorToVec4(Pt.reshapeManipulators.edge.outlineColor),Pt.reshapeManipulators.edge.renderOccluded),i._edgeOffsetManipulatorMaterial=Qn(Pt.colorToVec4(Pt.reshapeManipulators.edgeOffset.color),Pt.reshapeManipulators.edgeOffset.renderOccluded,!1),i._edgeOffsetManipulatorHoverMaterial=Qn(Pt.colorToVec4(Pt.reshapeManipulators.edgeOffset.hoverColor),Pt.reshapeManipulators.edgeOffset.renderOccluded,!1),i._selectedManipulatorMaterial=Qn(Pt.colorToVec4(Pt.reshapeManipulators.selected.color),Pt.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorOutlineMaterial=Jn(Pt.colorToVec4(Pt.reshapeManipulators.selected.outlineColor),Pt.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorHoverOutlineMaterial=Jn(Pt.colorToVec4(Pt.reshapeManipulators.selected.hoverOutlineColor),Pt.reshapeManipulators.selected.renderOccluded),i._selectedIndex=0,i._vertexManipulatorGeometry=null,i._vertexManipulatorOutlineGeometry=null,i._edgeManipulatorGeometry=null,i._edgeManipulatorOutlineGeometry=null,i._edgeOffsetManipulatorGeometryInside=null,i._edgeOffsetManipulatorGeometryOutside=null,i._manipulatorHandles=new w.a,i._manipulatorInfos=[],i._editGeometryOperations=null,i._graphicMoveManipulation=null,i._moveManipulation=null,i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=0,i._outlineVisualElement=null,i.tool=null,i.outputGeometry=null,i._snappingPipeline=new Yi.a,i._snappingPipelineHandle=new Yi.a,i._vertexLaserLineVisualElement=null,i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this,t=new fn.a({graphic:this.graphic});this._graphicState=t,this.handles.add([t.watch("displaying",(function(t){var n,i=Object(I.a)(e._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){n.value.manipulator.available=t}}catch(r){i.e(r)}finally{i.f()}})),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._editGeometryOperations=Object(u.e)(this._editGeometryOperations),this._moveManipulation=Object(u.e)(this._moveManipulation),this._graphicMoveManipulation=Object(u.e)(this._graphicMoveManipulation),this._manipulatorHandles=Object(u.e)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}},{key:"inputGeometry",get:function(){return Object(u.k)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null},set:function(e){this._recreateEditGeometryAndManipulators(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_removeManipulators",value:function(){this._moveManipulation=Object(u.e)(this._moveManipulation),this._graphicMoveManipulation=Object(u.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}},{key:"_resetGrabbingDragging",value:function(){this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(){if(!Object(u.j)(this._editGeometryOperations)){var e,t=Object(g.e)(this.graphic),n=Object(I.a)(this._editGeometryOperations.data.components);try{for(n.s();!(e=n.n()).done;){var i,r=e.value,a=Object(I.a)(r.vertices);try{for(a.s();!(i=a.n()).done;){var o=i.value;this._createVertexOrEdgeManipulator(o,t)}}catch(h){a.e(h)}finally{a.f()}var s,c=Object(I.a)(r.edges);try{for(c.s();!(s=c.n()).done;){var l=s.value;this._createVertexOrEdgeManipulator(l,t)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){n.e(h)}finally{n.f()}this._createGraphicMoveManipulators(t)}}},{key:"canRedo",get:function(){return Object(u.k)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return Object(u.k)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}},{key:"redo",value:function(){if(Object(u.j)(this._editGeometryOperations))return null;var e=this._editGeometryOperations.redo();return Object(u.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"undo",value:function(){if(Object(u.j)(this._editGeometryOperations))return null;this.emit("undo");var e=this._editGeometryOperations.undo();return Object(u.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"_recreateManipulators",value:function(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}},{key:"_recreateEditGeometryAndManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._removeManipulators(),this._resetGrabbingDragging(),Object(u.j)(e)||(Object(u.e)(this._editGeometryOperations),this._editGeometryOperations=Zi.a.fromGeometry(e,this.view.state.viewingMode),this._createManipulators())}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var n,i=0,r=[],a=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),o=1===e&&a,s=Object(I.a)(this._manipulatorInfos);try{for(s.s();!(n=s.n()).done;){var c=n.value;ur(c)&&(c.manipulator.grabbing||o&&!c.manipulator.selected||r.push(c),i++)}}catch(l){s.e(l)}finally{s.f()}if(0!==r.length)if(this._moveVertices(r,t),r.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_isMultiVertexSelection",value:function(){var e,t=0,n=Object(I.a)(this._manipulatorInfos);try{for(n.s();!(e=n.n()).done;){var i=e.value;ur(i)&&i.manipulator.selected&&t++}}catch(r){n.e(r)}finally{n.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,n=e.mapDeltaY,i=e.mapDeltaZ;if(t||n||i){var r,a=[],o=Object(I.a)(this._manipulatorInfos);try{for(o.s();!(r=o.n()).done;){var s=r.value;ur(s)&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&a.push(s)}}catch(c){o.e(c)}finally{o.f()}this._moveVertices(a,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;if(this._graphicMoveManipulation=new qi({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){var n=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,i,r){i.next((function(e){return t._trackNumDragging(e)})).next((function(e){return"start"===e.action&&(n=Object(u.s)(t._editGeometryOperations).createUndoGroup()),e})).next((function(e){t._perGraphicManipulatorDragAction(0,e),"end"===e.action&&(n=Object(u.r)(n))})),r.next(t._cancelDragOperation((function(){return n=Object(u.r)(n)})))})))}else this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:t.graphic})),e.stopPropagation()}))])})),this._moveManipulation=new Ui({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&ni(this.graphic),snapToScene:!1,radius:Ui.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t.handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(n){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",Object(i.a)(Object(i.a)({},n),{},{graphic:t.graphic})),n.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var r=Object(u.s)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline((function(n,r,a,o,s){var c=a.next((function(e){return t._trackNumDragging(e)})).next((function(e){var n=t._manipulatorInfos.filter((function(e){return ur(e)&&e.manipulator.selected}));return 1===e.manipulatorType&&1===n.length?Object(i.a)(Object(i.a)({},e),{},{info:n[0],snapOrigin:n[0].handle.pos}):Object(i.a)(Object(i.a)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:o,snappingManager:t.tool.snappingManager,snappingContext:new Xi.a({editGeometryOperations:Object(u.s)(t._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:t.graphic,visualizer:new st}),updatingHandles:t.updatingHandles}),t._snappingPipelineHandle.next).next(Object(ji.b)()).next((function(e){return t._perGraphicManipulatorDragAction(1,e),e}));return o.next(t._cancelDragOperation()),c}),e,r,this.graphic),Object(h.a)(this._graphicState,"displaying",(function(){t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()})),Object(h.a)(this._graphicState,"isDraped",(function(){var e="align-move-manipulation";t._graphicState.isDraped?t.handles.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),e):t.handles.remove(e)}))]),this._updateMoveManipulationPosition();var a=di({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){Object(u.k)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var n,i=Object(I.a)(t._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){e(n.value.manipulator,1)}}catch(r){i.e(r)}finally{i.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});Object(u.k)(a)&&(this._outlineVisualElement=a.visualElement instanceof Lt?a.visualElement:null),Object(u.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(a)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.e)(this.graphic),r=Pt.reshapeManipulators.edgeOffset,a=r.size/2,o=a+r.collisionPadding;if(Object(u.j)(this._edgeOffsetManipulatorGeometryInside)||Object(u.j)(this._edgeOffsetManipulatorGeometryOutside)){var s=a/o,c=s*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=xe.a.createExtrudedTriangle(c,s/2,s/2,r.height,r.offset),this._edgeOffsetManipulatorGeometryOutside=xe.a.createExtrudedTriangle(-c,s/2,s/2,r.height,-r.offset)}var h=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],d=new Cn({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==n.mode||Object(ir.g)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:n,worldOriented:!1,focusMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(j.g)(0,0,1)},collisionPriority:1}),p=new Cn({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),f={manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:p,elevationInfo:n,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(f,r.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(f);var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)})),b=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)}));f.locationUpdateHandle=Object(l.b)([v,b]),this._manipulatorHandles.add(f.locationUpdateHandle,d),this._manipulatorHandles.add([this._watchAndUpdateGrabState(d,!0),this._watchAndUpdateGrabState(p,!0)],d),this._manipulatorHandles.add(Object(ji.e)(d,this._createEdgeOffsetPipeline(f,n)),d),this._manipulatorHandles.add(Object(ji.e)(p,(function(e,i,r,a){if("touch"===a)t._createEdgeOffsetPipeline(f,n)(e,i,r);else if(t.enableMoveGraphic){var o=t.graphic,s=Object(u.k)(o.geometry)?o.geometry.spatialReference:null;i.next((function(e){return t._trackNumDragging(e)})).next(Object(ji.f)(t.view,e.elevationAlignedLocation)).next(ki(t.view,e.elevationAlignedLocation,n,s,o)).next(Object(ji.c)()).next(Object(ji.b)()).next((function(e){return t._perGraphicManipulatorDragAction(0,e)})),r.next(t._cancelDragOperation())}})),d);var m=function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:t.graphic})),e.stopPropagation()};return this._manipulatorHandles.add([d.events.on("immediate-click",m),p.events.on("immediate-click",m)],d),this._manipulatorInfos.push(f),this.manipulators.add(d),this.manipulators.add(p),this.emit("manipulators-changed"),f}},{key:"_autoHideEdgeOffsetManipulator",value:function(e,t){var n=this,i=e.manipulator,r=e.edgeManipulator,a=function(){Object(u.r)(e.visibilityHandle);var a=function(e,t,n){var i=n.projectToRenderScreen(e,Object(Re.d)()),r=n.projectToRenderScreen(t,Object(Re.d)());return Object(u.k)(i)&&Object(u.k)(r)?Object(y.t)(Object(y.j)(i,i,r)):0}(n._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,n.view.state.camera)<t;(!i.focused&&!r.focused||a)&&(i.grabbable=!a,r.grabbable=!a,e.visibilityHandle=Object(l.b)([i.disableDisplay(),{remove:function(){i.grabbable=!0,r.grabbable=n.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),r.events.on("focus-changed",a),{remove:function(){Object(u.r)(e.visibilityHandle),n.manipulators.remove(r)}}],i),a()}},{key:"_updateEdgeOffsetManipulator",value:function(e){this._updateManipulatorPosition(e);var t=Object(u.s)(this._editGeometryOperations).data.coordinateHelper,n=or(this.view,e.manipulator.elevationAlignedLocation,ar(t,e.handle,Object(u.s)(e.manipulator.elevationInfo))),i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,r=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,a=Object(u.k)(n)?function(e,t,n){var i=Object(V.q)(e),r=Object(y.v)(Object(j.e)(),t,n),a=Object(y.g)(Object(j.e)(),r,i),o=Object(y.g)(Object(j.e)(),r,a);return Object(U.e)(r[0],r[1],r[2],0,a[0],a[1],a[2],0,o[0],o[1],o[2],0,0,0,0,1)}(n,i,r):U.a;e.manipulator.modelTransform=a,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=a;var o=Object(y.p)(Object(y.j)(vr,i,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}},{key:"_createEdgeOffsetPipeline",value:function(e,t){var n=this;return function(i,r,a){n._clearSelection();var o=n._initializeEdgeOffset(e,t),s=o.step,c=o.cleanup;r.next((function(e){return n._trackNumDragging(e)})).next(Object(ji.f)(n.view,i.elevationAlignedLocation)).next(s).next(function(e){return xi(e,(function(e){return e.plane}))}(n.view)).next(Ei(n.view,Object(u.s)(n._editGeometryOperations).data.spatialReference)).next(Object(ji.b)()).next(n._applyEdgeOffsetStep(e)).next((function(e){"end"===e.action&&c()})),a.next((function(e){return c(),e})).next(n._cancelDragOperation())}}},{key:"_initializeEdgeOffset",value:function(e,t){var n=this,r=Object(u.s)(this._editGeometryOperations),a=ar(r.data.coordinateHelper,e.handle,t),o=r.createUndoGroup(),s=or(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);var c,h=function(){return new nr.a({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:Object(u.s)(n._editGeometryOperations).data.spatialReference})},d=new Lt({view:this.view,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:Pt.visualElements.lineGraphics.outline.width,color:Pt.colorToVec4(ht.main),attached:!0}),p=function(){n._cleanEdgeOffsetCollapsedEdges(e),c=Object(u.r)(c)},f=this.on("undo",p);return c=Object(l.b)([Object(l.a)(d),this._graphicState.watch("isDraped",(function(e){return d.isDraped=e})),this._graphicState.on("changed",(function(){return d.geometry=h()})),o,f]),{step:function(e){return Object(u.j)(a)||Object(u.j)(s)?(p(),null):Object(i.a)(Object(i.a)({},e),{},{operation:a,plane:s})},cleanup:p}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(n){if(t.destroyed||Object(u.j)(n.operation))return n;t._updateEventState(2);var i=n.mapDeltaX,r=n.mapDeltaY,a=n.mapDeltaZ;return(i||r||a)&&(t._offsetEdge(e,n),t.emit("reshape",{type:"reshape",mover:t.graphic})),n}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,n,i=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,r=e.handle.leftVertex,a=null==(n=e.handle.rightVertex.rightEdge)?void 0:n.rightVertex,o=e.handle.rightVertex,s=Object(u.s)(this._editGeometryOperations).data.coordinateHelper,c=1e-6,l=[];i&&s.distance(i.pos,r.pos)<c&&l.push(this._getManipulatorInfoFromHandle(r)),(s.distance(r.pos,o.pos)<c||a&&s.distance(a.pos,o.pos)<c)&&l.push(this._getManipulatorInfoFromHandle(o)),l.length&&this._removeVertices(l)}},{key:"_computeVertexManipulatorSizeAndOutline",value:function(e){var t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.e)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,n);if(!this.enableMidpoints)return null}if(Object(u.j)(this._vertexManipulatorGeometry)||Object(u.j)(this._vertexManipulatorOutlineGeometry)){var r=this._computeVertexManipulatorSizeAndOutline(Pt.reshapeManipulators.vertex),a=r.size,o=r.outlineSize;this._vertexManipulatorGeometry=xe.a.createSphereGeometry(a,16,16),this._vertexManipulatorOutlineGeometry=xe.a.createSphereGeometry(o,16,16)}if(Object(u.j)(this._edgeManipulatorGeometry)||Object(u.j)(this._edgeManipulatorOutlineGeometry)){var s=this._computeVertexManipulatorSizeAndOutline(Pt.reshapeManipulators.edge),c=s.size,h=s.outlineSize;this._edgeManipulatorGeometry=xe.a.createSphereGeometry(c,16,16),this._edgeManipulatorOutlineGeometry=xe.a.createSphereGeometry(h,16,16)}var d=Object(u.k)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|dr.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|dr.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|dr.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&d.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|dr.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|dr.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|dr.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|dr.Edge});var p=new Cn({view:this.view,renderObjects:d,elevationInfo:n,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(p,e,n);var f="edge"===e.type?{manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:p,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(p),this._updateManipulatorPosition(f),"edge"===f.type){var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)})),b=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)}));f.locationUpdateHandle=Object(l.b)([v,b]),this._manipulatorHandles.add(f.locationUpdateHandle,p)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);var m=Object(ji.e)(p,(function(e,r,a,o){var s=null;r.next((function(e){return t._trackNumDragging(e)})).next((function(e){if("start"===e.action&&(s=Object(u.s)(t._editGeometryOperations).createUndoGroup()),hr(f)){var n=t._splitEdgeManipulator(f);return Object(i.a)(Object(i.a)({},e),{},{info:n,snapOrigin:n.handle.pos})}return Object(i.a)(Object(i.a)({},e),{},{info:f,snapOrigin:f.handle.pos})})).next(Object(ji.f)(t.view,e.elevationAlignedLocation)).next(Si(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t._isMultiVertexSelection()},cancel:a,snappingManager:t.tool.snappingManager,snappingContext:new Xi.a({editGeometryOperations:Object(u.s)(t._editGeometryOperations),elevationInfo:n,pointer:o,excludeFeature:t.graphic,visualizer:new st}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next(Object(ji.b)()).next((function(e){t._perVertexManipulatorDragAction(e),"end"===e.action&&(s=Object(u.r)(s))})),a.next(t._cancelDragOperation((function(){return s=Object(u.r)(s)})))}));return this._manipulatorHandles.add(m,p),this._manipulatorHandles.add([p.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,f)})),p.events.on("select-changed",(function(){f.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()}))],p),this.emit("manipulators-changed"),f}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(e){var t=this;return function(){switch(t._numDragging--,t.undo(),t.outputGeometry=Object(u.k)(t._editGeometryOperations)?t._editGeometryOperations.data.geometry:null,Object(u.k)(t.tool.snappingManager)&&t.tool.snappingManager.doneSnapping(),t._reshapeEventState){case 0:break;case 1:t.emit("move",{type:"move",dx:0,dy:0,mover:t.graphic});break;case 2:t.emit("reshape",{type:"reshape",mover:t.graphic})}e&&e(),t.destroyed||t._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,n){switch(t.type){case"vertex":e.state=dr.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=Pt.reshapeManipulators.vertex.size/2+Pt.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=n,e.interactive=Object(u.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=dr.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=Pt.reshapeManipulators.edge.size/2+Pt.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==n.mode||Object(ir.g)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:n}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var n=this;return e.events.on("grab-changed",(function(i){if("start"===i.action)t&&n._updateSelection(e),n._numGrabbing++;else if(n._numGrabbing--,n._updateEventState(0),n.destroyed)return;n._moveManipulation.interactive=!n._numGrabbing,("touch"!==i.pointerType||n.enableEdgeOffset)&&(n._manipulatorInfos.forEach((function(e){e.manipulator.interactive=!n._numGrabbing&&Object(u.k)(n.graphic.geometry)&&"point"!==n.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!n._numGrabbing)})),Object(u.s)(n._graphicMoveManipulation).forEachManipulator((function(e){return e.interactive=!n._numGrabbing})))}))}},{key:"_clearSelection",value:function(){var e,t=Object(I.a)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.manipulator.grabbing||(n.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,n=Object(I.a)(this._manipulatorInfos);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(r){n.e(r)}finally{n.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=Object(u.s)(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,fr),e.manipulator.grabbing&&Object(u.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var n=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,i=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(Object(u.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var r=n.location,a=i.location,o=r.x+.5*(a.x-r.x),s=r.y+.5*(a.y-r.y),c=r.hasZ&&a.hasZ?0:void 0;e.manipulator.location=Object(Dt.g)(o,s,c,t.data.spatialReference)}else Object(y.i)(vr,n.renderLocation,i.renderLocation,.5),e.manipulator.renderLocation=vr}}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Object(u.s)(this._editGeometryOperations),i=Object(u.s)(n.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var r,a=Object(g.e)(this.graphic);this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(i)):((r=e).handle=i,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a)),i.leftEdge&&this._createVertexOrEdgeManipulator(i.leftEdge),i.rightEdge&&this._createVertexOrEdgeManipulator(i.rightEdge),this.outputGeometry=n.data.geometry,this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);var o=this._updateEventState(2),s=n.data.coordinateHelper.vectorToArray(r.handle.pos),c=n.data.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:c,vertexIndex:Object(u.s)(i.index)}],added:s}),o&&this._updateEventState(0),r}},{key:"_updateMoveManipulationPosition",value:function(){var e,t=this,n=Object(y.w)(vr,0,0,0),i=0,r=!1,a=null,o=null,s=Object(I.a)(this._manipulatorInfos);try{for(s.s();!(e=s.n()).done;){var c=e.value;ur(c)&&(c.manipulator.selected?(i++,Object(y.f)(n,n,c.manipulator.renderLocation),Object(u.j)(a)||c.selectedIndex>a.selectedIndex?(o=a,a=c):(Object(u.j)(o)||c.selectedIndex>o.selectedIndex)&&(o=c)):r=!0)}}catch(b){s.e(b)}finally{s.f()}if(0!==i){var l=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=l,this._moveManipulation.xyAxisManipulation.available=l,this._moveManipulation.zManipulation.available=l&&this.enableZVertex&&ni(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=l&&1!==i}else{var h=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=h,this._moveManipulation.xyAxisManipulation.available=h,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=h,this._moveManipulation.zManipulation.available=h&&this.enableZShape&&ni(this.graphic)}if(0!==i){var d=0;if(Object(u.k)(a)){var p=a.handle.pos,f=Object(u.k)(o)?o.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,v=!Object(u.k)(o)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;f&&v?this._moveManipulation.xyAxisManipulation.available=!1:f?d=lr(f,p):v&&(d=lr(p,v))}this._moveManipulation.angle=d,this._moveManipulation.radius=vi}else this._moveManipulation.angleDeferred=function(){return Ci(Object(u.s)(t.graphic.geometry))},this._moveManipulation.radius=Ui.radiusForSymbol(this.graphic.symbol);0!==i&&r?(Object(y.e)(n,n,1/i),fr.spatialReference=Object(u.s)(this._editGeometryOperations).data.spatialReference,fr.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(n,fr),this._moveManipulation.elevationAlignedLocation=fr):Object(u.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(u.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:ti(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,n=[],i=Object(u.s)(this._editGeometryOperations),r=Object(I.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("vertex"===a.handle.type&&i.canRemoveVertex()){n.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));var o=Object(u.s)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}}}catch(l){r.e(l)}finally{r.f()}if(n.length>0){var s=n.map((function(e){var t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:Object(u.s)(e.index)}}));this.outputGeometry=i.data.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_moveVertices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?0:1,i=Object(u.s)(this._editGeometryOperations);i.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n),this.outputGeometry=i.data.geometry;var r,a=Object(I.a)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;this._updateManipulatorPosition(o)}}catch(s){a.e(s)}finally{a.f()}}},{key:"_offsetEdge",value:function(e,t){if(!Object(u.j)(t.operation)){var n=Object(u.s)(this._editGeometryOperations),i=t.operation.clone();i.distance=t.operation.signedDistanceToPoint(t.mapEnd),n.updateVertices([e.handle.leftVertex,e.handle.rightVertex],i),this.outputGeometry=n.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),hr(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),n}(Tt.a.EventedMixin(yn.a));function lr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function ur(e){return"vertex"===e.handle.type}function hr(e){return"edge"===e.handle.type}Object(c.a)([Object(d.b)({constructOnly:!0})],cr.prototype,"tool",void 0),Object(c.a)([Object(d.b)()],cr.prototype,"inputGeometry",null),Object(c.a)([Object(d.b)()],cr.prototype,"outputGeometry",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],cr.prototype,"updating",null),cr=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],cr);var dr,pr,fr=Object(Dt.g)(0,0,null,null),vr=Object(j.e)();(pr=dr||(dr={})).Vertex=16,pr.Edge=32;var br=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._handles=new w.a,i._reshapeOperation=null,i._internalGeometryUpdate=!1,i.enableZShape=!0,i.enableZVertex=!0,i.enableMoveGraphic=!0,i.enableMidpoints=!0,i.enableEdgeOffset=!1,i.type="reshape-3d",i.snappingManager=null,i.automaticManipulatorSelection=!1,i}return Object(a.a)(n,[{key:"destroy",value:function(){this._handles=Object(u.e)(this._handles),this._reshapeOperation=Object(u.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}},{key:"_updateGeometry",value:function(){var e=Object(tr.a)(this.graphic);this._reshapeOperation.inputGeometry=Object(u.k)(e)?e.clone():null}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(tr.b)(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_updateGeometryInternally",value:function(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}},{key:"_onReshapeGeometryChanged",value:function(){Object(u.j)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new cr({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),this.view.on("pointer-down",["Shift"],(function(e){e.stopPropagation()})),Object(h.a)(this,"graphic",(function(){e._updateGraphic()}),!0)]),this.complete()}},{key:"canUndo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}},{key:"undo",value:function(){Object(u.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(u.k)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"canRedo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}},{key:"redo",value:function(){Object(u.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(u.k)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),n}(Tt.a.EventedMixin(Wi.a));Object(c.a)([Object(d.b)()],br.prototype,"_reshapeOperation",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"view",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],br.prototype,"graphic",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"enableZShape",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"enableZVertex",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"enableMoveGraphic",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"enableMidpoints",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],br.prototype,"enableEdgeOffset",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],br.prototype,"type",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],br.prototype,"snappingManager",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],br.prototype,"updating",null),Object(c.a)([Object(d.b)()],br.prototype,"automaticManipulatorSelection",void 0),br=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],br);var gr,mr,Or=n(88),yr=n(416);(mr=gr||(gr={})).ScaleIn=32,mr.ScaleOut=64,mr.RotateLeft=128,mr.RotateRight=256,mr.Unlocked=1024,mr.DelayedFocused=2048,mr.TouchInput=32768;var jr=function(){function e(t){var n=this;Object(r.a)(this,e),this.mode=null,this._handles=new w.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new Tt.a,this.getFocused=function(){return n.ringManipulator.focused},this.getScale=function(){return Object(u.k)(n._scaleRotateDragData)&&"scale"===n._scaleRotateDragData.mode?n.adapter.scale:1},this.tool=t.tool,this.mode=t.mode,this.adapter=t.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return Object(a.a)(e,[{key:"angle",get:function(){return this.adapter.angle}},{key:"scale",get:function(){return this.adapter.scale}},{key:"location",set:function(e){this.ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this.ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this.ringManipulator.grabbing}},{key:"interactive",set:function(e){this.ringManipulator.interactive=e}},{key:"destroy",value:function(){Object(u.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Object(u.e)(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var n=Object(Or.a)({update:function(n){var i=n.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=Object(i.a)(Object(i.a)({},e),{},{frameTask:n})}},{key:"cancelActiveAnimation",value:function(){Object(u.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Object(u.e)(this._activeAnimation))}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,n=this.tool.graphicState.graphic,i=Object(ji.e)(t,(function(t,i,r){e._scaleRotateDragData=null,e.adapter.restart();var a={mode:"none",origin:Object(j.c)(t.renderLocation),initialAngle:e.adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=a,e.updateDragState();var o=Ne.d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,o),i.next(_i(e.tool.view,Object(V.g)(t.renderLocation,o,Object(V.d)()))).next((function(t){var i=Object(V.q)(t.plane),r=Kn(t.renderStart,t.renderEnd,a.origin,i),o=yr.b.shortestSignedDiff(a.angle,r);a.angleDir=Object(R.d)(a.angleDir+o,-.3,.3),a.angle=r;var s=function(e,t){var n=Object(y.j)(Ne.d.get(),t.renderStart,e.origin),i=Object(y.j)(Ne.d.get(),t.renderEnd,e.origin),r=Object(y.p)(n),a=Object(y.p)(i);return 0===r?0:a/r}(a,t),c=s-e.adapter.scale;if(a.scaleDir=Object(R.d)(a.scaleDir+c,-.2,.2),e.onScaleChanged(),"none"===a.mode){var l=e.mode||function(e,t,n,i){var r=e.renderStart,a=e.renderEnd,o=_r(r,i,Ne.d.get()),s=_r(a,i,Ne.d.get());if(Object(y.l)(o,s)<100)return null;var c=Object(y.j)(Ne.d.get(),r,n),l=Object(y.g)(Ne.d.get(),c,Object(V.q)(t)),u=r,h=Object(y.f)(Ne.d.get(),u,l),d=_r(n,i,Ne.d.get()),p=o,f=_r(h,i,Ne.d.get()),v=Object(y.j)(Ne.d.get(),f,p),b=Object(y.j)(Ne.d.get(),o,d),g=Object(T.g)(p,v),m=Object(T.g)(d,b);return Object(T.d)(g,s)<Object(T.d)(m,s)?"rotate":"scale"}(t,t.plane,a.origin,e.tool.view.state.camera);if(Object(u.k)(l)){switch(l){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:n,angle:0}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:n,xScale:1,yScale:1}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()})}a.mode=l}}switch(a.mode){case"rotate":e.adapter.angle=a.initialAngle+r;break;case"scale":e.adapter.scale=s,e.onScaleChanged()}switch(e.updateDragState(),e.updateManipulatorTransform(),t.action){case"start":case"update":switch(a.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:n,angle:Object(R.n)(a.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:n,xScale:s,yScale:s})}break;case"end":switch(a.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:n,angle:Object(R.n)(a.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:n,xScale:s,yScale:s})}}"end"===t.action&&(e.startAnimation(xr(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),r.next((function(){if(e.adapter.cancel(),Object(u.k)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:n,angle:0});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:n,xScale:1,yScale:1})}e.startAnimation(xr(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var n=0,i=null,r=function(){return!1};return{start:function(){i=e.getFocused,e.getFocused=r,n=0,t()},update:function(e){return n+=e,!i()||n>200?1:0},destroy:function(){e.getFocused=i,t()}}}(e,(function(){return e.updateDelayedFocusedState()}))):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),Object(h.a)(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t}))])}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(gr.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(gr.Unlocked,!(Object(u.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(u.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(gr.ScaleIn|gr.ScaleOut,!1),this.ringManipulator.updateStateEnabled(gr.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(gr.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(gr.RotateLeft|gr.RotateRight,!1),this.ringManipulator.updateStateEnabled(gr.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(gr.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(gr.ScaleIn|gr.ScaleOut|gr.RotateLeft|gr.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=Object(F.j)(Ne.a.get()),t=this.adapter.angle;Object(F.e)(e,e,t,Object(j.g)(0,0,1));var n=this.getScale(),i=Object(F.v)(Ne.a.get(),Object(y.w)(Ne.d.get(),n,n,n)),r=Object(F.j)(Ne.a.get());Object(F.n)(r,i,e),this.ringManipulator.modelTransform=r}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,n){for(var i=[],r=Math.ceil(128*(t-e)/(2*Math.PI)),a=0;a<r+1;a++){var o=e+a*(t-e)/r;i.push(Object(j.g)(n*Math.cos(o),n*Math.sin(o),0))}return i},t=function(t){return e(0,2*Math.PI,t)},n=function(e,t){return xe.a.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},i=t(bi),r=n(i,24),a={left:[],right:[]},o=[],s=0;s<2;s++){var c=s*Math.PI-Math.PI/4,l=Math.PI/2-gi,u=c+l,h=c+Math.PI/2-l,d=e(u,h,190),p=n(d,9);o.push(d),o.push(e(u,h,201)),a.left.push(p),a.right.push(p);for(var f=0;f<2;f++){var v=0===f,b=Object(U.d)();if(v){Object(F.g)(b,b,[1,-1,1]),Object(F.e)(b,b,-u,[0,0,1]);var m=Math.round(.2*(d.length-1));b[12]=d[m][0],b[13]=d[m][1],b[14]=d[m][2]}else{Object(F.e)(b,b,h,[0,0,1]);var O=Math.round(.8*(d.length-1));b[12]=d[O][0],b[13]=d[O][1],b[14]=d[O][2]}var y=xe.a.createExtrudedTriangle(60,0,23,.5);xe.a.transformInPlace(y,b),(v?a.left:a.right).push(y)}}for(var _=[],x=0;x<2;x++){var w=x*Math.PI-Math.PI/4,k=Math.PI/2-mi,S=w+k,M=w+Math.PI/2-k,E=e(S,M,213);_.push(n(E,9))}var P=t(190),T=t(213),D=n(P,9),R=n(T,9),C=t(130),A=t(107),V=n(C,9),z=n(A,9),I=this.createMaterial(),G=this.createMaterial(.66),L=this.createMaterial(.5),H=this.createMaterial(.33),N=[{geometry:r,material:I,stateMask:gr.DelayedFocused},{geometry:r,material:L,stateMask:0}];this.mode&&"scale"!==this.mode||(N=N.concat([{geometry:_,material:I,stateMask:gr.DelayedFocused|gr.Unlocked},{geometry:D,material:G,stateMask:gr.DelayedFocused|gr.ScaleIn},{geometry:R,material:H,stateMask:gr.DelayedFocused|gr.ScaleIn},{geometry:V,material:G,stateMask:gr.DelayedFocused|gr.ScaleOut},{geometry:z,material:H,stateMask:gr.DelayedFocused|gr.ScaleOut}])),this.mode&&"rotate"!==this.mode||(N=N.concat([{geometry:a.right,material:I,stateMask:gr.DelayedFocused|gr.Unlocked},{geometry:a.left,material:I,stateMask:gr.DelayedFocused|gr.RotateLeft},{geometry:a.right,material:I,stateMask:gr.DelayedFocused|gr.RotateRight}]));var q=[i].concat(o);return new Cn({view:this.tool.view,renderObjects:N,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(g.e)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:q,direction:Object(j.g)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat(Object(et.a)(pi),[e]);return new nt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function _r(e,t,n){return t.projectToScreen(e,wr),Object(y.w)(n,wr[0],wr[1],0)}function xr(e,t){var n=null,i=1,r=function(){return i};return{start:function(){i=e.getScale(),n=e.getScale,e.getScale=r,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?1:0},destroy:function(){e.getScale=n,t()}}}var wr=Object(Re.f)(),kr=n(129),Sr=n(737);function Mr(e){return Object(u.k)(e.geometry)&&"mesh"===e.geometry.type?function(e){return Object(u.k)(e.transform)?function(e,t){var n=t.clone(),i=null;return{undo:function(t){i=Object(u.k)(e.transform)?e.transform.clone():null,e.transform=n,t.notifyGeometryChanged()},redo:function(t){n=Object(u.k)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()}}}(e,e.transform):function(e){var t,n=e.vertexAttributes.clonePositional();return{undo:function(i){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n,i.notifyGeometryChanged()},redo:function(i){n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,i.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){var t=e.geometry,n=u.o;return{undo:function(e){n=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=n}}}(e)}var Er=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).angle=0,i.scale=1,i.initialAngle=0,i.previousAngle=0,i.previousScale=1,i}return Object(a.a)(n,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Pr);var t=this.geometry.transform;if(this.scale=1,Object(u.k)(t)){var n=Object(Sr.c)(t.rotation)[2];Math.abs(n)>.999999&&(this.angle=Object(R.f)(Object(Sr.a)(t.rotation))*Math.sign(n))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(kr.b)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.update(t)})),Pr)}},{key:"cancel",value:function(){this.scale=1,this.angle=this.initialAngle}},{key:"createUndoRecord",value:function(){return Mr(this.graphic)}},{key:"update",value:function(e){var t=e.scale,n=e.angle,i=this.geometry.anchor,r=1===this.viewingMode;t!==this.previousScale&&(this.geometry.scale(t/this.previousScale,{origin:i,geographic:r}),this.previousScale=t,this.graphic.notifyGeometryChanged()),n!==this.previousAngle&&(this.geometry.rotate(0,0,Object(R.n)(n-this.previousAngle),{origin:i,geographic:r}),this.previousAngle=n,this.graphic.notifyGeometryChanged())}}]),n}(yn.a);Object(c.a)([Object(d.b)({constructOnly:!0})],Er.prototype,"graphic",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],Er.prototype,"geometry",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],Er.prototype,"viewingMode",void 0),Object(c.a)([Object(d.b)()],Er.prototype,"angle",void 0),Object(c.a)([Object(d.b)()],Er.prototype,"scale",void 0),Er=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Er);var Pr="scale-heading-update-key",Tr=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).angle=0,i.scale=1,i.symbol=null,i.initialAngle=0,i}return Object(a.a)(n,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Dr);var t=Object(u.k)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:u.o;if(this.symbol=Object(u.k)(t)?t.clone():null,this.initialSizes=[],Object(u.k)(t)){var n=this.findLayerView();Object(u.k)(n)&&(this.initialSizes=t.symbolLayers.map((function(e){return"object"===e.type?n.getSymbolLayerSize(t,e):null})).toArray())}this.angle=0,Object(u.k)(t)&&t.symbolLayers.some((function(t){return!("object"!==t.type||!Object(u.k)(t.heading))&&(e.angle=-Object(R.f)(t.heading),!0)})),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(kr.b)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.updateSymbol(t)})),Dr)}},{key:"cancel",value:function(){this.graphic.symbol=this.symbol}},{key:"createUndoRecord",value:function(){var e=this,t=this.graphic.symbol,n=null;return{undo:function(i){n=i.symbol,i.symbol=t,e.restart()},redo:function(i){t=i.symbol,i.symbol=n,e.restart()}}}},{key:"updateSymbol",value:function(e){var t=this,n=e.scale,i=e.angle,r=this.graphic.symbol;if(!Object(u.j)(this.symbol)&&!Object(u.j)(r)&&"point-3d"===r.type){var a=r.clone(),o=-Object(R.n)(i-this.initialAngle),s=!1;this.forEachObjectSymbolLayerPair(this.symbol,a,(function(e,i,r){var a=Object(u.t)(e.heading,0)+o;i.heading!==a&&(i.heading=a,s=!0);var c=t.initialSizes[r];if(Object(u.k)(c)&&"width"in c){c.width=t.sizeFilter(c.width),c.height=t.sizeFilter(c.height),c.depth=t.sizeFilter(c.depth);var l=c.width*n;i.width!==l&&(i.width=l,s=!0);var h=c.depth*n;i.depth!==h&&(i.depth=h,s=!0);var d=c.height*n;i.height!==d&&(i.height=d,s=!0)}})),s&&(this.graphic.symbol=a)}}},{key:"forEachObjectSymbolLayerPair",value:function(e,t,n){e.symbolLayers.forEach((function(e,i){var r=t.symbolLayers.getItemAt(i);"object"===e.type&&"object"===r.type&&n(e,r,i)}))}}]),n}(yn.a);Object(c.a)([Object(d.b)()],Tr.prototype,"angle",void 0),Object(c.a)([Object(d.b)()],Tr.prototype,"scale",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],Tr.prototype,"graphic",void 0),Object(c.a)([Object(d.b)()],Tr.prototype,"symbol",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],Tr.prototype,"findLayerView",void 0),Object(c.a)([Object(d.b)({constructOnly:!0})],Tr.prototype,"sizeFilter",void 0),Tr=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Tr);var Dr="scale-heading-update-key",Rr=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.type="transform-3d",i.scaleRotate=null,i.snappingPipeline=new Yi.a,i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this;this.graphicState=new fn.a({graphic:this.graphic}),this.moveManipulation=new Ui({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&ni(this.graphic),radius:Ui.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(t){e.emit("immediate-click",Object(i.a)(Object(i.a)({},t),{},{graphic:e.graphicState.graphic})),t.stopPropagation()})))})),this.moveManipulation.elevationInfo=Object(g.e)(this.graphic);var t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((function(n,i,r,a,o){return Object(u.k)(t)&&0===n&&(r=r.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Xi.a({elevationInfo:Object(g.e)(e.graphic),pointer:o,editGeometryOperations:Zi.a.fromGeometry(new Rn.a({spatialReference:t.spatialReference}),e.view.state.viewingMode),visualizer:new st,excludeFeature:e.graphic}),snappingManager:e.snappingManager,updatingHandles:e.updatingHandles,cancel:a}),e.snappingPipeline.next)),r}),this.graphicState,(function(t){var n=t.action,i={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(n){case"start":e.emit("graphic-translate-start",i),e.emit("record-undo",{record:e.createGeometryUndoRecord()});break;case"update":e.emit("graphic-translate",i);break;case"end":e.emit("graphic-translate-stop",i)}})),this.moveManipulation.angle=Object(u.k)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(function(){return e.updateMoveAngle()}))),this.enableScaling||this.enableRotation){var n=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new jr({tool:this,mode:n,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))}this.handles.add([di({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(l.c)()}}),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((function(t){t instanceof Cn&&e.handles.add(t.events.on("grab-changed",(function(){return e.updateManipulatorsInteractive()})))})),this.complete()}},{key:"updateManipulatorsInteractive",value:function(){Object(u.j)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}},{key:"createScaleRotateAdapter",value:function(){var e=this;return Object(u.k)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Er({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Tr({graphic:this.graphic,sizeFilter:function(t){return e.enforceNonZeroSize(t)},findLayerView:function(){return e.view.allLayerViews.find((function(t){return t.layer===e.graphic.layer}))}})}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),Object(u.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&ni(e.graphic)}))}},{key:"createGeometryUndoRecord",value:function(){return Mr(this.graphic)}},{key:"destroy",value:function(){this.moveManipulation.destroy(),this.scaleRotate=Object(u.e)(this.scaleRotate),this.scaleRotateAdapter=Object(u.e)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(e){this.moveManipulation.location=e,Object(u.k)(this.scaleRotate)&&(this.scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this.moveManipulation.elevationAlignedLocation=e,Object(u.k)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){Object(u.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){Object(u.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!Object(u.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){2===this.view.state.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}},{key:"onGeometryChanged",value:function(){ti(this.view,this,this.graphic)}},{key:"enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(u.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),n}(Object(yn.b)(Tt.a.EventedMixin(Wi.a)));Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Rr.prototype,"view",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Rr.prototype,"graphic",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Rr.prototype,"enableZ",void 0),Object(c.a)([Object(d.b)()],Rr.prototype,"enableRotation",void 0),Object(c.a)([Object(d.b)()],Rr.prototype,"enableScaling",void 0),Object(c.a)([Object(d.b)({value:!1})],Rr.prototype,"snapToScene",null),Object(c.a)([Object(d.b)({constructOnly:!0})],Rr.prototype,"snappingManager",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],Rr.prototype,"type",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],Rr.prototype,"updating",null),Rr=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Rr);var Cr=n(51),Ar=n(749),Vr=(n(23),n(667)),zr=(Object(p.a)("mac"),Math.cos(Object(R.f)(45)),Math.cos(Object(R.f)(5)),[1,.5,0]),Ir=([].concat(zr,[.7]),[].concat(zr,[.5]),[].concat(zr,[1])),Gr=[1,1,1,1],Lr=[1,.8,.6,1],Fr=[1,.93,.86,1],Ur=[].concat(zr,[1]),Hr=[].concat(zr,[1]),Nr=40,qr=(Object(U.d)(),n(865)),Br=n(728),Wr=n(927),Zr=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get().build();return new B.a(e.rctx,t,oe.a)}},{key:"bindPass",value:function(e,t){Object(Jt.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}},{key:"bindDraw",value:function(e){Object(Jt.d)(this.program,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){return Object(Z.f)({blending:Object(Z.g)(1,1,771,771),depthTest:{func:513},colorWrite:Z.c})}}]),n}(N.a);Zr.shader=new H.a(Wr.a,(function(){return n.e(213).then(n.bind(null,1111))}));Wt.a;var Xr=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._technique=new Zr(i._techniqueRep.constructionContext,null),i.updateParameters(),i}return Object(a.a)(n,[{key:"updateParameters",value:function(){}},{key:"beginSlot",value:function(e){return 8===e}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e)}}]),n}(Bt.a);Object(c.a)([Object(qr.c)()],Xr.prototype,"_technique",void 0);var Yr=Object(i.a)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},Wt.b),Qr=n(820),Jr=n(700),Kr=n(928),$r=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new B.a(e.rctx,r,oe.a)}},{key:"bindPass",value:function(e,t){Object(Jt.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Qt.a)(this.program,t))}},{key:"bindDraw",value:function(e){Object(Jt.d)(this.program,e),Object(Yt.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var n=this.configuration,i=3===e,r=2===e;return Object(Z.f)({blending:0!==n.output&&7!==n.output||!n.transparent?null:i?ea:Object(Kt.a)(e),culling:Object(Z.b)(n.cullFace),depthTest:{func:Object(Kt.b)(e)},depthWrite:i?n.writeDepth&&Z.d:Object(Kt.c)(e),colorWrite:Z.c,stencilWrite:n.sceneHasOcludees?Jr.h:null,stencilTest:n.sceneHasOcludees?t?Jr.d:Jr.c:null,polygonOffset:i||r?null:Object(Kt.h)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(N.a);$r.shader=new H.a(Kr.a,(function(){return n.e(204).then(n.bind(null,1112))}));var ea=Object(Z.h)(1,771),ta=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(q.a);Object(c.a)([Object(q.b)({count:8})],ta.prototype,"output",void 0),Object(c.a)([Object(q.b)({count:3})],ta.prototype,"cullFace",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"slicePlaneEnabled",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"transparent",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"enableOffset",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"writeDepth",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"sceneHasOcludees",void 0),Object(c.a)([Object(q.b)({count:4})],ta.prototype,"transparencyPassType",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"multipassTerrainEnabled",void 0),Object(c.a)([Object(q.b)()],ta.prototype,"cullAboveGround",void 0);var na,ia=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,aa)).supportsEdges=!0,i.techniqueConfig=new ta,i}return Object(a.a)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<Kt.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,n,i,r,a,o){Object(ae.f)(e,t,i,r,a,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new ra(e):void 0}},{key:"createBufferWriter",value:function(){return new Br.a(Br.d)}}]),n}(Wt.a),ra=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,Object(i.a)(Object(i.a)({},e),e.material.params))).updateParameters(),a}return Object(a.a)(n,[{key:"updateParameters",value:function(e){var t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire($r,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),n}(Qr.a),aa=Object(i.a)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},Wt.b),oa=n(892),sa=n(20),ca=n(19),la=n(43),ua=n(889),ha=na=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).type="plane",i.position=null,i.heading=0,i.tilt=0,i.width=10,i.height=10,i}return Object(a.a)(n,[{key:"clone",value:function(){return new na({position:Object(ca.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(u.k)(this.position)&&Object(u.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}}]),n}(sa.a);Object(c.a)([Object(d.b)({readOnly:!0,json:{read:!1,write:!0}})],ha.prototype,"type",void 0),Object(c.a)([Object(d.b)({type:Rn.a}),Object(ua.a)()],ha.prototype,"position",void 0),Object(c.a)([Object(d.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ua.a)(),Object(la.a)((function(e){return yr.a.normalize(Object(f.i)(e),0,!0)}))],ha.prototype,"heading",void 0),Object(c.a)([Object(d.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ua.a)(),Object(la.a)((function(e){return yr.a.normalize(Object(f.i)(e),0,!0)}))],ha.prototype,"tilt",void 0),Object(c.a)([Object(d.b)({type:Number,nonNullable:!0}),Object(ua.a)()],ha.prototype,"width",void 0),Object(c.a)([Object(d.b)({type:Number,nonNullable:!0}),Object(ua.a)()],ha.prototype,"height",void 0);ha=na=Object(c.a)([Object(b.a)("esri.widgets.Slice.SlicePlane")],ha),v.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function da(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(y.f)(Ne.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(y.f)(Ne.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(y.j)(Ne.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(y.j)(Ne.d.get(),e.origin,e.basis2),edge:t}}}function pa(e){var t=Object(y.p)(e.basis1),n=Object(y.p)(e.basis2);return.3*Math.min(t,n)}function fa(e){return pa(e)}function va(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ba(e,t){var n=va(t),i=n?[Object(j.g)(1,0,0),Object(j.g)(0,0,0),Object(j.g)(0,1,0)]:[Object(j.g)(1,0,0),Object(j.g)(-1,0,0)],r=xe.a.createPolylineGeometry(i),a=[].concat(Object(et.a)(zr),[1]),o=n?4:1,s=2*o,c=function(e){return e>1?function(e){return new we.a({color:a,width:e,renderOccluded:4})}(e):new oa.a({color:a,renderOccluded:4})},l=[{geometry:r,material:c(o),stateMask:1|wa},{geometry:r,material:c(s),stateMask:2|wa},{geometry:r,material:c(1),stateMask:ka}],u=new Cn({view:e,renderObjects:l,collisionType:{type:"line",paths:[i]},autoScaleRenderObjects:!1,worldSized:!0,radius:n?6:4,idHint:n?1:2});return u.state=wa,u}function ga(e,t,n){var i=function(i){var r=(i?t:e).slice(0),a=Object(y.j)(Ne.d.get(),r[0],r[1]);Object(y.r)(a,a);var o=Object(y.j)(Ne.d.get(),r[r.length-1],r[r.length-2]);if(Object(y.r)(o,o),n.padding>0){var s=Object(y.e)(Object(j.e)(),o,-n.padding);if(r[r.length-1]=Object(y.f)(s,s,r[r.length-1]),n.bothEnds){var c=Object(y.e)(Object(j.e)(),a,-n.padding);r[0]=Object(y.f)(c,c,r[0])}}var l=i?n.tipFocusMultiplier:1,h=n.tipLength*(n.focusTipLength?l:1),d=n.tipRadius*l,p=Object(F.j)(Ne.a.get());if(n.padding>0){var f=h/4,v=Object(y.w)(Ne.d.get(),0,f,0),b=1+n.padding/f;Object(F.t)(p,p,v),Object(F.g)(p,p,Object(y.w)(Ne.d.get(),b,b,b)),Object(F.t)(p,p,Object(y.e)(v,v,-1/b))}var g=Object(F.j)(Object(U.d)()),m=Object(j.g)(0,1,0),O=Object(F.w)(Object(U.d)(),Object(Vr.g)(Ne.b.get(),m,o));O[12]=r[r.length-1][0],O[13]=r[r.length-1][1],O[14]=r[r.length-1][2],Object(F.n)(O,O,p);var _,x,w=[{part:"tube",geometry:ma(n.tubeRadius*(i?n.tubeFocusMultiplier:1)+n.padding,n.flat,r),transform:g}];if(Object(u.k)(n.flat)?_=xe.a.createExtrudedTriangle(h,d,d,n.flat.thickness):(_=xe.a.createConeGeometry(h,d,24,!1,!1,!0),x=xe.a.createConeGeometry(h,d,24,!1,!0,!1)),w.push({part:"tip",geometry:_,transform:O}),x&&w.push({part:"cap",geometry:x,transform:O}),n.bothEnds){var k=Object(F.w)(Object(U.d)(),Object(Vr.g)(Ne.b.get(),m,a));k[12]=r[0][0],k[13]=r[0][1],k[14]=r[0][2],Object(F.n)(k,k,p),w.push({part:"tip",geometry:_,transform:k}),x&&w.push({part:"cap",geometry:x,transform:k})}return w};return{normal:i(!1),focused:i(!0)}}function ma(e,t,n){var i=[];if(Object(u.k)(t))i.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var r=0;r<12;r++){var a=r/12*2*Math.PI;i.push([Math.cos(a)*e,Math.sin(a)*e])}return xe.a.createPathExtrusionGeometry(i,n,[],[],!1)}function Oa(e,t){var n=Object(y.j)(Object(j.e)(),e[e.length-1],e[e.length-2]);if(Object(y.r)(n,n),Object(y.e)(n,n,12),Object(y.f)(n,n,e[e.length-1]),t){var i=Object(y.j)(Object(j.e)(),e[0],e[1]);return Object(y.r)(i,i),Object(y.e)(i,i,12),Object(y.f)(i,i,e[0]),[i].concat(Object(et.a)(e),[n])}return[].concat(Object(et.a)(e),[n])}function ya(e,t){return Object(yi.b)(t,e.basis2,e.basis1)+xa}var ja=16,_a=32,xa=(Object(T.c)(),Math.PI/2),wa=16,ka=32,Sa=function(){function e(){Object(r.a)(this,e),this.lastDragEvent=null,this.next=new ji.a,this._enabled=!1}return Object(a.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(u.k)(this.lastDragEvent)){var t=Object(i.a)(Object(i.a)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?Object(i.a)({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=va(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),Ma=n(860),Ea=n(862),Pa=n(863),Ta=n(859);function Da(e,t){return Ca(e,t,!1)}function Ra(e,t){return Ca(e,t,!0)}function Ca(e,t,n){if(e instanceof Ta.a){if(e.operation instanceof Ma.a)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,i=Object(j.g)(n*e.dx,n*e.dy,n*e.dz);Object(y.f)(t.origin,t.origin,i)}(e.operation,t,n),!0;if(e.operation instanceof Ea.a)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;Object(y.d)(t.basis1,t.basis1,j.b,n),Object(y.d)(t.basis2,t.basis2,j.b,n)}(e.operation,t,n),!0;if(e.operation instanceof Pa.a)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?1/e.factor1:e.factor1,r=n?1/e.factor2:e.factor2;Object(y.e)(t.basis1,t.basis1,i),Object(y.e)(t.basis2,t.basis2,r),Object(Ce.p)(t.origin,t.origin,e.origin,e.axis1,i),Object(Ce.p)(t.origin,t.origin,e.origin,e.axis2,r)}(e.operation,t,n),!0}return!1}var Aa=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i._preserveAspectRatio=new Sa,i.grabbing=!1,i.inputState=null,i.type="transform-3d",i.handles=new w.a,i.moveZManipulator=null,i.resizeManipulators=null,i.rotateManipulator=null,i.attachmentOrigin=null,i.outlineVisualElement=null,i.mapBounds=Object(Ar.a)(),i.mapBoundsStart=Object(Ar.a)(),i.displayBounds=Object(Ar.a)(),i.displayBoundsStart=Object(Ar.a)(),i.displayBoundsMarginStart=0,i.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this;this.graphicState=new fn.a({graphic:this.graphic});var t=this.graphic.geometry;this.editGeometryOperations=Zi.a.fromGeometry(t,this.view.state.viewingMode),this.graphicMoveManipulation=new qi({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?Nr:0,n=[Object(j.g)(t,0,-24),Object(j.g)(t,0,24)],i=Oa(n,!0),r=function(e,t){return ga(n,n,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},a=r(0,!1),o=r(2.25,!0),s=new nt.a({color:Gr,cullFace:2,renderOccluded:16}),c=new nt.a({color:Lr,cullFace:2,renderOccluded:16}),l=new nt.a({color:Fr,cullFace:2,renderOccluded:16}),u=new nt.a({color:Hr,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),h=xe.a.createPolylineGeometry([[t,0,0],[t-Nr,0,0]]),d=xe.a.createPolylineGeometry([[t,0,0],[t-Nr,0,0]]),p=new oa.a({color:Ur,renderOccluded:4});return new Cn({view:e,renderObjects:[].concat(Object(et.a)(a.normal.map((function(e){var t=e.part,n=e.geometry,i=e.transform;return{geometry:n,material:"tip"===t?s:"cap"===t?c:l,transform:i,stateMask:1|ja}}))),Object(et.a)(o.normal.map((function(e){var t=e.geometry,n=e.transform;return{geometry:t,material:u,transform:n,stateMask:1|ja}}))),[{geometry:h,material:p,stateMask:1|ja|_a}],Object(et.a)(a.focused.map((function(e){var t=e.part,n=e.geometry,i=e.transform;return{geometry:n,material:"tip"===t?s:"cap"===t?c:l,transform:i,stateMask:2|ja}}))),Object(et.a)(o.focused.map((function(e){var t=e.geometry,n=e.transform;return{geometry:t,material:u,transform:n,stateMask:2|ja}}))),[{geometry:d,material:p,stateMask:2|ja|_a}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[i]},collisionPriority:1,radius:11,state:ja})}(this.view,0),this.moveZManipulator.state|=_a,this.handles.add(this.watch("enableZ",(function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)}))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(t){var n=ba(e.view,t);return e.handles.add(e.watch("enableScaling",(function(){return e.updateManipulatorAvailability(n,2)}))),n.events.on("grab-changed",(function(t){return e.onResizeGrab(t)})),e.handles.add(e.createResizeDragPipeline(n,t)),n})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new Xe.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var n=new ia({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),i=40,r=27*1.1,a=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new tt.a([["position",{size:3,data:[i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=xe.a.createPolylineGeometry([[0,0,0],[13,0,0]]),s=xe.a.createPolylineGeometry([[0,0,0],[i-r,0,0]]),c=new oa.a({color:Ir,renderOccluded:4}),l=[{geometry:a(27),material:n,stateMask:1|ja},{geometry:o,material:c,stateMask:1|ja},{geometry:a(r),material:n,stateMask:2|ja},{geometry:s,material:c,stateMask:2|ja}];return new Cn({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},collisionPriority:1,radius:13.5,state:ja})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)}))),this.rotateManipulator.events.on("grab-changed",(function(t){e.onRotateGrab(t)})),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();var n=di({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(l.c)()}});Object(u.k)(n)&&(this.outlineVisualElement=n.visualElement instanceof Lt?n.visualElement:null),Object(u.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e.updateDisplayBounds()}))),this.handles.add(n),this.handles.add([this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.graphicState.watch("displaying",(function(){return e.updateAllManipulatorAvailability()})),Object(h.a)(this.graphicState,"isDraped",(function(){return e.graphicDrapedChanged()})),this.view.trackGraphicState(this.graphicState)]);var r=this.view.pointsOfInterest;r&&this.handles.add(r.centerOnSurfaceFrequent.watch("location",(function(){return e.updateDisplayBounds()})));this.forEachManipulator((function(t){e.handles.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()})))}));this.forEachManipulator((function(t,n){e.handles.add(t.events.on("immediate-click",(function(t){1===n&&e.emit("immediate-click",Object(i.a)(Object(i.a)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))})),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(Va),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){Object(u.k)(e.attachmentOrigin)&&Object(Mn.j)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds()})),Va)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator((function(t,n){return e.updateManipulatorAvailability(t,n)}))}},{key:"updateManipulatorAvailability",value:function(e,t){var n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof Cn){var i=this.graphicState.displaying,r=this.enableZ&&ni(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?wa:ka;break;case 0:e.available=i&&r;break;default:e.available=i}}}},{key:"forEachManipulator",value:function(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((function(t){return e(t,2)})),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds()}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.editGeometryOperations.data,n=t.components[0].edges[0],i=Object(Ce.a)(Ne.c.get(),n.leftVertex.pos,n.rightVertex.pos);Object(Ce.f)(i,i);var r=Object(u.t)(ei(this.view,this.graphic),e.extent.center),a=Ia*this.view.pixelSizeAt(r),o=this.view.spatialReference;o!==e.spatialReference&&(a*=Object(Cr.d)(o)/Object(Cr.d)(e.spatialReference)),function(e,t,n,i){i||(i=Object(Ar.a)());var r=Object(Ce.s)(Ne.c.get(),e[1],-e[0]),a=Object(Ce.s)(Ne.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Object(Ce.s)(Ne.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=Ne.c.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var n=t.pos;Object(Ce.s)(s,Object(Ce.h)(e,n),Object(Ce.h)(r,n)),Object(Ce.v)(a,a,s),Object(Ce.w)(o,o,s)}))}));var c=1e-6,l=Object(Ce.s)(Ne.c.get(),o[0]-a[0]<c?n/2:0,o[1]-a[1]<c?n/2:0);Object(Ce.a)(a,a,l),Object(Ce.i)(o,o,l),Object(Ce.b)(i.basis1,e,(o[0]-a[0])/2),Object(Ce.b)(i.basis2,r,(o[1]-a[1])/2),Object(Ce.s)(i.origin,a[0]*e[0]+a[1]*r[0],a[0]*e[1]+a[1]*r[1]),Object(Ce.i)(i.origin,i.origin,i.basis1),Object(Ce.i)(i.origin,i.origin,i.basis2)}(i,t,a,this.mapBounds)}},{key:"updateDisplayBounds",value:function(){var e=this.graphic.geometry,t=Object(u.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(u.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:ei(this.view,this.graphic);this.attachmentOrigin=Object(u.t)(t,e.extent.center);var n=Object(u.k)(t)?t.z:Object(Be.e)(this.mapBounds.origin,this.view.elevationProvider,We.a.fromElevationInfo(Object(g.e)(this.graphic)),this.view.renderCoordsHelper),i=Object(Ar.b)(this.mapBounds);i.origin[2]=n,function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;r||(r=Object(Ar.a)()),t.toRenderCoords(e.origin,n,r.origin);var a=Ne.d.get();Object(y.f)(a,e.origin,e.basis1),Object(y.f)(a,a,e.basis2),t.toRenderCoords(a,n,a);var o=Ne.d.get();Object(y.f)(o,e.origin,e.basis1),Object(y.j)(o,o,e.basis2),t.toRenderCoords(o,n,o);var s=Ne.d.get();Object(y.j)(s,e.origin,e.basis1),Object(y.j)(s,s,e.basis2),t.toRenderCoords(s,n,s);var c=Ne.d.get();Object(y.j)(c,e.origin,e.basis1),Object(y.f)(c,c,e.basis2),t.toRenderCoords(c,n,c);var l=Object(y.i)(Ne.d.get(),a,o,.5);Object(y.j)(l,l,r.origin);var u=Object(y.i)(Ne.d.get(),s,c,.5);Object(y.j)(u,r.origin,u),Object(y.i)(r.basis1,l,u,.5);var h=Object(y.i)(Ne.d.get(),c,a,.5);Object(y.j)(h,h,r.origin);var d=Object(y.i)(Ne.d.get(),o,s,.5);Object(y.j)(d,r.origin,d),Object(y.i)(r.basis2,h,d,.5);var p=Object(y.g)(Ne.d.get(),r.basis1,r.basis2),f=Object(y.g)(p,p,r.basis1);Object(y.r)(f,f),Object(y.e)(r.basis2,f,Object(y.h)(r.basis2,f)),Object(y.e)(r.basis1,r.basis1,1+i/Object(y.p)(r.basis1)),Object(y.e)(r.basis2,r.basis2,1+i/Object(y.p)(r.basis2)),Object(Ar.j)(r)}(i,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators()}},{key:"displayBoundsMargin",get:function(){var e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return za*this.view.pixelSizeAt(t)}},{key:"createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,n,i){return e.applyGraphicMoveSteps(n,i)}))}},{key:"createMoveZDragPipeline",value:function(){var e=this,t=this.view,n=this.editGeometryOperations.data.spatialReference;return Object(ji.e)(this.moveZManipulator,(function(i,r,a){var o=Object(j.c)(i.renderLocation),s=r.next(Mi(t,o,n)).next(Object(ji.c)());e.applyGraphicMoveSteps(s,a)}))}},{key:"applyGraphicMoveSteps",value:function(e,t){var n=this,i=e.next((function(e){return"start"===e.action&&(n.inputState={type:"move"},Object(Ar.b)(n.mapBounds,n.mapBoundsStart),n.emit("graphic-translate-start",{graphic:n.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next(Object(ji.b)()).next(this.moveDragUpdateGeometry()).next((function(e){var t={graphic:n.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&n.emit("graphic-translate",t);break;case"end":n.inputState=null,n.emit("graphic-translate-stop",t)}return e}));return t.next((function(){Object(u.k)(n.inputState)&&n.emit("graphic-translate-stop",{graphic:n.graphic,dxScreen:0,dyScreen:0}),n.cancel()})),i}},{key:"moveDragUpdateGeometry",value:function(){var e=this;return function(t){if(Object(u.j)(e.inputState)||"move"!==e.inputState.type)return t;var n,i=[],r=Object(I.a)(e.editGeometryOperations.data.components);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push.apply(i,Object(et.a)(a.vertices))}}catch(s){r.e(s)}finally{r.f()}var o="start"===t.action?0:1;return Da(e.editGeometryOperations.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"onResizeGrab",value:function(e){if("start"===e.action){var t=this.calculatePickRay(e.screenPoint);Object(V.m)(this.displayBounds.plane,t,Ne.d.get())&&(Object(Ar.b)(this.displayBounds,this.displayBoundsStart),Object(Ar.b)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}}},{key:"createResizeDragPipeline",value:function(e,t){var n=this;return Object(ji.e)(e,(function(e,r,a){Object(u.j)(n.inputState)||(r.next((function(e){return"start"===e.action&&n.emit("graphic-scale-start",{graphic:n.graphic,xScale:1,yScale:1}),e})).next(_i(n.view,n.displayBoundsStart.plane)).next((function(e){return Object(i.a)(Object(i.a)({},e),{},{handle:t})})).next(n.resizeDragRenderPlaneToFactors()).next(n._preserveAspectRatio.createDragEventPipelineStep(),n._preserveAspectRatio.next).next(n.resizeDragUpdateGeometry()).next((function(e){var t={graphic:n.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":n.emit("graphic-scale",t);break;case"end":n.inputState=null,n.emit("graphic-scale-stop",t)}return e})),a.next((function(){Object(u.k)(n.inputState)&&n.emit("graphic-scale-stop",{graphic:n.graphic,xScale:1,yScale:1}),n.cancel()})))}))}},{key:"resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var n=e.displayBoundsStart,r=t.handle.direction,a=e.displayBoundsMargin,o=e.displayBoundsMarginStart,s=Object(y.k)(Ne.d.get(),n.origin);Object(y.c)(s,s,n.basis1,-r[0]),Object(y.c)(s,s,n.basis2,-r[1]);var c=Object(y.j)(Ne.d.get(),t.renderEnd,s),l=Object(y.j)(Ne.d.get(),t.renderStart,s),u=va(t.handle),h=fa(n),d=fa(e.displayBounds)/h,p=function(e,t){if(0===e)return 1;var n=Object(y.p)(t),i=.5*e*Object(y.h)(t,c)/n,r=i<0?-1:1;u&&(i+=(n-.5*e*Object(y.h)(t,l)/n)*r*d);var s=n<1.5*o?1:Ga;return n=Math.max(n-o,Ga),r>0&&(i-=a),r*Math.max(r*(i/n),s)};return Object(i.a)(Object(i.a)({},t),{},{factor1:p(r[0],n.basis1),factor2:p(r[1],n.basis2)})}}},{key:"resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var n=Object(y.k)(Object(j.e)(),e.mapBoundsStart.origin);Object(y.c)(n,n,e.mapBoundsStart.basis1,-t.handle.direction[0]),Object(y.c)(n,n,e.mapBoundsStart.basis2,-t.handle.direction[1]);var i=Object(Ce.s)(Object(C.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);Object(Ce.f)(i,i);var r,a=[],o=Object(I.a)(e.editGeometryOperations.data.components);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.push.apply(a,Object(et.a)(s.vertices))}}catch(u){o.e(u)}finally{o.f()}var c="start"===t.action?0:1,l=e.editGeometryOperations.scaleVertices(a,n,i,t.factor1,t.factor2,c,1);return Object(Ar.b)(e.mapBoundsStart,e.mapBounds),Da(l,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,n,i){var r=t.worldUpAtPosition(e.origin,Ne.d.get()),a=Ne.d.get();switch(n){case 1:Object(y.k)(a,r);break;case 2:Object(y.k)(a,e.basis1)}return Object(V.g)(e.origin,a,i)}(this.displayBounds,this.view.renderCoordsHelper,1,Object(V.d)()),n=this.calculatePickRay(e.screenPoint);Object(V.m)(t,n,Ne.d.get())&&(Object(Ar.b)(this.displayBounds,this.displayBoundsStart),Object(Ar.b)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"createRotateDragPipeline",value:function(e){var t=this;return Object(ji.e)(e,(function(e,n,i){var r=t.inputState;Object(u.j)(r)||(n.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next(_i(t.view,r.rotatePlane)).next(t.rotateDragRenderPlaneToRotate(r)).next(t.rotateDragUpdateGeometry()).next((function(e){var n={graphic:t.graphic,angle:Object(R.n)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",n);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",n)}return e})),i.next((function(){Object(u.k)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()})))}))}},{key:"rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(n){var r=Object(V.q)(e.rotatePlane),a=Kn(n.renderStart,n.renderEnd,t.displayBounds.origin,r);return Object(i.a)(Object(i.a)({},n),{},{rotateAxis:r,rotateAngle:a})}}},{key:"rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var n,i=Object(y.k)(Object(j.e)(),e.mapBoundsStart.origin),r=[],a=Object(I.a)(e.editGeometryOperations.data.components);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.push.apply(r,Object(et.a)(o.vertices))}}catch(l){a.e(l)}finally{a.f()}var s="start"===t.action?0:1,c=e.editGeometryOperations.rotateVertices(r,i,t.rotateAngle,s,1);return Object(Ar.b)(e.mapBoundsStart,e.mapBounds),Da(c,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"calculatePickRay",value:function(e){var t=Object(T.c)(),n=Object(Re.i)(e);return Pn(this.view.state.camera,n,t),Object(y.r)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return $n(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,Ne.a.get());(function(e,t,n,i){var r=i.worldUpAtPosition(n.origin,Ne.d.get()),a=da(n,0),o=Object(F.j)(Ne.a.get());Object(F.r)(o,o,a.edge*Math.PI/2),Object(F.d)(o,o,-ya(n,r)),Object(F.n)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=a.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(n,i){!function(e,t,n,i){var r=Object(y.p)(i.basis1),a=Object(y.p)(i.basis2),o=pa(i),s=fa(i),c=Object(y.w)(Ne.d.get(),0,0,0);Object(y.f)(c,Object(y.e)(Ne.d.get(),i.basis1,t.direction[0]),Object(y.e)(Ne.d.get(),i.basis2,t.direction[1])),Object(y.f)(c,i.origin,c);var l=0,u=1;if(va(t))1===t.direction[0]&&-1===t.direction[1]?l=xa:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),u=s;else{var h=0!==t.direction[0]?1:2;l=1===h?xa:0,u=(1===h?a:r)-o}var d=Object(F.j)(Ne.a.get());Object(F.r)(d,d,l),Object(F.g)(d,d,Object(y.w)(Ne.d.get(),u,u,u)),Object(F.n)(d,n,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}(n,e.resizeHandles[i],t,e.displayBounds)}))}}},{key:"updateZMoveHandle",value:function(e,t){var n=this.displayBounds,i={basis:n.basis1,direction:-1,position:Object(y.j)(Ne.d.get(),n.origin,n.basis1),edge:2},r=Ne.a.get();Object(F.r)(r,t,i.edge*Math.PI/2),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=i.position}},{key:"cancel",value:function(){var e=this.editGeometryOperations.lastOperation;Object(u.j)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,Ra(e,this.mapBounds),this.updateDisplayBounds(),this.inputState=null)}},{key:"canUndo",get:function(){return this.editGeometryOperations.canUndo}},{key:"undo",value:function(){if(Object(u.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo){var e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,Ra(Object(u.s)(e),this.mapBounds),this.updateDisplayBounds()}}},{key:"canRedo",get:function(){return this.editGeometryOperations.canRedo}},{key:"redo",value:function(){if(this.canRedo){var e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,Da(Object(u.s)(e),this.mapBounds),this.updateDisplayBounds()}}},{key:"test",get:function(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}}]),n}(Tt.a.EventedMixin(Wi.a));Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Aa.prototype,"view",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Aa.prototype,"graphic",void 0),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],Aa.prototype,"enableZ",void 0),Object(c.a)([Object(d.b)()],Aa.prototype,"enableRotation",void 0),Object(c.a)([Object(d.b)()],Aa.prototype,"enableScaling",void 0),Object(c.a)([Object(d.b)()],Aa.prototype,"preserveAspectRatio",null),Object(c.a)([Object(d.b)()],Aa.prototype,"grabbing",void 0),Object(c.a)([Object(d.b)()],Aa.prototype,"inputState",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],Aa.prototype,"type",void 0),Aa=Object(c.a)([Object(b.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Aa);var Va="draped-elevation-changes",za=10,Ia=80,Ga=1e-6},565:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return m})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return _})),n.d(t,"e",(function(){return x})),n.d(t,"f",(function(){return w})),n.d(t,"g",(function(){return k}));var i=n(23),r=n(7),a=n(73);var o=function(e,t,n){return[t,n]},s=function(e,t,n){return[t,n,e[2]]},c=function(e,t,n){return[t,n,e[2],e[3]]};function l(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function u(e,t){var n=e.scale,i=e.translate;return Math.round((t-i[0])/n[0])}function h(e,t){var n=e.scale,i=e.translate;return Math.round((i[1]-t)/n[1])}function d(e,t,n){for(var i,r,a,o,s=[],c=0;c<n.length;c++){var l=n[c];c>0?(a=u(e,l[0]),o=h(e,l[1]),a===i&&o===r||(s.push(t(l,a-i,o-r)),i=a,r=o)):(i=u(e,l[0]),r=h(e,l[1]),s.push(t(l,i,r)))}return s.length>0?s:null}function p(e,t){var n=e.scale,i=e.translate;return t*n[0]+i[0]}function f(e,t){var n=e.scale;return e.translate[1]-t*n[1]}function v(e,t,n){var r=new Array(n.length);if(!n.length)return r;var a=Object(i.a)(e.scale,2),o=a[0],s=a[1],c=p(e,n[0][0]),l=f(e,n[0][1]);r[0]=t(n[0],c,l);for(var u=1;u<n.length;u++){var h=n[u];c+=h[0]*o,l-=h[1]*s,r[u]=t(h,c,l)}return r}function b(e,t,n){for(var i=new Array(n.length),r=0;r<n.length;r++)i[r]=v(e,t,n[r]);return i}function g(e,t,n,i,r){return t.points=function(e,t,n,i){return d(e,n?i?c:s:i?s:o,t)}(e,n.points,i,r),t}function m(e,t,n,i,r){return t.x=u(e,n.x),t.y=h(e,n.y),t!==n&&(i&&(t.z=n.z),r&&(t.m=n.m)),t}function O(e,t,n,i,r){var a=function(e,t,n,i){for(var r=[],a=n?i?c:s:i?s:o,l=0;l<t.length;l++){var u=d(e,a,t[l]);u&&u.length>=3&&r.push(u)}return r.length?r:null}(e,n.rings,i,r);return a?(t.rings=a,t):null}function y(e,t,n,i,r){var a=function(e,t,n,i){for(var r=[],a=n?i?c:s:i?s:o,l=0;l<t.length;l++){var u=d(e,a,t[l]);u&&u.length>=2&&r.push(u)}return r.length?r:null}(e,n.paths,i,r);return a?(t.paths=a,t):null}function j(e,t){return e&&t?Object(a.f)(t)?m(e,{},t,!1,!1):Object(a.h)(t)?y(e,{},t,!1,!1):Object(a.g)(t)?O(e,{},t,!1,!1):Object(a.e)(t)?g(e,{},t,!1,!1):Object(a.d)(t)?function(e,t,n,i,r){return t.xmin=u(e,n.xmin),t.ymin=h(e,n.ymin),t.xmax=u(e,n.xmax),t.ymax=h(e,n.ymax),t!==n&&(i&&(t.zmin=n.zmin,t.zmax=n.zmax),r&&(t.mmin=n.mmin,t.mmax=n.mmax)),t}(e,{},t,!1,!1):null:null}function _(e,t,n,i,a){return Object(r.k)(n)&&(t.points=function(e,t,n,i){return v(e,n?i?c:s:i?s:o,t)}(e,n.points,i,a)),t}function x(e,t,n,i,a){return Object(r.j)(n)||(t.x=p(e,n.x),t.y=f(e,n.y),t!==n&&(i&&(t.z=n.z),a&&(t.m=n.m))),t}function w(e,t,n,i,a){return Object(r.k)(n)&&(t.rings=function(e,t,n,i){return b(e,n?i?c:s:i?s:o,t)}(e,n.rings,i,a)),t}function k(e,t,n,i,a){return Object(r.k)(n)&&(t.paths=function(e,t,n,i){return b(e,n?i?c:s:i?s:o,t)}(e,n.paths,i,a)),t}},596:function(e,t,n){"use strict";n.d(t,"a",(function(){return T})),n.d(t,"b",(function(){return D})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return h})),n.d(t,"i",(function(){return x})),n.d(t,"j",(function(){return w})),n.d(t,"k",(function(){return S})),n.d(t,"l",(function(){return M})),n.d(t,"m",(function(){return k})),n.d(t,"n",(function(){return P})),n.d(t,"o",(function(){return E})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return V})),n.d(t,"r",(function(){return R})),n.d(t,"s",(function(){return j})),n.d(t,"t",(function(){return C})),n.d(t,"u",(function(){return l}));var i=n(65),r=n(7),a=n(58),o=n(79),s=(n(677),n(569));function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return[e[0],e[1],e[2],e[3]]}function l(e,t,n,i){return h(e,t,n,i,s.e.get())}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();return h(e[0],e[1],e[2],e[3],t)}function h(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c();return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function d(e,t,n){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=-(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]),n}function p(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c(),r=n[0]-t[0],a=n[1]-t[1],o=n[2]-t[2],s=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],h=a*u-o*l,d=o*s-r*u,p=r*l-a*s,f=h*h+d*d+p*p,v=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;i[0]=h*v,i[1]=d*v,i[2]=p*v,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2])}function f(e,t,n,i,r){if(e.count<3)return!1;e.getVec(n,b);for(var o=i,s=!1;o<e.count-1&&!s;)e.getVec(o,g),o++,s=!Object(a.o)(b,g);if(!s)return!1;for(o=Math.max(o,r),s=!1;o<e.count&&!s;)e.getVec(o,m),o++,Object(a.j)(O,b,g),Object(a.r)(O,O),Object(a.j)(y,g,m),Object(a.r)(y,y),s=!Object(a.o)(b,m)&&!Object(a.o)(g,m)&&Math.abs(Object(a.h)(O,y))<v;return s?(p(b,g,m,t),!0):(0!==n||1!==i||2!==r)&&f(e,t,0,1,2)}var v=.99619469809,b=Object(o.e)(),g=Object(o.e)(),m=Object(o.e)(),O=Object(o.e)(),y=Object(o.e)();function j(e,t,n){return e!==n&&u(e,n),n[3]=-Object(a.h)(n,t),n}function _(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function x(e,t,n,i){return Object(a.g)(m,t,e),d(n,m,i)}function w(e,t,n,i){return A(e,t,Object(a.j)(s.d.get(),n,t),I,i)}function k(e,t,n){return!!Object(r.k)(t)&&A(e,t.origin,t.direction,G,n)}function S(e,t,n){return A(e,t.origin,t.vector,0,n)}function M(e,t,n){return A(e,t.origin,t.vector,1,n)}function E(e,t){return C(e,t)>=0}function P(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5];return e[0]*(e[0]>0?n:a)+e[1]*(e[1]>0?i:o)+e[2]*(e[2]>0?r:s)+e[3]>=0}function T(e,t){var n=Object(a.h)(e,t.ray.direction),i=-C(e,t.ray.origin);if(i<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return i>0;if((i<0||n<0)&&!(i<0&&n<0))return!0;var r=i/n;return n>0?r<t.c1&&(t.c1=r):r>t.c0&&(t.c0=r),t.c0<=t.c1}function D(e,t){var n=Object(a.h)(e,t.ray.direction),i=-C(e,t.ray.origin);if(n>-1e-6&&n<1e-6)return i>0;var r=i/n;return n>0?r<t.c1&&(t.c1=r):r>t.c0&&(t.c0=r),t.c0<=t.c1}function R(e,t,n){var i=Object(a.e)(s.d.get(),e,-e[3]),r=function(e,t,n){var i=Object(a.e)(s.d.get(),e,Object(a.h)(e,t));return Object(a.j)(n,t,i),n}(e,Object(a.j)(s.d.get(),t,i),s.d.get());return Object(a.f)(n,r,i),n}function C(e,t){return Object(a.h)(e,t)+e[3]}function A(e,t,n,r,o){var s=Object(a.h)(e,n);if(0===s)return!1;var c=-(Object(a.h)(e,t)+e[3])/s;return 1&r&&(c=Object(i.d)(c,0,1)),!(!(4&r)&&c<0||!(8&r)&&c>1)&&(Object(a.f)(o,t,Object(a.e)(o,n,c)),!0)}function V(e){return e}var z=[0,0,1,0],I=12,G=8},611:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return d}));var i=n(13),r=n(2),a=(n(711),n(12),n(7)),o=(n(162),n(236),n(39),n(304)),s=n(139),c=(n(565),n(197),n(214),n(669),function e(t,n,i){Object(r.a)(this,e),this.uid=t,this.geometry=n,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null});function l(e){return Object(a.k)(e.geometry)}var u=function e(){Object(r.a)(this,e),this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null};function h(e,t,n,i){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}function d(e){if(Object(a.j)(e))return 0;switch(e.type){case"point":return 1;case"polyline":var t,n=0,r=Object(i.a)(e.paths);try{for(r.s();!(t=r.n()).done;){n+=t.value.length}}catch(u){r.e(u)}finally{r.f()}return n;case"polygon":var o,s=0,c=Object(i.a)(e.rings);try{for(c.s();!(o=c.n()).done;){s+=o.value.length}}catch(u){c.e(u)}finally{c.f()}return s;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var l=e.vertexAttributes&&e.vertexAttributes.position;return l?l.length/3:0;default:return}}function p(e,t){switch(Object(o.h)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var n=0;n<e.paths.length;n++)Object(o.l)(t,e.paths[n],e.hasZ);break;case"polygon":for(var i=0;i<e.rings.length;i++)Object(o.l)(t,e.rings[i],e.hasZ);break;case"multipoint":Object(o.l)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function f(e,t){switch(Object(s.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var n=0;n<e.paths.length;n++)Object(s.p)(t,e.paths[n]);break;case"polygon":for(var i=0;i<e.rings.length;i++)Object(s.p)(t,e.rings[i]);break;case"multipoint":Object(s.p)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function v(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(o.f)(),Object(s.l)()},616:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i,r,a,o={exports:{}};i=o,r=function(){function e(e,n,r){r=r||2;var a,o,s,l,u,h,d,p=n&&n.length,f=p?n[0]*r:e.length,v=t(e,0,f,r,!0),b=[];if(!v||v.next===v.prev)return b;if(p&&(v=c(e,n,v,r)),e.length>80*r){a=s=e[0],o=l=e[1];for(var g=r;g<f;g+=r)(u=e[g])<a&&(a=u),(h=e[g+1])<o&&(o=h),u>s&&(s=u),h>l&&(l=h);d=0!==(d=Math.max(s-a,l-o))?1/d:0}return i(v,b,r,a,o,d),b}function t(e,t,n,i,r){var a,o;if(r===E(e,t,n,i)>0)for(a=t;a<n;a+=i)o=k(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=k(a,e[a],e[a+1],o);if(o&&O(o,o.next)){var s=o.next;S(o),o=s}return o}function n(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!O(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{var r=i.prev;if(S(i),(i=t=r)===i.next)break;n=!0}}while(n||i!==t);return t}function i(e,t,c,l,u,h,d){if(e){!d&&h&&p(e,l,u,h);for(var f,v,b=e;e.prev!==e.next;)if(f=e.prev,v=e.next,h?a(e,l,u,h):r(e))t.push(f.i/c),t.push(e.i/c),t.push(v.i/c),S(e),e=v.next,b=v.next;else if((e=v)===b){d?1===d?i(e=o(n(e),t,c),t,c,l,u,h,2):2===d&&s(e,t,c,l,u,h):i(n(e),t,c,l,u,h,1);break}}}function r(e){var t=e.prev,n=e,i=e.next;if(m(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(b(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&m(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function a(e,t,n,i){var r=e.prev,a=e,o=e.next;if(m(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,c=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=f(s,c,t,n,i),d=f(l,u,t,n,i),p=e.prevZ,v=e.nextZ;p&&p.z>=h&&v&&v.z<=d;){if(p!==e.prev&&p!==e.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,i){var r=e;do{var a=r.prev,o=r.next.next;!O(a,o)&&y(a,r,r.next,o)&&x(a,o)&&x(o,a)&&(t.push(a.i/i),t.push(r.i/i),t.push(o.i/i),S(r),S(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function s(e,t,r,a,o,s){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&g(c,l)){var u=w(c,l);return c=n(c,c.next),u=n(u,u.next),i(c,t,r,a,o,s),void i(u,t,r,a,o,s)}l=l.next}c=c.next}while(c!==e)}function c(e,i,r,a){var o,s,c,u=[];for(o=0,s=i.length;o<s;o++)(c=t(e,i[o]*a,o<s-1?i[o+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(v(c));for(u.sort(l),o=0;o<u.length;o++)r=n(r=h(u[o],r),r.next);return r}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;for(var t=e;;){var n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function h(e,t){var i=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var c,l=n,u=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&b(a<h?r:o,a,u,h,a<h?o:r,a,i.x,i.y)&&(c=Math.abs(a-i.y)/(r-i.x),x(i,e)&&(c<p||c===p&&(i.x>n.x||i.x===n.x&&d(n,i)))&&(n=i,p=c)),i=i.next}while(i!==l);return n}(e,t);if(!i)return t;var r=w(i,e),a=n(i,i.next),o=u(r);return n(o,o.next),a=u(a),u(t===i?a:t)}function d(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function p(e,t,n,i){var r=e;do{if(null===r.z&&(r.z=f(r.x,r.y,t,n,i)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,p(e,t,n,i);r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,c,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0!==s&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}function f(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function b(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||O(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function O(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){var r=_(m(e,t,n)),a=_(m(e,t,i)),o=_(m(n,i,e)),s=_(m(n,i,t));return r!==a&&o!==s||!(0!==r||!j(e,n,t))||!(0!==a||!j(e,i,t))||!(0!==o||!j(n,e,i))||!(0!==s||!j(n,t,i))}function j(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function x(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function w(e,t){var n=new M(e.i,e.x,e.y),i=new M(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function k(e,t,n,i){var r=new M(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function M(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}return e.deviation=function(e,t,n,i){var r=t&&t.length,a=r?t[0]*n:e.length,o=Math.abs(E(e,0,a,n));if(r)for(var s=0,c=t.length;s<c;s++){var l=t[s]*n,u=s<c-1?t[s+1]*n:e.length;o-=Math.abs(E(e,l,u,n))}var h=0;for(s=0;s<i.length;s+=3){var d=i[s]*n,p=i[s+1]*n,f=i[s+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[r][a][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n},e},void 0!==(a=r())&&(i.exports=a);var s=o.exports},625:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return m}));var i,r,a=n(215),o=n(7),s=n(100),c=n(546),l=n(79),u=n(383),h=n(819),d=n(626),p=n(764);function f(e,t,n,i,r,a,o,s,c,l,h){var d,p,f=y[h.mode],v=0;if(Object(u.l)(e,t,n,i,c.spatialReference,r,s))return f.requiresAlignment(h)?(v=f.applyElevationAlignmentBuffer(i,r,a,o,s,c,l,h),d=a,p=o):(d=i,p=r),Object(u.l)(d,c.spatialReference,p,a,l.spatialReference,o,s)?v:void 0}function v(e,t,n,i,r){var s=(Object(h.a)(e)?e.z:Object(p.c)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":var c=Object(o.t)(Object(p.b)(t,e,"ground"),0);return r&&(r.verticalDistanceToGround=0,r.sampledElevation=c),c;case"relative-to-ground":var l=Object(o.t)(Object(p.b)(t,e,"ground"),0),u=n.geometryZWithOffset(s,i);return r&&(r.verticalDistanceToGround=u,r.sampledElevation=l),u+l;case"relative-to-scene":var d=Object(o.t)(Object(p.b)(t,e,"scene"),0),f=n.geometryZWithOffset(s,i);return r&&(r.verticalDistanceToGround=f,r.sampledElevation=d),f+d;case"absolute-height":var v=n.geometryZWithOffset(s,i);if(r){var b=Object(o.t)(Object(p.b)(t,e,"ground"),0);r.verticalDistanceToGround=v-b,r.sampledElevation=b}return v;default:return Object(a.a)(n.mode),0}}function b(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function O(e,t,n,i,r){var a=v(t,n,r,i,_);Object(d.i)(e,_.verticalDistanceToGround);var o=_.sampledElevation,c=Object(s.f)(j,e.transformation);return x[0]=t.x,x[1]=t.y,x[2]=a,Object(u.c)(t.spatialReference,x,c,i.spatialReference)?e.transformation=c:console.warn("Could not locate symbol object properly, it might be misplaced"),o}(r=i||(i={}))[r.NONE=0]="NONE",r[r.UPDATE=1]="UPDATE",r[r.RECREATE=2]="RECREATE";var y={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,i,r,a,o,s){var c=s.calculateOffsetRenderUnits(o),l=s.featureExpressionInfoContext;t*=3,i*=3;for(var u=0;u<r;++u){var h=e[t+0],d=e[t+1],p=e[t+2];n[i+0]=h,n[i+1]=d,n[i+2]=null==l?p+c:c,t+=3,i+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,a){var s=0,c=a.spatialReference;t*=3,i*=3;for(var l=0;l<r;++l){var u=e[t+0],h=e[t+1],d=e[t+2],p=Object(o.t)(a.getElevation(u,h,d,c,"ground"),0);s+=p,n[i+0]=u,n[i+1]=h,n[i+2]=p,t+=3,i+=3}return s/r},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,a,s,c){var l=0,u=c.calculateOffsetRenderUnits(s),h=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,i*=3;for(var p=0;p<r;++p){var f=e[t+0],v=e[t+1],b=e[t+2],g=Object(o.t)(a.getElevation(f,v,b,d,"ground"),0);l+=g,n[i+0]=f,n[i+1]=v,n[i+2]=null==h?b+g+u:g+u,t+=3,i+=3}return l/r},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,i,r,a,s,c){var l=0,u=c.calculateOffsetRenderUnits(s),h=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,i*=3;for(var p=0;p<r;++p){var f=e[t+0],v=e[t+1],b=e[t+2],g=Object(o.t)(a.getElevation(f,v,b,d,"scene"),0);l+=g,n[i+0]=f,n[i+1]=v,n[i+2]=null==h?b+g+u:g+u,t+=3,i+=3}return l/r},requiresAlignment:function(){return!0}}},j=Object(c.d)(),_={verticalDistanceToGround:0,sampledElevation:0},x=Object(l.e)()},626:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return k})),n.d(t,"d",(function(){return P})),n.d(t,"e",(function(){return _})),n.d(t,"f",(function(){return M})),n.d(t,"g",(function(){return w})),n.d(t,"h",(function(){return T})),n.d(t,"i",(function(){return x})),n.d(t,"j",(function(){return S}));var i=n(13),r=n(65),a=n(7),o=n(100),s=n(546),c=n(60),l=n(79),u=n(406),h=n(557),d=n(383),p=n(304),f=n(139),v=n(410),b=n(177),g=n(611),m=n(725);function O(e,t){if("point"===e.type)return j(e,t,!1);if(Object(m.d)(e))switch(e.type){case"extent":return j(e.center,t,!1);case"polygon":return j(e.centroid,t,!1);case"polyline":return j(y(e),t,!0);case"mesh":return j(e.origin,t,!1)}else switch(e.type){case"extent":return j(function(e){var t=Object(r.h)(e.zmin);return Object(g.g)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return j(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=Object(v.b)(e.rings,e.hasZ);return Object(g.g)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return j(y(e),t,!0)}}function y(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=Object(b.f)(t,Object(b.e)(t)/2);return Object(g.g)(n[0],n[1],n[2],e.spatialReference)}function j(e,t,n){var i=n?e:Object(m.a)(e);return t&&e?Object(d.n)(e,i,t)?i:null:i}function _(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=Object(f.l)());var r=e,a=.5*r.width*(n-1),o=.5*r.height*(n-1);return r.width<1e-7*r.height?a+=o/20:r.height<1e-7*r.width&&(o+=a/20),Object(u.l)(t,r.xmin-a-i,r.ymin-o-i,r.xmax+a+i,r.ymax+o+i),t}return null}function x(e,t){for(var n=0;n<e.geometries.length;++n){var i=e.geometries[n].getMutableAttribute("auxpos1");i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(n))}}function w(e,t){var n=Object(h.f)(h.a);return Object(a.k)(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),Object(a.k)(t)?n[3]=t:Object(a.k)(e)&&e.length>3&&(n[3]=e[3]),n}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=new Array(3);if(Object(a.j)(t)||Object(a.j)(n))r[0]=1,r[1]=1,r[2]=1;else{for(var o,s=0,c=2;c>=0;c--){var u=e[c],h=void 0,d=null!=u,p=0===c&&!o&&!d,f=n[c];"symbol-value"===u||p?h=0!==f?t[c]/f:1:d&&"proportional"!==u&&isFinite(u)&&(h=0!==f?u/f:1),null!=h&&(r[c]=h,o=h,s=Math.max(s,Math.abs(h)))}for(var v=2;v>=0;v--)null==r[v]?r[v]=o:0===r[v]&&(r[v]=.001*s)}for(var b=2;b>=0;b--)r[b]/=i;return Object(l.f)(r)}function S(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),M(e)?null:"Symbol sizes may not be negative values"}function M(e){if(Array.isArray(e)){var t,n=Object(i.a)(e);try{for(n.s();!(t=n.n()).done;){if(!M(t.value))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}return null==e||e>=0}function E(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Object(s.d)(),r=e||0,a=t||0,c=n||0;return 0!==r&&Object(o.r)(i,i,-r/180*Math.PI),0!==a&&Object(o.d)(i,i,a/180*Math.PI),0!==c&&Object(o.k)(i,i,c/180*Math.PI),i}function P(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(p.s)(e)?t.minDemResolutionForPoints:.01*Object(p.t)(e)}var T={"bottom-left":Object(c.e)(0,0),bottom:Object(c.e)(.5,0),"bottom-right":Object(c.e)(1,0),left:Object(c.e)(0,.5),center:Object(c.e)(.5,.5),right:Object(c.e)(1,.5),"top-left":Object(c.e)(0,1),top:Object(c.e)(.5,1),"top-right":Object(c.e)(1,1)}},645:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i,r,a=n(58),o=n(712),s=n(79),c=n(596),l=n(578);(r=i||(i={})).length=function(e,t){var n=e[t],i=e[t+1],r=e[t+2];return Math.sqrt(n*n+i*i+r*r)},r.normalize=function(e,t){var n=e[t],i=e[t+1],r=e[t+2],a=1/Math.sqrt(n*n+i*i+r*r);e[t]*=a,e[t+1]*=a,e[t+2]*=a},r.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},r.add=function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(r=r||e)[a]=e[t]+n[i],r[a+1]=e[t+1]+n[i+1],r[a+2]=e[t+2]+n[i+2]},r.subtract=function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(r=r||e)[a]=e[t]-n[i],r[a+1]=e[t+1]-n[i+1],r[a+2]=e[t+2]-n[i+2]};var u,h,d,p,f=n(661),v=n(660),b=n(566),g=i;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],r=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36),s=0;s<6;s++)for(var c=0;c<6;c++)o[6*s+c]=s;for(var l=new Uint16Array(36),u=0;u<6;u++)l[6*u+0]=0,l[6*u+1]=1,l[6*u+2]=2,l[6*u+3]=2,l[6*u+4]=3,l[6*u+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(24),s=0;s<8;s++)t[3*s]=n[s][0]*e[0],t[3*s+1]=n[s][1]*e[1],t[3*s+2]=n[s][2]*e[2];return new f.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}],["uv0",{size:2,data:r}]],[["position",a],["normal",o],["uv0",l]])}}(u||(u={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],r=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(18),o=0;o<6;o++)t[3*o]=n[o][0]*e[0],t[3*o+1]=n[o][1]*e[1],t[3*o+2]=n[o][2]*e[2];return new f.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}]],[["position",r],["normal",a]])}}(h||(h={})),function(e){var t=.5,n=Object(o.c)(-t,0,-t),i=Object(o.c)(t,0,-t),r=Object(o.c)(0,0,t),s=Object(o.c)(0,.5,0),c=Object(o.b)(),l=Object(o.b)(),u=Object(o.b)(),h=Object(o.b)(),d=Object(o.b)();Object(a.j)(c,n,s),Object(a.j)(l,n,i),Object(a.g)(u,c,l),Object(a.r)(u,u),Object(a.j)(c,i,s),Object(a.j)(l,i,r),Object(a.g)(h,c,l),Object(a.r)(h,h),Object(a.j)(c,r,s),Object(a.j)(l,r,n),Object(a.g)(d,c,l),Object(a.r)(d,d);var p=[n,i,r,s],v=[0,-1,0,u[0],u[1],u[2],h[0],h[1],h[2],d[0],d[1],d[2]],b=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(12),n=0;n<4;n++)t[3*n]=p[n][0]*e[0],t[3*n+1]=p[n][1]*e[1],t[3*n+2]=p[n][2]*e[2];return new f.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:v}]],[["position",new Uint16Array(b)],["normal",new Uint16Array(g)]])}}(d||(d={})),function(e){e.createBoxGeometry=u.createGeometry,e.createDiamondGeometry=h.createGeometry,e.createTetrahedronGeometry=d.createGeometry,e.createSphereGeometry=function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{uv:!0},r=-Math.PI,a=2*Math.PI,o=-Math.PI/2,s=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(n)),u=(c+1)*(l+1),h=new Float32Array(3*u),d=new Float32Array(3*u),p=new Float32Array(2*u),v=[],b=0,g=0;g<=l;g++){for(var m=[],O=g/l,y=o+O*s,j=Math.cos(y),_=0;_<=c;_++){var x=_/c,w=r+x*a,k=Math.cos(w)*j,S=Math.sin(y),M=-Math.sin(w)*j;h[3*b]=k*e,h[3*b+1]=S*e,h[3*b+2]=M*e,d[3*b]=k,d[3*b+1]=S,d[3*b+2]=M,p[2*b]=x,p[2*b+1]=O,m.push(b),++b}v.push(m)}var E=new Uint32Array(2*c*(l-1)*3);b=0;for(var P=0;P<l;P++)for(var T=0;T<c;T++){var D=v[P][T],R=v[P][T+1],C=v[P+1][T+1],A=v[P+1][T];0===P?(E[b++]=D,E[b++]=C,E[b++]=A):P===l-1?(E[b++]=D,E[b++]=R,E[b++]=C):(E[b++]=D,E[b++]=R,E[b++]=C,E[b++]=C,E[b++]=A,E[b++]=D)}var V=[["position",E],["normal",E]],z=[["position",{size:3,data:h,exclusive:!0}],["normal",{size:3,data:d,exclusive:!0}]];return i.uv&&(z.push(["uv0",{size:2,data:p,exclusive:!0}]),V.push(["uv0",E])),i.offset&&(V[0][0]="offset",z[0][0]="offset",V.push(["position",new Uint32Array(E.length)]),z.push(["position",{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new f.a(z,V)},e.createPolySphereGeometry=function(e,t,n){var i,r,a=e;if(n)i=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;i=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],r=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var s=0;s<i.length;s+=3)g.scale(i,s,e/g.length(i,s));var c={};function l(t,n){var r;t>n&&(t=(r=[n,t])[0],n=r[1]);var a=t.toString()+"."+n.toString();if(c[a])return c[a];var o=i.length;return i.length+=3,g.add(i,3*t,i,3*n,i,o),g.scale(i,o,e/g.length(i,o)),o/=3,c[a]=o,o}for(var u=0;u<t;u++){for(var h=r.length,d=new Uint32Array(4*h),p=0;p<h;p+=3){var v=r[p],b=r[p+1],m=r[p+2],O=l(v,b),y=l(b,m),j=l(m,v),_=4*p;d[_]=v,d[_+1]=O,d[_+2]=j,d[_+3]=b,d[_+4]=y,d[_+5]=O,d[_+6]=m,d[_+7]=j,d[_+8]=y,d[_+9]=O,d[_+10]=y,d[_+11]=j}r=d,c={}}for(var x=new Float32Array(i),w=0;w<x.length;w+=3)g.normalize(x,w);var k=[["position",r],["normal",r]],S=[["position",{size:3,data:new Float32Array(i),exclusive:!0}],["normal",{size:3,data:x,exclusive:!0}]];return new f.a(S,k)},e.createPointGeometry=function(e,t,n,i,r,a,o){var s=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];var l=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],u=null!=i&&2===i.length?i:[1,1],h=[["position",{size:3,data:s,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:l,exclusive:!0}],["size",{size:2,data:u}]];if(null!=r){var d=new Float32Array([r[0],r[1],r[2],r[3]]);h.push(["auxpos1",{size:4,data:d}])}if(null!=o){var p=new Float32Array([o[0],o[1],o[2],o[3]]);h.push(["auxpos2",{size:4,data:p}])}return new f.a(h,null,1)},e.updatePointGeometry=function(e,t,n,i,r,a,o,s){if(null!=e){var c=s.getMutableAttribute("normal").data;c[0]=e[0],c[1]=e[1],c[2]=e[2]}if(null!=t){var l=s.getMutableAttribute("position").data;l[0]=t[0],l[1]=t[1],l[2]=t[2]}if(null!=n){var u=s.getMutableAttribute("color").data;u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3]}if(null!=i){var h=s.getMutableAttribute("size").data;h[0]=i[0],h[1]=i[1]}if(null!=r){var d=s.getMutableAttribute("auxpos1").data;d[0]=r[0],d[1]=r[1],d[2]=r[2],d[3]=r[3]}if(null!=a){var p=s.getMutableAttribute("uv0").data;p[0]=a[0],p[1]=a[1]}if(null!=o){var f=s.getMutableAttribute("auxpos2").data;f[0]=o[0],f[1]=o[1],f[2]=o[2],f[3]=o[3]}},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),r=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)n[3*o]=e[o][0],n[3*o+1]=e[o][1],n[3*o+2]=e[o][2],t&&(i[3*o]=t[o][0],i[3*o+1]=t[o][1],i[3*o+2]=t[o][2]),r[o]=o,a[o]=0;return t||(i[0]=0,i[1]=1,i[2]=0),new f.a([["position",{size:3,data:n,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",r],["normal",t?r:a],["uv0",a]],1)},e.createTriangleGeometry=function(){var e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),n=new Uint16Array([0,0,0]);return new f.a([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",n]])};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function n(e,t,n,i,r){return!(Math.abs(Object(a.h)(t,e))>r)&&(Object(a.g)(n,e,t),Object(a.r)(n,n),Object(a.g)(i,n,e),Object(a.r)(i,i),!0)}function i(e,t,i,r,a,o,s){return n(e,t,a,o,s)||n(e,i,a,o,s)||n(e,r,a,o,s)}e.createSquareGeometry=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=new Array(12),i=0;i<4;i++)for(var r=0;r<3;r++)n[3*i+r]=e[i][r];var a=new Uint32Array([0,1,2,2,3,0]),o=[0,0,1],s=new Uint32Array([0,0,0,0,0,0]);return new f.a([["position",{size:3,data:n,exclusive:!0}],["normal",{size:3,data:o,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",a],["normal",s],["uv0",a],["color",s]])},e.createConeGeometry=function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=0,c=t,l=e,u=Object(o.c)(0,s,0),h=Object(o.c)(0,s+l,0),d=Object(o.c)(0,-1,0),p=Object(o.c)(0,1,0);i&&(s=l,h=Object(o.c)(0,0,0),u=Object(o.c)(0,s,0),d=Object(o.c)(0,1,0),p=Object(o.c)(0,-1,0));var v=[h,u],b=[d,p],g=n+2,m=Math.sqrt(l*l+c*c);if(i)for(var O=n-1;O>=0;O--){var y=O*(2*Math.PI/n),j=Object(o.c)(Math.cos(y)*c,s,Math.sin(y)*c);v.push(j);var _=Object(o.c)(l*Math.cos(y)/m,-c/m,l*Math.sin(y)/m);b.push(_)}else for(var x=0;x<n;x++){var w=x*(2*Math.PI/n),k=Object(o.c)(Math.cos(w)*c,s,Math.sin(w)*c);v.push(k);var S=Object(o.c)(l*Math.cos(w)/m,c/m,l*Math.sin(w)/m);b.push(S)}var M=new Uint32Array(2*(n+2)*3),E=new Uint32Array(2*(n+2)*3),P=0,T=0;if(r){for(var D=3;D<v.length;D++)M[P++]=1,M[P++]=D-1,M[P++]=D,E[T++]=0,E[T++]=0,E[T++]=0;M[P++]=v.length-1,M[P++]=2,M[P++]=1,E[T++]=0,E[T++]=0,E[T++]=0}if(a){for(var R=3;R<v.length;R++)M[P++]=R,M[P++]=R-1,M[P++]=0,E[T++]=R,E[T++]=R-1,E[T++]=1;M[P++]=0,M[P++]=2,M[P++]=v.length-1,E[T++]=1,E[T++]=2,E[T++]=b.length-1}for(var C=new Float32Array(3*g),A=0;A<g;A++)C[3*A]=v[A][0],C[3*A+1]=v[A][1],C[3*A+2]=v[A][2];for(var V=new Float32Array(3*g),z=0;z<g;z++)V[3*z]=b[z][0],V[3*z+1]=b[z][1],V[3*z+2]=b[z][2];return new f.a([["position",{size:3,data:C,exclusive:!0}],["normal",{size:3,data:V,exclusive:!0}]],[["position",M],["normal",E]])},e.createCylinderGeometry=function(e,t,n,i,r,s){var c=i?Object(o.a)(i):Object(o.c)(1,0,0),l=r?Object(o.a)(r):Object(o.c)(0,0,0);s=null==s||s;var u=Object(o.b)();Object(a.r)(u,c);var h=Object(o.b)();Object(a.e)(h,u,Math.abs(e));var d=Object(o.b)();Object(a.e)(d,h,-.5),Object(a.f)(d,d,l);var p=Object(o.c)(0,1,0);Math.abs(1-Object(a.h)(u,p))<.2&&Object(a.w)(p,0,0,1);var v=Object(o.b)();Object(a.g)(v,u,p),Object(a.r)(v,v),Object(a.g)(p,v,u);var b=2*n+(s?2:0),g=n+(s?2:0),m=new Float32Array(3*b),O=new Float32Array(3*g),y=new Float32Array(2*b),j=new Uint32Array(3*n*(s?4:2)),_=new Uint32Array(3*n*(s?4:2));s&&(m[3*(b-2)+0]=d[0],m[3*(b-2)+1]=d[1],m[3*(b-2)+2]=d[2],y[2*(b-2)]=0,y[2*(b-2)+1]=0,m[3*(b-1)+0]=m[3*(b-2)+0]+h[0],m[3*(b-1)+1]=m[3*(b-2)+1]+h[1],m[3*(b-1)+2]=m[3*(b-2)+2]+h[2],y[2*(b-1)]=1,y[2*(b-1)+1]=1,O[3*(g-2)+0]=-u[0],O[3*(g-2)+1]=-u[1],O[3*(g-2)+2]=-u[2],O[3*(g-1)+0]=u[0],O[3*(g-1)+1]=u[1],O[3*(g-1)+2]=u[2]);for(var x=function(e,t,n){j[e]=t,_[e]=n},w=0,k=Object(o.b)(),S=Object(o.b)(),M=0;M<n;M++){var E=M*(2*Math.PI/n);Object(a.e)(k,p,Math.sin(E)),Object(a.e)(S,v,Math.cos(E)),Object(a.f)(k,k,S),O[3*M+0]=k[0],O[3*M+1]=k[1],O[3*M+2]=k[2],Object(a.e)(k,k,t),Object(a.f)(k,k,d),m[3*M+0]=k[0],m[3*M+1]=k[1],m[3*M+2]=k[2],y[2*M+0]=M/n,y[2*M+1]=0,m[3*(M+n)+0]=m[3*M+0]+h[0],m[3*(M+n)+1]=m[3*M+1]+h[1],m[3*(M+n)+2]=m[3*M+2]+h[2],y[2*(M+n)+0]=M/n,y[2*M+1]=1;var P=(M+1)%n;x(w++,M,M),x(w++,M+n,M),x(w++,P,P),x(w++,P,P),x(w++,M+n,M),x(w++,P+n,P)}if(s){for(var T=0;T<n;T++){var D=(T+1)%n;x(w++,b-2,g-2),x(w++,T,g-2),x(w++,D,g-2)}for(var R=0;R<n;R++){var C=(R+1)%n;x(w++,R+n,g-1),x(w++,b-1,g-1),x(w++,C+n,g-1)}}return new f.a([["position",{size:3,data:m,exclusive:!0}],["normal",{size:3,data:O,exclusive:!0}],["uv0",{size:2,data:y,exclusive:!0}]],[["position",j],["normal",_],["uv0",j]])},e.createTubeGeometry=function(t,n,i,r,a){i=i||10,r=null==r||r,Object(b.a)(t.length>1);for(var o=[],s=[],c=0;c<i;c++){o.push([0,-c-1,-(c+1)%i-1]);var l=c/i*2*Math.PI;s.push([Math.cos(l)*n,Math.sin(l)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,r,a)},e.createPathExtrusionGeometry=function(e,t,n,r,u){var h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Object(o.c)(0,0,0),d=e.length,p=new Float32Array(t.length*d*3+(6*n.length||0)),v=new Float32Array(t.length*d*3+(n?6:0)),b=(t.length-1)*d*6+3*r.length*2,g=new Uint32Array(b),O=new Uint32Array(b),y=0,j=0,_=0,x=0,w=Object(o.b)(),k=Object(o.b)(),S=Object(o.b)(),M=Object(o.b)(),E=Object(o.b)(),P=Object(o.b)(),T=Object(o.b)(),D=Object(s.e)(),R=Object(o.b)(),C=Object(o.b)(),A=Object(o.b)(),V=Object(o.b)(),z=Object(o.b)(),I=Object(c.d)();Object(a.w)(R,0,1,0),Object(a.j)(k,t[1],t[0]),Object(a.r)(k,k),u?(Object(a.f)(D,t[0],h),Object(a.r)(S,D)):Object(a.w)(S,0,0,1),i(k,S,R,R,E,S,m),Object(a.k)(M,S),Object(a.k)(V,E);for(var G=0;G<n.length;G++)Object(a.e)(P,E,n[G][0]),Object(a.e)(D,S,n[G][2]),Object(a.f)(P,P,D),Object(a.f)(P,P,t[0]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2];v[j++]=-k[0],v[j++]=-k[1],v[j++]=-k[2];for(var L=0;L<r.length;L++)g[_++]=r[L][0]>0?r[L][0]:-r[L][0]-1+n.length,g[_++]=r[L][1]>0?r[L][1]:-r[L][1]-1+n.length,g[_++]=r[L][2]>0?r[L][2]:-r[L][2]-1+n.length,O[x++]=0,O[x++]=0,O[x++]=0;for(var F=n.length,U=n.length-1,H=0;H<t.length;H++){var N=!1;H>0&&(Object(a.k)(w,k),H<t.length-1?(Object(a.j)(k,t[H+1],t[H]),Object(a.r)(k,k)):N=!0,Object(a.f)(C,w,k),Object(a.r)(C,C),Object(a.f)(A,t[H-1],M),Object(c.g)(t[H],C,I),Object(c.m)(I,Object(l.g)(A,w),D)?(Object(a.j)(D,D,t[H]),Object(a.r)(S,D),Object(a.g)(E,C,S),Object(a.r)(E,E)):i(C,M,V,R,E,S,m),Object(a.k)(M,S),Object(a.k)(V,E)),u&&(Object(a.f)(D,t[H],h),Object(a.r)(z,D));for(var q=0;q<d;q++)if(Object(a.e)(P,E,e[q][0]),Object(a.e)(D,S,e[q][1]),Object(a.f)(P,P,D),Object(a.r)(T,P),v[j++]=T[0],v[j++]=T[1],v[j++]=T[2],Object(a.f)(P,P,t[H]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2],!N){var B=(q+1)%d;g[_++]=F+q,g[_++]=F+d+q,g[_++]=F+B,g[_++]=F+B,g[_++]=F+d+q,g[_++]=F+d+B;for(var W=0;W<6;W++)O[x++]=g[_-6+W]-U}F+=d}for(var Z=t[t.length-1],X=0;X<n.length;X++)Object(a.e)(P,E,n[X][0]),Object(a.e)(D,S,n[X][1]),Object(a.f)(P,P,D),Object(a.f)(P,P,Z),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2];var Y=j/3;v[j++]=k[0],v[j++]=k[1],v[j++]=k[2];for(var Q=F-d,J=0;J<r.length;J++)g[_++]=r[J][0]>=0?F+r[J][0]:-r[J][0]-1+Q,g[_++]=r[J][2]>=0?F+r[J][2]:-r[J][2]-1+Q,g[_++]=r[J][1]>=0?F+r[J][1]:-r[J][1]-1+Q,O[x++]=Y,O[x++]=Y,O[x++]=Y;return new f.a([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:v,exclusive:!0}]],[["position",g],["normal",O]])},e.createPolylineGeometry=function(e,t,n){Object(b.a)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(b.a)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(b.a)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(b.a)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var i=new Float64Array(3*e.length),r=new Uint32Array(2*(e.length-1)),a=0,o=0,s=0;s<e.length;s++){for(var c=0;c<3;c++)i[a++]=e[s][c];s>0&&(r[o++]=s-1,r[o++]=s)}var l=[],u=[];if(l.push(["position",r]),u.push(["position",{size:3,data:i,exclusive:!0}]),t){for(var h=new Float32Array(3*t.length),d=0,p=0;p<e.length;p++)for(var g=0;g<3;g++)h[d++]=t[p][g];l.push(["normal",r]),u.push(["normal",{size:3,data:h,exclusive:!0}])}return n&&(u.push(["color",{size:4,data:n}]),l.push(["color",Object(v.d)(n.length/4)])),new f.a(u,l,2)},e.createExtrudedTriangle=function(e,t,n,i){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new Array(18),o=[[-t,r,i/2],[n,r,i/2],[0,e+r,i/2],[-t,r,-i/2],[n,r,-i/2],[0,e+r,-i/2]],s=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),c=0;c<6;c++)a[3*c]=o[c][0],a[3*c+1]=o[c][1],a[3*c+2]=o[c][2];return new f.a([["position",{size:3,data:a,exclusive:!0}]],[["position",s]])},e.transformInPlace=function(e,t){for(var n=e.getMutableAttribute("position").data,i=0;i<n.length;i+=3){var r=n[i],o=n[i+1],s=n[i+2];Object(a.w)(O,r,o,s),Object(a.q)(O,O,t),n[i]=O[0],n[i+1]=O[1],n[i+2]=O[2]}},e.cgToGIS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=e.vertexAttributes,i=n.get("position").data,r=n.get("normal").data;if(r)for(var a=t.getMutableAttribute("normal").data,o=0;o<r.length;o+=3){var s=r[o+1];a[o+1]=-r[o+2],a[o+2]=s}if(i)for(var c=t.getMutableAttribute("position").data,l=0;l<i.length;l+=3){var u=i[l+1];c[l+1]=-i[l+2],c[l+2]=u}return t},e.makeOrthoBasisDirUp=n,e.makeOrthoBasisDirUpFallback=i}(p||(p={}));var m=.99619469809,O=Object(o.b)(),y=p},652:function(e,t,n){"use strict";n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return _})),n.d(t,"c",(function(){return x})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return w})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return y})),n.d(t,"j",(function(){return j}));var i=n(2),r=n(3),a=n(10),o=n(13),s=(n(124),n(19)),c=n(65),l=n(7),u=n(35),h=n(79),d=n(383),p=n(760);function f(e,t){return e.events.on("drag",function(e,t){var n=null,i=null;return function(r){if("cancel"!==r.action){var a={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&Object(l.j)(n)&&(n=new k,i=new k,t(e,n,i,r.pointerType,a)),Object(l.k)(n)&&n.execute(a),"end"===r.action&&Object(l.k)(n)&&(n=null,i=null)}else Object(l.k)(i)&&(i.execute({action:"cancel"}),n=null,i=null)}}(e,t))}function v(e,t){var n=[e.x,e.y,e.z],i=t,r=[Math.cos(i),Math.sin(i)],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===a)return null;r[0]/=a,r[1]/=a;var o=function(e){var t=(e.x-n[0])*r[0]+(e.y-n[1])*r[1];e.x=n[0]+t*r[0],e.y=n[1]+t*r[1]};return function(e){return o(e.mapStart),o(e.mapEnd),e}}function b(e,t){var n=null;return function(i){if("start"===i.action&&(n=function(e,t,n){var i=e.geometry;if(Object(l.j)(i))return null;if("mesh"===i.type)return function(e,t,n,i){if(Object(l.k)(t.transform))return function(e,t,n,i){var r=g(n.getOriginPoint(t.spatialReference),i),a=t.spatialReference;return Object(l.j)(r)?null:{move:function(t,i,o){var s=Object(p.d)(r.clone(),t,i,o);if(s.spatialReference.equals(a))n.origin=Object(h.g)(s.x,s.y,s.z);else{var c=Object(d.j)(s,a);Object(l.k)(c)&&(n.origin=Object(h.g)(c.x,c.y,c.z))}e.notifyGeometryChanged()}}}(e,t,t.transform,n);if(!t.spatialReference.equals(n))return null;var r=0,a=0,o=0;return{move:function(n,s,c){var l=n-r,u=s-a,h=c-o;if(l||u||h){var d=t.origin.clone().offset(l,u,h);t.centerAt(d,{geographic:1===i}),e.notifyGeometryChanged(),r=n,a=s,o=c}}}}(e,i,t,n);var r=g(i,t),a=i.spatialReference;return Object(l.j)(r)?null:{move:function(t,n,i){var o=Object(p.d)(r.clone(),t,n,i);o.spatialReference.equals(a)?e.geometry=o:e.geometry=Object(d.j)(o,a)}}}(e,i.mapStart.spatialReference,t)),Object(l.j)(n))return null;var r=i.mapEnd.x-i.mapStart.x,o=i.mapEnd.y-i.mapStart.y,s=i.mapEnd.z-i.mapStart.z;return n.move(r,o,s),Object(a.a)(Object(a.a)({},i),{},{translationX:r,translationY:o,translationZ:s})}}function g(e,t){return Object(l.j)(e)?null:e.spatialReference.equals(t)?e.clone():Object(d.j)(e,t)}function m(e,t){var n=e.map((function(e){return Object(l.s)(b(e,t))})).filter((function(e){return Object(l.k)(e)}));return function(e){var t=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return n.forEach((function(t){return t(e)})),Object(a.a)(Object(a.a)({},e),{},{translationX:t,translationY:i,translationZ:r})}}function O(e,t){var n,i=new Map,r=Object(o.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.set(a,Object(s.a)(e[a]))}}catch(c){r.e(c)}finally{r.f()}return function(t){return i.forEach((function(t,n){e[n]=t})),t}}function y(e){return Object(l.k)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){var n=Object(l.k)(t.transform)?t.transform.clone():null,i=t.vertexAttributes.clonePositional();return function(r){return t.transform=n,t.vertexAttributes=i,e.notifyGeometryChanged(),r}}(e,e.geometry):O(e,["geometry"])}function j(e){var t=e.map((function(e){return Object(l.s)(y(e))})).filter((function(e){return Object(l.k)(e)}));return function(e){return t.forEach((function(t){return t(e)})),e}}function _(){var e=0,t=0,n=0;return function(i){"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);var r=i.mapEnd.x-e,o=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,Object(a.a)(Object(a.a)({},i),{},{mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference})}}function x(){var e=0,t=0;return function(n){"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);var i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,Object(a.a)(Object(a.a)({},n),{},{screenDeltaX:i,screenDeltaY:r})}}function w(e,t){var n=null,i=0,r=0;return function(a){if("start"===a.action&&((n=e.toScreen(t)).x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,r=a.screenStart.y-n.y)),null==n)return null;var o=Object(c.d)(a.screenEnd.x-i,0,e.width),s=Object(c.d)(a.screenEnd.y-r,0,e.height),l=Object(u.e)(o,s);return a.screenStart=n,a.screenEnd=l,a}}var k=function(){function e(){Object(i.a)(this,e),this.execute=function(){}}return Object(r.a)(e,[{key:"next",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return Object(l.k)(t)&&(this.execute=function(e){var i=t(e);Object(l.k)(i)&&n.execute(i)}),n}}]),e}()},655:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(2),r=n(3),a=n(7),o=n(329),s=n(745),c=function(){function e(){Object(i.a)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object(r.a)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=Object(o.a)(e)}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=Object(s.d)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=Object(o.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(a.t)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,n){if(Object(a.j)(e))this._featureExpressionInfoContext=null;else{var i=e&&e.arcade;i&&Object(a.k)(t)&&Object(a.k)(n)?(this._featureExpressionInfoContext=Object(s.a)(e),Object(s.f)(this._featureExpressionInfoContext,Object(s.c)(i.modules,t,n))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var n=new e;return Object(a.k)(t)&&n.setFromElevationInfo(t),n}}]),e}()},664:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(13),r=n(2),a=n(3),o=n(5),s=n(6),c=n(7),l=n(100),u=n(546),h=n(58),d=n(79),p=n(677),f=n(416),v=n(744),b=n(115),g=n(236),m=function(){function e(){Object(r.a)(this,e),this._disposed=!1}return Object(a.a)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}},{key:"acquire",value:function(e,t,n,i,r,a){this.id=Object(g.a)(),this.geometry=e,this.material=t,this.transformation=n,this.instanceParameters=i,this.origin=r,this._shaderTransformation=a,this._disposed=!1}},{key:"release",value:function(){this._disposed=!1}},{key:"dispose",value:function(){this._disposed=!0}},{key:"getStaticTransformation",value:function(){return this.transformation}},{key:"getShaderTransformation",value:function(){return Object(c.k)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}},{key:"computeAttachmentOrigin",value:function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(h.q)(e,e,this.getStaticTransformation()),!0)}}]),e}();m.pool=new b.a(m);var O=n(789),y=n(566),j=n(653),_=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,n),(e=t.call(this)).type=1,e._geometryRecords=new Array,e._geometries=new Array,e._objectTransformation=Object(u.d)(),e._bvObjectSpace=new w,e._bvWorldSpace=new w,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==i.castShadow||i.castShadow,e.metadata=i.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new x),e.transformation=Object(u.d)();var a=i.geometries,o=i.materials,s=i.transformations,c=i.origins;if(Array.isArray(a)){Object(y.a)(o.length===a.length,"Object3D: materials don't match geometries"),Object(y.a)(s.length===a.length,"Object3D: transformations don't match geometries"),e._geometryRecords.length=a.length,e._geometries.length=a.length;for(var l=0;l<a.length;l++)e._geometries[l]=a[l],e._geometryRecords[l]=m.pool.acquire(a[l],o[l],Object(u.c)(s[l]),{highlights:null,occludees:null,visible:!0},c&&c[l])}return e}return Object(a.a)(n,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(e){Object(l.f)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometryRecords.length=0,this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){Object(y.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"getNumGeometryRecords",value:function(){return this._geometryRecords.length}},{key:"getGeometryRecord",value:function(e){return Object(y.a)(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]}},{key:"addGeometry",value:function(e,t,n,i,r,a){n=n||u.a,this._geometries.push(e);var o=m.pool.acquire(e,t,n,i||{highlights:null,occludees:null,visible:!0},r,a);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(c.k)(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}},{key:"removeGeometry",value:function(e){var t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(c.k)(t.shaderTransformation)?this._geometryRecords.some((function(e){return Object(c.k)(e.shaderTransformation)})):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}},{key:"removeAllGeometries",value:function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[e]}),this._invalidateBoundingVolume()}},{key:"isVisible",get:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e;var t,n=Object(i.a)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){t.value.instanceParameters.visible=this._visible}}catch(r){n.e(r)}finally{n.f()}this._emit("visibilityChanged",this)}},{key:"maskOccludee",value:function(){var e,t=new O.a(1),n=Object(i.a)(this._geometryRecords);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.instanceParameters.occludees=Object(j.b)(r.instanceParameters.occludees,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,n=Object(i.a)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.instanceParameters.occludees=Object(j.g)(r.instanceParameters.occludees,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new O.a(0),n=Object(i.a)(this._geometryRecords);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.instanceParameters.highlights=Object(j.b)(r.instanceParameters.highlights,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,n=Object(i.a)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.instanceParameters.highlights=Object(j.g)(r.instanceParameters.highlights,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return Object(l.n)(Object(c.t)(t,Object(u.d)()),this.transformation,e.getStaticTransformation())}},{key:"getCombinedShaderTransformation",value:function(e,t){return t=t||Object(u.d)(),Object(l.n)(t,this.transformation,e.getShaderTransformation()),t}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],n=this._geometryRecords[e],i=t.boundingInfo;Object(c.k)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(n)))}Object(h.i)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(h.i)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);for(var r=Object(d.e)(),a=Object(d.e)(),o=Object(f.c)(this.transformation),s=0;s<this._geometryRecords.length;++s){var l=this._geometries[s].boundingInfo;if(!Object(c.j)(l)){var u=this._geometryRecords[s].getShaderTransformation(),p=Object(f.c)(u);Object(h.q)(r,l.getCenter(),u);var v=Object(h.m)(r,this._bvObjectSpace.bounds),b=l.getBSRadius()*p;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],v+b),Object(h.q)(a,r,this.transformation);var g=Object(h.m)(a,this._bvWorldSpace.bounds),m=b*o;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],g+m)}}this._bvDirty=!1}}},{key:"_calculateTransformedBoundingVolume",value:function(e,t,n){var i=e.getBBMin(),r=e.getBBMax(),a=Object(d.c)(i),o=Object(d.c)(r);Object(h.q)(a,a,n),Object(h.q)(o,o,n);for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],o[s]),t.max[s]=Math.max(t.max[s],a[s],o[s]);for(var c=0;c<3;++c){Object(h.k)(a,i),Object(h.k)(o,r),a[c]=r[c],o[c]=i[c],Object(h.q)(a,a,n),Object(h.q)(o,o,n);for(var l=0;l<3;++l)t.min[l]=Math.min(t.min[l],a[l],o[l]),t.max[l]=Math.max(t.max[l],a[l],o[l])}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,Object(c.k)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){Object(c.k)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),n}(v.a),x=function(){function e(){Object(r.a)(this,e),this.min=Object(d.g)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(d.g)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return Object(a.a)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),w=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).bounds=Object(p.b)(),e}return Object(a.a)(n,[{key:"init",value:function(){Object(h.w)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(h.w)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(p.a)(this.bounds)}}]),n}(x)},669:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(12),n(7);function i(e,t){return!!r(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function r(e,t){return e===t||e&&t&&e.equals(t)}},679:function(e,t,n){"use strict";n.d(t,"a",(function(){return V})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return C}));var i,r,a=n(2),o=n(3),s=n(14),c=n(5),l=n(6),u=n(0),h=n(29),d=n(11),p=n(7),f=n(386),v=n(212),b=n(21),g=n(142),m=n(25),O=n(1),y=(n(12),n(15),n(8)),j=n(755),_=n(761),x=d.a.getLogger("esri.views.support.Scheduler");(r=i||(i={})).RESOURCE_CONTROLLER="schedule",r.SLIDE="slide",r.STREAM_DATA_LOADER="stream loader",r.ELEVATION_QUERY="elevation query",r.TERRAIN_SURFACE="terrain",r.SURFACE_GEOMETRY_UPDATES="surface geometry updates",r.GRAPHICS_CORE="Graphics3D",r.I3S_CONTROLLER="I3S",r.POINT_CLOUD_LAYER="point cloud",r.FEATURE_TILE_FETCHER="feature fetcher",r.OVERLAY="overlay",r.STAGE="stage",r.GRAPHICS_DECONFLICTOR="graphics deconflictor",r.FILTER_VISIBILITY="Graphics3D filter visibility",r.SCALE_VISIBILITY="Graphics3D scale visibility",r.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",r.POINT_OF_INTEREST_FREQUENT="POI frequent",r.POINT_OF_INTEREST_INFREQUENT="POI infrequent",r.LABELER="labeler",r.FEATURE_QUERY_ENGINE="feature query",r.FEATURE_TILE_TREE="feature tile tree",r.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",r.ELEVATION_ALIGNMENT="elevation alignment",r.TEXT_TEXTURE_ATLAS="text texture atlas",r.TEXTURE_UNLOAD="texture unload",r.LINE_OF_SIGHT_TOOL="line of sight tool",r.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",r.ELEVATION_PROFILE="elevation profile",r.SNAPPING="snapping",r.SHADOW_ACCUMULATOR="shadow accumulator",r[r.TEST_PRIO=1]="TEST_PRIO";var w=new Map([[i.RESOURCE_CONTROLLER,0],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function k(e){return w.has(e)?w.get(e):"number"==typeof e?e:1}var S,M,E=Object(g.a)(6.5),P=Object(g.a)(1),T=Object(g.a)(30),D=Object(g.a)(1e3/30),R=Object(g.a)(100);!function(e){var t=function(e){Object(c.a)(u,e);var t=Object(l.a)(u);function u(e){var n,o;Object(a.a)(this,u),(n=t.call(this,e)).updating=!0,n.performanceInfo={total:new f.a("total"),tasks:new Map},n._frameTaskTimes=new Map,n._budget=null,n._state=1,n._tasks=new v.a,n._runQueue=new v.a,n._load=0,n._idleStateCallbacks=new v.a,n._idleUpdatesStartFired=!1,n._maxReschedule=z,n._forceTask=!1,n._debug=!1,n._debugHandle=Object(m.a)(_.a,"SCHEDULER_LOG_SLOW_TASKS",(function(e){return n._debug=e})),n._budget=new r(e.nowFunc);for(var c=0,l=Object.keys(i);c<l.length;c++){var h=l[c];n.performanceInfo.tasks.set(i[h],new f.a(i[h]))}var d=Object(s.a)(n);return n._test={get state(){return Object(p.j)(o)?d._state:o},set state(e){o=e},FRAME_SAFETY_BUDGET:E,INTERACTING_BUDGET:D,IDLE_BUDGET:R,get budget(){return d._budget.budget},usedBudget:0,updateTask:function(e){return n._updateTask(e)},getState:function(e){return n._getState(e)},getRuntime:function(e){return n._getRuntime(e)},resetRuntimes:function(){return n._resetRuntimes()},getRunning:function(){return n._getRunning()}},n}return Object(o.a)(u,[{key:"destroy",value:function(){this._debugHandle&&this._debugHandle.remove()}},{key:"registerTask",value:function(e,t){var i=k(e),r=new n(this,e,t,i);return this._tasks.push(r),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new f.a(e)),r}},{key:"registerIdleStateCallbacks",value:function(e,t){var n=this,i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),2===this.state&&this._idleUpdatesStartFired&&i.idleBegin();var r=this;return{remove:function(){return n._removeIdleStateCallbacks(i)},set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),2===r._state&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}},{key:"now",get:function(){return this.nowFunc()}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return Object(p.j)(this._test.state)?this._state:this._test.state},set:function(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((function(e){return e.idleEnd()}))))}},{key:"updateBudget",value:function(e){this._test.usedBudget=0;var t=E,n=e.frameDuration,i=P;switch(this.state){case 2:t=Object(g.a)(0),n=Object(g.a)(Math.max(R,e.frameDuration)),i=T;break;case 1:n=Object(g.a)(Math.max(D,e.frameDuration))}return n=Object(g.a)(n-e.elapsedFrameTime-t),2!==this.state&&n<P&&!this._forceTask?(this._forceTask=!0,!1):(n=Object(g.a)(Math.max(n,i)),this._budget.reset(n,this.state),this._maxReschedule=z,this._updateLoad(),this._schedule())}},{key:"frame",value:function(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((function(e){return e.idleBegin()}))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}},{key:"stopFrame",value:function(){this._budget.reset(Object(g.a)(0),this._state),this._budget.madeProgress()}},{key:"_removeIdleStateCallbacks",value:function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}},{key:"removeTask",value:function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}},{key:"_updateTask",value:function(e){this._tasks.forAll((function(t){t.name===e&&t.setPriority(e)}))}},{key:"_getState",value:function(e){if(this._runQueue.some((function(t){return t.name===e})))return M.SCHEDULED;var t=M.IDLE;return this._tasks.forAll((function(n){n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=M.READY:t!==M.READY&&(t=M.WAITING))})),t}},{key:"_getRuntime",value:function(e){var t=0;return this._tasks.forAll((function(n){n.name===e&&(t+=n.runtime)})),t}},{key:"_resetRuntimes",value:function(){this._tasks.forAll((function(e){return e.runtime=0}))}},{key:"_getRunning",value:function(){var e=new Map;if(this._tasks.forAll((function(t){t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;var t="";return e.forEach((function(e,n){t+=e>1?" ".concat(e,"x ").concat(n):" ".concat(n)})),t}},{key:"_runIdle",value:function(){this._run()}},{key:"_runInteracting",value:function(){this._run()}},{key:"_runAnimating",value:function(){this._run()}},{key:"_updateLoad",value:function(){var e=this._tasks.reduce((function(e,t){return t.needsUpdate?++e:e}),0);this._load=.9*this._load+e*(1-.9)}},{key:"_schedule",value:function(){var e=this;if(this._maxReschedule<=0)return!1;var t=function(){var t=!1,n=0;if(e._tasks.forAll((function(i){i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&(t=!0,n=Math.max(n,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,e._runQueue.push(i)):--i.schedulePriority)})),!t)return{v:(e.updating=!1,!1)};e._maxReschedule===z&&(e._maxReschedule=n),--e._maxReschedule};for(this._runQueue.filterInPlace((function(e){return!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)})),this._tasks.forAll((function(t){0===t.basePriority&&t.needsUpdate&&!e._runQueue.some((function(e){return e===t}))&&e._runQueue.unshift(t)}));0===this._runQueue.length;){var n=t();if("object"===typeof n)return n.v}return this.updating=!0,!0}},{key:"_run",value:function(){var e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){var t=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)}catch(r){x.error('Exception in task "'.concat(n.name,'"'),r)}n.schedulePriority=n.basePriority;var i=this._budget.now()-t;if(n.runtime+=i,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",n.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}},{key:"_startFrameTaskTimes",value:function(){for(var e=0,t=Object.keys(i);e<t.length;e++){var n=t[e];this._frameTaskTimes.set(i[n],0)}}},{key:"_recordFrameTaskTimes",value:function(e){var t=this;this._frameTaskTimes.forEach((function(e,n){return t.performanceInfo.tasks.get(n).record(e)})),this.performanceInfo.total.record(e)}},{key:"test",get:function(){return this._test}}]),u}(h.a);Object(u.a)([Object(O.b)()],t.prototype,"updating",void 0),Object(u.a)([Object(O.b)()],t.prototype,"nowFunc",void 0),t=Object(u.a)([Object(y.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;var n=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e,i,r,o){var s;return Object(a.a)(this,n),(s=t.call(this,{}))._scheduler=e,s.name=i,s._basePriority=o,s.runtime=0,s._queue=new j.a,s.updating=!1,s.schedulePriority=s._basePriority,s.task=Object(p.k)(r)?r:{running:!1,runTask:function(e){return s.processQueue(e)}},s}return Object(o.a)(n,[{key:"normalizeCtorArgs",value:function(){return{}}},{key:"remove",value:function(){this.processQueue(C),this._scheduler.removeTask(this),this.schedule=V.schedule,this.reschedule=V.reschedule}},{key:"basePriority",get:function(){return this._basePriority}},{key:"setPriority",value:function(e){this.name=e;var t=k(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}},{key:"priority",get:function(){return this.name},set:function(e){this.setPriority(e)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}},{key:"schedule",value:function(e,t,n){return this.updating=!0,this._queue.push(e,t,n)}},{key:"reschedule",value:function(e,t,n){return this.updating=!0,this._queue.unshift(e,t,n)}},{key:"processQueue",value:function(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}}]),n}(h.a);Object(u.a)([Object(O.b)()],n.prototype,"updating",void 0),n=Object(u.a)([Object(y.a)("esri.views.support.SchedulerTask")],n);var r=function(){function e(t){Object(a.a)(this,e),this.now=t,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}return Object(o.a)(e,[{key:"run",value:function(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}},{key:"done",get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}},{key:"budget",get:function(){return this._budget}},{key:"madeProgress",value:function(){this._didWork=!0}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"reset",value:function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"elapsed",get:function(){return this.now()-this._begin}},{key:"resetProgress",value:function(){this._didWork=!1}},{key:"hasProgressed",get:function(){return this._didWork}}]),e}();e.Budget=r}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(M||(M={}));var C=function(){var e=new S.Budget((function(){return performance.now()}));return e.enabled=!1,e}(),A=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"remove",value:function(){}},{key:"processQueue",value:function(){}},{key:"schedule",value:function(e,t,n){try{if(Object(b.n)(t)){var i=Object(b.e)();return n?Promise.resolve(n(i)):Promise.reject(i)}return Object(b.x)(e())}catch(r){return Promise.reject(r)}}},{key:"reschedule",value:function(e,t,n){return this.schedule(e,t,n)}}]),e}(),V=new A,z=Number.MAX_SAFE_INTEGER},686:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(2),r=n(5),a=n(6),o=n(0),s=n(29),c=n(1),l=(n(12),n(15),n(11),n(8)),u=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.ENABLE_PROFILE_DEPTH_RANGE=!1,e.DISABLE_FAST_UPDATES=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e.ENABLE_CONTINUOUS_LINE_PATTERNS=!1,e}return n}(s.a);Object(o.a)([Object(c.b)()],u.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(o.a)([Object(c.b)()],u.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(o.a)([Object(c.b)()],u.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(o.a)([Object(c.b)()],u.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LABELS_SHOW_BORDER",void 0),Object(o.a)([Object(c.b)()],u.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(o.a)([Object(c.b)()],u.prototype,"SHOW_POI",void 0),Object(o.a)([Object(c.b)()],u.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(o.a)([Object(c.b)()],u.prototype,"DISABLE_FAST_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(o.a)([Object(c.b)()],u.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),Object(o.a)([Object(c.b)()],u.prototype,"ENABLE_CONTINUOUS_LINE_PATTERNS",void 0);var h=new(u=Object(o.a)([Object(l.a)("esri.views.3d.support.DebugFlags")],u))},688:function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return v}));var i=n(13),r=n(5),a=n(6),o=n(2),s=n(3),c=n(102),l=n(67),u=n(7),h=n(90),d=n(101),p=n(814),f=n(42);var v=function(){function e(t){Object(o.a)(this,e),this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}return Object(s.a)(e,[{key:"pos",get:function(){return this._pos},set:function(e){this._pos=e,this.component.unnormalizeVertexPositions()}}]),e}(),b=function e(t,n,i){Object(o.a)(this,e),this.component=t,this.leftVertex=n,this.rightVertex=i,this.type="edge",n.rightEdge=this,i.leftEdge=this},g=function(){function e(t,n){Object(o.a)(this,e),this.spatialReference=t,this.viewingMode=n,this.vertices=[],this.edges=[]}return Object(s.a)(e,[{key:"unnormalizeVertexPositions",value:function(){this.vertices.length<=1||function(e,t){if(t.supported){var n=1/0,i=-1/0,r=t.upperBoundX-t.lowerBoundX;e.forEach((function(e){for(var a=e.pos[0];a<t.lowerBoundX;)a+=r;for(;a>t.upperBoundX;)a-=r;n=Math.min(n,a),i=Math.max(i,a),e.pos[0]=a}));var a=i-n;r-a<a&&e.forEach((function(e){e.pos[0]<0&&(e.pos[0]+=r)}))}}(this.vertices,function(e,t){var n=Object(f.e)(e);return 1===t&&n?{supported:!0,lowerBoundX:n.valid[0],upperBoundX:n.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}(this.spatialReference,this.viewingMode))}},{key:"updateVertexIndex",value:function(e,t){if(0!==this.vertices.length){var n=this.vertices[0],i=null,r=e,a=t;do{(i=r).index=a++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}}},{key:"getFirstVertex",value:function(){return 0===this.vertices.length?null:this.vertices[0]}},{key:"getLastVertex",value:function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}},{key:"isClosed",value:function(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}},{key:"swapVertices",value:function(e,t){var n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n}},{key:"iterateVertices",value:function(e){if(0!==this.vertices.length){var t=this.vertices[0],n=t;do{e(n,n.index),n=Object(u.k)(n.rightEdge)?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)}}}]),e}(),m=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e,i,r){var a;return Object(o.a)(this,n),(a=t.call(this)).type=e,a.coordinateHelper=i,a.viewingMode=r,a._geometry=null,a.dirty=!0,a.components=[],a}return Object(s.a)(n,[{key:"geometry",get:function(){if(this.dirty){switch(this.type){case"point":this._geometry=this.toPoint();break;case"polyline":this._geometry=this.toPolyline();break;case"polygon":this._geometry=this.toPolygon()}this.dirty=!1}return this._geometry}},{key:"spatialReference",get:function(){return this.coordinateHelper.spatialReference}},{key:"notifyChanges",value:function(e){this.dirty=!0,this.emit("change",e)}},{key:"toPoint",value:function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}},{key:"toPolyline",value:function(){var e=[],t=this.coordinateHelper.vectorToArray;return this.components.forEach((function(n,i){var r=[],a=n.vertices.find((function(e){return null==e.leftEdge})),o=a;do{r.push(t(a.pos)),a=a.rightEdge?a.rightEdge.rightVertex:null}while(a&&a!==o);e.push(r)})),new d.a({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}},{key:"toPolygon",value:function(){var e=[],t=this.coordinateHelper.vectorToArray;return this.components.forEach((function(n,i){var r=[],a=n.vertices[0],o=a,s=o;do{r.push(t(o.pos)),o=Object(u.k)(o.rightEdge)?o.rightEdge.rightVertex:null}while(o&&o!==s);n.isClosed()&&r.push(t(a.pos)),e.push(r)})),new h.a({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}}],[{key:"fromGeometry",value:function(e,t){var r=e.spatialReference,a=Object(p.a)(e.hasZ,e.hasM,r),o=new n(e.type,a,t);switch(e.type){case"polygon":for(var s=e.rings,l=0;l<s.length;++l){for(var u=s[l],h=new g(r,t),d=u.length>2&&Object(c.c)(u[0],u[u.length-1]),f=d?u.length-1:u.length,m=0;m<f;++m){var O=a.arrayToVector(u[m]),y=new v(h);h.vertices.push(y),y.pos=O,y.index=m}for(var j=h.vertices.length-1,_=0;_<j;++_){var x=h.vertices[_],w=h.vertices[_+1],k=new b(h,x,w);h.edges.push(k)}if(d){var S=new b(h,h.vertices[h.vertices.length-1],h.vertices[0]);h.edges.push(S)}o.components.push(h)}break;case"polyline":var M,E=Object(i.a)(e.paths);try{for(E.s();!(M=E.n()).done;){for(var P=M.value,T=new g(r,t),D=P.length,R=0;R<D;++R){var C=a.arrayToVector(P[R]),A=new v(T);T.vertices.push(A),A.pos=C,A.index=R}for(var V=T.vertices.length-1,z=0;z<V;++z){var I=T.vertices[z],G=T.vertices[z+1],L=new b(T,I,G);T.edges.push(L)}o.components.push(T)}}catch(H){E.e(H)}finally{E.f()}break;case"point":var F=new g(r,t),U=new v(F);U.index=0,U.pos=a.pointToVector(e),F.vertices.push(U),o.components.push(F)}return o}}]),n}(l.a)},691:function(e,t,n){"use strict";function i(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function a(e){return"l"in e&&"c"in e&&"h"in e}function o(e){return"x"in e&&"y"in e&&"z"in e}n.d(t,"a",(function(){return _})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return y})),n.d(t,"d",(function(){return j})),n.d(t,"e",(function(){return m}));var s=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],c=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){var n,i,r=[];if(e[0].length!==t.length)throw"dimensions do not match";var a=e.length,o=e[0].length,s=0;for(n=0;n<a;n++){for(s=0,i=0;i<o;i++)s+=e[n][i]*t[i];r.push(s)}return r}function u(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=l(s,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function h(e){var t=l(c,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function f(e){return d(u(e))}function v(e){return h(p(e))}function b(e){return function(e){var t=e.l,n=e.a,i=e.b,r=Math.sqrt(n*n+i*i),a=Math.atan2(i,n);return{l:t,c:r,h:a=a>0?a:a+2*Math.PI}}(d(u(e)))}function g(e){return h(p(function(e){var t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}(e)))}function m(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:a(e)?g(e):r(e)?v(e):o(e)?h(e):i(e)?function(e){var t,n=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,a=r*i,o=a*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:a,g:o,b:0};break;case 1:t={r:o,g:a,b:0};break;case 2:t={r:0,g:a,b:o};break;case 3:t={r:0,g:o,b:a};break;case 4:t={r:o,g:0,b:a};break;case 5:case 6:t={r:a,g:0,b:o};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-a),t.g=Math.round(t.g+r-a),t.b=Math.round(t.b+r-a),t}(e):e}function O(e){return i(e)?e:function(e){var t=e.r,n=e.g,i=e.b,r=Math.max(t,n,i),a=r-Math.min(t,n,i),o=r,s=0===a?0:r===t?(n-i)/a%6:r===n?(i-t)/a+2:(t-n)/a+4,c=0===a?0:a/o;return s<0&&(s+=6),{h:s*=60,s:c*=100,v:o*=100/255}}(m(e))}function y(e){return r(e)?e:f(m(e))}function j(e){return a(e)?e:b(m(e))}function _(e,t){var n=f(e);return n.l*=1-t,v(n)}},698:function(e,t,n){"use strict";function i(){return new Float32Array(4)}function r(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,n,i){var r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function o(){return i()}function s(){return a(1,1,1,1)}function c(){return a(1,0,0,0)}function l(){return a(0,1,0,0)}function u(){return a(0,0,1,0)}function h(){return a(0,0,0,1)}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a}));var d=o(),p=s(),f=c(),v=l(),b=u(),g=h();Object.freeze({__proto__:null,create:i,clone:r,fromValues:a,createView:function(e,t){return new Float32Array(e,t,4)},zeros:o,ones:s,unitX:c,unitY:l,unitZ:u,unitW:h,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:v,UNIT_Z:b,UNIT_W:g})},707:function(e,t,n){"use strict";n.d(t,"a",(function(){return B}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(11),l=n(65),u=n(7),h=n(35),d=n(30),p=n(58),f=n(79),v=n(662),b=n(596),g=n(646),m=n(660),O=n(680),y=n(624),j=n(566),_=n(866),x=n(653),w=n(41),k=n(38),S=n(0),M=n(556),E=n(574),P=n(567),T=n(654),D=n(641),R=n(608),C=n(617),A=n(623),V=n(612),z=n(609),I=n(700),G=n(818),L=n(543),F=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]),U=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,i,a){var o;return Object(r.a)(this,n),(o=t.call(this,e,i,a)).stippleTextureRepository=e.stippleTextureRepository,o}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new z.a(e.rctx,r,F)}},{key:"dispose",value:function(){Object(w.a)(Object(k.a)(n.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if(Object(D.c)(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(E.b)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(P.a)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(T.d)(this.program,e),this.stipplePattern!==e.stipplePattern){var n=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.configuration.stippleEnabled){var i=Object(u.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1},r=i.pixelSize,a=i.sdfNormalizer;if(this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.configuration.draped?(this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.program.setUniform1f("worldToScreenRatio",1/t.screenToWorldRatio)):this.program.setUniform1f("stipplePatternPixelSizeInv",1/(r*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var o=Object(u.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",o[0],o[1],o[2],o.length>3?o[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(u.t)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}},{key:"bindDraw",value:function(e){Object(D.d)(this.program,e),Object(M.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var n=this.configuration,i=3===e,r=2===e;return Object(L.f)({blending:0===n.output||7===n.output?i?V.g:Object(V.a)(e):null,depthTest:{func:Object(V.b)(e)},depthWrite:i?!n.transparent&&n.writeDepth&&L.d:Object(V.c)(e),colorWrite:L.c,stencilWrite:n.sceneHasOcludees?I.h:null,stencilTest:n.sceneHasOcludees?t?I.d:I.c:null,polygonOffset:i||r?n.polygonOffset&&H:V.d})}},{key:"initializePipeline",value:function(){var e=this.configuration,t=e.polygonOffset&&H;return e.occluder&&(this._occluderPipelineTransparent=Object(L.f)({blending:V.g,polygonOffset:t,depthTest:I.a,depthWrite:null,colorWrite:L.c,stencilWrite:null,stencilTest:I.f}),this._occluderPipelineOpaque=Object(L.f)({blending:V.g,polygonOffset:t,depthTest:I.a,depthWrite:null,colorWrite:L.c,stencilWrite:I.g,stencilTest:I.e}),this._occluderPipelineMaskWrite=Object(L.f)({blending:null,polygonOffset:t,depthTest:I.b,depthWrite:null,colorWrite:null,stencilWrite:I.h,stencilTest:I.d})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return 5}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}]),n}(C.a);U.shader=new R.a(G.a,(function(){return n.e(211).then(n.bind(null,1105))}));var H={factor:0,units:-4},N=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.occluder=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.polygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.roundCaps=!1,e.roundJoins=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(A.a);Object(S.a)([Object(A.b)({count:8})],N.prototype,"output",void 0),Object(S.a)([Object(A.b)()],N.prototype,"occluder",void 0),Object(S.a)([Object(A.b)()],N.prototype,"slicePlaneEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"transparent",void 0),Object(S.a)([Object(A.b)()],N.prototype,"polygonOffset",void 0),Object(S.a)([Object(A.b)()],N.prototype,"writeDepth",void 0),Object(S.a)([Object(A.b)()],N.prototype,"draped",void 0),Object(S.a)([Object(A.b)()],N.prototype,"stippleEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"stippleOffColorEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"roundCaps",void 0),Object(S.a)([Object(A.b)()],N.prototype,"roundJoins",void 0),Object(S.a)([Object(A.b)()],N.prototype,"vvSize",void 0),Object(S.a)([Object(A.b)()],N.prototype,"vvColor",void 0),Object(S.a)([Object(A.b)()],N.prototype,"vvOpacity",void 0),Object(S.a)([Object(A.b)()],N.prototype,"falloffEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"innerColorEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"sceneHasOcludees",void 0),Object(S.a)([Object(A.b)({count:4})],N.prototype,"transparencyPassType",void 0),Object(S.a)([Object(A.b)()],N.prototype,"multipassTerrainEnabled",void 0),Object(S.a)([Object(A.b)()],N.prototype,"cullAboveGround",void 0);var q=c.a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),B=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,Z))._vertexAttributeLocations=F,i.techniqueConfig=new N,i.layout=i.createLayout(),i}return Object(a.a)(n,[{key:"isClosed",value:function(e,t){return J(this.params,e,t)}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.params}},{key:"getTechniqueConfig",value:function(e,t){this.techniqueConfig.output=e;var n=Object(u.k)(t)&&23===t.slot;this.techniqueConfig.draped=n;var i=Object(u.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleIntegerRepeatsEnabled=i&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=i&&Object(u.k)(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&Object(u.k)(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,n,i,r,a,o,s,c){c?this.intersectDrapedLineGeometry(e,i,a,o):this.intersectLineGeometry(e,t,n,i,this.params.width,o)}},{key:"intersectDrapedLineGeometry",value:function(e,t,n,i){if(t.options.selectionMode){var r=e.vertexAttributes.get("position").data,a=e.vertexAttributes.get("size"),o=this.params.width;if(this.params.vvSizeEnabled){var s=e.vertexAttributes.get("sizeFeatureAttribute").data[0];o*=Object(l.d)(this.params.vvSizeOffset[0]+s*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else a&&(o*=a.data[0]);for(var c=n[0],u=n[1],h=(o/2+4)*e.screenToWorldRatio,d=Number.MAX_VALUE,p=0;p<r.length-5;p+=3){var f=r[p],v=r[p+1],b=c-f,g=u-v,m=r[p+3]-f,O=r[p+4]-v,y=Object(l.d)((m*b+O*g)/(m*m+O*O),0,1),j=m*y-b,_=O*y-g,x=j*j+_*_;x<d&&(d=x)}d<h*h&&i()}}},{key:"intersectLineGeometry",value:function(e,t,n,i,r,a){if(i.options.selectionMode&&!Object(x.e)(t))if(Object(j.g)(n)){var o=e.vertexAttributes,s=o.get("position").data,c=r;if(this.params.vvSizeEnabled){var u=o.get("sizeFeatureAttribute").data[0];c*=Object(l.d)(this.params.vvSizeOffset[0]+u*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o.has("size")&&(c*=o.get("size").data[0]);var h=i.camera,f=re;Object(d.c)(f,i.point);var g=c*h.pixelRatio/2+4*h.pixelRatio;Object(p.w)(fe[0],f[0]-g,f[1]+g,0),Object(p.w)(fe[1],f[0]+g,f[1]+g,0),Object(p.w)(fe[2],f[0]+g,f[1]-g,0),Object(p.w)(fe[3],f[0]-g,f[1]-g,0);for(var m=0;m<4;m++)if(!h.unprojectFromRenderScreen(fe[m],ve[m]))return;Object(b.f)(h.eye,ve[0],ve[1],be),Object(b.f)(h.eye,ve[1],ve[2],ge),Object(b.f)(h.eye,ve[2],ve[3],me),Object(b.f)(h.eye,ve[3],ve[0],Oe);for(var O=Number.MAX_VALUE,y=Q(this.params,o,e.indices)?s.length-2:s.length-5,_=0;_<y;_+=3){ee[0]=s[_]+n[12],ee[1]=s[_+1]+n[13],ee[2]=s[_+2]+n[14];var w=(_+3)%s.length;if(te[0]=s[w]+n[12],te[1]=s[w+1]+n[13],te[2]=s[w+2]+n[14],!(Object(b.t)(be,ee)<0&&Object(b.t)(be,te)<0||Object(b.t)(ge,ee)<0&&Object(b.t)(ge,te)<0||Object(b.t)(me,ee)<0&&Object(b.t)(me,te)<0||Object(b.t)(Oe,ee)<0&&Object(b.t)(Oe,te)<0)){if(h.projectToRenderScreen(ee,ae),h.projectToRenderScreen(te,oe),ae[2]<0&&oe[2]>0){Object(p.j)(ne,ee,te);var k=h.frustum,S=-Object(b.t)(k[4],ee)/Object(p.h)(ne,Object(b.q)(k[4]));Object(p.e)(ne,ne,S),Object(p.f)(ee,ee,ne),h.projectToRenderScreen(ee,ae)}else if(ae[2]>0&&oe[2]<0){Object(p.j)(ne,te,ee);var M=h.frustum,E=-Object(b.t)(M[4],te)/Object(p.h)(ne,Object(b.q)(M[4]));Object(p.e)(ne,ne,E),Object(p.f)(te,te,ne),h.projectToRenderScreen(te,oe)}else if(ae[2]<0&&oe[2]<0)continue;ae[2]=0,oe[2]=0;var P=Object(v.e)(Object(v.f)(ae,oe,le),f);P<O&&(O=P,Object(p.k)(se,ee),Object(p.k)(ce,te))}}var T=i.rayBeginPoint,D=i.rayEndPoint;if(O<g*g){var R=Number.MAX_VALUE;if(Object(v.a)(Object(v.f)(se,ce,le),Object(v.f)(T,D,ue),ie)){Object(p.j)(ie,ie,T);var C=Object(p.p)(ie);Object(p.e)(ie,ie,1/C),R=C/Object(p.m)(T,D)}a(R,ie)}}else q.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return null;var i=e.indices,r=n.get("position");return Object(m.a)(r,i?i.get("position"):null,i&&Q(this.params,n,i),t)}},{key:"createLayout",value:function(){var e=Object(g.a)().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}},{key:"createBufferWriter",value:function(){return new X(this.layout,this.params)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new W(e):void 0}},{key:"validateParameterValues",value:function(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}},{key:"requiresTransparent",value:function(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}},{key:"colorRequiresTransparent",value:function(e){return Object(u.k)(e)&&e[3]<1&&e[3]>0}}]),n}(y.a),W=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(n,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(U,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(e,t)}}]),n}(O.a),Z=Object(i.a)(Object(i.a)({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},y.b),_.a.Default),X=function(){function e(t,n){switch(Object(r.a)(this,e),this.params=n,this.numJoinSubdivisions=0,this.vertexBufferLayout=t,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=n.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=$}}return Object(a.a)(e,[{key:"isClosed",value:function(e){return Q(this.params,e.vertexAttributes,e.indices)}},{key:"numCapSubdivisions",value:function(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return K}}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=2*this.numCapSubdivisions(e)+2,n=e.indices.get("position").length/2+1,i=this.isClosed(e),r=i?2:2*t,a=i?0:1,o=i?n:n-1;if(e.vertexAttributes.has("subdivisions"))for(var s=e.vertexAttributes.get("subdivisions").data,c=a;c<o;++c)r+=4+2*s[c];else r+=(o-a)*(2*this.numJoinSubdivisions+4);return r+=2}},{key:"write",value:function(e,t,n,i){var r=this,a=he,o=de,s=pe,c=t.vertexAttributes.get("position").data,l=t.indices&&t.indices.get("position"),u=this.numCapSubdivisions(t);l&&l.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var h=null;t.vertexAttributes.has("subdivisions")&&(h=t.vertexAttributes.get("subdivisions").data);var d=1,f=0;this.params.vvSizeEnabled?f=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(d=t.vertexAttributes.get("size").data[0]);var v=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(v=t.vertexAttributes.get("color").data);var g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);var m=c.length/3,O=e.transformation,y=new Float32Array(n.buffer),j=this.vertexBufferLayout.stride/4,_=i*j,x=_,w=0,k=function(e,t,n,i,a,o,s,c){if(y[_++]=t[0],y[_++]=t[1],y[_++]=t[2],y[_++]=i,y[_++]=c,y[_++]=o+a/10,y[_++]=e[0],y[_++]=e[1],y[_++]=e[2],y[_++]=n[0],y[_++]=n[1],y[_++]=n[2],r.params.vvSizeEnabled?y[_++]=f:y[_++]=d,r.params.vvColorEnabled)y[_++]=b;else{var l=Math.min(4*s,v.length-4);y[_++]=v[l+0],y[_++]=v[l+1],y[_++]=v[l+2],y[_++]=v[l+3]}r.params.vvOpacityEnabled&&(y[_++]=g)};_+=j,Object(p.w)(o,c[0],c[1],c[2]),O&&Object(p.q)(o,o,O);var S=this.isClosed(t);if(S){var M=c.length-3;Object(p.w)(a,c[M],c[M+1],c[M+2]),O&&Object(p.q)(a,a,O)}else{Object(p.k)(a,o),Object(p.w)(s,c[3],c[4],c[5]),O&&Object(p.q)(s,s,O);for(var E=0;E<u;++E){var P=1-E/u;k(a,o,s,P,1,-4,0,w),k(a,o,s,P,1,4,0,w)}k(a,o,s,0,0,-4,0,w),k(a,o,s,0,0,4,0,w),Object(p.k)(a,o),Object(p.k)(o,s)}for(var T=S?0:1,D=S?m:m-1,R=T;R<D;R++){var C=(R+1)%m*3;Object(p.w)(s,c[C+0],c[C+1],c[C+2]),O&&Object(p.q)(s,s,O),k(a,o,s,0,1,-1,R,w+=Object(p.m)(a,o)),k(a,o,s,0,1,1,R,w);for(var A=h?h[R]:this.numJoinSubdivisions,V=0;V<A;++V){var z=(V+1)/(A+1);k(a,o,s,z,1,-2,R,w),k(a,o,s,z,1,2,R,w)}k(a,o,s,1,0,-2,R,w),k(a,o,s,1,0,2,R,w),Object(p.k)(a,o),Object(p.k)(o,s)}if(S)Object(p.w)(s,c[3],c[4],c[5]),O&&Object(p.q)(s,s,O),k(a,o,s,0,1,-1,T,w+=Object(p.m)(a,o)),k(a,o,s,0,1,1,T,w);else{k(a,o,s,0,1,-5,D,w+=Object(p.m)(a,o)),k(a,o,s,0,1,5,D,w);for(var I=0;I<u;++I){var G=(I+1)/u;k(a,o,s,G,1,-5,D,w),k(a,o,s,G,1,5,D,w)}}Y(y,x+j,y,x,j),_=Y(y,_-j,y,_,j)}}]),e}();function Y(e,t,n,i,r){for(var a=0;a<r;a++)n[i++]=e[t++];return i}function Q(e,t,n){return J(e,t.get("position").data,n?n.get("position"):null)}function J(e,t,n){return!!e.isClosed&&(n?n.length>2:t.length>6)}var K=3,$=1,ee=Object(f.e)(),te=Object(f.e)(),ne=Object(f.e)(),ie=Object(f.e)(),re=Object(f.e)(),ae=Object(h.d)(),oe=Object(h.d)(),se=Object(f.e)(),ce=Object(f.e)(),le=Object(v.d)(),ue=Object(v.d)(),he=Object(f.e)(),de=Object(f.e)(),pe=Object(f.e)(),fe=[Object(h.d)(),Object(h.d)(),Object(h.d)(),Object(h.d)()],ve=[Object(f.e)(),Object(f.e)(),Object(f.e)(),Object(f.e)()],be=Object(b.d)(),ge=Object(b.d)(),me=Object(b.d)(),Oe=Object(b.d)()},711:function(e,t,n){"use strict";function i(e){return 32+e.length}function r(e){if(!e)return 0;var t=32;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];switch(typeof r){case"string":t+=i(r);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function a(e,t){return 32+e.length*t}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}))},718:function(e,t,n){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.stride;return e.fieldNames.filter((function(t){var n=e.fields.get(t).optional;return!(n&&n.glPadding)})).map((function(i){var a=e.fields.get(i),o=a.constructor.ElementCount,s=r(a.constructor.ElementType),c=a.offset,l=!(!a.optional||!a.optional.glNormalized);return{name:i,stride:n,count:o,type:s,offset:c,normalized:l,divisor:t}}))}function r(e){var t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}n.d(t,"a",(function(){return i}));var a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},723:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(57),c=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this)).point=e,r}return Object(r.a)(n,[{key:"equals",value:function(e){return e instanceof n&&Object(s.d)(this.point,e.point)}}]),n}(n(218).a)},724:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(2),r=n(3),a=function(){function e(t){Object(i.a)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.visualizer=t.visualizer}return Object(r.a)(e,[{key:"coordinateHelper",get:function(){return this.editGeometryOperations.data.coordinateHelper}}]),e}()},725:function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return u}));var i=n(13),r=n(80),a=(n(12),n(19)),o=n(7),s=n(162),c=n(73),l=n(611);function u(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function d(e,t){if(!e)return null;if("declaredClass"in e)return e;var n=new r.a({layer:t,sourceLayer:t});return n.visible=e.visible,n.symbol=Object(a.a)(e.symbol),n.attributes=Object(a.a)(e.attributes),n.geometry=p(e.geometry),n}function p(e){return Object(o.j)(e)?null:u(e)?e:Object(c.a)(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var n=e.rings,i=e.hasZ,r=e.hasM;return{rings:f(n),hasZ:i,hasM:r,spatialReference:t};case"polyline":var a=e.paths,o=e.hasZ,s=e.hasM;return{paths:f(a),hasZ:o,hasM:s,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:t};case"multipoint":var c=e.points,l=e.hasZ,u=e.hasM;return{points:b(c)?v(c):c,hasZ:l,hasM:u,spatialReference:t};default:return}}(e))}function f(e){return function(e){var t,n=Object(i.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(0!==r.length)return b(r)}}catch(a){n.e(a)}finally{n.f()}return!1}(e)?e.map((function(e){return v(e)})):e}function v(e){return e.map((function(e){return Object(s.n)(e)}))}function b(e){return e.length&&(Object(s.d)(e[0])||Object(s.e)(e[0]))}function g(e,t){if(!e)return null;var n;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=null,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=null,n.hasM=!1)):(n=Object(l.g)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}},726:function(e,t,n){"use strict";n.d(t,"a",(function(){return N})),n.d(t,"b",(function(){return G})),n.d(t,"c",(function(){return L})),n.d(t,"d",(function(){return F}));var i,r,a,o,s,c,l,u,h,d,p,f,v,b,g,m,O,y,j,_=n(541),x=n(30),w=n(60),k=n(557),S=n(556),M=n(791),E=n(727),P=n(868),T=n(574),D=n(654),R=n(577),C=n(620),A=n(714),V=n(746),z=n(537),I=n(560);function G(e){var t=new I.a,n=e.signedDistanceFieldEnabled;if(t.include(M.a),t.include(E.a,e),t.include(S.a,e),6===e.output)return t.include(P.a,e),t;t.include(V.a),t.fragment.include(A.a),t.fragment.include(C.a),t.include(D.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),n&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(Object(z.a)(i||(i=Object(_.a)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?Object(z.a)(r||(r=Object(_.a)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):Object(z.a)(a||(a=Object(_.a)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var x=Object(z.a)(o||(o=Object(_.a)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),w=e.pixelSnappingEnabled?n?Object(z.a)(s||(s=Object(_.a)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):Object(z.a)(c||(c=Object(_.a)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):Object(z.a)(l||(l=Object(_.a)(["posProj += quadOffset;"])));t.vertex.code.add(Object(z.a)(u||(u=Object(_.a)(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",x,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",z.a.float(R.c),n?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(z.a.float(R.c),";"):"",w,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?Object(z.a)(h||(h=Object(_.a)(["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),n&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var k=e.debugDrawBorder?Object(z.a)(d||(d=Object(_.a)(["(isBorder > 0.0 ? 0.0 : ",")"])),z.a.float(R.b)):z.a.float(R.b),G=Object(z.a)(p||(p=Object(_.a)(["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?Object(z.a)(f||(f=Object(_.a)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?Object(z.a)(v||(v=Object(_.a)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),k,z.a.float(R.c),k):Object(z.a)(b||(b=Object(_.a)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),k),e.debugDrawBorder?Object(z.a)(g||(g=Object(_.a)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 7===e.output&&t.fragment.code.add(Object(z.a)(m||(m=Object(_.a)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),G)),0===e.output&&t.fragment.code.add(Object(z.a)(O||(O=Object(_.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),G,e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":"")),4===e.output&&(t.include(T.a),t.fragment.code.add(Object(z.a)(y||(y=Object(_.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),G,e.binaryHighlightOcclusionEnabled?Object(z.a)(j||(j=Object(_.a)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function L(e,t,n){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",k.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*n,2*t.screenOffset[1]*n),e.setUniform2fv("anchorPos",F(t))}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H;return e.textureIsSignedDistanceField?U(e.anchorPos,e.distanceFieldBoundingBox,t):Object(x.c)(t,e.anchorPos),t}function U(e,t,n){n[0]=e[0]*(t[2]-t[0])+t[0],n[1]=e[1]*(t[3]-t[1])+t[1]}var H=Object(w.a)(),N=Object.freeze({__proto__:null,build:G,bindHUDMaterialUniforms:L,calculateAnchorPosForRendering:F})},727:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var i,r,a,o,s,c,l,u=n(541),h=n(746),d=n(537);function p(e,t){var n=e;n.include(h.a),n.attributes.add("position","vec3"),n.attributes.add("normal","vec3"),n.attributes.add("auxpos1","vec4"),n.vertex.uniforms.add("proj","mat4"),n.vertex.uniforms.add("view","mat4"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.uniforms.add("viewport","vec4"),n.vertex.uniforms.add("camPos","vec3"),n.vertex.uniforms.add("polygonOffset","float"),n.vertex.uniforms.add("cameraGroundRelative","float"),n.vertex.uniforms.add("pixelRatio","float"),n.vertex.uniforms.add("perDistancePixelRatio","float"),n.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&n.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&n.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),n.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),n.vertex.constants.add("smallOffsetAngle","float",.984807753012208),n.vertex.code.add(Object(d.a)(i||(i=Object(u.a)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),n.vertex.code.add(Object(d.a)(r||(r=Object(u.a)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped||n.vertex.code.add(Object(d.a)(a||(a=Object(u.a)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"])))),n.vertex.code.add(Object(d.a)(o||(o=Object(u.a)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?Object(d.a)(s||(s=Object(u.a)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?Object(d.a)(c||(c=Object(u.a)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),n.vertex.code.add(Object(d.a)(l||(l=Object(u.a)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (uRenderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}function f(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},728:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return c}));var i=n(2),r=n(3),a=n(646),o=n(695),s=Object(a.a)().vec3f("position"),c=Object(a.a)().vec3f("position").vec2f("uv0"),l=Object(a.a)().vec3f("position").vec4u8("color"),u=function(){function e(t){Object(i.a)(this,e),this.vertexBufferLayout=t}return Object(r.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,i){Object(o.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i)}}]),e}()},737:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return c}));var i=n(65),r=n(667),a=n(610),o=n(58);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return[e[0],e[1],e[2],e[3]]}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return Object(o.k)(n,e),n[3]=t,n}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return Object(r.h)(v,e,d(e)),Object(r.h)(b,t,d(t)),Object(r.f)(v,b,v),p(n,Object(i.n)(Object(r.b)(n,v)))}function u(e){return e}function h(e){return e[3]}function d(e){return Object(i.f)(e[3])}function p(e,t){return e[3]=t,e}var f=[0,0,1,0],v=Object(a.b)(),b=Object(a.b)();s()},745:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return b})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return g}));var i=n(4),r=n.n(i),a=n(9),o=n(11),s=n(725),c=n(111),l=o.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function u(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function h(e,t,n){return d.apply(this,arguments)}function d(){return d=Object(a.a)(r.a.mark((function e(t,n,i){var a,o,s,l,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(a=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(o=O(a))){e.next=6;break}return e.abrupt("return",{cachedResult:o});case 6:return e.next=8,Object(c.e)();case 8:return s=e.sent,l=s.arcadeUtils,u=l.createSyntaxTree(a),e.abrupt("return",l.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:l.createFunction(u),context:l.createExecContext(null,{sr:n}),modules:s}});case 12:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function p(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function f(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var n=t;n._geometry&&(n._geometry=Object(s.b)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function v(e){if(null!=e){if(m(e))return e.cachedResult;var t=e.arcade,n=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function b(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e&&e.featureExpressionInfo,i=n&&n.expression;return t||"0"===i||(n=null),n}var g={cachedResult:0};function m(e){return null!=e.cachedResult}function O(e){return"0"===e?0:null}},747:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s}));var i,r=n(541),a=n(579),o=n(537);function s(e){e.include(a.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(Object(o.a)(i||(i=Object(r.a)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}function c(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},748:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(2),r=n(3),a=n(11),o=n(65),s=n(7),c=n(35),l=n(100),u=n(546),h=n(30),d=n(60),p=n(58),f=n(79),v=n(406),b=n(557),g=n(762),m=n(578),O=n(678),y=n(566),j=a.a.getLogger("esri.views.3d.webgl-engine.lib.Camera"),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(i.a)(this,e),this._viewUp=Object(f.e)(),this._viewForward=Object(f.e)(),this._viewRight=Object(f.e)(),this._ray=Object(m.c)(),this._viewport=Object(b.g)(0,0,1,1),this._padding=Object(b.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(u.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(u.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(u.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(u.d)(),this._frustumDirty=!0,this._frustum=Object(g.b)(),this._fullViewport=Object(b.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(s.k)(t)&&Object(p.k)(this._ray.origin,t),this._center=Object(s.k)(n)?Object(f.c)(n):Object(f.e)(),this._up=Object(s.k)(r)?Object(f.c)(r):Object(f.g)(0,0,1)}return Object(r.a)(e,[{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return Object(p.j)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){Object(l.f)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(v.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&(Object(l.n)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),i=n*this.aspect;Object(l.l)(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){Object(l.f)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return Object(y.b)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(y.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return Object(y.c)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(y.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return Object(p.m)(this._center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(l.c)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(l.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){Object(p.k)(this._ray.origin,e.eye),Object(p.k)(this._center,e.center),Object(p.k)(this._up,e.up),Object(v.c)(this._viewport,e.viewport),Object(v.c)(this._padding,e.padding),Object(h.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(l.f)(this._viewMatrix,e.viewMatrix),Object(p.k)(this._viewRight,e.viewRight),Object(p.k)(this._viewUp,e.viewUp),Object(p.k)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(l.f)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(g.a)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(l.f)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return Object(p.o)(this.eye,e.eye)&&Object(p.o)(this._center,e.center)&&Object(p.o)(this._up,e.up)&&Object(v.g)(this._viewport,e.viewport)&&Object(v.g)(this._padding,e.padding)&&Object(h.k)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;Object(p.A)(k,e.eye,e.center),Object(p.A)(S,this.eye,this._center);var n=Object(p.h)(k,S),i=Object(p.B)(k),r=Object(p.B)(S);return n*n>=(1-1e-10)*i*r&&Object(p.C)(e.eye,this.eye)<Math.max(i,r)*t*t&&Object(v.i)(e.padding,this._padding)<.5&&Object(v.i)(e.viewport,this._viewport)<.5}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"viewDirectionDistance",value:function(e){return Math.abs(Object(O.d)(this.viewForward,Object(p.j)(k,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.f)();return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*n,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}},{key:"applyProjection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==x&&Object(p.k)(x,e),x[3]=1,n&&(t[2]=-x[2]),Object(v.m)(x,x,this.projectionMatrix),Object(p.e)(x,x,1/Math.abs(x[3]));var i=this.fullViewport;return t[0]=Object(o.j)(0,i[0]+i[2],.5+.5*x[0]),t[1]=Object(o.j)(0,i[1]+i[3],.5+.5*x[1]),n||(t[2]=.5*(x[2]+1)),t}},{key:"projectToScreen",value:function(e,t){this.projectToRenderScreen(e,M),this.renderToScreen(M,t)}},{key:"projectToRenderScreen",value:function(e,t){if(x[0]=e[0],x[1]=e[1],x[2]=e[2],x[3]=1,Object(v.m)(x,x,this.viewProjectionMatrix),0===x[3])return null;Object(p.e)(x,x,1/Math.abs(x[3]));var n=this.fullViewport;return"x"in t?(t.x=Object(o.j)(0,n[0]+n[2],.5+.5*x[0]),t.y=Object(o.j)(0,n[1]+n[3],.5+.5*x[1])):(t[0]=Object(o.j)(0,n[0]+n[2],.5+.5*x[0]),t[1]=Object(o.j)(0,n[1]+n[3],.5+.5*x[1]),t.length>2&&(t[2]=.5*(x[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,M),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if(Object(l.n)(w,this.projectionMatrix,this.viewMatrix),!Object(l.c)(w,w))return null;var n=this.fullViewport;return x[0]=2*(e[0]-n[0])/n[2]-1,x[1]=2*(e[1]-n[1])/n[3]-1,x[2]=2*e[2]-1,x[3]=1,Object(v.m)(x,x,w),0===x[3]?null:(t[0]=x[0]/x[3],t[1]=x[1]/x[3],t[2]=x[2]/x[3],t)}},{key:"constrainWindowSize",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,r=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(r-n/2,0),s=Math.max(this.fullHeight-a-i/2,0),c=-Math.min(r-n/2,0),l=-Math.min(this.fullHeight-a-i/2,0);return[o,s,n-c- -Math.min(this.fullWidth-r-n/2,0),i-l- -Math.min(a-i/2,0)]}},{key:"computeUp",value:function(e){1===e?this.computeUpGlobal():this.computeUpLocal()}},{key:"screenToRender",value:function(e,t){var n=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=i,t}},{key:"renderToScreen",value:function(e,t){var n=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=i}},{key:"computeUpGlobal",value:function(){Object(p.j)(k,this.center,this.eye);var e=Object(p.p)(this.center);e<1?(Object(p.w)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(p.h)(k,this.center))>.9999*Object(p.p)(k)*e||(Object(p.g)(this._up,k,this.center),Object(p.g)(this._up,this._up,k),Object(p.r)(this._up,this._up),this._markViewDirty())}},{key:"computeUpLocal",value:function(){Object(p.v)(k,this.eye,this.center),Math.abs(k[2])<=.9999&&(Object(p.e)(k,k,k[2]),Object(p.w)(this._up,-k[0],-k[1],1-k[2]),Object(p.r)(this._up,this._up),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(p.o)(e,t)||(Object(p.k)(t,e),this._markViewDirty()):j.warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&(Object(g.c)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&(Object(l.m)(this._viewMatrix,this.eye,this._center,this._up),Object(p.w)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(p.w)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(p.w)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),x=Object(b.e)(),w=Object(u.d)(),k=Object(f.e)(),S=Object(f.e)(),M=Object(c.d)()},749:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return y})),n.d(t,"e",(function(){return T})),n.d(t,"f",(function(){return x})),n.d(t,"g",(function(){return w})),n.d(t,"h",(function(){return A})),n.d(t,"i",(function(){return C})),n.d(t,"j",(function(){return j}));var i=n(13),r=n(2),a=(n(12),n(11)),o=n(65),s=n(640),c=n(100),l=n(546),u=n(58),h=n(79),d=n(662),p=n(596),f=n(578),v=n(678),b=n(569),g=a.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;return{plane:Object(p.d)(e.plane),origin:Object(h.c)(e.origin),basis1:Object(h.c)(e.basis1),basis2:Object(h.c)(e.basis2)}}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();return y(e.origin,e.basis1,e.basis2,t)}function y(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m();return Object(u.k)(i.origin,e),Object(u.k)(i.basis1,t),Object(u.k)(i.basis2,n),j(i),G(i,"fromValues()"),i}function j(e){Object(p.i)(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,n){e!==n&&O(e,n);var i=Object(u.e)(b.d.get(),A(e),t);return Object(u.f)(n.origin,n.origin,i),n.plane[3]-=t,n}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m(),n=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return Object(u.w)(t.origin,e[0]+n,e[1]+i,0),Object(u.w)(t.basis1,n,0,0),Object(u.w)(t.basis2,0,i,0),Object(p.h)(0,0,1,0,t.plane),t}function w(e,t,n){return!!Object(p.m)(e.plane,t,n)&&V(e,n)}function k(e,t,n){var r=U.get();L(e,t,r,U.get());var a,s=Number.POSITIVE_INFINITY,c=Object(i.a)(B);try{for(c.s();!(a=c.n()).done;){var l=I(e,a.value,H.get()),h=b.d.get();if(Object(p.k)(r,l,h)){var d=Object(u.v)(b.d.get(),t.origin,h),f=Math.abs(Object(o.a)(Object(u.h)(t.direction,d)));f<s&&(s=f,Object(u.k)(n,h))}}}catch(v){c.e(v)}finally{c.f()}return s===Number.POSITIVE_INFINITY?S(e,t,n):n}function S(e,t,n){if(w(e,t,n))return n;var r=U.get(),a=U.get();L(e,t,r,a);var o,s=Number.POSITIVE_INFINITY,c=Object(i.a)(B);try{for(c.s();!(o=c.n()).done;){var l=I(e,o.value,H.get()),h=b.d.get();if(Object(p.l)(r,l,h)){var d=Object(f.d)(t,h);if(!Object(p.o)(a,h))continue;d<s&&(s=d,Object(u.k)(n,h))}}}catch(v){c.e(v)}finally{c.f()}return P(e,t.origin)<s&&M(e,t.origin,n),n}function M(e,t,n){var i=Object(p.r)(e.plane,t,b.d.get()),r=Object(d.i)(z(e,e.basis1),i,-1,1,b.d.get()),a=Object(d.i)(z(e,e.basis2),i,-1,1,b.d.get());return Object(u.j)(n,Object(u.f)(b.d.get(),r,a),e.origin),n}function E(e,t,n){var i=e.origin,r=e.basis1,a=e.basis2,o=Object(u.j)(b.d.get(),t,i),s=Object(v.d)(r,o),c=Object(v.d)(a,o),l=Object(v.d)(A(e),o);return Object(u.w)(n,s,c,l)}function P(e,t){var n=E(e,t,b.d.get()),i=e.basis1,r=e.basis2,a=Object(u.p)(i),o=Object(u.p)(r),s=Math.max(Math.abs(n[0])-a,0),c=Math.max(Math.abs(n[1])-o,0),l=n[2];return s*s+c*c+l*l}function T(e,t){return Math.sqrt(P(e,t))}function D(e,t){return Object(p.o)(e.plane,t)&&V(e,t)}function R(e,t){var n=-e.plane[3];return Object(v.d)(A(e),t)-n}function C(e,t,n,i){return e!==i&&O(e,i),Object(c.e)(Z,Object(c.j)(Z),t,n),Object(u.q)(i.basis1,e.basis1,Z),Object(u.q)(i.basis2,e.basis2,Z),j(i),i}function A(e){return Object(p.q)(e.plane)}function V(e,t){var n=Object(u.j)(b.d.get(),t,e.origin),i=Object(u.t)(e.basis1),r=Object(u.t)(e.basis2),a=Object(u.h)(e.basis1,n),o=Object(u.h)(e.basis2,n);return-a-i<0&&a-i<0&&-o-r<0&&o-r<0}function z(e,t){var n=H.get();return Object(u.k)(n.origin,e.origin),Object(u.k)(n.vector,t),n}function I(e,t,n){var i=e.basis1,r=e.basis2,a=e.origin,o=Object(u.e)(b.d.get(),i,t.origin[0]),s=Object(u.e)(b.d.get(),r,t.origin[1]);Object(u.f)(n.origin,o,s),Object(u.f)(n.origin,n.origin,a);var c=Object(u.e)(b.d.get(),i,t.direction[0]),l=Object(u.e)(b.d.get(),r,t.direction[1]);return Object(u.e)(n.vector,Object(u.f)(c,c,l),2),n}function G(e,t){Math.abs(Object(u.h)(e.basis1,e.basis2)/(Object(u.p)(e.basis1)*Object(u.p)(e.basis2)))>1e-6&&g.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(u.h)(e.basis1,A(e)))>1e-6&&g.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(u.h)(A(e),e.origin)-e.plane[3])>1e-6&&g.warn(t,"Plane offset is not consistent with plane origin")}function L(e,t,n,i){var r=A(e);Object(p.i)(r,t.direction,t.origin,n),Object(p.i)(Object(p.q)(n),r,t.origin,i)}var F={plane:Object(p.d)(),origin:Object(h.g)(0,0,0),basis1:Object(h.g)(1,0,0),basis2:Object(h.g)(0,1,0)},U=new s.a(p.d),H=new s.a(d.d),N=Object(h.e)(),q=new s.a((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],W=Object(l.d)(),Z=Object(l.d)();Object.freeze({__proto__:null,BoundedPlaneClass:function e(){Object(r.a)(this,e),this.plane=Object(p.d)(),this.origin=Object(h.e)(),this.basis1=Object(h.e)(),this.basis2=Object(h.e)()},create:m,wrap:function(e,t,n){var i=q.get();return i.origin=e,i.basis1=t,i.basis2=n,i.plane=Object(p.u)(0,0,0,0),j(i),i},copy:O,copyWithoutVerify:function(e,t){Object(u.k)(t.origin,e.origin),Object(u.k)(t.basis1,e.basis1),Object(u.k)(t.basis2,e.basis2),Object(p.c)(e.plane,t.plane)},fromValues:y,updateUnboundedPlane:j,elevate:_,setExtent:function(e,t,n){return x(t,n),_(n,R(e,e.origin),n),n},fromAABoundingRect:x,intersectRay:w,intersectRayClosestSilhouette:function(e,t,n){if(w(e,t,n))return n;var i=k(e,t,b.d.get());return Object(u.f)(n,t.origin,Object(u.e)(b.d.get(),t.direction,Object(u.m)(t.origin,i)/Object(u.p)(t.direction))),n},closestPointOnSilhouette:k,closestPoint:S,projectPoint:M,projectPointLocal:E,distance2:P,distance:T,distanceToSilhouette:function(e,t){var n,r=Number.NEGATIVE_INFINITY,a=Object(i.a)(B);try{for(a.s();!(n=a.n()).done;){var o=I(e,n.value,H.get()),s=Object(d.e)(o,t);s>r&&(r=s)}}catch(c){a.e(c)}finally{a.f()}return Math.sqrt(r)},extrusionContainsPoint:D,axisAt:function(e,t,n,i){return function(e,t,n){switch(t){case 0:Object(u.k)(n,e.basis1),Object(u.r)(n,n);break;case 1:Object(u.k)(n,e.basis2),Object(u.r)(n,n);break;case 2:Object(u.k)(n,A(e))}return n}(e,n,i)},altitudeAt:R,setAltitudeAt:function(e,t,n,i){var r=R(e,t),a=Object(u.e)(N,A(e),n-r);return Object(u.f)(i,t,a),i},equals:function(e,t){return Object(u.o)(e.basis1,t.basis1)&&Object(u.o)(e.basis2,t.basis2)&&Object(u.o)(e.origin,t.origin)},transform:function(e,t,n){return e!==n&&O(e,n),Object(c.c)(W,t),Object(c.b)(W,W),Object(u.q)(n.basis1,e.basis1,W),Object(u.q)(n.basis2,e.basis2,W),Object(u.q)(Object(p.q)(n.plane),Object(p.q)(e.plane),W),Object(u.q)(n.origin,e.origin,t),Object(p.s)(n.plane,n.origin,n.plane),n},rotate:C,normal:A,UP:F})},751:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(67),c=n(7),l=n(688),u=function(){function e(t,n,r){Object(i.a)(this,e),this.editGeometry=t,this.component=n,this.pos=r,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}return Object(r.a)(e,[{key:"apply",value:function(){var e="redo";Object(c.j)(this.addedVertex)&&(e="apply",this.addedVertex=new l.d(this.component));var t=this.component.getLastVertex();if(Object(c.j)(t))this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{var n=null;t.rightEdge&&(this.originalEdge=t.rightEdge,n=this.originalEdge.rightVertex,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,Object(c.j)(this.left)&&(this.left=new l.b(this.component,t,this.addedVertex)),this.component.edges.push(this.left),t.rightEdge=this.left,Object(c.k)(this.originalEdge)&&Object(c.k)(n)&&(Object(c.j)(this.right)&&(this.right=new l.b(this.component,this.addedVertex,n)),this.component.edges.push(this.right),n.leftEdge=this.right),this.component.updateVertexIndex(this.addedVertex,t.index+1)}this.editGeometry.notifyChanges({operation:e,addedVertices:[this.addedVertex]})}},{key:"undo",value:function(){if(Object(c.j)(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),Object(c.k)(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.leftVertex.rightEdge=null),Object(c.k)(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.rightVertex.leftEdge=null),Object(c.k)(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.leftVertex.rightEdge=this.originalEdge,this.originalEdge.rightVertex.leftEdge=this.originalEdge),Object(c.k)(this.left)?this.component.updateVertexIndex(this.left.leftVertex,this.left.leftVertex.index):this.component.updateVertexIndex(this.addedVertex,0),this.editGeometry.notifyChanges({operation:"undo",removedVertices:[this.addedVertex]})}},{key:"accumulate",value:function(){return!1}}]),e}(),h=n(859),d=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),this.editGeometry=t,this.vertices=n,this.minNumberOfVertices=r,this.removedVertices=null}return Object(r.a)(e,[{key:"apply",value:function(){var e=this,t="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach((function(t){var n=e._removeVertex(t);Object(c.k)(n)&&e.removedVertices.push(n)})),t="apply"):this.removedVertices.forEach((function(t){e._removeVertex(t.removedVertex)})),this.editGeometry.notifyChanges({operation:t,removedVertices:this.vertices})}},{key:"undo",value:function(){var e=this;this.removedVertices.forEach((function(t){e._undoRemoveVertex(t)})),this.editGeometry.notifyChanges({operation:"undo",addedVertices:this.vertices})}},{key:"accumulate",value:function(){return!1}},{key:"_removeVertex",value:function(e){var t=e.component;if(t.vertices.length<=this.minNumberOfVertices)return null;var n={removedVertex:e,createdEdge:null},i=e.leftEdge,r=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),i&&(t.edges.splice(t.edges.indexOf(i),1),i.leftVertex.rightEdge=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===e.index&&r&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.rightVertex),0),i&&r&&(n.createdEdge=new l.b(t,i.leftVertex,r.rightVertex),t.edges.push(n.createdEdge)),r&&t.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}},{key:"_undoRemoveVertex",value:function(e){var t=e.removedVertex,n=e.removedVertex.component,i=t.leftEdge,r=t.rightEdge;e.createdEdge&&n.edges.splice(n.edges.indexOf(e.createdEdge),1),n.vertices.push(t),i&&(n.edges.push(i),i.leftVertex.rightEdge=i),r&&(n.edges.push(r),r.rightVertex.leftEdge=r),n.updateVertexIndex(t,t.index)}}]),e}(),p=function(){function e(t,n,r){Object(i.a)(this,e),this.editGeometry=t,this.edge=n,this.t=r,this.createdVertex=null,this.left=null,this.right=null}return Object(r.a)(e,[{key:"apply",value:function(){var e="redo",t=this.edge,n=t.component,i=t.leftVertex,r=t.rightVertex;n.edges.splice(n.edges.indexOf(t),1),Object(c.j)(this.createdVertex)&&(e="apply",this.createdVertex=new l.d(t.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this.editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this.t,this.editGeometry.coordinateHelper.createVector()),Object(c.j)(this.left)&&(this.left=new l.b(n,i,this.createdVertex)),this.left.leftVertex.leftEdge?n.edges.push(this.left):n.edges.unshift(this.left),i.rightEdge=this.left,Object(c.j)(this.right)&&(this.right=new l.b(n,this.createdVertex,r)),n.edges.push(this.right),r.leftEdge=this.right,n.updateVertexIndex(this.createdVertex,i.index+1),this.editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}},{key:"undo",value:function(){if(Object(c.j)(this.createdVertex)||Object(c.j)(this.left)||Object(c.j)(this.right))return null;var e=this.edge,t=e.component,n=this.createdVertex.leftEdge,i=this.createdVertex.rightEdge,r=n.leftVertex,a=i.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.leftVertex.leftEdge?t.edges.push(this.edge):t.edges.unshift(this.edge),r.rightEdge=e,a.leftEdge=e,t.updateVertexIndex(r,r.index),this.editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}},{key:"accumulate",value:function(){return!1}}]),e}(),f=function(){function e(t,n,r){Object(i.a)(this,e),this.editGeometry=t,this.vertex=n,this.pos=r}return Object(r.a)(e,[{key:"apply",value:function(){var e=Object(c.j)(this.originalPosition);e&&(this.originalPosition=this.vertex.pos),this._apply(e?"apply":"redo")}},{key:"undo",value:function(){this.vertex.pos=Object(c.s)(this.originalPosition),this.editGeometry.notifyChanges({operation:"undo",updatedVertices:[this.vertex]})}},{key:"accumulate",value:function(t){return t instanceof e&&t.vertex===this.vertex&&(this.pos=t.pos,this._apply("apply"),!0)}},{key:"_apply",value:function(e){this.vertex.pos=this.pos,this.editGeometry.components.forEach((function(e){return e.unnormalizeVertexPositions()})),this.editGeometry.notifyChanges({operation:e,updatedVertices:[this.vertex]})}}]),e}(),v=n(102),b=function(){function e(t,n){Object(i.a)(this,e),this.editGeometry=t,this.component=n,this.createdEdge=null}return Object(r.a)(e,[{key:"apply",value:function(){var e="redo";if(Object(c.j)(this.createdEdge)){e="apply";var t=this.component.getFirstVertex(),n=this.component.getLastVertex();if(this.component.isClosed()||this.component.vertices.length<3||Object(c.j)(t)||Object(c.j)(n))return;this.createdEdge=new l.b(this.component,n,t)}this.createdEdge.leftVertex.rightEdge=this.createdEdge,this.createdEdge.rightVertex.leftEdge=this.createdEdge,this.component.edges.push(this.createdEdge),this.editGeometry.notifyChanges({operation:e})}},{key:"undo",value:function(){Object(c.j)(this.createdEdge)||(Object(v.i)(this.component.edges,this.createdEdge),this.createdEdge.leftVertex.rightEdge=null,this.createdEdge.rightVertex.leftEdge=null,this.editGeometry.notifyChanges({operation:"undo"}))}},{key:"accumulate",value:function(){return!1}}]),e}(),g=n(860),m=n(861),O=n(862),y=n(863),j=n(13),_=function(){function e(){Object(i.a)(this,e),this.operations=[],this.closed=!1}return Object(r.a)(e,[{key:"close",value:function(){this.closed=!0}},{key:"apply",value:function(){var e,t=Object(j.a)(this.operations);try{for(t.s();!(e=t.n()).done;){e.value.apply()}}catch(n){t.e(n)}finally{t.f()}}},{key:"undo",value:function(){for(var e=this.operations.length-1;e>=0;e--)this.operations[e].undo()}},{key:"accumulate",value:function(e){if(this.closed)return!1;var t=this.operations.length?this.operations[this.operations.length-1]:null;return t&&t.accumulate(e)||(this.operations.push(e),e.apply()),!0}}]),e}(),x=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this)).data=e,r.undoStack=[],r.redoStack=[],r.listener=r.data.on("change",(function(e){e.addedVertices&&r.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&r.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&r.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})})),r}return Object(r.a)(n,[{key:"destroy",value:function(){this.listener.remove()}},{key:"splitEdge",value:function(e,t){return this.apply(new p(this.data,e,t))}},{key:"updateVertices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.apply(new h.a(this.data,e,t),n)}},{key:"moveVertices",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this.updateVertices(e,new g.a(this.data.coordinateHelper,t,n,i),r)}},{key:"scaleVertices",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.updateVertices(e,new y.a(t,n,i,r,o),a)}},{key:"rotateVertices",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.updateVertices(e,new O.a(t,n,r),i)}},{key:"removeVertices",value:function(e){return this.apply(new d(this.data,e,this._minNumVerticesPerType))}},{key:"appendVertex",value:function(e){return 0===this.data.components.length?null:this.apply(new u(this.data,this.data.components[0],e))}},{key:"setVertexPosition",value:function(e,t){return this.apply(new f(this.data,e,t))}},{key:"offsetEdge",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.updateVertices([t.leftVertex,t.rightVertex],new m.a(this.data.coordinateHelper,e,t,n),i)}},{key:"closeComponent",value:function(e){return this.data.components.includes(e)?this.apply(new b(this.data,e)):null}},{key:"canRemoveVertex",value:function(){return this.data.components[0].vertices.length>this._minNumVerticesPerType}},{key:"createUndoGroup",value:function(){var e=new _;return this.apply(e),{remove:function(){return e.close()}}}},{key:"undo",value:function(){if(this.undoStack.length>0){var e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null}},{key:"redo",value:function(){if(this.redoStack.length>0){var e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null}},{key:"canUndo",get:function(){return this.undoStack.length>0}},{key:"canRedo",get:function(){return this.redoStack.length>0}},{key:"lastOperation",get:function(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}},{key:"_minNumVerticesPerType",get:function(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}},{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 0!==t&&!Object(c.j)(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[]),e}}],[{key:"fromGeometry",value:function(e,t){return new n(l.c.fromGeometry(e,t))}}]),n}(s.a)},754:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(680),l=n(624),u=n(612),h=n(728),d=n(619),p=n(0),f=n(556),v=n(574),b=n(567),g=n(641),m=n(608),O=n(617),y=n(623),j=n(618),_=n(609),x=n(700),w=n(821),k=n(543),S=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new _.a(e.rctx,r,j.a)}},{key:"bindPass",value:function(e,t){Object(g.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(v.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(b.a)(this.program,t))}},{key:"bindDraw",value:function(e){Object(g.d)(this.program,e),this.program.rebindTextures(),Object(f.c)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e,t){var n=this.configuration,i=3===e,r=2===e;return Object(k.f)({blending:0!==n.output&&7!==n.output||!n.transparent?null:i?u.g:Object(u.a)(e),culling:Object(k.b)(n.cullFace),depthTest:{func:Object(u.b)(e)},depthWrite:i||r?n.writeDepth&&k.d:null,colorWrite:k.c,stencilWrite:n.sceneHasOcludees?x.h:null,stencilTest:n.sceneHasOcludees?t?x.d:x.c:null,polygonOffset:i||r?n.polygonOffset&&M:Object(u.h)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(O.a);S.shader=new m.a(w.a,(function(){return n.e(201).then(n.bind(null,1108))}));var M={factor:1,units:1},E=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(y.a);Object(p.a)([Object(y.b)({count:8})],E.prototype,"output",void 0),Object(p.a)([Object(y.b)({count:3})],E.prototype,"cullFace",void 0),Object(p.a)([Object(y.b)()],E.prototype,"slicePlaneEnabled",void 0),Object(p.a)([Object(y.b)()],E.prototype,"vertexColors",void 0),Object(p.a)([Object(y.b)()],E.prototype,"transparent",void 0),Object(p.a)([Object(y.b)()],E.prototype,"polygonOffset",void 0),Object(p.a)([Object(y.b)()],E.prototype,"enableOffset",void 0),Object(p.a)([Object(y.b)()],E.prototype,"writeDepth",void 0),Object(p.a)([Object(y.b)()],E.prototype,"sceneHasOcludees",void 0),Object(p.a)([Object(y.b)({count:4})],E.prototype,"transparencyPassType",void 0),Object(p.a)([Object(y.b)()],E.prototype,"multipassTerrainEnabled",void 0),Object(p.a)([Object(y.b)()],E.prototype,"cullAboveGround",void 0);var P=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,D)).supportsEdges=!0,i.techniqueConfig=new E,i}return Object(a.a)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<u.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,n,i,r,a,o){Object(d.f)(e,t,i,r,a,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new T(e):void 0}},{key:"createBufferWriter",value:function(){return new h.a(h.b)}}]),n}(l.a),T=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(n,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(S,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),n}(c.a),D=Object(i.a)({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1},l.b)},755:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(13),r=n(2),a=n(3),o=n(21),s=function(){function e(){Object(r.a)(this,e),this._tasks=new Array}return Object(a.a)(e,[{key:"length",get:function(){return this._tasks.length}},{key:"push",value:function(e,t,n){var i=this;return new Promise((function(r,a){return i._tasks.push(new c(r,a,e,t,n))}))}},{key:"unshift",value:function(e,t,n){var i=this;return new Promise((function(r,a){return i._tasks.unshift(new c(r,a,e,t,n))}))}},{key:"process",value:function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=Object(o.n)(e.signal);if(t&&!e.abortCallback)e.reject(Object(o.e)());else{var n=t?e.abortCallback(Object(o.e)()):e.callback();Object(o.o)(n)?n.then(e.resolve,e.reject):e.resolve(n)}}catch(c){e.reject(c)}return!0}},{key:"cancelAll",value:function(){var e,t=Object(o.e)(),n=Object(i.a)(this._tasks);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.abortCallback){var a=r.abortCallback(t);r.resolve(a)}else r.reject(t)}}catch(s){n.e(s)}finally{n.f()}this._tasks.length=0}}]),e}(),c=function e(t,n,i,a,o){Object(r.a)(this,e),this.resolve=t,this.reject=n,this.callback=i,this.signal=a,this.abortCallback=o}},756:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(65);function r(e,t,n){var r,l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t),h=new Uint32Array(l),d=null!=(r=null==n?void 0:n.minReduction)?r:0,p=(null==n?void 0:n.originalIndices)||null,f=p?p.length:0,v=(null==n?void 0:n.componentOffsets)||null,b=0;if(v)for(var g=0;g<v.length-1;g++){var m=v[g+1]-v[g];m>b&&(b=m)}else b=l;var O=Math.floor(1.1*b)+1;(null==c||c.length<2*O)&&(c=new Uint32Array(Object(i.l)(2*O)));for(var y=0;y<2*O;y++)c[y]=0;for(var j=0,_=!!v&&!!p,x=_?f:l,w=_?new Uint32Array(f):null,k=1.96,S=0!==d?Math.ceil(4*k*k/(d*d)*d*(1-d)):x,M=1,E=v?v[1]:x,P=0;P<x;P++){if(P===S){var T=1-j/P;if(T+k*Math.sqrt(T*(1-T)/P)<d)return null;S*=2}if(P===E){for(var D=0;D<2*O;D++)c[D]=0;if(p)for(var R=v[M-1];R<v[M];R++)w[R]=h[p[R]];E=v[++M]}for(var C=_?p[P]:P,A=C*t,V=s(u,A,t),z=V%O,I=j;0!==c[2*z+1];){if(c[2*z]===V){var G=c[2*z+1]-1;if(a(u,A,G*t,t)){I=h[G];break}}++z>=O&&(z-=O)}I===j&&(c[2*z]=V,c[2*z+1]=C+1,j++),h[C]=I}if(0!==d&&1-j/l<d)return null;if(_){for(var L=v[M-1];L<w.length;L++)w[L]=h[p[L]];h=w}var F=new Uint32Array(t*j);j=0;for(var U=0;U<x;U++)h[U]===j&&(o(u,(_?p[U]:U)*t,F,j*t,t),j++);if(p&&!_){for(var H=new Uint32Array(f),N=0;N<H.length;N++)H[N]=h[p[N]];h=H}return{buffer:F.buffer,indices:h,uniqueCount:j}}function a(e,t,n,i){for(var r=0;r<i;r++)if(e[t+r]!==e[n+r])return!1;return!0}function o(e,t,n,i,r){for(var a=0;a<r;a++)n[i+a]=e[t+a]}function s(e,t,n){for(var i=0,r=0;r<n;r++)i=(i=e[t+r]+i|0)+(i<<11)+(i>>>2)|0;return i>>>0}var c=null},760:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return u}));var i=n(23),r=n(65),a=n(139),o=n(303),s=n(177);function c(e,t,n,i){if(null==i||e.hasZ||(i=void 0),"point"===e.type)return e.x+=t,e.y+=n,e.hasZ&&null!=i&&(e.z+=i),e;if("multipoint"===e.type){for(var r=e.points,a=0;a<r.length;a++)r[a]=p(r[a],t,n,i);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=n,e.ymax+=n,null!=i&&(e.zmin+=i,e.zmax+=i),e;for(var o=Object(s.b)(e),c="polyline"===e.type?e.paths:e.rings,l=0;l<o.length;l++)for(var u=o[l],h=0;h<u.length;h++)u[h]=p(u[h],t,n,i);return"paths"in e?e.paths=c:e.rings=c,e}function l(e,t,n,i,r){var a=e.clone(),o=i.resolution;if("point"===a.type){if(r)c(a,t*o,-n*o);else{var l=i.state.transform,u=i.state.inverseTransform,h=l[0]*a.x+l[2]*a.y+l[4],d=l[1]*a.x+l[3]*a.y+l[5];a.x=u[0]*(h+t)+u[2]*(d+n)+u[4],a.y=u[1]*(h+t)+u[3]*(d+n)+u[5]}return a}if("multipoint"===a.type){if(r)c(a,t*o,-n*o);else for(var p=a.points,v=i.state.transform,b=i.state.inverseTransform,g=0;g<p.length;g++){var m=p[g],O=v[0]*m[0]+v[2]*m[1]+v[4],y=v[1]*m[0]+v[3]*m[1]+v[5],j=b[0]*(O+t)+b[2]*(y+n)+b[4],_=b[1]*(O+t)+b[3]*(y+n)+b[5];p[g]=f(m,j,_,void 0)}return a}if("extent"===a.type){if(r)c(a,t*o,-n*o);else{var x=i.state.transform,w=i.state.inverseTransform,k=x[0]*a.xmin+x[2]*a.ymin+x[4],S=x[1]*a.xmin+x[3]*a.ymin+x[5],M=x[0]*a.xmax+x[2]*a.ymax+x[4],E=x[1]*a.xmax+x[3]*a.ymax+x[5];a.xmin=w[0]*(k+t)+w[2]*(S+n)+w[4],a.ymin=w[1]*(k+t)+w[3]*(S+n)+w[5],a.xmax=w[0]*(M+t)+w[2]*(E+n)+w[4],a.ymax=w[1]*(M+t)+w[3]*(E+n)+w[5]}return a}if(r)c(a,t*o,-n*o);else{for(var P=Object(s.b)(a),T="polyline"===a.type?a.paths:a.rings,D=i.state.transform,R=i.state.inverseTransform,C=0;C<P.length;C++)for(var A=P[C],V=0;V<A.length;V++){var z=A[V],I=D[0]*z[0]+D[2]*z[1]+D[4],G=D[1]*z[0]+D[3]*z[1]+D[5],L=R[0]*(I+t)+R[2]*(G+n)+R[4],F=R[1]*(I+t)+R[3]*(G+n)+R[5];A[V]=f(z,L,F,void 0)}"paths"in a?a.paths=T:a.rings=T}return a}function u(e,t,n,r){if("point"===e.type){var c=e.x,l=e.y,u=r?r[0]:c,h=r?r[1]:l,d=e.clone(),p=(c-u)*t+u,v=(l-h)*n+h;return d.x=p,d.y=v,d}if("multipoint"===e.type){for(var b=Object(s.b)(e),g=Object(a.l)(),m=Object(o.d)(g,[b]),O=Object(i.a)(m,4),y=O[0],j=O[1],_=O[2],x=O[3],w=r?r[0]:(y+_)/2,k=r?r[1]:(x+j)/2,S=e.clone(),M=S.points,E=0;E<M.length;E++){var P=M[E],T=Object(i.a)(P,2),D=(T[0]-w)*t+w,R=(T[1]-k)*n+k;M[E]=f(P,D,R,void 0)}return S}if("extent"===e.type){var C=e.xmin,A=e.xmax,V=e.ymin,z=e.ymax,I=r?r[0]:(C+A)/2,G=r?r[1]:(z+V)/2,L=e.clone();if(L.xmin=(C-I)*t+I,L.ymax=(z-G)*n+G,L.xmax=(A-I)*t+I,L.ymin=(V-G)*n+G,L.xmin>L.xmax){var F=L.xmin,U=L.xmax;L.xmin=U,L.xmax=F}if(L.ymin>L.ymax){var H=L.ymin,N=L.ymax;L.ymin=N,L.ymax=H}return L}for(var q=Object(s.b)(e),B=Object(a.l)(),W=Object(o.d)(B,q),Z=Object(i.a)(W,4),X=Z[0],Y=Z[1],Q=Z[2],J=Z[3],K=r?r[0]:(X+Q)/2,$=r?r[1]:(J+Y)/2,ee=e.clone(),te="polyline"===ee.type?ee.paths:ee.rings,ne=0;ne<q.length;ne++)for(var ie=q[ne],re=0;re<ie.length;re++){var ae=ie[re],oe=Object(i.a)(ae,2),se=(oe[0]-K)*t+K,ce=(oe[1]-$)*n+$;te[ne][re]=f(ae,se,ce,void 0)}return"paths"in ee?ee.paths=te:ee.rings=te,ee}function h(e,t,n,i,r,a){var o=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t));return Math.sqrt((r-e)*(r-e)+(a-t)*(a-t))/o}function d(e,t,n){var i=Math.atan2(t.y-n.y,t.x-n.x)-Math.atan2(e.y-n.y,e.x-n.x),a=Math.atan2(Math.sin(i),Math.cos(i));return Object(r.n)(a)}function p(e,t,n,i){return f(e,e[0]+t,e[1]+n,null!=e[2]&&null!=i?e[2]+i:void 0)}function f(e,t,n,i){var r=[t,n];return e.length>2&&r.push(null!=i?i:e[2]),e.length>3&&r.push(e[3]),r}},761:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(2),r=n(5),a=n(6),o=n(0),s=n(29),c=n(1),l=(n(12),n(15),n(11),n(8)),u=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments)).SCHEDULER_LOG_SLOW_TASKS=!1,e.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1,e}return n}(s.a);Object(o.a)([Object(c.b)()],u.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(o.a)([Object(c.b)()],u.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);var h=new(u=Object(o.a)([Object(l.a)("esri.views.support.DebugFlags")],u))},762:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return g})),n.d(t,"e",(function(){return b}));var i=n(640),r=n(100),a=n(58),o=n(79),s=n(406),c=n(557),l=n(815),u=n(596),h=n(569);function d(e){return e?[Object(u.d)(e[0]),Object(u.d)(e[1]),Object(u.d)(e[2]),Object(u.d)(e[3]),Object(u.d)(e[4]),Object(u.d)(e[5])]:[Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)()]}function p(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d(),n=0;n<6;n++)Object(u.c)(e[n],t[n])}function f(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O,o=Object(r.n)(h.a.get(),t,e);Object(r.c)(o,o);for(var c=0;c<8;++c){var l=Object(s.m)(h.e.get(),m[c],o);Object(a.w)(i[c],l[0]/l[3],l[1]/l[3],l[2]/l[3])}v(n,i)}function v(e,t){Object(u.f)(t[4],t[0],t[3],e[0]),Object(u.f)(t[1],t[5],t[6],e[1]),Object(u.f)(t[4],t[5],t[1],e[2]),Object(u.f)(t[3],t[2],t[6],e[3]),Object(u.f)(t[0],t[1],t[2],e[4]),Object(u.f)(t[5],t[4],t[7],e[5])}function b(e,t){for(var n=0;n<6;n++){var i=e[n];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function g(e,t){for(var n=0;n<6;n++){var i=e[n];if(!Object(u.b)(i,t))return!1}return!0}var m=[Object(c.g)(-1,-1,-1,1),Object(c.g)(1,-1,-1,1),Object(c.g)(1,1,-1,1),Object(c.g)(-1,1,-1,1),Object(c.g)(-1,-1,1,1),Object(c.g)(1,-1,1,1),Object(c.g)(1,1,1,1),Object(c.g)(-1,1,1,1)],O=(new i.a(l.a),[Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)(),Object(o.e)()])},763:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i,r,a,o,s,c,l=n(541),u=n(686),h=n(714),d=n(537);function p(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){e.fragment.include(h.a);var n=t.draped&&u.a.ENABLE_CONTINUOUS_LINE_PATTERNS;n?e.vertex.uniforms.add("worldToScreenRatio","float"):e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),n&&e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),n?e.fragment.code.add(Object(d.a)(i||(i=Object(l.a)(["float getStippleValue() {\nreturn rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUv * stipplePatternPixelSizeInv, 1.0), 0.5)));\n}"])))):e.fragment.code.add(Object(d.a)(r||(r=Object(l.a)(["\n      float getStippleValue() {\n        float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n        ","\n        return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)));\n      }\n    "])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),e.fragment.code.add(Object(d.a)(a||(a=Object(l.a)(["float getStippleSDF() {\nreturn (getStippleValue() * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n}\nfloat getStippleAlpha() {\nreturn clamp(getStippleSDF() + 0.5, 0.0, 1.0);\n}"])))),t.stippleOffColorEnabled?e.fragment.code.add(Object(d.a)(o||(o=Object(l.a)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"])))):e.fragment.code.add(Object(d.a)(s||(s=Object(l.a)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add(Object(d.a)(c||(c=Object(l.a)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}},764:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s}));var i=n(2),r=n(7),a=n(819),o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),this.array=t,this.spatialReference=n,this.offset=r};function s(e){return"array"in e}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if(Object(a.a)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(s(t)){var i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,Object(r.t)(t.spatialReference,e.spatialReference),n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},770:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(0),c=n(29),l=n(11),u=n(7),h=n(21),d=n(1),p=(n(12),n(15),n(8)),f=n(338),v=n(13),b=n(31),g=function(){function e(){Object(i.a)(this,e),this._isToolEditable=!0,this._manipulators=new b.a,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}return Object(r.a)(e,[{key:"isToolEditable",set:function(e){this._isToolEditable=e}},{key:"length",get:function(){return this._manipulators.length}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.addMany([e],t)[0]}},{key:"addMany",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map((function(e){var i=t._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:n,attached:!1};return t._manipulators.add(r),t._attached&&t._updateManipulatorAttachment(r),i}))}},{key:"remove",value:function(e){if("number"==typeof e){for(var t=e,n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).id===t){var i=this._manipulators.splice(n,1)[0];return this._detachManipulator(i),i.id}return null}for(var r=e,a=0;a<this._manipulators.length;a++)if(this._manipulators.getItemAt(a).manipulator===r){var o=this._manipulators.splice(a,1)[0];return this._detachManipulator(o),o.id}return null}},{key:"removeAll",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._manipulators.removeAll()}},{key:"attach",value:function(){var e=this;this._manipulators.forEach((function(t){e._updateManipulatorAttachment(t)})),this._attached=!0}},{key:"detach",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._attached=!1}},{key:"destroy",value:function(){this._manipulators.forEach((function(e){var t=e.manipulator;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}},{key:"on",value:function(e,t){return this._manipulators.on(e,(function(e){t(e)}))}},{key:"forEach",value:function(e){var t,n=Object(v.a)(this._manipulators.items);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(i){n.e(i)}finally{n.f()}}},{key:"some",value:function(e){return this._manipulators.items.some(e)}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){return e.push(t.manipulator)})),e}},{key:"intersect",value:function(e,t){var n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((function(r){var a=r.id,o=r.manipulator;if(r.attached&&o.interactive){var s=o.intersectionDistance(e,t);Object(u.k)(s)&&s<i&&(i=s,n={id:a,manipulator:o})}})),n}},{key:"findById",value:function(e){if(Object(u.j)(e))return null;var t,n=Object(v.a)(this._manipulators.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(e===i.id)return i.manipulator}}catch(r){n.e(r)}finally{n.f()}return null}},{key:"_updateManipulatorAttachment",value:function(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}},{key:"_attachManipulator",value:function(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}},{key:"_detachManipulator",value:function(e){if(e.attached){var t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}}},{key:"_isManipulatorItemVisible",value:function(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}]),e}(),m=l.a.getLogger("esri.views.interactive.InteractiveToolBase"),O=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).toolState="pending",r.completed=!1,r.manipulators=new g,r.updating=!1,r.automaticManipulatorSelection=!0,r._editableFlags=new Map([[1,!0],[0,!0]]),r._creationStartedResolver=Object(h.g)(),r._creationFinishedResolver=Object(h.g)(),r}return Object(r.a)(n,[{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(e){this._set("visible",e),e||this.active&&(this.view.activeTool=null),this.attached&&(e?this._show():this._hide())}},{key:"editable",get:function(){return this.getEditableFlag(0)},set:function(e){this.setEditableFlag(0,e)}},{key:"attached",get:function(){return this._get("attached")}},{key:"created",get:function(){return"created"===this.toolState}},{key:"cursor",get:function(){return null}},{key:"attach",value:function(){this.attached?m.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}},{key:"detach",value:function(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):m.error("Tool isn't currently attached. Ignoring detach request.")}},{key:"activate",value:function(){Object(u.j)(this.view)?m.error("Can't activate tool if view is not defined."):this.active?m.warn("Tool is already active, ignoring activation request."):(Object(f.b)(this.view)&&this.view.focus(),this.onActivate())}},{key:"deactivate",value:function(){this.active?this.onDeactivate():m.warn("Tool is not active, ignoring deactivation request.")}},{key:"handleInputEvent",value:function(e){this.attached?this.onInputEvent(e):m.warn("handleInputEvent() called on detached tool")}},{key:"handleInputEventAfter",value:function(e){this.attached?this.onInputEventAfter(e):m.warn("handleInputEventAfter() called on detached tool")}},{key:"destroy",value:function(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}},{key:"setEditableFlag",value:function(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()}},{key:"getEditableFlag",value:function(e){return this._editableFlags.get(e)}},{key:"whenCreationStarted",value:function(){return this._creationStartedResolver.promise}},{key:"when",value:function(){return this._creationFinishedResolver.promise}},{key:"rejectCreation",value:function(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onAttach",value:function(){}},{key:"onDetach",value:function(){}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onEditableChange",value:function(){}},{key:"onInputEvent",value:function(e){}},{key:"onInputEventAfter",value:function(e){}},{key:"internallyEditable",get:function(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}},{key:"startToolCreation",value:function(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error("Unexpected tool state ".concat(this.toolState))}},{key:"finishToolCreation",value:function(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error("Unexpected tool state ".concat(this.toolState))}}},{key:"complete",value:function(){this.finishToolCreation(),this._set("completed",!0)}},{key:"_show",value:function(){this._updateManipulatorAttachment(),this.onShow()}},{key:"_hide",value:function(){this._updateManipulatorAttachment(),this.onHide()}},{key:"_updateManipulatorAttachment",value:function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}}]),n}(c.a);Object(s.a)([Object(d.b)()],O.prototype,"toolState",void 0),Object(s.a)([Object(d.b)({constructOnly:!0})],O.prototype,"view",void 0),Object(s.a)([Object(d.b)({readOnly:!0})],O.prototype,"active",null),Object(s.a)([Object(d.b)({value:!0})],O.prototype,"visible",null),Object(s.a)([Object(d.b)({value:!0})],O.prototype,"editable",null),Object(s.a)([Object(d.b)({value:!1,readOnly:!0})],O.prototype,"attached",null),Object(s.a)([Object(d.b)({readOnly:!0})],O.prototype,"created",null),Object(s.a)([Object(d.b)({readOnly:!0})],O.prototype,"completed",void 0),Object(s.a)([Object(d.b)({readOnly:!0})],O.prototype,"manipulators",void 0),Object(s.a)([Object(d.b)({readOnly:!0})],O.prototype,"updating",void 0),Object(s.a)([Object(d.b)()],O.prototype,"cursor",null),Object(s.a)([Object(d.b)()],O.prototype,"automaticManipulatorSelection",void 0),O=Object(s.a)([Object(p.a)("esri.views.interactive.InteractiveToolBase")],O)},771:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(13),r=n(2),a=n(3),o=n(5),s=n(6),c=n(67),l=n(68),u=n(7),h=n(212),d=n(744),p=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"],f=n(864),v=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i,a,o,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(r.a)(this,n),(i=t.call(this)).apiLayerUid=u,i.type=0,i.events=new c.a,i.isSliceable=!1,i._objects=new h.a,i._stageHandles=new l.a,i.apiLayerUid=u,i.isVisible=null==(a=null==e?void 0:e.isVisible)||a,i.isPickable=null==(o=null==e?void 0:e.isPickable)||o,i.updatePolicy=null!=(s=null==e?void 0:e.updatePolicy)?s:0,i}return Object(a.a)(n,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var n,r=Object(i.a)(p);try{var a=function(){var i=n.value;t._stageHandles.add(t.events.on(i,(function(t){return e.handleEvent(i,t)})))};for(r.s();!(n=r.n()).done;)a()}catch(o){r.e(o)}finally{r.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(u.k)(this._octree)&&this._octree.add([e])}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(u.k)(this._octree)&&this._octree.remove([e]))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,n=Object(i.a)(e);try{for(n.s();!(t=n.n()).done;){t.value.parentLayer=this}}catch(r){n.e(r)}finally{n.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(u.k)(this._octree)&&this._octree.add(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var n,r=Object(i.a)(t);try{for(r.s();!(n=r.n()).done;){n.value.parentLayer=null}}catch(a){r.e(a)}finally{r.f()}this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(u.k)(this._octree)&&this._octree.remove(t)}}},{key:"sync",value:function(){Object(u.k)(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){Object(u.k)(this._octree)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return Object(u.j)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=Object(u.e)(this._octree)}},{key:"_createOctree",value:function(){this._octree=new f.a((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)}}]),n}(d.a)},785:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s}));var i=n(13),r=n(616),a=n(177),o=n(756);function s(e){var t,n=c(e.rings,e.hasZ,1),a=[],s=0,l=0,u=Object(i.a)(n.polygons);try{var h=function(){var e=t.value,i=e.count,o=e.index,c=new Float64Array(n.position.buffer,3*o*n.position.BYTES_PER_ELEMENT,3*i),u=e.holeIndices.map((function(e){return e-o})),h=new Uint32Array(Object(r.a)(c,u,3));a.push({position:c,faces:h}),s+=c.length,l+=h.length};for(u.s();!(t=u.n()).done;)h()}catch(f){u.e(f)}finally{u.f()}var d=function(e,t,n){if(1===e.length)return e[0];var r,a=new Float64Array(t),o=new Uint32Array(n),s=0,c=0,l=0,u=Object(i.a)(e);try{for(u.s();!(r=u.n()).done;){for(var h=r.value,d=0;d<h.position.length;d++)a[s++]=h.position[d];for(var p=0;p<h.faces.length;p++)o[c++]=h.faces[p]+l;l=s/3}}catch(f){u.e(f)}finally{u.f()}return{position:a,faces:o}}(a,s,l),p=Object(o.a)(d.position.buffer,6,{originalIndices:d.faces});return d.position=new Float64Array(p.buffer),d.faces=p.indices,d}function c(e,t,n){for(var i=e.length,r=new Array(i),a=new Array(i),o=new Array(i),s=0,c=0,h=0,d=0,p=0;p<i;++p)d+=e[p].length;for(var f=new Float64Array(3*d),v=0,b=i-1;b>=0;b--){var g=e[b],m=1===n&&u(g);if(m&&1!==i)r[s++]=g;else{for(var O=g.length,y=0;y<s;++y)O+=r[y].length;var j={index:v,pathLengths:new Array(s+1),count:O,holeIndices:new Array(s)};j.pathLengths[0]=g.length,g.length>0&&(o[h++]={index:v,count:g.length}),v=m?l(g,g.length-1,-1,f,v,g.length,t):l(g,0,1,f,v,g.length,t);for(var _=0;_<s;++_){var x=r[_];j.holeIndices[_]=v,j.pathLengths[_+1]=x.length,x.length>0&&(o[h++]={index:v,count:x.length}),v=l(x,0,1,f,v,x.length,t)}s=0,j.count>0&&(a[c++]=j)}}for(var w=0;w<s;++w){var k=r[w];k.length>0&&(o[h++]={index:v,count:k.length}),v=l(k,0,1,f,v,k.length,t)}return c<i&&(a.length=c),h<i&&(o.length=h),{position:f,polygons:a,outlines:o}}function l(e,t,n,i,r,a,o){r*=3;for(var s=0;s<a;++s){var c=e[t];i[r++]=c[0],i[r++]=c[1],i[r++]=o?c[2]:0,t+=n}return r/3}function u(e){return!Object(a.g)(e,!1,!1)}},786:function(e,t,n){"use strict";n.r(t),n.d(t,"hydratedAdapter",(function(){return c}));var i=n(48),r=n(196),a=n(47),o=n(90),s=n(101),c={convertToGEGeometry:function(e,t){if(null==t)return null;var n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n},exportPoint:function(e,t,n){var i=e.hasZ(t),r=e.hasM(t),o=new a.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return i&&(o.z=e.getPointZ(t)),r&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,n){var i=new o.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportPolyline:function(e,t,n){var i=new s.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportMultipoint:function(e,t,n){var i=new r.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return i.cache._geVersion=t,i},exportExtent:function(e,t,n){var r=e.hasZ(t),a=e.hasM(t),o=new i.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(r){var s=e.getZExtent(t);o.zmin=s.vmin,o.zmax=s.vmax}if(a){var c=e.getMExtent(t);o.mmin=c.vmin,o.mmax=c.vmax}return o.cache._geVersion=t,o}}},787:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(4),r=n.n(i),a=n(9),o=n(10),s=n(2),c=n(3),l=n(7),u=n(21),h=n(669),d=n(652),p=n(724),f=n(679),v=function(){function e(){Object(s.a)(this,e),this.next=new d.a}return Object(c.a)(e,[{key:"createSnapDragEventPipelineStep",value:function(e){var t=this,n=e.predicate,i=void 0===n?function(){return!0}:n,s=e.cancel,c=e.snappingManager,v=e.snappingContext,b=e.updatingHandles;if(Object(l.j)(c))return function(e){return e};var g=null,m=null,O=function(){g=Object(l.a)(g),c.doneSnapping(),Object(l.k)(m)&&m.frameTask.remove(),m=null};return s.next((function(e){return O(),e})),this.next=new d.a,function(e){if(!i(e))return e;if(g=Object(l.a)(g),"start"===e.action){var n="3d"===c.view.type?c.view.resourceController.scheduler.registerTask(f.b.SNAPPING):f.a;m={context:new p.a({editGeometryOperations:v.editGeometryOperations,elevationInfo:v.elevationInfo,pointer:v.pointer,vertexHandle:Object(l.k)(e.info)?e.info.handle:null,excludeFeature:v.excludeFeature,visualizer:v.visualizer}),originalPos:Object(l.k)(e.snapOrigin)?v.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,frameTask:n}}if(Object(l.k)(m)){var s=m.context.coordinateHelper.vectorToDehydratedPoint(m.context.coordinateHelper.arrayToVector([m.originalPos.x,m.originalPos.y,m.originalPos.z]));s.x+=e.mapEnd.x-e.mapStart.x,s.y+=e.mapEnd.y-e.mapStart.y;var d=e.mapStart.x-m.originalPos.x,y=e.mapStart.y-m.originalPos.y,j=Object(o.a)(Object(o.a)({},e),{},{action:"udpate"}),_=m.context,x=c.update(s,m.context);if(e.mapEnd.x=x.x+d,e.mapEnd.y=x.y+y,"end"!==e.action){var w=m.frameTask;g=Object(u.h)(function(){var e=Object(a.a)(r.a.mark((function e(n){var i,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.schedule((function(){return c.snap(s,_,n)}),n);case 2:if(!(i=e.sent).valid){e.next=8;break}return e.next=6,w.schedule((function(){return i.apply()}),n);case 6:a=e.sent,Object(h.a)(a,x)||(j.mapEnd.x=a.x+d,j.mapEnd.y=a.y+y,t.next.execute(j));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),b.addPromise(g.promise)}}return"end"===e.action&&O(),e}}}]),e}()},788:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i,r=n(541),a=n(537);function o(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(Object(a.a)(i||(i=Object(r.a)(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    }\n  "]))))}},789:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(2),r=n(236),a=function e(t){Object(i.a)(this,e),this.channel=t,this.id=Object(r.a)()}},791:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i,r,a=n(541),o=n(537);function s(e){var t=Object(o.a)(i||(i=Object(a.a)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),n=Object(o.a)(r||(r=Object(a.a)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(n),e.fragment.code.add(t),e.fragment.code.add(n)}},792:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p}));var i=n(2),r=n(3),a=n(100),o=n(546),s=n(58),c=n(79),l=n(406),u=n(557),h=(n(749),n(578)),d=n(664);var p=function(){function e(){Object(i.a)(this,e),this.min=new f,this.max=new f,this.hud=new f,this.ground=new f}return Object(r.a)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),f=function(){function e(t){Object(i.a)(this,e),this.normal=Object(c.e)(),this.transformation=Object(o.d)(),this._ray=Object(h.c)(),this.init(t)}return Object(r.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(s.e)(v,this.ray.direction,this.dist),Object(s.p)(v)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(s.e)(v,this.ray.direction,this.dist),Object(s.f)(e,this.ray.origin,v),!0)}},{key:"getTransformedNormal",value:function(e){return Object(s.k)(b,this.normal),b[3]=0,Object(l.m)(b,b,this.transformation),Object(s.k)(e,b),Object(s.r)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(h.b)(e,this._ray):this._ray=Object(h.c)()}},{key:"set",value:function(e,t,n,i,r,o,l,u,h,p){e instanceof d.a&&(e={type:"stage",obj:e}),this.dist=n,Object(s.k)(this.normal,i),Object(a.f)(this.transformation,r),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=l?Object(c.c)(l):null,this.geometryId=u,this.triangleNr=h,this.drapedLayerGraphicOrder=p}},{key:"copyFrom",value:function(e){Object(h.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(c.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.k)(this.normal,e.normal),Object(a.f)(this.transformation,e.transformation)}}]),e}(),v=(Object(c.e)(),Object(c.e)()),b=Object(u.e)()},793:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var i,r=n(541),a=n(825),o=n(537);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a.b),e.fragment.code.add(Object(o.a)(i||(i=Object(r.a)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}function c(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},794:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i,r,a,o,s=n(541),c=n(537);function l(e,t){1===t.viewingMode?e.vertex.code.add(Object(c.a)(i||(i=Object(s.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add(Object(c.a)(r||(r=Object(s.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),1===t.viewingMode?e.vertex.code.add(Object(c.a)(a||(a=Object(s.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add(Object(c.a)(o||(o=Object(s.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},795:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));n(5),n(6);var i=n(2),r=n(3),a=n(7),o=n(236),s=n(100),c=n(546),l=n(58),u=n(557),h=n(416),d=n(660),p=n(789),f=n(653),v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Object(o.a)(),l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(i.a)(this,e),this.data=t,this.material=n,this.layerUid=r,this.graphicUid=a,this.id=s,this.boundingInfo=l,this.calculateShaderTransformation=h,this.castShadow=d,this.boundingSphere=Object(u.e)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(c.d)(),this._shaderTransformationDirty=!0}return Object(r.a)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(h.c)(e);Object(a.j)(this.boundingInfo)||(Object(l.q)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*n)}},{key:"hasShaderTransformation",get:function(){return Object(a.k)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return Object(a.j)(this.calculateShaderTransformation)?Object(a.t)(this.transformation,c.a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(c.d)()),Object(s.f)(this._shaderTransformation,this.calculateShaderTransformation(Object(a.t)(this.transformation,c.a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(a.k)(this._transformation)&&Object(l.q)(e,e,this._transformation),!0);var t=this.indices.get("position"),n=this.vertexAttributes.get("position");return!!Object(d.c)(n,t,e)&&(Object(a.k)(this._transformation)&&Object(l.q)(e,e,this._transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new p.a(0),t=this.instanceParameters;return t.highlights=Object(f.b)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=Object(f.g)(t.highlights,e)}}]),e}()},796:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return g})),n.d(t,"d",(function(){return b}));var i=n(7),r=n(546),a=n(79),o=n(383),s=n(304),c=n(177),l=n(611),u=n(625),h=n(626),d=n(664),p=Object(a.e)();function f(e,t,n,a,c,l,h,f,v,b){var g=n?n.length:0,m=e.clippingExtent;if(Object(o.o)(t,p,e.elevationProvider.spatialReference),Object(i.k)(m)&&!Object(s.e)(m,p))return null;var O=e.renderCoordsHelper.spatialReference;Object(o.o)(t,p,O);for(var y=e.localOriginFactory.getOrigin(p),j=new d.a({castShadow:!1,metadata:{layerUid:f,graphicUid:v,usesVerticalDistanceToGround:!0}}),_=0;_<g;_++){var x=c?c[_]:r.a;j.addGeometry(n[_],a[_],x,l,y,b)}return{object:j,sampledElevation:Object(u.b)(j,t,e.elevationProvider,e.renderCoordsHelper,h)}}function v(e,t,n){var i=e.elevationContext,r=n.spatialReference;Object(o.o)(t,p,r),i.centerPointInElevationSR=Object(l.g)(p[0],p[1],t.hasZ?p[2]:0,r)}function b(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(h.a)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=Object(c.f)(t,Object(c.e)(t)/2);return Object(l.g)(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.origin}return null}function g(e,t,n,i,r){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=Object(u.c)(a,t,0,o,0,a,0,a.length/3,n,i,r),c=null!=s;return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:c,sampledElevation:s}}},814:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(2),r=n(3),a=n(30),o=n(60),s=n(58),c=n(79),l=n(406),u=n(557),h=n(47),d=function(){function e(t){Object(i.a)(this,e),this.spatialReference=t}return Object(r.a)(e,[{key:"createVector",value:function(){return this.tag(Object(o.a)())}},{key:"pointToVector",value:function(e){return this.tag(Object(o.e)(e.x,e.y))}},{key:"arrayToVector",value:function(e){return this.tag(Object(o.e)(e[0],e[1]))}},{key:"vectorToArray",value:function(e){return[e[0],e[1]]}},{key:"pointToArray",value:function(e){return[e.x,e.y]}},{key:"vectorToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}},{key:"arrayToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}},{key:"vectorToDehydratedPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}},{key:"lerp",value:function(e,t,n,i){return Object(a.m)(i,e,t,n)}},{key:"addDelta",value:function(e,t,n){e[0]+=t,e[1]+=n}},{key:"distance",value:function(e,t){return Object(a.d)(e,t)}},{key:"getZ",value:function(e,t){return t}},{key:"hasZ",value:function(){return!1}},{key:"getM",value:function(e,t){return t}},{key:"hasM",value:function(){return!1}},{key:"clone",value:function(e){return this.tag(Object(o.d)(e))}},{key:"copy",value:function(e,t){return Object(a.c)(t,e)}},{key:"fromXYZ",value:function(e){return this.tag(Object(o.e)(e[0],e[1]))}},{key:"toXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(c.g)(e[0],e[1],t)}},{key:"tag",value:function(e){return e}}]),e}(),p=function(){function e(t,n){Object(i.a)(this,e),this.valueType=t,this.spatialReference=n}return Object(r.a)(e,[{key:"createVector",value:function(){return this.tag(Object(c.e)())}},{key:"pointToVector",value:function(e){return this.tag(Object(c.g)(e.x,e.y,0===this.valueType?e.z:e.m))}},{key:"arrayToVector",value:function(e){return this.tag(Object(c.g)(e[0],e[1],e[2]||0))}},{key:"vectorToArray",value:function(e){return[e[0],e[1],e[2]]}},{key:"pointToArray",value:function(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}},{key:"vectorToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=0===this.valueType?e[2]:void 0,t.m=1===this.valueType?e[2]:void 0,t.spatialReference=this.spatialReference,t}},{key:"arrayToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=0===this.valueType?e[2]:void 0,t.m=1===this.valueType?e[2]:void 0,t.spatialReference=this.spatialReference,t}},{key:"vectorToDehydratedPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},n=0===this.valueType,i=1===this.valueType;return t.x=e[0],t.y=e[1],t.z=n?e[2]:void 0,t.m=i?e[2]:void 0,t.hasZ=n,t.hasM=i,t.spatialReference=this.spatialReference,t}},{key:"lerp",value:function(e,t,n,i){return Object(s.i)(i,e,t,n)}},{key:"addDelta",value:function(e,t,n,i){e[0]+=t,e[1]+=n,0===this.valueType&&(e[2]+=i)}},{key:"distance",value:function(e,t){return 0===this.valueType?Object(s.m)(e,t):Object(a.d)(e,t)}},{key:"getZ",value:function(e,t){return 0===this.valueType?e[2]:t}},{key:"hasZ",value:function(){return 0===this.valueType}},{key:"getM",value:function(e,t){return 1===this.valueType?e[2]:t}},{key:"hasM",value:function(){return 1===this.valueType}},{key:"clone",value:function(e){return this.tag(Object(c.f)(e))}},{key:"copy",value:function(e,t){return Object(s.k)(t,e)}},{key:"fromXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.tag(Object(c.g)(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:n))}},{key:"toXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.tag(Object(c.g)(e[0],e[1],0===this.valueType?e[2]:t))}},{key:"tag",value:function(e){return e}}]),e}(),f=function(){function e(t){Object(i.a)(this,e),this.spatialReference=t}return Object(r.a)(e,[{key:"createVector",value:function(){return this.tag(Object(u.e)())}},{key:"pointToVector",value:function(e){return this.tag(Object(u.g)(e.x,e.y,e.z,e.m))}},{key:"arrayToVector",value:function(e){return this.tag(Object(u.g)(e[0],e[1],e[2]||0,e[3]||0))}},{key:"vectorToArray",value:function(e){return[e[0],e[1],e[2],e[3]]}},{key:"pointToArray",value:function(e){return[e.x,e.y,e.z,e.m]}},{key:"vectorToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}},{key:"arrayToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.a;return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}},{key:"vectorToDehydratedPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}},{key:"lerp",value:function(e,t,n,i){return Object(l.j)(i,e,t,n)}},{key:"addDelta",value:function(e,t,n,i){e[0]+=t,e[1]+=n,e[2]+=i}},{key:"distance",value:function(e,t){return Object(s.m)(e,t)}},{key:"getZ",value:function(e){return e[2]}},{key:"hasZ",value:function(){return!0}},{key:"getM",value:function(e){return e[3]}},{key:"hasM",value:function(){return!0}},{key:"clone",value:function(e){return this.tag(Object(u.d)(e))}},{key:"copy",value:function(e,t){return Object(l.c)(t,e)}},{key:"fromXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.tag(Object(u.g)(e[0],e[1],e.length>2?e[2]:t,n))}},{key:"toXYZ",value:function(e){return Object(c.g)(e[0],e[1],e[2])}},{key:"tag",value:function(e){return e}}]),e}();function v(e,t,n){return e&&t?new f(n):t?new p(1,n):e?new p(0,n):new d(n)}},815:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return l}));var i=n(640),r=n(58),a=n(578);n(569);function o(e){return e?{ray:Object(a.c)(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a.c)(),c0:0,c1:Number.MAX_VALUE}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return Object(a.b)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o(),i=Object(r.p)(e.vector);return Object(a.f)(e.origin,t,n.ray),n.c0=0,n.c1=i,n}function l(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,n){return Object(r.f)(n,e.ray.origin,Object(r.e)(n,e.ray.direction,t))}new i.a((function(){return{c0:0,c1:0,ray:null}}))},817:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return O}));var i,r,a,o,s,c,l,u,h,d,p=n(541),f=n(65),v=n(893),b=n(788),g=n(537),m=n(560),O=Object(f.f)(6);function y(e){var t=new m.a;return t.extensions.add("GL_OES_standard_derivatives"),t.include(b.a),t.include(v.a,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(Object(g.a)(i||(i=Object(p.a)(["float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.pointDistanceEnabled&&t.fragment.code.add(Object(g.a)(r||(r=Object(p.a)(["float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.intersectsLineEnabled&&t.fragment.code.add(Object(g.a)(a||(a=Object(p.a)(["float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}"])))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(Object(g.a)(o||(o=Object(p.a)(["bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}"])))),t.fragment.code.add(Object(g.a)(s||(s=Object(p.a)(["void main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nvec4 color = vec4(0, 0, 0, 0);"])))),e.heightManifoldEnabled&&t.fragment.code.add(Object(g.a)(c||(c=Object(p.a)(["{\nfloat heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\nvec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\ncolor = max(color, heightManifoldColor * heightManifoldAlpha);\n}"])))),e.pointDistanceEnabled&&t.fragment.code.add(Object(g.a)(l||(l=Object(p.a)(["{\nfloat pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n}"])))),e.lineVerticalPlaneEnabled&&t.fragment.code.add(Object(g.a)(u||(u=Object(p.a)(["{\nif (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}\n}"])))),e.intersectsLineEnabled&&t.fragment.code.add(Object(g.a)(h||(h=Object(p.a)(["{\nif (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}\n}"])))),t.fragment.code.add(Object(g.a)(d||(d=Object(p.a)(["gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n}"])))),t}var j=Object.freeze({__proto__:null,defaultAngleCutoff:O,build:y})},818:function(e,t,n){"use strict";n.d(t,"a",(function(){return Q})),n.d(t,"b",(function(){return Y}));var i,r,a,o,s,c,l,u,h,d,p,f,v,b,g,m,O,y,j,_,x,w,k,S,M,E,P,T,D,R,C,A,V,z=n(541),I=n(686),G=n(556),L=n(867),F=n(694),U=n(579),H=n(763),N=n(567),q=n(790),B=n(577),W=n(620),Z=n(537),X=n(560);function Y(e){var t=new X.a;t.extensions.add("GL_OES_standard_derivatives"),t.include(q.a),t.include(L.a,e),t.include(H.a,e),1===e.output&&t.include(F.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");var n=e.draped&&I.a.ENABLE_CONTINUOUS_LINE_PATTERNS,Y=e.falloffEnabled,Q=n&&e.stippleEnabled&&e.roundCaps,J=e.innerColorEnabled||Q;return Q&&t.varyings.add("stippleCapRadius","float"),J&&t.varyings.add("vLineDistance","float"),Y&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(Object(Z.a)(i||(i=Object(z.a)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),t.vertex.code.add(Object(Z.a)(r||(r=Object(z.a)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= screenSize / posNdc.w;\nreturn posNdc;\n}"])))),t.vertex.code.add(Object(Z.a)(a||(a=Object(z.a)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = cameraNearFar[0] * 0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -cameraNearFar[0]) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -cameraNearFar[0]) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -cameraNearFar[0]) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -cameraNearFar[0]) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -cameraNearFar[0]) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])),e.multipassTerrainEnabled?"depth = pos.z;":"")),t.vertex.code.add(Object(Z.a)(o||(o=Object(z.a)(["void main(void) {\nfloat uvY = floor(uv0.y);\nfloat uvZ = fract(uv0.y) * 10.0;\nfloat coverage = 1.0;\nvpos = position;\nif (uvY == 0.0) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\nbool isStartVertex = abs(abs(uvY)-3.0) == 1.0;\nbool isJoin = abs(uvY)-3.0 < 0.0;\nfloat lineWidth = getSize() * pixelRatio;\nif (lineWidth < 1.0) {\ncoverage = lineWidth;\nlineWidth = 1.0;\n}else{\nlineWidth = floor(lineWidth + 0.5);\n}\nvec4 pos  = view * vec4(position.xyz, 1.0);\nvec4 prev = view * vec4(auxpos1.xyz, 1.0);\nvec4 next = view * vec4(auxpos2.xyz, 1.0);\nclipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),e.stippleEnabled&&t.vertex.code.add(Object(Z.a)(s||(s=Object(z.a)(["vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uvZ);\nvec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\nvec2 stippleSegment = stippleSegmentInfo.zw;"])))),t.vertex.code.add(Object(Z.a)(c||(c=Object(z.a)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uvY > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?t.vertex.code.add(Object(Z.a)(l||(l=Object(z.a)(["vec2 startDir;\nvec2 endDir;\nif (leftLen < 0.001) {\nstartDir = right;\n}\nelse{\nstartDir = left;\n}\nstartDir = normalize(startDir);\nstartDir = PERPENDICULAR(startDir);\nif (rightLen < 0.001) {\nendDir = left;\n}\nelse{\nendDir = right;\n}\nendDir = normalize(endDir);\nendDir = PERPENDICULAR(endDir);\nfloat rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\njoinDisplacementDir = rotate(startDir, -sign(uvY) * subdivisionFactor * rotationAngle);"])))):t.vertex.code.add(Object(Z.a)(u||(u=Object(z.a)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = isStartVertex ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"])))),t.vertex.code.add(Object(Z.a)(h||(h=Object(z.a)(["displacementLen = lineWidth;\n}\n} else {\nif (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = isStartVertex ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\ndisplacementLen = lineWidth;\ncapDisplacementDir = isStartVertex ? -right : left;"])))),e.roundCaps?t.vertex.code.add(Object(Z.a)(d||(d=Object(z.a)(["float angle = subdivisionFactor*PI*0.5;\njoinDisplacementDir *= cos(angle);\ncapDisplacementDir *= sin(angle);"])))):t.vertex.code.add(Object(Z.a)(p||(p=Object(z.a)(["capDisplacementDir *= subdivisionFactor;"])))),t.vertex.code.add(Object(Z.a)(f||(f=Object(z.a)(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uvY) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),Q?Object(Z.a)(v||(v=Object(z.a)(["stippleCapRadius = lineWidth;"]))):"",Y||J?Object(Z.a)(b||(b=Object(z.a)(["float lineDist = lineWidth * sign(uvY) * pos.w;"]))):"",J?Object(Z.a)(g||(g=Object(z.a)(["vLineDistance = lineDist;"]))):"",Y?Object(Z.a)(m||(m=Object(z.a)(["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(n?t.vertex.code.add(Object(Z.a)(O||(O=Object(z.a)(["{\nstipplePatternUv = uv0.x;\nfloat stippleSegmentScreenLength = length(stippleSegment);\nfloat stippleSegmentRenderLength = length(mix(auxpos2 - position, position - auxpos1, uvZ));\nif (stippleSegmentScreenLength >= 0.001) {\nvec2 stippleDisplacement = pos.xy - stippleSegmentOrigin;\nfloat stippleDisplacementFactor = dot(stippleSegment, stippleDisplacement) / (stippleSegmentScreenLength * stippleSegmentScreenLength);\nstipplePatternUv += (stippleDisplacementFactor - uvZ) * stippleSegmentRenderLength;\n}\nstipplePatternUv *= worldToScreenRatio;\n}"])))):(t.vertex.code.add(Object(Z.a)(y||(y=Object(z.a)(["{\nvec2 posVec = pos.xy - stippleSegmentOrigin;\nfloat stippleSegmentDirectionLength = length(stippleSegment);"])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(Object(Z.a)(j||(j=Object(z.a)(["float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\nfloat roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);\nstipplePatternUvMax = roundedNumberOfPatternRepeats;"])))),t.vertex.code.add(Object(Z.a)(_||(_=Object(z.a)(["\n        if (stippleSegmentDirectionLength >= 0.001) {\n          // Project the vertex position onto the line segment.\n          float projectedLength = dot(stippleSegment, posVec) / stippleSegmentDirectionLength * 0.5;\n          ","\n          stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;")))),t.vertex.code.add(Object(Z.a)(x||(x=Object(z.a)(["pos.xy = pos.xy / screenSize * pos.w;\nvColor = getColor();\nvColor.a *= coverage;\ngl_Position = pos;\n}\n}"])))),e.multipassTerrainEnabled&&(t.fragment.include(U.a),t.include(N.b,e)),t.include(G.a,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(W.a),t.fragment.code.add(Object(Z.a)(w||(w=Object(z.a)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),Q?t.fragment.code.add(Object(Z.a)(k||(k=Object(z.a)(["vec2 stipplePosition = vec2(\nclamp(stippleCapRadius - getStippleSDF(), 0.0, stippleCapRadius),\nvLineDistance\n) / stippleCapRadius;\nfloat stippleRadius = dot(stipplePosition, stipplePosition);\nfloat stippleAlpha = step(stippleRadius, 1.0);"])))):t.fragment.code.add(Object(Z.a)(S||(S=Object(z.a)(["float stippleAlpha = getStippleAlpha();"])))),t.fragment.code.add(Object(Z.a)(M||(M=Object(z.a)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\nvec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(Object(Z.a)(E||(E=Object(z.a)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),t.fragment.code.add(Object(Z.a)(P||(P=Object(z.a)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&t.fragment.code.add(Object(Z.a)(T||(T=Object(z.a)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))),t.fragment.code.add(Object(Z.a)(D||(D=Object(z.a)(["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),Z.a.float(B.c),7===e.output?Object(Z.a)(R||(R=Object(z.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(Z.a)(C||(C=Object(z.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",4===e.output?Object(Z.a)(A||(A=Object(z.a)(["gl_FragColor = vec4(1.0);"]))):"",1===e.output?Object(Z.a)(V||(V=Object(z.a)(["outputDepth(linearDepth);"]))):"")),t}var Q=Object.freeze({__proto__:null,build:Y})},819:function(e,t,n){"use strict";function i(e){return"point"===e.type}n.d(t,"a",(function(){return i}))},821:function(e,t,n){"use strict";n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return x}));var i,r,a,o,s,c,l,u,h=n(541),d=n(556),p=n(606),f=n(681),v=n(694),b=n(574),g=n(579),m=n(567),O=n(577),y=n(620),j=n(537),_=n(560);function x(e){var t=new _.a,n=1===e.output;return t.include(p.a,{linearDepth:n}),t.include(f.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n&&(t.include(v.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(Object(j.a)(i||(i=Object(h.a)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      ","\n      gl_Position = ","\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",n?Object(j.a)(r||(r=Object(h.a)(["transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);"]))):Object(j.a)(a||(a=Object(h.a)(["transformPosition(proj, view, vpos);"]))))),t.include(d.a,e),t.fragment.include(y.a),e.multipassTerrainEnabled&&(t.fragment.include(g.a),t.include(m.b,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(b.a),t.fragment.code.add(Object(j.a)(o||(o=Object(h.a)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 color = ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n  }\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.attributeColor?"vColor * eColor;":"eColor;",j.a.float(O.c),7===e.output?Object(j.a)(s||(s=Object(h.a)(["gl_FragColor = vec4(color.a);"]))):"",0===e.output?Object(j.a)(c||(c=Object(h.a)(["gl_FragColor = highlightSlice(color, vpos); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",4===e.output?Object(j.a)(l||(l=Object(h.a)(["outputHighlight();"]))):"",1===e.output?Object(j.a)(u||(u=Object(h.a)(["outputDepth(linearDepth);"]))):"")),t}var w=Object.freeze({__proto__:null,build:x})},822:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return m}));var i=n(13),r=n(65),a=n(7),o=n(162),s=n(58),c=n(79),l=n(383),u=n(785),h=n(823),d=n(625),p=n(837),f=n(661);function v(e){var t=[],n=[];!function(e,t,n){for(var i=e.attributeData.position,r=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&1===r,s=i.length/3-(a?1:0),c=new Uint32Array(2*(s-1)),l=a?Object(o.m)(i,0,i.length-3):i,u=0,h=0;h<s-1;h++)c[u++]=h,c[u++]=h+1;t.push(["position",{size:3,data:l,exclusive:a}]),n.push(["position",c])}(e,n,t);var i=n[0][1].data,c=t[0][1].length,l=new Uint16Array(c);return function(e,t,n){var i=e.attributeData.mapPosition;Object(a.j)(i)||(n.push(["mapPos",n[0][1]]),t.push(["mapPos",{size:3,data:i}]))}(e,n,t),function(e,t,n,i){if(Object(a.k)(e.attributeData.colorFeature))return;var r=e.attributeData.color;t.push(["color",{size:4,data:Object(a.t)(r,h.c)}]),n.push(["color",i])}(e,n,t,l),function(e,t,n,i){if(Object(a.k)(e.attributeData.sizeFeature))return;var r=e.attributeData.size;t.push(["size",{size:1,data:[Object(a.t)(r,1)]}]),n.push(["size",i])}(e,n,t,l),function(e,t,n,i){var r=e.attributeData.colorFeature;Object(a.j)(r)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([r])}]),n.push(["color",i]))}(e,n,t,l),function(e,t,n,i){var r=e.attributeData.sizeFeature;Object(a.j)(r)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([r])}]),n.push(["sizeFeatureAttribute",i]))}(e,n,t,l),function(e,t,n,i){var r=e.attributeData.opacityFeature;Object(a.j)(r)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([r])}]),n.push(["opacityFeatureAttribute",i]))}(e,n,t,l),function(e,t,n,i){if("round"!==e.join)return;var o=i.length/3,c=new Float32Array(o),l=y,u=j;Object(s.w)(l,0,0,0);for(var h=Object(a.t)(e.uniformSize,1),d=-1;d<o;++d){var p=d<0?o+d:d,f=(d+1)%o;if(Object(s.w)(u,i[3*f+0]-i[3*p+0],i[3*f+1]-i[3*p+1],i[3*f+2]-i[3*p+2]),Object(s.r)(u,u),d>=0){var v=(Math.PI-Object(r.a)(Object(s.h)(l,u)))*_*1*O(h);c[d]=Math.max(Math.floor(v),0)}Object(s.e)(l,u,-1)}t.push(["subdivisions",{size:1,data:c}]),n.push(["subdivisions",n[0][1]])}(e,n,t,i),new f.a(n,t,2)}function b(e,t,n,i){var r="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,o=Object(u.a)(a,e.hasZ,r),s=o.position,c=o.outlines,l=new Float64Array(s.length),h=Object(d.c)(s,e.spatialReference,0,l,0,s,0,s.length/3,t,n,i),p=null!=h;return{lines:p?g(c,s,l):[],projectionSuccess:p,sampledElevation:h}}function g(e,t,n){var r,a=new Array,o=Object(i.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=s.index,l=s.count;if(!(l<=1)){var u=3*c,h=u+3*l;a.push({position:t.subarray(u,h),mapPosition:n?n.subarray(u,h):void 0})}}}catch(d){o.e(d)}finally{o.f()}return a}function m(e,t){for(var n="polygon"===e.type?1:0,i="polygon"===e.type?e.rings:e.paths,r=Object(u.a)(i,!1,n),a=r.position,o=r.outlines,s=Object(l.l)(a,e.spatialReference,0,a,t,0,a.length/3),c=2;c<a.length;c+=3)a[c]=p.a;return{lines:s?g(o,a):[],projectionSuccess:s}}function O(e){return 1.863798+-2.0062872/Math.pow(1+e/18.2313,.8856294)}var y=Object(c.e)(),j=Object(c.e)(),_=4/Math.PI},823:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o}));var i=n(557),r=1.2,a=i.b,o=i.a},824:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(2),r=n(79),a=function e(t,n){Object(i.a)(this,e),this.vec3=t,this.id=n};function o(e,t,n,i){return new a(Object(r.g)(e,t,n),i)}},825:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s}));var i,r,a=n(541),o=n(537);function s(e){e.fragment.code.add(Object(o.a)(i||(i=Object(a.a)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function c(e){e.fragment.code.add(Object(o.a)(r||(r=Object(a.a)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},826:function(e,t,n){"use strict";n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return E}));var i,r,a,o,s,c,l,u,h,d,p=n(541),f=n(702),v=n(556),b=n(606),g=n(574),m=n(579),O=n(567),y=n(794),j=n(642),_=n(894),x=n(793),w=n(577),k=n(620),S=n(537),M=n(560);function E(e){var t=new M.a;return t.include(b.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(y.a,e),t.include(f.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(S.a)(i||(i=Object(p.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),S.a.float(w.c),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(m.a),t.include(O.b,e)),7===e.output&&(t.include(v.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(S.a)(r||(r=Object(p.a)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(x.a,e),t.include(v.a,e),e.receiveShadows&&t.include(j.a,e),t.include(_.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(k.a),t.fragment.code.add(Object(S.a)(a||(a=Object(p.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?Object(S.a)(o||(o=Object(p.a)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),2===e.output&&(t.include(y.a,e),t.include(x.a,e),t.include(v.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(Object(S.a)(s||(s=Object(p.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),S.a.float(w.c))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(Object(S.a)(c||(c=Object(p.a)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(S.a)(l||(l=Object(p.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),S.a.float(w.c))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(S.a)(u||(u=Object(p.a)(["void main() {\ngl_FragColor = waterColor;\n}"]))))),4===e.output&&(t.include(g.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(S.a)(h||(h=Object(p.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),S.a.float(w.c))),t.include(v.a,e),t.fragment.code.add(Object(S.a)(d||(d=Object(p.a)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var P=Object.freeze({__proto__:null,build:E})},827:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c}));var i,r=n(541),a=n(788),o=n(537),s=n(560);function c(){var e=new s.a;return e.include(a.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(Object(o.a)(i||(i=Object(r.a)(["void main() {\nvec4 texColor = texture2D(tex, uv);\ngl_FragColor = texColor * color;\n}"])))),e}var l=Object.freeze({__proto__:null,build:c})},829:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return m}));var i,r,a,o,s,c,l=n(541),u=n(556),h=n(606),d=n(681),p=n(574),f=n(763),v=n(577),b=n(537),g=n(560);function m(e){var t=new g.a;return t.include(h.a,{linearDepth:!1}),t.include(d.a,e),t.include(f.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(b.a)(i||(i=Object(l.a)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(Object(b.a)(r||(r=Object(l.a)(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(Object(b.a)(a||(a=Object(l.a)(["}"])))),4===e.output&&t.include(p.a),t.include(u.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(Object(b.a)(o||(o=Object(l.a)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",b.a.float(v.c),0===e.output?Object(b.a)(s||(s=Object(l.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?Object(b.a)(c||(c=Object(l.a)(["outputHighlight();"]))):"")),t}var O=Object.freeze({__proto__:null,build:m})},837:function(e,t,n){"use strict";n.d(t,"a",(function(){return ht}));var i=n(4),r=n.n(i),a=n(9),o=n(23),s=n(13),c=n(2),l=n(3),u=n(5),h=n(6),d=n(0),p=n(29),f=n(67),v=n(68),b=n(11),g=n(182),m=n(7),O=n(212),y=n(437),j=n(25),_=n(1),x=(n(12),n(15),n(8)),w=n(100),k=n(60),S=n(79),M=n(686),E=n(65),P=n(139),T=n(824),D=function(){function e(t,n){Object(c.a)(this,e),this.index=t,this.renderTargets=n,this.extent=Object(P.l)(),this.resolution=0,this.renderLocalOrigin=Object(T.a)(0,0,0,"O"),this.pixelRatio=1,this.canvasGeometries={extents:[Object(P.l)(),Object(P.l)(),Object(P.l)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(n.renderTargets.length).fill(!1)}return Object(l.a)(e,[{key:"getValidTarget",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}},{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}},{key:"getNormalTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var n,i=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage,a=Object(s.a)(this.renderTargets.renderTargets);try{for(a.s();!(n=a.n()).done;){var o=n.value;1===o.type&&!1===r?this.validTargets[o.type]=!1:this.validTargets[o.type]=e.drawTarget(this,o,t)}}catch(c){a.e(c)}finally{a.f()}return i^this.computeRenderTargetValidityBitfield()?0:1}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this.extent[0]-t<=e.min){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(P.u)(this.extent,e.range,0,n)}if(this.extent[2]+t>=e.max){var i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(P.u)(this.extent,-e.range,0,i)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,Object(P.k)(this.canvasGeometries.extents[0],this.extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}]),e}();var R=n(382),C=n(549),A=n(551),V=(n(548),n(547),n(552),n(543)),z=n(545),I=n(550),G=function(){function e(t,n){Object(c.a)(this,e),this.size=Object(R.a)(),this._fbo=null,this._fbo=new A.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:n,maxAnisotropy:8,width:0,height:0})}return Object(l.a)(e,[{key:"dispose",value:function(){this._fbo=Object(m.f)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null==(e=this._fbo)||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}]),e}(),L=function(){function e(t){Object(c.a)(this,e),this.renderTargets=null;var n=function(e,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:n,fbo:new G(t,i),renderPass:e,valid:!1,lastUsed:1/0}};this.renderTargets=[n(0,0),n(0,1),n(5,2,!1),n(3,3),n(0,4)]}return Object(l.a)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=Object(s.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(n){t.e(n)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=Object(s.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(n){t.e(n)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,n){if(e)t.lastUsed=n;else if(n-t.lastUsed>F)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),F=1e3,U=function e(t){Object(c.a)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0},H=function(){function e(t){Object(c.a)(this,e),this._context=t,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=N}return Object(l.a)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var n=this,i=t.key,r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));var a=r.get(i);if(void 0===a){var o=new e(this._context,t,(function(){return n.release(o)}));a=new U(o),r.set(i,a)}return++a.refCount,a.technique}},{key:"releaseAndAcquire",value:function(e,t,n){if(Object(m.k)(n)){if(t.key===n.key)return n;n.release()}return this.acquire(e,t)}},{key:"release",value:function(e){if(!Object(m.j)(e)){var t=this._perConstructorInstances.get(e.constructor).get(e.key);--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==N&&this._perConstructorInstances.forEach((function(t,n){t.forEach((function(n,i){0===n.refCount&&n.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(n.technique.dispose(),t.delete(i))})),0===t.size&&e._perConstructorInstances.delete(n)}))}},{key:"hotReload",value:function(){var e=Object(a.a)(r.a.mark((function e(){var t,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,i){var o=function(){var e=Object(a.a)(r.a.mark((function e(t,i){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.shader,e.t0=a,!e.t0){e.next=6;break}return e.next=5,a.reload();case 5:t.forEach((function(e){e.technique.reload(n._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.push(o(e,i))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),N=-1,q=n(865),B=n(748),W=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function Z(e,t){return e+"_"+W.find((function(e){return e.output===t})).name}var X=n(566),Y=b.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),Q=function(){function e(t){Object(c.a)(this,e),this.refCnt=0,this.glMaterial=t}return Object(l.a)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,Object(X.a)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"getGLMaterial",value:function(){return this.glMaterial}}]),e}(),J=function(){function e(t,n,i){Object(c.a)(this,e),this._textureRep=t,this._techniqueRep=n,this.onMaterialChanged=i,this._id2glMaterialRef=new Map}return Object(l.a)(e,[{key:"dispose",value:function(){this._textureRep.dispose()}},{key:"acquire",value:function(e,t){this.ownMaterial(e);var n=Z(e.id,t),i=this._id2glMaterialRef.get(n);if(null==i){var r=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return(i=new Q(r)).incRefCnt(),this._id2glMaterialRef.set(n,i),r}return i.incRefCnt(),i.getGLMaterial()}},{key:"release",value:function(e,t){var n=Z(e.id,t),i=this._id2glMaterialRef.get(n);if(i.decRefCnt(),0===i.getRefCnt()){var r=i.getGLMaterial();r&&r.dispose(),this._id2glMaterialRef.delete(n)}}},{key:"materialChanged",value:function(e){var t,n=Object(s.a)(W);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(5!==i.output&&6!==i.output){var r=this._id2glMaterialRef.get(Z(e.id,i.output));if(r&&r.getGLMaterial()){var a=r.getGLMaterial();a.updateParameters&&a.updateParameters()}}}}catch(o){n.e(o)}finally{n.f()}this.onMaterialChanged&&this.onMaterialChanged(e)}},{key:"ownMaterial",value:function(e){Object(m.k)(e.materialRepository)&&e.materialRepository!==this&&Y.error("Material is already owned by a different material repository"),e.materialRepository=this}}]),e}(),K=n(891),$=n(870),ee=n(792),te=function(){function e(t){Object(c.a)(this,e),this.rctx=t,this.camera=null,this.lastFrameCamera=new B.a,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=ne,this.hasOccludees=!1}return Object(l.a)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=ne}},{key:"isHighlightPass",get:function(){return 5===this.pass}}]),e}(),ne=13,ie=function(){function e(){Object(c.a)(this,e),this.adds=new O.a,this.removes=new O.a,this.updates=new O.a({allocator:function(e){return e||new re},deallocator:function(e){return e.renderGeometry=null,e}})}return Object(l.a)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),re=function e(){Object(c.a)(this,e)},ae=function e(){Object(c.a)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array},oe=n(624);function se(e){return e.data.indexCount>=1}var ce=n(26),le=n(546),ue=n(718),he=function(){function e(t){Object(c.a)(this,e),null==t?t=16:t<65536&&(t=Object(E.l)(t)),this._array=new Float32Array(t),this._size=0}return Object(l.a)(e,[{key:"resize",value:function(e,t){if(this._size=e,this._size>this._array.length){for(var n=this._array.length||1;n<this._size;)n*=2;var i=new Float32Array(n);return t&&i.set(this._array),this._array=i,!0}var r=2*this._size;if(r<=this._array.length){for(var a=this._array.length;a>=r;)a=Math.floor(a/2);var o=new Float32Array(a);return t&&o.set(this._array.subarray(0,a)),this._array=o,!0}return!1}},{key:"append",value:function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}},{key:"erase",value:function(e,t){for(var n=e;n<t;++n)this._array[n]=0}},{key:"array",get:function(){return this._array}},{key:"size",get:function(){return this._size}}]),e}(),de=n(871),pe=function e(t,n,i,r,a,o){Object(c.a)(this,e),this.from=t,this.to=n,this.isVisible=i,this.hasHighlights=r,this.hasOccludees=a,this.transformation=o,null!=o&&(this.transformationNormal=Object(le.c)(o),Object(w.c)(this.transformationNormal,this.transformationNormal),Object(w.b)(this.transformationNormal,this.transformationNormal))};function fe(e,t){var n=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var i=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(i,t)){var r=t.from-i.first+t.to-t.from;i.count=r}else e.push(n(t))}else e.push(n(t))}var ve=n(653),be=n(386);n(64);function ge(e,t,n){Object(m.k)(n)&&(n.drawCalls+=e,n.triangles+=t)}be.a;var me=n(719),Oe=function(){function e(t,n,i){Object(c.a)(this,e),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=t,this._material=i,this._materialRep=n,this._glMaterials=Object(ve.a)(this._material,this._materialRep),this._bufferWriter=i.createBufferWriter()}return Object(l.a)(e,[{key:"dispose",value:function(){Object(ve.f)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&Object(g.c)(this._glMaterials,(function(e){return e instanceof de.a}))}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"modify",value:function(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}},{key:"addAndRemoveGeometries",value:function(e,t){var n=this,i=this._bufferWriter,r=i.vertexBufferLayout,a=r.stride/4,o=this._dataByOrigin,c=function(e,t,n,i){var r,a=new Map,o=t.vertexBufferLayout.stride/4,c=function(n,i){var r=n.origin;if(!Object(m.j)(r)){var s=e.get(r.id),c=a.get(r.id);null==c&&(c={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:r.vec3},a.set(r.id,c));var l=t.elementCount(n.data)*o;i?(c.optimalCount+=l,c.sparseCount+=l,c.toAdd.push(n)):(c.optimalCount-=l,c.toRemove.push(n))}},l=Object(s.a)(n);try{for(l.s();!(r=l.n()).done;){c(r.value,!0)}}catch(d){l.e(d)}finally{l.f()}var u,h=Object(s.a)(i);try{for(h.s();!(u=h.n()).done;){c(u.value,!1)}}catch(d){h.e(d)}finally{h.f()}return a}(o,i,e,t);c.forEach((function(e,t){c.delete(t);var i=e.optimalCount,s=e.sparseCount,l=o.get(t);if(null==l)Object(X.a)(i>0),l=n.createData(r,i,e.origin),o.set(t,l);else if(0===i)return l.vao.dispose(!0),l.vao=null,void o.delete(t);var u=i<e.sparseCount/2,h=u?i:s,d=je,p=l.buffer.size,f=l.buffer.array,v=l.buffer.resize(h,!1);u||v?n.removeAndRebuild(l,e.toRemove,a,f,d):e.toRemove.length>0?(n.removeByErasing(l,e.toRemove,a,d),e.toAdd.length>0&&(d.end=p)):(d.begin=p,d.end=p);var b=_e;Object(X.j)(b,-e.origin[0],-e.origin[1],-e.origin[2]),n.append(l,e.toAdd,a,b,d);var g=l.vao.vertexBuffers.geometry;if(g.byteSize!==l.buffer.array.buffer.byteLength)g.setData(l.buffer.array);else{var m=d.begin,O=d.end;if(m<O){var y=l.buffer.array,j=4*m,_=4*O;g.setSubData(y,j,j,_)}}l.drawCommandsDirty=!0}))}},{key:"updateGeometries",value:function(e){var t,n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=a.updateType,c=a.renderGeometry,l=this._dataByOrigin.get(c.origin.id),u=l&&l.instances.get(c.id);if(!u)return;if(1&o&&(u.isVisible=c.instanceParameters.visible),9&o){var h=c.instanceParameters.visible;u.hasHighlights=!!c.instanceParameters.highlights&&h}if(16&o&&(u.hasOccludees=!!c.instanceParameters.occludees),6&o){var d=l.buffer.array,p=l.vao;Object(ve.c)(c,xe,we),n.write({transformation:xe,invTranspTransformation:we},c.data,n.vertexBufferLayout.createView(d.buffer),u.from),Object(X.a)(u.from+n.elementCount(c.data)===u.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(d,u.from*i*4,u.from*i*4,u.to*i*4)}l.drawCommandsDirty=!0}}catch(f){r.e(f)}finally{r.f()}}},{key:"updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,Object(g.c)(t.instances,(function(n){return n.isVisible?(n.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),n.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0!==e.instances.size){if(!ye(e)){var t=4*e.buffer.size/Object(me.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}var n=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))}(Object(ce.a)(e.instances.values()));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];var i,r=Object(s.a)(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.isVisible&&(a.hasOccludees?fe(e.drawCommandsOccludees,a):fe(e.drawCommandsDefault,a),a.hasHighlights?fe(e.drawCommandsHighlight,a):fe(e.drawCommandsShadowHighlightRest,a))}}catch(c){r.e(c)}finally{r.f()}var o=function(e){var t,n=0,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;)n+=t.value.count}catch(c){i.e(c)}finally{i.f()}return n/3};e.stats={default:o(e.drawCommandsDefault),highlight:o(e.drawCommandsHighlight),occludees:o(e.drawCommandsOccludees),shadowHighlightRest:o(e.drawCommandsShadowHighlightRest)}}}(e),e.drawCommandsDirty=!1)}))}},{key:"updateLogic",value:function(e){return this._material.update(e)}},{key:"render",value:function(e,t,n,i){var r=this,a=this._rctx,o=this._glMaterials.get(t),s=5===t||7===t,c=6===t,l=!(s||c);if(!o||2!==o.ensureResources(a)||null!=e&&!o.beginSlot(e)||s&&!this._hasHighlights)return!1;o.ensureParameters(n);var u=o.getPipelineState(e,!1);a.setPipelineState(u);var h=o.technique;a.useProgram(h.program),o.bind(n);var d=!1;return this._dataByOrigin.forEach((function(t){if(!(Object(m.j)(t.drawCommandsDefault)&&Object(m.j)(t.drawCommandsHighlight)&&Object(m.j)(t.drawCommandsOccludees)&&Object(m.j)(t.drawCommandsShadowHighlightRest))&&(!s||t.hasHighlights)){n.origin=t.origin,h.bindDraw(n,{},{}),h.ensureAttributeLocations(t.vao),a.bindVAO(t.vao);var p=h.primitiveType,f=s?t.drawCommandsHighlight:c&&ye(t)?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault;if(Object(m.k)(f)){r.renderCommands(a,p,f);var v=s?t.stats.highlight:c&&ye(t)?t.stats.shadowHighlightRest:t.stats.default;ge(f.length,v,i),d=!0}if(l){var b=t.drawCommandsOccludees;if(Object(m.k)(b)){var g=o.getPipelineState(e,!0);a.setPipelineState(g),r.renderCommands(a,p,b),a.setPipelineState(u),ge(b.length,t.stats.occludees,i),d=!0}}}})),d}},{key:"renderCommands",value:function(e,t,n){for(var i=0;i<n.length;i++)e.drawArrays(t,n[i].first,n[i].count)}},{key:"createData",value:function(e,t,n){return{instances:new Map,vao:new I.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(ue.a)(e)},{geometry:C.a.createVertex(this._rctx,35044)}),buffer:new he(t),optimalCount:0,origin:n,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}},{key:"removeAndRebuild",value:function(e,t,n,i,r){var a,o=Object(s.a)(t);try{for(o.s();!(a=o.n()).done;){var c=a.value.id,l=e.instances.get(c);e.optimalCount-=(l.to-l.from)*n,e.instances.delete(c)}}catch(v){o.e(v)}finally{o.f()}var u=0,h=e.buffer.array;r.begin=0,r.end=0;var d=-1,p=-1,f=0;e.instances.forEach((function(e){var t=e.from*n,r=e.to*n,a=r-t;d!==p&&p!==t?(h.set(i.subarray(d,p),f),f+=p-d,d=t):-1===d&&(d=t),p=r,e.from=u/n,u+=a,e.to=u/n})),d!==p&&h.set(i.subarray(d,p),f),r.end=u}},{key:"removeByErasing",value:function(e,t,n,i){i.begin=1/0,i.end=-1/0;var r,a=-1,o=-1,c=Object(s.a)(t);try{for(c.s();!(r=c.n()).done;){var l=r.value.id,u=e.instances.get(l),h=u.from*n,d=u.to*n;a!==o&&o!==h?(e.buffer.erase(a,o),a=h):-1===a&&(a=h),o=d,e.instances.delete(l),e.optimalCount-=d-h,h<i.begin&&(i.begin=h),d>i.end&&(i.end=d)}}catch(p){c.e(p)}finally{c.f()}a!==o&&e.buffer.erase(a,o)}},{key:"append",value:function(e,t,n,i,r){var a,o=this._bufferWriter,c=Object(s.a)(t);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=Object(m.k)(l.transformation)?Object(w.n)(xe,i,l.transformation):i;Object(w.c)(we,u),Object(w.b)(we,we);var h=r.end;o.write({transformation:u,invTranspTransformation:we},l.data,o.vertexBufferLayout.createView(e.buffer.array.buffer),r.end/n);var d=o.elementCount(l.data)*n,p=h+d;Object(X.a)(null==e.instances.get(l.id));var f=l.instanceParameters.visible,v=!!l.instanceParameters.highlights&&f,b=!!l.instanceParameters.occludees,g=new pe(h/n,p/n,f,v,b);e.instances.set(l.id,g),e.optimalCount+=d,r.end+=d}}catch(O){c.e(O)}finally{c.f()}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]),e}();function ye(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}var je={begin:0,end:0},_e=Object(le.d)(),xe=Object(le.d)(),we=Object(le.d)(),ke=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.apply(this,arguments))._pending=new Se,e._changes=new ie,e._materialRenderers=new Map,e._sortedMaterialRenderers=new O.a,e._hasHighlights=!1,e._hasWater=!1,e}return Object(l.a)(n,[{key:"dispose",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return Object(g.c)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,n=function(e){var n=t.get(e);return n||(n=new ae,t.set(e,n)),n};return e.adds.forAll((function(e){se(e)&&n(e.material).adds.push(e)})),e.removes.forAll((function(e){se(e)&&n(e.material).removes.push(e)})),e.updates.forAll((function(e){se(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}(this._changes),n=!1,i=!1,r=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new Oe(e.rctx,e.materialRepository,a),e._materialRenderers.set(a,o),n=!0,i=!0,r=!0),o){var s=i||o.hasHighlights,c=r||o.hasWater;o.modify(t),i=i||s!==o.hasHighlights,r=r||c!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),n=!0)}})),this._changes.clear(),n&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(g.c)(this._materialRenderers,(function(e){return e.hasHighlights}))),r&&(this._hasWater=Object(g.c)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,n=this._pending.empty,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._pending.adds.add(r)}}catch(a){i.e(a)}finally{i.f()}n&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,n=this._pending.empty,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._pending.adds.has(r)?(this._pending.removed.add(r),this._pending.adds.delete(r)):this._pending.removed.has(r)||this._pending.removes.add(r)}}catch(a){i.e(a)}finally{i.f()}n&&!this._pending.empty&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var n,i=0===this._changes.updates.length,r=Object(s.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this._changes.updates.pushNew();o.renderGeometry=a,o.updateType=t}}catch(c){r.e(c)}finally{r.f()}i&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateLogic",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(n){var i=n.materialRenderer;return t=i.updateLogic(e)||t})),t}},{key:"render",value:function(e,t){for(var n=0;n<this._sortedMaterialRenderers.length;n++){var i=this._sortedMaterialRenderers.data[n];Object(oe.c)(i.material,e)&&i.materialRenderer.render(t.slot,e.pass,t,null)}}},{key:"updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,i){i.insertOrder=t++,e._sortedMaterialRenderers.push({material:i,materialRenderer:n})})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),n}(p.a);Object(d.a)([Object(_.b)()],ke.prototype,"rctx",void 0),Object(d.a)([Object(_.b)()],ke.prototype,"materialRepository",void 0),Object(d.a)([Object(_.b)()],ke.prototype,"updating",null),ke=Object(d.a)([Object(x.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ke);var Se=function(){function e(){Object(c.a)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return Object(l.a)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}(),Me=n(827),Ee=n(608),Pe=n(617),Te=n(623),De=n(618),Re=n(609),Ce=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get().build();return new Re.a(e.rctx,t,De.a)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?Object(V.f)({blending:Object(V.g)(770,1,771,771),colorWrite:V.c}):Object(V.f)({colorWrite:V.c})}}]),n}(Pe.a);Ce.shader=new Ee.a(Me.a,(function(){return n.e(200).then(n.bind(null,1109))}));var Ae=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.apply(this,arguments)).hasAlpha=!1,e}return n}(Te.a);Object(d.a)([Object(Te.b)()],Ae.prototype,"hasAlpha",void 0);var Ve=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(S.e)();Object(c.a)(this,e),this.intensity=t},ze=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(S.e)(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(S.g)(.57735,.57735,.57735);Object(c.a)(this,e),this.intensity=t,this.direction=n},Ie=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(S.e)(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(S.g)(.57735,.57735,.57735),i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(c.a)(this,e),this.intensity=t,this.direction=n,this.castShadows=i},Ge=function e(){Object(c.a)(this,e),this.r=[0],this.g=[0],this.b=[0]},Le=n(58);function Fe(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]*t[i];return n}function Ue(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]*t;return n}function He(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}function Ne(e){return(e+1)*(e+1)}function qe(e,t,n){var i=e[0],r=e[1],a=e[2],o=n||[];return o.length=Ne(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*a,o[3]=.4886025119*r),t>=2&&(o[4]=1.09254843059*i*r,o[5]=1.09254843059*r*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*i*a,o[8]=.54627421529*(i*i-r*r)),o}function Be(e,t){var n,i,r=(n=t.r.length,Object(E.d)(Math.floor(Math.sqrt(n)-1),0,2)),a=Object(s.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;Object(Le.s)(Ke,o.direction),qe(Ke,r,Qe),Fe(Qe,$e),Ue(Qe,o.intensity[0],Je),He(t.r,Je),Ue(Qe,o.intensity[1],Je),He(t.g,Je),Ue(Qe,o.intensity[2],Je),He(t.b,Je)}}catch(c){a.e(c)}finally{a.f()}return t}function We(e,t,n,i){(function(e,t){var n=Ne(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=n;for(var r=0;r<n;r++)i.r[r]=i.g[r]=i.b[r]=0})(t,i),Object(Le.w)(n.intensity,0,0,0);var r=!1,a=Ze,o=Xe,c=Ye;a.length=0,o.length=0,c.length=0;var l,u=Object(s.a)(e);try{for(u.s();!(l=u.n()).done;){var h=l.value;h instanceof Ie&&!r?(Object(Le.k)(n.direction,h.direction),n.intensity[0]=h.intensity[0],n.intensity[1]=h.intensity[1],n.intensity[2]=h.intensity[2],n.castShadows=h.castShadows,r=!0):h instanceof Ie||h instanceof ze?a.push(h):h instanceof Ve?o.push(h):h instanceof Ge&&c.push(h)}}catch(v){u.e(v)}finally{u.f()}Be(a,i),function(e,t){qe(Ke,0,Qe);var n,i=Object(s.a)(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;t.r[0]+=Qe[0]*$e[0]*r.intensity[0]*4*Math.PI,t.g[0]+=Qe[0]*$e[0]*r.intensity[1]*4*Math.PI,t.b[0]+=Qe[0]*$e[0]*r.intensity[2]*4*Math.PI}}catch(v){i.e(v)}finally{i.f()}}(o,i);var d,p=Object(s.a)(c);try{for(p.s();!(d=p.n()).done;){var f=d.value;He(i.r,f.r),He(i.g,f.g),He(i.b,f.b)}}catch(v){p.e(v)}finally{p.f()}}var Ze=[],Xe=[],Ye=[],Qe=[0],Je=[0],Ke=Object(S.e)(),$e=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],et=function(){function e(){Object(c.a)(this,e),this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(S.e)(),ambient:{color:Object(S.e)(),intensity:1},diffuse:{color:Object(S.e)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Ge,this._mainLight={intensity:Object(S.e)(),direction:Object(S.g)(1,0,0),castShadows:!1}}return Object(l.a)(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}},{key:"setUniforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",n),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);var i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}},{key:"set",value:function(e){We(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(Le.k)(this._oldSunlight.direction,this._mainLight.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(Le.e)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(Le.k)(tt,this._oldSunlight.diffuse.color),Object(Le.e)(tt,tt,this._ambientBoost*this.globalFactor),Object(Le.f)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,tt)}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),tt=Object(S.e)(),nt=function(){function e(t){Object(c.a)(this,e),this._rctx=t,this.cache=new Map}return Object(l.a)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){return e.texture=Object(m.f)(e.texture)})),this.cache.clear()}},{key:"acquire",value:function(e){var t=this;if(Object(m.j)(e))return null;var n=this.patternId(e),i=this.cache.get(n);if(i)return i.refCount++,i.bind;var r=this.patternToTextureData(e,2),a=r.encodedData,o=r.sdfNormalizer,s=a.length/4,c=s/2,l={refCount:1,texture:null,bind:function(e){return Object(m.j)(l.texture)&&(l.texture=new z.a(t._rctx,{width:s,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},a)),e.bindTexture(l.texture,"stipplePatternTexture"),{pixelSize:c,sdfNormalizer:o}}};return this.cache.set(n,l),l.bind}},{key:"release",value:function(e){if(!Object(m.j)(e)){var t=this.patternId(e),n=this.cache.get(t);n&&(n.refCount--,0===n.refCount&&(Object(m.k)(n.texture)&&n.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var n=this.acquire(t);return this.release(e),n}},{key:"patternId",value:function(e){return e.join(",")}},{key:"patternToTextureData",value:function(e,t){var n,i=Math.floor(e.reduce((function(e,t){return e+t}))*t),r=.5*(e.reduce((function(e,t){return Math.max(e,t)}))+1)*t,a=new Uint8Array(4*i),o=1,c=0,l=Object(s.a)(e);try{for(l.s();!(n=l.n()).done;){for(var u=n.value*t,h=0;h<u;h++){var d=o*(Math.min(h,u-h)+.5);Object(X.h)(d/r*.5+.5,a,c),c+=4}o=-o}}catch(p){l.e(p)}finally{l.f()}return{encodedData:a,sdfNormalizer:r}}}]),e}(),it=n(679),rt=b.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),at=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e))._overlays=null,i._overlayRenderTarget=null,i._hasHighlights=!1,i._rendersOccluded=!1,i._hasWater=!1,i._lighting=new et,i._handles=new v.a,i._layerRenderers=new Map,i._sortedLayerRenderersDirty=!1,i._sortedLayerRenderers=new O.a,i._geometries=new Map,i.worldToPCSRatio=1,i.events=new f.a,i.longitudeCyclical=null,i}return Object(l.a)(n,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext,this._renderContext=new te(this._rctx);var n=t.waterTextureRepository;this._stippleTextureRepository=new nt(t.renderingContext),this._shaderTechniqueRepository=new H({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:n}),this._handles.add([Object(j.a)(n,"loadingState",(function(){return e.events.emit("content-changed")})),Object(j.a)(this,"spatialReference",(function(t){return e._localOrigins=new $.a(t)}))]),this._materialRepository=new J(t.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(t){(t.renderOccluded&dt)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating")},this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Ve(Object(S.g)(1,1,1))]),this._bindParameters={slot:23,highlightDepthTexture:Object(K.a)(this._rctx),camera:ct,inverseViewport:Object(k.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._handles.add(this.view.resourceController.scheduler.registerTask(it.b.STAGE,this))}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._debugTextureTechnique=Object(m.q)(this._debugTextureTechnique),this._debugPatternTexture=Object(m.f)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(m.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(m.f)(this._shaderTechniqueRepository),this._temporaryFBO=Object(m.f)(this._temporaryFBO),this._quadVAO=Object(m.f)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||Object(g.c)(this._layerRenderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return Object(m.k)(this._overlays)&&Object(m.k)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return Object(m.k)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if(Object(m.k)(this._overlayRenderTarget)){var n,i=Object(s.a)(this._overlayRenderTarget.renderTargets);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(a,r,e)||t}}catch(o){i.e(o)}finally{i.f()}}return t}},{key:"overlays",get:function(){return Object(m.t)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){Object(m.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasTargetWithoutRasterImage=Object(y.a)(e,(function(e){return 1===e.drapeTargetType}))}))}},{key:"ensureDrapeSources",value:function(e){Object(m.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=Object(g.c)(e,(function(e,t){return 1===t.drapeSourceType})),t.hasDrapedRasterSource=Object(g.c)(e,(function(e,t){return 0===t.drapeSourceType}))}))}},{key:"ensureOverlays",value:function(e,t){Object(m.j)(this._overlays)&&(this._overlayRenderTarget=new L(this._rctx),this._overlays=[new D(0,this._overlayRenderTarget),new D(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=Object(m.f)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=!1,r=Object(s.a)(this._layerRenderers);try{for(r.s();!(t=r.n()).done;){var a=Object(o.a)(t.value,2),c=a[0],l=a[1];if(e.done)break;n(c)&&(l.commitChanges()&&(i=!0,e.madeProgress()),l.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(c),this._handles.remove(c)))}}catch(u){r.e(u)}finally{r.f()}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),i=!0),i&&(Object(m.k)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}},{key:"processSyncLayers",value:function(){this.runTask(it.c,(function(e){return 1===e.updatePolicy}))}},{key:"addGeometries",value:function(e,t,n){var i,r=Object(s.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;Object(m.j)(a.origin)&&(a.origin=this._localOrigins.getOrigin(a.boundingSphere)),this._geometries.set(a.id,a)}}catch(o){r.e(o)}finally{r.f()}this.ensureLayerRenderer(t).add(e),2===n&&this.notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,n){var i,r=Object(s.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;this._geometries.delete(Object(m.s)(a.id))}}catch(c){r.e(c)}finally{r.f()}var o=this._layerRenderers.get(t);o&&(o.remove(e),2===n&&this.notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,n){var i=this._layerRenderers.get(t);if(i)switch(i.modify(e,n),n){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else rt.warn("Attempted to update geometry for nonexistent layer")}},{key:"notifyGraphicGeometryChanged",value:function(e,t){if(!Object(m.j)(t.notifyGraphicGeometryChanged)){var n,i,r=Object(s.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value.graphicUid;Object(m.k)(a)&&a!==n&&(t.notifyGraphicGeometryChanged(a),n=a)}}catch(o){r.e(o)}finally{r.f()}}}},{key:"notifyGraphicVisibilityChanged",value:function(e,t){if(!Object(m.j)(t.notifyGraphicVisibilityChanged)){var n,i,r=Object(s.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value.graphicUid;Object(m.k)(a)&&a!==n&&(t.notifyGraphicVisibilityChanged(a),n=a)}}catch(o){r.e(o)}finally{r.f()}}}},{key:"updateHighlights",value:function(e,t){var n=this._layerRenderers.get(t);n?n.modify(e,8):rt.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!M.a.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateLogic",value:function(e){var t=!1;return this._layerRenderers.forEach((function(n){return t=n.updateLogic(e)||t})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,n){var i=this,r=e.canvasGeometries;if(0===r.numViews)return!1;var a=e.pixelRatio*n;this._screenToWorldRatio=a*Math.abs(r.extents[0][2]-r.extents[0][0])/e.resolution;var o=t.renderPass;if(this.isEmpty()||5===o&&!this.hasHighlights||3===o&&!this.hasWater)return!1;if(!e.hasSomeSizedView())return!1;var s=t.fbo,c=2*e.resolution,l=e.resolution,u=1===t.type?2:4===t.type?1:0;if(!s.isValid())return!1;s.resize(c,l);var h=this._rctx;if(ct.pixelRatio=a||1,this._renderContext.pass=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===o?24:23,e.applyViewport(this._rctx),s.bind(h),0===e.index&&(h.setClearColor(0,0,0,0),h.clearSafe(16384)),1===u&&(this._renderContext.renderOccludedMask=dt),M.a.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==u)for(var d=0;d<r.numViews;d++)this.setViewParameters(r.extents[d],e,ct),this.drawDebugTexture(e.resolution,st[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(t){var n=t.layerView,a=t.renderer;if(2!==u||!Object(m.k)(n)||0!==n.drapeSourceType){var d=Object(m.k)(n)&&Object(m.k)(n.fullOpacity)&&n.fullOpacity<1&&0===o;d&&(i.bindTemporaryFramebuffer(i._rctx,c,l),h.clearSafe(16384));for(var p=0;p<r.numViews;p++)i.setViewParameters(r.extents[p],e,ct),a.render(i._renderContext,i._bindParameters);d&&Object(m.k)(i._temporaryFBO)&&(s.bind(h),i.view._stage.renderView.compositingHelper.composite(i._temporaryFBO.getTexture(),2,Object(m.s)(Object(m.s)(n).fullOpacity),3,e.index))}})),h.bindFramebuffer(null),s.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,n){Object(m.j)(this._temporaryFBO)&&(this._temporaryFBO=new G(e,!1)),this._temporaryFBO.resize(t,n),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=Object(a.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.hotReload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,n){var i=this,r=0;this._geometries.forEach((function(a){if(!n||n(a)){i.intersectRenderGeometry(a,t,0,e,r);var o=i.longitudeCyclical;o&&(a.boundingSphere[0]-a.boundingSphere[3]<o.min&&i.intersectRenderGeometry(a,t,o.range,e,r),a.boundingSphere[0]+a.boundingSphere[3]>o.max&&i.intersectRenderGeometry(a,t,-o.range,e,r)),r++}}))}},{key:"intersectRenderGeometry",value:function(e,t,n,i,r){var a=this;if(e.instanceParameters.visible){var o=0;Object(m.k)(e.transformation)&&(n+=e.transformation[12],o=e.transformation[13]),lt[0]=t[0]-n,lt[1]=t[1]-o,lt[2]=1,ut[0]=t[0]-n,ut[1]=t[1]-o,ut[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),i,lt,ut,(function(t,n,o){a.addIntersectionResult(o,e.material.renderPriority,r,i,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}}},{key:"addIntersectionResult",value:function(e,t,n,i,r,a){var o={type:"external",metadata:{layerUid:r,graphicUid:a}},s=function(r){r.set(o,null,i.results.ground.dist,i.results.ground.normal,i.results.ground.transformation,t,null,null,e,n),r.intersector="OverlayRenderer"};if((null==i.results.min.drapedLayerOrder||t>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&s(i.results.min),0!==i.options.store&&(null==i.results.max.drapedLayerOrder||t<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&s(i.results.max),2===i.options.store){var c=new ee.a(i.ray);s(c),i.results.all.push(c)}}},{key:"ensureLayerRenderer",value:function(e){var t=this,n=this._layerRenderers.get(e);return n||(n=new ke({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return t.events.emit("content-changed")})),e),this._handles.add(Object(j.a)(n,"updating",(function(){return t.notifyChange("updating")})),e)),n}},{key:"updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((function(n){var i=n,r=e._layerRenderers.get(i);r&&(e._sortedLayerRenderers.push(new ot(i,r)),t.delete(r))})),t.forEach((function(t){return e._sortedLayerRenderers.push(new ot(null,t))}))}}},{key:"setViewParameters",value:function(e,t,n){n.viewport[0]=n.viewport[1]=0,n.viewport[2]=n.viewport[3]=t.resolution,Object(w.p)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),Object(w.j)(n.viewMatrix),Object(w.t)(n.viewMatrix,n.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=n,this._bindParameters.camera=n,this._bindParameters.inverseViewport[0]=1/n.fullViewport[2],this._bindParameters.inverseViewport[1]=1/n.fullViewport[3]}},{key:"updateHasWater",value:function(){var e=Object(g.c)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"updateHasHighlights",value:function(){var e=Object(g.c)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"updateRendersOccluded",value:function(){var e=Object(g.c)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"drawDebugTexture",value:function(e,t){var n=this._rctx;this.ensureDebugPatternResources(e,e);var i=this._debugTextureTechnique.program;n.useProgram(i),n.setPipelineState(this._debugTextureTechnique.pipeline),i.setUniform4f("color",t[0],t[1],t[2],1),i.bindTexture(this._debugPatternTexture,"tex"),n.bindVAO(this._quadVAO),n.drawArrays(5,0,Object(me.f)(this._quadVAO,"geometry"))}},{key:"ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var n=new Uint8Array(e*t*4),i=0,r=0;r<t;r++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(r/10);o<2||s<2||10*o>e-20||10*s>t-20?(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=255):(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=1&o&&1&s?1&a^1&r?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new z.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},n);var c=new Ae;c.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Ce,c),this._quadVAO=Object(K.b)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),n}(Object(q.b)(p.a));Object(d.a)([Object(q.c)()],at.prototype,"_shaderTechniqueRepository",void 0),Object(d.a)([Object(q.c)()],at.prototype,"_stippleTextureRepository",void 0),Object(d.a)([Object(_.b)({constructOnly:!0})],at.prototype,"view",void 0),Object(d.a)([Object(_.b)()],at.prototype,"worldToPCSRatio",void 0),Object(d.a)([Object(_.b)()],at.prototype,"spatialReference",void 0),Object(d.a)([Object(_.b)({type:Boolean,readOnly:!0})],at.prototype,"updating",null),at=Object(d.a)([Object(x.a)("esri.views.3d.terrain.OverlayRenderer")],at);var ot=function e(t,n){Object(c.a)(this,e),this.layerView=t,this.renderer=n},st=[[1,.5,.5],[.5,.5,1]],ct=new B.a;ct.near=1,ct.far=1e4,ct.relativeElevation=null;var lt=Object(S.e)(),ut=Object(S.e)(),ht=-2,dt=4},841:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u}));var i,r,a=n(541),o=n(579),s=n(537);function c(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(Object(s.a)(i||(i=Object(a.a)(["vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n{\nvec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\nvec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\nreprojectedCoord.xy /= reprojectedCoord.w;\nreturn reprojectedCoord.xy * 0.5 + 0.5;\n}"]))))}function l(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(o.a),e.include(c),e.fragment.code.add(Object(s.a)(r||(r=Object(a.a)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}function u(e,t){var n,i;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),i=t,(n=e).bindTexture(i.lastFrameColorTexture,"lastFrameColorMap"),n.setUniformMatrix4fv("reprojectionMat",i.reprojectionMat),n.setUniformMatrix4fv("rpProjectionMat",i.camera.projectionMatrix))}},858:function(e,t,n){"use strict";n.r(t),n.d(t,"buffer",(function(){return M})),n.d(t,"clip",(function(){return s})),n.d(t,"contains",(function(){return l})),n.d(t,"convexHull",(function(){return j})),n.d(t,"crosses",(function(){return u})),n.d(t,"cut",(function(){return c})),n.d(t,"densify",(function(){return I})),n.d(t,"difference",(function(){return _})),n.d(t,"disjoint",(function(){return b})),n.d(t,"distance",(function(){return h})),n.d(t,"equals",(function(){return d})),n.d(t,"extendedSpatialReferenceInfo",(function(){return o})),n.d(t,"flipHorizontal",(function(){return A})),n.d(t,"flipVertical",(function(){return V})),n.d(t,"generalize",(function(){return z})),n.d(t,"geodesicArea",(function(){return U})),n.d(t,"geodesicBuffer",(function(){return E})),n.d(t,"geodesicDensify",(function(){return G})),n.d(t,"geodesicLength",(function(){return H})),n.d(t,"intersect",(function(){return w})),n.d(t,"intersects",(function(){return p})),n.d(t,"isSimple",(function(){return O})),n.d(t,"nearestCoordinate",(function(){return P})),n.d(t,"nearestVertex",(function(){return T})),n.d(t,"nearestVertices",(function(){return D})),n.d(t,"offset",(function(){return S})),n.d(t,"overlaps",(function(){return g})),n.d(t,"planarArea",(function(){return L})),n.d(t,"planarLength",(function(){return F})),n.d(t,"relate",(function(){return m})),n.d(t,"rotate",(function(){return C})),n.d(t,"simplify",(function(){return y})),n.d(t,"symmetricDifference",(function(){return x})),n.d(t,"touches",(function(){return f})),n.d(t,"union",(function(){return k})),n.d(t,"within",(function(){return v}));var i=n(776),r=n(786);function a(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function o(e){return i.G.extendedSpatialReferenceInfo(e)}function s(e,t){return i.G.clip(r.hydratedAdapter,a(e),e,t)}function c(e,t){return i.G.cut(r.hydratedAdapter,a(e),e,t)}function l(e,t){return i.G.contains(r.hydratedAdapter,a(e),e,t)}function u(e,t){return i.G.crosses(r.hydratedAdapter,a(e),e,t)}function h(e,t,n){return i.G.distance(r.hydratedAdapter,a(e),e,t,n)}function d(e,t){return i.G.equals(r.hydratedAdapter,a(e),e,t)}function p(e,t){return i.G.intersects(r.hydratedAdapter,a(e),e,t)}function f(e,t){return i.G.touches(r.hydratedAdapter,a(e),e,t)}function v(e,t){return i.G.within(r.hydratedAdapter,a(e),e,t)}function b(e,t){return i.G.disjoint(r.hydratedAdapter,a(e),e,t)}function g(e,t){return i.G.overlaps(r.hydratedAdapter,a(e),e,t)}function m(e,t,n){return i.G.relate(r.hydratedAdapter,a(e),e,t,n)}function O(e){return i.G.isSimple(r.hydratedAdapter,a(e),e)}function y(e){return i.G.simplify(r.hydratedAdapter,a(e),e)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.G.convexHull(r.hydratedAdapter,a(e),e,t)}function _(e,t){return i.G.difference(r.hydratedAdapter,a(e),e,t)}function x(e,t){return i.G.symmetricDifference(r.hydratedAdapter,a(e),e,t)}function w(e,t){return i.G.intersect(r.hydratedAdapter,a(e),e,t)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i.G.union(r.hydratedAdapter,a(e),e,t)}function S(e,t,n,o,s,c){return i.G.offset(r.hydratedAdapter,a(e),e,t,n,o,s,c)}function M(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i.G.buffer(r.hydratedAdapter,a(e),e,t,n,o)}function E(e,t,n,o,s,c){return i.G.geodesicBuffer(r.hydratedAdapter,a(e),e,t,n,o,s,c)}function P(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return i.G.nearestCoordinate(r.hydratedAdapter,a(e),e,t,n)}function T(e,t){return i.G.nearestVertex(r.hydratedAdapter,a(e),e,t)}function D(e,t,n,o){return i.G.nearestVertices(r.hydratedAdapter,a(e),e,t,n,o)}function R(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function C(e,t,n){var r;if(null==e)throw new Error("Illegal Argument Exception");var a=e.spatialReference;if(null==(n=null!=(r=n)?r:R(e)))throw new Error("Illegal Argument Exception");var o=e.constructor.fromJSON(i.G.rotate(e,t,n));return o.spatialReference=a,o}function A(e,t){var n;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(t=null!=(n=t)?n:R(e)))throw new Error("Illegal Argument Exception");var a=e.constructor.fromJSON(i.G.flipHorizontal(e,t));return a.spatialReference=r,a}function V(e,t){var n;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(t=null!=(n=t)?n:R(e)))throw new Error("Illegal Argument Exception");var a=e.constructor.fromJSON(i.G.flipVertical(e,t));return a.spatialReference=r,a}function z(e,t,n,o){return i.G.generalize(r.hydratedAdapter,a(e),e,t,n,o)}function I(e,t,n){return i.G.densify(r.hydratedAdapter,a(e),e,t,n)}function G(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i.G.geodesicDensify(r.hydratedAdapter,a(e),e,t,n,o)}function L(e,t){return i.G.planarArea(r.hydratedAdapter,a(e),e,t)}function F(e,t){return i.G.planarLength(r.hydratedAdapter,a(e),e,t)}function U(e,t,n){return i.G.geodesicArea(r.hydratedAdapter,a(e),e,t,n)}function H(e,t,n){return i.G.geodesicLength(r.hydratedAdapter,a(e),e,t,n)}},859:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(2),r=n(3),a=function(){function e(t,n,r){Object(i.a)(this,e),this.editGeometry=t,this.vertices=n,this.operation=r,this.undone=!1}return Object(r.a)(e,[{key:"apply",value:function(){var e=this;this.vertices.forEach((function(t){return e.operation.apply(t)})),this.editGeometry.components.forEach((function(e){return e.unnormalizeVertexPositions()})),this.editGeometry.notifyChanges({operation:this.undone?"redo":"apply",updatedVertices:this.vertices})}},{key:"undo",value:function(){var e=this;this.vertices.forEach((function(t){return e.operation.undo(t)})),this.editGeometry.notifyChanges({operation:"undo",updatedVertices:this.vertices}),this.undone=!0}},{key:"canAccumulate",value:function(e){if(this.undone||e.vertices.length!==this.vertices.length)return!1;for(var t=0;t<e.vertices.length;++t)if(e.vertices[t]!==this.vertices[t])return!1;return this.operation.canAccumulate(e.operation)}},{key:"accumulate",value:function(t){var n=this;return!!(t instanceof e&&this.canAccumulate(t))&&(this.vertices.forEach((function(e){return n.operation.accumulate(e,t.operation)})),this.operation.accumulateParams(t.operation),this.editGeometry.components.forEach((function(e){return e.unnormalizeVertexPositions()})),this.editGeometry.notifyChanges({operation:"apply",updatedVertices:this.vertices}),!0)}}]),e}()},860:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(2),r=n(3),a=function(){function e(t,n,r,a){Object(i.a)(this,e),this.helper=t,this.dx=n,this.dy=r,this.dz=a}return Object(r.a)(e,[{key:"move",value:function(e,t,n,i){this.helper.addDelta(e.pos,t,n,i)}},{key:"apply",value:function(e){this.move(e,this.dx,this.dy,this.dz)}},{key:"undo",value:function(e){this.move(e,-this.dx,-this.dy,-this.dz)}},{key:"canAccumulate",value:function(t){return t instanceof e}},{key:"accumulate",value:function(e,t){this.move(e,t.dx,t.dy,t.dz)}},{key:"accumulateParams",value:function(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}]),e}()},861:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(23),r=n(2),a=n(3),o=n(65),s=n(7),c=n(30),l=n(60),u=n(58),h=n(79),d=n(596),p=n(678),f=n(98),v=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(r.a)(this,e),this.helper=t,this.planeType=n,this.edge=i,this.distance=a,this._plane=Object(d.d)(),this._offsetPlane=Object(d.d)(),this._minDistance=-1/0,this._maxDistance=1/0,0===o&&this._initialize()}return Object(a.a)(e,[{key:"plane",get:function(){return this._plane}},{key:"requiresSplitEdgeLeft",get:function(){return!this._left.isOriginalDirection}},{key:"requiresSplitEdgeRight",get:function(){return!this._right.isOriginalDirection}},{key:"edgeDirection",get:function(){return this._edgeDirection}},{key:"_initialize",value:function(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}},{key:"_initializeNeighbors",value:function(){var e,t,n,i,r=this._toXYZ(this.edge.leftVertex.pos),a=this._toXYZ(null==(e=this.edge.leftVertex.leftEdge)||null==(t=e.leftVertex)?void 0:t.pos),o=this._toXYZ(this.edge.rightVertex.pos),s=this._toXYZ(null==(n=this.edge.rightVertex.rightEdge)||null==(i=n.rightVertex)?void 0:i.pos);this._edgeDirection=Object(u.v)(Object(h.e)(),r,o),this._left=this._computeNeighbor(r,a,this._edgeDirection),this._right=this._computeNeighbor(o,s,this._edgeDirection)}},{key:"_toXYZ",value:function(e){return Object(s.k)(e)?this.helper.toXYZ(e):null}},{key:"_computeNeighbor",value:function(e,t,n){if(Object(s.j)(t))return{start:e,end:t,direction:Object(h.g)(-n[1],n[0],0),isOriginalDirection:!0};var i=Object(u.v)(Object(h.e)(),e,t),r=!this._passesBisectingAngleThreshold(i,n);return{start:e,end:t,direction:r?this._bisectVectorsPerpendicular(n,i):i,isOriginalDirection:!r}}},{key:"_passesBisectingAngleThreshold",value:function(e,t){var n=Math.abs(Object(p.a)(t,e));return n>=b&&n<=Math.PI-b}},{key:"_bisectVectorsPerpendicular",value:function(e,t){var n=Object(u.h)(e,t)<0?e:Object(u.s)(Object(h.e)(),e),i=Math.abs(Object(u.h)(n,t));if(!(i<.001||i>.999))return this._bisectDirection(n,t);var r=Object(u.g)(Object(h.e)(),n,[0,0,1]);return Object(u.r)(r,r)}},{key:"_bisectDirection",value:function(e,t){var n=Object(u.f)(Object(h.e)(),e,t);return Object(u.r)(n,n)}},{key:"_initializePlane",value:function(){var e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);Object(u.h)(e,t)<0&&Object(u.s)(t,t),Object(d.g)(this._left.start,this._bisectDirection(e,t),this._plane)}},{key:"_computeNormalDirection",value:function(e){var t=Object(u.g)(Object(h.e)(),e.direction,this._edgeDirection);Object(u.r)(t,t);var n=Object(u.g)(Object(h.e)(),this._edgeDirection,t);return 1===this.planeType&&(n[2]=0),Object(u.r)(n,n)}},{key:"_initializeDistanceConstraints",value:function(){Object(s.k)(this._left.end)&&!this.requiresSplitEdgeLeft&&this._updateDistanceConstraint(Object(d.t)(this._plane,this._left.end)),Object(s.k)(this._right.end)&&!this.requiresSplitEdgeRight&&this._updateDistanceConstraint(Object(d.t)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}},{key:"_updateDistanceConstraint",value:function(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}},{key:"_updateIntersectDistanceConstraint",value:function(e){var t=Object(d.q)(e),n=this._edgeDirection,r=Object(u.f)(Object(h.e)(),this._left.start,this._left.direction),a=Object(u.f)(Object(h.e)(),this._right.start,this._right.direction),o=this._pointInBasis2D(Object(l.a)(),t,n,this._left.start),s=this._pointInBasis2D(Object(l.a)(),t,n,r),p=this._pointInBasis2D(Object(l.a)(),t,n,this._right.start),v=this._pointInBasis2D(Object(l.a)(),t,n,a),b=Object(f.c)({start:s,end:o,type:1},{start:v,end:p,type:1}),g=Object(i.a)(b,1)[0];if(g){var m=Object(c.a)(Object(l.a)(),o,s);Object(c.f)(m,m);var O=Object(c.a)(Object(l.a)(),g,s),y=Object(c.h)(m,O),j=Object(u.f)(Object(h.e)(),r,Object(u.e)(Object(h.e)(),this._left.direction,-y)),_=Object(d.t)(e,j);this._updateDistanceConstraint(_)}}},{key:"_pointInBasis2D",value:function(e,t,n,i){return e[0]=Object(p.d)(t,i),e[1]=Object(p.d)(n,i),e}},{key:"_offset",value:function(e,t){var n=this;Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),Object(d.c)(this._plane,this._offsetPlane),this._offsetPlane[3]-=t;var i=function(e,t,i){return Object(s.k)(t)&&Object(d.j)(n._offsetPlane,e,Object(u.f)(Object(h.e)(),e,t),i)},r=Object(h.e)();(e===this.edge.leftVertex?i(this._left.start,this._left.direction,r):i(this._right.start,this._right.direction,r))&&this.helper.copy(this.helper.fromXYZ(r,void 0,this.helper.getM(e.pos)),e.pos)}},{key:"signedDistanceToPoint",value:function(e){return Object(d.t)(this.plane,this.helper.toXYZ(this.helper.pointToVector(e)))}},{key:"apply",value:function(e){this._offset(e,this.distance)}},{key:"undo",value:function(e){this._offset(e,0)}},{key:"canAccumulate",value:function(t){return t instanceof e&&this.edge.leftVertex.index===t.edge.leftVertex.index&&this.edge.rightVertex.index===t.edge.rightVertex.index&&this.edge.component===t.edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&Object(u.D)(Object(d.q)(this._plane),Object(d.q)(t._plane))}},{key:"accumulate",value:function(e,t){var n=this._plane[3]-t._plane[3]+t.distance;this._offset(e,n)}},{key:"accumulateParams",value:function(e){var t=e.distance-e._plane[3];this.distance=t+this._plane[3]}},{key:"clone",value:function(){var t=new e(this.helper,this.planeType,this.edge,this.distance,1);return Object(d.c)(this._plane,t._plane),Object(d.c)(this._offsetPlane,t._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=Object(u.k)(Object(h.e)(),this._edgeDirection),t}},{key:"_maybeEqualsVec3",value:function(e,t){return Object(s.j)(e)&&Object(s.j)(t)||Object(s.k)(e)&&Object(s.k)(t)&&Object(u.D)(e,t)}},{key:"_cloneNeighbor",value:function(e){var t=e.start,n=e.end,i=e.direction,r=e.isOriginalDirection;return{start:Object(u.k)(Object(h.e)(),t),end:Object(s.k)(n)?Object(u.k)(Object(h.e)(),n):null,direction:Object(u.k)(Object(h.e)(),i),isOriginalDirection:r}}}]),e}(),b=Object(o.f)(15)},862:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(2),r=n(3),a=n(102),o=n(30),s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),this.origin=t,this.angle=n,this.accumulationType=r}return Object(r.a)(e,[{key:"rotate",value:function(e,t){Object(o.r)(e.pos,e.pos,this.origin,t)}},{key:"apply",value:function(e){this.rotate(e,this.angle)}},{key:"undo",value:function(e){this.rotate(e,-this.angle)}},{key:"canAccumulate",value:function(t){return t instanceof e&&Object(a.c)(this.origin,t.origin)}},{key:"accumulate",value:function(e,t){var n=1===t.accumulationType;this.rotate(e,n?t.angle-this.angle:t.angle)}},{key:"accumulateParams",value:function(e){var t=1===e.accumulationType;this.angle=t?e.angle:this.angle+e.angle}}]),e}()},863:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(2),r=n(3),a=n(102),o=n(60),s=n(30),c=function(){function e(t,n,r,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(i.a)(this,e),this.origin=t,this.axis1=n,this.factor1=r,this.factor2=a,this.accumulationType=s,this.axis2=Object(o.e)(n[1],-n[0])}return Object(r.a)(e,[{key:"scale",value:function(e,t,n){Object(s.p)(e.pos,e.pos,this.origin,this.axis1,t),Object(s.p)(e.pos,e.pos,this.origin,this.axis2,n)}},{key:"apply",value:function(e){this.scale(e,this.factor1,this.factor2)}},{key:"undo",value:function(e){this.scale(e,1/this.factor1,1/this.factor2)}},{key:"canAccumulate",value:function(t){return t instanceof e&&Object(a.c)(this.origin,t.origin)&&Object(a.c)(this.axis1,t.axis1)}},{key:"accumulate",value:function(e,t){1===t.accumulationType?this.scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this.scale(e,t.factor1,t.factor2)}},{key:"accumulateParams",value:function(e){var t=1===e.accumulationType;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}]),e}()},864:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(13),r=n(2),a=n(3),o=n(7),s=n(115),c=n(212),l=n(58),u=n(79),h=n(762),d=n(578),p=n(677),f=n(566),v=function(){function e(t,n){Object(r.a)(this,e),this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new b,this._objectCount=0,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth))}return Object(a.a)(e,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}},{key:"destroy",value:function(){this._degenerateObjects.clear(),b.clearPool(),E[0]=null,C.prune(),L.prune()}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);for(var n=b.acquire(),i=0;i<t;i++){var r=e[i];this._isDegenerate(r)?this._degenerateObjects.add(r):(n.init(this._root),this._add(r,n))}b.release(n)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;var n,r=b.acquire(),a=Object(i.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=Object(o.k)(t)?t:Object(p.d)(this._objectToBoundingSphere(s),A);w(c[3])?(r.init(this._root),this._remove(s,c,r)):this._degenerateObjects.delete(s)}}catch(l){a.e(l)}finally{a.f()}b.release(r),this._shrink()}},{key:"update",value:function(e,t){if(w(t[3])||!this._isDegenerate(e)){var n=function(e){return E[0]=e,E}(e);this.remove(n,t),this.add(n)}}},{key:"forEachAlongRay",value:function(e,t,n){var i=this,r=Object(d.g)(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNode(r,e))return!1;var t=e.node;return t.terminals.forAll((function(e){i._intersectsObject(r,e)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){i._intersectsObject(r,e)&&n(e)})),!0}))}},{key:"forEachAlongRayWithVerticalOffset",value:function(e,t,n,i){var r=this,a=Object(d.g)(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNodeWithOffset(a,e,i))return!1;var t=e.node;return t.terminals.forAll((function(e){r._intersectsObjectWithOffset(a,e,i)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){r._intersectsObjectWithOffset(a,e,i)&&n(e)})),!0}))}},{key:"forEach",value:function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forAll(e),null!==n.residents&&n.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}},{key:"forEachDegenerateObject",value:function(e){this._degenerateObjects.forEach(e)}},{key:"findClosest",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,s=1/0,c=null,u=_(e,t),d=function(l){if(--a,r(l)){var u=i._objectToBoundingSphere(l);if(Object(h.e)(n,u)){var d=x(e,t,Object(p.c)(u)),f=d-u[3],v=d+u[3];f<o&&(o=f,s=v,c=l)}}};return this._forEachNodeDepthOrdered(this._root,(function(i){if(a<=0||!Object(h.e)(n,i.bounds))return!1;if(Object(l.e)(T,u,i.halfSize),Object(l.f)(T,T,i.bounds),x(e,t,T)>s)return!1;var r=i.node;return r.terminals.forAll((function(e){return d(e)})),null!==r.residents&&r.residents.forAll((function(e){return d(e)})),!0}),e,t),c}},{key:"forEachInDepthRange",value:function(e,t,n,i,r,a,o){var s=this,c=-1/0,u=1/0,d={setRange:function(e){1===n?(c=Math.max(c,e.near),u=Math.min(u,e.far)):(c=Math.max(c,-e.far),u=Math.min(u,-e.near))}};d.setRange(i);var f=x(t,n,e),v=_(t,n),b=_(t,-n),g=function(e){if(o(e)){var i=s._objectToBoundingSphere(e),l=Object(p.c)(i),v=x(t,n,l)-f,b=v-i[3],g=v+i[3];b>u||g<c||!Object(h.e)(a,i)||r(e,d)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(!Object(h.e)(a,e.bounds))return!1;if(Object(l.e)(T,v,e.halfSize),Object(l.f)(T,T,e.bounds),x(t,n,T)-f>u)return!1;if(Object(l.e)(T,b,e.halfSize),Object(l.f)(T,T,e.bounds),x(t,n,T)-f<c)return!1;var i=e.node;return i.terminals.forAll((function(e){return g(e)})),null!==i.residents&&i.residents.forAll((function(e){return g(e)})),!0}),t,n)}},{key:"forEachNode",value:function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.bounds,t.halfSize)}))}},{key:"_intersectsNode",value:function(e,t){return O(t.bounds,2*-t.halfSize,D),O(t.bounds,2*t.halfSize,R),Object(f.i)(e.origin,e.direction,D,R)}},{key:"_intersectsNodeWithOffset",value:function(e,t,n){return O(t.bounds,2*-t.halfSize,D),O(t.bounds,2*t.halfSize,R),n.applyToMinMax(D,R),Object(f.i)(e.origin,e.direction,D,R)}},{key:"_intersectsObject",value:function(e,t){var n=this._objectToBoundingSphere(t);return!(n[3]>0)||Object(p.e)(n,e)}},{key:"_intersectsObjectWithOffset",value:function(e,t,n){var i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(p.e)(n.applyToBoundingSphere(i),e)}},{key:"_forEachNode",value:function(e,t){for(var n=b.acquire().init(e),i=[n];0!==i.length;){if(t(n=i.pop())&&!n.isLeaf())for(var r=0;r<n.node.children.length;r++)n.node.children[r]&&i.push(b.acquire().init(n).advance(r));b.release(n)}}},{key:"_forEachNodeDepthOrdered",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=b.acquire().init(e),a=[r];for(j(n,i,F);0!==a.length;){if(t(r=a.pop())&&!r.isLeaf())for(var o=7;o>=0;--o){var s=F[o];r.node.children[s]&&a.push(b.acquire().init(r).advance(s))}b.release(r)}}},{key:"_remove",value:function(e,t,n){C.clear();var i=n.advanceTo(t,(function(e,t){C.push(e.node),C.push(t)}))?n.node.terminals:n.node.residents;if(i.removeUnordered(e),0===i.length)for(var r=C.length-2;r>=0;r-=2){var a=C.data[r],o=C.data[r+1];if(!this._purge(a,o))break}}},{key:"_nodeIsEmpty",value:function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}},{key:"_purge",value:function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new c.a({shrink:!0})),!0)}},{key:"_add",value:function(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}},{key:"_split",value:function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var i=b.acquire().init(e);this._add(t.getItemAt(n),i),b.release(i)}}},{key:"_grow",value:function(e,t){var n=this;if(0!==t&&(y(e,t,(function(e){return n._objectToBoundingSphere(e)}),V),w(V[3])&&!this._fitsInsideTree(V)))if(this._nodeIsEmpty(this._root.node))Object(p.d)(V,this._root.bounds),this._root.halfSize=1.25*V[3];else{var i=this._rootBoundsForRootAsSubNode(V);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(V,i):this._growRootAsSubNode(i),b.release(i)}}},{key:"_rebuildTree",value:function(e,t){var n=this;Object(l.k)(z,t.bounds),z[3]=t.halfSize,y([e,z],2,(function(e){return e}),I);var i=b.acquire().init(this._root);this._root.initFrom(null,I,1.25*I[3]),this._forEachNode(i,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),b.release(i)}},{key:"_placingRootViolatesMaxDepth",value:function(e){var t=this,n=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E,i=0;return this._forEachNode(this._root,(function(e){return(i=Math.max(i,e.depth))+n<=t._maximumDepth})),i+n>this._maximumDepth}},{key:"_rootBoundsForRootAsSubNode",value:function(e){for(var t=e[3],n=e,i=-1/0,r=this._root.bounds,a=this._root.halfSize,o=0;o<3;o++){var s=r[o]-a-(n[o]-t),c=n[o]+t-(r[o]+a),l=Math.max(0,Math.ceil(s/(2*a))),u=Math.max(0,Math.ceil(c/(2*a)))+1,h=Math.pow(2,Math.ceil(Math.log(l+u)*Math.LOG2E));i=Math.max(i,h),G[o].min=l,G[o].max=u}for(var d=0;d<3;d++){var p=G[d].min,f=G[d].max,v=(i-(p+f))/2;p+=Math.ceil(v),f+=Math.floor(v);var g=r[d]-a-p*a*2;P[d]=g+(f+p)*a}return P[3]=i*a*M,b.acquire().initFrom(null,P,i*a,0)}},{key:"_growRootAsSubNode",value:function(e){var t=this._root.node;Object(l.k)(V,this._root.bounds),V[3]=this._root.halfSize,this._root.init(e),e.advanceTo(V,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}},{key:"_shrink",value:function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}},{key:"_findShrinkIndex",value:function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,i=0;i<t.length&&null==e;)e=t[n=i++];for(;i<t.length;)if(t[i++])return-1;return n}},{key:"_isDegenerate",value:function(e){return!w(this._objectToBoundingSphere(e)[3])}},{key:"_fitsInsideTree",value:function(e){var t=this._root.bounds,n=this._root.halfSize;return e[3]<=n&&e[0]>=t[0]-n&&e[0]<=t[0]+n&&e[1]>=t[1]-n&&e[1]<=t[1]+n&&e[2]>=t[2]-n&&e[2]<=t[2]+n}}]),e}(),b=function(){function e(){Object(r.a)(this,e),this.bounds=Object(p.b)(),this.halfSize=0,this.initFrom(null,null,0,0)}return Object(a.a)(e,[{key:"init",value:function(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}},{key:"initFrom",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=Object(o.k)(t)?t:e.createEmptyNode(),Object(o.k)(n)&&Object(p.d)(n,this.bounds),this.halfSize=i,this.depth=r,this}},{key:"advance",value:function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var i=k[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*M,this}},{key:"advanceTo",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!n)return t&&t(this,-1),!1;this.node.residents=null}var i=this._childIndex(e);t&&t(this,i),this.advance(i)}}},{key:"isLeaf",value:function(){return null!=this.node.residents}},{key:"isTerminalFor",value:function(e){return e[3]>this.halfSize/2}},{key:"_childIndex",value:function(e){var t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}}],[{key:"createEmptyNode",value:function(){return{children:[null,null,null,null,null,null,null,null],terminals:new c.a({shrink:!0}),residents:new c.a({shrink:!0})}}},{key:"acquire",value:function(){return e._pool.acquire()}},{key:"release",value:function(t){e._pool.release(t)}},{key:"clearPool",value:function(){e._pool.prune()}}]),e}();function g(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function m(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function O(e,t,n){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function y(e,t,n,i){if(1===t){var r=n(e[0]);Object(p.d)(r,i)}else{D[0]=1/0,D[1]=1/0,D[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(var a=0;a<t;a++){var o=n(e[a]);w(o[3])&&(g(D,o),m(R,o))}Object(l.i)(i,D,R,.5),i[3]=Math.max(R[0]-D[0],R[1]-D[1],R[2]-D[2])/2}}function j(e,t,n){if(!L.length)for(var i=0;i<8;++i)L.push({index:0,distance:0});for(var r=0;r<8;++r){var a=k[r];L.data[r].index=r,L.data[r].distance=x(e,t,a)}L.sort((function(e,t){return e.distance-t.distance}));for(var o=0;o<8;++o)n[o]=L.data[o].index}function _(e,t){for(var n=1/0,i=null,r=0;r<8;++r){var a=x(e,t,S[r]);a<n&&(n=a,i=S[r])}return i}function x(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}function w(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}b._pool=new s.a(b);var k=[Object(u.g)(-1,-1,-1),Object(u.g)(1,-1,-1),Object(u.g)(-1,1,-1),Object(u.g)(1,1,-1),Object(u.g)(-1,-1,1),Object(u.g)(1,-1,1),Object(u.g)(-1,1,1),Object(u.g)(1,1,1)],S=[Object(u.g)(-1,-1,-1),Object(u.g)(-1,-1,1),Object(u.g)(-1,1,-1),Object(u.g)(-1,1,1),Object(u.g)(1,-1,-1),Object(u.g)(1,-1,1),Object(u.g)(1,1,-1),Object(u.g)(1,1,1)],M=Math.sqrt(3),E=[null];var P=Object(p.b)(),T=Object(u.e)(),D=Object(u.e)(),R=Object(u.e)(),C=new c.a,A=Object(p.b)(),V=Object(p.b)(),z=Object(p.b)(),I=Object(p.b)(),G=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],L=new c.a,F=[0,0,0,0,0,0,0,0]},866:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i,r=n(562),a=n(712);!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(a.c)(1,1,1),vvSizeMaxSize:Object(a.c)(100,100,100),vvSizeOffset:Object(a.c)(0,0,0),vvSizeFactor:Object(a.c)(1,1,1),vvSizeValue:Object(a.c)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(r.b)()}}(i||(i={}));var o=i},867:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i,r,a,o,s,c,l=n(541),u=n(537);function h(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(Object(u.a)(i||(i=Object(l.a)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add("size","float"),e.vertex.code.add(Object(u.a)(r||(r=Object(l.a)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(Object(u.a)(a||(a=Object(l.a)(["uniform float vvOpacityValues[vvOpacityNumber];\nuniform float vvOpacityOpacities[vvOpacityNumber];\nfloat interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):e.vertex.code.add(Object(u.a)(o||(o=Object(l.a)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(Object(u.a)(s||(s=Object(l.a)(["uniform float vvColorValues[vvColorNumber];\nuniform vec4 vvColorColors[vvColorNumber];\nvec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(Object(u.a)(c||(c=Object(l.a)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},868:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i,r,a,o,s=n(541),c=n(579),l=n(747),u=n(714),h=n(537);function d(e,t){t.multipassGeometryEnabled&&e.vertex.include(l.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(Object(h.a)(i||(i=Object(s.a)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassGeometryEnabled?Object(h.a)(r||(r=Object(s.a)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassTerrainEnabled?"depth = projectAux.posView.z;":"")),t.multipassTerrainEnabled&&e.fragment.include(c.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(u.a),e.fragment.code.add(Object(h.a)(a||(a=Object(s.a)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.multipassTerrainEnabled?Object(h.a)(o||(o=Object(s.a)(["\n\n          vec2 uv = gl_FragCoord.xy * inverseViewport;\n\n          //Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);\n\n          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          //Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"]))):""))}},869:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return c}));var i=n(26),r=n(7),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat(Object(i.a)(a.dash),Object(i.a)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat(Object(i.a)(a["long-dash"]),Object(i.a)(a.dot)),"long-dash-dot-dot":[].concat(Object(i.a)(a["long-dash"]),Object(i.a)(a.dot),Object(i.a)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat(Object(i.a)(a["short-dash"]),Object(i.a)(a["short-dot"])),"short-dash-dot-dot":[].concat(Object(i.a)(a["short-dash"]),Object(i.a)(a["short-dot"]),Object(i.a)(a["short-dot"])),"short-dot":a["short-dot"],solid:null};function s(e){return Object(r.j)(e)?e:e.slice()}function c(e,t){return Object(r.c)(e,(function(e){return e.map((function(e){return e*t}))}))}function l(e){return Object(r.c)(e,(function(e){return s(o[e])}))}},870:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(26),r=n(2),a=n(3),o=n(7),s=n(546),c=n(58),l=n(79),u=n(383),h=n(661),d=n(824),p=n(664),f=n(771),v=n(707),b=0,g=function(){function e(t){Object(r.a)(this,e),this._originSR=t,this.ROOT_ORIGIN_ID="rg_root_"+b++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}return Object(a.a)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(o.k)(m))return this._origins.set(this.ROOT_ORIGIN_ID,Object(d.a)(m[0],m[1],m[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e);var n=Object(d.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,n),n}var r=this._gridSize,a=Math.round(e[0]/r),s=Math.round(e[1]/r),l=Math.round(e[2]/r),u="".concat("rg_").concat(a,"/").concat(s,"/").concat(l),h=this._origins.get(u),p=.5*r;if(Object(c.j)(O,e,t.vec3),O[0]=Math.abs(O[0]),O[1]=Math.abs(O[1]),O[2]=Math.abs(O[2]),O[0]<p&&O[1]<p&&O[2]<p){if(h){var f=Math.max.apply(Math,Object(i.a)(O));if(Object(c.j)(O,e,h.vec3),O[0]=Math.abs(O[0]),O[1]=Math.abs(O[1]),O[2]=Math.abs(O[2]),Math.max.apply(Math,Object(i.a)(O))<f)return h}return t}return h||(h=Object(d.a)(a*r,s*r,l*r,u),this._origins.set(u,h)),h}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,0,1],n=window.view,i=n._stage,r=t.toString();if(!this._objects.has(r)){this._material=new v.a({width:2,color:t}),i.add(this._material);var a=new f.a({isPickable:!1}),o=new p.a({castShadow:!1});i.add(o),a.add(o),i.add(a),this._objects.set(r,o)}for(var c=this._objects.get(r),l=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],d=l.length,b=new Array(3*d),g=new Uint16Array(2*(d-1)),m=.5*this._gridSize,O=0;O<d;O++)b[3*O+0]=e[0]+(1&l[O]?m:-m),b[3*O+1]=e[1]+(2&l[O]?m:-m),b[3*O+2]=e[2]+(4&l[O]?m:-m),O>0&&(g[2*O+0]=O-1,g[2*O+1]=O);Object(u.l)(b,this._originSR,0,b,n.renderSpatialReference,0,d);var y=new h.a([["position",{size:3,data:b,exclusive:!0}]],[["position",g]],2);i.add(y),c.addGeometry(y,this._material,s.a)}},{key:"test",get:function(){var e=this;return{get gridSize(){return e._gridSize},set gridSize(t){e._gridSize=t}}}}]),e}(),m=null;var O=Object(l.e)()},871:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(680),c=n(872),l=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).updateParameters(),r}return Object(r.a)(n,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(c.a,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(2===this._output)return 24===e;if(5===this._output)return 23===e;if(4===this._output)return 3===e||23===e;var t=3;return this._material.params.transparent&&(t=this._material.params.writeDepth?5:8),e===t}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.params.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){return this._technique.ensureResource(e)}},{key:"ensureParameters",value:function(e){0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)}}]),n}(s.a)},872:function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return w}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(0),c=n(556),l=n(574),u=n(567),h=n(642),d=n(841),p=n(793),f=n(641),v=n(608),b=n(617),g=n(623),m=n(618),O=n(612),y=n(609),j=n(826),_=n(543),x=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e,r,a){var o;return Object(i.a)(this,n),(o=t.call(this,e,r,a))._textureRepository=e.waterTextureRepository,o}return Object(r.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new y.a(e.rctx,r,m.a)}},{key:"ensureResource",value:function(e){return this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(e),this._textureRepository.ready?2:1}},{key:"bindPass",value:function(e,t){Object(f.c)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(u.a)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(d.b)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(p.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(l.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(f.d)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(f.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(h.b)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(c.c)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,i=2===e;return Object(_.f)({blending:2!==t.output&&4!==t.output&&t.transparent?n?O.g:Object(O.a)(e):null,depthTest:{func:Object(O.b)(e)},depthWrite:n?t.writeDepth&&_.d:Object(O.c)(e),colorWrite:_.c,polygonOffset:n||i?null:Object(O.h)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),n}(b.a);x.shader=new v.a(j.a,(function(){return n.e(214).then(n.bind(null,996))}));var w=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments)).output=0,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(g.a);Object(s.a)([Object(g.b)({count:8})],w.prototype,"output",void 0),Object(s.a)([Object(g.b)()],w.prototype,"receiveShadows",void 0),Object(s.a)([Object(g.b)()],w.prototype,"slicePlaneEnabled",void 0),Object(s.a)([Object(g.b)()],w.prototype,"transparent",void 0),Object(s.a)([Object(g.b)()],w.prototype,"enableOffset",void 0),Object(s.a)([Object(g.b)()],w.prototype,"writeDepth",void 0),Object(s.a)([Object(g.b)()],w.prototype,"useSSR",void 0),Object(s.a)([Object(g.b)()],w.prototype,"isDraped",void 0),Object(s.a)([Object(g.b)({count:4})],w.prototype,"transparencyPassType",void 0),Object(s.a)([Object(g.b)()],w.prototype,"multipassTerrainEnabled",void 0),Object(s.a)([Object(g.b)()],w.prototype,"cullAboveGround",void 0)},873:function(e,t,n){"use strict";function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,"a",(function(){return i}))},888:function(e,t,n){"use strict";n.d(t,"a",(function(){return K}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(65),l=n(7),u=n(35),h=n(235),d=n(562),p=n(100),f=n(546),v=n(30),b=n(60),g=n(58),m=n(79);function O(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var y=n(139),j=n(646),_=n(660),x=n(820),w=n(624),k=n(922),S=n(566),M=n(695),E=n(619),P=n(653),T=n(726),D=n(0),R=n(556),C=n(701),A=n(727),V=n(574),z=n(747),I=n(567),G=n(654),L=n(746),F=n(641),U=n(608),H=n(617),N=n(623),q=n(618),B=n(612),W=n(609),Z=n(543),X=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new W.a(e.rctx,r,q.a)}},{key:"bindPass",value:function(e,t){Object(F.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(C.b)(this.program,e,t),Object(L.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(F.f)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(z.a)(this.program,t),Object(I.a)(this.program,t)):(Object(A.b)(this.program,t),Object(T.c)(this.program,e,t.camera.pixelRatio||1),Object(G.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(V.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(F.d)(this.program,e),Object(F.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(R.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,i=2===e,r=this.configuration.polygonOffsetEnabled&&Y,a=(n||i)&&4!==t.output?(t.depthEnabled||6===t.output)&&Z.d:null;return Object(Z.f)({blending:0===t.output||7===t.output||4===t.output?n?Q:Object(B.a)(e):null,depthTest:{func:515},depthWrite:a,colorWrite:Z.c,polygonOffset:r})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]),n}(H.a);X.shader=new U.a(T.a,(function(){return n.e(203).then(n.bind(null,1107))}));var Y={factor:0,units:-4},Q=Object(Z.h)(1,771),J=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.occlusionTestEnabled=!0,e.sdf=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.screenSizePerspective=!1,e.screenCenterOffsetUnitsEnabled=0,e.debugDrawBorder=!0,e.binaryHighlightOcclusion=!0,e.slicePlaneEnabled=!1,e.polygonOffsetEnabled=!1,e.depthEnabled=!0,e.transparencyPassType=3,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.multipassGeometryEnabled=!1,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(N.a);Object(D.a)([Object(N.b)({count:8})],J.prototype,"output",void 0),Object(D.a)([Object(N.b)()],J.prototype,"occlusionTestEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"sdf",void 0),Object(D.a)([Object(N.b)()],J.prototype,"vvSize",void 0),Object(D.a)([Object(N.b)()],J.prototype,"vvColor",void 0),Object(D.a)([Object(N.b)()],J.prototype,"verticalOffset",void 0),Object(D.a)([Object(N.b)()],J.prototype,"screenSizePerspective",void 0),Object(D.a)([Object(N.b)({count:2})],J.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"debugDrawBorder",void 0),Object(D.a)([Object(N.b)()],J.prototype,"binaryHighlightOcclusion",void 0),Object(D.a)([Object(N.b)()],J.prototype,"slicePlaneEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"polygonOffsetEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"depthEnabled",void 0),Object(D.a)([Object(N.b)({count:4})],J.prototype,"transparencyPassType",void 0),Object(D.a)([Object(N.b)()],J.prototype,"pixelSnappingEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"isDraped",void 0),Object(D.a)([Object(N.b)()],J.prototype,"multipassGeometryEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"multipassTerrainEnabled",void 0),Object(D.a)([Object(N.b)()],J.prototype,"cullAboveGround",void 0);var K=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,je)).techniqueConfig=new J,i}return Object(a.a)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,n,i,r,a,o,s,c){c?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,n,i,o,s)}},{key:"intersectDrapedHudGeometry",value:function(e,t,n,i){var r=e.vertexAttributes.get("position"),a=e.vertexAttributes.get("size"),o=this.params,s=Object(T.d)(o),c=1,u=1;if(Object(l.k)(i)){var h=i(be);c=h[0],u=h[5]}c*=e.screenToWorldRatio,u*=e.screenToWorldRatio;for(var d=me*e.screenToWorldRatio,p=0;p<r.data.length/r.size;p++){var f=p*r.size,v=r.data[f],b=r.data[f+1],g=p*a.size,m=void 0;Oe[0]=a.data[g]*c,Oe[1]=a.data[g+1]*u,o.textureIsSignedDistanceField&&(m=o.outlineSize*e.screenToWorldRatio/2),ie(t,v,b,Oe,d,m,o,s)&&n()}}},{key:"intersectHudGeometry",value:function(e,t,n,i,r,a){if(i.options.selectionMode&&i.options.hud&&!Object(P.e)(t)){var o=this.params,s=1,c=1;if(Object(h.f)(he,n),Object(l.k)(a)){var u=a(be);s=u[0],c=u[5],function(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=1/Math.sqrt(t*t+n*n+i*i),h=1/Math.sqrt(r*r+a*a+o*o),d=1/Math.sqrt(s*s+c*c+l*l);e[0]=t*u,e[1]=n*u,e[2]=i*u,e[3]=r*h,e[4]=a*h,e[5]=o*h,e[6]=s*d,e[7]=c*d,e[8]=l*d}(he)}var d=e.vertexAttributes.get("position"),f=e.vertexAttributes.get("size"),v=e.vertexAttributes.get("normal"),b=e.vertexAttributes.get("auxpos1");Object(S.a)(d.size>=3);var O=i.point,y=i.camera,j=Object(T.d)(o);s*=y.pixelRatio,c*=y.pixelRatio;for(var _="screen"===this.params.centerOffsetUnits,x=0;x<d.data.length/d.size;x++){var w=x*d.size;Object(g.w)(oe,d.data[w],d.data[w+1],d.data[w+2]),Object(g.q)(oe,oe,n);var M=x*f.size;Oe[0]=f.data[M]*s,Oe[1]=f.data[M+1]*c,Object(g.q)(oe,oe,y.viewMatrix);var E=x*b.size;if(Object(g.w)(fe,b.data[E+0],b.data[E+1],b.data[E+2]),!_&&(oe[0]+=fe[0],oe[1]+=fe[1],0!==fe[2])){var D=fe[2];Object(g.r)(fe,oe),Object(g.j)(oe,oe,Object(g.e)(fe,fe,D))}var R=x*v.size;if(Object(g.w)(se,v.data[R],v.data[R+1],v.data[R+2]),this.normalAndViewAngle(se,he,y,ve),this.applyVerticalOffsetTransformationView(oe,ve,y,re),y.applyProjection(oe,ce),ce[0]>-1){var C=Math.floor(ce[0])+this.params.screenOffset[0],A=Math.floor(ce[1])+this.params.screenOffset[1];_&&(C+=fe[0],0!==fe[1]&&(A+=Object(k.b)(fe[1],re.factorAlignment))),Object(k.a)(Oe,re.factor,Oe);var V=ge*y.pixelRatio,z=void 0;if(o.textureIsSignedDistanceField&&(z=o.outlineSize*y.pixelRatio/2),ie(O,C,A,Oe,V,z,o,j)){var I=i.ray;if(Object(g.q)(ue,oe,Object(p.c)(pe,y.viewMatrix)),ce[0]=O[0],ce[1]=O[1],y.unprojectFromRenderScreen(ce,oe)){var G=Object(m.e)();Object(g.k)(G,I.direction);var L=1/Object(g.p)(G);Object(g.e)(G,G,L),r(Object(g.m)(I.origin,oe)*L,G,-1,1,!0,ue)}}}}}}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return!1;var i=n.get("position"),r=e.indices.get("position");return Object(_.b)(i,r,t)}},{key:"createBufferWriter",value:function(){return new xe(this)}},{key:"normalAndViewAngle",value:function(e,t,n,i){return O(t)&&(t=Object(h.f)(de,t)),Object(g.x)(i.normal,e,t),Object(g.q)(i.normal,i.normal,n.viewInverseTransposeMatrix),i.cosAngle=Object(g.h)(le,ye),i}},{key:"updateScaleInfo",value:function(e,t,n){var i=this.params;i.screenSizePerspective?Object(k.c)(n,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?Object(k.c)(n,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,n,i,r,a,o){var s=this.normalAndViewAngle(t,n,r,ve);return this.applyVerticalGroundOffsetView(e,s,r,o),this.applyVerticalOffsetTransformationView(o,s,r,a),this.applyPolygonOffsetView(o,s,i[3],r,o),this.applyCenterOffsetView(o,i,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,n,i,r){return this.applyCenterOffsetNDC(e,t,n,i),Object(l.k)(r)&&Object(g.k)(r,i),this.applyPolygonOffsetNDC(i,t,n,i),i}},{key:"applyPolygonOffsetView",value:function(e,t,n,i,r){var a=i.aboveGround?1:-1,o=Object(c.p)(n);0===o&&(o=a);var s=a*o;if(this.params.shaderPolygonOffset<=0)return Object(g.k)(r,e);var l=Object(c.d)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-l*l)/l/i.viewport[2];return Object(g.e)(r,e,s>0?u:1/u),r}},{key:"applyVerticalGroundOffsetView",value:function(e,t,n,i){var r=Object(g.p)(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(r),s=Object(g.e)(oe,t.normal,a*o);return Object(g.f)(i,e,s),i}},{key:"applyVerticalOffsetTransformationView",value:function(e,t,n,i){var r=this.params;if(!r.verticalOffset||!r.verticalOffset.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){var a=Object(g.p)(e);this.updateScaleInfo(i,a,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}var o=Object(g.p)(e),s=r.screenSizePerspectiveAlignment||r.screenSizePerspective,c=Object(E.i)(n,o,r.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(i,o,t.cosAngle),Object(g.e)(t.normal,t.normal,c),Object(g.f)(e,e,t.normal)}},{key:"applyCenterOffsetView",value:function(e,t,n){var i="screen"!==this.params.centerOffsetUnits;return n!==e&&Object(g.k)(n,e),i&&(n[0]+=t[0],n[1]+=t[1],t[2]&&(Object(g.r)(se,n),Object(g.f)(n,n,Object(g.e)(se,se,t[2])))),n}},{key:"applyCenterOffsetNDC",value:function(e,t,n,i){var r="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(g.k)(i,e),r||(i[0]+=t[0]/n.fullWidth*2,i[1]+=t[1]/n.fullHeight*2),i}},{key:"applyPolygonOffsetNDC",value:function(e,t,n,i){var r=this.params.shaderPolygonOffset;if(e!==i&&Object(g.k)(i,e),r){var a=n.aboveGround?1:-1,o=a*Object(c.p)(t[3]);i[2]-=(o||a)*r}return i}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output?new ee(e):4===e.output?new te(e):void 0}},{key:"calculateRelativeScreenBounds",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(y.l)();return ne(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}}]),n}(w.a),$=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,Object(i.a)(Object(i.a)({},e),e.material.params))).updateParameters(),a}return Object(a.a)(n,[{key:"beginSlot",value:function(e){return e===(this._material.params.drawInSecondSlot?20:19)||23===e}},{key:"updateParameters",value:function(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(X,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}]),n}(x.a),ee=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._isOcclusionSlot=!1,i}return Object(a.a)(n,[{key:"beginSlot",value:function(e){if(23===e)return!0;var t=this._material.params.drawInSecondSlot?20:19;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}},{key:"technique",get:function(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(X,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(X,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}},{key:"bind",value:function(e){var t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}]),n}($),te=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){return Object(r.a)(this,n),t.call(this,Object(i.a)(Object(i.a)({},e),{},{output:4}))}return n}($);function ne(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ae;return Object(v.c)(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*n,i[1]+=e.screenOffset[1]*n,i}function ie(e,t,n,i,r,a,o,s){var c=t-r-(s[0]>0?i[0]*s[0]:0),l=c+i[0]+2*r,u=n-r-(s[1]>0?i[1]*s[1]:0),h=u+i[1]+2*r;if(o.textureIsSignedDistanceField){var d=o.distanceFieldBoundingBox;c+=i[0]*d[0],u+=i[1]*d[1],l-=i[0]*(1-d[2]),h-=i[1]*(1-d[3]),c-=a,l+=a,u-=a,h+=a}return e[0]>c&&e[0]<l&&e[1]>u&&e[1]<h}var re={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ae=Object(b.a)(),oe=Object(m.e)(),se=Object(m.e)(),ce=Object(u.d)(),le=Object(m.e)(),ue=Object(m.e)(),he=Object(d.b)(),de=Object(d.b)(),pe=Object(f.d)(),fe=Object(m.e)(),ve={normal:le,cosAngle:0},be=Object(f.d)(),ge=1,me=2,Oe=[0,0],ye=Object(m.g)(0,0,1),je=Object(i.a)({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(b.e)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1},w.b),_e=Object(j.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2"),xe=function(){function e(t){Object(r.a)(this,e),this.material=t,this.vertexBufferLayout=_e}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get("position").length}},{key:"write",value:function(e,t,n,i){Object(M.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,n.position,i,6),Object(M.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,n.normal,i,6);var r,a,o,s,c=t.vertexAttributes.get("uv0").data;if(null==c||c.length<4){var l=this.material.params;r=0,a=0,o=l.texCoordScale[0],s=l.texCoordScale[1]}else r=c[0],a=c[1],o=c[2],s=c[3];o=Math.min(1.99999,o+1),s=Math.min(1.99999,s+1);for(var u=t.indices.get("position").length,h=n.uv0,d=i,p=0;p<u;++p)h.set(d,0,r),h.set(d,1,a),d+=1,h.set(d,0,o),h.set(d,1,a),d+=1,h.set(d,0,o),h.set(d,1,s),d+=1,h.set(d,0,o),h.set(d,1,s),d+=1,h.set(d,0,r),h.set(d,1,s),d+=1,h.set(d,0,r),h.set(d,1,a),d+=1;Object(M.b)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,n.color,i,6);for(var f=t.indices.get("size"),v=t.vertexAttributes.get("size").data,b=f.length,g=n.size,m=i,O=0;O<b;++O)for(var y=v[2*f[O]],j=v[2*f[O]+1],_=0;_<6;++_)g.set(m,0,y),g.set(m,1,j),m+=1;t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(M.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,n.auxpos1,i,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(M.a)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,n.auxpos2,i,6)}}]),e}()},889:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(4),r=n.n(i),a=n(9),o=n(10),s=n(13),c=n(7),l=n(873),u=n(24),h=n(425),d=n(130),p=n(83),f=n(1);function v(e){return b[function(e){return e instanceof Blob?e.type:function(e){var t=Object(u.n)(e);return O[t]||g}(e.url)}(e)]||m}var b={},g="text/plain",m=b[g],O={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var y in O)b[O[y]]=y;var j=n(86);function _(e){var t=Object(c.k)(e)&&e.origins?e.origins:[void 0];return function(n,i){var r,a=function(e,t,n){if(Object(c.k)(e)&&"resource"===e.type)return function(e,t,n){var i=Object(d.b)(t,n);return{type:String,read:function(e,t,n){var r=Object(j.d)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,r,a,s){if(!s||!s.resources)return"string"==typeof t?void(r[a]=Object(j.e)(t,s)):void(r[a]=t.write({},s));var h=function(e){return Object(c.j)(e)?null:"string"==typeof e?e:e.url}(t),d=h?Object(j.e)(h,Object(o.a)(Object(o.a)({},s),{},{verifyItemRelativeUrls:s&&s.verifyItemRelativeUrls?{writtenUrls:s.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,f=i.type!==String&&(!Object(l.a)(this)||s&&s.origin&&this.originIdOf(n)>Object(p.d)(s.origin));s&&s.portalItem&&Object(c.k)(d)&&!Object(u.s)(d)?f?function(e,t,n,i,r,a,o,s){var c=o.portalItem.resourceFromPath(i),l=k(n,i,o);v(l)===Object(u.n)(c.path)?(w(e,t,c,l,o.resources.toUpdate),r[a]=i):x(e,t,n,i,r,a,o,s)}(this,n,t,d,r,a,s,e):function(e,t,n,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[n]=e}(d,r,a,s):s&&s.portalItem&&(Object(c.j)(d)||Object(c.k)(Object(j.b)(d))||Object(u.t)(d)||f)?x(this,n,t,d,r,a,s,e):r[a]=d}}}}(e,t,n);switch(Object(c.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:j.c.read,write:j.c.write}}}(e,n,i),h=Object(s.a)(t);try{for(h.s();!(r=h.n()).done;){var b=r.value,g=Object(f.c)(n,b,i);for(var m in a)g[m]=a[m]}}catch(O){h.e(O)}finally{h.f()}}}function x(e,t,n,i,r,a,o,s){var l=Object(h.a)(),d=k(n,i,o),p=Object(u.z)(Object(c.i)(s,"prefix"),l),f="".concat(p,".").concat(v(d)),b=o.portalItem.resourceFromPath(f);Object(u.t)(i)&&o.resources.pendingOperations.push(function(e){return S.apply(this,arguments)}(i).then((function(e){b.path="".concat(p,".").concat(v(e)),r[a]=b.itemRelativeUrl})).catch((function(){}))),w(e,t,b,d,o.resources.toAdd),r[a]=b.itemRelativeUrl}function w(e,t,n,i,r){r.push({resource:n,content:i,finish:function(n){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(e,t,n)}})}function k(e,t,n){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(n))],{type:"application/json"})}function S(){return(S=Object(a.a)(r.a.mark((function e(t){var i,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(null,54));case 2:return i=e.sent.default,e.next=5,i(t,{responseType:"blob"});case 5:return a=e.sent,o=a.data,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},892:function(e,t,n){"use strict";n.d(t,"a",(function(){return H}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(11),l=n(7),u=n(35),h=n(30),d=n(58),p=n(79),f=n(662),v=n(596),b=n(597),g=n(660),m=n(680),O=n(624),y=n(566),j=n(695),_=n(728),x=n(619),w=n(653),k=n(41),S=n(38),M=n(0),E=n(556),P=n(574),T=n(641),D=n(608),R=n(617),C=n(623),A=n(618),V=n(609),z=n(700),I=n(829),G=n(543),L=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,i,a){var o;return Object(r.a)(this,n),(o=t.call(this,e,i,a)).stipplePattern=null,o.stippleTextureBind=null,o.stippleTextureRepository=e.stippleTextureRepository,o}return Object(a.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new V.a(e.rctx,r,A.a)}},{key:"dispose",value:function(){Object(k.a)(Object(S.a)(n.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if(Object(T.c)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){var n=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.configuration.stippleEnabled){var i=Object(l.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1},r=i.pixelSize,a=i.sdfNormalizer;this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/(r*t.camera.pixelRatio)),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var o=Object(l.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",o[0],o[1],o[2],o.length>3?o[3]:1)}4===this.configuration.output&&Object(P.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(T.d)(this.program,e),Object(E.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){var e=this.configuration,t=Object(G.g)(770,1,771,771),n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(G.f)({blending:n,depthTest:z.b,depthWrite:i,colorWrite:G.c,stencilWrite:e.sceneHasOcludees?z.h:null,stencilTest:e.sceneHasOcludees?t?z.d:z.c:null})};return 0===e.output?(this._occludeePipelineState=n(!0,e.transparent||e.stippleEnabled?t:null,G.d),n(!1,e.transparent||e.stippleEnabled?t:null,G.d)):n(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(R.a);L.shader=new D.a(I.a,(function(){return n.e(208).then(n.bind(null,1113))}));var F=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.sceneHasOcludees=!1,e}return n}(C.a);Object(M.a)([Object(C.b)({count:8})],F.prototype,"output",void 0),Object(M.a)([Object(C.b)()],F.prototype,"slicePlaneEnabled",void 0),Object(M.a)([Object(C.b)()],F.prototype,"vertexColors",void 0),Object(M.a)([Object(C.b)()],F.prototype,"transparent",void 0),Object(M.a)([Object(C.b)()],F.prototype,"draped",void 0),Object(M.a)([Object(C.b)()],F.prototype,"stippleEnabled",void 0),Object(M.a)([Object(C.b)()],F.prototype,"stippleOffColorEnabled",void 0),Object(M.a)([Object(C.b)()],F.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(M.a)([Object(C.b)()],F.prototype,"sceneHasOcludees",void 0);var U=c.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),H=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e,B)).techniqueConfig=new F,i}return Object(a.a)(n,[{key:"getTechniqueConfig",value:function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1,this.techniqueConfig.draped=!1;var t=Object(l.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(l.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,n,i,r,a,o,s,c){c?Object(x.e)(e,i,a,1,o):this.intersectLineGeometry(e,t,n,i,o)}},{key:"intersectLineGeometry",value:function(e,t,n,i,r){if(i.options.selectionMode&&!Object(w.e)(t))if(Object(y.g)(n)){var a=e.vertexAttributes.get("position").data,o=i.camera,s=ne;Object(h.c)(s,i.point);Object(d.w)(ie[0],s[0]-2,s[1]+2,0),Object(d.w)(ie[1],s[0]+2,s[1]+2,0),Object(d.w)(ie[2],s[0]+2,s[1]-2,0),Object(d.w)(ie[3],s[0]-2,s[1]-2,0);for(var c=0;c<4;c++)if(!o.unprojectFromRenderScreen(ie[c],re[c]))return;Object(v.f)(o.eye,re[0],re[1],ae),Object(v.f)(o.eye,re[1],re[2],oe),Object(v.f)(o.eye,re[2],re[3],se),Object(v.f)(o.eye,re[3],re[0],ce);for(var l=Number.MAX_VALUE,u=0;u<a.length-5;u+=3)if(W[0]=a[u]+n[12],W[1]=a[u+1]+n[13],W[2]=a[u+2]+n[14],Z[0]=a[u+3]+n[12],Z[1]=a[u+4]+n[13],Z[2]=a[u+5]+n[14],!(Object(v.t)(ae,W)<0&&Object(v.t)(ae,Z)<0||Object(v.t)(oe,W)<0&&Object(v.t)(oe,Z)<0||Object(v.t)(se,W)<0&&Object(v.t)(se,Z)<0||Object(v.t)(ce,W)<0&&Object(v.t)(ce,Z)<0)){if(o.projectToRenderScreen(W,Q),o.projectToRenderScreen(Z,J),Q[2]<0&&J[2]>0){Object(d.j)(X,W,Z);var p=o.frustum,b=-Object(v.t)(p[4],W)/Object(d.h)(X,Object(v.q)(p[4]));Object(d.e)(X,X,b),Object(d.f)(W,W,X),o.projectToRenderScreen(W,Q)}else if(Q[2]>0&&J[2]<0){Object(d.j)(X,Z,W);var g=o.frustum,m=-Object(v.t)(g[4],Z)/Object(d.h)(X,Object(v.q)(g[4]));Object(d.e)(X,X,m),Object(d.f)(Z,Z,X),o.projectToRenderScreen(Z,J)}else if(Q[2]<0&&J[2]<0)continue;Q[2]=0,J[2]=0;var O=Object(f.e)(Object(f.f)(Q,J,ee),s);O<l&&(l=O,Object(d.k)(K,W),Object(d.k)($,Z))}var j=i.rayBeginPoint,_=i.rayEndPoint;if(l<4){var x=Number.MAX_VALUE;if(Object(f.a)(Object(f.f)(K,$,ee),Object(f.f)(j,_,te),Y)){Object(d.j)(Y,Y,j);var k=Object(d.p)(Y);Object(d.e)(Y,Y,1/k),x=k/Object(d.m)(j,_)}r(x,Y)}}else U.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return!1;var i=n.get("position");return Object(g.a)(i,null,!1,t)}},{key:"createBufferWriter",value:function(){var e=this.params.vertexColors?_.b:_.c;return Object(l.j)(this.params.stipplePattern)?new _.a(e):new q(e.clone().vec3f("auxpos1"))}},{key:"getGLMaterial",value:function(e){return 0===e.output||4===e.output?new N(e):void 0}}]),n}(O.a),N=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).updateParameters(),i}return Object(a.a)(n,[{key:"updateParameters",value:function(){this._technique=this._techniqueRep.releaseAndAcquire(L,this._material.getTechniqueConfig(this._output),this._technique)}},{key:"beginSlot",value:function(e){return 3===e||23===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}},{key:"ensureParameters",value:function(e){0===this._output&&this._updateOccludeeState(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),n}(m.a),q=function(){function e(t){Object(r.a)(this,e),this.vertexBufferLayout=t}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,i){Object(j.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i),this.writeAuxpos1(e,t,n,i)}},{key:"writeAuxpos1",value:function(e,t,n,i){var r=n.getField("auxpos1",b.u),a=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,c=r.typedBufferStride,l=r.typedBuffer;i*=c;for(var u=0;u<a.length;u+=2)for(var h=3*a[u],d=o[h],p=o[h+1],f=o[h+2],v=s[0]*d+s[4]*p+s[8]*f+s[12],g=s[1]*d+s[5]*p+s[9]*f+s[13],m=s[2]*d+s[6]*p+s[10]*f+s[14],O=0;O<2;++O)l[i]=v,l[i+1]=g,l[i+2]=m,i+=c}}]),e}(),B=Object(i.a)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},O.b),W=Object(p.e)(),Z=Object(p.e)(),X=Object(p.e)(),Y=Object(p.e)(),Q=Object(u.d)(),J=Object(u.d)(),K=Object(p.e)(),$=Object(p.e)(),ee=Object(f.d)(),te=Object(f.d)(),ne=Object(p.e)(),ie=[Object(u.d)(),Object(u.d)(),Object(u.d)(),Object(u.d)()],re=[Object(p.e)(),Object(p.e)(),Object(p.e)(),Object(p.e)()],ae=Object(v.d)(),oe=Object(v.d)(),se=Object(v.d)(),ce=Object(v.d)()},893:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i,r,a,o,s,c,l,u=n(541),h=n(579),d=n(537);function p(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(Object(d.a)(i||(i=Object(u.a)(["vec3 reconstructPosition(vec2 fragCoord, float depth) {\nreturn vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}"]))))}function f(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(h.a),e.include(p),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(Object(d.a)(r||(r=Object(u.a)(["vec4 blendPremultiplied(vec4 source, vec4 dest) {\nfloat oneMinusSourceAlpha = 1.0 - source.a;\nreturn vec4(\nsource.rgb + dest.rgb * oneMinusSourceAlpha,\nsource.a + dest.a * oneMinusSourceAlpha\n);\n}"])))),e.fragment.code.add(Object(d.a)(a||(a=Object(u.a)(["vec4 premultipliedColor(vec3 rgb, float alpha) {\nreturn vec4(rgb * alpha, alpha);\n}"])))),e.fragment.code.add(Object(d.a)(o||(o=Object(u.a)(["vec4 laserlineProfile(float dist) {\nif (dist > glowWidth) {\nreturn vec4(0.0);\n}\nfloat innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\nfloat glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\nreturn blendPremultiplied(\npremultipliedColor(innerColor, innerAlpha),\npremultipliedColor(glowColor, glowAlpha)\n);\n}"])))),e.fragment.code.add(Object(d.a)(s||(s=Object(u.a)(["bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\nfloat depth = linearDepthFromTexture(depthMap, uv, nearFar);\nif (-depth == nearFar[0]) {\nreturn false;\n}\npos = reconstructPosition(gl_FragCoord.xy, depth);\nnormal = normalize(cross(dFdx(pos), dFdy(pos)));\nfloat ddepth = fwidth(depth);\ndepthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\nreturn true;\n}"])))),t.contrastControlEnabled?e.fragment.code.add(Object(d.a)(c||(c=Object(u.a)(["float rgbToLuminance(vec3 color) {\nreturn dot(vec3(0.2126, 0.7152, 0.0722), color);\n}\nvec4 laserlineOutput(vec4 color) {\nfloat backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\nfloat alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\nreturn color * alpha;\n}"])))):e.fragment.code.add(Object(d.a)(l||(l=Object(u.a)(["vec4 laserlineOutput(vec4 color) {\nreturn color * globalAlpha;\n}"]))))}},894:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i,r=n(541),a=n(825),o=n(537);function s(e){e.fragment.code.add(Object(o.a)(i||(i=Object(r.a)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var c,l,u,h,d=n(717),p=n(841);function f(e,t){e.include(d.a,t),e.include(s),e.include(a.a),t.ssrEnabled&&e.include(p.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(Object(o.a)(c||(c=Object(r.a)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),e.fragment.code.add(Object(o.a)(l||(l=Object(r.a)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\nfloat reflectionHit = 0.;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}"])))),t.ssrEnabled?e.fragment.code.add(Object(o.a)(u||(u=Object(r.a)(["vec4 viewPosition = vec4(positionView.xyz, 1.0);\nvec3 viewDir = normalize(viewPosition.xyz);\nvec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\nfloat correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\nvec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\nvec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\nreflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n}\nfloat seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\nreturn tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n}"])))):e.fragment.code.add(Object(o.a)(h||(h=Object(r.a)(["return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n}"]))))}},919:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(13),r=n(2),a=n(3),o=n(124),s=n(448),c=n(136),l=n(447),u=n(723),h=n(337),d=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"draw",value:function(e,t){var n,r=this.getUniqueHints(e),a=[],d=Object(i.a)(r);try{for(d.s();!(n=d.n()).done;){var p=n.value;p instanceof s.a&&a.push(this.visualizeIntersectionPoint(p,t)),p instanceof c.a&&a.push(this.visualizeLine(p,t)),p instanceof l.a&&a.push(this.visualizeParallelSign(p,t)),p instanceof h.a&&a.push(this.visualizeRightAngleQuad(p,t)),p instanceof u.a&&a.push(this.visualizePoint(p,t))}}catch(f){d.e(f)}finally{d.f()}return Object(o.b)(a)}},{key:"getUniqueHints",value:function(e){var t,n=[],r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var a,o=t.value,s=!0,c=Object(i.a)(n);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(o.equals(l)){s=!1;break}}}catch(u){c.e(u)}finally{c.f()}s&&n.push(o)}}catch(u){r.e(u)}finally{r.f()}return n}}]),e}()},920:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return u}));var i=n(2),r=n(3),a=n(7),o=n(35),s=n(611),c=n(140),l=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(i.a)(this,e),this.elevationInfo=t,this.defaultZ=n,this.view=r,this.excludeGraphics=a}return Object(r.a)(e,[{key:"screenToMap",value:function(e){if(Object(a.k)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(o.f)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);var t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(o.f)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(a.k)(t)&&(t.z=void 0),t}},{key:"mapToScreen",value:function(e){var t=Object(s.g)(e.x,e.y,Object(c.a)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}]),e}(),u=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(i.a)(this,e),this.view=t,this.elevationInfo=n,this.exclude=r}return Object(r.a)(e,[{key:"screenToMap",value:function(e){var t=this.view.toMap(e,{exclude:this.exclude});return Object(a.k)(t)&&(t.z=Object(c.g)(t,this.view,this.elevationInfo)),t}},{key:"mapToScreen",value:function(e){var t=e;return Object(a.k)(this.elevationInfo)&&(t=Object(s.g)(e.x,e.y,Object(c.a)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}]),e}(),h=function e(t){Object(i.a)(this,e),this.view=t,this.screenToMap=function(e){return t.toMap(e)},this.mapToScreen=function(e){return t.toScreen(e)}}},921:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l}));var i,r,a=n(541),o=n(893),s=n(537),c=n(560);function l(e){var t=new c.a;return t.include(o.a,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(Object(s.a)(i||(i=Object(a.a)(["void main() {\nvec3 pos = mix(start, end, extrude.x);\nvec4 viewPos = uModelViewMatrix * vec4(pos, 1);\nvec4 projPos = uProjectionMatrix * viewPos;\nvec2 ndcPos = projPos.xy / projPos.w;\nvec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\nvec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\nvec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\nvec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\nndcPos += length(lxy) * projExtrudeDir;\nvec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\nvec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\nvViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\nvViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\nvViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\nfloat xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\nndcPos.x += xPaddingPixels * pixelToNDC.x;\nuv = ndcPos * 0.5 + 0.5;\ngl_Position = vec4(ndcPos, 0, 1);\n}"])))),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(Object(s.a)(r||(r=Object(a.a)(["float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\nvec3 origin = mix(start, end, 0.5);\nvec3 basis = end - origin;\nvec3 posAtOrigin = pos - origin;\nfloat x = dot(normalize(basis), posAtOrigin);\nfloat y = dot(plane.xyz, posAtOrigin);\nfloat dx = max(abs(x) - length(basis), 0.0);\nfloat dy = y;\nfloat dist = length(vec2(dx, dy));\nfloat width = fwidth(y);\nfloat maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\nfloat pixelDist = dist / min(width, maxPixelDistance);\nreturn abs(pixelDist);\n}\nvoid main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nfloat distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\nvec4 color = laserlineProfile(distance);\nfloat alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\ngl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n}"])))),t}var u=Object.freeze({__proto__:null,build:l})},923:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return l}));n(12);var i=n(566);function r(e,t,n){switch(e){default:return a(t,n);case"square":return o(t,n);case"cross":return c(t,n);case"x":return l(t,n);case"kite":return s(t,n);case"triangle":return u(t,n)}}function a(e,t){for(var n=e,r=new Uint8Array(4*n*n),a=n/2-.5,o=t/2,s=0;s<n;s++)for(var c=0;c<n;c++){var l=c+n*s,u=c-a,h=s-a,d=Math.sqrt(u*u+h*h)-o;d=d/e+.5,Object(i.h)(d,r,4*l)}return r}function o(e,t){return h(e,t,!1)}function s(e,t){return h(e,t,!0)}function c(e,t){return d(e,t,!1)}function l(e,t){return d(e,t,!0)}function u(e,t){for(var n=new Uint8Array(4*e*e),r=-.5,a=Math.sqrt(1.25),o=(e-t)/2,s=0;s<e;s++)for(var c=0;c<e;c++){var l=s*e+c,u=(c-o)/t,h=(s-o+.75)/t,d=-(1*u+r*h)/a,p=(1*(u-1)+r*-h)/a,f=-h,v=Math.max(d,p,f);Object(i.h)(v*t/e+.5,n,4*l)}return n}function h(e,t,n){n&&(t/=Math.SQRT2);for(var r=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,c=.5*e-a-.75,l=a*e+o;if(n){var u=(s+c)/Math.SQRT2;c=(c-s)/Math.SQRT2,s=u}var h=Math.max(Math.abs(s),Math.abs(c))-.5*t;h=h/e+.5,Object(i.h)(h,r,4*l)}return r}function d(e,t,n){n&&(t*=Math.SQRT2);for(var r=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var c=s-.5*e,l=.5*e-o-1,u=o*e+s;if(n){var h=(c+l)/Math.SQRT2;l=(l-c)/Math.SQRT2,c=h}var d=void 0;d=(d=(c=Math.abs(c))>(l=Math.abs(l))?c>r?Math.sqrt((c-r)*(c-r)+l*l):l:l>r?Math.sqrt(c*c+(l-r)*(l-r)):c)/e+.5,Object(i.h)(d,a,4*u)}return a}},924:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var i,r=n(541),a=n(537);function o(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(Object(a.a)(i||(i=Object(r.a)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\nreturn viewDirectionDistance*perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}function s(e,t,n){e.setUniform1f("perScreenPixelRatio",n.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},925:function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return _}));var i,r,a,o,s,c,l,u,h,d=n(541),p=n(924),f=n(556),v=n(606),b=n(579),g=n(567),m=n(577),O=n(620),y=n(537),j=n(560);function _(e){var t=new j.a;return t.include(v.a,{linearDepth:!1}),t.include(p.a,{}),t.include(f.a,e),t.fragment.include(O.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(Object(y.a)(i||(i=Object(d.a)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add(Object(y.a)(r||(r=Object(d.a)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),t.vertex.code.add(Object(y.a)(a||(a=Object(d.a)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(b.a),t.include(g.b,e)),t.fragment.code.add(Object(y.a)(o||(o=Object(d.a)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add(Object(y.a)(s||(s=Object(d.a)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(color, shadedColor, shadingFactor);"])))):t.fragment.code.add(Object(y.a)(c||(c=Object(d.a)(["vec4 finalColor = color;"])))),t.fragment.code.add(Object(y.a)(l||(l=Object(d.a)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),y.a.float(m.c),7===e.output?Object(y.a)(u||(u=Object(d.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(y.a)(h||(h=Object(d.a)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var x=Object.freeze({__proto__:null,build:_})},926:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(2),r=n(3),a=n(5),o=n(6),s=n(0),c=n(29),l=n(67),u=n(7),h=n(35),d=n(1),p=(n(12),n(15),n(11),n(8)),f=n(30),v=n(58),b=n(79),g=n(383),m=n(140),O=n(407),y=n(323),j=n(421),_=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).layer=null,r.interactive=!0,r.selectable=!1,r.grabbable=!0,r.dragging=!1,r.cursor=null,r.events=new l.a.EventEmitter,r._circleCollisionCache=null,r._graphicSymbolChangedHandle=null,r._originalSymbol=null,r}return Object(r.a)(n,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(m.f)(this.graphic),n=e?e.offset:0;return new y.a({mode:t,offset:n})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var n=t.geometry;if(Object(u.j)(n))return null;var i=this._get("focusedSymbol"),r=Object(u.k)(i)?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,n,r):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),Object(u.k)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(u.k)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){Object(u.k)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&Object(u.k)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){Object(u.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&Object(u.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,n,i){if(i=i||Object(O.h)(n),Object(u.j)(i))return null;var r=this._circleCollisionCache;if("point"!==n.type||"simple-marker"!==i.type)return Object(j.b)(t,n,e)?1:null;if(Object(u.j)(r)||!r.originalPoint.equals(n)){var a=n,o=e.spatialReference;if(Object(g.a)(a.spatialReference,o)){var s=Object(g.j)(a,o);r={originalPoint:a.clone(),mapPoint:s,radiusPx:Object(h.g)(i.size)},this._circleCollisionCache=r}}if(Object(u.k)(r)){var c=Object(h.i)(t,w),l=e.toScreen(r.mapPoint),d=r.radiusPx,p=l.x+Object(h.g)(i.xoffset),v=l.y-Object(h.g)(i.yoffset);return Object(f.j)(c,[p,v])<d*d?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,n){var i=e.toMap(t,{include:[n]});return i&&Object(g.o)(i,x,e.renderSpatialReference)?Object(v.m)(x,e.state.camera.eye):null}}]),n}(c.a);Object(s.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"graphic",null),Object(s.a)([Object(d.b)({readOnly:!0})],_.prototype,"elevationInfo",null),Object(s.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),Object(s.a)([Object(d.b)({value:null})],_.prototype,"focusedSymbol",null),Object(s.a)([Object(d.b)({constructOnly:!0})],_.prototype,"layer",void 0),Object(s.a)([Object(d.b)()],_.prototype,"interactive",void 0),Object(s.a)([Object(d.b)()],_.prototype,"selectable",void 0),Object(s.a)([Object(d.b)()],_.prototype,"grabbable",void 0),Object(s.a)([Object(d.b)({value:!1})],_.prototype,"grabbing",null),Object(s.a)([Object(d.b)()],_.prototype,"dragging",void 0),Object(s.a)([Object(d.b)()],_.prototype,"hovering",null),Object(s.a)([Object(d.b)({value:!1})],_.prototype,"selected",null),Object(s.a)([Object(d.b)()],_.prototype,"cursor",void 0),_=Object(s.a)([Object(p.a)("esri.views.interactive.GraphicManipulator")],_);var x=Object(b.e)(),w=Object(h.f)()},927:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c}));var i,r,a=n(541),o=n(537),s=n(560);function c(){var e=new s.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Object(o.a)(i||(i=Object(a.a)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(Object(o.a)(r||(r=Object(a.a)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),e}var l=Object.freeze({__proto__:null,build:c})},928:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return v}));var i,r,a,o=n(541),s=n(556),c=n(606),l=n(579),u=n(567),h=n(577),d=n(620),p=n(537),f=n(560);function v(e){var t=new f.a;return t.include(c.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(Object(p.a)(i||(i=Object(o.a)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(s.a,e),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(u.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(Object(p.a)(r||(r=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",p.a.float(h.b))):(t.fragment.include(d.a),t.fragment.code.add(Object(p.a)(a||(a=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",p.a.float(h.b),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var b=Object.freeze({__proto__:null,build:v})},955:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y})),n.d(t,"b",(function(){return K}));var i=n(10),r=n(2),a=n(3),o=n(5),s=n(6),c=n(0),l=n(80),u=(n(12),n(67)),h=n(63),d=n(124),p=n(7),f=n(1),v=(n(15),n(11),n(8)),b=n(325),g=(n(76),n(102)),m=n(19),O=n(51),y=n(451),j=n(858),_=n(177),x=n(42),w=n(103),k=n(205),S=n(667),M=n(610),E=n(58),P=n(79),T=n(47);function D(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(p.k)(n)?[e,t,n]:[e,t]}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(p.k)(n)?{x:e,y:t,z:n}:{x:e,y:t}}var C=function(){function e(t){Object(r.a)(this,e),this.spatialReference=t}return Object(a.a)(e,[{key:"mapToLocalMultiple",value:function(e){var t=this;return Object(p.g)(e.map((function(e){return t.mapToLocal(e)})))}},{key:"doUnnormalization",get:function(){return!1}}]),e}(),A=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(r.a)(this,n),(a=t.call(this,i)).defaultZ=o,a.transform=Object(k.b)(),a.transformInv=Object(k.b)(),a.transform=Object(k.a)(e),Object(w.a)(a.transformInv,a.transform),a}return Object(a.a)(n,[{key:"makeMapPoint",value:function(e,t){return D(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){return R(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}},{key:"localToMap",value:function(e){return D(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}]),n}(C),V=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,i){var a;Object(r.a)(this,n),(a=t.call(this,e.spatialReference)).view=e,a.defaultZ=null,a.pWS=Object(P.e)(),a.tangentFrameUpWS=Object(P.e)(),a.tangentFrameRightWS=Object(P.e)(),a.tangentFrameForwardWS=Object(P.e)(),a.localFrameRightWS=Object(P.e)(),a.localFrameUpWS=Object(P.e)(),a.worldToLocalTransform=Object(M.b)(),a.localToWorldTransform=Object(M.b)(),a.scale=1,a.scale=e.resolution,a.referenceMapPoint=i,a.defaultZ=i.hasZ?i.z:null;var o=e.state.camera.viewRight;a.view.renderCoordsHelper.toRenderCoords(a.referenceMapPoint,a.pWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,0,a.tangentFrameRightWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,1,a.tangentFrameUpWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,2,a.tangentFrameForwardWS);var s=Object(P.e)();return Object(E.e)(s,a.tangentFrameForwardWS,Object(E.h)(o,a.tangentFrameForwardWS)),Object(E.j)(a.localFrameRightWS,o,s),Object(E.r)(a.localFrameRightWS,a.localFrameRightWS),Object(E.g)(a.localFrameUpWS,a.tangentFrameForwardWS,a.localFrameRightWS),Object(S.g)(a.worldToLocalTransform,a.localFrameRightWS,a.tangentFrameRightWS),Object(S.c)(a.localToWorldTransform,a.worldToLocalTransform),a}return Object(a.a)(n,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}},{key:"makeMapPoint",value:function(e,t){return D(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){var t=Object(P.e)();this.view.renderCoordsHelper.toRenderCoords(new T.a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(E.u)(t,t,this.worldToLocalTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(p.k)(n)?R(n.x/this.scale,n.y/this.scale):null}},{key:"localToMap",value:function(e){var t=Object(P.e)();this.view.renderCoordsHelper.toRenderCoords(new T.a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(E.u)(t,t,this.localToWorldTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(p.k)(n)?D(n.x,n.y,this.defaultZ):null}}]),n}(C);function z(e,t){if("2d"===e.type)return new A(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){var n=t.length>2?new T.a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new T.a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new V(e,n)}return null}var I=n(196),G=n(101),L=n(90);function F(e,t){var n=new T.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function U(e,t){return new I.a({points:e,spatialReference:t})}function H(e,t,n){var i=new G.a({paths:e,spatialReference:t});return n&&Object(_.i)(i),i}function N(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Object(m.a)(e);r.forEach((function(e){var t=e[0],n=e[e.length-1];Object(g.c)(t,n)&&1!==e.length||e.push(e[0])}));var a=new L.a({rings:r,spatialReference:t});return a.rings.forEach((function(e){Object(_.g)(e,!1,!1)||e.reverse()})),n&&Object(_.i)(a),i&&a.isSelfIntersecting&&Object(x.l)(t)&&(a=Object(j.simplify)(a)),a}function q(e,t,n){var i=t.mapToLocalMultiple(e),r=[],a={x:i[0].x,y:i[0].y},o=i[1].x,s=i[1].y,c=Math.round(o-a.x),l=Math.round(s-a.y),u=Math.max(Math.abs(c),Math.abs(l));if(n){var h={x:a.x+u,y:a.y+u},d={x:a.x-u,y:a.y-u};r.push(R(h.x,d.y),R(d.x,d.y),R(d.x,h.y),R(h.x,h.y))}else{var f={x:c>0?a.x+u:a.x-u,y:l>0?a.y+u:a.y-u};r.push(R(a.x,a.y),R(f.x,a.y),R(f.x,f.y),R(a.x,f.y))}return N([Object(p.g)(r.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function B(e,t,n){var i=t.mapToLocalMultiple(e);if(1===i.length){var r=48,a=i[0];i=[R(a.x-r,a.y+r),R(a.x+r,a.y-r),R(a.x+r,a.y-r),R(a.x-r,a.y+r)]}var o=[],s={x:i[0].x,y:i[0].y},c={x:i[1].x,y:i[1].y};if(n){var l=Math.round(c.x-s.x),u=Math.round(c.y-s.y);o.push(R(s.x-l,s.y-u),R(c.x,s.y-u),R(c.x,c.y),R(s.x-l,c.y))}else o.push(R(s.x,s.y),R(c.x,s.y),R(c.x,c.y),R(s.x,c.y));return N([Object(p.g)(o.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function W(e,t,n,i){var r=t.mapToLocalMultiple(e),a=null,o=null;if(n)a=r[0],o=r[1];else{var s=r[0],c=r[1],l=Math.round(c.x-s.x),u=Math.round(c.y-s.y),h=Math.max(Math.abs(l),Math.abs(u));a=R(l>0?s.x+h/2:s.x-h/2,u>0?s.y+h/2:s.y-h/2),o=R(Math.abs(l)>Math.abs(u)?a.x-h/2:a.x,Math.abs(l)>Math.abs(u)?a.y:a.y-h/2)}var d=t.localToMap(a),f=t.localToMap(o);if(Object(p.j)(d)||Object(p.j)(f))return null;t.doUnnormalization&&Object(_.j)([[d,f]],t.spatialReference);var v=F(d,t.spatialReference),b=F(f,t.spatialReference),g=Object(O.d)(t.spatialReference),m=0;if(Object(x.l)(t.spatialReference))m=g*Object(j.distance)(v,b,null);else{var w=a.x-o.x,k=a.y-o.y;m=g*Math.sqrt(w*w+k*k)*(i||1)}var S=new y.a({center:v,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return N(S.rings,S.spatialReference,!1)}function Z(e,t,n){for(var i=t.mapToLocalMultiple(e),r=i[0],a=i[1],o=Math.round(a.x-r.x),s=Math.round(a.y-r.y),c=R(n?r.x:r.x+o/2,n?r.y:r.y+s/2),l=n?o:o/2,u=n?s:s/2,h=[],d=2*Math.PI/60,f=0;f<60;f++){var v=Math.cos(f*d),b=Math.sin(f*d),g=R(l*v+c.x,u*b+c.y);h.push(g)}return h.push(h[0]),N([Object(p.g)(h.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}var X=n(770),Y=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e))._graphic=null,i.defaultZ=0,i.geometryType=null,i.hasZ=!0,i.mode=null,i.snappingManager=null,i.snapToScene=!1,i}return Object(a.a)(n,[{key:"initialize",value:function(){var e=this;this.internalGraphicsLayer=new b.a({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))]),this.complete()}},{key:"destroy",value:function(){this.drawOperation=Object(p.e)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(p.e)(this.internalGraphicsLayer),this._set("view",null)}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"centered",set:function(e){this._set("centered",e),this._updateGraphic()}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(e){this._set("graphicSymbol",e),Object(p.k)(this._graphic)&&(this._graphic.symbol=e)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"reset",value:function(){}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"_createGraphic",value:function(e){var t=this;this._graphic=new l.a({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(d.c)((function(){Object(p.k)(t._graphic)&&(t.internalGraphicsLayer.remove(t._graphic),t._graphic=Object(p.e)(t._graphic))})),Q)}},{key:"_destroyAllVisualisations",value:function(){this.handles.remove(J.outline),this.handles.remove(J.regularVertices),this.handles.remove(J.activeVertex),this.handles.remove(Q)}},{key:"_getCreateOperationGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var t=this.drawOperation.stagedVertex,n=this.drawOperation.committedVertices,i=n.slice();Object(p.k)(t)&&i.push(this.drawOperation.coordinateHelper.pointToArray(t));var r=Object(p.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):n.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},o=i.length,s=this.drawOperation.spatialReference,c="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=n,a.activeVertex=r,a.full=this.drawOperation.coordinateHelper.arrayToPoint(i[0]);break;case"multipoint":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=U(i,s));break;case"polyline":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=H([i],s,c));break;case"polygon":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=N([i],s,c,!0));break;case"circle":if(o>0){var l=z(this.view,i[0]);if(1===o&&e.operationComplete){var u=i[0],h=l.makeMapPoint(u[0]+$*this.view.resolution,u[1]);a.full=W([u,h],l,!0)}else 2===o&&(a.full=this.forceUniformSize?W(i,l,this.centered):Z(i,l,this.centered))}break;case"rectangle":if(o>0){var d=z(this.view,i[0]);if(1===o&&e.operationComplete){var f=i[0],v=d.makeMapPoint(f[0]+$*this.view.resolution,f[1]);a.full=q([f,v],d,!0)}else 2===o&&(a.full=this.forceUniformSize?q(i,d,this.centered):B(i,d,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":o>1&&(a.outline=H([i],s,c));break;case"circle":case"rectangle":Object(p.k)(a.full)&&"polygon"===a.full.type&&(a.outline=N(a.full.rings,s,c))}return a}},{key:"initializeGraphic",value:function(e){return null}},{key:"onComplete",value:function(e){this._updateGraphic();var t=null;if(this.drawOperation.isCompleted){var n=this._getCreateOperationGeometry({operationComplete:!0});Object(p.k)(n)&&(t=new l.a(Object(i.a)({geometry:n.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer},this.graphicProperties)))}this.emit("complete",Object(i.a)({graphic:t},e))}},{key:"onCursorUpdate",value:function(e){this._updateGraphic(),this.emit("cursor-update",e)}},{key:"onDeactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"onVertexAdd",value:function(e){this._updateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateGraphic(),this.emit("vertex-update",e)}},{key:"_updateGraphic",value:function(){var e=this._getCreateOperationGeometry();Object(p.j)(e)?this._destroyAllVisualisations():(Object(p.k)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),J.outline):this.handles.remove(J.outline),Object(p.k)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),J.regularVertices):this.handles.remove(J.regularVertices),Object(p.k)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),J.activeVertex):this.handles.remove(J.activeVertex),Object(p.k)(e.full)?Object(p.j)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(Q))}}]),n}(Object(h.b)(u.a.EventedMixin(X.a)));Object(c.a)([Object(f.b)({value:!0})],Y.prototype,"centered",null),Object(c.a)([Object(f.b)({nonNullable:!0})],Y.prototype,"defaultZ",void 0),Object(c.a)([Object(f.b)()],Y.prototype,"drawOperation",void 0),Object(c.a)([Object(f.b)({value:!0})],Y.prototype,"enabled",null),Object(c.a)([Object(f.b)({value:!0})],Y.prototype,"forceUniformSize",null),Object(c.a)([Object(f.b)({constructOnly:!0})],Y.prototype,"geometryType",void 0),Object(c.a)([Object(f.b)()],Y.prototype,"graphic",null),Object(c.a)([Object(f.b)({constructOnly:!0})],Y.prototype,"graphicProperties",void 0),Object(c.a)([Object(f.b)()],Y.prototype,"graphicSymbol",null),Object(c.a)([Object(f.b)({constructOnly:!0})],Y.prototype,"hasZ",void 0),Object(c.a)([Object(f.b)({constructOnly:!0})],Y.prototype,"mode",void 0),Object(c.a)([Object(f.b)()],Y.prototype,"snappingManager",void 0),Object(c.a)([Object(f.b)()],Y.prototype,"snapToScene",void 0),Object(c.a)([Object(f.b)({readOnly:!0})],Y.prototype,"type",void 0),Object(c.a)([Object(f.b)({readOnly:!0})],Y.prototype,"updating",null),Object(c.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],Y.prototype,"view",void 0),Y=Object(c.a)([Object(v.a)("esri.views.draw.DrawGraphicTool")],Y);var Q="create-operation-graphic",J={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function K(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}var $=48},956:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var i=n(4),r=n.n(i),a=n(9),o=n(10),s=n(2),c=n(3),l=n(5),u=n(6),h=n(0),d=n(67),p=n(63),f=n(19),v=n(7),b=n(21),g=n(35),m=n(1),O=(n(15),n(12),n(11),n(8)),y=n(669),j=function(){function e(t){var n=t.grabbableForEvent;Object(s.a)(this,e),this.events=new d.a,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=n}return Object(c.a)(e,[{key:"intersectionDistance",value:function(e,t){return 0}},{key:"attach",value:function(){}},{key:"detach",value:function(){}}]),e}(),_="click",x=n(814),w=n(652),k=n(688),S=n(751),M=n(724),E=n(787),P=n(679),T=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e))._createOperationCompleted=!1,i._pointerDownStates=new Set,i._snappingPipeline=new E.a,i._snappingTask=null,i._stagedVertex=null,i.snapToSceneEnabled=null,Object(v.j)(e.elevationInfo)&&(i.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0}),i}return Object(c.a)(n,[{key:"initialize",value:function(){var e,t,n=this;this.coordinateHelper=Object(x.a)(this.hasZ,this.hasM,this.view.spatialReference);var i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(P.b.SNAPPING):P.a;var r="viewingMode"in this.view.state?this.view.state.viewingMode:2,a="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new S.a(new k.c(a,this.coordinateHelper,r)),this._activeComponent=new k.a(this.spatialReference,r),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(function(e){var t=e.vertices.map((function(e){return{componentIndex:0,vertexIndex:e.index,coordinates:n.coordinateHelper.vectorToArray(e.pos)}})),i=t.map((function(e){return e.coordinates}));switch(e.type){case"vertex-add":n.emit(e.type,Object(o.a)(Object(o.a)({},e),{},{added:i,vertices:t}));break;case"vertex-update":n.emit(e.type,Object(o.a)(Object(o.a)({},e),{},{updated:i,vertices:t}));break;case"vertex-remove":n.emit(e.type,Object(o.a)(Object(o.a)({},e),{},{removed:i,vertices:t}))}}))),this._manipulator=new j({grabbableForEvent:function(e){return"click"!==n.drawingMode||"touch"===e.pointerType&&n._snappingEnabled&&1===n._pointerDownStates.size}}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(function(e){return n._onImmediateClick(e)})),this._manipulator.events.on("immediate-double-click",(function(e){return n._onImmediateDoubleClick(e)}))])}},{key:"destroy",value:function(){this._editGeometryOperations=Object(v.e)(this._editGeometryOperations),this._frameTask=Object(v.r)(this._frameTask)}},{key:"_snappingEnabled",get:function(){return Object(v.k)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}},{key:"canRedo",get:function(){return this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return this._editGeometryOperations.canUndo}},{key:"committedVertices",get:function(){var e=this;return this._activeComponent.vertices.map((function(t){return e.coordinateHelper.vectorToArray(t.pos)}))}},{key:"drawingMode",set:function(e){this._set("drawingMode",null!=e?e:_)}},{key:"hasStagedVertex",get:function(){return Object(v.k)(this._stagedVertex)}},{key:"interactive",get:function(){return this._manipulator.interactive},set:function(e){this._manipulator.interactive=e}},{key:"isCompleted",get:function(){return this._createOperationCompleted}},{key:"numCommittedVertices",get:function(){return this._activeComponent.vertices.length}},{key:"numVertices",get:function(){return Object(v.k)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}},{key:"spatialReference",get:function(){return this.view.spatialReference}},{key:"stagedVertex",get:function(){return this._stagedVertex},set:function(e){if(Object(v.j)(e))this.discardStagedVertex();else if(!Object(v.k)(this._stagedVertex)||!Object(y.a)(this._stagedVertex,e)){if(Object(v.j)(this._stagedVertex))this._stagedVertex=Object(f.a)(e);else{if(Object(y.a)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"vertices",get:function(){var e=this.committedVertices;return Object(v.k)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}},{key:"cancel",value:function(){this.complete({aborted:!0})}},{key:"commitStagedVertex",value:function(){if(this._snappingTask=Object(v.a)(this._snappingTask),Object(v.k)(this._stagedVertex)){var e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}},{key:"complete",value:function(e){var t=e&&e.aborted||!1;Object(v.a)(this._snappingTask),Object(v.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();var n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map((function(e,t){return{componentIndex:0,vertexIndex:t,coordinates:e}})),aborted:t,type:"complete"})}},{key:"discardStagedVertex",value:function(){this._stagedVertex=null}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}},{key:"redo",value:function(){this._editGeometryOperations.redo()}},{key:"undo",value:function(){Object(v.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}},{key:"_closeOnClickVertexIndex",value:function(e){var t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}},{key:"_createManipulatorDragPipeline",value:function(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}},{key:"_createManipulatorDragPipelineClick",value:function(e){var t=this;return Object(w.e)(e,(function(e,n,i,r){var a="touch"===r&&t._snappingEnabled;!t.isCompleted&&a&&(n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,("segment"===t.geometryType||a&&0===t.numVertices)&&t.commitStagedVertex()),e})).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return a},cancel:i,snappingManager:t.snappingManager,snappingContext:new M.a({editGeometryOperations:t._editGeometryOperations,elevationInfo:t.elevationInfo,pointer:r,visualizer:t.snappingVisualizer}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next((function(e){return a&&(t.stagedVertex=e.mapEnd,"end"===e.action&&t.commitStagedVertex()),e})).next((function(e){return"end"===e.action&&("segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()),e})),i.next((function(){a&&Object(v.k)(t.snappingManager)&&t.snappingManager.doneSnapping()})))}))}},{key:"_createManipulatorDragPipelineFreehand",value:function(e){var t=this;return Object(w.e)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(Object(v.j)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),"segment"===t.geometryType&&t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":t.complete()}return e}))}))}},{key:"_createManipulatorDragPipelineHybrid",value:function(e){var t=this;return Object(w.e)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(Object(v.j)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":"segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()}return e}))}))}},{key:"_getDrawSurface",value:function(){if(Object(v.j)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;var e=this.defaultZ,t=!1;Object(v.k)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(v.k)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(v.k)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);var n=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&n>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}},{key:"_mapToScreen",value:function(e){return this._getDrawSurface().mapToScreen(e)}},{key:"_onHold",value:function(e){Object(v.a)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}},{key:"_onImmediateClick",value:function(e){if(!this._manipulator.dragging){var t=this._activeComponent,n=this._closeOnClickVertexIndex(e.screenPoint);if(Object(v.k)(n))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();var i=this._screenToMap(e.screenPoint);if(Object(v.k)(i))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingTask=Object(v.a)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}}},{key:"_onImmediateDoubleClick",value:function(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}},{key:"_onPointerMove",value:function(e){var t=this;if(Object(v.a)(this._snappingTask),!(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing)&&this._manipulator.interactive){var n=Object(g.e)(e.x,e.y),i=this._closeOnClickVertexIndex(n);if(Object(v.k)(i)){this.discardStagedVertex();var o={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[o],operation:"apply",type:"vertex-update"})}else{var s=this._screenToMap(n);if(this._manipulator.cursor=Object(v.k)(s)?"crosshair":null,Object(v.k)(s))if(Object(v.k)(this.snappingManager)){var c=this.snappingManager,l=new M.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=c.update(s,l),this._snappingTask=Object(b.h)(function(){var e=Object(a.a)(r.a.mark((function e(n){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._frameTask.schedule((function(){return c.snap(s,l,n)}),n);case 2:if(i=e.sent,e.t0=i.valid,!e.t0){e.next=7;break}return e.next=7,t._frameTask.schedule((function(){t.stagedVertex=i.apply()}),n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=s}e.stopPropagation()}}},{key:"_screenToMap",value:function(e){return this._getDrawSurface().screenToMap(e)}},{key:"_screenToMapDragEventStep",value:function(){var e=this,t=null;return function(n){if("start"===n.action&&(t=e._screenToMap(n.screenStart)),Object(v.j)(t))return null;var i=e._screenToMap(n.screenEnd);return Object(v.k)(i)?Object(o.a)(Object(o.a)({},n),{},{mapStart:t,mapEnd:i}):null}}},{key:"_vertexWithinPointerDistance",value:function(e,t){var n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(v.k)(n)&&function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r<=n}(n,t,25)}}]),n}(d.a.EventedMixin(p.a));Object(h.a)([Object(m.b)()],T.prototype,"defaultZ",void 0),Object(h.a)([Object(m.b)({value:_})],T.prototype,"drawingMode",null),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"elevationDrawSurface",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"elevationInfo",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"geometryType",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"hasM",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"hasZ",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"manipulators",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"drawSurface",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"snappingManager",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"snappingVisualizer",void 0),Object(h.a)([Object(m.b)()],T.prototype,"snapToSceneEnabled",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],T.prototype,"updating",null),Object(h.a)([Object(m.b)({constructOnly:!0})],T.prototype,"view",void 0),T=Object(h.a)([Object(O.a)("esri.views.draw.DrawOperation")],T)},963:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(13),r=n(2),a=n(3),o=(n(12),n(7)),s=n(546),c=n(58),l=n(79),u=n(578),h=function e(){Object(r.a)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},d=n(792),p=n(828),f=n(653),v=1e-5,b=function(){function e(t){Object(r.a)(this,e),this.options=new h,this.results=new d.b,this.transform=new p.a,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=v,this.verticalOffset=null,this._ray={origin:Object(l.e)(),direction:Object(l.e)()},this._rayEndPoint=Object(l.e)(),this._rayStartPointTransformed=Object(l.e)(),this._rayEndPointTransformed=Object(l.e)(),this.viewingMode=null==t?1:t}return Object(a.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}},{key:"reset",value:function(e,t){this.resetWithRay(Object(u.e)(e,t,this._ray))}},{key:"resetWithRay",value:function(e){e!==this._ray&&Object(u.b)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(c.f)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;this.point=n,this.camera=r,this.filterPredicate=s,this.tolerance=null==a?v:a;var l=Object(p.c)(this.verticalOffset);Object(o.k)(t)&&t.length>0&&function(){var n,r=c?function(t){c(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},a=Object(i.a)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=s.getSpatialQueryAccelerator&&s.getSpatialQueryAccelerator();Object(o.k)(u)?(Object(o.k)(l)?u.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,r,l):u.forEachAlongRay(e._ray.origin,e._ray.direction,r),e.options.selectionMode&&e.options.hud&&u.forEachDegenerateObject(r)):s.objects.forAll((function(e){return r(e)}))}}catch(h){a.e(h)}finally{a.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this;this._numObjectsTested++;var n=e.geometryRecords;if(n){var r,a,l=e.id,u=e.transformation,h=Object(p.c)(this.verticalOffset),v=Object(i.a)(n);try{var b=function(){var n=a.value,i=n.geometry,p=n.material,v=n.instanceParameters;if(Object(f.e)(v))return"continue";r=i.id,t.transform.setAndInvalidateLazyTransforms(u,n.getShaderTransformation()),Object(c.q)(t._rayStartPointTransformed,t._ray.origin,t.transform.inverse),Object(c.q)(t._rayEndPointTransformed,t._rayEndPoint,t.transform.inverse);var b=t.transform.transform;Object(o.k)(h)&&(h.objectTransform=t.transform),p.intersect(i,v,t.transform.transform,t,t._rayStartPointTransformed,t._rayEndPointTransformed,(function(n,i,a,c,u,h){if(n>=0){if(Object(o.k)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,n))return;var p="Object3D ".concat(l);if(u)return void((null==t.results.hud.dist||n<t.results.hud.dist)&&t.results.hud.set(e,p,n,i,s.a,c,h,r,a));var f=function(t){return t.set(e,p,n,i,b,c,null,r,a)};if((null==t.results.min.drapedLayerOrder||c>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||n<t.results.min.dist)&&f(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||c<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||n>t.results.max.dist)&&f(t.results.max),2===t.options.store){var v=new d.a(t._ray);f(v),t.results.all.push(v)}}}),n.shaderTransformation)};for(v.s();!(a=v.n()).done;)b()}catch(g){v.e(g)}finally{v.f()}}}},{key:"sortResults",value:function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))}}]),e}();b.DEFAULT_TOLERANCE=v}}]);
//# sourceMappingURL=10.fbb39fee.chunk.js.map