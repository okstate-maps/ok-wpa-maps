(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[31],{1126:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return be}));var a=r(4),i=r.n(a),n=r(9),s=r(2),o=r(3),l=r(5),c=r(6),u=r(0),h=(r(76),r(80)),f=r(11),d=r(7),p=r(21),b=r(35),v=r(25),y=r(1),m=(r(12),r(15),r(8)),g=r(213),O=r(960),j=r(671),x=r(744),k=r(586),w=r(23),_=r(26),R=r(41),P=r(38),S=r(139),I=r(89),M=r(688),T=r(305),z=r(975),C=r(585),D=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e,a,i,n,o){var l,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Object(s.a)(this,r),(l=t.call(this,e,a,i,n,o)).bitmap=new z.a(c,null,null),l.bitmap.coordScale=[n,o],l.bitmap.once("isReady",(function(){return l.ready()})),l}return Object(o.a)(r,[{key:"destroy",value:function(){Object(R.a)(Object(P.a)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e,t){Object(R.a)(Object(P.a)(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:Object(T.b)(),tileMat3:Object(T.b)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(C.a),V=r(536),F=r(592),U=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return Object(o.a)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=Object(w.a)(this._tileInfoView.tileInfo.size,2),a=r[0],i=r[1];return new D(e,t[0],t[3],a,i)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,a=e.registerRenderPass({name:"imagery (tile)",brushes:[M.a.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:V.c.MAP});return[].concat(Object(_.a)(Object(R.a)(Object(P.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[a])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===V.c.MAP&&Object(R.a)(Object(P.a)(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds(Object(S.l)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,a=Object(I.o)(r.spatialReference);if(a){var i=r.lodAt(e.level).resolution,n=a/i%r.size[0],s=n?(r.size[0]-n)*i:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),r}(F.a),L=r(29),B=r(698),q=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments))._emptyTilePixelBlock=null,e.container=null,e.layer=null,e.tileSize=null,e.useWebGLForProcessing=!0,e}return Object(o.a)(r,[{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this.tileSize.join(",");if(t&&Object(d.k)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;var r=e=e||this.tileSize,a=Object(w.a)(r,2),i=a[0],n=a[1],s=new B.a({width:i,height:n,pixels:[new Uint8Array(i*n)],mask:new Uint8Array(i*n),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}}]),r}(L.a);Object(u.a)([Object(y.b)()],q.prototype,"container",void 0),Object(u.a)([Object(y.b)()],q.prototype,"layer",void 0),Object(u.a)([Object(y.b)()],q.prototype,"tileSize",void 0),Object(u.a)([Object(y.b)()],q.prototype,"type",void 0),Object(u.a)([Object(y.b)()],q.prototype,"useWebGLForProcessing",void 0);var A=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).container=null,e.layer=null,e.tileSize=null,e.type="raster",e.useWebGLForProcessing=!0,e}return Object(o.a)(r,[{key:"canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateTileSource",value:function(){var e=Object(n.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c,u,h,f,p,b,v,y,m,g;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.layer.bandIds,o=this._getLayerInterpolation(),l=this.canUseWebGLForProcessing(),c=r.source,u=r.symbolizerParams,h=r.globalSymbolizerParams,f=r.suspended,p=r.coords,b=r.resolution,v=t.bitmap,a=p,n=Object(w.a)(a,2),v.x=n[0],v.y=n[1],v.resolution=b,!(c&&Object(d.k)(c)&&Object(d.k)(c.pixelBlock))){e.next=14;break}if(y={extent:c.extent,pixelBlock:c.pixelBlock},v.rawPixelData=y,!l){e.next=7;break}v.source=c.pixelBlock,v.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(y,"stretch"===(null==h?void 0:h.type)?h:null);case 9:m=e.sent,v.source=m,v.isRendereredSource=!0;case 11:v.symbolizerParameters=l?u:null,l?v.transformGrid||(v.transformGrid=c.transformGrid):v.transformGrid=null,e.next=16;break;case 14:g=this.createEmptyTilePixelBlock(),v.source=g,v.symbolizerParameters=l?u:null,v.transformGrid=null;case 16:v.bandIds=l?s:null,v.width=this.tileSize[0],v.height=this.tileSize[1],v.interpolation=o,v.suspended=f,v.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSymbolizerParameters",value:function(){var e=Object(n.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.local,n=r.global,s=this.layer.bandIds,o=this._getLayerInterpolation(),l=this.canUseWebGLForProcessing(),c=t.bitmap,u=c.rawPixelData,l||!Object(d.k)(u)){e.next=8;break}return e.next=4,this.layer.applyRenderer(u,"stretch"===(null==n?void 0:n.type)?n:null);case 4:c.source=e.sent,c.isRendereredSource=!0,e.next=9;break;case 8:c.isRendereredSource&&Object(d.k)(u)&&(c.source=u.pixelBlock),c.isRendereredSource=!1;case 9:c.symbolizerParameters=l?n||a:null,c.bandIds=l?s:null,c.interpolation=o,c.suspended=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"install",value:function(e,t){this.container=new U(t.tileInfoView),this.container.isCustomTilingScheme=t.isCustomTilingScheme,e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this.container.remove()}},{key:"_canUseMajorityInterpolationOnDataSource",value:function(){var e=this.layer.rasterInfo,t=e.bandCount,r=e.attributeTable,a=e.colormap,i=e.pixelType;return 1===t&&(null!=r||null!=a||"u8"===i||"s8"===i)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.interpolation,r=this.layer.renderer;return"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),r}(q=Object(u.a)([Object(m.a)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],q));Object(u.a)([Object(y.b)()],A.prototype,"container",void 0),Object(u.a)([Object(y.b)()],A.prototype,"layer",void 0),Object(u.a)([Object(y.b)()],A.prototype,"tileSize",void 0),Object(u.a)([Object(y.b)()],A.prototype,"type",void 0),Object(u.a)([Object(y.b)()],A.prototype,"useWebGLForProcessing",void 0);var G=A=Object(u.a)([Object(m.a)("esri.views.2d.layers.imagery.ImageryTileView2D")],A),E=r(714),N=r(235),W=r(550),Q=(r(552),r(549),r(548),r(553),r(544),r(546),r(551)),H=r(589),J=r(541),X=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(s.a)(this,r),(e=t.call(this))._source=null,e._symbolizerParameters=null,e._vaoInvalidated=!0,e.coordScale=[1,1],e.height=null,e.stencilRef=0,e.rawPixelData=null,e.width=null,e.source=a,e}return Object(o.a)(r,[{key:"destroy",value:function(){var e,t;Object(d.k)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateVAO()}},{key:"invalidateVAO",value:function(){var e,t;!this._vaoInvalidated&&Object(d.k)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}},{key:"updateVectorFieldVAO",value:function(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,Object(d.k)(this.source)&&!Object(d.k)(this.vaoData))switch(this.symbolizerParameters.style){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":var t=Object(E.c)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:r};break;case"simple_scalar":var a=Object(E.d)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,a);this.vaoData={scalar:i};break;case"wind_speed":var n=Object(E.c)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,n),o=Object(E.d)(this.source,this.symbolizerParameters),l=this._createVectorFieldVAO(e.context,o);this.vaoData={magdir:s,scalar:l}}this.ready(),this.requestRender()}}},{key:"_createTransforms",value:function(){return{dvs:Object(T.b)()}}},{key:"onAttach",value:function(){this.invalidateVAO()}},{key:"onDetach",value:function(){this.invalidateVAO()}},{key:"_createVectorFieldVAO",value:function(e,t){var r=t.vertexData,a=t.indexData,i=W.a.createVertex(e,35044,new Float32Array(r)),n=W.a.createIndex(e,35044,new Uint32Array(a)),s=Object(J.f)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new Q.a(e,s.attributes,s.bufferLayouts,{geometry:i},n),elementCount:a.length}}}]),r}(H.a),Y=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e,a,i,n,o){var l,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Object(s.a)(this,r),(l=t.call(this,e,a,i,n,o)).tileData=new X(c),l.tileData.coordScale=[n,o],l.tileData.once("isReady",(function(){return l.ready()})),l}return Object(o.a)(r,[{key:"destroy",value:function(){Object(R.a)(Object(P.a)(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:Object(T.b)(),tileMat3:Object(T.b)()}}},{key:"setTransform",value:function(e,t){Object(R.a)(Object(P.a)(r.prototype),"setTransform",this).call(this,e,t);var a=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,n=Object(w.a)(this.tileData.offset,2),s=n[0],o=n[1],l=[this.x+s*t,this.y-o*t],c=e.toScreenNoRotation([0,0],l),u=Object(w.a)(c,2),h=u[0],f=u[1],d=this.tileData.symbolizerParameters.symbolTileSize,p=Math.round((this.width-this.tileData.offset[0])/d)*d,b=Math.round((this.height-this.tileData.offset[1])/d)*d,v=p/this.rangeX*a,y=b/this.rangeY*a;Object(N.l)(i,v,0,0,0,y,0,h,f,1),Object(N.i)(this.transforms.dvs,e.displayViewMat3,i),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(C.a),K=r(977),Z=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return Object(o.a)(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds(Object(S.l)(),e),r=Object(w.a)(this._tileInfoView.tileInfo.size,2),a=r[0],i=r[1];return new Y(e,t[0],t[3],a,i)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,a=e.registerRenderPass({name:"imagery (vf tile)",brushes:[K.a],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:V.c.MAP});return[].concat(Object(_.a)(Object(R.a)(Object(P.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[a])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===V.c.MAP&&this.symbolTypes.forEach((function(a){e.renderPass=a,Object(R.a)(Object(P.a)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(F.a),$=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments))._handle=null,e.container=null,e.layer=null,e.tileSize=null,e.type="rasterVF",e.useWebGLForProcessing=!0,e}return Object(o.a)(r,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(){var e=Object(n.a)(i.a.mark((function e(t,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.fetchTile(t.level,t.row,t.col,r);case 2:if(a=e.sent,e.t0="vector-magdir"===this.layer.rasterInfo.dataType&&null!=a&&a.pixelBlock,!e.t0){e.next=8;break}return e.next=7,this.layer.convertVectorFieldData(a.pixelBlock,r);case 7:a.pixelBlock=e.sent;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,a=e.tileData;a.key=e.key,a.width=this.tileSize[0],a.height=this.tileSize[1];var i=r.symbolTileSize,n=t.source;if(a.offset=this._getTileSymbolOffset(a.key,i),Object(d.k)(n)&&Object(d.k)(n.pixelBlock)){var s={extent:n.extent,pixelBlock:n.pixelBlock};a.rawPixelData=s,a.source=this._sampleVectorFieldData(n.pixelBlock,r,a.offset),a.symbolizerParameters=r}else{var o=[Math.round((this.tileSize[0]-a.offset[0])/i),Math.round((this.tileSize[1]-a.offset[1])/i)],l=this.createEmptyTilePixelBlock(o);a.source=l,a.symbolizerParameters=r}return a.invalidateVAO(),Promise.resolve(null)}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,a=t.local,i=a.symbolTileSize,n=e.tileData;n.offset=this._getTileSymbolOffset(n.key,i);var s=n.symbolizerParameters.symbolTileSize;return n.symbolizerParameters=a,Object(d.k)(null==(r=n.rawPixelData)?void 0:r.pixelBlock)&&s!==i&&(n.source=this._sampleVectorFieldData(n.rawPixelData.pixelBlock,n.symbolizerParameters,n.offset)),Promise.resolve(null)}},{key:"install",value:function(e,t){var r=this;this.container=new Z(t.tileInfoView),this.container.isCustomTilingScheme=t.isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",(function(e){return r._updateSymbolType(e)})),e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove()}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this.tileSize[0]%t,a=e.row*this.tileSize[1]%t;return[r>t/2?t-r:-r,a>t/2?t-a:-a]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var a=t.symbolTileSize;return Object(E.f)(e,"vector-uv",a,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),r}(q);Object(u.a)([Object(y.b)()],$.prototype,"container",void 0),Object(u.a)([Object(y.b)()],$.prototype,"layer",void 0),Object(u.a)([Object(y.b)()],$.prototype,"tileSize",void 0),Object(u.a)([Object(y.b)()],$.prototype,"type",void 0),Object(u.a)([Object(y.b)()],$.prototype,"useWebGLForProcessing",void 0);var ee=$=Object(u.a)([Object(m.a)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],$),te=r(410),re=r(478),ae=r(479),ie=r(18),ne=r(760),se=r(577),oe=r(675),le=r(422),ce=r(409),ue=r(48),he=r(47),fe=f.a.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),de=[0,0],pe=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments))._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=null,e._previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._globalUpdateRequested=!1,e._isCustomTilingScheme=!1,e.subview=null,e._redrawOrRefetch=Object(p.i)((function(t,r){return t?e.doRefresh():e._redrawImage(r)})),e}return Object(o.a)(r,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useWebGLForProcessing",get:function(){var e;return null==(e=this._get("useWebGLForProcessing"))||e},set:function(e){this.subview&&(this.subview.useWebGLForProcessing=e),this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){var r;this._tileStrategy.destroy(),null==(r=this.subview)||r.container.removeAllChildren();var a=this._getCacheSize(e);this._tileStrategy=new ae.a({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:a,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate()}}},{key:"hitTest",value:function(e,t){if(this.suspended)return Promise.resolve(null);var r=this.view.toMap(Object(b.e)(e,t));return Promise.resolve(new h.a({attributes:{},geometry:r}))}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,a=t.resolution,i=t.scale,n=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[n.level],l=r.toJSON?r:ue.a.fromJSON(r);Object(O.h)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,l,a,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this._previousLOD)?void 0:s.level)!==n.level&&(this._previousLOD=n,null==this._symbolizerParams||this.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),Object(ce.a)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new te.a(this.tileInfo,this.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new re.a({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,r){return e.fetchTile(t,r)}});var r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new ae.a({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:r,tileInfoView:this._tileInfoView}),this._updatesubview(),this.handles.add([Object(v.d)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(function(t,r,a){var i="multidimensionalDefinition"===a,n="interpolation"===a&&("majority"===t||"majority"===r)&&e._canUseMajorityInterpolationOnDataSource(),s="renderer"===a&&"vector-field"===r.type!=("vector-field"===r.type);s&&e._updatesubview();var o=i||n||s;e._redrawOrRefetch(o).catch((function(e){Object(p.m)(e)||fe.error(e)}))})),Object(v.a)(this,["layer.blendMode"],(function(t){e.subview&&(e.subview.container.blendMode=t)}),!0),Object(v.a)(this,["layer.effect"],(function(t){e.subview&&(e.subview.container.effect=t)}),!0)],"attach"),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){var e;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),null==(e=this.subview)||e.uninstall(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(O.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){var e=this;!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=Object(p.d)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.requestUpdate()}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(le.a)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=Object(n.a)(i.a.mark((function e(){var t,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:return this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),t=[],this._tileStrategy.tiles.forEach((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=11,Object(p.j)(t);case 11:this.notifyChange("updating");case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0||this._globalUpdateRequested}},{key:"acquireTile",value:function(e){var t=this.subview.container.createTile(e);return this._enqueueTileFetch(t),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t,r=this;this._fetchQueue.abort(e.key.id),null==(t=this.subview)||t.container.removeChild(e),e.once("detach",(function(){e.destroy(),r.requestUpdate()})),this.requestUpdate()}},{key:"fetchTile",value:function(e,t){var r=!Object(d.j)(t)&&t.signal,a=this.subview.canUseWebGLForProcessing(),i={allowPartialFill:!0,tileInfo:this.tileInfo,signal:Object(d.s)(r),registryId:this._blockCacheRegistryId,requestRawData:a,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:a?"nearest":this.layer.interpolation};return this.subview.fetchTile(e,i)}},{key:"_updatesubview",value:function(){var e=this._isVectorField()?"rasterVF":"raster";if(this.subview){if(this.subview.type===e)return;this.subview.uninstall()}var t=this.layer,r=new("rasterVF"===e?ee:G)({layer:t,tileSize:this.tileInfo.size,useWebGLForProcessing:this.useWebGLForProcessing});r.install(this.container,{tileInfoView:this._tileInfoView,isCustomTilingScheme:this._isCustomTilingScheme}),r.container.blendMode=t.blendMode,r.container.effect=t.effect,this.subview=r}},{key:"_isVectorField",value:function(){return"vector-field"===this.layer.renderer.type}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.view.spatialReference,t=new he.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),r=Object(x.a)(this.layer.rasterInfo,e),a=r.scales,i=r.srcResolutions,n=r.isCustomTilingScheme,s=g.a.create({spatialReference:e,size:512,scales:a});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=n,this._set("tileInfo",s),this._srcResolutions=null!=i?i:[]}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=Object(n.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=30;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(a=e.sent,n=this.layer.bandIds,s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(this._abortController&&this._abortController.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),Object(p.m)(e.t0)&&fe.error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:return!this.subview.canUseWebGLForProcessing()&&!this._isVectorField()||this.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),o=this._tileInfoView.getTileCoords(de,t.key),l=this._tileInfoView.getTileResolution(t.key),e.next=22,this.subview.updateTileSource(t,{source:a,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:s,bandIds:n,coords:o,resolution:l});case 22:t.once("attach",(function(){return c.requestUpdate()})),this.subview.container.addChild(t),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(1),Object(p.m)(e.t1)||fe.error(e.t1);case 29:this.requestUpdate();case 30:case"end":return e.stop()}}),e,this,[[1,26],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=Object(n.a)(i.a.mark((function e(t){var r,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.subview.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:if(!this.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return r=this.subview.container.children.map(function(){var e=Object(n.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.subview.updateTileSymbolizerParameters(t,{local:a._symbolizerParams,global:a._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,Object(p.j)(r);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGlobalSymbolizerParams",value:function(){var e=Object(n.a)(i.a.mark((function e(t){var r,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,r);case 3:if((a=e.sent)&&a.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:n=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(j.h)(a.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this.subview.canUseWebGLForProcessing()&&n&&"stretch"===n.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(n.factor=n.factor.map((function(e){return 255*e})),n.outMin=Math.round(255*n.outMin),n.outMax=Math.round(255*n.outMax)),this._globalSymbolizerParams=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,a=t.rasterInfo,i=t.multidimensionalDefinition,n=t.raster,s=null!=a&&a.multidimensionalInfo?n.getSliceIndex(i):null,o=Object(O.d)(r,s);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(O.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(O.f)(o,this.layer.raster.rasterInfo),e){var l=this._tileInfoView.getClosestInfoForScale(this.view.scale),c=this._srcResolutions[l.level];Object(O.h)(o,this._blockCacheRegistryId,this.view.extent,this.view.resolution,c,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"_canUseMajorityInterpolationOnDataSource",value:function(){var e=this.layer.rasterInfo,t=e.bandCount,r=e.attributeTable,a=e.colormap,i=e.pixelType;return 1===t&&(null!=r||null!=a||"u8"===i||"s8"===i)}}]),r}(function(e){var t=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return Object(o.a)(r,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:function(){var e=Object(n.a)(i.a.mark((function e(t,r){var a,n,s,o,l,c,u,f,p,b,v,y,m,g,O,j,x,k,w;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new ie.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:a})));case 3:if(n=a.popupEnabled,s=Object(ne.a)(a,r),n&&Object(d.k)(s)){e.next=6;break}throw new ie.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:n,popupTemplate:s});case 6:return o=[],e.next=9,a.identify(t);case 9:if(l=e.sent,c=l.value,u=l.magdirValue,f="",c&&c.length){if(f="imagery-tile"===a.type&&a.hasStandardTime()&&null!=c[0]?c.map((function(e){return a.getStandardTimeValue(e)})).join(", "):c.join(", "),(v={ObjectId:0})[y="Raster.ServicePixelValue"]=this._formatAttributeValue(f,y),(m=null==(p=a.rasterInfo)||null==(b=p.attributeTable)?void 0:b.features)&&m.length>0&&(g=m.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===f})),g.length>0&&(O=g[0])))for(j in O.attributes)O.attributes.hasOwnProperty(j)&&(x=this._rasterFieldPrefix+j,v[x]=this._formatAttributeValue(O.attributes[j],x));"vector-magdir"!==(k=a.rasterInfo.dataType)&&"vector-uv"!==k||(v["Raster.Magnitude"]=null==u?void 0:u[0],v["Raster.Direction"]=null==u?void 0:u[1]),(w=new h.a(this.fullExtent.clone(),null,v)).layer=a,w.sourceLayer=w.layer,o.push(w)}return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateFullExtent",value:function(){var e,t=this.layer.tileInfo;t&&t.spatialReference||(e=new ie.a("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));var r=Object(x.b)(this.layer.fullExtent,this.view.spatialReference,!1),a=Object(x.g)(this.layer.fullExtent,this.view.spatialReference,r);return null==a&&(e=new ie.a("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",a),this.datumTransformation||(this.datumTransformation=Object(x.b)(this.layer.fullExtent,this.view.spatialReference,!0)),e?Promise.reject(e):Promise.resolve()}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,a,i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n=this._getFieldInfo(i,t),s=n&&n.format;if(s)return e.trim().indexOf(",")>-1?(a=(r=",")+" ",this._formatDelimitedString(e,r,a,s)):e.trim().indexOf(" ")>-1?(r=a=" ",this._formatDelimitedString(e,r,a,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,a=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==a&&e.fieldName.toLowerCase()!==a.replace(/ /g,"_"))&&(r=e,!0)})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,a){var i=this;return e&&t&&r&&a?e.trim().split(t).map((function(e){return i._formatNumberFromString(e,a)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),r}(e);return Object(u.a)([Object(y.b)()],t.prototype,"layer",void 0),Object(u.a)([Object(y.b)()],t.prototype,"view",void 0),Object(u.a)([Object(y.b)()],t.prototype,"fullExtent",void 0),Object(u.a)([Object(y.b)()],t.prototype,"tileInfo",void 0),Object(u.a)([Object(y.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(u.a)([Object(m.a)("esri.views.layers.ImageryTileLayerView")],t)}(Object(oe.a)(Object(k.a)(se.a))));Object(u.a)([Object(y.b)()],pe.prototype,"subview",void 0),Object(u.a)([Object(y.b)()],pe.prototype,"useWebGLForProcessing",null),Object(u.a)([Object(y.b)()],pe.prototype,"useProgressiveUpdate",null);var be=pe=Object(u.a)([Object(m.a)("esri.views.2d.layers.ImageryTileLayerView2D")],pe)},577:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var a=r(2),i=r(3),n=r(5),s=r(6),o=r(0),l=r(29),c=r(67),u=r(63),h=r(211),f=r(11),d=r(7),p=r(178),b=r(1),v=(r(12),r(15),r(8)),y=function(e){Object(n.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(a.a)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",a=e.layer&&e.layer.title||"no title";throw f.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(a,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){return Object(d.t)(this.get("layer.opacity"),1)*Object(d.t)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(u.b)(Object(h.a)(Object(p.b)(c.a.EventedMixin(l.a)))));Object(o.a)([Object(b.b)()],y.prototype,"fullOpacity",null),Object(o.a)([Object(b.b)()],y.prototype,"layer",void 0),Object(o.a)([Object(b.b)()],y.prototype,"parent",void 0),Object(o.a)([Object(b.b)({readOnly:!0})],y.prototype,"suspended",null),Object(o.a)([Object(b.b)({readOnly:!0})],y.prototype,"suspendInfo",null),Object(o.a)([Object(b.b)({readOnly:!0})],y.prototype,"legendEnabled",null),Object(o.a)([Object(b.b)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),Object(o.a)([Object(b.b)({readOnly:!0})],y.prototype,"updatingProgress",null),Object(o.a)([Object(b.b)()],y.prototype,"visible",null);var m=y=Object(o.a)([Object(v.a)("esri.views.layers.LayerView")],y)},585:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var a=r(23),i=r(2),n=r(3),s=r(5),o=r(6),l=r(235),c=r(589),u=r(160),h=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e,a,n,s,o){var l,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o;return Object(i.a)(this,r),(l=t.call(this)).triangleCountReportedInDebug=0,l.triangleCount=0,l.texture=null,l.key=new u.a(e),l.x=a,l.y=n,l.width=s,l.height=o,l.rangeX=c,l.rangeY=h,l}return Object(n.a)(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var r=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],[this.x,this.y]),s=Object(a.a)(n,2),o=s[0],c=s[1],u=this.width/this.rangeX*r,h=this.height/this.rangeY*r;Object(l.l)(i,u,0,0,0,h,0,o,c,1),Object(l.i)(this.transforms.dvs,e.displayViewMat3,i)}}]),r}(c.a)},586:function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));var a,i=r(2),n=r(3),s=r(41),o=r(38),l=r(5),c=r(6),u=r(0),h=r(31),f=r(125),d=r(25),p=r(1),b=(r(12),r(15),r(11),r(8)),v=r(632),y=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return r}(r(20).a),m=y=Object(u.a)([Object(b.a)("esri.views.layers.support.ClipArea")],y),g=a=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(r,[{key:"clone",value:function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(m);Object(u.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0),Object(u.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0),Object(u.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0),Object(u.a)([Object(p.b)({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0),Object(u.a)([Object(p.b)({readOnly:!0})],g.prototype,"version",null);var O,j=g=a=Object(u.a)([Object(b.a)("esri.views.layers.support.ClipRect")],g),x=(r(76),r(104)),k=r(73),w=r(48),_=r(90),R={base:x.a,key:"type",typeMap:{extent:w.a,polygon:_.a}},P=O=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new O({geometry:this.geometry.clone()})}}]),r}(m);Object(u.a)([Object(p.b)({types:R,json:{read:k.a,write:!0}})],P.prototype,"geometry",void 0),Object(u.a)([Object(p.b)({readOnly:!0})],P.prototype,"version",null);var S=P=O=Object(u.a)([Object(b.a)("esri.views.layers.support.Geometry")],P),I=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(m);Object(u.a)([Object(p.b)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),Object(u.a)([Object(p.b)({readOnly:!0})],I.prototype,"version",null);var M=I=Object(u.a)([Object(b.a)("esri.views.layers.support.Path")],I),T=h.a.ofType({key:"type",base:m,typeMap:{rect:j,path:M,geometry:S}}),z=function(e){var t=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).clips=new T,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new v.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(d.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(d.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(d.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(d.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,a=r.minScale,i=r.maxScale;if(null!=a&&null!=i){var n=!a,s=!i;!n&&e<=a&&(n=!0),!s&&e>=i&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(o.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(u.a)([Object(p.b)({type:T,set:function(e){var t=Object(f.b)(e,this._get("clips"),T);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(u.a)([Object(p.b)()],t.prototype,"moving",void 0),Object(u.a)([Object(p.b)()],t.prototype,"attached",void 0),Object(u.a)([Object(p.b)()],t.prototype,"container",void 0),Object(u.a)([Object(p.b)()],t.prototype,"suspended",void 0),Object(u.a)([Object(p.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(u.a)([Object(p.b)()],t.prototype,"updateRequested",void 0),Object(u.a)([Object(p.b)()],t.prototype,"updating",null),Object(u.a)([Object(p.b)()],t.prototype,"view",void 0),t=Object(u.a)([Object(b.a)("esri.views.2d.layers.LayerView2D")],t)}},592:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(13),i=r(2),n=r(3),s=r(41),o=r(38),l=r(5),c=r(6),u=r(12),h=r(536),f=r(628),d=r(676),p=r(673),b=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},v=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this))._tileInfoView=e,a}return Object(n.a)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(b),this.setStencilReference(),Object(s.a)(Object(o.a)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,a=Object(s.a)(Object(o.a)(r.prototype),"createRenderParams",this).call(this,e);return a.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,a.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),a}},{key:"prepareRenderPasses",value:function(e){var t=this,a=Object(s.a)(Object(o.a)(r.prototype),"prepareRenderPasses",this).call(this,e);return a.push(e.registerRenderPass({name:"stencil",brushes:[p.a],drawPhase:h.c.DEBUG|h.c.MAP|h.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),Object(u.a)("esri-tiles-debug")&&a.push(e.registerRenderPass({name:"tileInfo",brushes:[d.a],drawPhase:h.c.DEBUG,target:function(){return t.children}})),a}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,r=Object(a.a)(this.children);try{for(r.s();!(t=r.n()).done;){var i=t.value,n=this._tileInfoView.getTileResolution(i.key);i.setTransform(e,n)}}catch(s){r.e(s)}finally{r.f()}}},{key:"setStencilReference",value:function(){var e,t=1,r=Object(a.a)(this.children);try{for(r.s();!(e=r.n()).done;){e.value.stencilRef=t++}}catch(i){r.e(i)}finally{r.f()}}}]),r}(f.a)},675:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var a=r(2),i=r(3),n=r(5),s=r(6),o=r(0),l=r(11),c=r(21),u=r(25),h=r(1),f=(r(12),r(15),r(8)),d=function(e){var t=function(e){Object(n.a)(r,e);var t=Object(s.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.handles.add(Object(u.b)(this,"layer","refresh",(function(){e.doRefresh().catch((function(t){Object(c.m)(t)||l.a.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return Object(o.a)([Object(h.b)()],t.prototype,"layer",void 0),t=Object(o.a)([Object(f.a)("esri.layers.mixins.RefreshableLayerView")],t)}},714:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return P})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return I})),r.d(t,"g",(function(){return y})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return d}));var a=r(23),i=r(36),n=r(7),s=r(698),o=r(671),l=new Map;l.set("meter-per-second",1),l.set("kilometer-per-hour",.277778),l.set("knots",.514444),l.set("feet-per-second",.3048),l.set("mile-per-hour",.44704);var c=180/Math.PI,u=new i.a({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function h(e,t){return l.get(e)/l.get(t)||1}function f(e){return(450-e)%360}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"geographic",r=Object(a.a)(e,2),i=r[0],n=r[1],s=Math.sqrt(i*i+n*n),o=Math.atan2(n,i)*c;return o=(360+o)%360,"geographic"===t&&(o=f(o)),[s,o]}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"geographic",r=e[1];"geographic"===t&&(r=f(r)),r%=360;var a=e[0];return[a*Math.cos(r/c),a*Math.sin(r/c)]}function b(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"geographic",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!Object(o.i)(e))return e;for(var n=e.pixels,l=e.width,c=e.height,u=l*c,h=n[0],f=n[1],b=s.a.createEmptyBand(e.pixelType,u),v=s.a.createEmptyBand(e.pixelType,u),y=0,m=0;m<c;m++)for(var g=0;g<l;g++){var O,j,x,k;"vector-uv"===t?(O=d([h[y],f[y]],r),j=Object(a.a)(O,2),b[y]=j[0],v[y]=j[1],b[y]*=i):(x=p([h[y],f[y]],r),k=Object(a.a)(x,2),b[y]=k[0],v[y]=k[1],b[y]*=i,v[y]*=i),y++}var w=new s.a({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[b,v]});return w.updateStatistics(),w}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(1===r||!Object(o.i)(e))return e;for(var a=e.clone(),i=a.pixels,n=a.width,s=a.height,l=i[0],c=i[1],u=0,h=0;h<s;h++)for(var f=0;f<n;f++)"vector-uv"===t?(l[u]*=r,c[u]*=r):l[u]*=r,u++;return a.updateStatistics(),a}function y(e,t,r,a,i){if(!Object(n.k)(i)||!i.spatialReference.equals(e.spatialReference))return{extent:e,width:t,height:r,resolution:e.width/t};var s=i.xmin,o=i.ymax;a=Math.max(a||0,30);var l=Math.ceil(t*(1/a)),c=Math.ceil(r*(1/a)),u=((e.xmax-e.xmin)/l+(e.ymax-e.ymin)/c)/2;return e.xmin=s+Math.floor((e.xmin-s)/u)*u,e.xmax=s+Math.ceil((e.xmax-s)/u)*u,e.ymin=o+Math.floor((e.ymin-o)/u)*u,e.ymax=o+Math.ceil((e.ymax-o)/u)*u,{extent:e,width:Math.round(e.width/u),height:Math.round(e.height/u),resolution:u}}var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.PI,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i&&(r=(2*Math.PI-r)%(2*Math.PI));var n=i?-1:1,s=13*n,o=-7*n,l=-2*n,c=-16*n,u=29,h=O(0,t+s,r,u),f=Object(a.a)(h,2),d=f[0],p=f[1],b=O(e-5.5,t+o,r,u),v=Object(a.a)(b,2),y=v[0],m=v[1],g=O(e+5.5,t+o,r,u),j=Object(a.a)(g,2),x=j[0],k=j[1],w=O(e-1.5,t+l,r,u),_=Object(a.a)(w,2),R=_[0],P=_[1],S=O(e+1.5,t+l,r,u),I=Object(a.a)(S,2),M=I[0],T=I[1],z=O(e-1.5,t+c,r,u),C=Object(a.a)(z,2),D=C[0],V=C[1],F=O(e+1.5,t+c,r,u),U=Object(a.a)(F,2),L=U[0],B=U[1];return[d,p,y,m,R,P,M,T,x,k,D,V,L,B]}(0,0,0);function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r&&(t=(2*Math.PI-t)%(2*Math.PI));var i=10,n=r?-1:1,s=5*n,o=20*n,l=25*n,c=45,u=0,h=0,f=2,d=0,p=f*n,b=u+i/2,v=h-o,y=b+f,m=v,g=y-d,j=m+p,x=u-i/2,k=h-l,w=x+d,_=k-p,R=Math.ceil(e/5),P=Math.floor(R/10);R-=8*P;for(var S=[],I=[],M=0;M<R/2;M++,P--){P<=0&&R%2==1&&M===(R-1)/2&&(w=(x=u)+d,_=(k=(k+v)/2)-p);var T=O(x,k,t,c),z=Object(a.a)(T,2),C=z[0],D=z[1];if(P>0){var V=O(y,k,t,c),F=Object(a.a)(V,2),U=F[0],L=F[1],B=O(b,v,t,c),q=Object(a.a)(B,2),A=q[0],G=q[1];S.push(U),S.push(L),S.push(C),S.push(D),S.push(A),S.push(G)}else{var E=O(y,m,t,c),N=Object(a.a)(E,2),W=N[0],Q=N[1],H=O(g,j,t,c),J=Object(a.a)(H,2),X=J[0],Y=J[1],K=O(w,_,t,c),Z=Object(a.a)(K,2),$=Z[0],ee=Z[1];I.push(C),I.push(D),I.push($),I.push(ee),I.push(X),I.push(Y),I.push(W),I.push(Q)}k+=s,v+=s,m+=s,j+=s,_+=s}var te=O(u+i/2,h+o,t,c),re=Object(a.a)(te,2),ae=re[0],ie=re[1],ne=i/2+f,se=O(u+ne,h+o,t,c),oe=Object(a.a)(se,2),le=oe[0],ce=oe[1],ue=O(u+i/2,h-l,t,c),he=Object(a.a)(ue,2),fe=he[0],de=he[1],pe=O(u+ne,h-l,t,c),be=Object(a.a)(pe,2),ve=be[0],ye=be[1];return{pennants:S,barbs:I,shaft:[ae,ie,le,ce,fe,de,ve,ye]}}function O(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=Math.sqrt(e*e+t*t)/a,n=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[i,(2*Math.PI+n-r)%(2*Math.PI)]}var j=[0,1,3,6,10,16,21,27,33,40,47,55,63],x=[0,.5,1,1.5,2],k=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function w(e,t,r,a){var i,n=h(a||"knots",r);for(i=1;i<t.length;i++)if(i===t.length-1){if(e<t[i]*n)break}else if(e<=t[i]*n)break;return Math.min(i-1,t.length-2)}function _(e,t,r,a,i){var n=0;switch(t){case"beaufort_kn":n=w(e,j,"knots",r);break;case"beaufort_km":n=w(e,j,"kilometer-per-hour",r);break;case"beaufort_ft":n=w(e,j,"feet-per-second",r);break;case"beaufort_m":n=w(e,j,"meter-per-second",r);break;case"classified_arrow":n=w(e,i,a,r);break;case"ocean_current_m":n=w(e,x,"meter-per-second",r);break;case"ocean_current_kn":n=w(e,k,"knots",r)}return n}var R=[];function P(e,t){for(var r=0,a=0,i=e.width,n=e.height,s=e.mask,o=e.pixels[0],l=[],c=[],u="wind_speed"===t.style?5:Number.MAX_VALUE,h=0;h<n;h++)for(var f=0;f<i;f++){var d=h*i+f;if((!s||s[h*i+f])&&o[d]<u){for(var p=0;p<4;p++)l[r++]=(f+.5)/i,l[r++]=(h+.5)/n,l[r++]=p<2?-.5:.5,l[r++]=p%2==0?-.5:.5,l[r++]=0,l[r++]=o[d];var b=4*(r/24-1);c[a++]=b,c[a++]=b+1,c[a++]=b+2,c[a++]=b+1,c[a++]=b+2,c[a++]=b+3}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(c)}}function S(e,t){return"simple_scalar"===t.style?P(e,t):"wind_speed"===t.style?function(e,t){if(0===R.length)for(var r=0;r<30;r++)R.push(g(5*r,0));for(var a=h(u.fromJSON(t.inputUnit),"knots"),i=e.width,n=e.height,s=e.mask,o=e.pixels[0],l=e.pixels[1],c=[],f=[],d=0,p=0,b=0;b<n;b++)for(var v=0;v<i;v++){var y=b*i+v,m=o[y]*a;if((!s||s[b*i+v])&&m>=5){var O,j=null!=(O=(l[y]+360)%360/180*Math.PI)?O:2*Math.PI*Math.random(),x=R[Math.min(Math.floor(m/5),29)],k=x.pennants,w=x.barbs,_=x.shaft;if(k.length+w.length===0)continue;for(var P=c.length/6,S=(v+.5)/i,I=(b+.5)/n,M=0;M<k.length;M+=2)c[d++]=S,c[d++]=I,c[d++]=k[M],c[d++]=k[M+1]+j,c[d++]=0,c[d++]=m;for(var T=0;T<w.length;T+=2)c[d++]=S,c[d++]=I,c[d++]=w[T],c[d++]=w[T+1]+j,c[d++]=0,c[d++]=m;for(var z=0;z<_.length;z+=2)c[d++]=S,c[d++]=I,c[d++]=_[z],c[d++]=_[z+1]+j,c[d++]=0,c[d++]=m;for(var C=0;C<k.length/6;C++)f[p++]=P,f[p++]=P+1,f[p++]=P+2,P+=3;for(var D=0;D<w.length/8;D++)f[p++]=P,f[p++]=P+1,f[p++]=P+2,f[p++]=P+1,f[p++]=P+2,f[p++]=P+3,P+=4;f[p++]=P+0,f[p++]=P+1,f[p++]=P+2,f[p++]=P+1,f[p++]=P+3,f[p++]=P+2,P+=4}}return{vertexData:new Float32Array(c),indexData:new Uint32Array(f)}}(e,t):function(e,t){for(var r=t.style,a=t.inputUnit,i=t.outputUnit,n=t.breakValues,s=u.fromJSON(a),o=u.fromJSON(i),l=0,c=0,h=e.width,f=e.height,d=e.mask,p=e.pixels[0],b=e.pixels[1],v=d?d.filter((function(e){return e>0})).length:h*f,y=new Float32Array(42*v),g=new Uint32Array(15*v),O=0;O<f;O++)for(var j=0;j<h;j++){var x=O*h+j;if(!d||d[O*h+j]){for(var k,w=null!=(k=(b[x]+360)%360/180*Math.PI)?k:2*Math.PI*Math.random(),R=_(p[x],r,s,o,n),P=0;P<m.length;P+=2)y[l++]=(j+.5)/h,y[l++]=(O+.5)/f,y[l++]=m[P],y[l++]=m[P+1]+w,y[l++]=R,y[l++]=p[x];var S=7*(l/42-1);g[c++]=S,g[c++]=S+1,g[c++]=S+2,g[c++]=S+0,g[c++]=S+4,g[c++]=S+3,g[c++]=S+0,g[c++]=S+2,g[c++]=S+3,g[c++]=S+2,g[c++]=S+5,g[c++]=S+3,g[c++]=S+5,g[c++]=S+6,g[c++]=S+3}}return{vertexData:y,indexData:g}}(e,t)}function I(e,t,r){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,o=e.width,l=e.height,c=e.mask,u=Object(a.a)(e.pixels,2),h=u[0],f=u[1],b=Object(a.a)(i,2),v=b[0],y=b[1],m=Math.round((o-v)/r),g=Math.round((l-y)/r),O=m*g,j=new Float32Array(O),x=new Float32Array(O),k=new Uint8Array(O),w="vector-uv"===t,_=0;_<g;_++)for(var R=0;R<m;R++){for(var P=0,S=_*m+R,I=Math.max(0,_*r+y),M=Math.max(0,R*r+v),T=Math.min(l,I+r),z=Math.min(o,M+r),C=I;C<T;C++)for(var D=M;D<z;D++){var V=C*o+D;if(!c||c[V]){P++;var F=w?[h[V],f[V]]:[h[V],(360+f[V])%360],U=w?F:p(F),L=Object(a.a)(U,2),B=L[0],q=L[1];j[S]+=B,x[S]+=q}}if(P>=(T-I)*(z-M)*(1-n)){k[S]=1;var A=d([j[S]/P,x[S]/P]),G=Object(a.a)(A,2),E=G[0],N=G[1];j[S]=E,x[S]=N}else k[S]=0,j[S]=0,x[S]=0}var W=new s.a({width:m,height:g,pixels:[j,x],mask:k});return W.updateStatistics(),W}},744:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return z})),r.d(t,"d",(function(){return T})),r.d(t,"e",(function(){return M})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return k})),r.d(t,"i",(function(){return j})),r.d(t,"j",(function(){return C})),r.d(t,"k",(function(){return D}));var a=r(4),i=r.n(a),n=r(23),s=r(9),o=(r(76),r(18)),l=r(7),c=r(51),u=r(384),h=r(55),f=r(48),d=r(47),p=5e-4,b=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)},v=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,a=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(a-e[2*t.rows+3])]},y={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125};function m(){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(u.f)()&&Object(u.g)()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,Object(u.h)();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,r){if(!b(e.spatialReference,t))return null;if(!Object(u.f)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return r?Object(u.d)(t,e.spatialReference,e):Object(u.d)(e.spatialReference,t,e)}function j(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e.spatialReference.equals(t))return e;var i=b(e.spatialReference,t);if(i&&!Object(u.f)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var n=r.center,s=new f.a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:e.spatialReference}),c=i?Object(u.j)(s,t,a):Object(h.d)(s,t);return Object(l.j)(c)?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return Object(c.d)(e)?t/Object(c.d)(e):0}function k(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.spatialReference;if(i.equals(t))return e;var s=Object(h.d)(e,t);if(Object(l.j)(s)){if(!Object(u.f)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");s=Object(u.j)(e,t,r)}if(a&&t.isGeographic){var c=S(i,!0),f=Object(n.a)(c,2),d=f[0],b=f[1],v=x(i);v&&null!=d&&null!=b&&(Math.abs(e.x-d)<v&&Math.abs(180-s.x)<p?s.x-=360:Math.abs(e.x-b)<v&&Math.abs(180+s.x)<p&&(s.x+=360))}return s}function w(e){var t=P(e[0].spatialReference);if(e.length<2||!Object(l.k)(t))return e[0];for(var r=e[0],a=r.xmin,i=r.xmax,n=r.ymin,s=r.ymax,o=1;o<e.length;o++){var c=e[o];i=c.xmax+t*o,n=Math.min(n,c.ymin),s=Math.max(s,c.ymax)}return new f.a({xmin:a,xmax:i,ymin:n,ymax:s,spatialReference:e[0].spatialReference})}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.spatialReference.equals(t))return e;var i=M(e),n=P(e.spatialReference,!0);return Object(l.k)(n)&&0!==i?w(e.clone().normalize().map((function(e){return R(e,t,r,a)}))):R(e,t,r,a)}function R(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.spatialReference;if(i.equals(t))return e;if(b(i,t)&&!Object(u.f)())throw new o.a("rasterprojectionhelper-projectExtent","projection engine is not loaded");var s=Object(h.d)(e,t);Object(l.j)(s)&&(s=Object(u.j)(e,t,r));var c=S(i,!0),f=Object(n.a)(c,2),v=f[0],y=f[1];if(s&&a&&i.isWebMercator&&t.isGeographic&&null!=v&&null!=y){var m=.001,g=1e3;if(Math.abs(e.xmin-v)<m&&Math.abs(y-e.xmax)>g&&Math.abs(180-s.xmax)<p){s.xmin=-180;var O=[];O.push(new d.a(e.xmax,e.ymin,i)),O.push(new d.a(e.xmax,(e.ymin+e.ymax)/2,i)),O.push(new d.a(e.xmax,e.ymax,i));var j=O.map((function(e){return k(e,t,r)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));s.xmax=Math.max.apply(null,j)}if(Math.abs(e.xmax-y)<m&&Math.abs(v-e.xmin)>g&&Math.abs(180+s.xmin)<p){s.xmax=180;var w=[];w.push(new d.a(e.xmin,e.ymin,i)),w.push(new d.a(e.xmin,(e.ymin+e.ymax)/2,i)),w.push(new d.a(e.xmin,e.ymax,i));var _=w.map((function(e){return k(e,t,r)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));s.xmin=Math.min.apply(null,_)}}var R=S(t,!0),P=Object(n.a)(R,2);v=P[0],y=P[1];var I=x(t);return I&&null!=v&&null!=y&&(Math.abs(s.xmin-v)<I&&(s.xmin=v),Math.abs(s.xmax-y)<I&&(s.xmax=y)),s}function P(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*r:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function S(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],a=P(e,t);return Object(l.k)(a)&&(r.push(-a/2),r.push(a/2)),r}function I(e,t,r,a){var i=(e-t)/r;return i-Math.floor(i)!=0?i=Math.floor(i):a&&(i-=1),i}function M(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=P(e.spatialReference);if(!Object(l.k)(r))return 0;var a=t?0:-r/2;return I(e.xmax,a,r,!0)-I(e.xmin,a,r,!1)}function T(e){var t=e.storageInfo.origin.x,r=P(e.spatialReference,!0);if(!Object(l.k)(r))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};for(var a=r/2,i=e.nativePixelSize,n=e.storageInfo,s=e.extent,o=n.maximumPyramidLevel,c=n.blockWidth,u=n.pyramidScalingFactor,h=i.x,f=[],d=Object(l.k)(e.transform)&&"gcs-shift"===e.transform.type,p=t+a,b=d?r-t:a-t,v=0;v<=o;v++){var y=(s.xmax-t)/h/c,m=y-Math.floor(y)==0?y:Math.ceil(y),g=(r/2-t)/h/c,O=g-Math.floor(g)==0?g:Math.ceil(g),j=Math.floor(p/h/c),x=Math.round(p/h)%c,k=(c-Math.round(b/h)%c)%c;f.push({resolutionX:h,blockWidth:c,datsetColumnCount:m,worldColumnCountFromOrigin:O,leftMargin:x,rightPadding:k,originColumnOffset:j}),h*=u}return{originX:t,halfWorldWidth:a,pyramidsInfo:f,hasGCSSShiftTransform:d}}function z(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[32,32];if(b(e.spatialReference,t.spatialReference)&&!Object(u.f)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&r))return null;var c=e.xmin,h=e.ymin,f=e.xmax,p=e.ymax,y=e.spatialReference,m=t.spatialReference,g=P(m);n=n||"gcs-shift"===(null==i?void 0:i.type);for(var O,j={x:s[0]*r.x,y:s[1]*r.y},x={cols:Math.ceil((f-c)/j.x-.1/s[0])+1,rows:Math.ceil((p-h)/j.y-.1/s[1])+1},w=j.x,_=j.y,R=[],S=!1,I=0;I<x.cols;I++){for(var M=[],T=0;T<x.rows;T++){var z=k(new d.a({x:c+w*I,y:p-_*T,spatialReference:y}),m,a);i&&(z=i.inverseTransform(z)),M.push(z),I>0&&n&&z&&O[T]&&Object(l.k)(g)&&z.x<O[T].x&&(z.x+=g),z?(R.push((z.x-t.xmin)/(t.xmax-t.xmin)),R.push((t.ymax-z.y)/(t.ymax-t.ymin))):(R.push(NaN),R.push(NaN),S=!0)}O=M}for(var C=v(R,x),D=new Float32Array((x.cols-1)*(x.rows-1)*2*6),V=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),F=new Float32Array([-1,1,0,0,-1,1,1,0,0]),U=0;U<x.cols-1;U++){for(var L=0;L<x.rows-1;L++){for(var B=U*x.rows*2+2*L,q=R[B],A=R[B+1],G=R[B+2],E=R[B+3],N=R[B+=2*x.rows],W=R[B+1],Q=R[B+2],H=R[B+3],J=0,X=12*(L*(x.cols-1)+U),Y=0;Y<3;Y++)D[X++]=V[J++]*q+V[J++]*G+V[J++]*Q;J=0;for(var K=0;K<3;K++)D[X++]=V[J++]*A+V[J++]*E+V[J++]*H;J=0;for(var Z=0;Z<3;Z++)D[X++]=F[J++]*q+F[J++]*N+F[J++]*Q;J=0;for(var $=0;$<3;$++)D[X++]=F[J++]*A+F[J++]*W+F[J++]*H}if(S)for(var ee=0;ee<D.length;ee++)isNaN(D[ee])&&(D[ee]=-1)}return{offsets:R,error:C,coefficients:D,spacing:s,size:[x.cols-1,x.rows-1]}}function C(e){var t=e.clone().normalize();return 1===t.length?t[0]:w(t)}function D(e,t,r){var a,i=t.storageInfo,n=t.pixelSize,s=!1,o=i.pyramidResolutions;if(Object(l.k)(o)&&o.length){var c=(e.x+e.y)/2,u=o[o.length-1],h=(u.x+u.y)/2,f=(n.x+n.y)/2;if(c<=f)a=0;else if(c>=h)a=o.length,s=c/h>8;else for(var p,b=f,v=1;v<=o.length;v++){if(c<=(p=(o[v-1].x+o[v-1].y)/2)){c===p?a=v:"down"===r?(a=v-1,s=c/b>8):a="up"===r||c-b>p-c||c/b>2?v:v-1;break}b=p}var y=0===a?n:o[a-1];return{pyramidLevel:a,pyramidResolution:new d.a({x:y.x,y:y.y,spatialReference:t.spatialReference}),excessiveReading:s}}var m=Math.log(e.x/n.x)/Math.LN2,g=Math.log(e.y/n.y)/Math.LN2,O=t.storageInfo.maximumPyramidLevel||0;(a="down"===r?Math.floor(Math.min(m,g)):"up"===r?Math.ceil(Math.max(m,g)):Math.round((m+g)/2))<0?a=0:a>O&&(s=a>O+3,a=O);var j=Math.pow(2,a);return{pyramidLevel:a,pyramidResolution:new d.a({x:j*t.nativePixelSize.x,y:j*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function V(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.extent,n=e.spatialReference,s=e.pixelSize,o=j(new d.a({x:s.x,y:s.y,spatialReference:n}),t,i);if(null==o)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var l=(o.x+o.y)/2,u=Object(c.d)(t),h=l*u*96*39.37,f=t.isGeographic?256/r*295828763.7958547:256/r*591657527.591555,p="vector-magdir"===e.dataType||"vector-uv"===e.dataType,b=_(i,t);p||a&&(t.isGeographic||t.isWebMercator)&&(p=b.xmin*b.xmax<0);var v,y=h,m=1.001;if(p){y=f;var g=t.isGeographic?1341104507446289e-21:.29858214164761665,O=g*(96*u*39.37),x=t.isGeographic?4326:3857;(v=j(new d.a({x:g,y:g,spatialReference:{wkid:x}}),n,b)).x*=y/O,v.y*=y/O}else{v={x:s.x,y:s.y};for(var k=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),w=0;y<f*(m/2)&&w<k;)w++,y*=2,v.x*=2,v.y*=2;Math.max(y,f)/Math.min(y,f)<=m&&(y=f)}for(var R=[y],P=[{x:v.x,y:v.y}],S=70.5310735,I=Math.min(S,h)/m;y>=I;)y/=2,v.x/=2,v.y/=2,R.push(y),P.push({x:v.x,y:v.y});return{projectedPixelSize:o,scales:R,srcResolutions:P,isCustomTilingScheme:!p}}},760:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return c}));var a=r(4),i=r.n(a),n=r(26),s=r(9),o=r(7),l=r(50);function c(e){return u.apply(this,arguments)}function u(){return u=Object(s.a)(i.a.mark((function e(t){var r,a,s,c,u,h,f,d,p,b=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:t.popupTemplate,Object(o.k)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,s=r.lastEditInfoEnabled,c=t.objectIdField,u=t.typeIdField,h=t.globalIdField,f=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(l.p)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return d=e.t0,p=Object(l.l)(t.fieldsIndex,[].concat(Object(n.a)(a),Object(n.a)(d))),e.abrupt("return",(u&&p.push(u),p&&c&&t.fieldsIndex.has(c)&&-1===p.indexOf(c)&&p.push(c),p&&h&&t.fieldsIndex.has(h)&&-1===p.indexOf(h)&&p.push(h),f&&f.forEach((function(e){var r=e.keyField;p&&r&&t.fieldsIndex.has(r)&&-1===p.indexOf(r)&&p.push(r)})),p));case 23:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function h(e,t){return e.popupTemplate?e.popupTemplate:Object(o.k)(t)&&t.defaultPopupTemplateEnabled&&Object(o.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},960:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return g}));r(76);var a=r(7),i=r(2),n=r(3),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;Object(i.a)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return Object(n.a)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,a=this._cachedBlocks;if(a.has(r)){var i=a.get(r);return i.refCount--,i.refCount<=0&&(a.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,a=this._cachedBlocks;if(a.has(r)){var i=a.get(r);return i.ts=Date.now(),i.refCount++,a.delete(r),a.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._cachedBlocks,n=e+"/"+t;if(i.has(n)){var s=i.get(n);s.ts=Date.now(),s.refCount++}else i.set(n,{block:r,ts:Date.now(),refCount:1,controller:a});this.trim(),this.updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,a=e+"/"+t;r.has(a)&&r.delete(a)}},{key:"updateMaxSize",value:function(e){this._size=e,this.trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this.clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),a=Date.now(),i=0;i<r.length&&r[i][1].ts<=a-e._duration;i++)t.delete(r[i][0]);0===t.size&&e.clearTimer()}),this._interval)}}},{key:"trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(744),l=r(47),c=new Map,u=new s;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(c.has(e)){var a=c.get(e);return a.push(r),a.length-1}return c.set(e,[r]),0}function d(e,t){if(c.has(e)){var r=c.get(e);r[t]=null,r.some((function(e){return null!=e}))||c.delete(e)}}function p(e,t,r){if(!c.has(e))return null==t?u.decreaseRefCount(e,r):0;var a=c.get(e);if(null==a[t])return u.decreaseRefCount(e,r);var i=a[t].cache;if(i.has(r)){var n=i.get(r);if(n.refCount--,0===n.refCount){i.delete(r);for(var s=0;s<a.length;s++)a[s]&&a[s].cache.has(r)&&a[s].cache.delete(r);n.controller&&n.controller.abort()}return n.refCount}return 0}function b(e,t,r){if(!c.has(e))return null==t?u.getBlock(e,r):null;var a=c.get(e);if(null==a[t]){for(var i=0;i<a.length;i++)if(a[i]&&a[i].cache.has(r)){var n=a[i].cache.get(r);return n.refCount++,n.block}return u.getBlock(e,r)}var s=a[t].cache;if(s.has(r)){var o=s.get(r);return o.refCount++,o.block}for(var l=0;l<a.length;l++)if(l!==t&&a[l]&&a[l]&&a[l].cache.has(r)){var h=a[l].cache.get(r);return h.refCount++,s.set(r,h),h.block}return null}function v(e,t,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(c.has(e)){var n=c.get(e);if(null!=n[t]){var s={refCount:1,block:a,isResolved:!1,isRejected:!1,controller:i};a.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),n[t].cache.set(r,s)}else u.putBlock(e,r,a,i)}else null==t&&u.putBlock(e,r,a,i)}function y(e,t,r){if(c.has(e)){var a=c.get(e);null!=a[t]?a[t].cache.delete(r):u.deleteBlock(e,r)}else null==t&&u.deleteBlock(e,r)}function m(e,t){if(!c.has(e))return null;var r=c.get(e);return null==r[t]?null:r[t]}function g(e,t,r,i,n,s){var c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=m(e,t),h=u.extent,f=u.cache,d=u.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){for(var p=r.clone().normalize(),b=d.spatialReference,v=d.transform,y=new Set,g=0;g<p.length;g++){var O=p[g];if(!(O.xmax-O.xmin<=i||O.ymax-O.ymin<=i)){var j=Object(o.g)(O,b,c);Object(a.k)(v)&&(j=v.inverseTransform(j));var x=new l.a({x:i,y:i,spatialReference:O.spatialReference});if(null==n&&!(n=Object(o.i)(x,b,O,c)))return;var k=Object(o.k)(n,d,s||"closest"),w=k.pyramidLevel,_=k.pyramidResolution,R=k.excessiveReading;if(R)return;for(var P=d.storageInfo,S=P.origin,I={x:Math.max(0,Math.floor((j.xmin-S.x)/_.x)),y:Math.max(0,Math.floor((S.y-j.ymax)/_.y))},M=Math.ceil((j.xmax-j.xmin)/_.x-.1),T=Math.ceil((j.ymax-j.ymin)/_.y-.1),z=w>0?P.pyramidBlockWidth:P.blockWidth,C=w>0?P.pyramidBlockHeight:P.blockHeight,D=1,V=Math.max(0,Math.floor(I.x/z)-D),F=Math.max(0,Math.floor(I.y/C)-D),U=Math.floor((I.x+M-1)/z)+D,L=Math.floor((I.y+T-1)/C)+D,B=F;B<=L;B++)for(var q=V;q<=U;q++)y.add("".concat(w,"/").concat(B,"/").concat(q))}}f.forEach((function(e,t){if(!y.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),u.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}}}]);
//# sourceMappingURL=31.11eabbcd.chunk.js.map