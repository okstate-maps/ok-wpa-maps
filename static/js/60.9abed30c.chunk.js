(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[60],{668:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return r}));var a=n(738);function r(e,t,n){if(e.count===t.count)for(var r=e.count,o=n[0],i=n[1],c=n[2],s=n[4],l=n[5],u=n[6],d=n[8],v=n[9],m=n[10],p=n[12],f=n[13],b=n[14],h=e.typedBuffer,g=e.typedBufferStride,x=t.typedBuffer,O=t.typedBufferStride,j=0;j<r;j++){var y=j*g,C=j*O,T=x[C],w=x[C+1],_=x[C+2];h[y]=o*T+s*w+d*_+p,h[y+1]=i*T+l*w+v*_+f,h[y+2]=c*T+u*w+m*_+b}else a.a.error("source and destination buffers need to have the same number of elements")}function o(e,t,n){if(e.count===t.count)for(var r=e.count,o=n[0],i=n[1],c=n[2],s=n[3],l=n[4],u=n[5],d=n[6],v=n[7],m=n[8],p=e.typedBuffer,f=e.typedBufferStride,b=t.typedBuffer,h=t.typedBufferStride,g=0;g<r;g++){var x=g*f,O=g*h,j=b[O],y=b[O+1],C=b[O+2];p[x]=o*j+s*y+d*C,p[x+1]=i*j+l*y+v*C,p[x+2]=c*j+u*y+m*C}else a.a.error("source and destination buffers need to have the same number of elements")}function i(e,t,n){for(var a=Math.min(e.count,t.count),r=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<a;s++){var l=s*o,u=s*c;r[l]=n*i[u],r[l+1]=n*i[u+1],r[l+2]=n*i[u+2]}}function c(e,t){for(var n=Math.min(e.count,t.count),a=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=0;c<n;c++){var s=c*r,l=c*i,u=o[l],d=o[l+1],v=o[l+2],m=Math.sqrt(u*u+d*d+v*v);if(m>0){var p=1/m;a[s]=p*u,a[s+1]=p*d,a[s+2]=p*v}}}function s(e,t,n){for(var a=Math.min(e.count,t.count),r=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<a;s++){var l=s*o,u=s*c;r[l]=i[u]>>n,r[l+1]=i[u+1]>>n,r[l+2]=i[u+2]>>n}}Object.freeze({__proto__:null,transformMat4:r,transformMat3:o,scale:i,normalize:c,shiftRight:s})},703:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a,r,o,i=n(541),c=n(537);function s(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(Object(c.a)(a||(a=Object(i.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\n}"]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(Object(c.a)(r||(r=Object(i.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(Object(c.a)(o||(o=Object(i.a)(["void forwardTextureCoordinates() {}"]))))}},704:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a,r,o=n(541),i=n(537);function c(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add("ssaoTex","sampler2D"),n.uniforms.add("viewportPixelSz","vec4"),n.code.add(Object(i.a)(a||(a=Object(o.a)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nfloat ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\nreturn viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n}"]))))):n.code.add(Object(i.a)(r||(r=Object(o.a)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}},708:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a,r,o,i,c=n(541),s=n(537);function l(e){var t=Object(s.a)(a||(a=Object(c.a)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}function u(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(Object(s.a)(r||(r=Object(c.a)(["vec3 normalModel() {\nreturn normal;\n}"]))))),1===t.normalType&&(e.include(l),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(Object(s.a)(o||(o=Object(c.a)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(s.a)(i||(i=Object(c.a)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}},710:function(e,t,n){"use strict";function a(e,t,n){for(var a=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*r,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<c;++u)a[s]=o[l],a[s+1]=o[l+1],a[s+2]=o[l+2],s+=r,l+=i}function r(e,t,n,a,r){for(var o,i,c=e.typedBuffer,s=e.typedBufferStride,l=null!=(o=null==r?void 0:r.count)?o:e.count,u=(null!=(i=null==r?void 0:r.dstIndex)?i:0)*s,d=0;d<l;++d)c[u]=t,c[u+1]=n,c[u+2]=a,u+=s}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,copy:a,fill:r})},715:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a,r=n(541),o=n(537);function i(e){e.attributes.add("position","vec3"),e.vertex.code.add(Object(o.a)(a||(a=Object(r.a)(["vec3 positionModel() { return position; }"]))))}},716:function(e,t,n){"use strict";n.d(t,"a",(function(){return H}));var a=n(10),r=n(2),o=n(3),i=n(41),c=n(38),s=n(5),l=n(6),u=n(562),d=n(58),v=n(79),m=n(646),p=n(577),f=n(820),b=n(624),h=n(612),g=n(828),x=n(695),O=n(619),j=n(0),y=n(556),C=n(729),T=n(701),w=n(574),_=n(567),M=n(730),A=n(642),S=n(654),P=n(734),E=n(641),F=n(608),R=n(617),B=n(623),L=n(618),D=n(609),I=n(700),N=n(830),k=n(543),z=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),a=this.configuration,r=t.build({OITEnabled:0===a.transparencyPassType,output:a.output,viewingMode:e.viewingMode,receiveShadows:a.receiveShadows,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:a.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:a.symbolColors,vvSize:a.vvSize,vvColor:a.vvColor,vvInstancingEnabled:!0,instanced:a.instanced,instancedColor:a.instancedColor,instancedDoublePrecision:a.instancedDoublePrecision,pbrMode:a.usePBR?a.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:a.hasMetalnessAndRoughnessTexture,hasEmissionTexture:a.hasEmissionTexture,hasOcclusionTexture:a.hasOcclusionTexture,hasNormalTexture:a.hasNormalTexture,hasColorTexture:a.hasColorTexture,receiveAmbientOcclusion:a.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:a.normalsTypeDerivate?3:0,doubleSidedMode:a.doubleSidedMode,vertexTangents:a.vertexTangents,attributeTextureCoordinates:a.hasMetalnessAndRoughnessTexture||a.hasEmissionTexture||a.hasOcclusionTexture||a.hasNormalTexture||a.hasColorTexture?1:0,textureAlphaPremultiplied:a.textureAlphaPremultiplied,attributeColor:a.vertexColors,screenSizePerspectiveEnabled:a.screenSizePerspective,verticalOffsetEnabled:a.verticalOffset,offsetBackfaces:a.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(P.b)(e.rctx),alphaDiscardMode:a.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new D.a(e.rctx,r,L.a)}},{key:"bindPass",value:function(e,t){var n,a;Object(E.c)(this.program,t.camera.projectionMatrix);var r=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===r)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(_.a)(this.program,t)),7===r&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",O.b[e.colorMixMode])),0===r?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",O.b[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(M.b)(this.program,e,this.configuration.isSchematic)):4===r&&Object(w.b)(this.program,t),Object(S.c)(this.program,e),Object(T.b)(this.program,e,t),Object(O.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(n=t.shadowMap)||n.bind(this.program),null==(a=t.ssaoHelper)||a.bind(this.program,t.camera)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(v.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(E.e)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(E.a)(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&C.a.bindCustomOrigin(this.program,t),Object(y.b)(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(A.d)(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var n=this.configuration,a=3===e,r=2===e;return Object(k.f)({blending:0!==n.output&&7!==n.output||!n.transparent?null:a?h.g:Object(h.a)(e),culling:V(n)&&Object(k.b)(n.cullFace),depthTest:{func:Object(h.b)(e)},depthWrite:a||r?n.writeDepth&&k.d:null,colorWrite:k.c,stencilWrite:n.sceneHasOcludees?I.h:null,stencilTest:n.sceneHasOcludees?t?I.d:I.c:null,polygonOffset:a||r?null:Object(h.h)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(R.a);function V(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}z.shader=new F.a(N.a,(function(){return n.e(202).then(n.bind(null,1115))}));var U=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return n}(B.a);Object(j.a)([Object(B.b)({count:8})],U.prototype,"output",void 0),Object(j.a)([Object(B.b)({count:4})],U.prototype,"alphaDiscardMode",void 0),Object(j.a)([Object(B.b)({count:3})],U.prototype,"doubleSidedMode",void 0),Object(j.a)([Object(B.b)()],U.prototype,"isSchematic",void 0),Object(j.a)([Object(B.b)()],U.prototype,"vertexColors",void 0),Object(j.a)([Object(B.b)()],U.prototype,"offsetBackfaces",void 0),Object(j.a)([Object(B.b)()],U.prototype,"symbolColors",void 0),Object(j.a)([Object(B.b)()],U.prototype,"vvSize",void 0),Object(j.a)([Object(B.b)()],U.prototype,"vvColor",void 0),Object(j.a)([Object(B.b)()],U.prototype,"verticalOffset",void 0),Object(j.a)([Object(B.b)()],U.prototype,"receiveShadows",void 0),Object(j.a)([Object(B.b)()],U.prototype,"slicePlaneEnabled",void 0),Object(j.a)([Object(B.b)()],U.prototype,"sliceHighlightDisabled",void 0),Object(j.a)([Object(B.b)()],U.prototype,"receiveAmbientOcclusion",void 0),Object(j.a)([Object(B.b)()],U.prototype,"screenSizePerspective",void 0),Object(j.a)([Object(B.b)()],U.prototype,"textureAlphaPremultiplied",void 0),Object(j.a)([Object(B.b)()],U.prototype,"hasColorTexture",void 0),Object(j.a)([Object(B.b)()],U.prototype,"usePBR",void 0),Object(j.a)([Object(B.b)()],U.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(j.a)([Object(B.b)()],U.prototype,"hasEmissionTexture",void 0),Object(j.a)([Object(B.b)()],U.prototype,"hasOcclusionTexture",void 0),Object(j.a)([Object(B.b)()],U.prototype,"hasNormalTexture",void 0),Object(j.a)([Object(B.b)()],U.prototype,"instanced",void 0),Object(j.a)([Object(B.b)()],U.prototype,"instancedColor",void 0),Object(j.a)([Object(B.b)()],U.prototype,"instancedDoublePrecision",void 0),Object(j.a)([Object(B.b)()],U.prototype,"vertexTangents",void 0),Object(j.a)([Object(B.b)()],U.prototype,"normalsTypeDerivate",void 0),Object(j.a)([Object(B.b)()],U.prototype,"writeDepth",void 0),Object(j.a)([Object(B.b)()],U.prototype,"sceneHasOcludees",void 0),Object(j.a)([Object(B.b)()],U.prototype,"transparent",void 0),Object(j.a)([Object(B.b)()],U.prototype,"enableOffset",void 0),Object(j.a)([Object(B.b)({count:3})],U.prototype,"cullFace",void 0),Object(j.a)([Object(B.b)({count:4})],U.prototype,"transparencyPassType",void 0),Object(j.a)([Object(B.b)()],U.prototype,"multipassTerrainEnabled",void 0),Object(j.a)([Object(B.b)()],U.prototype,"cullAboveGround",void 0);var G=n(831),W=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),a=this.configuration,r=t.build({OITEnabled:0===a.transparencyPassType,output:a.output,viewingMode:e.viewingMode,receiveShadows:a.receiveShadows,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:a.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:a.symbolColors,vvSize:a.vvSize,vvColor:a.vvColor,vvInstancingEnabled:!0,instanced:a.instanced,instancedColor:a.instancedColor,instancedDoublePrecision:a.instancedDoublePrecision,pbrMode:a.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:a.hasColorTexture,receiveAmbientOcclusion:a.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:a.hasColorTexture?1:0,textureAlphaPremultiplied:a.textureAlphaPremultiplied,attributeColor:a.vertexColors,screenSizePerspectiveEnabled:a.screenSizePerspective,verticalOffsetEnabled:a.verticalOffset,offsetBackfaces:a.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(P.b)(e.rctx),alphaDiscardMode:a.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new D.a(e.rctx,r,L.a)}}]),n}(z);W.shader=new F.a(G.a,(function(){return n.e(199).then(n.bind(null,1116))}));var H=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e,X)).supportsEdges=!0,a.techniqueConfig=new U,a.vertexBufferLayout=n.getVertexBufferLayout(a.params),a.instanceBufferLayout=e.instanced?n.getInstanceBufferLayout(a.params):null,a}return Object(o.a)(n,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Object(i.a)(Object(c.a)(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,a=e.vertexColors,r=e.symbolColors,o=!!t&&t.indexOf("color")>-1,s=e.vvColorEnabled,l="replace"===e.colorMixMode,u=e.opacity>0,d=e.externalColor&&e.externalColor[3]>0;return a&&(o||s||r)?!!l||u:a?l?d:u:o||s||r?!!l||u:l?d:u}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<h.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,n,a,r,o,i){if(null!==this.params.verticalOffset){var c=a.camera;Object(d.w)(ee,n[12],n[13],n[14]);var s=null;switch(a.viewingMode){case 1:s=Object(d.r)($,ee);break;case 2:s=Object(d.k)($,J)}var l=0;if(null!==this.params.verticalOffset){var u=Object(d.j)(te,ee,c.eye),v=Object(d.p)(u),m=Object(d.e)(u,u,1/v),p=null;this.params.screenSizePerspective&&(p=Object(d.h)(s,m)),l+=Object(O.i)(c,v,this.params.verticalOffset,p,this.params.screenSizePerspective)}Object(d.e)(s,s,l),Object(d.x)(Z,s,a.transform.inverseRotation),r=Object(d.j)(Q,r,Z),o=Object(d.j)(Y,o,Z)}Object(O.f)(e,t,a,r,o,Object(g.c)(a.verticalOffset),i)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new q(e)}},{key:"createBufferWriter",value:function(){return new K(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=Object(m.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&n.vec4f("tangent"),t&&n.vec2f("uv0"),e.vertexColors&&n.vec4u8("color"),e.symbolColors&&n.vec4u8("symbolColor"),n}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(m.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),n}(b.a),q=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var o;Object(r.a)(this,n);var i=e.material;return(o=t.call(this,Object(a.a)(Object(a.a)({},e),i.params))).updateParameters(),o}return Object(o.a)(n,[{key:"updateParameters",value:function(e){var t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(t.treeRendering?W:z,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),this.bindTextures(this._technique.program)}},{key:"beginSlot",value:function(e){return e===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)||23===e}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),n}(f.a),X=Object(a.a)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(u.b)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:p.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},b.b),K=function(){function e(t,n){Object(r.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return Object(o.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,a){Object(x.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,a)}}]),e}(),Q=Object(v.e)(),Y=Object(v.e)(),J=Object(v.g)(0,0,1),$=Object(v.e)(),Z=Object(v.e)(),ee=Object(v.e)(),te=Object(v.e)()},729:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a,r,o,i,c,s,l,u,d=n(2),v=n(541),m=n(79),p=n(734),f=n(537),b=n(816);function h(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(p.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var n=[Object(f.a)(a||(a=Object(v.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),Object(f.a)(r||(r=Object(v.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?Object(f.a)(o||(o=Object(v.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),Object(f.a)(i||(i=Object(v.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),Object(f.a)(c||(c=Object(v.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangents?Object(f.a)(s||(s=Object(v.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):Object(f.a)(l||(l=Object(v.a)([""])))];e.vertex.code.add(n[0]),e.vertex.code.add(n[1]),e.vertex.code.add(n[2]),2===t.output&&e.vertex.code.add(n[3]),e.vertex.code.add(n[4])}(u=h||(h={})).Uniforms=function e(){Object(d.a)(this,e)},u.bindCustomOrigin=function(e,t){Object(b.b)(t,g,x,3),e.setUniform3fv("viewOriginHi",g),e.setUniform3fv("viewOriginLo",x)};var g=Object(m.e)(),x=Object(m.e)()},730:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return b}));var a,r,o,i,c,s,l,u,d=n(541),v=n(712),m=n(840),p=n(537);Object(v.c)(0,.6,.2);function f(e,t){var n=e.fragment,v=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&v&&e.include(m.a,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add(Object(p.a)(a||(a=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(Object(p.a)(r||(r=Object(d.a)(["vec3 mrr;\nvec3 emission;\nfloat occlusion;"])))),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(Object(p.a)(o||(o=Object(d.a)(["void applyMetallnessAndRoughness(TextureLookupParameter params) {\nvec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\nmrr[0] *= metallicRoughness.b;\nmrr[1] *= metallicRoughness.g;\n}"]))))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(Object(p.a)(i||(i=Object(d.a)(["void applyEmission(TextureLookupParameter params) {\nemission *= textureLookup(texEmission, params).rgb;\n}"]))))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(Object(p.a)(c||(c=Object(d.a)(["void applyOcclusion(TextureLookupParameter params) {\nocclusion *= textureLookup(texOcclusion, params).r;\n}\nfloat getBakedOcclusion() {\nreturn occlusion;\n}"]))))):n.code.add(Object(p.a)(s||(s=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),n.code.add(Object(p.a)(l||(l=Object(d.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),v?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add(Object(p.a)(u||(u=Object(d.a)(["const vec3 mrr = vec3(0.0, 0.6, 0.2);\nconst vec3 emission = vec3(0.0);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))))}function b(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},734:function(e,t,n){"use strict";n.d(t,"a",(function(){return A})),n.d(t,"b",(function(){return S}));var a,r,o,i=n(541),c=n(12),s=n(537),l=n(2),u=n(3),d=n(7),v=n(79),m=n(549),p=n(551),f=n(682),b=(n(547),n(548),n(543)),h=(n(545),n(550)),g=n(816),x=n(566),O=n(612),j={exports:{}};a=j,r=function(){var e=function(e){var t;window.console&&window.console.error?window.console.error(e):(t=e,window.console&&window.console.log&&window.console.log(t))},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},n=null,a=null;function r(e){if(null==n)for(var t in n={},a={},e)"number"==typeof e[t]&&(n[e[t]]=t,a[t]=e[t])}function o(){if(null==n)throw"WebGLDebugUtils.init(ctx) not called"}function i(e){return o(),void 0!==n[e]}function c(e){o();var t=n[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function s(e,n,r,o){var i;if(void 0!==(i=t[e])&&void 0!==(i=i[n])&&i[r]){if("object"==typeof i[r]&&void 0!==i[r].enumBitwiseOr){for(var s=i[r].enumBitwiseOr,l=0,u=[],d=0;d<s.length;++d){var v=a[s[d]];0!=(o&v)&&(l|=v,u.push(c(v)))}return l===o?u.join(" | "):c(o)}return c(o)}return null===o?"null":void 0===o?"undefined":o.toString()}function l(e,t,n){e.__defineGetter__(n,(function(){return t[n]})),e.__defineSetter__(n,(function(e){t[n]=e}))}function u(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=0;a<t;++a)e.disableVertexAttribArray(a),e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(a,0);e.deleteBuffer(n);var r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(a=0;a<r;++a)e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:r,mightBeEnum:i,glEnumToString:c,glFunctionArgToString:s,glFunctionArgsToString:function(e,t){for(var n="",a=t.length,r=0;r<a;++r)n+=(0==r?"":", ")+s(e,a,r,t[r]);return n},makeDebugContext:function t(n,a,o,i){i=i||n,r(n),a=a||function(t,n,a){for(var r="",o=a.length,i=0;i<o;++i)r+=(0==i?"":", ")+s(n,o,i,a[i]);e("WebGL error "+c(t)+" in "+n+"("+r+")")};var u={};function d(e,t){return function(){o&&o(t,arguments);var n=e[t].apply(e,arguments),r=i.getError();return 0!=r&&(u[r]=!0,a(r,t,arguments)),n}}var v={};for(var m in n)if("function"==typeof n[m])if("getExtension"!=m)v[m]=d(n,m);else{var p=d(n,m);v[m]=function(){return t(p.apply(n,arguments),a,o,i)}}else l(v,n,m);return v.getError=function(){for(var e in u)if(u.hasOwnProperty(e)&&u[e])return u[e]=!1,e;return n.NO_ERROR},v},makeLostContextSimulatingCanvas:function(e){var t,n,a=[],r=[],o={},i=1,c=!1,s=[],d=0,v=0,m=!1,p=0,f={};function b(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(n=e.getContext,function(){var a=n.apply(e,arguments);if(a instanceof WebGLRenderingContext){if(a!=t){if(t)throw"got different context";o=y(t=a)}return o}return a});var h=function(e){a.push(b(e))},g=function(e){r.push(b(e))};function x(){++v,c||d==v&&e.loseContext()}function O(e,t){var n=e[t];return function(){if(x(),!c)return n.apply(e,arguments)}}function j(e){return{statusMessage:e,preventDefault:function(){m=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(n,a,r){switch(n){case"webglcontextlost":h(a);break;case"webglcontextrestored":g(a);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!c){for(c=!0,d=0,++i;t.getError(););(function(){for(var e=Object.keys(f),t=0;t<e.length;++t)delete f[e]})(),f[t.CONTEXT_LOST_WEBGL]=!0;var n=j("context lost"),r=a.slice();setTimeout((function(){for(var t=0;t<r.length;++t)r[t](n);p>=0&&setTimeout((function(){e.restoreContext()}),p)}),0)}},e.restoreContext=function(){c&&r.length&&setTimeout((function(){if(!m)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<s.length;++e){var n=s[e];n instanceof WebGLBuffer?t.deleteBuffer(n):n instanceof WebGLFramebuffer?t.deleteFramebuffer(n):n instanceof WebGLProgram?t.deleteProgram(n):n instanceof WebGLRenderbuffer?t.deleteRenderbuffer(n):n instanceof WebGLShader?t.deleteShader(n):n instanceof WebGLTexture&&t.deleteTexture(n)}})(),u(t),c=!1,v=0,m=!1;for(var e=r.slice(),n=j("context restored"),a=0;a<e.length;++a)e[a](n)}),0)},e.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";d=v+e},e.getNumCalls=function(){return v},e.setRestoreTimeout=function(e){p=e},e;function y(e){for(var n in e)"function"==typeof e[n]?o[n]=O(e,n):l(o,e,n);o.getError=function(){if(x(),!c)for(;e=t.getError();)f[e]=!0;for(var e in f)if(f[e])return delete f[e],e;return o.NO_ERROR};for(var a=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<a.length;++r){var u=a[r];o[u]=function(t){return function(){if(x(),c)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=i,s.push(n),n}}(e[u])}var d=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<d.length;++r)o[u=d[r]]=function(t){return function(){return x(),c?null:t.apply(e,arguments)}}(o[u]);var v=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<v.length;++r)o[u=v[r]]=function(t){return function(){return x(),!c&&t.apply(e,arguments)}}(o[u]);return o.checkFramebufferStatus=function(t){return function(){return x(),c?o.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(t){return function(){return x(),c?-1:t.apply(e,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(t){return function(){return x(),c?0:t.apply(e,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return c},o}},resetToInitialState:u}},void 0!==(o=r())&&(a.exports=o);var y,C,T=n(810),w=function(){function e(t){var n=this;Object(l.a)(this,e),this.context=t,this.svgAlwaysPremultipliesAlpha=!1,this.floatBufferBlendWorking=!1,this._doublePrecisionRequiresObfuscation=null,this.floatBufferBlendWorking=function(e){var t,n,a,r,o;if(!e.gl)return!1;if("webgl"===e.webglVersion)return(null==(r=e.capabilities.textureFloat)?void 0:r.textureFloat)&&(null==(o=e.capabilities.colorBufferFloat)?void 0:o.textureFloat);if(!((null==(t=e.capabilities.textureFloat)?void 0:t.textureFloat)&&(null==(n=e.capabilities.colorBufferFloat)?void 0:n.textureFloat)&&(null==(a=e.capabilities.colorBufferFloat)?void 0:a.floatBlend)))return!1;var i=new p.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5126,internalFormat:34836,samplingMode:9728,width:1,height:1}),c=m.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),s=new h.a(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:c}),l=new f.a(e,"\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(l);var u=e.getBoundFramebufferObject(),d=e.getViewport(),v=d.x,g=d.y,x=d.width,y=d.height;e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(5,0,4);var C=Object(b.f)({blending:O.f});e.setPipelineState(C),e.drawArrays(5,0,4),j.exports.init(e);var T=e.gl.getError();return e.setViewport(v,g,x,y),e.bindFramebuffer(u),l.dispose(),s.dispose(!1),c.dispose(),i.dispose(),1282!==T||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(t),Object(T.a)(t).then((function(e){return n.svgAlwaysPremultipliesAlpha=!e}))}return Object(u.a)(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(d.j)(this._doublePrecisionRequiresObfuscation)){var e=M(this.context,!1),t=M(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}(),_=null;function M(e,t){var n=new p.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});var a=m.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),r=new h.a(e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:a}),o=Object(v.g)(5633261.287538229,2626832.878767164,1434988.0495278358),i=Object(v.g)(5633271.46742708,2626873.6381334523,1434963.231608387),c=function(n,a){var r=new f.a(e,"\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),o=new Float32Array(6);Object(g.a)(n,o,3);var i=new Float32Array(6);return Object(g.a)(a,i,3),e.useProgram(r),r.setUniform3f("u_highA",o[0],o[2],o[4]),r.setUniform3f("u_lowA",o[1],o[3],o[5]),r.setUniform3f("u_highB",i[0],i[2],i[4]),r.setUniform3f("u_lowB",i[1],i[3],i[5]),r}(o,i),s=e.getBoundFramebufferObject(),l=e.getViewport(),u=l.x,d=l.y,b=l.width,O=l.height;e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(5,0,4);var j=new Uint8Array(4);n.readPixels(0,0,1,1,6408,5121,j),c.dispose(),r.dispose(!1),a.dispose(),n.dispose(),e.setViewport(u,d,b,O),e.bindFramebuffer(s);var y=(o[2]-i[2])/25,C=Object(x.k)(j);return Math.abs(y-C)}function A(e,t){var n=e.code;t.doublePrecisionRequiresObfuscation?n.add(Object(s.a)(y||(y=Object(i.a)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):n.add(Object(s.a)(C||(C=Object(i.a)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function S(e){return!!Object(c.a)("force-double-precision-obfuscation")||(t=e,(Object(d.j)(_)||_.context!==t)&&(_=new w(t)),_).doublePrecisionRequiresObfuscation;var t}},735:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var a,r,o,i,c=n(541),s=n(537);function l(e,t){var n=e.fragment,l=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===l?(n.uniforms.add("lightingAmbientSH0","vec3"),n.code.add(Object(s.a)(a||(a=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):1===l?(n.uniforms.add("lightingAmbientSH_R","vec4"),n.uniforms.add("lightingAmbientSH_G","vec4"),n.uniforms.add("lightingAmbientSH_B","vec4"),n.code.add(Object(s.a)(r||(r=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):2===l&&(n.uniforms.add("lightingAmbientSH0","vec3"),n.uniforms.add("lightingAmbientSH_R1","vec4"),n.uniforms.add("lightingAmbientSH_G1","vec4"),n.uniforms.add("lightingAmbientSH_B1","vec4"),n.uniforms.add("lightingAmbientSH_R2","vec4"),n.uniforms.add("lightingAmbientSH_G2","vec4"),n.uniforms.add("lightingAmbientSH_B2","vec4"),n.code.add(Object(s.a)(o||(o=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"])))),1!==t.pbrMode&&2!==t.pbrMode||n.code.add(Object(s.a)(i||(i=Object(c.a)(["const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}"])))))}var u,d=n(704);function v(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(Object(s.a)(u||(u=Object(c.a)(["vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\nfloat dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);\ndotVal = mix(dotVal, 1.0, lightingFixedFactor);\nreturn lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n}"]))))}var m,p,f,b,h,g,x,O,j,y,C,T,w,_=n(717),M=n(790),A=n(642);function S(e,t){var n=e.fragment;e.include(v),e.include(d.a,t),0!==t.pbrMode&&e.include(_.a,t),e.include(l,t),t.receiveShadows&&e.include(A.a,t),n.uniforms.add("lightingGlobalFactor","float"),n.uniforms.add("ambientBoostFactor","float"),e.include(M.a),n.code.add(Object(s.a)(m||(m=Object(c.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),n.code.add(Object(s.a)(p||(p=Object(c.a)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),1===t.viewingMode?Object(s.a)(f||(f=Object(c.a)(["normalize(vPosWorld)"]))):Object(s.a)(b||(b=Object(c.a)(["vec3(0.0, 0.0, 1.0)"]))))),n.code.add(Object(s.a)(h||(h=Object(c.a)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),0===t.pbrMode||4===t.pbrMode?n.code.add(Object(s.a)(g||(g=Object(c.a)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"])))):1!==t.pbrMode&&2!==t.pbrMode||(n.code.add(Object(s.a)(x||(x=Object(c.a)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),n.code.add(Object(s.a)(O||(O=Object(c.a)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),n.code.add(Object(s.a)(j||(j=Object(c.a)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = abs(dot(normal, ambientDir));\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),n.code.add(Object(s.a)(y||(y=Object(c.a)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),n.code.add(Object(s.a)(C||(C=Object(c.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?Object(s.a)(T||(T=Object(c.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):Object(s.a)(w||(w=Object(c.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},738:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=n(11).a.getLogger("esri.views.3d.support.buffer.math")},765:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a,r=n(541),o=n(537);function i(e){e.vertex.code.add(Object(o.a)(a||(a=Object(r.a)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},766:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var a,r,o,i,c,s,l,u,d,v,m,p,f=n(541),b=n(556),h=n(606),g=n(708),x=n(703),O=n(773),j=n(694),y=n(574),C=n(654),T=n(577),w=n(537);function _(e,t){var n=e.vertex.code,_=e.fragment.code;1!==t.output&&3!==t.output||(e.include(h.a,{linearDepth:!0}),e.include(x.a,t),e.include(C.a,t),e.include(j.a,t),e.include(b.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(w.a)(a||(a=Object(f.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\nforwardTextureCoordinates();\n}"])))),e.include(T.a,t),_.add(Object(w.a)(r||(r=Object(f.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?Object(w.a)(o||(o=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(h.a,{linearDepth:!1}),e.include(g.a,t),e.include(O.a,t),e.include(x.a,t),e.include(C.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),n.add(Object(w.a)(i||(i=Object(f.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?Object(w.a)(c||(c=Object(f.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(b.a,t),e.include(T.a,t),_.add(Object(w.a)(s||(s=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?Object(w.a)(l||(l=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?Object(w.a)(u||(u=Object(f.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):Object(w.a)(d||(d=Object(f.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(h.a,{linearDepth:!1}),e.include(x.a,t),e.include(C.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(w.a)(v||(v=Object(f.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPosition(proj, view, vpos);\nforwardTextureCoordinates();\n}"])))),e.include(b.a,t),e.include(T.a,t),e.include(y.a),_.add(Object(w.a)(m||(m=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?Object(w.a)(p||(p=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},767:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a,r=n(541),o=n(620),i=n(537);function c(e){e.include(o.a),e.code.add(Object(i.a)(a||(a=Object(r.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),i.a.int(1),i.a.int(2),i.a.int(3),i.a.int(2),i.a.int(3)))}},772:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a,r,o,i=n(541),c=n(537);function s(e){e.vertex.code.add(Object(c.a)(a||(a=Object(i.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),c.a.int(1),c.a.int(3),c.a.int(4),c.a.int(1)))}function l(e,t){t.symbolColor?(e.include(s),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(Object(c.a)(r||(r=Object(i.a)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"])))):e.vertex.code.add(Object(c.a)(o||(o=Object(i.a)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"]))))}},773:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var a,r,o,i,c,s,l,u=n(541),d=n(708),v=n(2),m=n(562),p=n(546),f=n(79),b=n(715),h=n(734),g=n(537);function x(e,t){e.include(b.a),e.vertex.include(h.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(Object(g.a)(a||(a=Object(u.a)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\nuTransform_WorldFromModel_TL,\nuTransform_WorldFromModel_TH,\n-uTransform_WorldFromView_TL,\n-uTransform_WorldFromView_TH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}\nvec3 position_view() {\nreturn uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n}\nvoid forwardPosition() {\nvPositionWorldCameraRelative = positionWorldCameraRelative();\nvPosition_view = position_view();\ngl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n}\nvec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(Object(g.a)(r||(r=Object(u.a)(["vec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"]))))}function O(e,t){0===t.normalType||1===t.normalType?(e.include(d.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(Object(g.a)(o||(o=Object(u.a)(["void forwardNormal() {\nvNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\nvNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n}"]))))):2===t.normalType?(e.include(x,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(g.a)(i||(i=Object(u.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?Object(g.a)(c||(c=Object(u.a)(["normalize(vPositionWorldCameraRelative);"]))):Object(g.a)(s||(s=Object(u.a)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(Object(g.a)(l||(l=Object(u.a)(["void forwardNormal() {}"]))))}!function(e){e.ModelTransform=function e(){Object(v.a)(this,e),this.worldFromModel_RS=Object(m.b)(),this.worldFromModel_TH=Object(f.e)(),this.worldFromModel_TL=Object(f.e)()};e.ViewProjectionTransform=function e(){Object(v.a)(this,e),this.worldFromView_TH=Object(f.e)(),this.worldFromView_TL=Object(f.e)(),this.viewFromCameraRelative_RS=Object(m.b)(),this.projFromView=Object(p.d)()},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(x||(x={})),(O||(O={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},797:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a,r,o,i,c=n(541),s=n(537);function l(e,t){var n=e.fragment;n.code.add(Object(s.a)(a||(a=Object(c.a)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),1===t.doubleSidedMode?n.code.add(Object(s.a)(r||(r=Object(c.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"])))):2===t.doubleSidedMode?n.code.add(Object(s.a)(o||(o=Object(c.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"])))):n.code.add(Object(s.a)(i||(i=Object(c.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))))}},810:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(4),r=n.n(a),o=n(9),i=n(549),c=n(551),s=n(682),l=n(545),u=n(550);function d(e){return v.apply(this,arguments)}function v(){return v=Object(o.a)(r.a.mark((function e(t){var n,a,o,d,v,m,p,f,b,h,g,x,O;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",n.width=5,n.height=5,e.next=6,n.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return a=new c.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),o=i.a.createVertex(t,35044,new Uint16Array([0,0,1,0,0,1,1,1])),d=new u.a(t,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:o}),v=new s.a(t,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]])),t.useProgram(v),m=new l.a(t,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},n),t.bindTexture(m,0),v.setUniform1i("u_texture",0),p=t.getBoundFramebufferObject(),f=t.getViewport(),b=f.x,h=f.y,g=f.width,x=f.height,t.bindFramebuffer(a),t.setViewport(0,0,1,1),t.bindVAO(d),t.drawArrays(5,0,4),O=new Uint8Array(4),e.abrupt("return",(a.readPixels(0,0,1,1,6408,5121,O),v.dispose(),d.dispose(!1),o.dispose(),a.dispose(),m.dispose(),t.setViewport(b,h,g,x),t.bindFramebuffer(p),n.src="",255===O[0]));case 16:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}},830:function(e,t,n){"use strict";n.d(t,"a",(function(){return $})),n.d(t,"b",(function(){return J}));var a,r,o,i,c,s,l,u,d,v,m,p,f,b,h,g,x,O,j,y=n(541),C=n(702),T=n(765),w=n(556),_=n(606),M=n(729),A=n(708),S=n(715),P=n(772),E=n(703),F=n(681),R=n(773),B=n(701),L=n(766),D=n(579),I=n(875),N=n(704),k=n(735),z=n(567),V=n(797),U=n(717),G=n(730),W=n(642),H=n(654),q=n(577),X=n(876),K=n(767),Q=n(537),Y=n(560);function J(e){var t=new Y.a,n=t.vertex.code,J=t.fragment.code;return t.include(X.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(S.a),t.varyings.add("vpos","vec3"),t.include(H.a,e),t.include(M.a,e),t.include(B.a,e),0!==e.output&&7!==e.output||(t.include(A.a,e),t.include(_.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(T.a),t.include(I.a,e),t.include(R.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(E.a,e),t.include(C.a,e),t.include(P.a,e),t.include(F.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n.add(Object(Q.a)(a||(a=Object(y.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",Q.a.float(q.c),0===e.normalType?Object(Q.a)(r||(r=Object(y.a)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(w.a,e),t.include(q.a,e),e.multipassTerrainEnabled&&(t.fragment.include(D.a),t.include(z.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(K.a),J.add(Object(Q.a)(o||(o=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(Q.a)(i||(i=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(Q.a)(c||(c=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(Q.a)(s||(s=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(Q.a)(l||(l=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.a,e),t.include(k.a,e),t.include(N.a,e),t.include(q.a,e),e.receiveShadows&&t.include(W.a,e),e.multipassTerrainEnabled&&(t.fragment.include(D.a),t.include(z.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(G.a,e),t.include(U.a,e),t.fragment.include(K.a),t.include(V.a,e),J.add(Object(Q.a)(u||(u=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(Q.a)(d||(d=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(Q.a)(v||(v=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?Object(Q.a)(m||(m=Object(y.a)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):Object(Q.a)(p||(p=Object(y.a)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(Q.a)(f||(f=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(Q.a)(b||(b=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?Object(Q.a)(h||(h=Object(y.a)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(Q.a)(g||(g=Object(y.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(Q.a)(x||(x=Object(y.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(Q.a)(O||(O=Object(y.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(Q.a)(j||(j=Object(y.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(L.a,e),t}var $=Object.freeze({__proto__:null,build:J})},831:function(e,t,n){"use strict";n.d(t,"a",(function(){return K})),n.d(t,"b",(function(){return X}));var a,r,o,i,c,s,l,u,d,v,m,p,f,b,h,g,x,O,j,y=n(541),C=n(702),T=n(765),w=n(556),_=n(606),M=n(729),A=n(708),S=n(715),P=n(772),E=n(703),F=n(681),R=n(701),B=n(766),L=n(579),D=n(704),I=n(735),N=n(567),k=n(717),z=n(730),V=n(642),U=n(654),G=n(577),W=n(767),H=n(537),q=n(560);function X(e){var t=new q.a,n=t.vertex.code,X=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(S.a),t.varyings.add("vpos","vec3"),t.include(U.a,e),t.include(M.a,e),t.include(R.a,e),0!==e.output&&7!==e.output||(t.include(A.a,e),t.include(_.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(T.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(E.a,e),t.include(C.a,e),t.include(P.a,e),t.include(F.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add(Object(H.a)(a||(a=Object(y.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",H.a.float(G.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?Object(H.a)(r||(r=Object(y.a)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(w.a,e),t.include(G.a,e),e.multipassTerrainEnabled&&(t.fragment.include(L.a),t.include(N.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(W.a),X.add(Object(H.a)(o||(o=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?Object(H.a)(i||(i=Object(y.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(H.a)(c||(c=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(H.a)(s||(s=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(H.a)(l||(l=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(H.a)(u||(u=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.a,e),t.include(I.a,e),t.include(D.a,e),t.include(G.a,e),e.receiveShadows&&t.include(V.a,e),e.multipassTerrainEnabled&&(t.fragment.include(L.a),t.include(N.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(z.a,e),t.include(k.a,e),t.fragment.include(W.a),X.add(Object(H.a)(d||(d=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?Object(H.a)(v||(v=Object(y.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(H.a)(m||(m=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(H.a)(p||(p=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(H.a)(f||(f=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(H.a)(b||(b=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),Object(H.a)(h||(h=Object(y.a)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(H.a)(g||(g=Object(y.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(H.a)(x||(x=Object(y.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(H.a)(O||(O=Object(y.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(H.a)(j||(j=Object(y.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(B.a,e),t}var K=Object.freeze({__proto__:null,build:X})},840:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a,r,o,i,c=n(541),s=n(703),l=n(537);function u(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(l.a)(a||(a=Object(c.a)(["#ifndef GL_EXT_shader_texture_lod\nfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\nfloat deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\nreturn max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n#endif\nvec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n#else\nvec2 dUVdxAuto = dFdx(uvAtlas);\nvec2 dUVdyAuto = dFdy(uvAtlas);\nfloat mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\nfloat autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\nreturn texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}"]))))}function d(e,t){e.include(s.a,t),e.fragment.code.add(Object(l.a)(r||(r=Object(c.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(Object(l.a)(o||(o=Object(c.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn texture2D(tex, params.uv);\n}"])))),2===t.attributeTextureCoordinates&&(e.include(u),e.fragment.code.add(Object(l.a)(i||(i=Object(c.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n}"])))))}},875:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a,r,o,i,c=n(541),s=n(840),l=n(537);function u(e,t){var n=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?n.code.add(Object(l.a)(a||(a=Object(c.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):n.code.add(Object(l.a)(r||(r=Object(c.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add(Object(l.a)(o||(o=Object(c.a)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),0!==t.attributeTextureCoordinates&&(e.include(s.a,t),n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),n.code.add(Object(l.a)(i||(i=Object(c.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},876:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a,r=n(541),o=n(537),i=n(548);function c(e,t){var n=Object(o.a)(a||(a=Object(r.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"");Object(i.c)()&&(e.fragment.code.add(n),e.vertex.code.add(n))}},962:function(e,t,n){"use strict";n.r(t),n.d(t,"fetch",(function(){return ee})),n.d(t,"gltfToEngineResources",(function(){return ae})),n.d(t,"parseUrl",(function(){return ne}));var a=n(4),r=n.n(a),o=n(13),i=n(10),c=n(9),s=n(345),l=n(7),u=n(235),d=n(562),v=n(100),m=n(546),p=n(58),f=n(79),b=n(304),h=n(597),g=n(668),x=n(929),O=n(957),j=n(931),y=n(950),C=n(932),T=n(54),w=n(163),_=n(18),M=n(11),A=n(21),S=n(433),P=n(811),E=n(661),F=n(752),R=n(716),B=M.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function L(e,t){return D.apply(this,arguments)}function D(){return(D=Object(c.a)(r.a.mark((function e(t,n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,n);case 2:return a=e.sent,e.t0=a,e.next=6,H(a.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return N.apply(this,arguments)}function N(){return(N=Object(c.a)(r.a.mark((function e(t,n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Object(l.k)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",k(t,a,n));case 3:return e.next=5,Object(w.c)(Object(T.default)(t,Object(l.s)(n)));case 5:if(!0!==(o=e.sent).ok){e.next=8;break}return e.abrupt("return",o.value.data);case 8:Object(A.u)(o.error),V(o.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,n){return z.apply(this,arguments)}function z(){return(z=Object(c.a)(r.a.mark((function e(t,n,a){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.c)(n.request(t,"json",a));case 2:if(!0!==(o=e.sent).ok){e.next=5;break}return e.abrupt("return",o.value);case 5:Object(A.u)(o.error),V(o.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){throw new _.a("","Request for object resource failed: ".concat(e))}function U(e){var t=e.params,n=t.topology,a=!0;switch(t.vertexAttributes||(B.warn("Geometry must specify vertex attributes"),a=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var r=t.faces;if(r){if(t.vertexAttributes)for(var o in t.vertexAttributes){var i=r[o];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(B.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),a=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(B.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),a=!1)):(B.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),a=!1)}}else B.warn("Indexed geometries must specify faces"),a=!1;break;default:B.warn("Unsupported topology '".concat(n,"'")),a=!1}e.params.material||(B.warn("Geometry requires material"),a=!1);var c=e.params.vertexAttributes;for(var s in c)c[s].values||(B.warn("Geometries with externally defined attributes are not yet supported"),a=!1);return a}function G(e,t){var n=[],a=[],r=[],o=[],i=e.resource,c=S.a.parse(i.version||"1.0","wosr");Q.validate(c);for(var s=i.model.name,u=i.model.geometries,d=i.materialDefinitions,v=e.textures,m=0,p=new Map,b=0;b<u.length;b++){var h=u[b];if(U(h)){var g=K(h),x=h.params.vertexAttributes,O=[];for(var j in x){var y=x[j],C=y.values;O.push([j,{data:C,size:y.valuesPerElement,exclusive:!0}])}var T=[];if("PerAttributeArray"!==h.params.topology){var w=h.params.faces;for(var _ in w)T.push([_,new Uint32Array(w[_].values)])}var M=v&&v[g.texture];if(M&&!p.has(g.texture)){var A=M.image,P=M.params,B=new F.a(A,P);o.push(B),p.set(g.texture,B)}var L=p.get(g.texture),D=L?L.id:void 0,I=r[g.material]?r[g.material][g.texture]:null;if(!I){var N=d[g.material.substring(g.material.lastIndexOf("/")+1)].params;1===N.transparency&&(N.transparency=0);var k=M&&M.alphaChannelUsage,z=N.transparency>0||"transparency"===k||"maskAndTransparency"===k,V=M?X(M.alphaChannelUsage):void 0,G={ambient:Object(f.f)(N.diffuse),diffuse:Object(f.f)(N.diffuse),opacity:1-(N.transparency||0),transparent:z,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:D,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:N.externalColorMixMode||"tint",textureAlphaPremultiplied:!!M&&!!M.params.preMultiplyAlpha};Object(l.k)(t)&&t.materialParamsMixin&&Object.assign(G,t.materialParamsMixin),I=new R.a(G),r[g.material]||(r[g.material]={}),r[g.material][g.texture]=I}a.push(I);var H=new E.a(O,T);m+=T.position?T.position.length:0,n.push(H)}}return{name:s,stageResources:{textures:o,materials:a,geometries:n},pivotOffset:i.model.pivotOffset,boundingBox:W(n),numberOfVertices:m,lodThreshold:null}}function W(e){var t=Object(b.h)();return e.forEach((function(e){var n=e.boundingInfo;Object(l.k)(n)&&(Object(b.n)(t,n.getBBMin()),Object(b.n)(t,n.getBBMax()))})),t}function H(e,t){return q.apply(this,arguments)}function q(){return(q=Object(c.a)(r.a.mark((function e(t,n){var a,i,c,s,u,d,v,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],i=function(e){var r=t[e],o=r.images[0].data;if(!o)return B.warn("Externally referenced texture data is not yet supported"),"continue";var i=r.encoding+";base64,"+o,c="/textureDefinitions/"+e,s="rgba"===r.channels?r.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==X(s)},d=Object(l.k)(n)&&n.disableTextures?Promise.resolve(null):Object(P.a)(i,n);a.push(d.then((function(e){return{refId:c,image:e,params:u,alphaChannelUsage:s}})))},e.t0=r.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(c=e.t1.value,"continue"!==i(c)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(a);case 12:s=e.sent,u={},d=Object(o.a)(s);try{for(d.s();!(v=d.n()).done;)m=v.value,u[m.refId]=m}catch(p){d.e(p)}finally{d.f()}return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function K(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var Q=new S.a(1,2,"wosr"),Y=n(933),J=n(832),$=n(833),Z=n(710);function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(c.a)(r.a.mark((function e(t,n){var a,o,c,u,d,v,m,p,f,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(a=ne(Object(s.a)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(a.url,n):L(a.url,n);case 4:return o=e.sent,c=G(o,n),e.abrupt("return",{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:o.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(a.url,n,n.usePBR):Object(y.a)(new j.a(n.streamDataRequester),a.url,n,n.usePBR);case 9:if(u=e.sent,d=Object(l.i)(u.model.meta,"ESRI_proxyEllipsoid"),u.meta.isEsriSymbolResource&&Object(l.k)(d)&&-1!==u.meta.uri.indexOf("/RealisticTrees/")&&re(u,d),v=u.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:u.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:n.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},m=Object(i.a)(Object(i.a)({},n.materialParamsMixin),{},{treeRendering:u.customMeta.esriTreeRendering}),null==a.specifiedLodIndex){e.next=18;break}return p=ae(u,v,m,a.specifiedLodIndex),f=p[0].boundingBox,0!==a.specifiedLodIndex&&(f=ae(u,v,m,0)[0].boundingBox),e.abrupt("return",{lods:p,referenceBoundingBox:f,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 18:return b=ae(u,v,m),e.abrupt("return",{lods:b,referenceBoundingBox:b[0].boundingBox,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ae(e,t,n,a){var r=e.model,o=Object(d.b)(),c=new Array,s=new Map,v=new Map;return r.lods.forEach((function(e,d){if(void 0===a||d===a){var m={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(l.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(b.h)()};c.push(m),e.parts.forEach((function(e){var a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),c=r.materials.get(e.material),d=Object(l.k)(e.attributes.texCoord0),p=Object(l.k)(e.attributes.normal),f=function(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}(c.alphaMode);if(!s.has(a)){if(d){if(Object(l.k)(c.textureColor)&&!v.has(c.textureColor)){var j=r.textures.get(c.textureColor),y=Object(i.a)(Object(i.a)({},j.parameters),{},{preMultiplyAlpha:1!==f});v.set(c.textureColor,new F.a(j.data,y))}if(Object(l.k)(c.textureNormal)&&!v.has(c.textureNormal)){var T=r.textures.get(c.textureNormal);v.set(c.textureNormal,new F.a(T.data,T.parameters))}if(Object(l.k)(c.textureOcclusion)&&!v.has(c.textureOcclusion)){var w=r.textures.get(c.textureOcclusion);v.set(c.textureOcclusion,new F.a(w.data,w.parameters))}if(Object(l.k)(c.textureEmissive)&&!v.has(c.textureEmissive)){var _=r.textures.get(c.textureEmissive);v.set(c.textureEmissive,new F.a(_.data,_.parameters))}if(Object(l.k)(c.textureMetallicRoughness)&&!v.has(c.textureMetallicRoughness)){var M=r.textures.get(c.textureMetallicRoughness);v.set(c.textureMetallicRoughness,new F.a(M.data,M.parameters))}}var A=Math.pow(c.color[0],1/Y.a),S=Math.pow(c.color[1],1/Y.a),P=Math.pow(c.color[2],1/Y.a),B=Math.pow(c.emissiveFactor[0],1/Y.a),L=Math.pow(c.emissiveFactor[1],1/Y.a),D=Math.pow(c.emissiveFactor[2],1/Y.a),I=Object(l.k)(c.textureColor)&&d?v.get(c.textureColor):null;s.set(a,new R.a(Object(i.a)(Object(i.a)({},t),{},{transparent:0===f,textureAlphaMode:f,textureAlphaCutoff:c.alphaCutoff,diffuse:[A,S,P],ambient:[A,S,P],opacity:c.opacity,doubleSided:c.doubleSided,doubleSidedType:"winding-order",cullFace:c.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:p?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(l.k)(I)?I.id:void 0,colorMixMode:c.colorMixMode,normalTextureId:Object(l.k)(c.textureNormal)&&d?v.get(c.textureNormal).id:void 0,textureAlphaPremultiplied:Object(l.k)(I)&&!!I.params.preMultiplyAlpha,occlusionTextureId:Object(l.k)(c.textureOcclusion)&&d?v.get(c.textureOcclusion).id:void 0,emissiveTextureId:Object(l.k)(c.textureEmissive)&&d?v.get(c.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(l.k)(c.textureMetallicRoughness)&&d?v.get(c.textureMetallicRoughness).id:void 0,emissiveFactor:[B,L,D],mrrFactors:[c.metallicFactor,c.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n)))}var N=function(e,t){switch(t){case 4:return Object(C.c)(e);case 5:return Object(C.b)(e);case 6:return Object(C.a)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),k=e.attributes.position.count,z=Object(O.a)(h.u,k);Object(g.e)(z,e.attributes.position,e.transform);var V=[["position",{data:z.typedBuffer,size:z.elementCount,exclusive:!0}]],U=[["position",N]];if(Object(l.k)(e.attributes.normal)){var G=Object(O.a)(h.u,k);Object(u.a)(o,e.transform),Object(g.a)(G,e.attributes.normal,o),V.push(["normal",{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),U.push(["normal",N])}if(Object(l.k)(e.attributes.tangent)){var W=Object(O.a)(h.C,k);Object(u.a)(o,e.transform),Object(x.c)(W,e.attributes.tangent,o),V.push(["tangent",{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]),U.push(["tangent",N])}if(Object(l.k)(e.attributes.texCoord0)){var H=Object(O.a)(h.m,k);Object(J.b)(H,e.attributes.texCoord0),V.push(["uv0",{data:H.typedBuffer,size:H.elementCount,exclusive:!0}]),U.push(["uv0",N])}if(Object(l.k)(e.attributes.color)){var q=Object(O.a)(h.J,k);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h.C?Object(x.b)(q,e.attributes.color,255):e.attributes.color instanceof h.J?Object($.a)(q,e.attributes.color):e.attributes.color instanceof h.H&&Object(x.b)(q,e.attributes.color,1/256);else{Object($.b)(q,255,255,255,255);var X=new h.B(q.buffer,0,4);e.attributes.color instanceof h.u?Object(g.d)(X,e.attributes.color,255):e.attributes.color instanceof h.B?Object(Z.a)(X,e.attributes.color):e.attributes.color instanceof h.z&&Object(g.d)(X,e.attributes.color,1/256)}V.push(["color",{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),U.push(["color",N])}var K=new E.a(V,U);m.stageResources.geometries.push(K),m.stageResources.materials.push(s.get(a)),d&&(Object(l.k)(c.textureColor)&&m.stageResources.textures.push(v.get(c.textureColor)),Object(l.k)(c.textureNormal)&&m.stageResources.textures.push(v.get(c.textureNormal)),Object(l.k)(c.textureOcclusion)&&m.stageResources.textures.push(v.get(c.textureOcclusion)),Object(l.k)(c.textureEmissive)&&m.stageResources.textures.push(v.get(c.textureEmissive)),Object(l.k)(c.textureMetallicRoughness)&&m.stageResources.textures.push(v.get(c.textureMetallicRoughness))),m.numberOfVertices+=k;var Q=K.boundingInfo;Object(l.k)(Q)&&(Object(b.n)(m.boundingBox,Q.getBBMin()),Object(b.n)(m.boundingBox,Q.getBBMax()))}))}})),c}function re(e,t){for(var n=0;n<e.model.lods.length;++n){var a=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var r,i=Object(o.a)(a.parts);try{for(i.s();!(r=i.n()).done;){var c=r.value,s=c.attributes.normal;if(Object(l.j)(s))return;for(var u=c.attributes.position,d=u.count,b=Object(f.e)(),g=Object(f.e)(),x=Object(f.e)(),j=Object(O.a)(h.J,d),y=Object(O.a)(h.u,d),C=Object(v.c)(Object(m.d)(),c.transform),T=0;T<d;T++){u.getVec(T,g),s.getVec(T,b),Object(p.q)(g,g,c.transform),Object(p.j)(x,g,t.center),Object(p.b)(x,x,t.radius);var w=x[2],_=Object(p.p)(x),M=Math.min(.45+.55*_*_,1);Object(p.b)(x,x,t.radius),Object(p.q)(x,x,C),Object(p.r)(x,x),n+1!==e.model.lods.length&&e.model.lods.length>1&&Object(p.i)(x,x,b,w>-1?.2:Math.min(-4*w-3.8,1)),y.setVec(T,x),j.set(T,0,255*M),j.set(T,1,255*M),j.set(T,2,255*M),j.set(T,3,255)}c.attributes.normal=y,c.attributes.color=j}}catch(A){i.e(A)}finally{i.f()}}}}}]);
//# sourceMappingURL=60.9abed30c.chunk.js.map