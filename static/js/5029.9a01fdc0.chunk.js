"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[5029],{45028:(e,t,i)=>{i.d(t,{C:()=>M,b:()=>I});var r,n,o,s,a,l,c,d,h,u,p=i(30168),f=i(22357),v=i(37081),g=i(33280),m=i(94951),_=i(14801),y=i(48655),w=i(16574),T=i(137),b=i(15226),C=i(18607),x=i(26461),S=i(116),O=i(82552),A=i(95276),R=i(98634),P=i(64201),E=i(25920),D=i(4760);function I(e){const t=new P.kG,{vertex:i,fragment:I,attributes:M,varyings:L}=t;(0,O.Sv)(i,e),t.include(m.w,e),t.include(y.c,e),t.include(C.k,e),t.include(_.R,e),M.add(D.T.POSITION,"vec3"),e.vvColor&&M.add(D.T.COLORFEATUREATTRIBUTE,"float"),L.add("vColor","vec4"),L.add("vpos","vec3");const H=e.multipassEnabled&&(e.output===v.H.Color||e.output===v.H.Alpha);H&&L.add("depth","float"),i.uniforms.add(new A.N("eColor",(e=>e.color)));const F=e.output===v.H.Depth;F&&(t.include(w.F,e),(0,f.Zu)(t),(0,f.Lm)(t)),i.code.add((0,R.H)(r||(r=(0,p.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n\n      ","\n      ","\n      gl_Position = ","\n    }\n  "])),e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;",H?"depth = (view * vec4(vpos, 1.0)).z;":"",F?(0,R.H)(n||(n=(0,p.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,R.H)(o||(o=(0,p.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(g.f5,e),H&&t.include(b.l,e),I.include(S.Y);const N=e.output===v.H.Highlight;return N&&t.include(T.bA,e),I.code.add((0,R.H)(s||(s=(0,p.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = vColor;\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n    ","\n  }\n  "])),H?"terrainDepthTest(depth);":"",e.output===v.H.ObjectAndLayerIdColor?(0,R.H)(a||(a=(0,p.Z)(["fColor.a = 1.0;"]))):"",R.H.float(x.b),e.output===v.H.Alpha?(0,R.H)(l||(l=(0,p.Z)(["fragColor = vec4(fColor.a);"]))):"",e.output===v.H.Color?(0,R.H)(c||(c=(0,p.Z)(["fragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===E.A.Color?"fragColor = premultiplyAlpha(fragColor);":""):"",N?(0,R.H)(d||(d=(0,p.Z)(["outputHighlight();"]))):"",e.output===v.H.Depth?(0,R.H)(h||(h=(0,p.Z)(["outputDepth(linearDepth);"]))):"",e.output===v.H.ObjectAndLayerIdColor?(0,R.H)(u||(u=(0,p.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const M=Object.freeze(Object.defineProperty({__proto__:null,build:I},Symbol.toStringTag,{value:"Module"}))},18442:(e,t,i)=>{i.d(t,{H:()=>te,b:()=>Q,c:()=>K});var r,n,o,s,a,l,c,d,h,u,p,f,v,g,m,_,y,w,T,b,C,x,S=i(30168),O=i(88396),A=i(6394),R=i(67077),P=i(37081),E=i(33280),D=i(14801),I=i(28156),M=i(81879),L=i(50913),H=i(55616),F=i(137),N=i(18607),z=i(26461),j=i(116),U=i(78980),V=i(62993),Z=i(82552),G=i(82999),B=i(95276),W=i(58406),k=i(98634),q=i(64201),J=i(19253),Y=i(25920),X=i(4760);function Q(e){const t=new q.kG,i=e.signedDistanceFieldEnabled;if(t.include(M.R,e),t.include(E.f5,e),e.occlusionPass)return t.include(L.R,e),t;const{vertex:A,fragment:Q}=t;t.include(V.cK),Q.include(U.n),Q.include(j.Y),t.include(N.k,e),t.include(D.R,e),t.include(H.P),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),A.uniforms.add(new B.N("viewport",((e,t)=>t.camera.fullViewport)),new G.A("screenOffset",((e,t)=>(0,O.s)(ee,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new G.A("anchorPosition",(e=>K(e))),new B.N("materialColor",(e=>e.color))),(0,Z.ZI)(A),i&&(A.uniforms.add(new B.N("outlineColor",(e=>e.outlineColor))),Q.uniforms.add(new B.N("outlineColor",(e=>$(e)?e.outlineColor:R.Z)),new W.p("outlineSize",(e=>$(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&A.include(I.H),e.hasScreenSizePerspective&&((0,V.ww)(A),(0,V.m8)(A)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(X.T.UV0,"vec2"),t.attributes.add(X.T.COLOR,"vec4"),t.attributes.add(X.T.SIZE,"vec2"),t.attributes.add(X.T.FEATUREATTRIBUTE,"vec4"),A.code.add((0,k.H)(r||(r=(0,S.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n      bool visible = testHUDVisibility(posProj);\n      voccluded = visible ? 0.0 : 1.0;\n    "])),e.hasScreenSizePerspective?(0,k.H)(n||(n=(0,S.Z)(["\n            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,k.H)(o||(o=(0,S.Z)(["\n            inputSize = size;\n            vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""));const te=(0,k.H)(s||(s=(0,S.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),ie=e.pixelSnappingEnabled?i?(0,k.H)(a||(a=(0,S.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,k.H)(l||(l=(0,S.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,k.H)(c||(c=(0,S.Z)(["posProj += quadOffset;"])));A.code.add((0,k.H)(d||(d=(0,S.Z)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",te,e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===P.H.ObjectAndLayerIdColor?(0,k.H)(h||(h=(0,S.Z)(["vcolor.a = 1.0;"]))):"",k.H.float(z.b),i?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(k.H.float(z.b),";"):"",ie,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,k.H)(u||(u=(0,S.Z)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),Q.uniforms.add(new J.A("tex",(e=>e.texture)));const re=e.debugDrawLabelBorder?(0,k.H)(p||(p=(0,S.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),k.H.float(z.F)):k.H.float(z.F),ne=(0,k.H)(f||(f=(0,S.Z)(["\n    ","\n\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,k.H)(v||(v=(0,S.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",e.sampleSignedDistanceFieldTexelCenter?(0,k.H)(g||(g=(0,S.Z)(["\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      float txSize = float(textureSize(tex, 0).x);\n      float texelSize = 1.0 / txSize;\n\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n      "]))):(0,k.H)(m||(m=(0,S.Z)(["\n      vec2 samplePos = vtc;\n      "]))),i?(0,k.H)(_||(_=(0,S.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        fragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        fragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),re,k.H.float(z.b),re):(0,k.H)(y||(y=(0,S.Z)(["\n          vec4 texColor = texture(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          fragColor = texColor * premultiplyAlpha(vcolor);\n          "])),re),e.debugDrawLabelBorder?(0,k.H)(w||(w=(0,S.Z)(["fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");switch(e.output){case P.H.Color:Q.code.add((0,k.H)(T||(T=(0,S.Z)(["\n        void main() {\n          ","\n          ","\n        }"])),ne,e.transparencyPassType===Y.A.FrontFace?"fragColor.rgb /= fragColor.a;":""));break;case P.H.Alpha:Q.code.add((0,k.H)(b||(b=(0,S.Z)(["\n        void main() {\n          ","\n          fragColor = vec4(fragColor.a);\n        }"])),ne));break;case P.H.ObjectAndLayerIdColor:Q.code.add((0,k.H)(C||(C=(0,S.Z)(["\n        void main() {\n          ","\n          outputObjectAndLayerIdColor();\n        }"])),ne));break;case P.H.Highlight:Q.constants.add("occludedHighlightFlag","vec4",F.Wj).add("unoccludedHighlightFlag","vec4",F.ck),Q.code.add((0,k.H)(x||(x=(0,S.Z)(["\n        void main() {\n          ","\n          if (voccluded == 1.0) {\n            fragColor = occludedHighlightFlag;\n          } else {\n            fragColor = unoccludedHighlightFlag;\n          }\n        }"])),ne))}return t}function $(e){return e.outlineColor[3]>0&&e.outlineSize>0}function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee;return e.textureIsSignedDistanceField?function(e,t,i){null!=t?(0,O.s)(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,O.s)(i,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,O.j)(t,e.anchorPosition),t}const ee=(0,A.a)(),te=Object.freeze(Object.defineProperty({__proto__:null,build:Q,calculateAnchorPosForRendering:K},Symbol.toStringTag,{value:"Module"}))},38365:(e,t,i)=>{i.d(t,{O:()=>u,a:()=>f,b:()=>p});var r,n=i(30168),o=i(54134),s=i(24967),a=i(58406),l=i(99339),c=i(98634),d=i(64201),h=i(19253);class u extends c.K{constructor(){super(...arguments),this.overlayIndex=o.fu.INNER,this.opacity=1}}function p(){const e=new d.kG;return e.include(s.k),e.fragment.uniforms.add(new h.A("tex",(e=>e.texture))),e.fragment.uniforms.add(new l._("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new a.p("opacity",(e=>e.opacity))),e.fragment.code.add((0,c.H)(r||(r=(0,n.Z)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:p},Symbol.toStringTag,{value:"Module"}))},98186:(e,t,i)=>{i.d(t,{R:()=>we,b:()=>ye,r:()=>_e});var r,n,o,s,a,l,c,d,h,u,p,f,v,g,m,_,y,w,T,b,C,x,S,O,A,R,P,E,D,I,M,L,H,F,N,z,j,U,V,Z,G,B,W,k,q,J=i(30168),Y=i(22357),X=i(37081),Q=i(33280),$=i(14801),K=i(48353),ee=i(16574),te=i(2631),ie=i(40526),re=i(15226),ne=i(85586),oe=i(26461),se=i(116),ae=i(82552),le=i(82999),ce=i(95276),de=i(58406),he=i(98634),ue=i(8654),pe=i(64201),fe=i(25920),ve=i(4760),ge=i(33720),me=i(737);const _e=1;function ye(e){const t=new pe.kG,{vertex:i,fragment:ye}=t,we=e.multipassEnabled&&(e.output===X.H.Color||e.output===X.H.Alpha);t.include(ne.e),t.include(K.U,e),t.include(te.q,e);const Te=e.applyMarkerOffset&&!e.draped;Te&&(i.uniforms.add(new de.p("markerScale",(e=>e.markerScale))),t.include(ie.Q,{space:ge.I9.World,draped:!1})),e.output===X.H.Depth&&t.include(ee.F,e),t.include($.R,e),(0,ae.Sv)(i,e),i.uniforms.add(new ue.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new le.A("nearFar",((e,t)=>t.camera.nearFar)),new de.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new ce.N("viewport",((e,t)=>t.camera.fullViewport))),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(ve.T.POSITION,"vec3"),t.attributes.add(ve.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(ve.T.UV0,"vec2"),t.attributes.add(ve.T.AUXPOS1,"vec3"),t.attributes.add(ve.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),(0,Y.Lm)(t),we&&t.varyings.add("depth","float");const be=e.stippleEnabled;be&&t.varyings.add("vLineSizeInv","float");const Ce=e.capType===me.R.ROUND,xe=be||Ce;xe&&t.varyings.add("vLineWidth","float");const Se=e.innerColorEnabled||Ce;Se&&t.varyings.add("vLineDistance","float");const Oe=e.stippleEnabled&&Ce,Ae=e.falloffEnabled||Oe;Ae&&t.varyings.add("vLineDistanceNorm","float"),Ce&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add((0,he.H)(r||(r=(0,J.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),i.code.add((0,he.H)(n||(n=(0,J.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),(0,Y.bA)(t),i.code.add((0,he.H)(o||(o=(0,J.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),we?"depth = pos.z;":"")),(0,ae.ZI)(i),i.code.add((0,he.H)(s||(s=(0,J.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n  "])),xe?(0,he.H)(a||(a=(0,J.Z)(["vLineWidth = lineWidth;"]))):"",be?(0,he.H)(l||(l=(0,J.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),Te&&i.code.add((0,he.H)(c||(c=(0,J.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),i.code.add((0,he.H)(d||(d=(0,J.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Ce)&&i.code.add((0,he.H)(h||(h=(0,J.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Ce?(0,he.H)(u||(u=(0,J.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),i.code.add((0,he.H)(p||(p=(0,J.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?i.code.add((0,he.H)(f||(f=(0,J.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,he.H)(v||(v=(0,J.Z)(["min(1.0, subdivisionFactor * ",")"])),he.H.float((_e+2)/(_e+1))):(0,he.H)(g||(g=(0,J.Z)(["subdivisionFactor"]))))):i.code.add((0,he.H)(m||(m=(0,J.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));const Re=e.capType!==me.R.BUTT;return i.code.add((0,he.H)(_||(_=(0,J.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Re?(0,he.H)(y||(y=(0,J.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),i.code.add((0,he.H)(w||(w=(0,J.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    pos.xy += dpos;\n  "])),Ae||Se?(0,he.H)(T||(T=(0,J.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",Se?(0,he.H)(b||(b=(0,J.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",Ae?(0,he.H)(C||(C=(0,J.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Ce&&i.code.add((0,he.H)(x||(x=(0,J.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?i.uniforms.add(new de.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):i.code.add((0,he.H)(S||(S=(0,J.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),i.code.add((0,he.H)(O||(O=(0,J.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?i.code.add((0,he.H)(A||(A=(0,J.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):i.code.add((0,he.H)(R||(R=(0,J.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),i.uniforms.add(new de.p("stipplePatternPixelSize",(e=>(0,te.C)(e)))),i.code.add((0,he.H)(P||(P=(0,J.Z)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),i.code.add((0,he.H)(E||(E=(0,J.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),we&&t.include(re.l,e),t.include(Q.f5,e),ye.include(se.Y),ye.code.add((0,he.H)(D||(D=(0,J.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),we?"terrainDepthTest(depth);":"")),e.wireframe?ye.code.add((0,he.H)(I||(I=(0,J.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Ce&&ye.code.add((0,he.H)(M||(M=(0,J.Z)(["\n      float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n      vec2 fragmentPosition = vec2(\n        min(sdf, 0.0),\n        vLineDistance\n      ) * gl_FragCoord.w;\n\n      float fragmentRadius = length(fragmentPosition);\n      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n      if (capCoverage < ",") {\n        discard;\n      }\n    "])),he.H.float(oe.b))),Oe?ye.code.add((0,he.H)(L||(L=(0,J.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),he.H.float(oe.b))):ye.code.add((0,he.H)(H||(H=(0,J.Z)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==X.H.ObjectAndLayerIdColor&&ye.code.add((0,he.H)(F||(F=(0,J.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),ye.uniforms.add(new ce.N("intrinsicColor",(e=>e.color))),ye.code.add((0,he.H)(N||(N=(0,J.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(ye.uniforms.add(new ce.N("innerColor",(e=>{var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new de.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),ye.code.add((0,he.H)(z||(z=(0,J.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),ye.code.add((0,he.H)(j||(j=(0,J.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(ye.uniforms.add(new de.p("falloff",(e=>e.falloff))),ye.code.add((0,he.H)(U||(U=(0,J.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))))),ye.code.add((0,he.H)(V||(V=(0,J.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===X.H.ObjectAndLayerIdColor?(0,he.H)(Z||(Z=(0,J.Z)(["finalColor.a = 1.0;"]))):"",he.H.float(oe.b),e.output===X.H.Alpha?(0,he.H)(G||(G=(0,J.Z)(["fragColor = vec4(finalColor.a);"]))):"",e.output===X.H.Color?(0,he.H)(B||(B=(0,J.Z)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===X.H.Color&&e.transparencyPassType===fe.A.Color?"fragColor = premultiplyAlpha(fragColor);":"",e.output===X.H.Highlight?(0,he.H)(W||(W=(0,J.Z)(["fragColor = vec4(1.0);"]))):"",e.output===X.H.Depth?(0,he.H)(k||(k=(0,J.Z)(["outputDepth(linearDepth);"]))):"",e.output===X.H.ObjectAndLayerIdColor?(0,he.H)(q||(q=(0,J.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const we=Object.freeze(Object.defineProperty({__proto__:null,build:ye,ribbonlineNumRoundJoinSubdivisions:_e},Symbol.toStringTag,{value:"Module"}))},61863:(e,t,i)=>{i.d(t,{T:()=>h,a:()=>p,b:()=>u});var r,n=i(30168),o=i(67077),s=i(24967),a=i(95276),l=i(98634),c=i(64201),d=i(19253);class h extends l.K{constructor(){super(...arguments),this.color=(0,o.f)(1,1,1,1)}}function u(){const e=new c.kG;return e.include(s.k),e.fragment.uniforms.add(new d.A("tex",(e=>e.texture)),new a.N("uColor",(e=>e.color))),e.fragment.code.add((0,l.H)(r||(r=(0,n.Z)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * uColor;\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:u},Symbol.toStringTag,{value:"Module"}))},49810:(e,t,i)=>{i.d(t,{W:()=>U,b:()=>j});var r,n,o,s,a,l,c,d,h,u,p,f,v=i(30168),g=i(22357),m=i(37081),_=i(33280),y=i(94951),w=i(14801),T=i(137),b=i(60750),C=i(92395),x=i(15226),S=i(8555),O=i(41481),A=i(58335),R=i(29078),P=i(79246),E=i(26461),D=i(116),I=i(82552),M=i(95276),L=i(58406),H=i(98634),F=i(64201),N=i(25920),z=i(4760);function j(e){const t=new F.kG,{vertex:i,fragment:j}=t;(0,I.Sv)(i,e),t.include(y.w,e),t.attributes.add(z.T.POSITION,"vec3"),t.attributes.add(z.T.UV0,"vec2");const U=new M.N("waterColor",(e=>e.color));if(e.output===m.H.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),i.uniforms.add(U),i.code.add((0,H.H)(r||(r=(0,v.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),H.H.float(E.b))),j.uniforms.add(U),j.code.add((0,H.H)(n||(n=(0,v.Z)(["void main() {\nfragColor = waterColor;\n}"])))),t;switch(e.output!==m.H.Color&&e.output!==m.H.Alpha||(t.include(S.n,e),t.include(g.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.uniforms.add(U),i.code.add((0,H.H)(o||(o=(0,v.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),H.H.float(E.b),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===m.H.Color?"forwardLinearDepth();":""))),t.include(x.l,e),e.output){case m.H.Alpha:t.include(_.f5,e),j.uniforms.add(U),j.code.add((0,H.H)(s||(s=(0,v.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          fragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassEnabled?"terrainDepthTest(depth);":""));break;case m.H.Color:t.include(C.kR),t.include(b._,{pbrMode:O.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(P.M),t.include(_.f5,e),t.include(A.XE,e),t.include(R.B,e),j.uniforms.add(U,new L.p("timeElapsed",(e=>e.timeElapsed)),i.uniforms.get("view"),i.uniforms.get("localOrigin")),(0,I.hY)(j,e),j.include(D.Y),(0,C.Pe)(j),(0,C.F1)(j),j.code.add((0,H.H)(a||(a=(0,v.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view * vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        fragColor = delinearizeGamma(final);\n        fragColor = highlightSlice(fragColor, vpos);\n        ","\n      }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",e.receiveShadows?(0,H.H)(l||(l=(0,v.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.transparencyPassType===N.A.Color?"fragColor = premultiplyAlpha(fragColor);":""));break;case m.H.Normal:t.include(S.n,e),t.include(P.M,e),t.include(_.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.uniforms.add(U),i.code.add((0,H.H)(c||(c=(0,v.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),H.H.float(E.b))),j.uniforms.add(new L.p("timeElapsed",(e=>e.timeElapsed))),j.code.add((0,H.H)(d||(d=(0,v.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\nfragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))));break;case m.H.Highlight:t.include(T.bA,e),t.varyings.add("vpos","vec3"),i.uniforms.add(U),i.code.add((0,H.H)(h||(h=(0,v.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),H.H.float(E.b))),t.include(_.f5,e),j.code.add((0,H.H)(u||(u=(0,v.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))));break;case m.H.ObjectAndLayerIdColor:t.include(w.R,e),t.varyings.add("vpos","vec3"),i.uniforms.add(U),i.code.add((0,H.H)(p||(p=(0,v.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardObjectAndLayerIdColor();\n      }\n    "])),H.H.float(E.b))),t.include(_.f5,e),j.code.add((0,H.H)(f||(f=(0,v.Z)(["void main() {\ndiscardBySlice(vpos);\noutputObjectAndLayerIdColor();\n}"]))))}return t}const U=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},8229:(e,t,i)=>{function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(){return r()}function a(){return o(1,1,1)}function l(){return o(1,0,0)}function c(){return o(0,1,0)}function d(){return o(0,0,1)}i.d(t,{a:()=>n,c:()=>r,f:()=>o});const h=s(),u=a(),p=l(),f=c(),v=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:p,UNIT_Y:f,UNIT_Z:v,ZEROS:h,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:o,ones:a,unitX:l,unitY:c,unitZ:d,zeros:s},Symbol.toStringTag,{value:"Module"}))},46228:(e,t,i)=>{i.d(t,{I:()=>n,v:()=>o});var r=i(16889);function n(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(0,r.uZ)(e,0,l);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*c(n*s[r]))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(let r=0;r<4;r++)i+=e[t+r]*a[r];return i}const s=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},9738:(e,t,i)=>{i.d(t,{M:()=>o});var r=i(71353),n=i(50628);function o(e,t,i){return(0,n.projectBuffer)(e,t,0,s,i.spatialReference,0,1)?(i.x=s[0],i.y=s[1],i.z=s[2],i):null}const s=(0,r.c)()},81020:(e,t,i)=>{function r(e){return"point"===e.type}i.d(t,{f:()=>r})},46208:(e,t,i)=>{var r,n;function o(e){return null!=e&&!e.running}i.d(t,{WU:()=>o,jL:()=>r,uz:()=>n}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(r||(r={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},5573:(e,t,i)=>{i.d(t,{Kf:()=>f,lL:()=>r});var r,n=i(16889),o=i(14226),s=i(81949),a=i(11186),l=i(71353),c=i(45238),d=i(22186),h=i(46208),u=i(82278),p=i(75248);class f{constructor(){this.readChannels=h.uz.RG,this.renderingStage=h.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.c)(),this.parallax=new v,this.parallaxNew=new v,this.pointOnGround=(0,l.c)(),this.fadeMode=r.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,i=(0,a.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-d.sv.radius*d.sv.radius,0))/i,(0,c.zk)(g,t.anchorPointClouds,m),(0,o.k)(t.transform,s.I,m[3],(0,c.ZZ)(m)),this.fadeMode===r.CROSS_FADE){const e=this.parallaxNew;(0,c.zk)(g,e.anchorPointClouds,m),(0,o.k)(e.transform,s.I,m[3],(0,c.ZZ)(m))}}updateFading(e,t,i,r){this.isFading&&this._advanceFading(i,r),this._evaluateFading(e,t,i)}_evaluateFading(e,t,i){const n=e.relativeElevation,o=this._calculateDistanceToAnchorPoint(e);if((n>1.7*u.nq||n<-u.nq||o>b)&&this.opacity>0)this._setFade(r.HIDE,i);else if(!this.isFading)if((n>u.nq||n<-.35*u.nq||o>T)&&this.opacity>0)this._setFade(r.FADE_OUT,i);else if(n<=u.nq&&n>=-.35*u.nq&&t===p.n.IDLE&&(0,h.WU)(this.data)){if(0===this.opacity)return void this._setFade(r.FADE_IN,i);(o>w||this.renderingStage===h.jL.FADING)&&this._setFade(r.CROSS_FADE,i)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,n.uZ)((e-this.startTime)/(y*t),0,1):1,this.fadeMode===r.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===r.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===r.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===r.FADE_OUT&&(this.opacity=0),this.fadeMode===r.FADE_IN&&(this.opacity=1),this.fadeMode===r.CROSS_FADE&&(this.opacity=1),this.fadeMode=r.NONE}_switchReadChannels(){const e=this.fadeMode===r.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===r.FADE_IN&&0===this.fadeFactor;this.renderingStage===h.jL.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=h.jL.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,a.n)(this.pointOnGround,e.eye),(0,a.i)(this.pointOnGround,this.pointOnGround,d.sv.radius),(0,a.l)((0,a.f)(_,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===r.CROSS_FADE&&(0===this.fadeFactor&&(0,a.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===r.FADE_IN&&0===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case r.HIDE:this.opacity=0;break;case r.FADE_OUT:this.opacity=1;break;case r.FADE_IN:this.opacity=0;break;case r.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===r.FADE_OUT||this.fadeMode===r.FADE_IN||this.fadeMode===r.CROSS_FADE}}!function(e){e[e.NONE=0]="NONE",e[e.HIDE=1]="HIDE",e[e.FADE_OUT=2]="FADE_OUT",e[e.FADE_IN=3]="FADE_IN",e[e.CROSS_FADE=4]="CROSS_FADE"}(r||(r={}));class v{constructor(){this.anchorPointClouds=(0,l.c)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,s.a)()}}const g=(0,l.f)(0,0,1),m=(0,c.Ue)(),_=(0,l.c)(),y=1.25,w=34e3,T=64e3,b=2e5},82278:(e,t,i)=>{i.d(t,{$T:()=>x,nq:()=>C});var r,n=i(27366),o=i(46784),s=i(49861),a=(i(25243),i(63780),i(93169),i(27135)),l=i(69912);let c=r=class extends o.wq{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=r=(0,n._)([(0,l.j)("esri.views.3d.environment.CloudyWeather")],c);const d=c;var h;let u=h=class extends o.wq{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,n._)([(0,a.J)({foggy:"foggy"})],u.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],u.prototype,"fogStrength",void 0),u=h=(0,n._)([(0,l.j)("esri.views.3d.environment.FoggyWeather")],u);const p=u;var f;let v=f=class extends o.wq{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.J)({rainy:"rainy"})],v.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"cloudCover",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"precipitation",void 0),v=f=(0,n._)([(0,l.j)("esri.views.3d.environment.RainyWeather")],v);const g=v;var m;let _=m=class extends o.wq{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new m({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.J)({snowy:"snowy"})],_.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),(0,n._)([(0,s.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_.prototype,"snowCover",void 0),_=m=(0,n._)([(0,l.j)("esri.views.3d.environment.SnowyWeather")],_);const y=_;var w;let T=w=class extends o.wq{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new w({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({sunny:"sunny"})],T.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"cloudCover",void 0),T=w=(0,n._)([(0,l.j)("esri.views.3d.environment.SunnyWeather")],T);const b={key:"type",base:T,typeMap:{sunny:T,cloudy:d,rainy:g,snowy:y,foggy:p}};Object.keys(b.typeMap);const C=1e4,x=1e5},78935:(e,t,i)=>{i.d(t,{o:()=>o});var r=i(88152),n=i(8821);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,r.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=(0,n.ht)(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){var t;this.mode=e.mode,this.unit=(0,r.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}updateFeatureExpressionInfoContext(e,t,i){if(null==e)return void(this._featureExpressionInfoContext=null);const r=null===e||void 0===e?void 0:e.arcade;r&&null!=t&&null!=i?(this._featureExpressionInfoContext=(0,n.d9)(e),(0,n.aO)(this._featureExpressionInfoContext,(0,n.Tz)(r.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},69691:(e,t,i)=>{i.d(t,{B5:()=>m,GC:()=>v,Lm:()=>y,Xf:()=>g,bD:()=>_,lO:()=>r,qZ:()=>p,rR:()=>u,w7:()=>f});var r,n=i(14226),o=i(81949),s=i(71353),a=i(37998),l=i(50628),c=i(81020),d=i(96387),h=i(77648);function u(e,t,i,r,n,o,s,a,c,d,h){const u=w[h.mode];let p,f,v=0;if((0,l.projectBuffer)(e,t,i,r,c.spatialReference,n,a))return u.requiresAlignment(h)?(v=u.applyElevationAlignmentBuffer(r,n,o,s,a,c,d,h),p=o,f=s):(p=r,f=n),(0,l.projectBuffer)(p,c.spatialReference,f,o,d.spatialReference,s,a)?v:void 0}function p(e,t,i,r,n){const o=((0,c.f)(e)?e.z:(0,h.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{var s;const i=null!==(s=(0,h.KO)(t,e,"ground"))&&void 0!==s?s:0;return n.verticalDistanceToGround=0,n.sampledElevation=i,void(n.z=i)}case"relative-to-ground":{var a;const s=null!==(a=(0,h.KO)(t,e,"ground"))&&void 0!==a?a:0,l=i.geometryZWithOffset(o,r);return n.verticalDistanceToGround=l,n.sampledElevation=s,void(n.z=l+s)}case"relative-to-scene":{var l;const s=null!==(l=(0,h.KO)(t,e,"scene"))&&void 0!==l?l:0,a=i.geometryZWithOffset(o,r);return n.verticalDistanceToGround=a,n.sampledElevation=s,void(n.z=a+s)}case"absolute-height":{var d;const s=i.geometryZWithOffset(o,r),a=null!==(d=(0,h.KO)(t,e,"ground"))&&void 0!==d?d:0;return n.verticalDistanceToGround=s-a,n.sampledElevation=a,void(n.z=s)}default:return void(n.z=0)}}function f(e,t,i,r){return p(e,t,i,r,b),b.z}function v(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function _(e,t,i,r,o){p(t,i,o,r,b),(0,d.CV)(e,b.verticalDistanceToGround);const s=b.sampledElevation,l=(0,n.h)(T,e.transformation);return C[0]=t.x,C[1]=t.y,C[2]=b.z,(0,a.B)(t.spatialReference,C,l,r.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),s}class y{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(r||(r={}));const w={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,n,o,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let d=0;d<n;++d){const n=e[t],o=e[t+1],s=e[t+2];i[r]=n,i[r+1]=o,i[r+2]=null==c?s+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,o){let s=0;const a=o.spatialReference;t*=3,r*=3;for(let c=0;c<n;++c){var l;const n=e[t],c=e[t+1],d=e[t+2],h=null!==(l=o.getElevation(n,c,d,a,"ground"))&&void 0!==l?l:0;s+=h,i[r]=n,i[r+1]=c,i[r+2]=h,t+=3,r+=3}return s/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"ground"))&&void 0!==u?u:0;l+=p,i[r]=n,i[r+1]=s,i[r+2]=null==d?a+p+c:p+c,t+=3,r+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,n,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"scene"))&&void 0!==u?u:0;l+=p,i[r]=n,i[r+1]=s,i[r+2]=null==d?a+p+c:p+c,t+=3,r+=3}return l/n},requiresAlignment:()=>!0}},T=(0,o.a)(),b=new y,C=(0,s.c)()},8821:(e,t,i)=>{i.d(t,{O$:()=>f,Tz:()=>d,WI:()=>p,aO:()=>h,d9:()=>l,ht:()=>u,kr:()=>c});var r=i(32718),n=i(66978),o=i(37818),s=i(819);const a=r.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,i,r){const o=null===e||void 0===e?void 0:e.expression;if("string"!=typeof o)return null;const a=g(o);if(null!=a)return{cachedResult:a};const l=await(0,s.LC)();(0,n.k_)(i);const c=l.arcadeUtils,d=c.createSyntaxTree(o);return c.dependsOnView(d)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(d),context:c.createExecContext(null,{sr:t}),modules:l}}}function d(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,o.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let i=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function p(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null===e||void 0===e?void 0:e.featureExpressionInfo;const o=null===(t=n)||void 0===t?void 0:t.expression;return r||"0"===o||(n=null),null!==(i=n)&&void 0!==i?i:null}const f={cachedResult:0};function v(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},96387:(e,t,i)=>{i.d(t,{CV:()=>T,Go:()=>w,Si:()=>A,Uu:()=>b,ZL:()=>S,_Z:()=>O,bD:()=>C,bh:()=>x,zE:()=>m});var r=i(68860),n=i(14226),o=i(81949),s=i(71353),a=i(90045),l=i(67077),c=i(79803),d=i(41414),h=i(65156),u=i(4954),p=i(69662),f=i(55946),v=i(37818),g=i(4760);function m(e,t){if("point"===e.type)return y(e,t,!1);if((0,v.Ou)(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(_(e),t,!0);case"mesh":return y(e.origin,t,!1)}else switch(e.type){case"extent":return y(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=(0,u.a)(e.rings,!!e.hasZ);return(0,f.T)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return y(_(e),t,!0)}}function _(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,p.n8)(t,(0,p.ok)(t)/2);return(0,f.T)(i[0],i[1],i[2],e.spatialReference)}function y(e,t,i){const r=i?e:(0,v.WG)(e);return t&&e?(0,c.projectPoint)(e,r,t)?r:null:r}function w(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,h.Ue)());const n=e;let o=.5*n.width*(i-1),s=.5*n.height*(i-1);return n.width<1e-7*n.height?o+=s/20:n.height<1e-7*n.width&&(s+=o/20),(0,a.s)(t,n.xmin-o-r,n.ymin-s-r,n.xmax+o+r,n.ymax+s+r),t}return null}function T(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(g.T.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[i],g.T.AUXPOS1))}}function b(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,l.d)(l.O);return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.O,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const n=new Array(3);if(null==t||null==i)n[0]=1,n[1]=1,n[2]=1;else{let r,o=0;for(let s=2;s>=0;s--){const a=e[s];let l;const c=null!=a,d=0===s&&!r&&!c,h=i[s];"symbol-value"===a||d?l=0!==h?t[s]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(n[s]=l,r=l,o=Math.max(o,Math.abs(l)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=r:0===n[e]&&(n[e]=.001*o)}for(let o=2;o>=0;o--)n[o]/=r;return(0,s.e)(n)}function x(e){return S(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function S(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function O(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.a)();return e&&(0,n.o)(r,r,-e/180*Math.PI),t&&(0,n.r)(r,r,t/180*Math.PI),i&&(0,n.n)(r,r,i/180*Math.PI),r}function A(e,t,i){if(null!=i.minDemResolution)return i.minDemResolution;const n=(0,r.c9)(t),o=(0,d.bf)(e)*n,s=(0,d.Ye)(e)*n,a=(0,d.Cb)(e)*(t.isGeographic?1:n);return 0===o&&0===s&&0===a?i.minDemResolutionForPoints:.01*Math.max(o,s,a)}},26279:(e,t,i)=>{var r,n,o;i.d(t,{Lw:()=>r,al:()=>o,eZ:()=>n}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},77648:(e,t,i)=>{i.d(t,{Fb:()=>o,KO:()=>s,sb:()=>n});var r=i(81020);class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=i}}function o(e){return"array"in e}function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,r.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(o(t)){var n;let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,null!==(n=t.spatialReference)&&void 0!==n?n:e.spatialReference,i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},50256:(e,t,i)=>{i.d(t,{K:()=>o});var r=i(8548),n=i(61109);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.stride;return Array.from(e.fields.keys()).map((r=>{const o=e.fields.get(r),a=o.constructor.ElementCount,l=s(o.constructor.ElementType),c=o.offset,d=!(!o.optional||!o.optional.glNormalized);return new n.G(r,a,l,c,i,d,t)}))}function s(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:r.g.UNSIGNED_BYTE,u16:r.g.UNSIGNED_SHORT,u32:r.g.UNSIGNED_INT,i8:r.g.BYTE,i16:r.g.SHORT,i32:r.g.INT,f32:r.g.FLOAT}},79685:(e,t,i)=>{i.d(t,{Y:()=>m});var r=i(88396),n=i(11186),o=i(71353),s=i(67077),a=i(83448),l=i(96334),c=i(86372),d=i(38461),h=i(39406),u=i(50951),p=i(91526),f=i(79100),v=i(95774),g=i(4760);function m(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=[],m=t.mapPositions;!function(e,t){const{attributeData:{position:i},removeDuplicateStartEnd:r}=e,n=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&r,o=i.length/3-(n?1:0),s=new Array(2*(o-1)),a=n?i.slice(0,-3):i;let l=0;for(let c=0;c<o-1;c++)s[l++]=c,s[l++]=c+1;t.push([g.T.POSITION,new p.a(a,s,3,n)])}(t,o);const w=o[0][1].data,T=o[0][1].indices.length,b=(0,h.LE)(T);return function(e,t,i){if(null!=e.attributeData.colorFeature)return;const r=e.attributeData.color;t.push([g.T.COLOR,new p.a(null!==r&&void 0!==r?r:s.O,i,4)])}(t,o,b),function(e,t,i){var r;null==e.attributeData.sizeFeature&&t.push([g.T.SIZE,new p.a([null!==(r=e.attributeData.size)&&void 0!==r?r:1],i,1,!0)])}(t,o,b),function(e,t,i){e.attributeData.normal&&t.push([g.T.NORMAL,new p.a(e.attributeData.normal,i,3)])}(t,o,b),function(e,t,i){null!=e.attributeData.colorFeature&&t.push([g.T.COLORFEATUREATTRIBUTE,new p.a([e.attributeData.colorFeature],i,1,!0)])}(t,o,b),function(e,t,i){null!=e.attributeData.sizeFeature&&t.push([g.T.SIZEFEATUREATTRIBUTE,new p.a([e.attributeData.sizeFeature],i,1,!0)])}(t,o,b),function(e,t,i){null!=e.attributeData.opacityFeature&&t.push([g.T.OPACITYFEATUREATTRIBUTE,new p.a([e.attributeData.opacityFeature],i,1,!0)])}(t,o,b),function(e,t,i){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==u.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;const o=(0,c.bg)(i.length),s=(0,a.Iu)(e.overlayInfo.spatialReference);for(let r=0;r<o.length;r+=3)(0,l.gH)(i,r,o,r,s);const h=i.length/3,f=(0,d.xx)(h+1);let v=_,m=y,w=0,T=0;(0,n.s)(v,o[T++],o[T++],o[T++]),f[0]=0;for(let a=1;a<h+1;++a)a===h&&(T=0),(0,n.s)(m,o[T++],o[T++],o[T++]),w+=(0,r.p)(v,m),f[a]=w,[v,m]=[m,v];t.push([g.T.DISTANCETOSTART,new p.a(f,t[0][1].indices,1,!0)])}(t,o,w),new v.Z(e,o,m,f.U.Line,i)}const _=(0,o.c)(),y=(0,o.c)()},2522:(e,t,i)=>{i.d(t,{M_:()=>s,OJ:()=>r,qO:()=>n,zA:()=>a});i(67794),i(8548),i(57808),i(52311);const r=64,n=r/2,o=n/5,s=r/o,a=.25},67794:(e,t,i)=>{i.d(t,{Rg:()=>l,cU:()=>c,hy:()=>a,wm:()=>s});i(93169);var r=i(46228),n=i(76873),o=i(8548);const s=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const i=d(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new n.x(i,{mipmap:!1,wrap:{s:o.e8.CLAMP_TO_EDGE,t:o.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const i=e/2-.5;return v(e,p(i,i,t/2))}(t,i);case"square":return function(e,t){return h(e,t,!1)}(t,i);case"cross":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!1,i)}(t,i,r);case"x":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!0,i)}(t,i,r);case"kite":return function(e,t){return h(e,t,!0)}(t,i);case"triangle":return function(e,t){return v(e,f(e/2,t,t/2))}(t,i);case"arrow":return function(e,t){const i=t,r=t/2,n=e/2,o=.8*i,s=p(n,(e-t)/2-o,Math.sqrt(o*o+r*r)),a=f(n,i,r);return v(e,((e,t)=>Math.max(a(e,t),-s(e,t))))}(t,i)}}function h(e,t,i){return i&&(t/=Math.SQRT2),v(e,((r,n)=>{let o=r-.5*e+.25,s=.5*e-n-.75;if(i){const e=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(s))-.5*t}))}function u(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return v(e,((t,o)=>{let s,a=t-.5*e,l=.5*e-o-1;if(i){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),s=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,s-=r/2,s}))}function p(e,t,i){return(r,n)=>{const o=r-e,s=n-t;return Math.sqrt(o*o+s*s)-i}}function f(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,o)=>{const s=Math.abs(n-e)-i,a=o-e+t/2+.75,l=(t*s+i*a)/r,c=-a;return Math.max(l,c)}}function v(e,t){const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let o=0;o<e;o++){const s=o+e*n;let a=t(o,n);a=a/e+.5,(0,r.I)(a,i,4*s)}return i}},78081:(e,t,i)=>{i.d(t,{V:()=>l,r:()=>c});var r=i(50628),n=i(86372),o=i(91320),s=i(69691),a=i(98061);function l(e,t,i,r){const a="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,o.Mk)(l,!!e.hasZ,a,e.spatialReference),u=(0,n.bg)(c.length),p=(0,s.rR)(c,e.spatialReference,0,u,0,c,0,c.length/3,t,i,r),f=null!=p;return{lines:f?d(h,c,u):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const i="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,n="polygon"===e.type?e.rings:e.paths,{position:s,outlines:l}=(0,o.Mk)(n,!1,i),c=(0,r.projectBuffer)(s,e.spatialReference,0,s,t,0,s.length/3);for(let r=2;r<s.length;r+=3)s[r]=a.gi;return{lines:c?d(l,s):[],projectionSuccess:c}}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new Array;for(const{index:o,count:s}of e){if(s<=1)continue;const e=3*o,a=3*s;r.push({position:(0,n.Rq)(t,3*o,3*s),mapPositions:null!=i?(0,n.Rq)(i,e,a):void 0})}return r}},98061:(e,t,i)=>{i.d(t,{gi:()=>oi});var r=i(27366),n=i(91505),o=i(77427),s=i(92026),a=i(27546),l=i(94172),c=i(92377),d=i(49861),h=(i(25243),i(63780)),u=i(93169),p=i(69912),f=i(14226),v=i(11186),g=i(71353),m=i(50951),_=i(26279),y=i(94463),w=i(54134),T=i(65156),b=i(61403);class C{constructor(){this._extent=(0,T.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,b.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new x}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,T.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,T.cv)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,T.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class x{constructor(){this.extents=[(0,T.Ue)(),(0,T.Ue)(),(0,T.Ue)()],this.numViews=0}}var S;!function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(S||(S={}));class O{constructor(e,t){this._fbos=e,this._format=t}get valid(){return null!=this._handle}dispose(){this._handle=(0,s.RY)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.colorTexture}bind(e,t,i){var r,n;this._handle&&this._handle.fbo.width===t&&this._handle.fbo.height===i||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._format,t,i)),e.bindFramebuffer(null===(n=this._handle)||void 0===n?void 0:n.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.colorTexture)||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.colorTexture)||void 0===t||t.generateMipmap())}}var A=i(64727),R=i(37081);class P{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.qz.RGBA_MIPMAP;this.output=t,this.content=i,this.fbo=new O(e,r)}get valid(){return this.fbo.valid}}class E{constructor(e){this.targets=[new P(e,R.H.Color,S.Color),new P(e,R.H.Color,S.ColorNoRasterImage),new P(e,R.H.Highlight,S.Highlight,A.qz.RGBA4),new P(e,R.H.Normal,S.WaterNormal),new P(e,R.H.Color,S.Occluded)],(0,u.Z)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new P(e,R.H.ObjectAndLayerIdColor,S.ObjectAndLayerIdColor))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,i)=>t.valid?e|=1<<i:e),0)}}var D,I=i(67077),M=i(85380);!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"}(D||(D={}));i(92395),i(41481),i(29078),i(61809),i(99340);var L;i(58406),i(98634),i(19253);!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(L||(L={}));(0,I.c)();var H=i(61863),F=i(59447),N=i(33559);class z{constructor(e){this._context=e,this._perConstructorInstances=new F.r,this._frameCounter=0,this._keepAliveFrameCount=U}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V;const i=t.key;let r=this._perConstructorInstances.get(e,i);if(null==r){const n=new e(this._context,t,(()=>this.release(n)));r=new j(n),this._perConstructorInstances.set(e,i,r)}return++r.refCount,r.technique}releaseAndAcquire(e,t,i){if(null!=i){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==U&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,i)=>{e.push((async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,i))})),await Promise.all(e)}}class j{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const U=-1,V=new N.m;var Z=i(70374),G=i(86755),B=i(32718),W=i(97731);class k{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new F.r}dispose(){this._textureRepository.destroy()}acquire(e,t,i){if(this._ownMaterial(e),!e.produces(t,i))return null;let r=this._id2glMaterialRef.get(i,e.id);if(null==r){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});r=new q(t),this._id2glMaterialRef.set(i,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);null!=i&&(i.unref(),i.referenced||((0,s.M2)(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&B.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class q{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,W.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var J=i(7566),Y=i(4760),X=i(8548),Q=i(61109);new Q.G(Y.T.POSITION,3,X.g.FLOAT,0,12),new Q.G(Y.T.POSITION,3,X.g.FLOAT,0,20),new Q.G(Y.T.UV0,2,X.g.FLOAT,12,20),new Q.G(Y.T.POSITION,3,X.g.FLOAT,0,32),new Q.G(Y.T.NORMAL,3,X.g.FLOAT,12,32),new Q.G(Y.T.UV0,2,X.g.FLOAT,24,32),new Q.G(Y.T.POSITION,3,X.g.FLOAT,0,16),new Q.G(Y.T.COLOR,4,X.g.UNSIGNED_BYTE,12,16),new Q.G(Y.T.POSITION,2,X.g.FLOAT,0,8),new Q.G(Y.T.POSITION,2,X.g.FLOAT,0,16),new Q.G(Y.T.UV0,2,X.g.FLOAT,8,16);var $=i(80658),K=i(44070),ee=i(57808),te=i(52311);var ie=i(19962),re=i(56529),ne=i(81949),oe=i(6394),se=i(5573),ae=i(83866),le=i(43565),ce=i(15226),de=i(68401),he=i(93822),ue=i(25920),pe=i(48919);class fe{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=he.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ue.A.NONE,this.alignPixelEnabled=!1,this.decorations=de.Iq.ON,this.overlayStretch=1,this._camera=new G.V,this._inverseViewport=(0,oe.a)(),this.oldLighting=new pe.c,this.newLighting=new pe.c,this._fadedLighting=new pe.c,this._lighting=this.newLighting,this.ssr=new ve,this.multipassEnabled=!1,this.multipassTerrain=new ce.a,this.multipassGeometry=new le._,this.hudRenderStyle=ae.U.Occluded,this.cloudsFade=new se.Kf}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(t,i,e),this._lighting=this._fadedLighting)}}class ve{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,ne.a)()}}class ge{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new G.V,this.output=R.H.Color,this.renderOccludedMask=me,this.bindParameters=new fe(t,null!=i?i.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=me}}const me=re.yD.Occlude|re.yD.OccludeAndTransparent|re.yD.OccludeAndTransparentStencil;var _e=i(16889),ye=i(11873),we=i(88396),Te=i(90045);let be=class extends G.V{constructor(){super(...arguments),this._projectionMatrix=(0,ne.a)()}get projectionMatrix(){return this._projectionMatrix}};(0,r._)([(0,d.Cb)()],be.prototype,"_projectionMatrix",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],be.prototype,"projectionMatrix",null),be=(0,r._)([(0,p.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],be);var Ce,xe=i(32251);!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(Ce||(Ce={}));class Se{constructor(){this.camera=new be,this.lightMat=(0,ne.a)()}}class Oe{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ae{get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,Te.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Oe,this._projectionView=(0,ne.a)(),this._projectionViewInverse=(0,ne.a)(),this._modelViewLight=(0,ne.a)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,I.c)(),this._cascades=[new Se,new Se,new Se,new Se],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,u.Z)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=(0,s.RY)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,_e.uZ)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)Ne[e]=this._cascades[e];return Ne.length=this._numCascades,Ne}start(e,t,i,r,n){(0,W.hu)(this.enabled);const{near:o,far:s}=this._clampNearFar(i);this._computeCascadeDistances(o,s,r),this._textureHeight=this._computeTextureHeight(e,n,r),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,a,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,W.hu)(this.enabled),null===(e=this._handle)||void 0===e||e.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,v.h)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,g.c)(),(0,v.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,f.w)(ze,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)je[16*t+e]=ze[e]}}return je}moveSnapshot(e){var t,i;(0,W.hu)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.releaseDepth(),null!==(i=this._snapshots[e])&&void 0!==i&&i.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){var t,i,r;const n=null===(t=this._handle)||void 0===t||null===(t=t.colorTexture)||void 0===t?void 0:t.descriptor;if(!this.enabled||!n)return;null===(i=this._snapshots[e])||void 0===i||i.release();const{width:o,height:s}=n;this._snapshots[e]=this._fbos.acquire(A.qz.RGBA4,o,s);const a=this._fbos.rctx;this._bindFbo();const l=a.bindTexture(null===(r=this._snapshots[e])||void 0===r?void 0:r.colorTexture,ee.x.TEXTURE_UNIT_FOR_UPDATES);a.gl.copyTexSubImage2D(X.No.TEXTURE_2D,0,0,0,0,0,o,s),a.bindTexture(l,ee.x.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(X.lk.COLOR_BUFFER_BIT|X.lk.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,i){const r=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,xe.nq)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*r*n));return Math.min(this._maxTextureWidth,this._numCascades*o)/this._numCascades}_ensureFbo(){var e,t,i;(null===(e=this._handle)||void 0===e?void 0:e.fbo.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(i=this._handle)&&void 0!==i&&i.release(),this._handle=this._fbos.acquire(A.qz.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(A.qk.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,s.RY)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;const t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,i,r){const n=this._cascades[e],o=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],a=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,W.hu)(a<l);for(let u=0;u<8;++u){(0,Te.s)(Pe,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?a:l,1);const e=Ee[u];(0,Te.t)(e,Pe,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,v.E)(Fe,Ee[0]),n.camera.viewMatrix=(0,f.w)(Re,this._modelViewLight,Fe);for(let u=0;u<8;++u)(0,v.e)(Ee[u],Ee[u],n.camera.viewMatrix);let c=Ee[0][2],d=Ee[0][2];for(let u=1;u<8;++u)c=Math.min(c,Ee[u][2]),d=Math.max(d,Ee[u][2]);c-=200,d+=200,n.camera.near=-d,n.camera.far=-c,function(e,t,i,r,n){const o=1/Ee[0][3],s=1/Ee[4][3];(0,W.hu)(o<s);let a=o+Math.sqrt(o*s);const l=Math.sin((0,_e.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,i,r,n,o,s,a){(0,we.s)(Ue,0,0);for(let T=0;T<4;++T)(0,we.i)(Ue,Ue,e[T]);(0,we.a)(Ue,Ue,.25),(0,we.s)(Ve,0,0);for(let T=4;T<8;++T)(0,we.i)(Ve,Ve,e[T]);(0,we.a)(Ve,Ve,.25),(0,we.l)(Ze[0],e[4],e[5],.5),(0,we.l)(Ze[1],e[5],e[6],.5),(0,we.l)(Ze[2],e[6],e[7],.5),(0,we.l)(Ze[3],e[7],e[4],.5);let l=0,c=(0,we.k)(Ze[0],Ue);for(let T=1;T<4;++T){const e=(0,we.k)(Ze[T],Ue);e<c&&(c=e,l=T)}(0,we.c)(Ge,Ze[l],e[l+4]);const d=Ge[0];let h,u;Ge[0]=-Ge[1],Ge[1]=d,(0,we.c)(Be,Ve,Ue),(0,we.g)(Be,Ge)<0&&(0,we.n)(Ge,Ge),(0,we.l)(Ge,Ge,Be,i),(0,we.e)(Ge,Ge),h=u=(0,we.g)((0,we.c)(We,e[0],Ue),Ge);for(let T=1;T<8;++T){const t=(0,we.g)((0,we.c)(We,e[T],Ue),Ge);t<h?h=t:t>u&&(u=t)}(0,we.j)(r,Ue),(0,we.a)(We,Ge,h-t),(0,we.i)(r,r,We);let p=-1,f=1,v=0,g=0;for(let T=0;T<8;++T){(0,we.c)(ke,e[T],r),(0,we.e)(ke,ke);const t=Ge[0]*ke[1]-Ge[1]*ke[0];t>0?t>p&&(p=t,v=T):t<f&&(f=t,g=T)}(0,W.T)(p>0,"leftArea"),(0,W.T)(f<0,"rightArea"),(0,we.a)(qe,Ge,h),(0,we.i)(qe,qe,Ue),(0,we.a)(Je,Ge,u),(0,we.i)(Je,Je,Ue),Ye[0]=-Ge[1],Ye[1]=Ge[0];const m=(0,W.ep)(r,e[g],Je,(0,we.i)(We,Je,Ye),1,n),_=(0,W.ep)(r,e[v],Je,We,1,o),y=(0,W.ep)(r,e[v],qe,(0,we.i)(We,qe,Ye),1,s),w=(0,W.ep)(r,e[g],qe,We,1,a);(0,W.T)(m,"rayRay"),(0,W.T)(_,"rayRay"),(0,W.T)(y,"rayRay"),(0,W.T)(w,"rayRay")}(Ee,a,l,De,Ie,Me,Le,He),function(e,t,i,r,n){(0,we.c)(Ke,i,r),(0,we.a)(Ke,Ke,.5),et[0]=Ke[0],et[1]=Ke[1],et[2]=0,et[3]=Ke[1],et[4]=-Ke[0],et[5]=0,et[6]=Ke[0]*Ke[0]+Ke[1]*Ke[1],et[7]=Ke[0]*Ke[1]-Ke[1]*Ke[0],et[8]=1,et[Xe(0,2)]=-(0,we.g)($e(et,0),e),et[Xe(1,2)]=-(0,we.g)($e(et,1),e);let o=(0,we.g)($e(et,0),i)+et[Xe(0,2)],s=(0,we.g)($e(et,1),i)+et[Xe(1,2)],a=(0,we.g)($e(et,0),r)+et[Xe(0,2)],l=(0,we.g)($e(et,1),r)+et[Xe(1,2)];o=-(o+a)/(s+l),et[Xe(0,0)]+=et[Xe(1,0)]*o,et[Xe(0,1)]+=et[Xe(1,1)]*o,et[Xe(0,2)]+=et[Xe(1,2)]*o,o=1/((0,we.g)($e(et,0),i)+et[Xe(0,2)]),s=1/((0,we.g)($e(et,1),i)+et[Xe(1,2)]),et[Xe(0,0)]*=o,et[Xe(0,1)]*=o,et[Xe(0,2)]*=o,et[Xe(1,0)]*=s,et[Xe(1,1)]*=s,et[Xe(1,2)]*=s,et[Xe(2,0)]=et[Xe(1,0)],et[Xe(2,1)]=et[Xe(1,1)],et[Xe(2,2)]=et[Xe(1,2)],et[Xe(1,2)]+=1,o=(0,we.g)($e(et,1),t)+et[Xe(1,2)],s=(0,we.g)($e(et,2),t)+et[Xe(2,2)],a=(0,we.g)($e(et,1),i)+et[Xe(1,2)],l=(0,we.g)($e(et,2),i)+et[Xe(2,2)],o=-.5*(o/s+a/l),et[Xe(1,0)]+=et[Xe(2,0)]*o,et[Xe(1,1)]+=et[Xe(2,1)]*o,et[Xe(1,2)]+=et[Xe(2,2)]*o,o=(0,we.g)($e(et,1),t)+et[Xe(1,2)],s=(0,we.g)($e(et,2),t)+et[Xe(2,2)],a=-s/o,et[Xe(1,0)]*=a,et[Xe(1,1)]*=a,et[Xe(1,2)]*=a,n[0]=et[0],n[1]=et[1],n[2]=0,n[3]=et[2],n[4]=et[3],n[5]=et[4],n[6]=0,n[7]=et[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=et[6],n[13]=et[7],n[14]=0,n[15]=et[8]}(De,Ie,Le,He,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}(i,r,c,d,n.camera),(0,f.m)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureHeight;n.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,f.m)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,f.i)(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===m.JY.Global?e.eye:(0,v.s)(Fe,0,0,1);(0,f.u)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],i)}_clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}_computeCascadeDistances(e,t,i){const r=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,W.E6)(t/e,4)),r);const n=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let s=e,a=e;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=(0,_e.t7)(s,a,this.settings.splitSchemeLambda),s*=o,a+=n}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const Re=(0,ne.a)(),Pe=(0,I.c)(),Ee=[];for(let ai=0;ai<8;++ai)Ee.push((0,I.c)());const De=(0,oe.a)(),Ie=(0,oe.a)(),Me=(0,oe.a)(),Le=(0,oe.a)(),He=(0,oe.a)(),Fe=(0,g.c)(),Ne=[],ze=(0,ne.a)(),je=ne.I.concat(ne.I,ne.I,ne.I,ne.I),Ue=(0,oe.a)(),Ve=(0,oe.a)(),Ze=[(0,oe.a)(),(0,oe.a)(),(0,oe.a)(),(0,oe.a)()],Ge=(0,oe.a)(),Be=(0,oe.a)(),We=(0,oe.a)(),ke=(0,oe.a)(),qe=(0,oe.a)(),Je=(0,oe.a)(),Ye=(0,oe.a)();function Xe(e,t){return 3*t+e}const Qe=(0,oe.a)();function $e(e,t){return(0,we.s)(Qe,e[t],e[t+3]),Qe}const Ke=(0,oe.a)(),et=(0,ye.a)();var tt=i(7138),it=i(54463),rt=i(55848);i(22178);class nt extends rt.Dx{constructor(e,t,i){super(e,t),this.triangleNr=i}}class ot{constructor(){this.adds=new a.Z,this.removes=new a.Z,this.updates=new a.Z({allocator:e=>e||new st,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class st{}class at{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var lt=i(88153),ct=i(78289);function dt(e){return e.geometry.indexCount>=1}var ht=i(50256),ut=i(94425);class pt extends M.Pf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,g.c)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}var ft=i(47475);class vt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function gt(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;)i=!1,e.forEach((r=>{const n=t.get(r.to);n&&(r.to=n.to,t.delete(n.from),e.removeUnordered(n),i=!0)}))}class mt extends vt{constructor(e,t,i){super(t,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class _t{constructor(){this.first=0,this.count=0}}class yt{constructor(){this._numElements=0,this._instances=new Map,this.holes=new a.Z({allocator:e=>e||new vt,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=wt(),this.drawCommandsHighlight=wt(),this.drawCommandsOccludees=wt(),this.drawCommandsShadowHighlightRest=wt()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,i){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=i,this._numElements+=r.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),i=this.holes.front();return null!=this.vao&&1===this.holes.length&&i.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=i.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const i of t)i.isVisible&&(Tt(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Tt(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function wt(){return new a.Z({allocator:e=>e||new _t,deallocator:e=>e})}function Tt(e,t){const i=e.back();if(null==i){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.numElements;i.count=e}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}class bt{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var Ct=i(18759),xt=i(76861);const St=Ct.o1+1;class Ot{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=new xt.N(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let i=this._cache.pop(t);return i||(i=new $.U(this._rctx,this._locations,{geometry:this._layout},{geometry:K.f.createVertex(this._rctx,X.l1.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e,St)}}let At=class extends Z.He{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=(0,s.M2)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,s.M2)(this._vaoCache)}initializeRenderContext(e,t){const{rctx:i}=e.renderContext;this._glMaterials=new ut.p(this.material,null!==t&&void 0!==t?t:e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new Ot(i,this.material.vertexAttributeLocations,(0,ht.K)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof ft.H}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==re.yD.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),o=null===n||void 0===n?void 0:n.findBuffer(e.id);if(null==o)return;const s=o.instances.get(e.id);if(r.updateType&(ct.$.GEOMETRY|ct.$.TRANSFORMATION)){const r=Ut(t.elementCount(s.geometry.geometry)*i),n=t.vertexBufferLayout.createView(r.buffer);this._writeGeometry(e,n,0),o.vao.vertexBuffers.geometry.setSubData(r,s.from*i,0,s.numElements*i)}r.updateType&(ct.$.HIGHLIGHT|ct.$.OCCLUDEE|ct.$.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){const i=new F.r;for(const r of e){const e=r.localOrigin;if(null==e)continue;let t=i.get(e.id,null);null==t&&(t=new Rt(e.vec3),i.set(e.id,null,t)),t.changes.push(r)}for(const r of t){const e=r.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=null===t||void 0===t?void 0:t.findBuffer(r.id);if(null==n)continue;let o=i.get(e.id,n);null==o&&(o=new Rt(e.vec3),i.set(e.id,n,o)),o.changes.push(r)}return i}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:i,_dataByOrigin:r}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const s=e.get(null),a=null!=s?s.changes:[];o.delete(t,null);let l=r.get(t);if(e.forEach(((e,s)=>{if(o.delete(t,s),null==s)return void(0,W.hu)(!1,"No VAO for removed geometries");if(s.instances.size===e.changes.length)return this._vaoCache.deleteVao(s.vao),(0,h.e$)(l.buffers,s),void(0===l.buffers.length&&0===a.length&&r.delete(t));const c=s.numElements,d=s.vao.byteSize/4,u=a.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),p=e.changes.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),f=Math.min((c+u-p)*n,zt),v=f>d;f>Lt&&f<d/2?(e.changes.forEach((e=>{let{id:t}=e;return s.deleteInstance(t)})),s.instances.forEach((e=>{let{geometry:t}=e;return a.push(t)})),this._vaoCache.deleteVao(s.vao),(0,h.e$)(l.buffers,s)):v?this._applyAndRebuild(s,a,e):this._applyRemoves(s,e)})),a.length>0)for(null==l&&(l=new bt(s.origin),r.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new yt,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,o.oE)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,i){if(null!=i)for(const p of i.changes)e.deleteInstance(p.id);const r=this._bufferWriter,n=r.vertexBufferLayout.stride,o=n/4,s=Math.floor(zt/o);let a=e.numElements;for(;t.length>0;){const i=t.pop(),n=r.elementCount(i.geometry);if(a+n>s&&a>0){t.push(i);break}a+=n;const o=new mt(i,0,0);(0,W.hu)(null==e.instances.get(i.id)),e.addInstance(i.id,o)}const l=a*o,c=Ut(l),d=r.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,i)=>{this._writeGeometry(t.geometry,d,h);const n=h;h+=r.elementCount(t.geometry.geometry),e.updateInstance(i,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Vt(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*o),e.holes.clear();const u=e.holes.pushNew();return u.from=h,u.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const s of t.changes){const t=s.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const r=Mt.back();if(r){if(r.to===i.from){r.to=i.to;continue}if(r.from===i.to){r.from=i.from;continue}}const n=Mt.pushNew();n.from=i.from,n.to=i.to}gt(Mt);const i=this._bufferWriter.vertexBufferLayout.stride/4,r=Mt.reduce(((e,t)=>Math.max(e,t.numElements)),0)*i,n=Ut(r);n.fill(0,0,r);const o=e.vao.vertexBuffers.geometry;Mt.forAll((e=>o.setSubData(n,e.from*i,0,e.numElements*i))),e.holes.pushArray(Mt.data,Mt.length),Mt.forAll(((e,t)=>Mt.data[t]=null)),Mt.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=e.numElements,o=t.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),s=Math.min((n+o)*r,zt),a=4*s;if(e.vao.byteSize<Vt(zt-Lt)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);gt(e.holes);const l=new Array;for(const h of t){const t=i.elementCount(h.geometry),r=Pt(e.holes,t);l.push(r)}const c=e.vao.vertexBuffers.geometry;let d=0,u=0,p=0;const f=Ut(s),v=i.vertexBufferLayout.createView(f.buffer);t.forEach(((t,n)=>{const o=l[n];if(null==o)return;if(p!==o){const e=p-u;e>0&&c.setSubData(f,u*r,0,e*r),u=o,d=0}const s=i.elementCount(t.geometry);this._writeGeometry(t,v,d),d+=s,p=o+s;const a=new mt(t,o,o+s);(0,W.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=p-u;g>0&&c.setSubData(f,u*r,0,g*r),(0,h.hv)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,i){if(null===this._bufferWriter)return;const r=e.localOrigin.vec3;(0,W.u_)(Et,-r[0],-r[1],-r[2]);const n=(0,f.m)(Dt,Et,e.transformation);(0,f.i)(It,n),(0,f.t)(It,It),this._bufferWriter.write(n,It,e.geometry,t,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:i}=e;if(!this.material.produces(i.slot,t))return null;const r=t===R.H.Highlight||t===R.H.ShadowHighlight;if(r&&!this._hasHighlights)return null;const n=t===R.H.ShadowExcludeHighlight,o=!(r||n);for(const s of this._dataByOrigin.values())for(const a of s.buffers){if(r&&!a.hasHighlights)continue;const s=(r?a.drawCommandsHighlight:n&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null,l=o&&a.drawCommandsOccludees||null;if(null!==s&&void 0!==s&&s.length||null!==l&&void 0!==l&&l.length){const r=this._glMaterials.load(e.rctx,i.slot,t),n=null!=r?r.beginSlot(i):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:i,bindParameters:r}=e,n=i===R.H.Highlight||i===R.H.ShadowHighlight,o=i===R.H.ShadowExcludeHighlight,s=!(n||o),a=e.rctx,l=e.bindParameters.slot===he.r.OCCLUDER_MATERIAL,c=e.bindParameters.slot===he.r.TRANSPARENT_OCCLUDER_MATERIAL;a.runAppleAmdDriverHelper(),a.bindTechnique(t,this.material.parameters,r);for(const d of this._dataByOrigin.values())for(const e of d.buffers){if(n&&!e.hasHighlights)continue;const i=(n?e.drawCommandsHighlight:o&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=s&&e.drawCommandsOccludees||null;(null!==i&&void 0!==i&&i.length||null!==h&&void 0!==h&&h.length)&&(t.program.bindDraw(new pt(d.origin),r,this.material.parameters),t.ensureAttributeLocations(e.vao),a.bindVAO(e.vao),null!==i&&void 0!==i&&i.length&&(a.setPipelineState(t.getPipeline(!1,l,c)),i.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))),(null===h||void 0===h?void 0:h.length)&&(a.setPipelineState(t.getPipeline(!0,l,c)),h.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};(0,r._)([(0,d.Cb)({constructOnly:!0})],At.prototype,"material",void 0),At=(0,r._)([(0,p.j)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],At);class Rt{constructor(e){this.origin=e,this.changes=new Array}}function Pt(e,t){let i;if(!e.some((e=>!(e.numElements<t)&&(i=e,!0))))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}const Et=(0,ne.a)(),Dt=(0,ne.a)(),It=(0,ne.a)(),Mt=new a.Z({allocator:e=>e||new vt,deallocator:null}),Lt=65536,Ht=4*Lt,Ft=1024,Nt=16777216,zt=Nt/4;let jt=new Float32Array(Lt);function Ut(e){return jt.length<e&&(jt=new Float32Array(e)),jt}function Vt(e){const t=4*e;return t<=Ft?Ft:t<Ht?(0,_e.Sf)(t):Math.max(Math.min(Math.ceil(1.5*t/Ht)*Ht,Nt),t)}let Zt=class extends tt.Z{constructor(e){super(e),this._pending=new Gt,this._changes=new ot,this._materialRenderers=new a.Z,this._sortedMaterialRenderers=new a.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some((e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(e){var t;if(null==e)return 0;const i=this._materialRenderers.find((t=>t.material===e));return null!==(t=null===i||void 0===i?void 0:i.usedMemory)&&void 0!==t?t:0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=function(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new at,t.set(e,i)),i};return e.removes.forAll((e=>{dt(e)&&i(e.material).removes.push(e)})),e.adds.forAll((e=>{dt(e)&&i(e.material).adds.push(e)})),e.updates.forAll((e=>{dt(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes);let t=!1,i=!1,r=!1;return e.forEach(((e,n)=>{let o=this._materialRenderers.find((e=>e.material===n));if(!o&&e.adds.length>0){const e=new At({material:n});e.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),o=e,this._materialRenderers.push(o),t=!0,i=!0,r=!0}if(!o)return;const s=i||o.hasHighlights,a=r||o.hasWater;o.modify(e),i=i||s!==o.hasHighlights,r=r||a!==o.hasWater,o.isEmpty&&(this._materialRenderers.removeUnordered(o),o.dispose(),t=!0)})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=this._materialRenderers.some((e=>e.hasHighlights))),r&&(this._hasWater=this._materialRenderers.some((e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const r=this._pending.empty;for(const n of i)this._pending.adds.add(n);r&&this.notifyChange("updating"),t===ct.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const n of e)r.has(n)?(this._pending.removed.add(n),r.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===ct.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ct.$.TRANSFORMATION:case ct.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case ct.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((i=>t=i.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const i=t.prepareTechnique(e);null!=i&&t.renderNode(e,i)}))}intersect(e,t,i,r,n){return this._geometries.forEach((o=>{if(r&&!r(o))return;this._intersectRenderGeometry(o,i,t,0,e,n);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,i,t,s.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,i,t,-s.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll(((e,t)=>{e.priority=t,this._sortedMaterialRenderers.push(e)})),this._sortedMaterialRenderers.sort(((e,t)=>t.material.renderPriority===e.material.renderPriority?e.priority-t.priority:t.material.renderPriority-e.material.renderPriority))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,n,o){if(!e.visible)return;let s=0;r+=e.transformation[12],s=e.transformation[13],Bt[0]=i[0]-r,Bt[1]=i[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Bt,((i,r,s)=>{!function(e,t,i,r,n,o,s){const a=new nt(o,s,t),l=t=>{t.set(it.q7.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==it.eC.MIN&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===it.eC.ALL){const e=(0,lt.LP)(n.ray);l(e),n.results.all.push(e)}}(t,s,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const i of e){const e=i.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const i of e){const e=i.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,r._)([(0,d.Cb)()],Zt.prototype,"drapeSource",void 0),(0,r._)([(0,d.Cb)()],Zt.prototype,"updating",null),(0,r._)([(0,d.Cb)()],Zt.prototype,"rctx",null),(0,r._)([(0,d.Cb)({constructOnly:!0})],Zt.prototype,"rendererContext",void 0),(0,r._)([(0,d.Cb)()],Zt.prototype,"_materialRepository",null),(0,r._)([(0,d.Cb)()],Zt.prototype,"_localOriginFactory",null),(0,r._)([(0,d.Cb)({readOnly:!0})],Zt.prototype,"isEmpty",null),(0,r._)([(0,d.Cb)()],Zt.prototype,"_materialRenderers",void 0),(0,r._)([(0,d.Cb)()],Zt.prototype,"_geometries",void 0),Zt=(0,r._)([(0,p.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Zt);class Gt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Bt=(0,oe.a)();var Wt=i(82144),kt=i(31132),qt=i(27627),Jt=i(36207);class Yt extends kt.A{initializeProgram(e){return new qt.$(e.rctx,Yt.shader.get().build(),J.i)}initializePipeline(){return this.configuration.hasAlpha?(0,Jt.sm)({blending:(0,Jt.wK)(X.zi.SRC_ALPHA,X.zi.ONE,X.zi.ONE_MINUS_SRC_ALPHA,X.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Jt.BK}):(0,Jt.sm)({colorWrite:Jt.BK})}}Yt.shader=new Wt.J(H.a,(()=>i.e(7026).then(i.bind(i,77026))));class Xt extends N.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,r._)([(0,N.o)()],Xt.prototype,"hasAlpha",void 0);var Qt=i(78485),$t=i(11954),Kt=i(38365);class ei extends kt.A{initializeProgram(e){return new qt.$(e.rctx,ei.shader.get().build(),J.i)}initializePipeline(){return(0,Jt.sm)({blending:(0,Jt.if)(X.zi.ONE,X.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Jt.BK})}}ei.shader=new Wt.J(Kt.a,(()=>i.e(6487).then(i.bind(i,46487))));var ti=i(99912);let ii=class extends Z.tY{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Kt.O,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new a.Z,this._passParameters=new H.T,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new G.V,this.worldToPCSRatio=1,this.events=new n.Z,this.longitudeCyclical=null,this.produces=new Map([[he.r.DRAPED_MATERIAL,e=>e!==R.H.Highlight||this.hasHighlights],[he.r.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextureRepository:i,stippleTextureRepository:r,markerTextureRepository:n}=t;this._shaderTechniqueRepository=new z({rctx:this._rctx,viewingMode:m.JY.Local,stippleTextureRepository:r,markerTextureRepository:n,waterTextureRepository:i}),this._renderContext=new ge(this._rctx,new Ae(e,this.view.state.viewingMode),null),this.addHandles([(0,l.YP)((()=>i.updating),(()=>this.events.emit("content-changed")),l.tX),(0,l.YP)((()=>this.spatialReference),(e=>this._localOriginFactory=new ie.C(e)),l.tX),(0,l.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new k(t.textureRepository,this._shaderTechniqueRepository,(e=>{(e.parameters.renderOccluded&si)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=he.r.DRAPED_MATERIAL,this._bindParameters.mainDepth=function(e){const t=new te.X(1);return t.samplingMode=X.cw.NEAREST,new ee.x(e,t,new Uint8Array([255,255,255,255]))}(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ue.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new $t.Mi((0,g.f)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(ti.T8.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,s.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,s.M2)(this._passParameters.texture),this._bindParameters.mainDepth=(0,s.M2)(this._bindParameters.mainDepth),this._shaderTechniqueRepository=(0,s.SC)(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,o.oE)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce(((t,i)=>t+i.getMemoryForMaterial(e)),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Zt)}createDrapeSourceRenderer(e,t,i){const r=this._renderers.get(e);null!=r&&r.destroy();const n=new t({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,l.YP)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,c.fn)(e,(e=>e.drapeTargetType===_.al.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,c.fn)(e,(e=>e.drapeSourceType===_.Lw.Features)),this._hasDrapedRasterSource=(0,c.fn)(e,(e=>e.drapeSourceType===_.Lw.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new E(this.view._stage.renderer.fboCache),this._overlays=[new C,new C]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=(0,s.M2)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,i;if(null!=e)return e===S.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(S.Color):null===(i=this._renderTargets)||void 0===i?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let i=!1;for(const[r,n]of this._renderers){if(e.done)break;(r.destroyed||t(r))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,o.oE)(this._renderers,(e=>e.hasHighlights)),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ti.G5,(e=>e.updatePolicy===Qt.j.SYNC))}get isEmpty(){return!y.h.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,o.oE)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){var e,t;return this.isEmpty?L.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(S.WaterNormal)?L.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture(S.Color)?L.Enabled:L.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((i=>t=i.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets)(t.content!==S.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(w.fu.INNER,t,e),this._drawTarget(w.fu.OUTER,t,e))}}_drawTarget(e,t,i){const r=this._overlays[e],n=r.canvasGeometries;if(0===n.numViews)return;const{alignPixelEnabled:o,contentPixelRatio:s}=i;this._screenToWorldRatio=s*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===R.H.Highlight&&!this.hasHighlights||a===R.H.Normal&&!this.hasWater||!r.hasSomeSizedView())return;const l=this._rctx;this._camera.pixelRatio=r.pixelRatio*s,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===R.H.Normal?he.r.DRAPED_WATER:he.r.DRAPED_MATERIAL;const c=y.h.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==S.Occluded;if(!c&&!this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)})))return;const d=r.resolution;this._rctx.setViewport(e===w.fu.INNER?0:d,0,d,d);const h=2*r.resolution,u=r.resolution,p=t.fbo;if(p.bind(l,h,u),e===w.fu.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(X.lk.COLOR_BUFFER_BIT)),t.content===S.Occluded&&(this._renderContext.renderOccludedMask=si),c)for(let f=0;f<n.numViews;f++)this._setViewParameters(n.extents[f],r),this._ensureDebugPatternResources(r.resolution,ni[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll((i=>{let{drapeSource:o,renderer:s}=i;if(t.content===S.ColorNoRasterImage&&o.drapeSourceType===_.Lw.RasterImage)return;const{fullOpacity:c}=o,d=null!=c&&c<1&&a===R.H.Color?this.bindTemporaryFramebuffer(h,u):null;for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],r),s.render(this._renderContext);if(d){p.bind(l,h,u),this._overlayParameters.texture=d.colorTexture,this._overlayParameters.opacity=c,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniqueRepository.acquire(ei);this._rctx.bindTechnique(t,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),t.release(),d.release()}})),l.bindFramebuffer(null),e===w.fu.OUTER&&p.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,t){const i=this.view._stage.renderer.fboCache,r=i.acquire(A.qz.RGBA,e,t);return i.rctx.bindFramebuffer(r.fbo),i.rctx.clearSafe(X.lk.COLOR_BUFFER_BIT),r}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){let n=0;for(const a of this._renderers.values()){var o,s;n=null!==(o=null===(s=a.intersect)||void 0===s?void 0:s.call(a,e,t,i,r,n))&&void 0!==o?o:n}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers;this._renderers.forEach(((t,i)=>{var r;const n=e.indexOf(i.layer),o=n>=0,s=this._renderers.size*(null!==(r=i.renderGroup)&&void 0!==r?r:o?_.eZ.MapLayer:_.eZ.ViewLayer)+(o?n:0);this._sortedRenderers.push(new ri(i,t,s))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const i=this._camera;i.viewport=[0,0,t.resolution,t.resolution],(0,f.x)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),(0,f.d)(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,o.oE)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=(0,o.oE)(this._renderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,t){if((0,v.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let r=0;for(let s=0;s<e;s++)for(let t=0;t<e;t++){const n=Math.floor(t/10),o=Math.floor(s/10);n<2||o<2||10*n>e-20||10*o>e-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&n&&1&o?1&t^1&s?0:255:1&n^1&o?0:128)}const n=new te.X(e);n.samplingMode=X.cw.NEAREST,this._passParameters.texture=new ee.x(this._rctx,n,i);const o=new Xt;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Yt,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};(0,r._)([(0,d.Cb)()],ii.prototype,"hasHighlights",void 0),(0,r._)([(0,d.Cb)()],ii.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,r._)([(0,d.Cb)({autoDestroy:!0})],ii.prototype,"_shaderTechniqueRepository",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],ii.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],ii.prototype,"worldToPCSRatio",void 0),(0,r._)([(0,d.Cb)()],ii.prototype,"spatialReference",void 0),(0,r._)([(0,d.Cb)({type:Boolean,readOnly:!0})],ii.prototype,"updating",null),(0,r._)([(0,d.Cb)()],ii.prototype,"isEmpty",null),ii=(0,r._)([(0,p.j)("esri.views.3d.terrain.OverlayRenderer")],ii);class ri{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const ni=[[1,.5,.5],[.5,.5,1]],oi=-2,si=re.yD.OccludeAndTransparent},54134:(e,t,i)=>{var r,n,o,s;i.d(t,{fu:()=>r}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}))},48353:(e,t,i)=>{i.d(t,{U:()=>m});var r,n,o,s,a,l,c=i(30168),d=i(18607),h=i(49450),u=i(58406),p=i(699),f=i(98634),v=i(4760);const g=8;function m(e,t){const i=e.vertex;i.uniforms.add(new u.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(v.T.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new h.J("vvSizeMinSize",(e=>e.vvSize.minSize)),new h.J("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new h.J("vvSizeOffset",(e=>e.vvSize.offset)),new h.J("vvSizeFactor",(e=>e.vvSize.factor))),i.code.add((0,f.H)(r||(r=(0,c.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(v.T.SIZE,"float"),i.code.add((0,f.H)(n||(n=(0,c.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(v.T.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new p.O("vvOpacityValues",(e=>e.vvOpacity.values),g),new p.O("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),g)),i.code.add((0,f.H)(o||(o=(0,c.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):i.code.add((0,f.H)(s||(s=(0,c.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(d.k,t),e.attributes.add(v.T.COLORFEATUREATTRIBUTE,"float"),i.code.add((0,f.H)(a||(a=(0,c.Z)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(v.T.COLOR,"vec4"),i.code.add((0,f.H)(l||(l=(0,c.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:(e,t,i)=>{i.d(t,{H:()=>l});var r,n,o=i(30168),s=i(13773),a=i(98634);function l(e){e.uniforms.add(new s.U("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add((0,a.H)(r||(r=(0,o.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])))),e.code.add((0,a.H)(n||(n=(0,o.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))))}},81879:(e,t,i)=>{i.d(t,{R:()=>y,c:()=>_});var r,n,o,s,a,l,c,d=i(30168),h=i(49223),u=i(62993),p=i(82552),f=i(95276),v=i(58406),g=i(98634),m=i(4760);const _=.5;function y(e,t){e.include(u.cK),e.attributes.add(m.T.POSITION,"vec3"),e.attributes.add(m.T.NORMAL,"vec3"),e.attributes.add(m.T.AUXPOS1,"vec4");const i=e.vertex;(0,p.Sv)(i,t),(0,p.hY)(i,t),i.uniforms.add(new f.N("viewport",((e,t)=>t.camera.fullViewport)),new v.p("polygonOffset",(e=>e.shaderPolygonOffset)),new v.p("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,h.V)(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add((0,g.H)(r||(r=(0,d.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),i.code.add((0,g.H)(n||(n=(0,d.Z)(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = ",";\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is\n      // dropped is instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])),t.multipassEnabled?g.H.float(0):(0,g.H)(o||(o=(0,d.Z)(["sign(pointGroundDistance)"]))))),t.draped&&!t.hasVerticalOffset||(0,p._8)(i),t.draped||(i.uniforms.add(new v.p("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),i.code.add((0,g.H)(s||(s=(0,d.Z)(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * ",";\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])),g.H.float(_)))),t.screenCenterOffsetUnitsEnabled&&(0,p.ZI)(i),t.hasScreenSizePerspective&&(0,u.m8)(i),i.code.add((0,g.H)(a||(a=(0,d.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.\n      // It also pulls the label towards the viewer so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,g.H)(l||(l=(0,d.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled?"":(0,g.H)(c||(c=(0,d.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))),t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""))}},50913:(e,t,i)=>{i.d(t,{R:()=>u});var r,n,o,s,a=i(30168),l=i(28156),c=i(43565),d=i(15226),h=i(98634);function u(e,t){const{vertex:i,fragment:u}=e;i.include(l.H),t.multipassEnabled&&(i.include(c.S),e.varyings.add("depth","float")),i.code.add((0,h.H)(r||(r=(0,a.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassEnabled?(0,h.H)(n||(n=(0,a.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassEnabled?"depth = projectAux.posView.z;":"")),e.include(d.l,t),u.code.add((0,h.H)(o||(o=(0,a.Z)(["\n  void main() {\n    fragColor = vec4(1);\n    ","\n  }\n  "])),t.multipassEnabled?(0,h.H)(s||(s=(0,a.Z)(["\n        if(terrainDepthTest(depth)) {\n          fragColor.g = 0.5;\n        }"]))):""))}},83866:(e,t,i)=>{var r;i.d(t,{U:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},55616:(e,t,i)=>{i.d(t,{P:()=>h});var r,n=i(30168),o=i(28156),s=i(83866),a=i(95276),l=i(58406),c=i(98634),d=i(19253);function h(e){e.vertex.uniforms.add(new l.p("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===s.U.Occluded?1:t.hudRenderStyle===s.U.NotOccluded?0:.75)),new a.N("viewport",((e,t)=>t.camera.fullViewport)),new d.A("hudVisibilityTexture",((e,t)=>{var i;return null===(i=t.hudVisibility)||void 0===i?void 0:i.colorTexture}))),e.vertex.include(o.H),e.vertex.code.add((0,c.H)(r||(r=(0,n.Z)(["bool testHUDVisibility(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}},7683:(e,t,i)=>{i.d(t,{E:()=>l,K:()=>a});var r,n,o=i(30168),s=i(98634);function a(e){e.fragment.code.add((0,s.H)(r||(r=(0,o.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,s.H)(n||(n=(0,o.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},2631:(e,t,i)=>{i.d(t,{q:()=>S,C:()=>O});var r=i(30168),n=i(78980),o=i(82552),s=i(95276),a=i(58406),l=i(98634),c=i(19253);i(46228),i(8548),i(57808),i(52311);function d(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=d(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function u(e){return d(e).reduce(((e,t)=>Math.max(e,t)))}var p=i(90045),f=i(67077);const v=(0,f.c)();var g,m,_,y,w,T,b,C,x;function S(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:d,fragment:h}=e;h.include(n.n),t.draped||((0,o.hY)(d,t),d.uniforms.add(new a.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),d.code.add((0,l.H)(g||(g=(0,r.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),d.code.add((0,l.H)(m||(m=(0,r.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),A)),d.code.add((0,l.H)(_||(_=(0,r.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),d.code.add((0,l.H)(y||(y=(0,r.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),i?"patternLength":"1e4")),(0,o.ZI)(d),d.code.add((0,l.H)(w||(w=(0,r.Z)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),h.uniforms.add(new c.A("stipplePatternTexture",(e=>e.stippleTexture)),new a.p("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.p("stipplePatternPixelSizeInv",(e=>1/O(e)))),h.code.add((0,l.H)(T||(T=(0,r.Z)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(h.uniforms.add(new s.N("stippleOffColor",(e=>function(e){return null==e?f.Z:4===e.length?e:(0,p.s)(v,e[0],e[1],e[2],1)}(e.stippleOffColor)))),h.code.add((0,l.H)(b||(b=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):h.code.add((0,l.H)(C||(C=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,l.H)(x||(x=(0,r.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function O(e){const t=e.stipplePattern;return t?h(e.stipplePattern)/t.pixelRatio:1}const A=l.H.float(.4)},40526:(e,t,i)=>{i.d(t,{Q:()=>h});var r,n,o=i(30168),s=i(2522),a=i(82552),l=i(58406),c=i(98634),d=i(33720);function h(e,t){const{vertex:i,constants:h}=e;h.add("markerSizePerLineWidth","float",s.M_),(0,a.ZI)(i),null==i.uniforms.get("markerScale")&&i.constants.add("markerScale","float",1),i.code.add((0,c.H)(r||(r=(0,o.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===d.I9.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new l.p("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),i.code.add((0,c.H)(n||(n=(0,o.Z)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},43565:(e,t,i)=>{i.d(t,{S:()=>c,_:()=>d});var r,n=i(30168),o=i(21002),s=i(82999),a=i(98634),l=i(19253);function c(e){e.include(o.S),e.uniforms.add(new l.A("geometryDepthTexture",((e,t)=>{var i;return null===(i=t.multipassGeometry.linearDepth)||void 0===i?void 0:i.colorTexture})),new s.A("nearFar",((e,t)=>t.camera.nearFar))),e.code.add((0,a.H)(r||(r=(0,n.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}class d{}},8555:(e,t,i)=>{i.d(t,{n:()=>c});var r,n,o,s,a=i(30168),l=i(98634);function c(e,t){t.spherical?e.vertex.code.add((0,l.H)(r||(r=(0,a.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,l.H)(n||(n=(0,a.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.spherical?e.vertex.code.add((0,l.H)(o||(o=(0,a.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,l.H)(s||(s=(0,a.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},29078:(e,t,i)=>{i.d(t,{B:()=>B});var r,n=i(30168),o=i(7683),s=i(98634);function a(e){e.fragment.code.add((0,s.H)(r||(r=(0,n.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var l,c=i(2116),d=i(21002),h=i(82999),u=i(58406),p=i(8654),f=i(19253);function v(e,t){const i=e.fragment;i.include(d.S),i.uniforms.add(new h.A("nearFar",((e,t)=>t.camera.nearFar))),i.uniforms.add(new f.A("depthMap",((e,t)=>{var i;return null===(i=t.linearDepth)||void 0===i?void 0:i.colorTexture}))),i.uniforms.add(new p.g("proj",((e,t)=>t.camera.projectionMatrix))),i.uniforms.add(new u.p("invResolutionHeight",((e,t)=>1/t.camera.height))),i.uniforms.add(new p.g("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),i.code.add((0,s.H)(l||(l=(0,n.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var g,m,_,y,w,T,b,C,x,S,O,A,R,P,E,D,I=i(16889),M=i(22186),L=i(46208),H=i(5573),F=i(82278),N=i(92395),z=i(13773),j=i(49450),U=i(61809),V=i(99340);class Z extends U.x{constructor(e,t){super(e,"samplerCube",V.P.Pass,((i,r,n)=>i.bindTexture(e,t(r,n))))}}function G(e){const t=e.fragment;t.uniforms.add(new p.g("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new p.g("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new j.J("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new j.J("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new u.p("cloudsHeight",(()=>F.$T)),new u.p("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new u.p("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new u.p("crossFadeAnchorFactor",((e,t)=>(0,I.uZ)(t.cloudsFade.fadeFactor,0,1))),new Z("cubeMap",((e,t)=>{var i,r;return null!==(i=null===(r=t.cloudsFade.data)||void 0===r||null===(r=r.cubeMap)||void 0===r?void 0:r.colorTexture)&&void 0!==i?i:null})),new z.U("crossFade",((e,t)=>t.cloudsFade.fadeMode===H.lL.CROSS_FADE)),new z.U("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===L.uz.RG)),new z.U("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===L.jL.FADING))),t.constants.add("planetRadius","float",M.sv.radius),t.code.add((0,s.H)(g||(g=(0,n.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,s.H)(m||(m=(0,n.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,s.H)(_||(_=(0,n.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,N.Pe)(t),(0,N.F1)(t),t.code.add((0,s.H)(y||(y=(0,n.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,s.H)(w||(w=(0,n.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,s.H)(T||(T=(0,n.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,s.H)(b||(b=(0,n.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,s.H)(C||(C=(0,n.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}function B(e,t){e.include(c.g,t),e.include(a),e.include(o.E),t.hasCloudsReflections&&e.include(G,t),t.hasScreenSpaceReflections&&e.include(v,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add((0,s.H)(x||(x=(0,n.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),i.uniforms.add(new u.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new u.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),i.code.add((0,s.H)(S||(S=(0,n.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&i.code.add((0,s.H)(O||(O=(0,n.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(i.uniforms.add(new p.g("view",((e,t)=>t.camera.viewMatrix)),new f.A("lastFrameColorTexture",((e,t)=>{var i;return null===(i=t.ssr.lastFrameColor)||void 0===i?void 0:i.colorTexture})),new u.p("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),i.code.add((0,s.H)(A||(A=(0,n.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):i.code.add((0,s.H)(R||(R=(0,n.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add((0,s.H)(P||(P=(0,n.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):i.code.add((0,s.H)(E||(E=(0,n.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):i.code.add((0,s.H)(D||(D=(0,n.Z)(["return waterRenderedColor;\n}"]))))}},79246:(e,t,i)=>{i.d(t,{M:()=>f});var r,n=i(30168),o=i(88396),s=i(6394),a=i(90045),l=i(67077),c=i(7683),d=(i(58335),i(82999)),h=i(95276),u=i(98634),p=i(19253);function f(e){e.fragment.uniforms.add(new p.A("texWaveNormal",(e=>e.waveNormal)),new p.A("texWavePerturbation",(e=>e.wavePerturbation)),new h.N("waveParams",(e=>(0,a.s)(v,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new d.A("waveDirection",(e=>(0,o.s)(g,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))),e.include(c.K),e.fragment.code.add((0,u.H)(r||(r=(0,n.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}const v=(0,l.c)(),g=(0,s.a)()},86755:(e,t,i)=>{i.d(t,{V:()=>C});var r,n=i(27366),o=i(7138),s=i(32718),a=i(16889),l=i(17842),c=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),h=i(14226),u=i(81949),p=i(88396),f=i(6394),v=i(11186),g=i(71353),m=i(90045),_=i(67077),y=i(95773),w=i(40885),T=i(40927),b=i(50951);let C=r=class extends o.Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._center=(0,g.c)(),this._up=(0,g.c)(),this._viewUp=(0,g.c)(),this._viewForward=(0,g.c)(),this._viewRight=(0,g.c)(),this._ray=(0,w.Ue)(),this._viewport=(0,_.f)(0,0,1,1),this._padding=(0,_.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,u.a)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,u.a)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,u.a)(),this._frustumDirty=!0,this._frustum=(0,y.Ue)(),this._fullViewport=(0,_.c)(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,v.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.h)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,m.b)((0,_.c)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,m.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,m.b)((0,_.c)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,m.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[P.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[P.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[P.RIGHT]+this._padding[P.LEFT]}set fullWidth(e){this.width=e-(this._padding[P.RIGHT]+this._padding[P.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[P.TOP]+this._padding[P.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[P.TOP]+this._padding[P.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[P.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[P.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,m.h)(this._padding,e)||(this._viewport[0]+=e[P.LEFT]-this._padding[P.LEFT],this._viewport[1]+=e[P.BOTTOM]-this._padding[P.BOTTOM],this._viewport[2]-=e[P.RIGHT]+e[P.LEFT]-(this._padding[P.RIGHT]+this._padding[P.LEFT]),this._viewport[3]-=e[P.TOP]+e[P.BOTTOM]-(this._padding[P.TOP]+this._padding[P.BOTTOM]),(0,m.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=(0,h.q)((0,u.a)(),-r*(1+2*this._padding[P.LEFT]/e),r*(1+2*this._padding[P.RIGHT]/e),-i*(1+2*this._padding[P.BOTTOM]/t),i*(1+2*this._padding[P.TOP]/t),this.near,this.far),o=this._get("projectionMatrix");return o&&(0,h.a)(o,n)?o:n}get inverseProjectionMatrix(){return(0,h.i)((0,u.a)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,u.a)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,v.o)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.i)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){(0,v.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,m.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,m.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.j)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.h)(this._viewMatrix,e.viewMatrix),(0,v.c)(this._viewRight,e.viewRight),(0,v.c)(this._viewUp,e.viewUp),(0,v.c)(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.h)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,m.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new r).copyFrom(this)}equals(e){return(0,v.h)(this.eye,e.eye)&&(0,v.h)(this.center,e.center)&&(0,v.h)(this.up,e.up)&&(0,m.h)(this._viewport,e.viewport)&&(0,m.h)(this._padding,e.padding)&&(0,p.m)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,m.i)(e.screenPadding,this.screenPadding)>=t||(0,m.i)(this.screenViewport,e.screenViewport)>=t)return!1;(0,v.u)(O,e.eye,e.center),(0,v.u)(A,this.eye,this.center);const i=(0,v.j)(O,A),r=(0,v.F)(O),n=(0,v.F)(A),o=5e-4;return i*i>=(1-1e-10)*r*n&&(0,v.y)(e.eye,this.eye)<Math.max(r,n)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,T.SR)(this.viewForward,(0,v.f)(O,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.s1)();return e[0]=(this.padding[P.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[P.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[P.LEFT]+this.width*t,e[1]=this.padding[P.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==x&&(0,v.c)(x,e),x[3]=1,(0,m.t)(x,x,this.projectionMatrix);const i=Math.abs(x[3]);(0,v.i)(x,x,1/i);const r=this.fullViewport;t[0]=(0,a.t7)(0,r[0]+r[2],.5+.5*x[0]),t[1]=(0,a.t7)(0,r[1]+r[3],.5+.5*x[1]),t[2]=.5*(x[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;x[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],x[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],x[2]=(2*e[2]-1)*e[3],x[3]=e[3],null!=this.inverseProjectionMatrix&&((0,m.t)(x,x,this.inverseProjectionMatrix),t[0]=x[0],t[1]=x[1],t[2]=x[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,R),this.renderToScreen(R,t),t}projectToRenderScreen(e,t){if(x[0]=e[0],x[1]=e[1],x[2]=e[2],x[3]=1,(0,m.t)(x,x,this.viewProjectionMatrix),0===x[3])return null;(0,v.i)(x,x,1/Math.abs(x[3]));const i=this.fullViewport;return"x"in t?(t.x=(0,a.t7)(0,i[0]+i[2],.5+.5*x[0]),t.y=(0,a.t7)(0,i[1]+i[3],.5+.5*x[1])):(t[0]=(0,a.t7)(0,i[0]+i[2],.5+.5*x[0]),t[1]=(0,a.t7)(0,i[1]+i[3],.5+.5*x[1]),t.length>2&&(t[2]=.5*(x[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,R),t)}unprojectFromRenderScreen(e,t){if((0,h.m)(S,this.projectionMatrix,this.viewMatrix),!(0,h.i)(S,S))return null;const i=this.fullViewport;return x[0]=2*(e[0]-i[0])/i[2]-1,x[1]=2*(e[1]-i[1])/i[3]-1,x[2]=2*e[2]-1,x[3]=1,(0,m.t)(x,x,S),0===x[3]?null:(t[0]=x[0]/x[3],t[1]=x[1]/x[3],t[2]=x[2]/x[3],t)}constrainWindowSize(e,t,i,r){const n=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(n-i/2,0),a=Math.max(this.fullHeight-o-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-o-r/2,0),d=i-l- -Math.min(this.fullWidth-n-i/2,0),h=r-c- -Math.min(o-r/2,0);return[Math.round(s),Math.round(a),Math.round(d),Math.round(h)]}computeUp(e){e===b.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,v.f)(O,this.center,this.eye);const e=(0,v.l)(this.center);e<1?((0,v.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,v.j)(O,this.center))>.9999*(0,v.l)(O)*e||((0,v.b)(this._up,O,this.center),(0,v.b)(this._up,this._up,O),(0,v.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,v.C)(O,this.eye,this.center),Math.abs(O[2])<=.9999&&((0,v.i)(O,O,O[2]),(0,v.s)(this._up,-O[0],-O[1],1-O[2]),(0,v.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,v.h)(e,t)||((0,v.c)(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):s.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.u)(this._viewMatrix,this.eye,this.center,this.up),(0,v.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,v.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,v.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,n._)([(0,c.Cb)()],C.prototype,"_center",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_up",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_viewport",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_padding",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_fov",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_nearFar",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"_pixelRatio",void 0),(0,n._)([(0,c.Cb)()],C.prototype,"pixelRatio",null),(0,n._)([(0,c.Cb)()],C.prototype,"eye",null),(0,n._)([(0,c.Cb)()],C.prototype,"center",null),(0,n._)([(0,c.Cb)()],C.prototype,"up",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"nearFar",null),(0,n._)([(0,c.Cb)()],C.prototype,"near",null),(0,n._)([(0,c.Cb)()],C.prototype,"far",null),(0,n._)([(0,c.Cb)()],C.prototype,"viewport",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"screenViewport",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"screenPadding",null),(0,n._)([(0,c.Cb)()],C.prototype,"x",null),(0,n._)([(0,c.Cb)()],C.prototype,"y",null),(0,n._)([(0,c.Cb)()],C.prototype,"width",null),(0,n._)([(0,c.Cb)()],C.prototype,"height",null),(0,n._)([(0,c.Cb)()],C.prototype,"fullWidth",null),(0,n._)([(0,c.Cb)()],C.prototype,"fullHeight",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"_aspect",null),(0,n._)([(0,c.Cb)()],C.prototype,"padding",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"projectionMatrix",null),(0,n._)([(0,c.Cb)({readOnly:!0})],C.prototype,"inverseProjectionMatrix",null),(0,n._)([(0,c.Cb)()],C.prototype,"fov",null),(0,n._)([(0,c.Cb)()],C.prototype,"fovX",null),(0,n._)([(0,c.Cb)()],C.prototype,"fovY",null),C=r=(0,n._)([(0,d.j)("esri.views.3d.webgl-engine.lib.Camera")],C);const x=(0,_.c)(),S=(0,u.a)(),O=(0,g.c)(),A=(0,g.c)(),R=(0,l.J$)();var P;!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(P||(P={}))},94425:(e,t,i)=>{i.d(t,{p:()=>n});var r=i(68401);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,i){if(!this._material.produces(t,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,t,i));const n=this._map.get(i);if(null!=n){if(n.ensureResources(e)===r.Rw.LOADED)return n;this._repository.requestRender()}return null}}},70619:(e,t,i)=>{i.d(t,{Cr:()=>ee,IG:()=>x,QL:()=>q,nb:()=>J,B2:()=>P,DA:()=>$,x2:()=>X,dV:()=>k,mj:()=>W,rh:()=>Q,PI:()=>B,AW:()=>G,PD:()=>Y,Ay:()=>ie,mx:()=>K});var r,n=i(11186),o=i(8229),s=i(71353),a=i(86372),l=i(38461),c=i(39406),d=i(55652),h=i(40885),u=i(91526);!function(e){e.length=function(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)},e.normalize=function(e,t){const i=e[t],r=e[t+1],n=e[t+2],o=1/Math.sqrt(i*i+r*r+n*n);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]+i[r],n[o+1]=e[t+1]+i[r+1],n[o+2]=e[t+2]+i[r+2]},e.subtract=function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]-i[r],n[o+1]=e[t+1]-i[r+1],n[o+2]=e[t+2]-i[r+2]}}(r||(r={}));var p=i(79100),f=i(95774),v=i(97731),g=i(4760);const m=r,_=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],y=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],w=[0,0,1,0,1,1,0,1],T=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],b=new Array(36);for(let oe=0;oe<6;oe++)for(let e=0;e<6;e++)b[6*oe+e]=oe;const C=new Array(36);for(let oe=0;oe<6;oe++)C[6*oe]=0,C[6*oe+1]=1,C[6*oe+2]=2,C[6*oe+3]=2,C[6*oe+4]=3,C[6*oe+5]=0;function x(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=_[r][0]*t[0],i[3*r+1]=_[r][1]*t[1],i[3*r+2]=_[r][2]*t[2];return new f.Z(e,[[g.T.POSITION,new u.a(i,T,3,!0)],[g.T.NORMAL,new u.a(y,b,3)],[g.T.UV0,new u.a(w,C,2)]])}const S=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],O=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],A=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],R=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function P(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=S[r][0]*t[0],i[3*r+1]=S[r][1]*t[1],i[3*r+2]=S[r][2]*t[2];return new f.Z(e,[[g.T.POSITION,new u.a(i,A,3,!0)],[g.T.NORMAL,new u.a(O,R,3)]])}const E=(0,o.f)(-.5,0,-.5),D=(0,o.f)(.5,0,-.5),I=(0,o.f)(0,0,.5),M=(0,o.f)(0,.5,0),L=(0,o.c)(),H=(0,o.c)(),F=(0,o.c)(),N=(0,o.c)(),z=(0,o.c)();(0,n.f)(L,E,M),(0,n.f)(H,E,D),(0,n.b)(F,L,H),(0,n.n)(F,F),(0,n.f)(L,D,M),(0,n.f)(H,D,I),(0,n.b)(N,L,H),(0,n.n)(N,N),(0,n.f)(L,I,M),(0,n.f)(H,I,E),(0,n.b)(z,L,H),(0,n.n)(z,z);const j=[E,D,I,M],U=[0,-1,0,F[0],F[1],F[2],N[0],N[1],N[2],z[0],z[1],z[2]],V=[0,1,2,3,1,0,3,2,1,3,0,2],Z=[0,0,0,1,1,1,2,2,2,3,3,3];function G(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=j[r][0]*t[0],i[3*r+1]=j[r][1]*t[1],i[3*r+2]=j[r][2]*t[2];return new f.Z(e,[[g.T.POSITION,new u.a(i,V,3,!0)],[g.T.NORMAL,new u.a(U,Z,3)]])}function B(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const o=-Math.PI,s=2*Math.PI,a=-Math.PI/2,d=Math.PI,h=Math.max(3,Math.floor(i)),p=Math.max(2,Math.floor(r)),v=(h+1)*(p+1),m=(0,l.xx)(3*v),_=(0,l.xx)(3*v),y=(0,l.xx)(2*v),w=[];let T=0;for(let l=0;l<=p;l++){const e=[],i=l/p,r=a+i*d,n=Math.cos(r);for(let a=0;a<=h;a++){const l=a/h,c=o+l*s,d=Math.cos(c)*n,u=Math.sin(r),p=-Math.sin(c)*n;m[3*T]=d*t,m[3*T+1]=u*t,m[3*T+2]=p*t,_[3*T]=d,_[3*T+1]=u,_[3*T+2]=p,y[2*T]=l,y[2*T+1]=i,e.push(T),++T}w.push(e)}const b=new Array;for(let l=0;l<p;l++)for(let e=0;e<h;e++){const t=w[l][e],i=w[l][e+1],r=w[l+1][e+1],n=w[l+1][e];0===l?(b.push(t),b.push(r),b.push(n)):l===p-1?(b.push(t),b.push(i),b.push(r)):(b.push(t),b.push(i),b.push(r),b.push(r),b.push(n),b.push(t))}const C=[[g.T.POSITION,new u.a(m,b,3,!0)],[g.T.NORMAL,new u.a(_,b,3,!0)]];return n.uv&&C.push([g.T.UV0,new u.a(y,b,2,!0)]),n.offset&&(C[0][0]=g.T.OFFSET,C.push([g.T.POSITION,new u.a(Float64Array.from(n.offset),(0,c.LE)(b.length),3,!0)])),new f.Z(e,C)}function W(e,t,i,r){const n=function(e,t,i){const r=e;let n,o;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let l=0;l<n.length;l+=3)m.scale(n,l,e/m.length(n,l));let s={};function a(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let o=n.length;return n.length+=3,m.add(n,3*t,n,3*i,n,o),m.scale(n,o,e/m.length(n,o)),o/=3,s[r]=o,o}for(let l=0;l<t;l++){const e=o.length,t=new Array(4*e);for(let i=0;i<e;i+=3){const e=o[i],r=o[i+1],n=o[i+2],s=a(e,r),l=a(r,n),c=a(n,e),d=4*i;t[d]=e,t[d+1]=s,t[d+2]=c,t[d+3]=r,t[d+4]=l,t[d+5]=s,t[d+6]=n,t[d+7]=c,t[d+8]=l,t[d+9]=s,t[d+10]=l,t[d+11]=c}o=t,s={}}const c=(0,l.XO)(n);for(let l=0;l<c.length;l+=3)m.normalize(c,l);return[[g.T.POSITION,new u.a((0,l.XO)(n),o,3,!0)],[g.T.NORMAL,new u.a(c,o,3,!0)]]}(t,i,r);return new f.Z(e,n)}function k(e,t,i,r,n,o,s,a){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const d=i?[i[0],i[1],i[2]]:[0,0,0],h=t?[t[0],t[1],t[2]]:[0,0,1];s=s||[0,0];const v=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],m=null!=n&&2===n.length?n:[1,1],_=(0,c.LE)(1),y=[[g.T.POSITION,new u.a(d,_,3,!0)],[g.T.NORMAL,new u.a(h,_,3,!0)],[g.T.UV0,new u.a(s,_,s.length)],[g.T.COLOR,new u.a(v,_,4,!0)],[g.T.SIZE,new u.a(m,_,2)]];if(null!=o){const e=[o[0],o[1],o[2],o[3]];y.push([g.T.AUXPOS1,new u.a(e,_,4)])}if(null!=a){const e=[a[0],a[1],a[2],a[3]];y.push([g.T.FEATUREATTRIBUTE,new u.a(e,_,4)])}return new f.Z(e,y,null,p.U.Point,l)}function q(e,t,i,r,n){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=0;const d=i,h=t;let p=(0,o.f)(0,c,0),v=(0,o.f)(0,c+h,0),m=(0,o.f)(0,-1,0),_=(0,o.f)(0,1,0);n&&(c=h,v=(0,o.f)(0,0,0),p=(0,o.f)(0,c,0),m=(0,o.f)(0,1,0),_=(0,o.f)(0,-1,0));const y=[v,p],w=[m,_],T=r+2,b=Math.sqrt(h*h+d*d);if(n)for(let l=r-1;l>=0;l--){const e=l*(2*Math.PI/r),t=(0,o.f)(Math.cos(e)*d,c,Math.sin(e)*d);y.push(t);const i=(0,o.f)(h*Math.cos(e)/b,-d/b,h*Math.sin(e)/b);w.push(i)}else for(let l=0;l<r;l++){const e=l*(2*Math.PI/r),t=(0,o.f)(Math.cos(e)*d,c,Math.sin(e)*d);y.push(t);const i=(0,o.f)(h*Math.cos(e)/b,d/b,h*Math.sin(e)/b);w.push(i)}const C=new Array,x=new Array;if(s){for(let e=3;e<y.length;e++)C.push(1),C.push(e-1),C.push(e),x.push(0),x.push(0),x.push(0);C.push(y.length-1),C.push(2),C.push(1),x.push(0),x.push(0),x.push(0)}if(a){for(let e=3;e<y.length;e++)C.push(e),C.push(e-1),C.push(0),x.push(e),x.push(e-1),x.push(1);C.push(0),C.push(2),C.push(y.length-1),x.push(1),x.push(2),x.push(w.length-1)}const S=(0,l.xx)(3*T);for(let o=0;o<T;o++)S[3*o]=y[o][0],S[3*o+1]=y[o][1],S[3*o+2]=y[o][2];const O=(0,l.xx)(3*T);for(let o=0;o<T;o++)O[3*o]=w[o][0],O[3*o+1]=w[o][1],O[3*o+2]=w[o][2];const A=[[g.T.POSITION,new u.a(S,C,3,!0)],[g.T.NORMAL,new u.a(O,x,3,!0)]];return new f.Z(e,A)}function J(e,t,i,r,s,a,c){var d;const h=s?(0,o.a)(s):(0,o.f)(1,0,0),p=a?(0,o.a)(a):(0,o.f)(0,0,0);null!==(d=c)&&void 0!==d||(c=!0);const v=(0,o.c)();(0,n.n)(v,h);const m=(0,o.c)();(0,n.i)(m,v,Math.abs(t));const _=(0,o.c)();(0,n.i)(_,m,-.5),(0,n.g)(_,_,p);const y=(0,o.f)(0,1,0);Math.abs(1-(0,n.j)(v,y))<.2&&(0,n.s)(y,0,0,1);const w=(0,o.c)();(0,n.b)(w,v,y),(0,n.n)(w,w),(0,n.b)(y,w,v);const T=2*r+(c?2:0),b=r+(c?2:0),C=(0,l.xx)(3*T),x=(0,l.xx)(3*b),S=(0,l.xx)(2*T),O=new Array(3*r*(c?4:2)),A=new Array(3*r*(c?4:2));c&&(C[3*(T-2)]=_[0],C[3*(T-2)+1]=_[1],C[3*(T-2)+2]=_[2],S[2*(T-2)]=0,S[2*(T-2)+1]=0,C[3*(T-1)]=C[3*(T-2)]+m[0],C[3*(T-1)+1]=C[3*(T-2)+1]+m[1],C[3*(T-1)+2]=C[3*(T-2)+2]+m[2],S[2*(T-1)]=1,S[2*(T-1)+1]=1,x[3*(b-2)]=-v[0],x[3*(b-2)+1]=-v[1],x[3*(b-2)+2]=-v[2],x[3*(b-1)]=v[0],x[3*(b-1)+1]=v[1],x[3*(b-1)+2]=v[2]);const R=(e,t,i)=>{O[e]=t,A[e]=i};let P=0;const E=(0,o.c)(),D=(0,o.c)();for(let o=0;o<r;o++){const e=o*(2*Math.PI/r);(0,n.i)(E,y,Math.sin(e)),(0,n.i)(D,w,Math.cos(e)),(0,n.g)(E,E,D),x[3*o]=E[0],x[3*o+1]=E[1],x[3*o+2]=E[2],(0,n.i)(E,E,i),(0,n.g)(E,E,_),C[3*o]=E[0],C[3*o+1]=E[1],C[3*o+2]=E[2],S[2*o]=o/r,S[2*o+1]=0,C[3*(o+r)]=C[3*o]+m[0],C[3*(o+r)+1]=C[3*o+1]+m[1],C[3*(o+r)+2]=C[3*o+2]+m[2],S[2*(o+r)]=o/r,S[2*o+1]=1;const t=(o+1)%r;R(P++,o,o),R(P++,o+r,o),R(P++,t,t),R(P++,t,t),R(P++,o+r,o),R(P++,t+r,t)}if(c){for(let e=0;e<r;e++){const t=(e+1)%r;R(P++,T-2,b-2),R(P++,e,b-2),R(P++,t,b-2)}for(let e=0;e<r;e++){const t=(e+1)%r;R(P++,e+r,b-1),R(P++,T-1,b-1),R(P++,t+r,b-1)}}const I=[[g.T.POSITION,new u.a(C,O,3,!0)],[g.T.NORMAL,new u.a(x,A,3,!0)],[g.T.UV0,new u.a(S,O,2,!0)]];return new f.Z(e,I)}function Y(e,t,i,r,n,o){r=r||10,n=null==n||n,(0,v.hu)(t.length>1);const s=[],a=[];for(let l=0;l<r;l++){s.push([0,-l-1,-(l+1)%r-1]);const e=l/r*2*Math.PI;a.push([Math.cos(e)*i,Math.sin(e)*i])}return X(e,a,t,[[0,0,0]],s,n,o)}function X(e,t,i,r,a,c){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.f)(0,0,0);const v=t.length,m=(0,l.xx)(i.length*v*3+(6*r.length||0)),_=(0,l.xx)(i.length*v*3+(r?6:0)),y=new Array,w=new Array;let T=0,b=0;const C=(0,o.c)(),x=(0,o.c)(),S=(0,o.c)(),O=(0,o.c)(),A=(0,o.c)(),R=(0,o.c)(),P=(0,o.c)(),E=(0,s.c)(),D=(0,o.c)(),I=(0,o.c)(),M=(0,o.c)(),L=(0,o.c)(),H=(0,o.c)(),F=(0,d.Ue)();(0,n.s)(D,0,1,0),(0,n.f)(x,i[1],i[0]),(0,n.n)(x,x),c?((0,n.g)(E,i[0],p),(0,n.n)(S,E)):(0,n.s)(S,0,0,1),ie(x,S,D,D,A,S,re),(0,n.c)(O,S),(0,n.c)(L,A);for(let o=0;o<r.length;o++)(0,n.i)(R,A,r[o][0]),(0,n.i)(E,S,r[o][2]),(0,n.g)(R,R,E),(0,n.g)(R,R,i[0]),m[T++]=R[0],m[T++]=R[1],m[T++]=R[2];_[b++]=-x[0],_[b++]=-x[1],_[b++]=-x[2];for(let n=0;n<a.length;n++)y.push(a[n][0]>0?a[n][0]:-a[n][0]-1+r.length),y.push(a[n][1]>0?a[n][1]:-a[n][1]-1+r.length),y.push(a[n][2]>0?a[n][2]:-a[n][2]-1+r.length),w.push(0),w.push(0),w.push(0);let N=r.length;const z=r.length-1;for(let o=0;o<i.length;o++){let e=!1;o>0&&((0,n.c)(C,x),o<i.length-1?((0,n.f)(x,i[o+1],i[o]),(0,n.n)(x,x)):e=!0,(0,n.g)(I,C,x),(0,n.n)(I,I),(0,n.g)(M,i[o-1],O),(0,d.Yq)(i[o],I,F),(0,d.BR)(F,(0,h.re)(M,C),E)?((0,n.f)(E,E,i[o]),(0,n.n)(S,E),(0,n.b)(A,I,S),(0,n.n)(A,A)):ie(I,O,L,D,A,S,re),(0,n.c)(O,S),(0,n.c)(L,A)),c&&((0,n.g)(E,i[o],p),(0,n.n)(H,E));for(let r=0;r<v;r++)if((0,n.i)(R,A,t[r][0]),(0,n.i)(E,S,t[r][1]),(0,n.g)(R,R,E),(0,n.n)(P,R),_[b++]=P[0],_[b++]=P[1],_[b++]=P[2],(0,n.g)(R,R,i[o]),m[T++]=R[0],m[T++]=R[1],m[T++]=R[2],!e){const e=(r+1)%v;y.push(N+r),y.push(N+v+r),y.push(N+e),y.push(N+e),y.push(N+v+r),y.push(N+v+e);for(let t=0;t<6;t++){const e=y.length-6;w.push(y[e+t]-z)}}N+=v}const j=i[i.length-1];for(let o=0;o<r.length;o++)(0,n.i)(R,A,r[o][0]),(0,n.i)(E,S,r[o][1]),(0,n.g)(R,R,E),(0,n.g)(R,R,j),m[T++]=R[0],m[T++]=R[1],m[T++]=R[2];const U=b/3;_[b++]=x[0],_[b++]=x[1],_[b++]=x[2];const V=N-v;for(let n=0;n<a.length;n++)y.push(a[n][0]>=0?N+a[n][0]:-a[n][0]-1+V),y.push(a[n][2]>=0?N+a[n][2]:-a[n][2]-1+V),y.push(a[n][1]>=0?N+a[n][1]:-a[n][1]-1+V),w.push(U),w.push(U),w.push(U);const Z=[[g.T.POSITION,new u.a(m,y,3,!0)],[g.T.NORMAL,new u.a(_,w,3,!0)]];return new f.Z(e,Z)}function Q(e,t,i,r){(0,v.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,v.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,v.hu)(null==i||i.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,v.hu)(null==i||3===i[0].length,"createPolylineGeometry(): malformed normal");const n=(0,a.bg)(3*t.length),o=new Array(2*(t.length-1));let s=0,d=0;for(let a=0;a<t.length;a++){for(let e=0;e<3;e++)n[s++]=t[a][e];a>0&&(o[d++]=a-1,o[d++]=a)}const h=[[g.T.POSITION,new u.a(n,o,3,!0)]];if(i){const e=(0,l.xx)(3*i.length);let r=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[r++]=i[n][t];h.push([g.T.NORMAL,new u.a(e,o,3,!0)])}return r&&h.push([g.T.COLOR,new u.a(r,(0,c.KF)(r.length/4),4)]),new f.Z(e,h,null,p.U.Line)}function $(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=new Array(18),a=[[-i,o,n/2],[r,o,n/2],[0,t+o,n/2],[-i,o,-n/2],[r,o,-n/2],[0,t+o,-n/2]];for(let l=0;l<6;l++)s[3*l]=a[l][0],s[3*l+1]=a[l][1],s[3*l+2]=a[l][2];return new f.Z(e,[[g.T.POSITION,new u.a(s,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function K(e,t){const i=e.getMutableAttribute(g.T.POSITION).data;for(let r=0;r<i.length;r+=3){const e=i[r],o=i[r+1],s=i[r+2];(0,n.s)(ne,e,o,s),(0,n.e)(ne,ne,t),i[r]=ne[0],i[r+1]=ne[1],i[r+2]=ne[2]}}function ee(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const i=e.attributes,r=i.get(g.T.POSITION).data,n=i.get(g.T.NORMAL).data;if(n){const e=t.getMutableAttribute(g.T.NORMAL).data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(g.T.POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}}function te(e,t,i,r,o){return!(Math.abs((0,n.j)(t,e))>o)&&((0,n.b)(i,e,t),(0,n.n)(i,i),(0,n.b)(r,i,e),(0,n.n)(r,r),!0)}function ie(e,t,i,r,n,o,s){return te(e,t,n,o,s)||te(e,i,n,o,s)||te(e,r,n,o,s)}const re=.99619469809,ne=(0,o.c)()},19962:(e,t,i)=>{i.d(t,{C:()=>m});var r=i(95439),n=i(11186),o=i(71353),s=i(67077),a=i(50628),l=i(91526),c=i(79100),d=i(95774),h=i(61403),u=i(66327),p=i(17852),f=i(4760),v=i(97882),g=i(58901);class m{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,r.D)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.p.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.a)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=(0,h.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,r=Math.round(e[0]/i),o=Math.round(e[1]/i),s=Math.round(e[2]/i),a="".concat(r,"/").concat(o,"/").concat(s);let l=this._origins.get(a);const c=.5*i;if((0,n.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<c&&_[1]<c&&_[2]<c){if(l){const t=Math.max(..._);if((0,n.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.a)(r*i,o*i,s*i,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.f)(1,1,0,1);const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new g.U({width:2,color:t}),r.add(this._material);const e=new v.F(r,{pickable:!1}),i=new u.T({castShadow:!1});r.add(i),e.add(i),this._objects.set(n,i)}const o=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,m=new Array(3*p),_=new Array,y=.5*this._gridSize;for(let s=0;s<p;s++)m[3*s]=e[0]+(1&h[s]?y:-y),m[3*s+1]=e[1]+(2&h[s]?y:-y),m[3*s+2]=e[2]+(4&h[s]?y:-y),s>0&&_.push(s-1,s);(0,a.projectBuffer)(m,this._originSR,0,m,i.renderSpatialReference,0,p);const w=new d.Z(this._material,[[f.T.POSITION,new l.a(m,_,3,!0)]],null,c.U.Line);r.add(w),o.addGeometry(w)}get test(){const e=this;return{set gridSize(t){e._gridSize=t}}}}const _=(0,o.c)()},88153:(e,t,i)=>{i.d(t,{LP:()=>T,Z8:()=>m});var r=i(14226),n=i(81949),o=i(11186),s=i(71353),a=i(90045),l=i(67077),c=i(40885),d=i(50951),h=i(54463),u=i(55848),p=i(22178),f=i(76783);const v=1e-5;class g{constructor(e){this.options=new h.om,this._results=new _,this.transform=new f.yn,this.tolerance=v,this.verticalOffset=null,this._ray=(0,c.Ue)(),this._rayEnd=(0,s.c)(),this._rayBeginTransformed=(0,s.c)(),this._rayEndTransformed=(0,s.c)(),this.viewingMode=null!==e&&void 0!==e?e:d.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay((0,c.zk)(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===d.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,o.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.point=t,this.filterPredicate=r,this.tolerance=null!==i&&void 0!==i?i:v;const o=(0,f.W9)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){var s;const e=null===(s=i.getSpatialQueryAccelerator)||void 0===s?void 0:s.call(i);null!=e?(null!=o?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const i=e.effectiveTransformation,r=(0,f.W9)(this.verticalOffset);for(const s of t){if(!s.visible)continue;const{material:t,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),(0,o.e)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,o.e)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=r&&(r.objectTransform=this.transform),t.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,i,r,o,s,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const d=o?this._results.hud:this._results,p=o?o=>{const l=new u.RA(e,a,r,c);o.set(h.q7.HUD,l,t,i,n.I,s)}:n=>n.set(h.q7.OBJECT,{object:e,geometryId:a,triangleNr:r},t,i,l,s);if((null==d.min.drapedLayerOrder||s>=d.min.drapedLayerOrder)&&(null==d.min.dist||t<d.min.dist)&&p(d.min),this.options.store!==h.eC.MIN&&(null==d.max.drapedLayerOrder||s<d.max.drapedLayerOrder)&&(null==d.max.dist||t>d.max.dist)&&p(d.max),this.options.store===h.eC.ALL)if(o){const e=new w(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new y(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((e,t)=>{var i,r,n,o,s,a;return e.dist!==t.dist?(null!==(i=e.dist)&&void 0!==i?i:0)-(null!==(r=t.dist)&&void 0!==r?r:0):e.drapedLayerOrder!==t.drapedLayerOrder?(null!==(n=e.drapedLayerOrder)&&void 0!==n?n:Number.MAX_VALUE)-(null!==(o=t.drapedLayerOrder)&&void 0!==o?o:Number.MAX_VALUE):(null!==(s=t.drapedLayerGraphicOrder)&&void 0!==s?s:Number.MIN_VALUE)-(null!==(a=e.drapedLayerGraphicOrder)&&void 0!==a?a:Number.MIN_VALUE)}))}}function m(e){return new g(e)}class _{constructor(){this.min=new y((0,c.Ue)()),this.max=new y((0,c.Ue)()),this.hud={min:new w((0,c.Ue)()),max:new w((0,c.Ue)()),all:new Array},this.ground=new y((0,c.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class y{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,o.i)(b,this.ray.direction,this.dist),(0,o.l)(b)):null}getIntersectionPoint(e){return!!(0,p.nn)(this)&&((0,o.i)(b,this.ray.direction,this.dist),(0,o.g)(e,this.ray.origin,b),!0)}getTransformedNormal(e){return(0,o.c)(C,this.normal),C[3]=0,(0,a.t)(C,C,this.transformation),(0,o.c)(e,C),(0,o.n)(e,e)}constructor(e){this.intersector=h.q7.OBJECT,this.normal=(0,s.c)(),this.transformation=(0,n.a)(),this._ray=(0,c.Ue)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.q7.OBJECT,(0,c.JG)(e,this._ray)}set(e,t,i,a,l,c,d){this.intersector=e,this.dist=i,(0,o.c)(this.normal,null!==a&&void 0!==a?a:s.d),(0,r.h)(this.transformation,null!==l&&void 0!==l?l:n.I),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=d}copy(e){(0,c.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,o.c)(this.normal,e.normal),(0,r.h)(this.transformation,e.transformation)}}class w extends y{constructor(){super(...arguments),this.intersector=h.q7.HUD}}function T(e){return new y(e)}const b=(0,s.c)(),C=(0,l.c)()},54463:(e,t,i)=>{var r,n;i.d(t,{eC:()=>n,om:()=>o,q7:()=>r}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class o{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=n.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},55848:(e,t,i)=>{i.d(t,{Dx:()=>a,RA:()=>o});var r=i(71353);class n{constructor(e,t,i){this.object=e,this.geometryId=t,this.triangleNr=i}}class o extends n{constructor(e,t,i,n){super(e,t,i),this.center=null!=n?(0,r.g)(n):null}}class s{constructor(e){this.layerUid=e}}class a extends s{constructor(e,t){super(e),this.graphicUid=t}}},61403:(e,t,i)=>{i.d(t,{a:()=>o});var r=i(71353);class n{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,i,o){return new n((0,r.f)(e,t,i),o)}},78289:(e,t,i)=>{var r,n;i.d(t,{$:()=>n,T:()=>r}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},66327:(e,t,i)=>{i.d(t,{T:()=>g});var r=i(14226),n=i(81949),o=i(11186),s=i(71353),a=i(23470),l=i(80064),c=i(68401),d=i(1395),h=i(79100),u=i(47669),p=i(97731),f=i(4760),v=i(32683);class g extends d.c{get geometries(){return this._geometries}get transformation(){var e;return null!==(e=this._transformation)&&void 0!==e?e:n.I}set transformation(e){var t;this._transformation=(0,r.h)(null!==(t=this._transformation)&&void 0!==t?t:(0,n.a)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){var t;this._shaderTransformation=e?(0,r.h)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,n.a)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}constructor(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.U.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=null===(e=i.castShadow)||void 0===e||e,this.usesVerticalDistanceToGround=null!==(t=i.usesVerticalDistanceToGround)&&void 0!==t&&t,this.graphicUid=i.graphicUid,this.layerUid=i.layerUid,i.isElevationSource&&(this.lastValidElevationBB=new m),this._geometries=i.geometries?Array.from(i.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:i}),(0,f.j)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u.O(c.V_.MaskOccludee);for(const t of this._geometries)t.occludees=(0,v.lr)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,v.U_)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u.O(c.V_.Highlight);for(const t of this._geometries)t.highlights=(0,v.lr)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,v.U_)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,r.m)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.a)();return(0,r.m)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,x.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,x.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const i=t===x.ObjectSpace;for(const r of this._geometries){const t=r.boundingInfo;t&&y(t,e,i?r.transformation:this.getCombinedShaderTransformation(r))}(0,o.p)(e.bounds,e.min,e.max,.5);for(const r of this._geometries){const t=r.boundingInfo;if(null==t)continue;const n=i?r.transformation:this.getCombinedShaderTransformation(r),s=(0,l.u1)(n);(0,o.e)(C,t.center,n);const a=(0,o.o)(C,e.bounds),c=t.radius*s;e.bounds[3]=Math.max(e.bounds[3],a+c)}}_invalidateBoundingVolume(){var e;const t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class m{constructor(){this.min=(0,s.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,s.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends m{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,i){const n=e.bbMin,s=e.bbMax;if((0,r.y)(i)){const e=(0,o.s)(w,i[12],i[13],i[14]);(0,o.g)(T,n,e),(0,o.g)(b,s,e);for(let i=0;i<3;++i)t.min[i]=Math.min(t.min[i],T[i]),t.max[i]=Math.max(t.max[i],b[i])}else if((0,o.e)(T,n,i),(0,o.h)(n,s))for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],T[r]),t.max[r]=Math.max(t.max[r],T[r]);else{(0,o.e)(b,s,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],b[e]),t.max[e]=Math.max(t.max[e],T[e],b[e]);for(let e=0;e<3;++e){(0,o.c)(T,n),(0,o.c)(b,s),T[e]=s[e],b[e]=n[e],(0,o.e)(T,T,i),(0,o.e)(b,b,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],b[e]),t.max[e]=Math.max(t.max[e],T[e],b[e])}}}const w=(0,s.c)(),T=(0,s.c)(),b=(0,s.c)(),C=(0,s.c)();var x;!function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"}(x||(x={}))},39077:(e,t,i)=>{i.d(t,{z:()=>c});var r=i(95439),n=i(14226),o=i(81949),s=i(11186),a=i(23470),l=i(80064);class c{constructor(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.a)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,r.D)(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=null!==(t=i.castShadow)&&void 0!==t&&t,null!=i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.h)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,o.a)()),(0,n.m)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,a.c)()),(0,s.e)(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.u1)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return null==this._shaderTransformation?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},78485:(e,t,i)=>{var r;i.d(t,{j:()=>r}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},80658:(e,t,i)=>{i.d(t,{U:()=>n});var r=i(45412);class n extends r.U{}},97882:(e,t,i)=>{i.d(t,{F:()=>u});var r=i(91505),n=i(100),o=i(92026),s=i(27546),a=i(1395),l=i(79100);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var d=i(78329),h=i(78485);class u extends a.c{get objects(){return this._objects}constructor(e,t){var i,o,a,d;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=u,this.type=l.U.Layer,this.events=new r.Z,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new s.Z,this._objectsAdded=new s.Z,this._handles=new n.Z,this.apiLayerUid=u,this.visible=null===(i=null===t||void 0===t?void 0:t.visible)||void 0===i||i,this.pickable=null===(o=null===t||void 0===t?void 0:t.pickable)||void 0===o||o,this.updatePolicy=null!==(a=null===t||void 0===t?void 0:t.updatePolicy)&&void 0!==a?a:h.j.ASYNC,this._disableOctree=null!==(d=null===t||void 0===t?void 0:t.disableOctree)&&void 0!==d&&d,e.add(this);for(const r of c)this._handles.add(this.events.on(r,(t=>e.handleEvent(r,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.j.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new d.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,o.SC)(this._octree),this._objectsAdded.clear()}}},22178:(e,t,i)=>{i.d(t,{nn:()=>n});i(11186);var r=i(71353);i(82218),i(54463);function n(e){return null!=(null===e||void 0===e?void 0:e.dist)}(0,r.c)()},17852:(e,t,i)=>{i.d(t,{p:()=>n,y:()=>r});const r={stableRendering:!1},n={rootOrigin:null}},66832:(e,t,i)=>{i.d(t,{E:()=>P});var r=i(93169),n=i(67077),o=i(55158),s=i(37081),a=i(68401),l=i(23620),c=i(78041),d=i(93822),h=i(4760),u=i(12594),p=i(11983),f=i(65964),v=i(82144),g=i(31132),m=i(7566),_=i(27627),y=i(50411),w=i(25920),T=i(45028),b=i(36207);class C extends g.A{initializeProgram(e){return new _.$(e.rctx,C.shader.get().build(this.configuration),m.i)}_createPipeline(e,t){const i=this.configuration,r=e===w.A.NONE,n=e===w.A.FrontFace;return(0,b.sm)({blending:i.output!==s.H.Color&&i.output!==s.H.Alpha||!i.transparent?null:r?c.wu:(0,c.j7)(e),culling:(0,b.zp)(i.cullFace),depthTest:{func:(0,c.Bh)(e)},depthWrite:(r||n)&&i.writeDepth?b.LZ:null,colorWrite:b.BK,stencilWrite:i.hasOccludees?y.s3:null,stencilTest:i.hasOccludees?t?y.eD:y.RY:null,polygonOffset:r||n?i.polygonOffset?x:null:(0,c.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}C.shader=new v.J(T.C,(()=>i.e(3173).then(i.bind(i,23173))));const x={factor:1,units:1};var S=i(27366),O=i(33559),A=i(8883);class R extends A.W{constructor(){super(...arguments),this.output=s.H.Color,this.cullFace=a.Vr.None,this.transparencyPassType=w.A.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}}(0,S._)([(0,O.o)({count:s.H.COUNT})],R.prototype,"output",void 0),(0,S._)([(0,O.o)({count:a.Vr.COUNT})],R.prototype,"cullFace",void 0),(0,S._)([(0,O.o)({count:w.A.COUNT})],R.prototype,"transparencyPassType",void 0),(0,S._)([(0,O.o)()],R.prototype,"hasSlicePlane",void 0),(0,S._)([(0,O.o)()],R.prototype,"hasVertexColors",void 0),(0,S._)([(0,O.o)()],R.prototype,"transparent",void 0),(0,S._)([(0,O.o)()],R.prototype,"polygonOffset",void 0),(0,S._)([(0,O.o)()],R.prototype,"enableOffset",void 0),(0,S._)([(0,O.o)()],R.prototype,"writeDepth",void 0),(0,S._)([(0,O.o)()],R.prototype,"hasOccludees",void 0),(0,S._)([(0,O.o)()],R.prototype,"multipassEnabled",void 0),(0,S._)([(0,O.o)()],R.prototype,"cullAboveGround",void 0),(0,S._)([(0,O.o)()],R.prototype,"objectAndLayerIdColorInstanced",void 0),(0,S._)([(0,O.o)()],R.prototype,"vvColor",void 0),(0,S._)([(0,O.o)({constValue:!1})],R.prototype,"occlusionPass",void 0),(0,S._)([(0,O.o)({constValue:!0})],R.prototype,"hasVvInstancing",void 0),(0,S._)([(0,O.o)({constValue:!1})],R.prototype,"vvSize",void 0),(0,S._)([(0,O.o)({constValue:!1})],R.prototype,"vvOpacity",void 0);class P extends p.c{constructor(e){super(e,new D),this.supportsEdges=!0,this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,t){return!!(t===s.H.Color||t===s.H.Alpha||t===s.H.Highlight||t===s.H.Depth&&this.parameters.writeLinearDepth||t===s.H.ObjectAndLayerIdColor)&&(e===d.r.DRAPED_MATERIAL||(t===s.H.Highlight?e===d.r.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?d.r.TRANSPARENT_MATERIAL:d.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new E(e)}createBufferWriter(){const e=(0,o.U$)().vec3f(h.T.POSITION);return(0,r.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.T.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.T.COLORFEATUREATTRIBUTE):e.vec4u8(h.T.COLOR),new u.G(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class E extends l.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==s.H.Color&&this._output!==s.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(C,e)}}class D extends f.n{constructor(){super(...arguments),this.color=n.Z,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.Vr.None,this.hasOccludees=!1}}},64642:(e,t,i)=>{i.d(t,{IM:()=>a,W1:()=>s,lV:()=>l,wp:()=>o});var r=i(55158),n=i(4760);const o=(0,r.U$)().vec3f(n.T.POSITION),s=(0,r.U$)().vec3f(n.T.POSITION).vec2f(n.T.UV0),a=(0,r.U$)().vec3f(n.T.POSITION).vec4u8(n.T.COLOR),l=((0,r.U$)().vec3f(n.T.POSITION).vec4u8(n.T.OBJECTANDLAYERIDCOLOR),(0,r.U$)().vec3f(n.T.POSITION).vec2f(n.T.UV0).vec4u8(n.T.OBJECTANDLAYERIDCOLOR));(0,r.U$)().vec3f(n.T.POSITION).vec4u8(n.T.COLOR).vec4u8(n.T.OBJECTANDLAYERIDCOLOR)},48800:(e,t,i)=>{i.d(t,{A:()=>J});var r=i(93169),n=i(16889),o=i(22753),s=i(11873),a=i(14226),l=i(81949),c=i(88396),d=i(6394),h=i(11186),u=i(71353),p=i(67077);function f(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var v=i(65156),g=i(25158),m=i(66202),_=i(94463),y=i(55158),w=i(37081),T=i(81879),b=i(17363),C=i(56529),x=i(93822),S=i(65216),O=i(97731),A=i(4760);class R{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var P=i(33236),E=i(22909),D=i(18442),I=i(50951),M=i(82144),L=i(31132),H=i(7566),F=i(78041),N=i(27627),z=i(25920),j=i(8548),U=i(36207);class V extends L.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===I.JY.Global}initializeProgram(e){return new N.$(e.rctx,V.shader.get().build(this.configuration),H.i)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,i=e===z.A.NONE,r=e===z.A.FrontFace,n=this.configuration.hasPolygonOffset?Z:null,o=(i||r)&&t.output!==w.H.Highlight&&(t.depthEnabled||t.occlusionPass)?U.LZ:null;return(0,U.sm)({blending:t.output===w.H.Color||t.output===w.H.Alpha||t.output===w.H.Highlight?i?G:(0,F.j7)(e):null,depthTest:{func:j.wb.LEQUAL},depthWrite:o,colorWrite:U.BK,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?j.MX.POINTS:j.MX.TRIANGLES}}V.shader=new M.J(D.H,(()=>i.e(6823).then(i.bind(i,16823))));const Z={factor:0,units:-4},G=(0,U.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA);var B=i(27366),W=i(33559),k=i(8883);class q extends k.W{constructor(){super(...arguments),this.output=w.H.Color,this.transparencyPassType=z.A.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,B._)([(0,W.o)({count:w.H.COUNT})],q.prototype,"output",void 0),(0,B._)([(0,W.o)({count:z.A.COUNT})],q.prototype,"transparencyPassType",void 0),(0,B._)([(0,W.o)()],q.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"spherical",void 0),(0,B._)([(0,W.o)()],q.prototype,"occlusionTestEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"signedDistanceFieldEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,B._)([(0,W.o)()],q.prototype,"vvSize",void 0),(0,B._)([(0,W.o)()],q.prototype,"vvColor",void 0),(0,B._)([(0,W.o)()],q.prototype,"hasVerticalOffset",void 0),(0,B._)([(0,W.o)()],q.prototype,"hasScreenSizePerspective",void 0),(0,B._)([(0,W.o)()],q.prototype,"debugDrawLabelBorder",void 0),(0,B._)([(0,W.o)()],q.prototype,"hasSlicePlane",void 0),(0,B._)([(0,W.o)()],q.prototype,"hasPolygonOffset",void 0),(0,B._)([(0,W.o)()],q.prototype,"depthEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"pixelSnappingEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"draped",void 0),(0,B._)([(0,W.o)()],q.prototype,"multipassEnabled",void 0),(0,B._)([(0,W.o)()],q.prototype,"cullAboveGround",void 0),(0,B._)([(0,W.o)()],q.prototype,"occlusionPass",void 0),(0,B._)([(0,W.o)()],q.prototype,"objectAndLayerIdColorInstanced",void 0),(0,B._)([(0,W.o)({constValue:!0})],q.prototype,"hasSliceInVertexProgram",void 0),(0,B._)([(0,W.o)({constValue:!1})],q.prototype,"hasVvInstancing",void 0);class J extends C.F5{constructor(e){super(e,new ve),this._configuration=new q}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===x.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===w.H.Color||e===w.H.Alpha),e===w.H.Color&&(this._configuration.debugDrawLabelBorder=!!_.h.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,n,s){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const l=this.parameters,c=i.point,d=i.camera;let{scaleX:p,scaleY:f}=this._getScreenScale(e);p*=d.pixelRatio,f*=d.pixelRatio,(0,o.f)(ne,t),e.attributes.has(A.T.FEATUREATTRIBUTE)&&function(e){const t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(n*n+o*o+s*s),u=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*d,e[1]=i*d,e[2]=r*d,e[3]=n*h,e[4]=o*h,e[5]=s*h,e[6]=a*u,e[7]=l*u,e[8]=c*u}(ne);const v=e.attributes.get(A.T.POSITION),g=e.attributes.get(A.T.SIZE),m=e.attributes.get(A.T.NORMAL),_=e.attributes.get(A.T.AUXPOS1);(0,O.hu)(v.size>=3);const y=(0,D.c)(l),w="screen"===this.parameters.centerOffsetUnits;for(let o=0;o<v.data.length/v.size;o++){const e=o*v.size;(0,h.s)(K,v.data[e],v.data[e+1],v.data[e+2]),(0,h.e)(K,K,t);const r=o*g.size;pe[0]=g.data[r]*p,pe[1]=g.data[r+1]*f,(0,h.e)(K,K,d.viewMatrix);const n=o*_.size;if((0,h.s)(ae,_.data[n],_.data[n+1],_.data[n+2]),!w&&(K[0]+=ae[0],K[1]+=ae[1],0!==ae[2])){const e=ae[2];(0,h.n)(ae,K),(0,h.f)(K,K,(0,h.i)(ae,ae,e))}const T=o*m.size;if((0,h.s)(ee,m.data[T],m.data[T+1],m.data[T+2]),this._normalAndViewAngle(ee,ne,d,de),this._applyVerticalOffsetTransformationView(K,de,d,Q),d.applyProjection(K,te),te[0]>-1){w&&(ae[0]||ae[1])&&(te[0]+=ae[0]*d.pixelRatio,0!==ae[1]&&(te[1]+=(0,S.sX)(ae[1],Q.factorAlignment)*d.pixelRatio),d.unapplyProjection(te,K)),te[0]+=this.parameters.screenOffset[0]*d.pixelRatio,te[1]+=this.parameters.screenOffset[1]*d.pixelRatio,te[0]=Math.floor(te[0]),te[1]=Math.floor(te[1]),(0,S.TU)(pe,Q.factor,pe);const e=he*d.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*d.pixelRatio/2),X(c,te[0],te[1],pe,e,t,l,y)){const e=i.ray;if((0,h.e)(re,K,(0,a.i)(se,d.viewMatrix)),te[0]=c[0],te[1]=c[1],d.unprojectFromRenderScreen(te,K)){const t=(0,u.c)();(0,h.c)(t,e.direction);const i=1/(0,h.l)(t);(0,h.i)(t,t,i),s((0,h.o)(e.origin,K)*i,t,-1,!0,1,re)}}}}}intersectDraped(e,t,i,r,n,o){const s=e.attributes.get(A.T.POSITION),a=e.attributes.get(A.T.SIZE),l=this.parameters,c=(0,D.c)(l);let{scaleX:d,scaleY:h}=this._getScreenScale(e);d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=ue*e.screenToWorldRatio;for(let p=0;p<s.data.length/s.size;p++){const t=p*s.size,i=s.data[t],f=s.data[t+1],v=p*a.size;pe[0]=a.data[v]*d,pe[1]=a.data[v+1]*h;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),X(r,i,f,pe,u,g,l,c)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new _e(this)}_normalAndViewAngle(e,t,i,r){return f(t)&&(t=(0,o.f)(oe,t)),(0,h.t)(r.normal,e,t),(0,h.e)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,h.j)(ie,fe),r}_updateScaleInfo(e,t,i){const r=this.parameters;null!=r.screenSizePerspective?(0,S.PV)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,S.PV)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,i,r,n,o,s){const a=this._normalAndViewAngle(t,i,n,de);return this._applyVerticalGroundOffsetView(e,a,n,s),this._applyVerticalOffsetTransformationView(s,a,n,o),this._applyPolygonOffsetView(s,a,r[3],n,s),this._applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,n){return this._applyCenterOffsetNDC(e,t,i,r),null!=n&&(0,h.c)(n,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,r,o){const s=r.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=s);const l=s*a;if(this.parameters.shaderPolygonOffset<=0)return(0,h.c)(o,e);const c=(0,n.uZ)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/r.viewport[2];return(0,h.i)(o,e,l>0?d:1/d),o}_applyVerticalGroundOffsetView(e,t,i,r){const n=(0,h.l)(e),o=i.aboveGround?1:-1,s=i.computeRenderPixelSizeAtDist(n)*T.c,a=(0,h.i)(K,t.normal,o*s);return(0,h.g)(r,e,a),r}_applyVerticalOffsetTransformationView(e,t,i,r){var n,o;const s=this.parameters;if(null===(n=s.verticalOffset)||void 0===n||!n.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const i=(0,h.l)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=(0,h.l)(e),l=null!==(o=s.screenSizePerspectiveAlignment)&&void 0!==o?o:s.screenSizePerspective,c=(0,E.Hx)(i,a,s.verticalOffset,t.cosAngle,l);return this._updateScaleInfo(r,a,t.cosAngle),(0,h.i)(t.normal,t.normal,c),(0,h.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,h.c)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,h.n)(ee,i),(0,h.g)(i,i,(0,h.i)(ee,ee,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,h.c)(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&(0,h.c)(r,e),n){const e=i.aboveGround?1:-1,o=e*Math.sign(t[3]);r[2]-=(o||e)*n}return r}produces(e,t){if(t===w.H.Color||t===w.H.Alpha||t===w.H.Highlight||t===w.H.ObjectAndLayerIdColor){if(e===x.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?x.r.LABEL_MATERIAL:x.r.HUD_MATERIAL)||i&&e===x.r.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new Y(e)}calculateRelativeScreenBounds(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,v.Ue)();return function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$;(0,c.j)(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const t=e.attributes.get(A.T.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const i=(0,p.b)(t.data,ce),[r,n]=(0,m.FE)(le,this.parameters,i);return{scaleX:r,scaleY:n}}}class Y extends b.F{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(V,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function X(e,t,i,r,n,o,s,a){let l=t-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,d=i-n-(a[1]>0?r[1]*a[1]:0),h=d+r[1]+2*n;const u=s.distanceFieldBoundingBox;return s.textureIsSignedDistanceField&&null!=u&&(l+=r[0]*u[0],d+=r[1]*u[1],c-=r[0]*(1-u[2]),h-=r[1]*(1-u[3]),l-=o,c+=o,d-=o,h+=o),e[0]>l&&e[0]<c&&e[1]>d&&e[1]<h}const Q=new class{constructor(){this.factor=new R,this.factorAlignment=new R}},$=(0,d.a)(),K=(0,u.c)(),ee=(0,u.c)(),te=(0,p.c)(),ie=(0,u.c)(),re=(0,u.c)(),ne=(0,s.a)(),oe=(0,s.a)(),se=(0,l.a)(),ae=(0,u.c)(),le=(0,p.c)(),ce=(0,p.c)(),de={normal:ie,cosAngle:0},he=1,ue=2,pe=[0,0],fe=(0,u.f)(0,0,1);class ve extends b.E{constructor(){super(...arguments),this.renderOccluded=C.yD.Occlude,this.isDecoration=!1,this.color=(0,p.f)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,d.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,p.f)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const ge=(0,y.U$)().vec3f(A.T.POSITION).vec3f(A.T.NORMAL).vec2f(A.T.UV0).vec4u8(A.T.COLOR).vec2f(A.T.SIZE).vec4f(A.T.AUXPOS1).vec4f(A.T.FEATUREATTRIBUTE),me=ge.clone().vec4u8(A.T.OBJECTANDLAYERIDCOLOR);class _e{constructor(e){this._material=e,this.vertexBufferLayout=(0,r.Z)("enable-feature:objectAndLayerId-rendering")?me:ge}elementCount(e){return 6*e.attributes.get(A.T.POSITION).indices.length}write(e,t,i,r,n){(0,P.ho)(i.attributes.get(A.T.POSITION),e,r.position,n,6),(0,P.s5)(i.attributes.get(A.T.NORMAL),t,r.normal,n,6);const o=i.attributes.get(A.T.UV0).data;let s,a,l,c;if(null==o||o.length<4){const e=this._material.parameters;s=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else s=o[0],a=o[1],l=o[2],c=o[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let d=i.attributes.get(A.T.POSITION).indices.length,h=n;const u=r.uv0;for(let g=0;g<d;++g)u.set(h,0,s),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,s),u.set(h,1,c),h++,u.set(h,0,s),u.set(h,1,a),h++;(0,P.Vs)(i.attributes.get(A.T.COLOR),4,r.color,n,6);const{data:p,indices:f}=i.attributes.get(A.T.SIZE);d=f.length;const v=r.size;h=n;for(let g=0;g<d;++g){const e=p[2*f[g]],t=p[2*f[g]+1];for(let i=0;i<6;++i)v.set(h,0,e),v.set(h,1,t),h++}if(i.attributes.get(A.T.AUXPOS1)?(0,P.SW)(i.attributes.get(A.T.AUXPOS1),r.auxpos1,n,6):(0,P.h)(r.auxpos1,n,6*d),i.attributes.get(A.T.FEATUREATTRIBUTE)?(0,P.SW)(i.attributes.get(A.T.FEATUREATTRIBUTE),r.featureAttribute,n,6):(0,P.h)(r.featureAttribute,n,6*d),null!=i.objectAndLayerIdColor){var m;const e=null===(m=i.attributes.get(A.T.POSITION))||void 0===m?void 0:m.indices;if(e){const t=e.length,o=r.getField(A.T.OBJECTANDLAYERIDCOLOR,g.mc);(0,P.xP)(i.objectAndLayerIdColor,o,t,n,6)}}}}},58901:(e,t,i)=>{i.d(t,{U:()=>N});var r=i(93169),n=i(32718),o=i(16889),s=i(17842),a=i(88396),l=i(11186),c=i(71353),d=i(67077),h=i(95773),u=i(85981),p=i(55652),f=i(55158),v=i(37081),g=i(23620),m=i(56529),_=i(93822),y=i(97731),w=i(4760),T=i(65964),b=i(33720),C=i(98186),x=i(82144),S=i(31132),O=i(78041),A=i(27627),R=i(50411),P=i(25920),E=i(8548),D=i(36207);const I=new Map([[w.T.POSITION,0],[w.T.SUBDIVISIONFACTOR,1],[w.T.UV0,2],[w.T.AUXPOS1,3],[w.T.AUXPOS2,4],[w.T.COLOR,5],[w.T.COLORFEATUREATTRIBUTE,5],[w.T.SIZE,6],[w.T.SIZEFEATUREATTRIBUTE,6],[w.T.OPACITYFEATUREATTRIBUTE,7],[w.T.OBJECTANDLAYERIDCOLOR,8]]);class M extends S.A{initializeProgram(e){return new A.$(e.rctx,M.shader.get().build(this.configuration),I)}_makePipelineState(e,t){const i=this.configuration,r=e===P.A.NONE,n=e===P.A.FrontFace;return(0,D.sm)({blending:i.output===v.H.Color||i.output===v.H.Alpha?r?O.wu:(0,O.j7)(e):null,depthTest:{func:(0,O.Bh)(e)},depthWrite:r?i.writeDepth?D.LZ:null:(0,O.K5)(e),colorWrite:D.BK,stencilWrite:i.hasOccludees?R.s3:null,stencilTest:i.hasOccludees?t?R.eD:R.RY:null,polygonOffset:r||n?i.hasPolygonOffset?L:null:O.E0})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?L:null;this._occluderPipelineTransparent=(0,D.sm)({blending:O.wu,polygonOffset:t,depthTest:R.zV,depthWrite:null,colorWrite:D.BK,stencilWrite:null,stencilTest:R.YD}),this._occluderPipelineOpaque=(0,D.sm)({blending:O.wu,polygonOffset:t,depthTest:R.zV,depthWrite:null,colorWrite:D.BK,stencilWrite:R.P7,stencilTest:R.ii}),this._occluderPipelineMaskWrite=(0,D.sm)({blending:null,polygonOffset:t,depthTest:R.JN,depthWrite:null,colorWrite:null,stencilWrite:R.s3,stencilTest:R.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?E.MX.LINES:E.MX.TRIANGLE_STRIP}getPipeline(e,t,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}M.shader=new x.J(C.R,(()=>i.e(6279).then(i.bind(i,56279))));const L={factor:0,units:-4};var H,F=i(737);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(H||(H={}));class N extends m.F5{constructor(e){super(e,new j),this._configuration=new F.G,this._vertexAttributeLocations=I}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.r.DRAPED_MATERIAL;const i=null!=this.parameters.stipplePattern&&e!==v.H.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===b.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,i,r,n,s){if(!i.options.selectionMode)return;const a=e.attributes.get(w.T.POSITION).data,l=e.attributes.get(w.T.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(w.T.SIZEFEATUREATTRIBUTE).data[0];c*=(0,o.uZ)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const d=r[0],h=r[1],u=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let v=0;v<a.length-5;v+=3){const e=a[v],t=a[v+1],i=d-e,r=h-t,n=a[v+3]-e,s=a[v+4]-t,l=(0,o.uZ)((n*i+s*r)/(n*n+s*s),0,1),c=n*l-i,u=s*l-r,g=c*c+u*u;g<p&&(p=g,f=v/3)}p<u*u&&n(s.dist,s.normal,f,!1)}intersect(e,t,i,r,s,c){if(!i.options.selectionMode||!e.visible)return;if(!(0,y.kG)(t))return void n.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const d=e.attributes,f=d.get(w.T.POSITION).data;let v=this.parameters.width;if(this.parameters.vvSize){const e=d.get(w.T.SIZEFEATUREATTRIBUTE).data[0];v*=(0,o.uZ)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else d.has(w.T.SIZE)&&(v*=d.get(w.T.SIZE).data[0]);const g=i.camera,m=q;(0,a.j)(m,i.point);const _=v*g.pixelRatio/2+4*g.pixelRatio;(0,l.s)(re[0],m[0]-_,m[1]+_,0),(0,l.s)(re[1],m[0]+_,m[1]+_,0),(0,l.s)(re[2],m[0]+_,m[1]-_,0),(0,l.s)(re[3],m[0]-_,m[1]-_,0);for(let n=0;n<4;n++)if(!g.unprojectFromRenderScreen(re[n],ne[n]))return;(0,p.zk)(g.eye,ne[0],ne[1],oe),(0,p.zk)(g.eye,ne[1],ne[2],se),(0,p.zk)(g.eye,ne[2],ne[3],ae),(0,p.zk)(g.eye,ne[3],ne[0],le);let T=Number.MAX_VALUE,b=0;const C=Z(this.parameters,d)?f.length-2:f.length-5;for(let n=0;n<C;n+=3){G[0]=f[n]+t[12],G[1]=f[n+1]+t[13],G[2]=f[n+2]+t[14];const e=(n+3)%f.length;if(B[0]=f[e]+t[12],B[1]=f[e+1]+t[13],B[2]=f[e+2]+t[14],(0,p.jH)(oe,G)<0&&(0,p.jH)(oe,B)<0||(0,p.jH)(se,G)<0&&(0,p.jH)(se,B)<0||(0,p.jH)(ae,G)<0&&(0,p.jH)(ae,B)<0||(0,p.jH)(le,G)<0&&(0,p.jH)(le,B)<0)continue;if(g.projectToRenderScreen(G,J),g.projectToRenderScreen(B,Y),J[2]<0&&Y[2]>0){(0,l.f)(W,G,B);const e=g.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],G)/(0,l.j)(W,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.i)(W,W,t),(0,l.g)(G,G,W),g.projectToRenderScreen(G,J)}else if(J[2]>0&&Y[2]<0){(0,l.f)(W,B,G);const e=g.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],B)/(0,l.j)(W,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.i)(W,W,t),(0,l.g)(B,B,W),g.projectToRenderScreen(B,Y)}else if(J[2]<0&&Y[2]<0)continue;J[2]=0,Y[2]=0;const i=(0,u.Jk)((0,u.zk)(J,Y,$),m);i<T&&(T=i,(0,l.c)(X,G),(0,l.c)(Q,B),b=n/3)}const x=i.rayBegin,S=i.rayEnd;if(T<_*_){let e=Number.MAX_VALUE;if((0,u.AR)((0,u.zk)(X,Q,$),(0,u.zk)(x,S,K),k)){(0,l.f)(k,k,x);const t=(0,l.l)(k);(0,l.i)(k,k,1/t),e=t/(0,l.o)(x,S)}c(e,k,b,!1)}}get _layout(){const e=(0,f.U$)().vec3f(w.T.POSITION).f32(w.T.SUBDIVISIONFACTOR).vec2f(w.T.UV0).vec3f(w.T.AUXPOS1).vec3f(w.T.AUXPOS2);return this.parameters.vvSize?e.f32(w.T.SIZEFEATUREATTRIBUTE):e.f32(w.T.SIZE),this.parameters.vvColor?e.f32(w.T.COLORFEATUREATTRIBUTE):e.vec4f(w.T.COLOR),this.parameters.vvOpacity&&e.f32(w.T.OPACITYFEATUREATTRIBUTE),(0,r.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(w.T.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new U(this._layout,this.parameters)}produces(e,t){return(t===v.H.Color||t===v.H.Alpha||t===v.H.Highlight||t===v.H.Depth||t===v.H.ObjectAndLayerIdColor)&&(e===_.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil?e===_.r.OPAQUE_MATERIAL||e===_.r.OCCLUDER_MATERIAL||e===_.r.TRANSPARENT_OCCLUDER_MATERIAL:t===v.H.Color||t===v.H.Alpha?e===(this.parameters.writeDepth?_.r.TRANSPARENT_MATERIAL:_.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===_.r.OPAQUE_MATERIAL))}createGLMaterial(e){return new z(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class z extends g.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==v.H.Color&&this._output!==v.H.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(M,e)}}class j extends T.n{constructor(){super(...arguments),this.width=0,this.color=d.O,this.join="miter",this.cap=F.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class U{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const i=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=C.r+i}}_isClosed(e){return Z(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(w.T.POSITION).indices.length/2+1,i=this._isClosed(e);let r=i?2:4;return r+=((i?t:t-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}write(e,t,i,n,o){var s;const a=ee,c=te,d=ie,h=i.attributes.get(w.T.POSITION),u=h.indices,p=h.data.length/3,f=null===(s=i.attributes.get(w.T.DISTANCETOSTART))||void 0===s?void 0:s.data;u&&u.length!==2*(p-1)&&console.warn("RibbonLineMaterial does not support indices");let v=1,g=0;const m=this.vertexBufferLayout.fields.has(w.T.SIZEFEATUREATTRIBUTE);m?g=i.attributes.get(w.T.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(w.T.SIZE)&&(v=i.attributes.get(w.T.SIZE).data[0]);let _=[1,1,1,1],y=0;const T=this.vertexBufferLayout.fields.has(w.T.COLORFEATUREATTRIBUTE);T?y=i.attributes.get(w.T.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(w.T.COLOR)&&(_=i.attributes.get(w.T.COLOR).data);const b=(0,r.Z)("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let C=0;const x=this.vertexBufferLayout.fields.has(w.T.OPACITYFEATUREATTRIBUTE);x&&(C=i.attributes.get(w.T.OPACITYFEATUREATTRIBUTE).data[0]);const S=new Float32Array(n.buffer),O=(0,r.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,A=this.vertexBufferLayout.stride/4;let R=o*A;const P=R;let E=0;const D=f?(e,t,i)=>E=f[i]:(e,t,i)=>E+=(0,l.o)(e,t),I=(0,r.Z)("enable-feature:objectAndLayerId-rendering"),M=(e,t,i,r,n,o,s)=>{if(S[R++]=t[0],S[R++]=t[1],S[R++]=t[2],S[R++]=r,S[R++]=s,S[R++]=n,S[R++]=e[0],S[R++]=e[1],S[R++]=e[2],S[R++]=i[0],S[R++]=i[1],S[R++]=i[2],S[R++]=m?g:v,T)S[R++]=y;else{const e=Math.min(4*o,_.length-4);S[R++]=_[e],S[R++]=_[e+1],S[R++]=_[e+2],S[R++]=_[e+3]}x&&(S[R++]=C),I&&(null!=b&&(O[4*R]=b[0],O[4*R+1]=b[1],O[4*R+2]=b[2],O[4*R+3]=b[3]),R++)};R+=A,(0,l.s)(c,h.data[0],h.data[1],h.data[2]),e&&(0,l.e)(c,c,e);const L=this._isClosed(i);if(L){const t=h.data.length-3;(0,l.s)(a,h.data[t],h.data[t+1],h.data[t+2]),e&&(0,l.e)(a,a,e)}else(0,l.s)(d,h.data[3],h.data[4],h.data[5]),e&&(0,l.e)(d,d,e),M(c,c,d,1,H.LEFT_CAP_START,0,0),M(c,c,d,1,H.RIGHT_CAP_START,0,0),(0,l.c)(a,c),(0,l.c)(c,d);const F=L?0:1,N=L?p:p-1;for(let r=F;r<N;r++){const t=(r+1)%p*3;(0,l.s)(d,h.data[t],h.data[t+1],h.data[t+2]),e&&(0,l.e)(d,d,e),D(a,c,r),M(a,c,d,0,H.LEFT_JOIN_END,r,E),M(a,c,d,0,H.RIGHT_JOIN_END,r,E);const i=this.numJoinSubdivisions;for(let e=0;e<i;++e){const t=(e+1)/(i+1);M(a,c,d,t,H.LEFT_JOIN_END,r,E),M(a,c,d,t,H.RIGHT_JOIN_END,r,E)}M(a,c,d,1,H.LEFT_JOIN_START,r,E),M(a,c,d,1,H.RIGHT_JOIN_START,r,E),(0,l.c)(a,c),(0,l.c)(c,d)}L?((0,l.s)(d,h.data[3],h.data[4],h.data[5]),e&&(0,l.e)(d,d,e),E=D(a,c,N),M(a,c,d,0,H.LEFT_JOIN_END,F,E),M(a,c,d,0,H.RIGHT_JOIN_END,F,E)):(E=D(a,c,N),M(a,c,c,0,H.LEFT_CAP_END,N,E),M(a,c,c,0,H.RIGHT_CAP_END,N,E)),V(S,P+A,S,P,A),R=V(S,R-A,S,R,A),this._parameters.wireframe&&this._addWireframeVertices(n,P,R,A)}_addWireframeVertices(e,t,i,r){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let s=0;const a=e=>s=V(o,e,n,s,r);for(let l=0;l<o.length-1;l+=2*r)a(l),a(l+2*r),a(l+1*r),a(l+2*r),a(l+1*r),a(l+3*r)}}function V(e,t,i,r,n){for(let o=0;o<n;o++)i[r++]=e[t++];return r}function Z(e,t){return!!e.isClosed&&t.get(w.T.POSITION).indices.length>2}const G=(0,c.c)(),B=(0,c.c)(),W=(0,c.c)(),k=(0,c.c)(),q=(0,c.c)(),J=(0,s.J$)(),Y=(0,s.J$)(),X=(0,c.c)(),Q=(0,c.c)(),$=(0,u.Ue)(),K=(0,u.Ue)(),ee=(0,c.c)(),te=(0,c.c)(),ie=(0,c.c)(),re=[(0,s.J$)(),(0,s.J$)(),(0,s.J$)(),(0,s.J$)()],ne=[(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)()],oe=(0,p.Ue)(),se=(0,p.Ue)(),ae=(0,p.Ue)(),le=(0,p.Ue)()},11983:(e,t,i)=>{i.d(t,{c:()=>o});var r=i(56529),n=i(22909);class o extends r.F5{intersect(e,t,i,r,o,s){return(0,n.Bw)(e,i,r,o,void 0,s)}}},47475:(e,t,i)=>{i.d(t,{H:()=>I,m:()=>M});var r=i(93169),n=i(38499),o=i(6394),s=i(71353),a=i(67077),l=i(37081);class c{constructor(){this.enabled=!0,this._time=(0,n.HA)(0)}get time(){return this._time}advance(e){let{deltaTime:t,fixedTime:i}=e;return null!=i?this._time!==i&&(this._time=i,!0):(this._time=(0,n.HA)(this._time+t),0!==t)}}var d=i(56529),h=i(78041),u=i(93822),p=i(12594),f=i(64642),v=i(11983),g=i(23620),m=i(27366),_=i(50951),y=i(41481),w=(i(79246),i(82144)),T=i(31132),b=i(33559),C=i(7566),x=i(27627),S=i(25920),O=i(8883),A=i(49810),R=i(36207);class P extends T.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===_.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new x.$(e.rctx,P.shader.get().build(this.configuration),C.i)}_setPipelineState(e){const t=this.configuration,i=e===S.A.NONE,r=e===S.A.FrontFace;return(0,R.sm)({blending:t.output!==l.H.Normal&&t.output!==l.H.Highlight&&t.output!==l.H.ObjectAndLayerIdColor&&t.transparent?i?h.wu:(0,h.j7)(e):null,depthTest:{func:(0,h.Bh)(e)},depthWrite:i?t.writeDepth?R.LZ:null:(0,h.K5)(e),colorWrite:R.BK,polygonOffset:i||r?null:(0,h.je)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}P.shader=new w.J(A.W,(()=>i.e(9106).then(i.bind(i,19106))));class E extends O.W{constructor(){super(...arguments),this.output=l.H.Color,this.transparencyPassType=S.A.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,m._)([(0,b.o)({count:l.H.COUNT})],E.prototype,"output",void 0),(0,m._)([(0,b.o)({count:S.A.COUNT})],E.prototype,"transparencyPassType",void 0),(0,m._)([(0,b.o)()],E.prototype,"spherical",void 0),(0,m._)([(0,b.o)()],E.prototype,"receiveShadows",void 0),(0,m._)([(0,b.o)()],E.prototype,"hasSlicePlane",void 0),(0,m._)([(0,b.o)()],E.prototype,"transparent",void 0),(0,m._)([(0,b.o)()],E.prototype,"enableOffset",void 0),(0,m._)([(0,b.o)()],E.prototype,"writeDepth",void 0),(0,m._)([(0,b.o)()],E.prototype,"hasScreenSpaceReflections",void 0),(0,m._)([(0,b.o)()],E.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,m._)([(0,b.o)()],E.prototype,"hasCloudsReflections",void 0),(0,m._)([(0,b.o)()],E.prototype,"objectAndLayerIdColorInstanced",void 0),(0,m._)([(0,b.o)()],E.prototype,"isDraped",void 0),(0,m._)([(0,b.o)()],E.prototype,"multipassEnabled",void 0),(0,m._)([(0,b.o)()],E.prototype,"cullAboveGround",void 0),(0,m._)([(0,b.o)({constValue:!1})],E.prototype,"occlusionPass",void 0),(0,m._)([(0,b.o)({constValue:y.f7.Water})],E.prototype,"pbrMode",void 0),(0,m._)([(0,b.o)({constValue:!0})],E.prototype,"useCustomDTRExponentForWater",void 0),(0,m._)([(0,b.o)({constValue:!0})],E.prototype,"highStepCount",void 0),(0,m._)([(0,b.o)({constValue:!1})],E.prototype,"useFillLights",void 0);class D extends g.Z{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const t=null!=e.ssr.lastFrameColor;t!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t})}_updateCloudsReflectionState(e){const t=null!=e.cloudsFade.data;t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===l.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(P,e)}}class I extends v.c{constructor(e){super(e,new M),this._configuration=new E,this._animation=new c}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<h.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<L;const i=this._animation.advance(e);return this.setParameters({timeElapsed:(0,n.D9)(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}produces(e,t){switch(t){case l.H.Normal:return e===u.r.DRAPED_WATER;case l.H.Color:if(this.parameters.isDraped)return e===u.r.DRAPED_MATERIAL;break;case l.H.Alpha:break;case l.H.Highlight:case l.H.ObjectAndLayerIdColor:return e===u.r.OPAQUE_MATERIAL||e===u.r.DRAPED_MATERIAL;default:return!1}let i=u.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?u.r.TRANSPARENT_MATERIAL:u.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new D(e)}createBufferWriter(){return new p.G((0,r.Z)("enable-feature:objectAndLayerId-rendering")?f.lV:f.W1)}get test(){return{animationEnabled:this._animation.enabled}}}class M extends d.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,o.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,a.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=(0,s.c)(),this.modelTransformation=null}}const L=35e3},86700:(e,t,i)=>{i.d(t,{Dp:()=>a,z5:()=>s});const r={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:r.dash,"dash-dot":[...r.dash,...r.dot],dot:r.dot,"long-dash":r["long-dash"],"long-dash-dot":[...r["long-dash"],...r.dot],"long-dash-dot-dot":[...r["long-dash"],...r.dot,...r.dot],none:null,"short-dash":r["short-dash"],"short-dash-dot":[...r["short-dash"],...r["short-dot"]],"short-dash-dot-dot":[...r["short-dash"],...r["short-dot"],...r["short-dot"]],"short-dot":r["short-dot"],solid:null},o=8;function s(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(n[e],o):null}(e.style):null}},33720:(e,t,i)=>{i.d(t,{I9:()=>r,PI:()=>d,i5:()=>n});var r,n,o=i(27366),s=i(37081),a=i(33559),l=i(25920),c=i(8883);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class d extends c.W{constructor(){super(...arguments),this.output=s.H.Color,this.transparencyPassType=l.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=r.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===r.Draped}}(0,o._)([(0,a.o)({count:s.H.COUNT})],d.prototype,"output",void 0),(0,o._)([(0,a.o)({count:l.A.COUNT})],d.prototype,"transparencyPassType",void 0),(0,o._)([(0,a.o)()],d.prototype,"occluder",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasSlicePlane",void 0),(0,o._)([(0,a.o)()],d.prototype,"writeDepth",void 0),(0,o._)([(0,a.o)({count:r.COUNT})],d.prototype,"space",void 0),(0,o._)([(0,a.o)()],d.prototype,"hideOnShortSegments",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasCap",void 0),(0,o._)([(0,a.o)({count:n.COUNT})],d.prototype,"anchor",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasTip",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvSize",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvColor",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvOpacity",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasOccludees",void 0),(0,o._)([(0,a.o)()],d.prototype,"multipassEnabled",void 0),(0,o._)([(0,a.o)()],d.prototype,"cullAboveGround",void 0),(0,o._)([(0,a.o)({constValue:!1})],d.prototype,"occlusionPass",void 0),(0,o._)([(0,a.o)({constValue:!0})],d.prototype,"hasVvInstancing",void 0),(0,o._)([(0,a.o)({constValue:!0})],d.prototype,"hasSliceTranslatedView",void 0)},737:(e,t,i)=>{i.d(t,{G:()=>c,R:()=>r});var r,n=i(27366),o=i(37081),s=i(33559),a=i(25920),l=i(8883);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));class c extends l.W{constructor(){super(...arguments),this.output=o.H.Color,this.capType=r.BUTT,this.transparencyPassType=a.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,n._)([(0,s.o)({count:o.H.COUNT})],c.prototype,"output",void 0),(0,n._)([(0,s.o)({count:r.COUNT})],c.prototype,"capType",void 0),(0,n._)([(0,s.o)({count:a.A.COUNT})],c.prototype,"transparencyPassType",void 0),(0,n._)([(0,s.o)()],c.prototype,"occluder",void 0),(0,n._)([(0,s.o)()],c.prototype,"hasSlicePlane",void 0),(0,n._)([(0,s.o)()],c.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,s.o)()],c.prototype,"writeDepth",void 0),(0,n._)([(0,s.o)()],c.prototype,"draped",void 0),(0,n._)([(0,s.o)()],c.prototype,"stippleEnabled",void 0),(0,n._)([(0,s.o)()],c.prototype,"stippleOffColorEnabled",void 0),(0,n._)([(0,s.o)()],c.prototype,"stipplePreferContinuous",void 0),(0,n._)([(0,s.o)()],c.prototype,"roundJoins",void 0),(0,n._)([(0,s.o)()],c.prototype,"applyMarkerOffset",void 0),(0,n._)([(0,s.o)()],c.prototype,"vvSize",void 0),(0,n._)([(0,s.o)()],c.prototype,"vvColor",void 0),(0,n._)([(0,s.o)()],c.prototype,"vvOpacity",void 0),(0,n._)([(0,s.o)()],c.prototype,"falloffEnabled",void 0),(0,n._)([(0,s.o)()],c.prototype,"innerColorEnabled",void 0),(0,n._)([(0,s.o)()],c.prototype,"hasOccludees",void 0),(0,n._)([(0,s.o)()],c.prototype,"multipassEnabled",void 0),(0,n._)([(0,s.o)()],c.prototype,"cullAboveGround",void 0),(0,n._)([(0,s.o)()],c.prototype,"wireframe",void 0),(0,n._)([(0,s.o)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,n._)([(0,s.o)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,n._)([(0,s.o)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,n._)([(0,s.o)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},45412:(e,t,i)=>{i.d(t,{U:()=>c});var r=i(32718),n=i(92026),o=i(18722),s=i(8548),a=i(3384);const l=r.Z.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].byteLength),null!=this._indexBuffer?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*o.ru}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers){var e;null!==(e=this._buffers[t])&&void 0!==e&&e.dispose(),delete this._buffers[t]}this._indexBuffer=(0,n.M2)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l.warn("Leaked WebGL VAO")}disposeVAOOnly(){if(this._glName){var e;(null===(e=this._context)||void 0===e||null===(e=e.capabilities)||void 0===e?void 0:e.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s._g.VertexArrayObject,this)}this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s._g.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||l.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const n in e){const i=e[n];i||l.error("Vertex buffer is uninitialized!");const r=t[n];r||l.error("Vertex element descriptor is empty!"),(0,a.XP)(this._context,this._locations,i,r)}null!=i&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||l.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||l.error("Vertex buffer is uninitialized!");const n=t[i];(0,a.UF)(this._context,this._locations,r,n)}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},61109:(e,t,i)=>{i.d(t,{G:()=>r});class r{constructor(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=n,this.normalized=o,this.divisor=s}}}}]);
//# sourceMappingURL=5029.9a01fdc0.chunk.js.map