(this["webpackJsonpok-wpa-maps"]=this["webpackJsonpok-wpa-maps"]||[]).push([[0],{29:function(e,t,a){e.exports=a(50)},34:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(4),o=a.n(i),l=(a(34),a(3)),s=a(13),c=a.n(s),u=a(10),d=a(11);function m(e){var t=Object(n.useState)([{content:r.a.createElement("div",null,r.a.createElement("h1",null,"Draw and transcribe map data"),r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{alt:"Draw a shape representing a \r parcel of land and transcribe the ",src:"/ok-wpa-maps/img/wpa3.gif"}))),placement:"auto",target:".drawShapes",disableBeacon:!0},{content:r.a.createElement("div",null,r.a.createElement("h1",null,"Review existing entries"),r.a.createElement("h3",null,"If you don't see any errors, click ",r.a.createElement("strong",null,r.a.createElement("calcite-icon",{scale:"s",icon:"check"}),"Looks Good!")),r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa7.gif"}))),placement:"auto",target:".reviewShapes",disableBeacon:!0},{content:r.a.createElement("div",null,r.a.createElement("h1",null,"Review existing entries"),r.a.createElement("h3",null,"If you see something incorrect or missing, click ",r.a.createElement("strong",null,r.a.createElement("calcite-icon",{scale:"s",icon:"pencil"}),"Edit feature")),r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{alt:"Reviewing parcels",src:"/ok-wpa-maps/img/wpa8.gif"}))),placement:"auto",target:".reviewShapes",disableBeacon:!0},{content:r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Right click and drag to change the rotation of the map."),r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{alt:"Demonstration of rotating the map",src:"/ok-wpa-maps/img/wpa4.gif"})),r.a.createElement("p",null," Press the compass button to reset")),placement:"center",target:"body",disableBeacon:!0},{content:r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Keep track of your progress."),r.a.createElement("div",{className:"imgContainer"}),r.a.createElement("p",null,"Sign in with your ArcGIS Online account. Or, ",r.a.createElement("a",{href:"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id=l3OWRmRCGfkAN4Dh&redirect_uri=http://localhost:3000/ok-wpa-maps&response_type=code"},"create one")," for free.")),placement:"center",target:".trackProgress",disableBeacon:!0},{content:r.a.createElement("div",null,r.a.createElement("a",{href:"https://info.library.okstate.edu/map-room/wpa-maps"},r.a.createElement("h1",null,"Click to learn more about the collection"))),placement:"center",target:"body",disableBeacon:!0}]),a=Object(l.a)(t,2),i=a[0];a[1];return r.a.createElement(d.b,{callback:function(t){var a=t.status;t.type,[d.a.FINISHED,d.a.SKIPPED].includes(a)&&e.toggleIntro(!1)},continuous:!0,floaterProps:{disableAnimation:!0},run:e.runIntro,scrollToFirstStep:!0,showProgress:!0,showSkipButton:!0,steps:i,styles:{options:{zIndex:1e4,width:800}}})}var p=a(25),h=a(26),g=a(6),f=a(28),w=a(27),b={title:"Land Info",elements:[{type:"group",label:"Owner Information",elements:[{type:"field",fieldName:"OwnerLastName",label:"Owner's Last Name (if an individual)"},{type:"field",fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{type:"field",fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"}]},{type:"group",label:"Land and Improvement Valuation",elements:[{type:"field",fieldName:"LandValue",label:"Land Value"},{type:"field",fieldName:"ImprovementsValue2",label:"Improvements Value"}]},{type:"field",fieldName:"TaxExempt",label:"Marked with an X?"}]},v={title:"Please doublecheck the info below.",content:[{type:"fields",fieldInfos:[{fieldName:"OwnerLastName",label:"Owner's Last Name (if an individual)"},{fieldName:"OwnerFirstNameAndMI",label:"Owner's First Name or initials (if an individual)"},{fieldName:"OwnerOrgName",label:"Owner (if an entity or organization)"},{fieldName:"LandValue",label:"Land Value"},{fieldName:"ImprovementsValue2",label:"Improvements Value"},{fieldName:"TaxExempt",label:"Marked with an X?"}]}],actions:[{title:"Looks good!",id:"this-looks-ok",className:"esri-icon-check-mark"},{title:"Edit feature",id:"edit-this",className:"esri-icon-edit"}]};function k(e){return Math.floor(Math.random()*Math.floor(e))}var E=function(e){Object(f.a)(a,e);var t=Object(w.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).featureTileUrl="https://tiles.arcgis.com/tiles/jWQlP64OuwDh6GGX/arcgis/rest/services/_wpa_all_6Aug2020/MapServer",n.featureVectorUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0",n.backgroundFeatureUrl="https://services1.arcgis.com/jWQlP64OuwDh6GGX/ArcGIS/rest/services/Oklahoma_Public_Land_Survey_Sections/FeatureServer/0",n.mapRef=r.a.createRef(),n.workflow=e.workflow,n.editThis=n.editThis.bind(Object(g.a)(n)),n.sayThanks=n.sayThanks.bind(Object(g.a)(n)),n.reviewWorkflow=n.reviewWorkflow.bind(Object(g.a)(n)),n.getRandomFeatureForReview=n.getRandomFeatureForReview.bind(Object(g.a)(n)),n.getRandomBackgroundFeature=n.getRandomBackgroundFeature.bind(Object(g.a)(n)),n.toggleLoadIndicator=n.toggleLoadIndicator.bind(Object(g.a)(n)),n.rotationChange=n.rotationChange.bind(Object(g.a)(n)),n.updateTimesChecked=n.updateTimesChecked.bind(Object(g.a)(n)),n.state={updateFeature:null,mapRotation:0,backgroundFeatureObjectIds:null,loadIndicator:!0},n}return Object(h.a)(a,[{key:"getRandomFeatureForReview",value:function(){var e=this,t=this,a=k(this.objectIds.length-1),n=this.featureVectorLayer.createQuery();n.where="OBJECTID = "+this.objectIds[a],this.featureVectorLayer.queryFeatures(n).then((function(a){t.view.goTo(a.features[0].geometry.extent),t.view.popup.features=a.features,t.view.popup.visible=!0,t.setState({updateFeature:a.features[0]}),e.view.whenLayerView(e.featureVectorLayer).then((function(e){t.highlightedFeature=e.highlight(a.features[0])}))}))}},{key:"getRandomBackgroundFeature",value:function(){var e,t=this,a=this.state.backgroundFeatureObjectIds,n=a[k(a.length)];this.backgroundFeatureLayer.definitionExpression="OBJECTID = "+n,this.backgroundFeatureLayer.when((function(){return t.backgroundFeatureLayer.queryExtent()})).then((function(a){e=a.extent;var n=t.featureVectorLayer.createQuery();return n.spatialRelationship="contains",n.distance=250,n.units="feet",n.returnCentroid=!0,n.returnGeometry=!1,n.geometry=a.extent,t.featureVectorLayer.queryFeatures(n)})).then((function(a){0===a.features.length?t.view.goTo(e):t.getRandomBackgroundFeature()}))}},{key:"reviewWorkflow",value:function(){var e=this;this.featureVectorLayer.queryObjectIds().then((function(t){e.objectIds=t,e.getRandomFeatureForReview()}))}},{key:"toggleLoadIndicator",value:function(e,t){this.setState({loadIndicator:e}),this.loadIndicatorWatch.remove()}},{key:"rotationChange",value:function(e,t,a){0===t&&0!==e&&this.view.ui.add(this.compass,"top-left"),0!==t&&0===e&&this.view.ui.remove(this.compass)}},{key:"componentDidUpdate",value:function(e,t,a){null===t.backgroundFeatureObjectIds&&null!==this.state.backgroundFeatureObjectIds&&this.getRandomBackgroundFeature()}},{key:"componentDidMount",value:function(){var e=this;Object(u.loadModules)(["esri/Map","esri/Basemap","esri/views/MapView","esri/layers/FeatureLayer","esri/views/layers/FeatureLayerView","esri/layers/TileLayer","esri/widgets/Compass","esri/widgets/Editor","esri/core/watchUtils"],{css:!0}).then((function(t){var a=Object(l.a)(t,9),n=a[0],r=a[1],i=a[2],o=a[3],s=(a[4],a[5]),c=a[6],u=a[7],d=a[8],m=new s({url:e.featureTileUrl});e.map=new n({basemap:new r({baseLayers:[m]})}),e.view=new i({container:e.mapRef.current,map:e.map,highlightOptions:{color:"#fe5c00",fillOpacity:.1},popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1}}}),e.compass=new c({view:e.view}),e.loadIndicatorWatch=e.view.watch("updating",e.toggleLoadIndicator),e.view.watch("rotation",e.rotationChange);var p=document.createElement("div");p.className="esri-icon-refresh esri-widget--button esri-widget esri-interactive ",p.title="create"===e.workflow?"Go to another random location.":"Get another entry to review.",p.addEventListener("click",(function(){switch(e.workflow){case"create":e.getRandomBackgroundFeature();break;case"update":e.getRandomFeatureForReview();break;default:alert("moo")}})),e.view.ui.add(p,"bottom-left"),e.featureVectorLayer=new o({url:e.featureVectorUrl,popupTemplate:v,formTemplate:b,groupDisplay:"sequential"}),e.featureVectorLayer.on("edits",(function(t){if(t.updatedFeatures.length>0&&e.highlightedFeature&&(e.sayThanks(),e.view.ui.remove(e.editor)),t.addedFeatures.length>0){var a=t.addedFeatures[0].objectId;e.featureVectorLayer.queryFeatures({objectIds:[a],outFields:["OBJECTID","CREATOR_PUBLIC"]}).then((function(t){t.features[0].setAttribute("CREATOR_PUBLIC",e.props.creds.userId);var a={updateFeatures:[t.features[0]]};e.featureVectorLayer.applyEdits(a)}))}})),e.editor=new u({view:e.view,allowedWorkflows:[e.workflow],layerInfos:[{view:e.view,layer:e.featureVectorLayer,allowAttachments:!1,deleteEnabled:!1}]}),e.editor.postInitialize=function(){d.init(this,"messages",(function(e){e.widgetLabel="WPA Maps",e.addFeature="Draw a new shape",e.editFeature="Review an existing record"}))},e.editor.viewModel.watch("syncing",(function(e,t,a,n){var r=document.getElementsByClassName("esri-editor__control-button");0!==r.length&&(!0===e&&(r[0].disabled="disabled",r[0].classList.add("esri-button--disabled")),!1===e&&(r[0].removeAttribute("disabled"),r[0].classList.remove("esri-button--disabled")))}));var h=e;e.view.popup.on("trigger-action",(function(e){"edit-this"===e.action.id&&h.editThis(),"this-looks-ok"===e.action.id&&h.updateTimesChecked()})),"create"===e.workflow&&(e.backgroundFeatureLayer=new o({url:e.backgroundFeatureUrl}),e.backgroundFeatureLayer.queryObjectIds().then((function(t){h.setState({backgroundFeatureObjectIds:t}),h.map.add(e.backgroundFeatureLayer)})),e.featureVectorLayer.popupEnabled=!1,e.view.ui.add(e.editor,"bottom-right")),"update"===e.workflow&&e.reviewWorkflow(),e.map.add(e.featureVectorLayer)}))}},{key:"updateTimesChecked",value:function(){var e=this.state.updateFeature,t=e.getAttribute("timesChecked");e.setAttribute("timesChecked",t+1);var a={updateFeatures:[e]};this.featureVectorLayer.applyEdits(a),this.highlightedFeature.remove()}},{key:"sayThanks",value:function(){var e=this;this.props.setModalContent(r.a.createElement("div",null,r.a.createElement("h1",null,"Thank you!"),r.a.createElement("p",null,"Here's another entry to check."))),this.props.openModal(),setTimeout((function(){e.props.closeModal()}),2e3),this.highlightedFeature.remove(),this.getRandomFeatureForReview(),this.view.popup.close()}},{key:"editThis",value:function(){var e=this.view,t=this.editor;e.when((function(){t.viewModel.activeWorkFlow||(e.popup.visible=!1,t.startUpdateWorkflowAtFeatureEdit(e.popup.selectedFeature),e.ui.add(t,"bottom-right"),e.popup.spinnerEnabled=!1),setTimeout((function(){var a=t.domNode.getElementsByClassName("esri-editor__back-button esri-interactive");1===a.length&&(a[0].setAttribute("title","Cancel edits, return to popup"),a[0].addEventListener("click",(function(a){a.preventDefault(),e.ui.remove(t)})))}),150)}))}},{key:"componentWillUnmount",value:function(){this.view&&(this.view.container=null)}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.state.loadIndicator&&r.a.createElement("div",{className:"loadIndicator"},"LOADING"),r.a.createElement("div",{className:"webmap",ref:this.mapRef}))}}]),a}(r.a.Component),y=(a(48),a(49),"l3OWRmRCGfkAN4Dh"),O=window.location.pathname;var F={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}};var I=function(){var e=Object(n.useState)(!0),t=Object(l.a)(e,2),a=t[0],i=t[1],o=Object(n.useState)(!1),s=Object(l.a)(o,2),d=s[0],p=s[1],h=Object(n.useState)(0),g=Object(l.a)(h,2),f=g[0],w=g[1],b=Object(n.useState)(""),v=Object(l.a)(b,2),k=v[0],I=v[1],j=Object(n.useState)(!1),L=Object(l.a)(j,2),N=L[0],C=L[1],R=Object(n.useState)(!1),S=Object(l.a)(R,2),T=S[0],A=S[1],_=Object(n.useState)(!1),M=Object(l.a)(_,2),V=M[0],B=M[1],P=Object(n.useState)(!1),W=Object(l.a)(P,2),D=W[0],x=W[1],U=Object(n.useState)(!1),G=Object(l.a)(U,2),q=G[0],Q=G[1],X=Object(n.useState)(!1),z=Object(l.a)(X,2),J=z[0],H=z[1],K=["Good job!","Way to go!","Wow!","That's super!","Awesome!","Alright!"],$=Object(n.useState)(K[Math.floor(Math.random()*Math.floor(K.length))]),Y=Object(l.a)($,2),Z=Y[0],ee=(Y[1],"https://www.arcgis.com/sharing/rest/oauth2/signup?client_id="+y+"&redirect_uri="+O+"&response_type=token");function te(){p(!1)}return c.a.setAppElement("#root"),Object(n.useEffect)((function(){Object(u.loadModules)(["esri/identity/OAuthInfo","esri/identity/IdentityManager","esri/layers/FeatureLayer","esri/portal/Portal"],{css:!0}).then((function(e){var t=Object(l.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3],o=new a({appId:"l3OWRmRCGfkAN4Dh",popup:!1});H(o),Q(n),n.registerOAuthInfos([o]);var s=function(e){for(var t={},a=(e=e||window.location.href).slice(e.indexOf("#")+1).split("&"),n=0;n<a.length;n++){var r=a[n].split("=");r.length>1?t[r[0]]=r[1]:t[r[0]]=null}return t}();if("access_token"in s){var c=s.access_token,u=s.username,d=s.expires_in;n.registerToken({token:c,userId:u,expires:d,server:"https://www.arcgis.com/sharing/rest"}),n.getCredential(o.portalUrl+"/sharing")}n.checkSignInStatus(o.portalUrl+"/sharing").then((function(e){B(e);new i(o.portalUrl).load().then((function(e){x(e.user.fullName)}));var t=new r({url:"https://services1.arcgis.com/jWQlP64OuwDh6GGX/arcgis/rest/services/WPA_Maps_Land_Parcels_Public/FeatureServer/0"}),a=t.createQuery();a.where="CREATOR_PUBLIC = '"+e.userId+"'",a.outStatistics=[{onStatisticField:"CREATOR_PUBLIC",outStatisticFieldName:"CREATOR_COUNT",statisticType:"count"}],t.queryFeatures(a).then((function(e){e.features.length>0&&A(e.features[0].getAttribute("CREATOR_COUNT"))}))})).catch((function(){}))}))}),[]),r.a.createElement("div",{className:"App"},r.a.createElement(m,{runIntro:N,toggleIntro:C,oauthInfo:J}),r.a.createElement(c.a,{isOpen:d,onAfterOpen:function(){},onRequestClose:te,style:F,contentLabel:"Modal"},k),!0===a&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Oklahoma 1936 Land Ownership Map Transcription"),r.a.createElement("div",{className:"flex-row"},r.a.createElement("button",{className:"drawShapes",onClick:function(){i(!1),w("create")}},r.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"addInNew"}),r.a.createElement("br",null),"Draw some shapes"),r.a.createElement("button",{className:"reviewShapes",onClick:function(){i(!1),w("update")}},r.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"editAttributes"}),r.a.createElement("br",null),"Review existing shapes"),r.a.createElement("button",{onClick:function(){C(!N)}},r.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"question"}),r.a.createElement("br",null),"View the intro")),!1===D&&r.a.createElement("div",{className:"trackProgress"},r.a.createElement("h2",null,"Track your progress:"),r.a.createElement("div",{className:"flex-row"},r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{className:"signInOut",onClick:function(){q.getCredential(J.portalUrl+"/sharing").then((function(e){B(e)}))}},r.a.createElement("calcite-icon",{scale:"l",className:"big-icon",icon:"sign-in"}),r.a.createElement("br",null)," Sign in"),r.a.createElement("a",{href:ee},r.a.createElement("button",{className:"createAccount"},r.a.createElement("calcite-icon",{scale:"l",className:"big-icon",icon:"user-plus"}),r.a.createElement("br",null)," Create an account")))),!1!==D&&!1!==T&&r.a.createElement("div",{class:"flex-row"},r.a.createElement("h3",null,"Hi ",D,"! So far you've added",r.a.createElement("span",{style:{fontSize:"2em"}},"\xa0",T,"\xa0"),1===T?"shape":"shapes",". ",T>0?Z:""),r.a.createElement("br",null),r.a.createElement("button",{className:"signInOut",onClick:function(){V.destroy(),window.location=window.location.pathname}},r.a.createElement("calcite-icon",{scale:"l",class:"big-icon",icon:"sign-out"})," ",r.a.createElement("br",null)," Click to sign out"))),!1===a&&r.a.createElement(E,{workflow:f,creds:V,openModal:function(){p(!0)},closeModal:te,setModalContent:I}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.62faee76.chunk.js.map