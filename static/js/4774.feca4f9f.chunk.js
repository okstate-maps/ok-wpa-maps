"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[4774],{82218:(e,t,s)=>{s.d(t,{a:()=>f,c:()=>b,g:()=>k,h:()=>U,u:()=>I});s(93169);var i=s(32718),n=s(16889),r=s(21530),a=s(14226),o=s(81949),u=s(11186),h=s(71353),c=s(14320),l=s(85981),_=s(55652),d=s(40885),g=s(40927),E=s(51378);const m=i.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const T=class{constructor(){this.plane=(0,_.Ue)(),this.origin=(0,h.c)(),this.basis1=(0,h.c)(),this.basis2=(0,h.c)()}};function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;return{plane:(0,_.Ue)(e.plane),origin:(0,h.g)(e.origin),basis1:(0,h.g)(e.basis1),basis2:(0,h.g)(e.basis2)}}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f();return p(e.origin,e.basis1,e.basis2,t)}function p(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f();return(0,u.c)(i.origin,e),(0,u.c)(i.basis1,t),(0,u.c)(i.basis2,s),I(i),function(e,t){Math.abs((0,u.j)(e.basis1,e.basis2)/((0,u.l)(e.basis1)*(0,u.l)(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,u.j)(e.basis1,P(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,u.j)(P(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function I(e){(0,_.my)(e.basis2,e.basis1,e.origin,e.plane)}function R(e,t,s){e!==s&&b(e,s);const i=(0,u.i)(E.WM.get(),P(e),t);return(0,u.g)(s.origin,s.origin,i),s.plane[3]-=t,s}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f();const s=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,u.s)(t.origin,e[0]+s,e[1]+i,0),(0,u.s)(t.basis1,s,0,0),(0,u.s)(t.basis2,0,i,0),(0,_.al)(0,0,1,0,t.plane),t}function A(e,t,s){return!!(0,_.BR)(e.plane,t,s)&&F(e,s)}function S(e,t,s){const i=x.get();M(e,t,i,x.get());let r=Number.POSITIVE_INFINITY;for(const a of B){const o=w(e,a,G.get()),h=E.WM.get();if((0,_.rx)(i,o,h)){const e=(0,u.C)(E.WM.get(),t.origin,h),i=Math.abs((0,n.ZF)((0,u.j)(t.direction,e)));i<r&&(r=i,(0,u.c)(s,h))}}return r===Number.POSITIVE_INFINITY?L(e,t,s):s}function L(e,t,s){if(A(e,t,s))return s;const i=x.get(),n=x.get();M(e,t,i,n);let r=Number.POSITIVE_INFINITY;for(const a of B){const o=w(e,a,G.get()),h=E.WM.get();if((0,_.dZ)(i,o,h)){const e=(0,d.Jk)(t,h);if(!(0,_.Ac)(n,h))continue;e<r&&(r=e,(0,u.c)(s,h))}}return C(e,t.origin)<r&&O(e,t.origin,s),s}function O(e,t,s){const i=(0,_.nF)(e.plane,t,E.WM.get()),n=(0,l.ct)(v(e,e.basis1),i,-1,1,E.WM.get()),r=(0,l.ct)(v(e,e.basis2),i,-1,1,E.WM.get());return(0,u.f)(s,(0,u.g)(E.WM.get(),n,r),e.origin),s}function N(e,t,s){const{origin:i,basis1:n,basis2:r}=e,a=(0,u.f)(E.WM.get(),t,i),o=(0,g.SR)(n,a),h=(0,g.SR)(r,a),c=(0,g.SR)(P(e),a);return(0,u.s)(s,o,h,c)}function C(e,t){const s=N(e,t,E.WM.get()),{basis1:i,basis2:n}=e,r=(0,u.l)(i),a=(0,u.l)(n),o=Math.max(Math.abs(s[0])-r,0),h=Math.max(Math.abs(s[1])-a,0),c=s[2];return o*o+h*h+c*c}function U(e,t){return Math.sqrt(C(e,t))}function y(e,t){const s=-e.plane[3];return(0,g.SR)(P(e),t)-s}function P(e){return(0,_.mJ)(e.plane)}function F(e,t){const s=(0,u.f)(E.WM.get(),t,e.origin),i=(0,u.m)(e.basis1),n=(0,u.m)(e.basis2),r=(0,u.j)(e.basis1,s),a=(0,u.j)(e.basis2,s);return-r-i<0&&r-i<0&&-a-n<0&&a-n<0}function v(e,t){const s=G.get();return(0,u.c)(s.origin,e.origin),(0,u.c)(s.vector,t),s}function w(e,t,s){const{basis1:i,basis2:n,origin:r}=e,a=(0,u.i)(E.WM.get(),i,t.origin[0]),o=(0,u.i)(E.WM.get(),n,t.origin[1]);(0,u.g)(s.origin,a,o),(0,u.g)(s.origin,s.origin,r);const h=(0,u.i)(E.WM.get(),i,t.direction[0]),c=(0,u.i)(E.WM.get(),n,t.direction[1]);return(0,u.i)(s.vector,(0,u.g)(h,h,c),2),s}function M(e,t,s,i){const n=P(e);(0,_.my)(n,t.direction,t.origin,s),(0,_.my)((0,_.mJ)(s),n,t.origin,i)}const D={plane:(0,_.Ue)(),origin:(0,h.f)(0,0,0),basis1:(0,h.f)(1,0,0),basis2:(0,h.f)(0,1,0)},x=new r.x(_.Ue),G=new r.x(l.Ue),H=(0,h.c)(),W=new r.x((()=>f())),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=(0,o.a)(),Q=(0,o.a)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:T,altitudeAt:y,axisAt:function(e,t,s,i){return function(e,t,s){switch(t){case c.R.X:(0,u.c)(s,e.basis1),(0,u.n)(s,s);break;case c.R.Y:(0,u.c)(s,e.basis2),(0,u.n)(s,s);break;case c.R.Z:(0,u.c)(s,P(e))}return s}(e,s,i)},closestPoint:L,closestPointOnSilhouette:S,copy:b,copyWithoutVerify:function(e,t){(0,u.c)(t.origin,e.origin),(0,u.c)(t.basis1,e.basis1),(0,u.c)(t.basis2,e.basis2),(0,_.JG)(t.plane,e.plane)},create:f,distance:U,distance2:C,distanceToSilhouette:function(e,t){let s=Number.NEGATIVE_INFINITY;for(const i of B){const n=w(e,i,G.get()),r=(0,l.Jk)(n,t);r>s&&(s=r)}return Math.sqrt(s)},elevate:R,equals:function(e,t){return(0,u.h)(e.basis1,t.basis1)&&(0,u.h)(e.basis2,t.basis2)&&(0,u.h)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,_.Ac)(e.plane,t)&&F(e,t)},fromAABoundingRect:k,fromValues:p,intersectRay:A,intersectRayClosestSilhouette:function(e,t,s){if(A(e,t,s))return s;const i=S(e,t,E.WM.get());return(0,u.g)(s,t.origin,(0,u.i)(E.WM.get(),t.direction,(0,u.o)(t.origin,i)/(0,u.l)(t.direction))),s},normal:P,projectPoint:O,projectPointLocal:N,rotate:function(e,t,s,i){return e!==i&&b(e,i),(0,a.c)(Q,t,s),(0,u.e)(i.basis1,e.basis1,Q),(0,u.e)(i.basis2,e.basis2,Q),I(i),i},setAltitudeAt:function(e,t,s,i){const n=y(e,t),r=(0,u.i)(H,P(e),s-n);return(0,u.g)(i,t,r),i},setExtent:function(e,t,s){return k(t,s),R(s,y(e,e.origin),s),s},transform:function(e,t,s){return e!==s&&b(e,s),(0,a.i)(Z,t),(0,a.t)(Z,Z),(0,u.e)(s.basis1,e.basis1,Z),(0,u.e)(s.basis2,e.basis2,Z),(0,u.e)((0,_.mJ)(s.plane),(0,_.mJ)(e.plane),Z),(0,u.e)(s.origin,e.origin,t),(0,_.T5)(s.plane,s.plane,s.origin),s},up:D,updateUnboundedPlane:I,wrap:function(e,t,s){const i=W.get();return i.origin=e,i.basis1=t,i.basis2=s,i.plane=(0,_.re)(0,0,0,0),I(i),i}},Symbol.toStringTag,{value:"Module"}))},70178:(e,t,s)=>{s.d(t,{k:()=>n});s(93169);var i=s(92975);function n(e,t){return e===t||null!=e&&null!=t&&(0,i.fS)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}},37818:(e,t,s)=>{s.d(t,{D:()=>T,Ou:()=>h,WG:()=>m,kB:()=>_,mW:()=>l});s(59486);var i=s(52639),n=(s(93169),s(84652)),r=s(18722),a=s(77981),o=s(55946),u=s(78952);function h(e){return"declaredClass"in e}function c(e){return"declaredClass"in e}function l(e,t){return e?function(e){return"declaredClass"in e}(e)?e:new i.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,n.d9)(e.symbol),attributes:(0,n.d9)(e.attributes),geometry:_(e.geometry)}):null}function _(e){return null==e?null:h(e)?e:(0,a.im)(function(e){const{wkid:t,wkt:s,wkt2:i,latestWkid:n}=e.spatialReference,r={wkid:t,wkt:s,wkt2:i,latestWkid:n};switch(e.type){case"point":{const{x:t,y:s,z:i,m:n}=e;return{x:t,y:s,z:i,m:n,spatialReference:r}}case"polygon":{const{rings:t,hasZ:s,hasM:i}=e;return{rings:d(t),hasZ:s,hasM:i,spatialReference:r}}case"polyline":{const{paths:t,hasZ:s,hasM:i}=e;return{paths:d(t),hasZ:s,hasM:i,spatialReference:r}}case"extent":{const{xmin:t,xmax:s,ymin:i,ymax:n,zmin:a,zmax:o,mmin:u,mmax:h,hasZ:c,hasM:l}=e;return{xmin:t,xmax:s,ymin:i,ymax:n,zmin:a,zmax:o,mmin:u,mmax:h,hasZ:c,hasM:l,spatialReference:r}}case"multipoint":{const{points:t,hasZ:s,hasM:i}=e;return{points:E(t)?g(t):t,hasZ:s,hasM:i,spatialReference:r}}default:return}}(e))}function d(e){return function(e){for(const t of e)if(0!==t.length)return E(t);return!1}(e)?e.map((e=>g(e))):e}function g(e){return e.map((e=>Array.from(e)))}function E(e){return e.length>0&&((0,r.xZ)(e[0])||(0,r.fS)(e[0]))}function m(e,t){if(!e)return null;let s;if(c(e)){if(null==t)return e.clone();if(c(t))return t.copy(e)}return null!=t?(s=t,s.x=e.x,s.y=e.y,s.spatialReference=e.spatialReference,e.hasZ?(s.z=e.z,s.hasZ=e.hasZ):(s.z=void 0,s.hasZ=!1),e.hasM?(s.m=e.m,s.hasM=!0):(s.m=void 0,s.hasM=!1)):(s=(0,o.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(s.m=e.m,s.hasM=!0)),s}function T(e){const{wkid:t,wkt:s,wkt2:i,latestWkid:n}=e,r={wkid:t,wkt:s,wkt2:i,latestWkid:n};return u.Z.fromJSON(r)}},67331:(e,t,s)=>{var i;s.d(t,{u:()=>i}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},99912:(e,t,s)=>{s.d(t,{sq:()=>N,iQ:()=>g,T8:()=>E,G5:()=>O});var i=s(100),n=(s(93169),s(32718)),r=s(92026),a=s(90941),o=s(27546),u=s(66978),h=s(94172),c=s(76432),l=s(38499);class _{constructor(){this._tasks=new Array,this._running=(0,c.t)(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,s){return this._running.value=!0,new Promise(((i,n)=>this._tasks.push(new d(i,n,e,t,s))))}unshift(e,t,s){return this._running.value=!0,new Promise(((i,n)=>this._tasks.unshift(new d(i,n,e,t,s))))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const i=(0,u.Hc)(t.signal);if(i&&!t.abortCallback)t.reject((0,u.zE)());else{var s;const n=i?null===(s=t.abortCallback)||void 0===s?void 0:s.call(t,(0,u.zE)()):t.callback(e);(0,u.y8)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(d){t.reject(d)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=(0,u.zE)();for(const t of this._tasks)if(t.abortCallback){const s=t.abortCallback(e);t.resolve(s)}else t.reject(e);this._tasks.length=0,this._running.value=!1}}class d{constructor(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=s,this.signal=i,this.abortCallback=n}}var g,E,m=s(32609),T=s(75248);!function(e){e[e.YIELD=1]="YIELD"}(g||(g={})),function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(E||(E={}));const f=new Map([[E.RESOURCE_CONTROLLER_IMMEDIATE,0],[E.RESOURCE_CONTROLLER,4],[E.SLIDE,0],[E.STREAM_DATA_LOADER,0],[E.ELEVATION_QUERY,0],[E.TERRAIN_SURFACE,1],[E.SURFACE_GEOMETRY_UPDATES,1],[E.LOD_RENDERER,2],[E.GRAPHICS_CORE,2],[E.I3S_CONTROLLER,2],[E.POINT_CLOUD_LAYER,2],[E.FEATURE_TILE_FETCHER,2],[E.OVERLAY,4],[E.STAGE,4],[E.GRAPHICS_DECONFLICTOR,4],[E.FILTER_VISIBILITY,4],[E.SCALE_VISIBILITY,4],[E.FRUSTUM_VISIBILITY,4],[E.CLOUDS_GENERATOR,4],[E.POINT_OF_INTEREST_FREQUENT,6],[E.POINT_OF_INTEREST_INFREQUENT,30],[E.LABELER,8],[E.FEATURE_QUERY_ENGINE,8],[E.FEATURE_TILE_TREE,16],[E.FEATURE_TILE_TREE_ACTIVE,0],[E.ELEVATION_ALIGNMENT,12],[E.TEXT_TEXTURE_ATLAS,12],[E.TEXTURE_UNLOAD,12],[E.LINE_OF_SIGHT_TOOL,16],[E.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[E.SNAPPING,0],[E.SHADOW_ACCUMULATOR,30]]);function b(e){return f.has(e)?f.get(e):"number"==typeof e?e:1}const p=(0,l.HA)(6.5),I=(0,l.HA)(1),R=(0,l.HA)(30),k=(0,l.HA)(1e3/30),A=(0,l.HA)(100);var S,L;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,c.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new s,this._state=T.n.INTERACTING,this._tasks=new o.Z,this._runQueue=new o.Z,this._load=0,this._idleStateCallbacks=new o.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.YP)((()=>m.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.nn);for(const t of Object.keys(E))this.performanceInfo.tasks.set(E[t],new a.Z(E[t]));const e=this;this._test={FRAME_SAFETY_BUDGET:p,INTERACTING_BUDGET:k,IDLE_BUDGET:A,get availableBudget(){return e._budget.budget},usedBudget:0,getBudget:()=>e._budget,setBudget:t=>e._budget=t,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,r.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,s){const i=b(e),n=new t(this,e,s,i);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a.Z(e)),n}registerIdleStateCallbacks(e,t){const s={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(s),this.state===T.n.IDLE&&this._idleUpdatesStartFired&&s.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(s),set idleBegin(e){i._idleUpdatesStartFired&&(s.idleEnd(),i._state===T.n.IDLE&&e()),s.idleBegin=e},set idleEnd(e){s.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==T.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test.usedBudget=0,++this._frameNumber;let t=p,s=e.frameDuration,i=I;switch(this.state){case T.n.IDLE:t=(0,l.HA)(0),s=(0,l.HA)(Math.max(A,e.frameDuration)),i=R;break;case T.n.INTERACTING:s=(0,l.HA)(Math.max(k,e.frameDuration));case T.n.ANIMATING:}return s=(0,l.HA)(s-e.elapsedFrameTime-t),this.state!==T.n.IDLE&&s<I&&!this._forceTask?(this._forceTask=!0,!1):(s=(0,l.HA)(Math.max(s,i)),this._budget.reset(s,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case T.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case T.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,l.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return L.SCHEDULED;let t=L.IDLE;return this._tasks.forAll((s=>{s.name===e&&s.needsUpdate&&(s.schedulePriority<=1?t=L.READY:t!==L.READY&&(t=L.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((s=>{s.name===e&&(t+=s.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,s)=>{t+=e>1?" ".concat(e,"x ").concat(s):" ".concat(s)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((s=>{s.needsUpdate&&0!==s.schedulePriority&&0!==s.basePriority&&s.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,s.basePriority),1===s.schedulePriority?(s.schedulePriority=0,this._runQueue.push(s)):--s.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const s=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)===g.YIELD&&(i.blockFrame=this._frameNumber)}catch(t){n.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(i.name,'"'),t),i.blockFrame=this._frameNumber}!this._budget.hasProgressed&&i.blockFrame!==this._frameNumber&&i.needsUpdate&&(i.name,E.I3S_CONTROLLER,i.blockFrame=this._frameNumber),i.schedulePriority=i.basePriority;const r=this._budget.now()-s;if(i.runtime+=r,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+r),this._debug&&r>2*this._budget.budget&&console.log("Task",i.name,"used",r,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(E))this._frameTaskTimes.set(E[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,s,n){this._scheduler=e,this.name=t,this._basePriority=n,this.blockFrame=0,this.runtime=0,this._queue=new _,this._handles=new i.Z,this.schedulePriority=this._basePriority,this._task=(0,c.t)(null!=s?s:this._queue),this._handles.add((0,h.gx)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(O),this._scheduler.removeTask(this),this.schedule=N.schedule,this.reschedule=N.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,s){return this._queue.push(e,t,s)}reschedule(e,t,s){return this._queue.unshift(e,t,s)}processQueue(e){this._queue.runTask(e)}}class s{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=T.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=s}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(L||(L={}));const O=(()=>{const e=new S.Budget;return e.enabled=!1,e})();const N=new class{remove(){}processQueue(){}schedule(e,t,s){try{if((0,u.Hc)(t)){const e=(0,u.zE)();return s?Promise.resolve(s(e)):Promise.reject(e)}return(0,u.gx)(e(O))}catch(i){return Promise.reject(i)}}reschedule(e,t,s){return this.schedule(e,t,s)}}},32609:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(27366),n=s(7138),r=s(49861),a=(s(25243),s(63780),s(93169),s(69912));let o=class extends n.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,r.Cb)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,r.Cb)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,i._)([(0,a.j)("esri.views.support.DebugFlags")],o);const u=new o}}]);
//# sourceMappingURL=4774.feca4f9f.chunk.js.map