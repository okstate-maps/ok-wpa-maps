"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[6326],{84683:(e,t,n)=>{n.d(t,{bU:()=>u,fC:()=>y,tp:()=>h,v7:()=>c});const i=new Float64Array(2),o=new Float64Array(2),r="0123456789bcdefghjkmnpqrstuvwxyz";function a(e){return r[e]}function s(e){return(e[0]+e[1])/2}function l(e,t,n){return e[0]=t,e[1]=n,e}function d(e,t){const n=s(e),i=t,o=!t;e[0]=o*e[0]+i*n,e[1]=o*n+i*e[1]}function p(e,t){const n=t>s(e);return d(e,n),n}function u(e,t){let n=-90,i=90,o=-180,r=180;for(let a=0;a<t;a++){const t=Math.ceil((a+1)/2),s=Math.floor((a+1)/2),l=1-a%2,d=30-(3*t+2*s),p=30-(2*t+3*s),u=3*l+2*(1-l),c=2*l+3*(1-l),h=3*l+7*(1-l)<<p,y=(7*l+3*(1-l)<<d&e.geohashX)>>d,m=(h&e.geohashY)>>p;for(let e=u-1;e>=0;e--){const t=(o+r)/2,n=y&1<<e?1:0;o=(1-n)*o+n*t,r=(1-n)*t+n*r}for(let e=c-1;e>=0;e--){const t=(n+i)/2,o=m&1<<e?1:0;n=(1-o)*n+o*t,i=(1-o)*t+o*i}}return[o,n,r,i]}function c(e,t,n,i){i%2&&(i+=1);let o=0,r=0,a=-90,s=90,l=-180,d=180;for(let p=0;p<i/2;p++){for(let e=0;e<5;e++){const t=(l+d)/2,i=n>t?1:0;o|=i<<29-(e+5*p),l=(1-i)*l+i*t,d=(1-i)*t+i*d}for(let e=0;e<5;e++){const n=(a+s)/2,i=t>n?1:0;r|=i<<29-(e+5*p),a=(1-i)*a+i*n,s=(1-i)*n+i*s}}e.geohashX=o,e.geohashY=r}function h(e,t,n,i,o){o%2&&(o+=1);let r=0,a=0,s=-90,l=90,d=-180,p=180;for(let u=0;u<o/2;u++){for(let e=0;e<5;e++){const t=(d+p)/2,n=i>t?1:0;r|=n<<29-(e+5*u),d=(1-n)*d+n*t,p=(1-n)*t+n*p}for(let e=0;e<5;e++){const t=(s+l)/2,i=n>t?1:0;a|=i<<29-(e+5*u),s=(1-i)*s+i*t,l=(1-i)*t+i*l}}e[2*t]=r,e[2*t+1]=a}function y(e,t,n){let r="";const s=l(i,-90,90),d=l(o,-180,180);for(let i=0;i<n;i++){let n=0;i%2?(n|=p(s,e)<<4,n|=p(d,t)<<3,n|=p(s,e)<<2,n|=p(d,t)<<1,n|=p(s,e)<<0):(n|=p(d,t)<<4,n|=p(s,e)<<3,n|=p(d,t)<<2,n|=p(s,e)<<1,n|=p(d,t)<<0),r+=a(n)}return r}},46326:(e,t,n)=>{n.r(t),n.d(t,{default:()=>an});var i=n(27366),o=(n(59486),n(40281)),r=n(10064),a=n(32718),s=n(66978),l=n(49861),d=(n(25243),n(63780),n(93169)),p=n(69912),u=n(84683),c=n(30651),h=n(83406),y=n(80457),m=n(7138),f=n(77427),g=n(76672),v=n(80885),w=n(79803),_=n(92975),b=n(3182),C=n(77981);class T{constructor(){this._featureLookup=new Map}static getInstance(){return T.instance||(T.instance=new T),T.instance}static resetInstance(){T.instance&&(T.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const n=this.readFromStoreById(e);n&&t.push(n)})),t}readFromStoreById(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}writeToStore(e,t,n){const i=[];return e.forEach((e=>{if(null===e||void 0===e||!e.id)return;e.properties||(e.properties=[]);let o,r=null;if(n&&e.properties[n]&&(r=(0,h.GH)(e.properties[n])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id),a=JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties)));n&&e.properties[n]&&(a[n]=(0,C.im)(e.properties[n])),o=new b.u_(r?JSON.parse(JSON.stringify(r)):null!==i&&void 0!==i&&i.geometry?JSON.parse(JSON.stringify(i.geometry)):null,a,null,e.properties[t])}else o=new b.u_(r?JSON.parse(JSON.stringify(r)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,o),i.push(o)})),i}}var E=n(19545),k=n(76200);let M=class extends m.Z{constructor(e){super(e),this.resultRows=[]}};(0,i._)([(0,l.Cb)()],M.prototype,"resultRows",void 0),M=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryResult")],M);const x=M;let I=class extends m.Z{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};(0,i._)([(0,l.Cb)()],I.prototype,"resultRowsStream",void 0),I=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryResult")],I);const L=I;var D=n(46784),G=n(78952);let R=class extends D.wq{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],R.prototype,"name",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],R.prototype,"unique",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],R.prototype,"ascending",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],R.prototype,"description",void 0),(0,i._)([(0,l.Cb)({type:[String],json:{write:!0}})],R.prototype,"fieldNames",void 0),R=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.FieldIndex")],R);const S=R;let N=class extends D.wq{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],N.prototype,"name",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],N.prototype,"alias",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],N.prototype,"fieldType",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],N.prototype,"geometryType",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"hasM",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"hasZ",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"nullable",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"editable",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"required",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"defaultVisibility",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],N.prototype,"systemMaintained",void 0),(0,i._)([(0,l.Cb)()],N.prototype,"role",void 0),(0,i._)([(0,l.Cb)({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=null!=e?e.toString():null}}}})],N.prototype,"defaultValue",void 0),N=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphProperty")],N);const j=N;let F=class extends D.wq{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"name",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"alias",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"role",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"strict",void 0),(0,i._)([(0,l.Cb)({type:[j],json:{write:!0}})],F.prototype,"properties",void 0),(0,i._)([(0,l.Cb)({type:[S],json:{write:!0}})],F.prototype,"fieldIndexes",void 0),F=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphObjectType")],F);const P=F;let O=class extends P{constructor(e){super(e)}};O=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.EntityType")],O);const A=O;let Z=class extends P{constructor(e){super(e),this.endPoints=[]}};(0,i._)([(0,l.Cb)()],Z.prototype,"endPoints",void 0),Z=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.RelationshipType")],Z);const z=Z;let Q=class extends D.wq{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,i._)([(0,l.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=null===e||void 0===e?void 0:e.getTime()}}}})],Q.prototype,"timestamp",void 0),(0,i._)([(0,l.Cb)({type:G.Z,json:{write:!0}})],Q.prototype,"spatialReference",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"strict",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],Q.prototype,"objectIdField",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],Q.prototype,"globalIdField",void 0),(0,i._)([(0,l.Cb)()],Q.prototype,"arcgisManaged",void 0),(0,i._)([(0,l.Cb)()],Q.prototype,"identifierInfo",void 0),(0,i._)([(0,l.Cb)()],Q.prototype,"searchIndexes",void 0),(0,i._)([(0,l.Cb)({type:[A],json:{write:!0}})],Q.prototype,"entityTypes",void 0),(0,i._)([(0,l.Cb)({type:[z],json:{write:!0}})],Q.prototype,"relationshipTypes",void 0),Q=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.DataModel")],Q);const U=Q;let q=class extends D.wq{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,i._)([(0,l.Cb)({type:[String],json:{write:!0}})],q.prototype,"capabilities",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"supportsSearch",void 0),(0,i._)([(0,l.Cb)({type:[String],json:{write:!0}})],q.prototype,"supportedQueryFormats",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"allowGeometryUpdates",void 0),(0,i._)([(0,l.Cb)({type:Number,json:{write:!0}})],q.prototype,"searchMaxRecordCount",void 0),(0,i._)([(0,l.Cb)({type:Object,json:{write:!0}})],q.prototype,"serviceCapabilities",void 0),(0,i._)([(0,l.Cb)({type:Number,json:{write:!0}})],q.prototype,"maxRecordCount",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],q.prototype,"description",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],q.prototype,"copyrightText",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],q.prototype,"units",void 0),(0,i._)([(0,l.Cb)({type:Object,json:{write:!0}})],q.prototype,"spatialReference",void 0),(0,i._)([(0,l.Cb)({type:Number,json:{write:!0}})],q.prototype,"currentVersion",void 0),(0,i._)([(0,l.Cb)({type:Object,json:{write:!0}})],q.prototype,"dateFieldsTimeReference",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],q.prototype,"serviceItemId",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"supportsDocuments",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"dataEditingNotSupported",void 0),(0,i._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"schemaEditingNotSupported",void 0),q=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.ServiceDefinition")],q);const Y=q;let H=class extends D.wq{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],H.prototype,"url",void 0),(0,i._)([(0,l.Cb)({type:U,json:{write:!0}})],H.prototype,"dataModel",void 0),(0,i._)([(0,l.Cb)({type:Y,json:{write:!0}})],H.prototype,"serviceDefinition",void 0),H=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],H);const B=H;var J=n(65905);const V="esri/rest/knowledgeGraph/wasmInterface/";let W,K=null;async function $(){var e;const t=null!==(e=K)&&void 0!==e?e:W;if(t)return t;const i=(0,d.Z)("wasm-simd");return W=async function(e){if(e){const{default:e}=await n.e(2717).then(n.bind(n,2717)).then((e=>e.a));return e({locateFile:e=>(0,J.V)(V+e)})}const{default:t}=await n.e(3415).then(n.bind(n,43415)).then((e=>e.a));return t({locateFile:e=>(0,J.V)(V+e)})}(i),W}var X=n(77577),ee=n(585),te=n(29909),ne=n(32238);function ie(e,t){const n=new t.ArrayValue;return n.deleteLater(),e.forEach((e=>{n.add_value(ae(e,t))})),n}function oe(e,t){const n=new t.ObjectValue;n.deleteLater();for(const[i,o]of Object.entries(e))n.set_key_value(i,ae(o,t));return n}function re(e,t){if(e instanceof X.Z)return function(e,t){const n=new t.GeometryValue;n.deleteLater(),n.geometry_type=n.geometry_type=t.esriGeometryType.esriGeometryMultipoint,n.has_z=e.hasZ,n.has_m=e.hasM;const i=[],o=[];o[0]=e.points.length;let r=0;return e.points.forEach((e=>{e.forEach((e=>{i[r]=e,r++}))})),n.coords=new Float64Array(i),n.lengths=new Uint32Array(o),n}(e,t);if(e instanceof ee.Z)return function(e,t){const n=new t.GeometryValue;n.deleteLater(),n.geometry_type=t.esriGeometryType.esriGeometryPoint,n.has_z=e.hasZ,n.has_m=e.hasM;const i=[],o=[];o[0]=1,i[0]=e.x,i[1]=e.y;let r=2;return e.hasZ&&(i[r]=e.z,r++),e.hasM&&(i[r]=e.m,r++),n.coords=new Float64Array(i),n.lengths=new Uint32Array(o),n}(e,t);if(e instanceof te.Z||e instanceof v.Z)return function(e,t){const n=new t.GeometryValue;n.deleteLater(),n.has_z=e.hasZ,n.has_m=e.hasM;const i=[],o=[];let r=[];e instanceof te.Z?(n.geometry_type=t.esriGeometryType.esriGeometryPolyline,r=e.paths):e instanceof v.Z&&(n.geometry_type=t.esriGeometryType.esriGeometryPolygon,r=e.rings);let a=0,s=0;return r.forEach((e=>{let t=0;e.forEach((e=>{t++,e.forEach((e=>{i[s]=e,s++}))})),o[a]=t,a++})),n.coords=new Float64Array(i),n.lengths=new Uint32Array(o),n}(e,t);throw new r.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ae(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof ne.Z)return re(e,t);if(Array.isArray(e)){const n=new t.ArrayValue;return n.deleteLater(),e.forEach((e=>{n.add_value(ae(e,t))})),n}return oe(e,t)}let se=class extends D.wq{constructor(e){super(e),this.properties=null}};(0,i._)([(0,l.Cb)({json:{write:!0}})],se.prototype,"properties",void 0),se=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphObject")],se);const le=se;let de=class extends le{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],de.prototype,"typeName",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],de.prototype,"id",void 0),de=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphNamedObject")],de);const pe=de;let ue=class extends pe{constructor(e){super(e),this.layoutGeometry=null}};(0,i._)([(0,l.Cb)({type:ee.Z,json:{write:!0}})],ue.prototype,"layoutGeometry",void 0),ue=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.Entity")],ue);const ce=ue;let he=class extends pe{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],he.prototype,"originId",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],he.prototype,"destinationId",void 0),(0,i._)([(0,l.Cb)({type:te.Z,json:{write:!0}})],he.prototype,"layoutGeometry",void 0),he=(0,i._)([(0,p.j)("esri.rest.Relationship.Relationship")],he);const ye=he;function me(e,t){if(!e.typeName)throw new r.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof ce){const n=new t.EntityValue;n.deleteLater(),n.type_name=e.typeName;for(const[i,o]of Object.entries(e.properties))n.set_key_value(i,fe(o,t));return e.id&&n.set_id(e.id),n}if(e instanceof ye){const n=new t.RelationshipValue;n.deleteLater(),n.type_name=e.typeName;for(const[i,o]of Object.entries(e.properties))n.set_key_value(i,fe(o,t));return e.id&&n.set_id(e.id),e.originId&&e.destinationId&&n.set_related_entity_ids(e.originId,e.destinationId),n}throw new r.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function fe(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof ne.Z?re(e,t):""}let ge=class extends m.Z{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,i._)([(0,l.Cb)()],ge.prototype,"name",void 0),(0,i._)([(0,l.Cb)()],ge.prototype,"supportedCategory",void 0),(0,i._)([(0,l.Cb)()],ge.prototype,"analyzers",void 0),(0,i._)([(0,l.Cb)()],ge.prototype,"searchProperties",void 0),ge=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.SearchIndex")],ge);const ve=ge;var we,_e,be,Ce,Te,Ee,ke;function Me(e){return e.deleteLater(),new A(Ie(e))}function xe(e){return e.deleteLater(),new S({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Re(e.fields)})}function Ie(e){return{name:e.name,alias:e.alias,role:we[e.role.value]?we[e.role.value]:null,strict:e.strict,properties:Se(e.properties),fieldIndexes:Ne(e.field_indexes)}}function Le(e){return e.deleteLater(),new j({alias:e.alias,name:e.name,fieldType:_e[e.field_type.value]?_e[e.field_type.value]:null,geometryType:be[e.geometry_type.value]?be[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:Ee[e.role.value],defaultValue:e.default_value})}function De(e){e.deleteLater();const t=Ie(e),n=[];for(let i=0;i<e.end_points.size();i++){const t=e.end_points.get(i);n.push({originEntityType:t.origin_entity_type,destinationEntityType:t.dest_entity_type})}return new z(Object.assign({endPoints:n},t))}function Ge(e){const t=[];for(let n=0;n<e.size();n++)t.push(Me(e.get(n)));return t}function Re(e){const t=[];for(let n=0;n<e.size();n++)t.push(e.get(n));return t}function Se(e){const t=[];for(let n=0;n<e.size();n++)t.push(Le(e.get(n)));return t}function Ne(e){const t=[];for(let n=0;n<e.size();n++)t.push(xe(e.get(n)));return t}function je(e){const t=[];for(let n=0;n<e.size();n++)t.push(De(e.get(n)));return t}function Fe(e){const t=[];for(let n=0;n<e.size();n++){const n=new ve,i=e.get(0);n.name=i.name,n.supportedCategory=Te[i.supported_category.value];const o=i.analyzers.size();for(let e=0;e<o;e++)n.analyzers.push({name:i.analyzers.get(e).name});for(let e=0;e<i.search_properties.keys().size();e++){const t=i.search_properties.keys().get(e),o=i.search_properties.get(t),r=[];for(let e=0;e<o.property_names.size();e++)r.push(o.property_names.get(e));n.searchProperties.set(t,{propertyNames:r})}t.push(n)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(we||(we={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(_e||(_e={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(be||(be={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Ce||(Ce={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Te||(Te={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(Ee||(Ee={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(ke||(ke={}));let Pe=class extends le{constructor(e){super(e)}};Pe=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.ObjectValue")],Pe);const Oe=Pe;let Ae=class extends D.wq{constructor(e){super(e),this.path=null}};(0,i._)([(0,l.Cb)({type:[le],json:{write:!0}})],Ae.prototype,"path",void 0),Ae=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.Path")],Ae);const Ze=Ae;var ze,Qe,Ue;function qe(e){const t={},n=Ye(e,t),i=e.lengths,o=e.coords;let a="";if(e.geometry_type.value===ze.ESRI_GEOMETRY_POLYGON)a="rings";else{if(e.geometry_type.value!==ze.ESRI_GEOMETRY_POLYLINE)throw new r.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");a="paths"}t[a]=[];let s=0;return i.forEach((e=>{const i=[];for(let t=0;t<e;t++){const e=[];for(let t=0;t<n;t++)e[t]=o[s],s++;i.push(e)}t[a].push(i)})),t}function Ye(e,t){let n=2;return e.has_z?(t.hasZ=e.has_z,n++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,n++):t.hasM=!1,n}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(ze||(ze={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(Qe||(Qe={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Ue||(Ue={}));const He=a.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),Be={decodedWasmObjToQueryResponseObj:(e,t)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case ze.ESRI_GEOMETRY_POINT:return function(e){const t={};let n=2;Ye(e,t);const i=e.coords;return t.x=i[0],t.y=i[1],e.has_z&&(t.z=i[n],n++),e.has_m&&(t.m=i[n]),new ee.Z(t)}(e);case ze.ESRI_GEOMETRY_MULTIPOINT:return function(e){const t={},n=Ye(e,t),i=e.lengths,o=e.coords,r=i[0];t.points=[];let a=0;for(let s=0;s<r;s++){const e=[];for(let t=0;t<n;t++)e[t]=o[a],a++;t.points.push(e)}return new X.Z(t)}(e);case ze.ESRI_GEOMETRY_POLYLINE:return function(e){return new te.Z(qe(e))}(e);case ze.ESRI_GEOMETRY_POLYGON:return function(e){return new v.Z(qe(e))}(e);case ze.ESRI_GEOMETRY_ENVELOPE:case ze.ESRI_GEOMETRY_MULTI_PATCH:return He.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case ze.ESRI_GEOMETRY_NULL:case ze.ESRI_GEOMETRY_ANY:default:return He.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return He.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case Qe.OBJECT:return function(e,t){return new Oe(We(e,t))}(e,t);case Qe.ENTITY:return Ve(e,t);case Qe.RELATIONSHIP:return Ke(e,t);case Qe.PATH:return function(e,t){const n=e.entity_count(),i=e.relationship_count(),o=[];for(let r=0;r<n;r++)o.push(Ve(e.get_entity_at(r),t)),r<i&&o.push(Ke(e.get_relationship_at(r),t));return new Ze({path:o})}(e,t);case Qe.ARRAY:return function(e,t){const n=[],i=e.count();for(let o=0;o<i;o++){const i=e.get_value_at(o);n.push(Je(i,t))}return n}(e,t);default:return He.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Je(e,t){return Be.decodedWasmObjToQueryResponseObj(e,t)}function Ve(e,t){const n=e.type_name,i=We(e,t),o=e.get_id();return new ce(Object.assign({typeName:n,id:o},i))}function We(e,t){const n={},i=e.key_count();for(let o=0;o<i;o++)n[e.get_key_at(o)]=Je(e.get_value_at(o),t);return{properties:n}}function Ke(e,t){const n=e.type_name,i=We(e,t);return new ye(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},i))}let $e=class extends m.Z{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};(0,i._)([(0,l.Cb)()],$e.prototype,"hasError",void 0),(0,i._)([(0,l.Cb)()],$e.prototype,"error",void 0),(0,i._)([(0,l.Cb)()],$e.prototype,"editResults",void 0),$e=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],$e);const Xe=$e;const et={fetchKnowledgeGraph:async e=>{const t=new B({url:e}),n=[];return n.push(nt(t)),n.push(async function(e){return et.refreshServiceDefinition(e)}(t)),await Promise.all(n),t},refreshDataModel:async e=>{e.dataModel=await pt(e)},refreshServiceDefinition:async e=>{var t,n;const i=(await(0,k.Z)(e.url,{query:{f:"json"}})).data;return i.capabilities=null===i||void 0===i||null===(t=i.capabilities)||void 0===t?void 0:t.split(","),i.supportedQueryFormats=null===i||void 0===i||null===(n=i.supportedQueryFormats)||void 0===n?void 0:n.split(","),e.serviceDefinition=new Y(i),e.serviceDefinition},executeQueryStreaming:async(e,t,n)=>{const i="".concat(e.url,"/graph/query");await ot(e);const o=await st(i,n);o.data.body=await async function(e,t){const n=await $(),i=new n.GraphQueryRequestEncoder;if(i.deleteLater(),i.output_spatial_reference=n.SpatialReferenceUtil.WGS84(),i.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[o,r]of Object.entries(e.bindParameters))at(o,r,i,n);if(e.bindGeometryQuantizationParameters)!function(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.bindGeometryQuantizationParameters,i);else{var a;if(t.dataModel||await nt(t),4326!==(null===(a=t.dataModel)||void 0===a||null===(a=a.spatialReference)||void 0===a?void 0:a.wkid))throw new r.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");i.input_quantization_parameters=n.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&function(e,t,n){if(!e.extent)throw new r.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new r.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new r.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:n.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}(e.outputQuantizationParameters,i,n);try{i.encode()}catch(o){throw new r.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:o})}const s=i.get_encoding_result();if(0!==s.error.error_code)throw new r.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:s.error.error_code,errorMessage:s.error.error_message});return s.get_byte_buffer()}(t,e);const a=await it(o.data.url,o.data);if(e.dataModel)return new L({resultRowsStream:await dt(a,e.dataModel)});throw new r.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,n)=>{var i;if(null!==(i=e.serviceDefinition)&&void 0!==i&&i.dataEditingNotSupported)throw new r.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const o="".concat(e.url,"/graph/applyEdits");await ot(e);const a=await st(o,n);return a.data.body=await async function(e,t){var n,i,o;if(t.dataModel||await nt(t),!t.dataModel)throw new r.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const a=await $(),s=!(null===(n=e.options)||void 0===n||!n.cascadeDelete),l=new a.GraphApplyEditsEncoder(a.SpatialReferenceUtil.WGS84(),null!==(i=e.options)&&void 0!==i&&i.inputQuantizationParameters?function(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(null===(o=e.options)||void 0===o?void 0:o.inputQuantizationParameters):a.InputQuantizationUtil.WGS84_lossless());l.deleteLater(),l.cascade_delete=s;try{var d,p,u,c,h,y;let t;null!==(d=e.entityAdds)&&void 0!==d&&d.forEach((e=>{t=l.add_entity(me(e,a)),rt(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(p=e.relationshipAdds)&&void 0!==p&&p.forEach((e=>{if(!e.originId||!e.destinationId)throw new r.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");t=l.add_relationship(me(e,a)),rt(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(u=e.entityUpdates)&&void 0!==u&&u.forEach((e=>{if(!e.id)throw new r.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=l.update_entity(me(e,a)),rt(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(c=e.relationshipUpdates)&&void 0!==c&&c.forEach((e=>{if(!e.id)throw new r.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=l.update_relationship(me(e,a)),rt(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(h=e.entityDeletes)&&void 0!==h&&h.forEach((e=>{var t;if(!e.typeName)throw new r.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const n=l.make_delete_helper(e.typeName,!0);n.deleteLater(),null===(t=e.ids)||void 0===t||t.forEach((e=>{n.delete_by_id(e)}))})),null!==(y=e.relationshipDeletes)&&void 0!==y&&y.forEach((e=>{var t;if(!e.typeName)throw new r.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const n=l.make_delete_helper(e.typeName,!1);null===(t=e.ids)||void 0===t||t.forEach((e=>{n.delete_by_id(e)}))})),l.encode()}catch(Be){throw new r.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:Be})}const m=l.get_encoding_result();return rt(m.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),m.get_byte_buffer()}(t,e),async function(e){const t=e.headers.get("content-type");if(null!==t&&void 0!==t&&t.includes("application/x-protobuf")){const t=await e.arrayBuffer(),n=new((await $()).GraphApplyEditsDecoder);return n.deleteLater(),n.decode(new Uint8Array(t)),function(e){const t=new Xe;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const n=e.get_edit_results_count();for(let i=0;i<n;i++){const n=e.get_edit_results_at(i),o=e.get_edit_results_type_name_at(i),r=[],a=[],s=[],l=n.get_add_results_count(),d=n.get_update_results_count(),p=n.get_delete_results_count();for(let e=0;e<l;e++){const t=n.get_add_result_at(e);r.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}for(let e=0;e<d;e++){const t=n.get_update_result_at(e);a.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}for(let e=0;e<p;e++){const t=n.get_delete_result_at(e);s.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}t.editResults.push({typeName:o,adds:r,updates:a,deletes:s})}return t}(n)}throw new r.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}(await it(a.data.url,a.data))},executeQuery:async(e,t,n)=>{var i;const o="".concat(e.url,"/graph/query"),a=await(0,k.Z)(o,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...null===n||void 0===n?void 0:n.query},signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout}),s=null===(i=a.getHeader)||void 0===i?void 0:i.call(a,"content-type"),l=a.data;if(null!==s&&void 0!==s&&s.includes("application/x-protobuf")){const t=new((await $()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new x({resultRows:lt(t,l,e.dataModel)});throw new r.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new r.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:a.data})},executeSearch:async(e,t,n)=>{var i;const o=t.typeCategoryFilter,a="".concat(e.url,"/graph/search"),s=await(0,k.Z)(a,{responseType:"array-buffer",query:{f:"pbf",searchQuery:'"'.concat(t.searchQuery,'"'),typeCategoryFilter:o,...null===n||void 0===n?void 0:n.query},signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout}),l=null===(i=s.getHeader)||void 0===i?void 0:i.call(s,"content-type"),d=s.data;if(null!==l&&void 0!==l&&l.includes("application/x-protobuf")){const t=new((await $()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new x({resultRows:lt(t,d,e.dataModel)});throw new r.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new r.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:s.data})},executeSearchStreaming:async(e,t,n)=>{const i="".concat(e.url,"/graph/search");await ot(e);const o=await st(i,n);o.data.body=await async function(e){var t;const n=await $(),i=new n.GraphSearchRequestEncoder;if(i.deleteLater(),i.search_query=e.searchQuery,i.type_category_filter=n.esriNamedTypeCategory[e.typeCategoryFilter],!0===e.returnSearchContext&&(i.return_search_context=e.returnSearchContext),null!=e.start&&e.start>0&&(i.start_index=e.start),null!=e.num&&(i.max_num_results=e.num),null!=e.idsFilter&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{i.set_ids_filter(ie(e.idsFilter,n))}catch(a){throw new r.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:a})}null===(t=e.namedTypesFilter)||void 0===t||t.forEach((e=>{i.add_named_type_filter(e)}));try{i.encode()}catch(a){throw new r.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:a})}const o=i.get_encoding_result();if(0!==o.error.error_code)throw new r.Z("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return o.get_byte_buffer()}(t);const a=await it(o.data.url,o.data);if(e.dataModel)return new L({resultRowsStream:await dt(a,e.dataModel)});throw new r.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},_fetchWrapper:async(e,t)=>fetch(e,t)};async function tt(e,t,n){return et.executeQueryStreaming(e,t,n)}async function nt(e){return et.refreshDataModel(e)}async function it(e,t){return et._fetchWrapper(e,t)}async function ot(e){(null===E.id||void 0===E.id?void 0:E.id.findCredential(e.url))||(e.dataModel?await pt(e):await nt(e))}function rt(e,t,n){if(0!==e.error_code)throw new r.Z(t,n,{errorCode:e.error_code,errorMessage:e.error_message})}function at(e,t,n,i){null==t?n.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?n.set_param_key_value(e,t):t instanceof ne.Z?n.set_param_key_value(e,re(t,i)):t instanceof Array?n.set_param_key_value(e,ie(t,i)):n.set_param_key_value(e,oe(t,i))}async function st(e,t){return(0,k.Z)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...null===t||void 0===t?void 0:t.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:null===t||void 0===t?void 0:t.signal,timeout:null===t||void 0===t?void 0:t.timeout})}function lt(e,t,n){e.push_buffer(new Uint8Array(t));const i=[];let o=0;for(;e.next_row();){o||(o=e.get_header_keys().size());const t=new Array(o);for(let i=0;i<o;i++){const o=e.get_value(i);t[i]=Je(o,n)}i.push(t)}if(e.has_error())throw new r.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return i}async function dt(e,t){const n=e.headers.get("content-type");if(e.headers.get("content-length")&&a.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),null!==n&&void 0!==n&&n.includes("application/x-protobuf")){var i;const n=null===(i=e.body)||void 0===i?void 0:i.getReader(),o=new((await $()).GraphQueryDecoder);return o.deleteLater(),new ReadableStream({async start(e){try{return function i(){return null===n||void 0===n?void 0:n.read().then((a=>{let{done:s,value:l}=a;if(s){let t;if(o.has_error()&&(t=new r.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:o.error.error_code,errorMessage:o.error.error_message})),n.releaseLock(),t)throw e.error(t),t;return void e.close()}const d=lt(o,l,t);return d.length>0&&e.enqueue(d),i()}))}()}catch(i){null!==n&&void 0!==n&&n.releaseLock(),e.error(new r.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:i})),e.close()}}})}throw new r.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:e.text()})}async function pt(e){var t;const n="".concat(e.url,"/dataModel/queryDataModel"),i=await(0,k.Z)(n,{responseType:"array-buffer",query:{f:"pbf"}}),o=null===(t=i.getHeader)||void 0===t?void 0:t.call(i,"content-type"),a=i.data;if(null!==o&&void 0!==o&&o.includes("application/x-protobuf")){const e=(await $()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!e)throw new r.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function(e){var t,n,i,o;return e.deleteLater(),new U({timestamp:e.timestamp,spatialReference:new G.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:ke[null===(t=e.identifier_info)||void 0===t||null===(t=t.identifier_mapping_info)||void 0===t||null===(t=t.identifier_info_type)||void 0===t?void 0:t.value],databaseNativeIdentifier:null===(n=e.identifier_info)||void 0===n||null===(n=n.identifier_mapping_info)||void 0===n?void 0:n.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:null===(i=e.identifier_info)||void 0===i||null===(i=i.identifier_mapping_info)||void 0===i||null===(i=i.uniform_property_identifier)||void 0===i?void 0:i.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Ce[null===(o=e.identifier_info)||void 0===o||null===(o=o.identifier_generation_info)||void 0===o||null===(o=o.uuid_method_hint)||void 0===o?void 0:o.value]}},searchIndexes:Fe(e.search_indexes),entityTypes:Ge(e.entity_types),relationshipTypes:je(e.relationship_types)})}(e)}throw new r.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:i.data})}let ut=class extends m.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,i._)([(0,l.Cb)()],ut.prototype,"openCypherQuery",void 0),ut=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQuery")],ut);const ct=ut;let ht=class extends ct{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,i._)([(0,l.Cb)()],ht.prototype,"bindParameters",void 0),(0,i._)([(0,l.Cb)()],ht.prototype,"bindGeometryQuantizationParameters",void 0),(0,i._)([(0,l.Cb)()],ht.prototype,"outputQuantizationParameters",void 0),ht=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],ht);const yt=ht;function mt(e){if(!e.spatialReference.isWGS84)throw new r.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t}var ft=n(86638),gt=n(53866);const vt="ESRI__ID",wt="ESRI__ORIGIN_ID",_t="ESRI__DESTINATION_ID",bt="ESRI__LAYOUT_GEOMETRY",Ct=12,Tt=a.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let Et=class extends m.Z{constructor(e){var t,n,i;super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const o=new Map;null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((t=>{var n,i;t.name&&(o.set(t.name,"entity"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||this.entityTypeNames.add(t.name),null===(i=t.properties)||void 0===i||i.forEach((e=>{var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null!==(n=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==n&&n.forEach((t=>{var n,i;t.name&&(o.set(t.name,"relationship"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||this.relationshipTypeNames.add(t.name),null===(i=t.properties)||void 0===i||i.forEach((e=>{var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.forEach(((t,n)=>{var i;if("entity"===o.get(n))this.entityTypeNames.add(n);else{var r;if("relationship"!==o.get(n))return Tt.warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(r=e.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.delete(n));this.relationshipTypeNames.add(n)}const a=new Map;null!==(i=t.members)&&void 0!==i&&i.forEach((e=>{this.memberIdTypeLookup.set(e.id,n);const t=this.getById(e.id);t&&a.set(e.id,t)})),this.sublayerCaches.set(n,a)}))}addToLayer(e){e.forEach((e=>{let{typeName:t,id:n}=e;if(!this.inclusionModeDefinition)throw new r.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const e=this.inclusionModeDefinition.namedTypeDefinitions.get(t);e.members||(e.members=new Map),e.members.set(n,{id:n}),this.memberIdTypeLookup.set(n,t)}}else{const e=new Map;e.set(n,{id:n}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:e}),this.memberIdTypeLookup.set(n,t)}}))}getById(e){return T.getInstance().readFromStoreById(e)}async getData(e,t,n){var i;if(t.objectType.name&&null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let o;if(o=e||new ft.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){var r,a,s;const e=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(null!==(r=t.objectType.name)&&void 0!==r?r:""),i=o.outFields,l=o.geometry;let d="",p="";l&&l.extent&&(d=(0,u.fC)(l.extent.ymin,l.extent.xmin,Ct),p=(0,u.fC)(l.extent.ymax,l.extent.xmax,Ct)),i&&1===i.length&&i[0]===vt&&"1=1"===o.where||await Promise.all(null!==n&&void 0!==n?n:[]);const c=this.sublayerCaches.has(null!==(a=t.objectType.name)&&void 0!==a?a:"")?Array.from(null===(s=this.sublayerCaches.get(t.objectType.name))||void 0===s?void 0:s.values()):[],h=[];return c.forEach((n=>{if(n.geometry=e.linkChartDiagramLookup.get(n.attributes[t.objectIdField]),n.attributes[bt]=n.geometry,d&&p){const i=e.linkChartGeohashLookup.get(n.attributes[t.objectIdField]);i?i>=d&&i<=p&&h.push(n):h.push(n)}else h.push(n)})),h}return this.retrieveDataFromService(o,t,n)}async getConnectedRecordIds(e){const t=[],n=[],i=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){var t;const n=this.memberIdTypeLookup.get(e);if(!this.entityTypeNames.has(n))return;i.has(n)?null===(t=i.get(n))||void 0===t||t.push(e):i.set(n,[e])}})),i.forEach(((e,i)=>{const o="MATCH (n:".concat(i,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"),r=new Promise((n=>{(async()=>{const n=(await tt(this.knowledgeGraph,new yt({openCypherQuery:o,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:i}=await n.read();if(e)break;for(let n=0;n<i.length;n++){const e=i[n];t.push({id:e[0],typeName:e[1]}),t.push({id:e[2],typeName:e[3]})}}}catch(i){if("AbortError"!==i.name)throw i;Tt.info("Request aborted as expected")}})().then((()=>{n()}))}));n.push(r)})),await Promise.all(n),t}async refreshCacheContent(e,t,n){var i,o,a,s,l;let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=T.getInstance(),u=[],c=new Map,h=new Map;null!==(i=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==i&&i.forEach((e=>{e.name&&h.set(e.name,e)})),null!==(o=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==o&&o.forEach((e=>{e.name&&h.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){var t;const n=this.memberIdTypeLookup.get(e);c.has(n)?null===(t=c.get(n))||void 0===t||t.push(e):c.set(n,[e])}})):null===(a=this.inclusionModeDefinition)||void 0===a||null===(a=a.namedTypeDefinitions)||void 0===a||a.forEach(((e,t)=>{e.useAllData?c.set(t,null):e.members&&e.members.forEach((e=>{var n;c.has(t)&&null!==c.get(t)?null===(n=c.get(t))||void 0===n||n.push(e.id):c.set(t,[e.id])}))})):(null!==(s=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((e=>{e.name&&c.set(e.name,null)})),null===(l=this.knowledgeGraph.dataModel.entityTypes)||void 0===l||l.forEach((e=>{e.name&&c.set(e.name,null)})));for(const[m,g]of c){var y;const e=new Promise((e=>{(async()=>{var e;const i=new Set,o=[];let a,s="",l=!1;if(t||null!==(e=h.get(m))&&void 0!==e&&null!==(e=e.properties)&&void 0!==e&&e.forEach((e=>{e.name&&i.add(e.name)})),n&&this.geographicLookup.has(m)){var u;const e=null===(u=this.geographicLookup.get(m))||void 0===u?void 0:u.name;e&&i.add(e)}if(this.entityTypeNames.has(m))s="MATCH (n:".concat(m,") ").concat(g?"WHERE id(n) IN $ids ":"","return ID(n)"),i.forEach((e=>{s+=", n.".concat(e),o.push(e)}));else{if(!this.relationshipTypeNames.has(m))throw new r.Z("knowledge-graph:layer-data-manager","The graph type of ".concat(m," could not be determined. Was this type set in the KG data model and inclusion definition?"));l=!0,s="MATCH ()-[n:".concat(m,"]->() ").concat(g?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),i.forEach((e=>{s+=", n.".concat(e),o.push(e)}))}a=new yt(g?{openCypherQuery:s,bindParameters:{ids:g}}:{openCypherQuery:s});const c=(await tt(this.knowledgeGraph,a)).resultRowsStream.getReader();for(;;){var y,v,w,_;const{done:e,value:t}=await c.read();if(e)break;const n=[];for(let a=0;a<t.length;a++){const e=t[a];let i=0,r=0;const s={properties:{}};for(s.id=e[i],i++,r++,l&&(s.originId=e[i],i++,r++,s.destinationId=e[i],i++,r++,(0,f.s1)(this.nodeConnectionsLookup,s.originId,(()=>new Set)).add(s.id),(0,f.s1)(this.nodeConnectionsLookup,s.destinationId,(()=>new Set)).add(s.id));i<e.length;i++)s.properties[o[i-r]]=e[i];n.push(s)}const i=p.writeToStore(n,vt,null===(y=this.geographicLookup.get(m))||void 0===y?void 0:y.name);this.sublayerCaches.has(m)||this.sublayerCaches.set(m,new Map),d&&!(null!==(v=this.inclusionModeDefinition)&&void 0!==v&&v.namedTypeDefinitions.has(m))&&null!==(w=this.inclusionModeDefinition)&&void 0!==w&&w.namedTypeDefinitions.set(m,{useAllData:!1,members:new Map}),d&&(null===(_=this.inclusionModeDefinition)||void 0===_||!_.namedTypeDefinitions.get(m).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(m).members=new Map);const r=this.sublayerCaches.get(m);i.forEach((e=>{var t,n;null!==r&&void 0!==r&&r.set(e.attributes[vt],e),d&&(null===(t=this.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(m).members.has(e.attributes[vt]))&&(null!==(n=this.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.get(m).members.set(e.attributes[vt],{id:e.attributes[vt]}),this.memberIdTypeLookup.set(e.attributes[vt],m))}))}})().then((()=>{e(null)}))}));u.push(e),null===(y=this._processingCacheUpdatesLookup.get(m))||void 0===y||y.push(e)}await Promise.all(u)}removeFromLayer(e){const t=new Set,n=new Set(e.map((e=>e.id)));for(const o of e){var i;t.add(o.typeName),this.memberIdTypeLookup.delete(o.id),null===(i=this.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.forEach((e=>{var t;(null===(t=e.members)||void 0===t?void 0:t.has(o.id))&&e.members.delete(o.id)}))}t.forEach((e=>{var t;null===(t=this.sublayerCaches.get(e))||void 0===t||t.forEach(((t,i)=>{var o;n.has(i)&&(null===(o=this.sublayerCaches.get(e))||void 0===o||o.delete(i))}))}))}async retrieveDataFromService(e,t,n){var i,o,a;const s=T.getInstance(),l=new Set,d=[];let p,u="",c=[];const h="relationship"===t.graphType,y=null===(i=this.inclusionModeDefinition)||void 0===i||null===(i=i.namedTypeDefinitions)||void 0===i||null===(i=i.get(t.objectType.name))||void 0===i?void 0:i.useAllData,m=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let f=!y&&m?Array.from(m).sort():null;if(null!==(o=this.inclusionModeDefinition)&&void 0!==o&&null!==(o=o.namedTypeDefinitions)&&void 0!==o&&null!==(o=o.get(t.objectType.name))&&void 0!==o&&o.useAllData)(null===(a=this.inclusionModeDefinition)||void 0===a||null===(a=a.namedTypeDefinitions)||void 0===a||null===(a=a.get(t.objectType.name))||void 0===a?void 0:a.useAllData)&&null!=e.objectIds&&(f=e.objectIds);else if(null!=e.objectIds&&f&&f.length>0){const t=e.objectIds;e.objectIds=f.filter((e=>t.includes(e)))}else if(null!=e.objectIds)f=e.objectIds;else{var b,C,E;if(null!==(b=this.inclusionModeDefinition)&&void 0!==b&&b.namedTypeDefinitions.has(t.objectType.name)&&(null===(C=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===C||!C.members||(null===(E=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===E||null===(E=E.members)||void 0===E?void 0:E.size)<1))return e.objectIds=[],[];e.objectIds=f}if(null!=e.outFields){const n=e.outFields;n.includes("*")?t.fields.forEach((e=>{l.add(e.name)})):n.forEach((e=>{e!==vt&&e!==t.geometryFieldName&&l.add(e)}))}if(null!=e.geometry){var k,M,x;const n=e.geometry;let i;const o=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,a=null===o||void 0===o?void 0:o.spatialReference,s=null===o||void 0===o||null===(k=o.serviceCapabilities)||void 0===k?void 0:k.geometryCapabilities;let c=null===s||void 0===s?void 0:s.geometryMaxBoundingRectangleSizeX,y=null===s||void 0===s?void 0:s.geometryMaxBoundingRectangleSizeY;if(null===n||void 0===n||null===(M=n.extent)||void 0===M||!M.spatialReference||null!==(x=n.spatialReference)&&void 0!==x&&x.isWGS84?i=n.extent:(await(0,w.initializeProjection)(n.extent.spatialReference,_.Zn),i=(0,w.project)(n.extent,_.Zn)),c&&y&&a){if(4326!==a.wkid){const e=new gt.Z({spatialReference:a,xmax:c,ymax:y}),t=(0,w.project)(e,_.Zn);c=t.xmax,y=t.ymax}if(i.xmax-i.xmin>c)throw new r.Z("knowledge-graph:layer-data-manager","Extent x bounds should be within ".concat(c,"\xb0 latitude, limit exceeded"));if(i.ymax-i.ymin>y)throw new r.Z("knowledge-graph:layer-data-manager","Extent y bounds should be within ".concat(y,"\xb0 longitude, limit exceeded"))}if(null!=e.where&&"1=1"!==e.where){const n=await(0,g.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&l.add(e.name)}))}u=h?"Match ()-[n:".concat(t.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(t.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n)"),t.geometryFieldName&&l.add(t.geometryFieldName),l.forEach((e=>{u+=", n.".concat(e),d.push(e)})),p=new yt({openCypherQuery:u,bindParameters:{param_filter_geom:new v.Z({rings:mt(i)})}})}else{let n="";if(null!=e.where&&"1=1"!==e.where){const i=await(0,g.E)(e.where,t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&l.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),r=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const s=e=>{if("column-reference"===e.type)return"n.".concat(e.column);if("string"===e.type)return"'".concat(e.value,"'");if("number"===e.type)return"".concat(e.value);if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&r.has(e.operator))return"".concat(s(e.left)," ").concat(e.operator," ").concat(s(e.right));if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+="lower(n.".concat(e.left.args.value[0].column,")");else{if("column-reference"!==e.left.type)return a=!0,"";t+="lower(n.".concat(e.left.column,")")}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let n=e.right.value;"%"===n.charAt(0)&&(n=n.slice(1)),"%"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),t+="'".concat(n.toLowerCase(),"')")}return t}return a=!0,""};n=s(i.parseTree),a&&(n="")}let i="";i=h?"Match ()-[n:".concat(t.objectType.name,"]->()"):"Match (n:".concat(t.objectType.name,")");let o=!1;f&&(o=!0,i+=" WHERE ID(n) IN $ids"),n&&(i+=o?" AND":" WHERE",i+=" ".concat(n)),i+=" return ID(n)",h&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&l.add(t.geometryFieldName),l.forEach((e=>{i+=", n.".concat(e),d.push(e)})),p=new yt(f?{openCypherQuery:i,bindParameters:{ids:f}}:{openCypherQuery:i})}const I=(await tt(t.parentCompositeLayer.dataManager.knowledgeGraph,p,n)).resultRowsStream.getReader();for(;;){var L;const{done:e,value:n}=await I.read();if(e)break;const i=[];for(let t=0;t<n.length;t++){const e=n[t];let o=0,r=0;const a={properties:{}};for(a.id=e[o],o++,r++,h&&(a.originId=e[o],o++,r++,a.destinationId=e[o],o++,r++);o<e.length;o++)a.properties[d[o-r]]=e[o];i.push(a)}c=c.concat(s.writeToStore(i,vt,null===(L=t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name))||void 0===L?void 0:L.name))}return c}};(0,i._)([(0,l.Cb)()],Et.prototype,"knowledgeGraph",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"inclusionModeDefinition",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"entityTypeNames",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"relationshipTypeNames",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"geographicLookup",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"sublayerCaches",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"nodeConnectionsLookup",void 0),(0,i._)([(0,l.Cb)()],Et.prototype,"memberIdTypeLookup",void 0),Et=(0,i._)([(0,p.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],Et);var kt=n(44055),Mt=(n(94931),n(78451),n(98689),n(57823),n(32066),n(49018),n(34999),n(28189),n(9014)),xt=n(40464),It=(n(70431),n(68928)),Lt=n(75878),Dt=n(63543);const Gt=(0,n(25610).v)(),Rt=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i._)([(0,l.Cb)(Gt.fields)],t.prototype,"fields",void 0),(0,i._)([(0,l.Cb)(Gt.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,i._)([(0,p.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};var St=n(6693),Nt=n(64390),jt=n(71684),Ft=n(56811),Pt=n(83040),Ot=n(37270),At=n(49818),Zt=n(81085),zt=n(82485),Qt=n(27823);let Ut=class extends((0,Nt.M)(Rt((0,St.h)((0,Ft.M)((0,jt.Q)(c.Z)))))){constructor(e){var t,n,i,o,r;if(super(e),t=this,this.capabilities=(0,Dt.MS)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=vt,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new zt.Z(e.port1,{channel:e,client:{queryFeatures:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=ft.Z.fromJSON(e);return t.queryFeaturesJSON(i,n)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=bt;else if(null!==(n=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))&&void 0!==n&&n.geometryType&&"esriGeometryNull"!==(null===(i=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))||void 0===i?void 0:i.geometryType)){var a,s,l,d;const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=null!==(a=null===t||void 0===t?void 0:t.name)&&void 0!==a?a:null,this.geometryType=null!==t&&void 0!==t&&t.geometryType?Qt.M.fromJSON(t.geometryType):null;const n=null===t||void 0===t?void 0:t.name,i=n?null===(s=e.objectType.properties)||void 0===s?void 0:s[n]:null;i?(this.hasM=null!==(l=i.hasM)&&void 0!==l&&l,this.hasZ=null!==(d=i.hasZ)&&void 0!==d&&d):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;null!==(o=e.objectType.properties)&&void 0!==o&&o.forEach((e=>{let t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),this.fields.push(Pt.Z.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),this.fields.push(Pt.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),null!==(r=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==r&&r.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?this.renderer=(0,Mt.i)((0,Dt.bU)(Qt.M.toJSON("polyline")).renderer):this.renderer=(0,Mt.i)((0,Dt.bU)(Qt.M.toJSON("point")).renderer):this.renderer=(0,Mt.i)((0,Dt.bU)(Qt.M.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,Ot.YN)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,Zt.eZ)(this,e)}createQuery(){return new ft.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e),o=At.Z.fromJSON(await i.executeQuery(n.toJSON(),null===t||void 0===t?void 0:t.signal));return o.features.forEach((e=>{e.sourceLayer=this})),o}async queryFeaturesJSON(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(n.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryFeatureCount(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(n.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryExtent(){var e,t,n,i;let o=arguments.length>1?arguments[1]:void 0;const r={...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},returnGeometry:!0},{resolvedQuery:a,queryEngine:s}=await this._setupQueryObjects(r),l=await s.executeQueryForExtent(a.toJSON(),null===o||void 0===o?void 0:o.signal);let d;return d=null!=(null===(e=l.extent)||void 0===e?void 0:e.xmin)&&null!=(null===(t=l.extent)||void 0===t?void 0:t.xmax)&&null!=(null===(n=l.extent)||void 0===n?void 0:n.ymin)&&null!=(null===(i=l.extent)||void 0===i?void 0:i.ymax)?new gt.Z(l.extent):new gt.Z,{count:l.count,extent:d}}async queryObjectIds(e,t){const n=ft.Z.from(e);let i;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);i=this.loadQueryEngine(e)}return i.executeQueryForIds(n.toJSON(),null===t||void 0===t?void 0:t.signal)}loadQueryEngine(e){const t=new It.Z({geometryType:Qt.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new Lt.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Qt.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new ft.Z({where:"1=1",outFields:[vt]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){var n;const i=ft.Z.from(e),o=i.geometry;let r;if(o&&!(null!==(n=o.spatialReference)&&void 0!==n&&n.isWGS84)&&(await(0,w.initializeProjection)(o.spatialReference,_.Zn),i.geometry=(0,w.project)(o instanceof v.Z||o instanceof te.Z?o:o.extent,_.Zn)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:i,queryEngine:r}}};(0,i._)([(0,l.Cb)()],Ut.prototype,"capabilities",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],Ut.prototype,"defaultPopupTemplate",null),(0,i._)([(0,l.Cb)()],Ut.prototype,"definitionExpression",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"displayField",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"elevationInfo",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"geometryType",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"geometryFieldName",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"graphType",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"hasM",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"hasZ",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"labelsVisible",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"labelingInfo",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"objectIdField",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"objectType",void 0),(0,i._)([(0,l.Cb)()],Ut.prototype,"parentCompositeLayer",void 0),(0,i._)([(0,l.Cb)({type:kt.Z,json:{name:"popupInfo",write:!0}})],Ut.prototype,"popupTemplate",void 0),(0,i._)([(0,l.Cb)({types:xt.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],Ut.prototype,"renderer",null),(0,i._)([(0,l.Cb)()],Ut.prototype,"source",void 0),(0,i._)([(0,l.Cb)({json:{read:!1}})],Ut.prototype,"type",void 0),Ut=(0,i._)([(0,p.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],Ut);const qt=Ut;let Yt,Ht=null;function Bt(){return Yt||(Yt=n.e(662).then(n.bind(n,39672)).then((e=>e.l)).then((e=>{let{default:t}=e;return t({locateFile:e=>(0,J.V)("esri/libs/linkchartlayout/".concat(e))})})).then((e=>{!function(e){Ht=e}(e)})),Yt)}var Jt;function Vt(e,t,n,i,o,r){const a=n.length,s=o.length,l=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,u=15+a*(p+2*l)+s*(2*d),c=Ht._malloc(u);try{const p=c+16-c%16,u=p+a*l,h=u+a*l,y=h+s*d,m=y+s*d,f=()=>[Ht.HEAPF64.subarray(p>>3,(p>>3)+a),Ht.HEAPF64.subarray(u>>3,(u>>3)+a),Ht.HEAPU32.subarray(h>>2,(h>>2)+s),Ht.HEAPU32.subarray(y>>2,(y>>2)+s),Ht.HEAPU8.subarray(m,m+a)],[g,v,w,_,b]=f();g.set(n),v.set(i),w.set(o),_.set(r),b.set(t);const C=e(a,m,p,u,s,h,y),[T,E,k,M,x]=f();return n.set(T),i.set(E),o.set(k),r.set(M),t.set(x),C}finally{Ht._free(c)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(Jt||(Jt={}));var Wt,Kt,$t,Xt,en,tn,nn,on;!function(e){e.getMinIdealEdgeLength=function(){return Ht.getMinIdealEdgeLength()},e.apply=function(e,t,n,i,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Vt(((e,t,n,i,o,l,d)=>Ht.applyForceDirectedLayout(e,t,n,i,o,l,d,r,a,s)),e,t,n,i,o)}}(Wt||(Wt={})),function(e){e.apply=function(e,t,n,i,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Vt(((e,t,n,i,o,l,d)=>Ht.applyCommunityLayout(e,t,n,i,o,l,d,r,a,s)),e,t,n,i,o)}}(Kt||(Kt={})),function(e){e.apply=function(e,t,n,i,o){return Vt(Ht.applySimpleLayout,e,t,n,i,o)}}($t||($t={})),function(e){e.apply=function(e,t,n,i,o){return Vt(Ht.applyHierarchicalLayout,e,t,n,i,o)}}(Xt||(Xt={})),function(e){e.apply=function(e,t,n,i,o){return Vt(Ht.applyRadialTreeLayout,e,t,n,i,o)}}(en||(en={})),function(e){e.apply=function(e,t,n,i,o){return Vt(Ht.applySmartTreeLayout,e,t,n,i,o)}}(tn||(tn={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(nn||(nn={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(on||(on={}));let rn=class extends((0,St.h)((0,Ft.M)(c.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new o.Z,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new gt.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new o.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new r.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){var t,n,i,o,s,l,d,p,u,c;if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const h=new Set;let y=[],m=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new r.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),null!==(n=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==n&&n.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers?(y=null!==(o=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==o?o:[],m=null!==(s=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==s?s:[]):null!==(l=e.inclusionModeDefinition)&&void 0!==l&&l.namedTypeDefinitions&&(null===(d=e.inclusionModeDefinition)||void 0===d?void 0:d.namedTypeDefinitions.size)>0?null===(p=e.inclusionModeDefinition)||void 0===p||p.namedTypeDefinitions.forEach(((t,n)=>{var i,o;if(!this._graphTypeLookup.get(n))return a.Z.getLogger(this).warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.delete(n));this._graphTypeLookup.get(n)instanceof z||"strictOrigin"in this._graphTypeLookup.get(n)?h.has(n)||(h.add(n),m.push(this._graphTypeLookup.get(n))):this._graphTypeLookup.get(n)instanceof A||"properties"in this._graphTypeLookup.get(n)?h.has(n)||(h.add(n),y.push(this._graphTypeLookup.get(n))):(a.Z.getLogger(this).warn("A named type, ".concat(n,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(o=e.inclusionModeDefinition)||void 0===o||o.namedTypeDefinitions.delete(n))})):(y=null!==(u=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==u?u:[],m=null!==(c=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==c?c:[]);const f=new Et({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=y,this.memberRelationshipTypes=m,this.dataManager=f}load(e){return this.addResolvingPromise(new Promise((t=>{(async function(e){return et.fetchKnowledgeGraph(e)})(this.url).then((n=>{var i,o,r,a;if(this._initializeLayerProperties({knowledgeGraph:n,inclusionModeDefinition:this._originalInclusionList}),null!==(i=this.dataManager.inclusionModeDefinition)&&void 0!==i&&null!==(i=i.namedTypeDefinitions)&&void 0!==i&&i.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(o=this.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==o&&o.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(r=this.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==r&&r.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(a=this.dataManager.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.forEach((e=>{var t;e.useAllData=!1,null!==(t=e.members)&&void 0!==t&&t.forEach((e=>{let t;t=e.linkChartLocation instanceof y.Z?e.linkChartLocation:e.linkChartLocation?(0,h.GH)(e.linkChartLocation):null,this.linkChartDiagramLookup.set(e.id,t),t&&2===t.coords.length&&0===t.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,u.fC)(t.coords[1],t.coords[0],Ct)):this.linkChartGeohashLookup.set(e.id,"")})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{var l;const t="GEOGRAPHIC"===(null===(l=this.defaultLinkChartConfig)||void 0===l?void 0:l.layoutMode);this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,s.k_)(e);const t=[],n=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{n.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{n.push(e.refreshCachedQueryEngine())})),await Promise.all(n)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let n=[];(null===t||void 0===t?void 0:t.cascadeAddRelationshipEndNodes)&&this.dataManager.knowledgeGraph.dataModel&&(n=await async function(e,t){var n;const i=[],o=new Map,r=[];if(null!==(n=t.dataModel)&&void 0!==n&&n.relationshipTypes)for(const s of t.dataModel.relationshipTypes)s.name&&o.set(s.name,[]);for(const s of e){var a;o.has(s.typeName)&&(null===(a=o.get(s.typeName))||void 0===a||a.push(s.id))}for(const[s,l]of o){if(l.length<1)continue;const e=new yt({openCypherQuery:"MATCH (n)-[r:".concat(s,"]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]"),bindParameters:{ids:l}});r.push(tt(t,e).then((async e=>{const t=e.resultRowsStream.getReader();for(;;){const{done:e,value:n}=await t.read();if(e)break;for(const t of n)i.push({id:t[0],typeName:t[1]}),i.push({id:t[2],typeName:t[3]})}})))}return await Promise.all(r),i}(e,this.dataManager.knowledgeGraph));const i=e.concat(n).filter((e=>{var t;return!(null!==(t=this.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))}));await this._handleNewRecords(i)}async removeRecords(e){let{cascadeRemoveRelationships:t=!0,recalculateLayout:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cascadeRemoveRelationships:!0,recalculateLayout:!1},i=[];for(const l of e){var o,r;!1===(null===(o=this.dataManager.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(l.typeName))||void 0===o?void 0:o.useAllData)&&(null===(r=this.dataManager.inclusionModeDefinition)||void 0===r||null===(r=r.namedTypeDefinitions)||void 0===r||null===(r=r.get(l.typeName))||void 0===r||null===(r=r.members)||void 0===r?void 0:r.has(l.id))&&i.push(l)}if(t){const e=new Set,t=[];for(const n of i)if(this.dataManager.nodeConnectionsLookup.has(n.id))for(const t of this.dataManager.nodeConnectionsLookup.get(n.id))e.add(t);for(const n of e)this.dataManager.memberIdTypeLookup.has(n)&&t.push({id:n,typeName:this.dataManager.memberIdTypeLookup.get(n)});i=i.concat(t)}this.dataManager.removeFromLayer(i);for(const l of i){var a;null!==(a=this.sublayerIdsCache.get(l.typeName))&&void 0!==a&&a.delete(l.id),this.linkChartDiagramLookup.delete(l.id)}n&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});const s=[];return this.layers.forEach((e=>{s.push(e.refreshCachedQueryEngine())})),await Promise.all(s),this._refreshNamedTypes(),i}async expand(e){const t=await this.dataManager.getConnectedRecordIds(e),n=t.filter((e=>{var t;return!(null!==(t=this.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))}));return await this._handleNewRecords(t),{records:n}}loadLayerAssumingLocalCache(){var e,t;this.memberRelationshipTypes.forEach((e=>{const t=new qt({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new qt({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach(((e,t)=>{var n;const i=((e,t,n)=>(e.has(t)||e.set(t,n()),e.get(t)))(this.sublayerIdsCache,t,(()=>new Set));null===(n=e.members)||void 0===n||n.forEach((e=>{if(i.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof y.Z)this.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,u.fC)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],Ct)):this.linkChartGeohashLookup.set(e.id,"");else{const t=(0,h.GH)(e.linkChartLocation);this.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?this.linkChartGeohashLookup.set(e.id,(0,u.fC)(e.linkChartLocation.x,e.linkChartLocation.y,Ct)):this.linkChartGeohashLookup.set(e.id,"")}}))})))}async calculateLinkChartLayout(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",i=arguments.length>1?arguments[1]:void 0;const o=[],s=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{o.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{s.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map;const l=new Map,d=new Map,p=new Map,c=new Map,y=new Uint8Array(o.length),m=new Float64Array(o.length),f=new Float64Array(o.length),g=new Uint32Array(s.length),v=new Uint32Array(s.length),w=[],_=null!==(e=null===i||void 0===i?void 0:i.xScaleFactor)&&void 0!==e?e:1,b=null!==(t=null===i||void 0===i?void 0:i.yScaleFactor)&&void 0!==t?t:1,C=new gt.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let T,E="FORCE_DIRECTED",k=0,M=0;switch(E="GEOGRAPHIC"===n?"FORCE_DIRECTED":n,E){case"FORCE_DIRECTED":T=Wt.apply;break;case"COMMUNITY":T=Kt.apply;break;case"HIERARCHICAL":T=Xt.apply;break;case"RADIAL_TREE":T=en.apply;break;case"SMART_TREE":T=tn.apply;break;default:T=$t.apply}o.forEach((e=>{var t,o,r,a,s,l;let{typeName:d,feature:p}=e;if(null!==i&&void 0!==i&&null!==(t=i.lockedNodeLocations)&&void 0!==t&&t.has(p.attributes[vt])){"GEOGRAPHIC"===n&&this.dataManager.geographicLookup.has(d)?y[k]=Jt.IsGeographic:y[k]=Jt.None;const e=i.lockedNodeLocations.get(p.attributes[vt]);m[k]=e.x,f[k]=e.y}else if("GEOGRAPHIC"===n&&this.dataManager.geographicLookup.has(d)){var u;y[k]=Jt.IsGeographic;let e=null;const t=p.attributes[this.dataManager.geographicLookup.get(d).name];switch(null===(u=this.dataManager.geographicLookup.get(d))||void 0===u?void 0:u.geometryType){case"esriGeometryPoint":m[k]=null===t||void 0===t?void 0:t.x,f[k]=null===t||void 0===t?void 0:t.y;break;case"esriGeometryPolygon":e=null===t||void 0===t?void 0:t.centroid,null!=(null===(o=e)||void 0===o?void 0:o.x)&&null!=(null===(r=e)||void 0===r?void 0:r.y)?(m[k]=e.x,f[k]=e.y):y[k]=Jt.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=null===t||void 0===t||null===(a=t.extent)||void 0===a?void 0:a.center,null!=(null===(s=e)||void 0===s?void 0:s.x)&&null!=(null===(l=e)||void 0===l?void 0:l.y)?(m[k]=e.x,f[k]=e.y):y[k]=Jt.IsMovable;break;default:y[k]=Jt.IsMovable}(null==m[k]||null==f[k]||Number.isNaN(m[k])||Number.isNaN(f[k]))&&(y[k]=Jt.IsMovable,m[k]=0,f[k]=0)}else y[k]=Jt.IsMovable,m[k]=0,f[k]=0;c.set(p.attributes[vt],k),w[k]={feature:p,typeName:d},k++}));let x=!1;if(s.forEach((e=>{const t=c.get(e.feature.attributes[wt]),n=c.get(e.feature.attributes[_t]);void 0!==t&&void 0!==n?(g[M]=t,v[M]=n,M++):(x=!0,this.linkChartDiagramLookup.set(e.feature.attributes[wt],null),this.linkChartGeohashLookup.set(e.feature.attributes[wt],null))})),x&&a.Z.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await Bt(),!T(y,m,f,g,v))throw new r.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let r=0;r<w.length;r++){if(y[r]===Jt.IsMovable&&(m[r]=m[r]*_,f[r]=f[r]*b),f[r]>84.9999&&(f[r]=84.9999),f[r]<-84.9999&&(f[r]=-84.9999),m[r]>179.9999&&(m[r]=179.9999),m[r]<-179.9999&&(m[r]=-179.9999),w[r].feature.attributes[bt]=new ee.Z(m[r],f[r]),l.has(w[r].typeName)){const e=l.get(w[r].typeName);null===e||void 0===e||e.set(w[r].feature.attributes[vt],w[r].feature)}else{const e=new Map;e.set(w[r].feature.attributes[vt],w[r].feature),l.set(w[r].typeName,e)}p.set(w[r].feature.attributes[vt],w[r].feature);const e=(0,h.GH)(w[r].feature.attributes[bt]);this.linkChartDiagramLookup.set(w[r].feature.attributes[vt],w[r].feature.attributes[bt]?e:null),this.linkChartGeohashLookup.set(w[r].feature.attributes[vt],(0,u.fC)(w[r].feature.attributes[bt].y,w[r].feature.attributes[bt].x,Ct)),w[r].feature.attributes[bt].x<C.xmin&&(C.xmin=w[r].feature.attributes[bt].x),w[r].feature.attributes[bt].x>C.xmax&&(C.xmax=w[r].feature.attributes[bt].x),w[r].feature.attributes[bt].y<C.ymin&&(C.ymin=w[r].feature.attributes[bt].y),w[r].feature.attributes[bt].y>C.ymax&&(C.ymax=w[r].feature.attributes[bt].y)}return this.linkChartExtent.xmin=C.xmin,this.linkChartExtent.xmax=C.xmax,this.linkChartExtent.ymin=C.ymin,this.linkChartExtent.ymax=C.ymax,s.forEach((e=>{var t,n;const i=null===(t=w[c.get(e.feature.attributes[wt])])||void 0===t?void 0:t.feature.attributes[bt],o=null===(n=w[c.get(e.feature.attributes[_t])])||void 0===n?void 0:n.feature.attributes[bt];if(!i||!o)return;const r=new te.Z({paths:[[i.x,i.y],[o.x,o.y]]});if(e.feature.attributes[bt]=r,d.has(e.typeName)){const t=d.get(e.typeName);null===t||void 0===t||t.set(e.feature.attributes[vt],e.feature)}else{const t=new Map;t.set(e.feature.attributes[vt],e.feature),d.set(e.typeName,t)}p.set(e.feature.attributes[vt],e.feature);const a=(0,h.GH)(e.feature.attributes[bt]);this.linkChartDiagramLookup.set(e.feature.attributes[vt],e.feature.attributes[bt]?a:null),this.linkChartGeohashLookup.set(e.feature.attributes[vt],"")})),this._currentLinkChartConfig={layoutMode:n,xScaleFactor:_,yScaleFactor:b},{nodes:l,links:d,idMap:p}}async applyNewLinkChartLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",t=arguments.length>1?arguments[1]:void 0;const n=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{n.push(e.refreshCachedQueryEngine())})),await Promise.all(n),this._refreshNamedTypes()}getCurrentNodeLocations(){var e;const t=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((e=>{var n;null===e||void 0===e||null===(n=e.members)||void 0===n||n.forEach((e=>{const n=e.linkChartLocation;let i;const o=e.id;n&&(i="x"in n?{x:n.x,y:n.y}:{x:n.coords[0],y:n.coords[1]},t.set(o,new ee.Z({x:i.x,y:i.y})))}))})),t}async synchronizeInclusionListWithCache(){return new Promise((e=>{var t;null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&t.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const n=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!n.has(e))).forEach((t=>{var n;null===(n=e.members)||void 0===n||n.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const n of e)this.sublayerIdsCache.has(n.typeName)||(this.sublayerIdsCache.set(n.typeName,new Set),t.push(n.typeName)),this.sublayerIdsCache.get(n.typeName).add(n.id);for(const n of t)if(this._graphTypeLookup.has(n)){const e=this._graphTypeLookup.get(n),t="endPoints"in e?"relationship":"entity",i=new qt({objectType:e,parentCompositeLayer:this,graphType:t,title:n});"entity"===t?this.dataManager.entityTypeNames.add(n):this.dataManager.relationshipTypeNames.add(n),i.geometryType?this.layers.push(i):this.tables.push(i),this.dataManager.sublayerCaches.set(n,new Map)}await this.dataManager.refreshCacheContent(e.map((e=>e.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})}async _initializeDiagram(){var e;this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((e=>{var t;null===e||void 0===e||null===(t=e.members)||void 0===t||t.forEach((e=>{const t=e.linkChartLocation;let n;const i=e.id;if(!t)return;n="x"in t?{x:t.x,y:t.y}:{x:t.coords[0],y:t.coords[1]};const o=(0,h.GH)(n);this.linkChartDiagramLookup.set(i,o),this.linkChartGeohashLookup.set(i,(0,u.fC)(n.x,n.y,Ct)),this.linkChartExtent.xmin>n.x&&(this.linkChartExtent.xmin=n.x),this.linkChartExtent.xmax<n.x&&(this.linkChartExtent.xmax=n.x),this.linkChartExtent.ymin>n.y&&(this.linkChartExtent.ymin=n.y),this.linkChartExtent.ymax<n.y&&(this.linkChartExtent.ymax=n.y)}))})),this.memberRelationshipTypes.forEach((e=>{var t;e.name&&(null===(t=this.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((e=>{const t=this.linkChartDiagramLookup.get(e.attributes[wt]),n=this.linkChartDiagramLookup.get(e.attributes[_t]);if(t&&n){const i=(0,h.GH)(new te.Z({paths:[[t.coords[0],t.coords[1]],[n.coords[0],n.coords[1]]]}));this.linkChartDiagramLookup.set(e.attributes[vt],i)}else this.linkChartDiagramLookup.set(e.attributes[vt],null);this.linkChartGeohashLookup.set(e.attributes[vt],"")})))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,i._)([(0,l.Cb)()],rn.prototype,"dataPreloadedInLocalCache",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"defaultLinkChartConfig",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"dataManager",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"knowledgeGraph",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"layers",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"linkChartDiagramLookup",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"linkChartExtent",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"linkChartGeohashLookup",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"memberEntityTypes",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"memberRelationshipTypes",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"sublayerIdsCache",void 0),(0,i._)([(0,l.Cb)()],rn.prototype,"tables",void 0),(0,i._)([(0,l.Cb)({json:{read:!1}})],rn.prototype,"type",void 0),rn=(0,i._)([(0,p.j)("esri.layers.LinkChartLayer")],rn);const an=rn},63543:(e,t,n)=>{n.d(t,{Dm:()=>p,Hq:()=>u,MS:()=>c,bU:()=>s});var i=n(93169),o=n(84652),r=n(60480),a=n(76115);function s(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.I4:"esriGeometryPolyline"===e?a.ET:a.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;function p(e,t){if((0,i.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let n="this.".concat(t," = null;");for(const t in e)n+="this".concat(l.test(t)?".".concat(t):'["'.concat(t,'"]')," = ").concat(JSON.stringify(e[t]),";");const i=new Function("\n      return class AttributesClass$".concat(d++," {\n        constructor() {\n          ").concat(n,";\n        }\n      }\n    "))();return()=>new i}catch(n){return()=>({[t]:null,...e})}}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,o.d9)(e)}}]}function c(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:r.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);
//# sourceMappingURL=6326.c4a12ad2.chunk.js.map