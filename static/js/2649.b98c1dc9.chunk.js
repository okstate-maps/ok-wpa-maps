"use strict";(self.webpackChunkok_wpa_maps=self.webpackChunkok_wpa_maps||[]).push([[2649,34429],{34429(e,t,i){i.d(t,{QueueProcessor:()=>d});var r=i(30726),s=i(50346),o=i(59649),n=i(67993),l=i(52394),a=i(75540);class u{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class d{constructor(e){this._schedule=null,this._deferreds=new n.A,this._controllers=new n.A,this._processingItems=new n.A,this._pausedSignal=(0,a.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new o.A(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=(0,r.xt)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,i)=>e(i))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const i=this.get(e);if(i)return i;const r=new AbortController;let o=null;t&&(o=(0,s.u7)(t,()=>r.abort()));const n=()=>{l.remove(),null!=o&&o.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=(0,s.NY)(r.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),n(),a.reject((0,s.NK)())}),a=(0,s.Tw)();return this._deferreds.set(e,a),this._controllers.set(e,r),a.promise.then(n,n),this._queue.push(e),this._scheduleNext(),a.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var e;const t=this._queue.popLast();return t&&(null!==(e=this._deferreds.get(t))&&void 0!==e&&e.reject((0,s.NK)()),this._removeItem(t)),t}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,l._)(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const i=new AbortController,r=new u(e,i);this._processingItems.set(e,r);try{t=this.process(e,i.signal)}catch(o){this._processError(r,o)}(0,s.$X)(t)?(r.promise=t,t.then(e=>this._processResult(r,e),e=>this._processError(r,e))):this._processResult(r,t)}}},71749(e,t,i){i.r(t),i.d(t,{default:()=>ne});var r=i(6326),s=i(16868),o=i(69098),n=i(19276),l=i(50076),a=i(81806),u=i(77717),d=i(48611),c=i(68134),p=i(46053),y=i(28379),h=i(87990),g=i(17707),m=i(76797),f=i(13312),v=i(74398),_=i(61024),w=i(57274),q=i(9465);const x=Symbol("isParquetGraphicOrigin");var C;class b extends q.A{get[(C=x,_.ym)](){return this.layer}get[v.e](){return this.layer}get[w.Q](){return this.layer}constructor(e){super(),this[C]=!0,this.type="parquet",this.layer=e}get id(){return this.layer.id}}var O=i(25515),F=i(49304),N=i(76460),A=i(50346),M=i(16783),S=i(30178),Z=i(77725);let P=class extends F.x_{constructor(e){super(e),this.type="parquet"}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){var e;null===(e=this._connection)||void 0===e||e.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{N.A.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:null===t||void 0===t?void 0:t.signal})}async queryFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=await this.queryFeaturesJSON(e,{signal:null===t||void 0===t?void 0:t.signal});return Z.A.fromJSON(i)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:null===t||void 0===t?void 0:t.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:null===t||void 0===t?void 0:t.signal})}async queryExtent(e,t){if(null==this.layer.encoding)return N.A.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const i=await this._proxy.queryExtent(e.toJSON(),{signal:null===t||void 0===t?void 0:t.signal});return{count:i.count,extent:m.A.fromJSON(i.extent)}}async _initialize(e){var t,i,r;this._connection=await(0,M.ho)("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),(0,A.Te)(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:s,capabilities:o}=await this._proxy.load({urls:this.layer.urls.items,fields:null===(t=this.layer.fields)||void 0===t?void 0:t.map(e=>e.toJSON()),geometryType:this.layer.geometryType?(0,S.sA)(this.layer.geometryType):null,spatialReference:null===(i=this.layer.spatialReference)||void 0===i?void 0:i.toJSON(),encoding:null===(r=this.layer.encoding)||void 0===r?void 0:r.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});(0,A.Te)(e),this.sourceJSON=s,this.capabilities=o}};(0,r.Cg)([(0,p.MZ)()],P.prototype,"type",void 0),(0,r.Cg)([(0,p.MZ)({constructOnly:!0})],P.prototype,"layer",void 0),(0,r.Cg)([(0,p.MZ)()],P.prototype,"sourceJSON",void 0),(0,r.Cg)([(0,p.MZ)()],P.prototype,"capabilities",void 0),P=(0,r.Cg)([(0,h.$)("esri.layers.graphics.sources.ParquetSource")],P);var I=i(65624),k=i(31362),R=i(30218),j=i(74440),T=i(37207),z=i(11270),E=i(37534),J=i(5682),L=i(78817),D=i(95363),G=i(15427),Q=i(44135),U=i(76350),$=i(53430),V=i(95114),B=i(27937),K=i(62547),W=i(98141),H=i(19208),X=i(34373),Y=i(97015),ee=i(79453),te=i(30973);const ie=(0,U.p)(),re="__OBJECTID",se={types:{key:"type",base:K.Z,typeMap:{wkb:H.A,location:W.A}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let oe=class extends((0,R.FJ)((0,T.J)((0,j.F)((0,I.dM)((0,E.fY)((0,L.e)((0,J.j)((0,z.q)((0,u.P)((0,k.d)((0,o.OU)(O.A)))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new b(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=re,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!(0,a.A)("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new n.A}destroy(){var e;null===(e=this.source)||void 0===e||e.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([(0,c.wB)(()=>this.urls,e=>{var t;return null===(t=this.source)||void 0===t?void 0:t.updateFiles(e.items)}),(0,c.wB)(()=>this.customParameters,e=>{var t;return null===(t=this.source)||void 0===t?void 0:t.setCustomParameters(e)})]),this}get capabilities(){var e;return null===(e=this.source)||void 0===e?void 0:e.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,i,r){const s=e.filter(e=>!(e.name===re&&"oid"===e.type)).map(e=>e.toJSON(r));(0,d.sM)(i,s,t)}get isTable(){return null==this.encoding}set renderer(e){(0,$.yp)(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new n.A("files"===e.type?e.urls:[])}writeUrls(e,t,i,r){var s;const o=[];if(null!==e&&void 0!==e&&e.length){var n;r={blockedRelativeUrls:null===(n=r)||void 0===n?void 0:n.blockedRelativeUrls};for(let t of e)t=(0,ee.t)(t,r),t&&o.push(t)}o.length?t.source={type:"files",urls:o}:null===(s=r.messages)||void 0===s||s.push(new l.A("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return(0,te.tn)(this,e)}createQuery(){const e=new Y.A;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new P({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const i=await this.source.queryFeatures(this._normalizeQuery(e),t),r=this.graphicOrigin;if(null!==i&&void 0!==i&&i.features)for(const s of i.features)s.layer=s.sourceLayer=this,s.origin=r;return i}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){var t;return null!==(t=Y.A.from(e))&&void 0!==t?t:this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),(0,$.yp)(this.renderer,this.fieldsIndex),(0,$.sv)(this.timeInfo,this.fieldsIndex),null==this.spatialReference&&(this.spatialReference=f.A.WGS84)}};(0,r.Cg)([(0,p.MZ)({readOnly:!0,json:{read:!1,write:!1}})],oe.prototype,"capabilities",null),(0,r.Cg)([(0,p.MZ)({type:String})],oe.prototype,"copyright",void 0),(0,r.Cg)([(0,p.MZ)({readOnly:!0})],oe.prototype,"defaultPopupTemplate",null),(0,r.Cg)([(0,p.MZ)()],oe.prototype,"displayOptimization",void 0),(0,r.Cg)([(0,p.MZ)({type:[Q.A],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],oe.prototype,"fields",void 0),(0,r.Cg)([(0,g.K)("fields")],oe.prototype,"writeFields",null),(0,r.Cg)([(0,p.MZ)(ie.fieldsIndex)],oe.prototype,"fieldsIndex",void 0),(0,r.Cg)([(0,p.MZ)(se)],oe.prototype,"encoding",void 0),(0,r.Cg)([(0,p.MZ)({type:m.A,json:{name:"extent"}})],oe.prototype,"fullExtent",void 0),(0,r.Cg)([(0,p.MZ)({type:S.ye.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:S.ye.read},write:{writer:S.ye.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:S.ye.read}}}}})],oe.prototype,"geometryType",void 0),(0,r.Cg)([(0,p.MZ)({readOnly:!0,clonable:!1})],oe.prototype,"graphicOrigin",void 0),(0,r.Cg)([(0,p.MZ)(D.kF)],oe.prototype,"labelsVisible",void 0),(0,r.Cg)([(0,p.MZ)({type:[V.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:B.w},write:!0}})],oe.prototype,"labelingInfo",void 0),(0,r.Cg)([(0,p.MZ)(D.fV)],oe.prototype,"legendEnabled",void 0),(0,r.Cg)([(0,p.MZ)()],oe.prototype,"file",void 0),(0,r.Cg)([(0,p.MZ)({type:String,readOnly:!0})],oe.prototype,"objectIdField",void 0),(0,r.Cg)([(0,p.MZ)({type:["ParquetLayer"]})],oe.prototype,"operationalLayerType",void 0),(0,r.Cg)([(0,p.MZ)(ie.outFields)],oe.prototype,"outFields",void 0),(0,r.Cg)([(0,p.MZ)(D.M6)],oe.prototype,"popupEnabled",void 0),(0,r.Cg)([(0,p.MZ)({type:s.A,json:{name:"popupInfo",write:!0}})],oe.prototype,"popupTemplate",void 0),(0,r.Cg)([(0,p.MZ)({types:X.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],oe.prototype,"renderer",null),(0,r.Cg)([(0,p.MZ)({type:P,readOnly:!0,cast:null,json:{read:!1}})],oe.prototype,"source",void 0),(0,r.Cg)([(0,p.MZ)({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],oe.prototype,"spatialReference",void 0),(0,r.Cg)([(0,p.MZ)({type:[G.A]})],oe.prototype,"templates",void 0),(0,r.Cg)([(0,p.MZ)()],oe.prototype,"title",void 0),(0,r.Cg)([(0,p.MZ)({json:{read:!1},readOnly:!0})],oe.prototype,"type",void 0),(0,r.Cg)([(0,p.MZ)({type:n.A.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],oe.prototype,"urls",void 0),(0,r.Cg)([(0,y.w)("urls")],oe.prototype,"readUrls",null),(0,r.Cg)([(0,g.K)("urls")],oe.prototype,"writeUrls",null),oe=(0,r.Cg)([(0,h.$)("esri.layers.ParquetLayer")],oe);const ne=oe},62547(e,t,i){i.d(t,{Z:()=>a});var r=i(6326),s=i(69098),o=i(42553),n=i(46053),l=(i(81806),i(76460),i(47249),i(87990));let a=class extends((0,s.OU)(o.o)){constructor(e){super(e),this.type=null}};(0,r.Cg)([(0,n.MZ)({type:["wkb","location"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],a.prototype,"type",void 0),a=(0,r.Cg)([(0,l.$)("esri.layers.support.ParquetEncodingBase")],a)},98141(e,t,i){i.d(t,{A:()=>l});var r=i(6326),s=i(46053),o=(i(81806),i(76460),i(47249),i(87990)),n=i(62547);let l=class extends n.Z{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};(0,r.Cg)([(0,s.MZ)({type:["location"]})],l.prototype,"type",void 0),(0,r.Cg)([(0,s.MZ)({type:String,json:{name:"yField",write:{isRequired:!0}}})],l.prototype,"latitudeFieldName",void 0),(0,r.Cg)([(0,s.MZ)({type:String,json:{name:"xField",write:{isRequired:!0}}})],l.prototype,"longitudeFieldName",void 0),l=(0,r.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingLocation")],l)},19208(e,t,i){i.d(t,{A:()=>l});var r=i(6326),s=i(46053),o=(i(81806),i(76460),i(47249),i(87990)),n=i(62547);let l=class extends n.Z{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};(0,r.Cg)([(0,s.MZ)({type:["wkb"]})],l.prototype,"type",void 0),(0,r.Cg)([(0,s.MZ)({type:["counter-clockwise"],json:{write:!0}})],l.prototype,"orientation",void 0),(0,r.Cg)([(0,s.MZ)({type:String,json:{name:"field",write:{isRequired:!0}}})],l.prototype,"primaryFieldName",void 0),l=(0,r.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingWkb")],l)},36035(e,t,i){i.d(t,{i_:()=>s});var r=i(53430);function s(e,t,i){var s,l;t=null===(s=(0,r.rS)(t))||void 0===s?void 0:s.toLowerCase(),i=null===(l=(0,r.rS)(i))||void 0===l?void 0:l.toLowerCase();const a=e.map(e=>e.toLowerCase()),u=t?e[a.indexOf(t)]:null,d=i?e[a.indexOf(i)]:null;return{longitudeFieldName:u||e[a.indexOf(n.find(e=>a.includes(e)))],latitudeFieldName:d||e[a.indexOf(o.find(e=>a.includes(e)))]}}const o=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],n=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"]},30178(e,t,i){i.d(t,{hG:()=>h,nc:()=>g,sA:()=>y,ye:()=>p});var r=i(89379),s=(i(19276),i(50076)),o=i(45802),n=i(13312),l=i(44135),a=i(36035),u=i(98141),d=i(19208),c=i(67103);const p=new o.J({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function y(e){return p.toJSON(e)}function h(e){return p.fromJSON(e)}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.urls.length<1)throw new s.A("parquet:bad-input","At least one url must be specified",e);if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;const i=await(0,c.DV)(e.urls.getItemAt(0),{getCustomParameters:()=>t.customParameters}),o=(0,c.hD)(i),p=(0,r.A)((0,r.A)({},e),{},{file:i});null==p.fields&&(p.fields=i.fields().map(e=>l.A.fromJSON({name:e.name,alias:e.name,type:e.type}))),null==p.encoding&&(p.encoding=function(e,t){if(null!=e){const t=e.primary_column,i=e.columns[t];return new d.A({primaryFieldName:t,orientation:"counterclockwise"===i.orientation?"counter-clockwise":null})}const i=(0,a.i_)(t.map(e=>e.name));return i.latitudeFieldName&&i.longitudeFieldName?new u.A({latitudeFieldName:i.latitudeFieldName,longitudeFieldName:i.longitudeFieldName}):null}(o,p.fields));const y=(0,c.Hj)(i);if(y)switch(y.mode){case"z":p.displayOptimization={mode:"z"};break;case"xz":{const e=y.multiscale;if(!e)throw new s.A("parquet:bad-format","XZ display optimization requires multiscale geometries");p.displayOptimization={mode:"xz",multiscale:e};break}}if(!p.encoding)return p;switch(p.encoding.type){case"location":null==p.spatialReference&&(p.spatialReference=n.A.WGS84),null==p.geometryType&&(p.geometryType="point");break;case"wkb":{if(!o)return p;const e=o.primary_column,t=o.columns[e];if(p.geometryType||(p.geometryType=function(e){const{geometry_types:t}=e,i=new Set;for(const r of t){const e=m(r);e&&i.add(e)}if(i.size>1)throw new s.A("parquet:unsupported","Parquet mixed geometry types are not supported",{geometryTypes:i});return 1===i.size?i.values().next().value:void 0}(t)),p.spatialReference||(p.spatialReference=function(e){var t;const i=null===(t=e.crs)||void 0===t||null===(t=t.id)||void 0===t?void 0:t.code;return i&&"number"==typeof i?new n.A({wkid:i}):void 0}(t)),p.fields)for(const i of Object.keys(o.columns))p.fields=p.fields.filter(e=>e.name!==i)}}return p}function m(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}}}]);
//# sourceMappingURL=2649.b98c1dc9.chunk.js.map